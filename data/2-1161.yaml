- en: How To Deploy PyTorch Models as Production-Ready APIs
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¦‚ä½•å°† PyTorch æ¨¡å‹éƒ¨ç½²ä¸ºç”Ÿäº§å°±ç»ªçš„ API
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/how-to-deploy-pytorch-models-as-production-ready-apis-f61136fd0244](https://towardsdatascience.com/how-to-deploy-pytorch-models-as-production-ready-apis-f61136fd0244)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/how-to-deploy-pytorch-models-as-production-ready-apis-f61136fd0244](https://towardsdatascience.com/how-to-deploy-pytorch-models-as-production-ready-apis-f61136fd0244)
- en: An end-to-end use-case combining PyTorch Lightning and BentoML
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä¸€ä¸ªå°† PyTorch Lightning å’Œ BentoML ç»“åˆçš„ç«¯åˆ°ç«¯ç”¨ä¾‹
- en: '[](https://ahmedbesbes.medium.com/?source=post_page-----f61136fd0244--------------------------------)[![Ahmed
    Besbes](../Images/93804d9291439715e578f204b79c9bdd.png)](https://ahmedbesbes.medium.com/?source=post_page-----f61136fd0244--------------------------------)[](https://towardsdatascience.com/?source=post_page-----f61136fd0244--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----f61136fd0244--------------------------------)
    [Ahmed Besbes](https://ahmedbesbes.medium.com/?source=post_page-----f61136fd0244--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://ahmedbesbes.medium.com/?source=post_page-----f61136fd0244--------------------------------)[![Ahmed
    Besbes](../Images/93804d9291439715e578f204b79c9bdd.png)](https://ahmedbesbes.medium.com/?source=post_page-----f61136fd0244--------------------------------)[](https://towardsdatascience.com/?source=post_page-----f61136fd0244--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----f61136fd0244--------------------------------)
    [Ahmed Besbes](https://ahmedbesbes.medium.com/?source=post_page-----f61136fd0244--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----f61136fd0244--------------------------------)
    Â·12 min readÂ·Apr 3, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----f61136fd0244--------------------------------)
    Â·é˜…è¯»æ—¶é—´ 12 åˆ†é’ŸÂ·2023å¹´4æœˆ3æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/3d420812acc306b94ced6405638c8222.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3d420812acc306b94ced6405638c8222.png)'
- en: Photo by [SpaceX](https://unsplash.com/@spacex?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ç…§ç‰‡ç”± [SpaceX](https://unsplash.com/@spacex?utm_source=medium&utm_medium=referral)
    æä¾›ï¼Œæ¥è‡ª [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
- en: As an ML engineer, I often encounter two main challenges when working with deep
    learning models in production.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œä¸ºä¸€åæœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆï¼Œæˆ‘åœ¨å¤„ç†ç”Ÿäº§ç¯å¢ƒä¸­çš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ—¶ç»å¸¸é‡åˆ°ä¸¤ä¸ªä¸»è¦æŒ‘æˆ˜ã€‚
- en: The first one is the need to rewrite boilerplate code for each project to handle
    tasks like training loops, data loading, or metric computation. As this work often
    makes the codebase more complex with unnecessary abstractions, it slows down the
    iterative process.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: ç¬¬ä¸€ä¸ªæŒ‘æˆ˜æ˜¯éœ€è¦ä¸ºæ¯ä¸ªé¡¹ç›®é‡å†™æ¨¡æ¿ä»£ç ï¼Œä»¥å¤„ç†è®­ç»ƒå¾ªç¯ã€æ•°æ®åŠ è½½æˆ–åº¦é‡è®¡ç®—ç­‰ä»»åŠ¡ã€‚ç”±äºè¿™é¡¹å·¥ä½œå¸¸å¸¸ä½¿ä»£ç åº“å˜å¾—æ›´åŠ å¤æ‚ï¼Œå¹¶å¢åŠ äº†ä¸å¿…è¦çš„æŠ½è±¡ï¼Œè¿™å‡æ…¢äº†è¿­ä»£è¿‡ç¨‹ã€‚
- en: The second challenge involves the wide range of skills or tools required to
    efficiently deploy trained models to the cloud. This includes Docker, APIs, or
    cloud services. Not to mention the knowledge related to GPU support, multithreading,
    or scalability.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: ç¬¬äºŒä¸ªæŒ‘æˆ˜æ¶‰åŠåˆ°å°†è®­ç»ƒå¥½çš„æ¨¡å‹é«˜æ•ˆéƒ¨ç½²åˆ°äº‘ç«¯æ‰€éœ€çš„å¹¿æ³›æŠ€èƒ½æˆ–å·¥å…·ã€‚è¿™åŒ…æ‹¬ Dockerã€API æˆ–äº‘æœåŠ¡ï¼Œæ›´ä¸ç”¨æä¸ GPU æ”¯æŒã€å¤šçº¿ç¨‹æˆ–å¯æ‰©å±•æ€§ç›¸å…³çš„çŸ¥è¯†ã€‚
- en: If youâ€™re a data scientist, youâ€™re clearly not expected to know all this.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æ˜¯æ•°æ®ç§‘å­¦å®¶ï¼Œä½ æ˜¾ç„¶ä¸éœ€è¦äº†è§£æ‰€æœ‰è¿™äº›ã€‚
- en: '*There are fortunately two Python frameworks designed to mitigate these issues:*
    [***Pytorch Lightning***](https://github.com/Lightning-AI/lightning) *and* [***BentoML***](https://github.com/bentoml/BentoML)*.'
  id: totrans-12
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸¤ä¸ª Python æ¡†æ¶è¢«è®¾è®¡ç”¨æ¥ç¼“è§£è¿™äº›é—®é¢˜ï¼š* [***Pytorch Lightning***](https://github.com/Lightning-AI/lightning)
    *å’Œ* [***BentoML***](https://github.com/bentoml/BentoML)*ã€‚'
- en: In this article, we will combine these frameworks together to build* ***a production-ready
    image classification service*** *deployed to a Kubernetes-native environment.*
  id: totrans-13
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ç»“åˆè¿™äº›æ¡†æ¶æ¥æ„å»º* ***ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„å›¾åƒåˆ†ç±»æœåŠ¡*** *å¹¶å°†å…¶éƒ¨ç½²åˆ° Kubernetes åŸç”Ÿç¯å¢ƒä¸­ã€‚*
- en: Letâ€™s have a look ğŸ”
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬æ¥çœ‹çœ‹ ğŸ”
- en: '![](../Images/7d5f91d98b2edd4999334c0836a7614e.png)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7d5f91d98b2edd4999334c0836a7614e.png)'
- en: Workflow â€” Image by the author
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: å·¥ä½œæµ â€” ä½œè€…æä¾›çš„å›¾åƒ
- en: 1 â€” Train a multi-label image classifier with PyTorch Lightning âš¡
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1 â€” ä½¿ç”¨ PyTorch Lightning âš¡ è®­ç»ƒå¤šæ ‡ç­¾å›¾åƒåˆ†ç±»å™¨
- en: This section will focus on using PyTorch Lightning and will detail some of its
    functionalities as well as the training process.
  id: totrans-18
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æœ¬èŠ‚å°†é‡ç‚¹ä»‹ç» PyTorch Lightningï¼Œå¹¶è¯¦ç»†ä»‹ç»å…¶ä¸€äº›åŠŸèƒ½ä»¥åŠè®­ç»ƒè¿‡ç¨‹ã€‚
- en: 'As a dataset, we will use the CelebFaces Attributes from [Kaggle](https://www.kaggle.com/datasets/jessicali9530/celeba-dataset):
    it contains +200K face images of various celebrities with additional metadata
    such as identities, landmark locations, and **40 binary attribute annotations
    per image.**'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œä¸ºæ•°æ®é›†ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ª [Kaggle](https://www.kaggle.com/datasets/jessicali9530/celeba-dataset)
    çš„ CelebFaces Attributesï¼šå®ƒåŒ…å« +200K å¼ å„ç§åäººçš„é¢éƒ¨å›¾åƒï¼Œé™„åŠ äº†è¯¸å¦‚èº«ä»½ã€åœ°æ ‡ä½ç½®å’Œ **æ¯å¼ å›¾åƒ 40 ä¸ªäºŒè¿›åˆ¶å±æ€§æ³¨é‡Š**
    ç­‰å…ƒæ•°æ®ã€‚
- en: We will use the face attribute metadata to train a multi-label classifier that
    detects information such as hair color, nose size, baldness, etc.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†ä½¿ç”¨é¢éƒ¨å±æ€§å…ƒæ•°æ®æ¥è®­ç»ƒä¸€ä¸ªå¤šæ ‡ç­¾åˆ†ç±»å™¨ï¼Œä»¥æ£€æµ‹è¯¸å¦‚å‘è‰²ã€é¼»å­å¤§å°ã€ç§ƒé¡¶ç­‰ä¿¡æ¯ã€‚
- en: As mentioned, we will use **Pytorch Lightning** to train the model.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ **Pytorch Lightning** æ¥è®­ç»ƒæ¨¡å‹ã€‚
- en: '![](../Images/ce375d5b7db3311dc779c06f279805b1.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ce375d5b7db3311dc779c06f279805b1.png)'
- en: GIF modified by the author
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: GIF ç”±ä½œè€…ä¿®æ”¹
- en: PyTorch Lightning is a lightweight wrapper around PyTorch that standardizes
    many aspects of the training loop, data loading, and validation process. It provides
    a higher-level interface that streamlines the training process and reduces the
    amount of boilerplate code required.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: PyTorch Lightning æ˜¯ PyTorch çš„ä¸€ä¸ªè½»é‡çº§å°è£…ï¼Œæ ‡å‡†åŒ–äº†è®­ç»ƒå¾ªç¯ã€æ•°æ®åŠ è½½å’ŒéªŒè¯è¿‡ç¨‹çš„è®¸å¤šæ–¹é¢ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ›´é«˜çº§çš„æ¥å£ï¼Œç®€åŒ–äº†è®­ç»ƒè¿‡ç¨‹ï¼Œå¹¶å‡å°‘äº†æ‰€éœ€çš„æ ·æ¿ä»£ç ã€‚
- en: By using PyTorch Lightning, you can reduce code complexity, improve reproducibility,
    and speed up development.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ PyTorch Lightningï¼Œä½ å¯ä»¥å‡å°‘ä»£ç å¤æ‚æ€§ï¼Œæé«˜å¯é‡ç°æ€§ï¼Œå¹¶åŠ å¿«å¼€å‘é€Ÿåº¦ã€‚
- en: '![](../Images/3b8ae887c35eca263fd04891d32cc4fc.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3b8ae887c35eca263fd04891d32cc4fc.png)'
- en: Image by the author
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: To get the dataset, you need to log in to Kaggle and hit the download button.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: è¦è·å–æ•°æ®é›†ï¼Œä½ éœ€è¦ç™»å½•åˆ° Kaggle å¹¶ç‚¹å‡»ä¸‹è½½æŒ‰é’®ã€‚
- en: You can also download it from the command line after getting your credentials
    (**kaggle.json**) from your profile page.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ ä¹Ÿå¯ä»¥åœ¨è·å¾—ä½ çš„å‡­è¯ (**kaggle.json**) åé€šè¿‡å‘½ä»¤è¡Œä¸‹è½½å®ƒã€‚
- en: '[PRE0]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Hereâ€™s what you get after unzipping the folder:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: è§£å‹æ–‡ä»¶å¤¹åä½ ä¼šå¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š
- en: '![](../Images/a242b65d8f654a6b265c0ad963b8a4b2.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a242b65d8f654a6b265c0ad963b8a4b2.png)'
- en: Image by the author
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: 'The `**list_attr_celeba.csv**` file contains the attributes weâ€™re interested
    in:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '`**list_attr_celeba.csv**` æ–‡ä»¶åŒ…å«äº†æˆ‘ä»¬æ„Ÿå…´è¶£çš„å±æ€§ï¼š'
- en: '[PRE1]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![](../Images/0ee41387a47b8c50a7ff60412dcdc525.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/0ee41387a47b8c50a7ff60412dcdc525.png)'
- en: Screenshot by the author
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: æˆªå›¾ç”±ä½œè€…æä¾›
- en: and the images are contained in the `img_align_celeba/img_align_celeba/` folder.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾åƒä½äº `img_align_celeba/img_align_celeba/` æ–‡ä»¶å¤¹ä¸­ã€‚
- en: 'Letâ€™s now start training this model:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å¼€å§‹è®­ç»ƒè¿™ä¸ªæ¨¡å‹ï¼š
- en: ğŸ‘‰ Create a Dataset
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ğŸ‘‰ åˆ›å»º Dataset
- en: Just like in PyTorch, we first need to define a Dataset. This is the first step
    that indicates how the data is read from the disk and converted into tensors.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: å°±åƒåœ¨ PyTorch ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ª Datasetã€‚è¿™æ˜¯æŒ‡ç¤ºæ•°æ®å¦‚ä½•ä»ç£ç›˜è¯»å–å¹¶è½¬æ¢ä¸ºå¼ é‡çš„ç¬¬ä¸€æ­¥ã€‚
- en: '[PRE2]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: ğŸ‘‰ Create a LightningDataModule
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ğŸ‘‰ åˆ›å»º LightningDataModule
- en: Now we need to create a LightningDataModule, which is simply a collection of
    a train_dataloader(s), val_dataloader(s), test_dataloader(s), and predict_dataloader(s)
    along with the matching transforms and data processing/downloads steps required.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª LightningDataModuleï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…å« train_dataloader(s)ã€val_dataloader(s)ã€test_dataloader(s)
    å’Œ predict_dataloader(s) çš„é›†åˆï¼Œä»¥åŠåŒ¹é…çš„è½¬æ¢å’Œæ•°æ®å¤„ç†/ä¸‹è½½æ­¥éª¤ã€‚
- en: 'A LightningDataModule groups everything and is later passed to the trainer.
    Therefore, you donâ€™t need to explicitly call train or valid dataloaders yourself:
    itâ€™s automatically handled by PyTorch Lightning.'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: LightningDataModule å°†ä¸€åˆ‡ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶éšåä¼ é€’ç»™è®­ç»ƒå™¨ã€‚å› æ­¤ï¼Œä½ æ— éœ€æ˜¾å¼åœ°è°ƒç”¨è®­ç»ƒæˆ–éªŒè¯æ•°æ®åŠ è½½å™¨ï¼šPyTorch Lightning
    ä¼šè‡ªåŠ¨å¤„ç†ã€‚
- en: '[PRE3]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: ğŸ‘‰ Define a LightningModule
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ğŸ‘‰ å®šä¹‰ LightningModule
- en: 'A `[LightningModule](https://lightning.ai/docs/pytorch/stable/api/lightning.pytorch.core.LightningModule.html#lightning.pytorch.core.LightningModule)`
    doesnâ€™t just define the architecture of your model. It organizes your PyTorch
    code into the following sections:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€ä¸ª `[LightningModule](https://lightning.ai/docs/pytorch/stable/api/lightning.pytorch.core.LightningModule.html#lightning.pytorch.core.LightningModule)`
    ä¸ä»…å®šä¹‰äº†æ¨¡å‹çš„æ¶æ„ã€‚å®ƒå°†ä½ çš„ PyTorch ä»£ç ç»„ç»‡æˆä»¥ä¸‹éƒ¨åˆ†ï¼š
- en: Initialization (`__init__` and `setup()`)
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åˆå§‹åŒ– (`__init__` å’Œ `setup()`)
- en: The forward pass â€” just like in PyTorch
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å‰å‘ä¼ æ’­ â€” å°±åƒåœ¨ PyTorch ä¸­ä¸€æ ·
- en: Train Loop (`training_step()`)
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è®­ç»ƒå¾ªç¯ (`training_step()`)
- en: Validation Loop (`validation_step()`)
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: éªŒè¯å¾ªç¯ (`validation_step()`)
- en: Test Loop (`test_step()`) â€” not shown here
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æµ‹è¯•å¾ªç¯ (`test_step()`) â€” è¿™é‡Œæœªæ˜¾ç¤º
- en: Optimizers and LR Schedulers (`configure_optimizers()`)
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä¼˜åŒ–å™¨å’Œå­¦ä¹ ç‡è°ƒåº¦å™¨ (`configure_optimizers()`)
- en: '[PRE4]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: ğŸ‘‰ Define callbacks
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ğŸ‘‰ å®šä¹‰å›è°ƒå‡½æ•°
- en: Callbacks are utility functions that you can hook to your training pipeline
    to get executed at particular moments of the workflow, for example, the start
    or end of an epoch.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: å›è°ƒæ˜¯ä½ å¯ä»¥æŒ‚é’©åˆ°è®­ç»ƒç®¡é“ä¸­çš„å®ç”¨å‡½æ•°ï¼Œç”¨äºåœ¨å·¥ä½œæµçš„ç‰¹å®šæ—¶åˆ»æ‰§è¡Œï¼Œä¾‹å¦‚ï¼Œè®­ç»ƒå‘¨æœŸçš„å¼€å§‹æˆ–ç»“æŸã€‚
- en: In the following, weâ€™re going to use two callbacks for [model checkpointing](https://lightning.ai/docs/pytorch/latest/api/lightning.pytorch.callbacks.ModelCheckpoint.html#lightning.pytorch.callbacks.ModelCheckpoint)
    (to periodically save the model on disk when the metrics improve) and [early stopping](https://lightning.ai/docs/pytorch/latest/api/lightning.pytorch.callbacks.EarlyStopping.html#lightning.pytorch.callbacks.EarlyStopping)
    (to stop training when metrics stop improving)
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªå›è°ƒï¼Œ[æ¨¡å‹æ£€æŸ¥ç‚¹](https://lightning.ai/docs/pytorch/latest/api/lightning.pytorch.callbacks.ModelCheckpoint.html#lightning.pytorch.callbacks.ModelCheckpoint)ï¼ˆåœ¨æŒ‡æ ‡æ”¹å–„æ—¶å®šæœŸå°†æ¨¡å‹ä¿å­˜åˆ°ç£ç›˜ï¼‰å’Œ[æ—©åœ](https://lightning.ai/docs/pytorch/latest/api/lightning.pytorch.callbacks.EarlyStopping.html#lightning.pytorch.callbacks.EarlyStopping)ï¼ˆå½“æŒ‡æ ‡åœæ­¢æ”¹å–„æ—¶åœæ­¢è®­ç»ƒï¼‰ã€‚
- en: '[PRE5]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: ğŸ‘‰ Strat the training
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ğŸ‘‰ å¼€å§‹è®­ç»ƒ
- en: Once youâ€™ve organized your PyTorch code into a `[LightningModule](https://lightning.ai/docs/pytorch/stable/api/lightning.pytorch.core.LightningModule.html#lightning.pytorch.core.LightningModule)`,
    the `[Trainer](https://lightning.ai/docs/pytorch/stable/common/trainer.html)`
    automates everything else.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦ä½ å°†PyTorchä»£ç ç»„ç»‡æˆä¸€ä¸ª`[LightningModule](https://lightning.ai/docs/pytorch/stable/api/lightning.pytorch.core.LightningModule.html#lightning.pytorch.core.LightningModule)`ï¼Œ`[Trainer](https://lightning.ai/docs/pytorch/stable/common/trainer.html)`ä¼šè‡ªåŠ¨å¤„ç†å…¶ä»–æ‰€æœ‰äº‹æƒ…ã€‚
- en: It runs the training and validation loops, computes the metrics and logs them,
    and executes the callbacks.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒè¿è¡Œè®­ç»ƒå’ŒéªŒè¯å¾ªç¯ï¼Œè®¡ç®—æŒ‡æ ‡å¹¶è®°å½•å®ƒä»¬ï¼Œæ‰§è¡Œå›è°ƒã€‚
- en: '[PRE6]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](../Images/1ca44af3df78af503b3d4cb51dfb31de.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/1ca44af3df78af503b3d4cb51dfb31de.png)'
- en: Image by the author
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: After training for 10 epochs on 25K images only, the best model achieves 0.864
    [AUROC](https://lightning.ai/docs/metrics/stable/classification/auroc.html) on
    the validation set.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: ç»è¿‡ä»…25Kå›¾åƒçš„10ä¸ªè®­ç»ƒå‘¨æœŸåï¼Œæœ€ä½³æ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„AUROCè¾¾åˆ°äº†0.864 [AUROC](https://lightning.ai/docs/metrics/stable/classification/auroc.html)ã€‚
- en: You can download the model from this S3 [link](https://bentoml-ts.s3.eu-west-3.amazonaws.com/ts_model.pt)
    and check out the code on [Github](https://github.com/ahmedbesbes/face-attributes-bentoml).
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥ä»è¿™ä¸ªS3 [é“¾æ¥](https://bentoml-ts.s3.eu-west-3.amazonaws.com/ts_model.pt)ä¸‹è½½æ¨¡å‹ï¼Œå¹¶åœ¨[Github](https://github.com/ahmedbesbes/face-attributes-bentoml)æŸ¥çœ‹ä»£ç ã€‚
- en: 2 â€” Convert the Pytorch Lightning model to TorchScript ğŸŒ¬
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2 â€” å°†Pytorch Lightningæ¨¡å‹è½¬æ¢ä¸ºTorchScript ğŸŒ¬
- en: This section will discuss TorchScript benefits over PyTorch (or Lightning) and
    show how the conversion is done.
  id: totrans-69
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æœ¬èŠ‚å°†è®¨è®ºTorchScriptç›¸å¯¹äºPyTorchï¼ˆæˆ–Lightningï¼‰çš„å¥½å¤„ï¼Œå¹¶å±•ç¤ºè½¬æ¢çš„è¿‡ç¨‹ã€‚
- en: TorchScript is a feature in PyTorch that allows you to serialize your PyTorch
    models and run them in various environments. It provides a way to save a trained
    PyTorch model and load it into a Python-free environment or even on different
    hardware such as GPUs, FPGAs, or mobile devices.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: TorchScriptæ˜¯PyTorchä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå…è®¸ä½ åºåˆ—åŒ–ä½ çš„PyTorchæ¨¡å‹ï¼Œå¹¶åœ¨å„ç§ç¯å¢ƒä¸­è¿è¡Œå®ƒä»¬ã€‚å®ƒæä¾›äº†ä¸€ç§ä¿å­˜è®­ç»ƒå¥½çš„PyTorchæ¨¡å‹å¹¶å°†å…¶åŠ è½½åˆ°æ— Pythonç¯å¢ƒä¸­ï¼Œç”šè‡³åœ¨ä¸åŒçš„ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œå¦‚GPUã€FPGAæˆ–ç§»åŠ¨è®¾å¤‡ã€‚
- en: 'This has several advantages over PyTorch:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç›¸å¯¹äºPyTorchæœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š
- en: '**Portability**: With TorchScript, you can run your PyTorch models in any environment
    that supports the TorchScript runtime, regardless of the platform or language.'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**ä¾¿æºæ€§**ï¼šä½¿ç”¨TorchScriptï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æ”¯æŒTorchScriptè¿è¡Œæ—¶çš„ç¯å¢ƒä¸­è¿è¡Œä½ çš„PyTorchæ¨¡å‹ï¼Œæ— è®ºå¹³å°æˆ–è¯­è¨€å¦‚ä½•ã€‚'
- en: '**Performance**: TorchScript can optimize your PyTorch model for faster execution
    by fusing operations and eliminating unused operations. This can result in significant
    speedups, especially on devices with limited resources such as mobile phones.'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**æ€§èƒ½**ï¼šTorchScriptå¯ä»¥é€šè¿‡èåˆæ“ä½œå’Œæ¶ˆé™¤æœªä½¿ç”¨çš„æ“ä½œæ¥ä¼˜åŒ–ä½ çš„PyTorchæ¨¡å‹ï¼Œä»¥å®ç°æ›´å¿«çš„æ‰§è¡Œã€‚è¿™å¯ä»¥å¸¦æ¥æ˜¾è‘—çš„åŠ é€Ÿï¼Œç‰¹åˆ«æ˜¯åœ¨èµ„æºæœ‰é™çš„è®¾å¤‡ä¸Šï¼Œå¦‚æ‰‹æœºã€‚'
- en: '**Security**: By deploying TorchScript models, you can protect your PyTorch
    code and models from being reverse-engineered or tampered with.'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**å®‰å…¨æ€§**ï¼šé€šè¿‡éƒ¨ç½²TorchScriptæ¨¡å‹ï¼Œä½ å¯ä»¥ä¿æŠ¤ä½ çš„PyTorchä»£ç å’Œæ¨¡å‹ä¸è¢«é€†å‘å·¥ç¨‹æˆ–ç¯¡æ”¹ã€‚'
- en: '**Ease of deployment**: With TorchScript, you can easily deploy your PyTorch
    models to production without requiring a Python environment.'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**éƒ¨ç½²ç®€ä¾¿æ€§**ï¼šä½¿ç”¨TorchScriptï¼Œä½ å¯ä»¥è½»æ¾åœ°å°†PyTorchæ¨¡å‹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè€Œæ— éœ€Pythonç¯å¢ƒã€‚'
- en: For a more comprehensive overview of TorchScript, I recommend you go through
    this [tutorial](/pytorch-jit-and-torchscript-c2a77bac0fff).
  id: totrans-76
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å¯¹äºTorchScriptçš„æ›´å…¨é¢æ¦‚è¿°ï¼Œæˆ‘æ¨èä½ æŸ¥çœ‹è¿™ä¸ª[æ•™ç¨‹](/pytorch-jit-and-torchscript-c2a77bac0fff)ã€‚
- en: You can easily convert a Lightning Module to TorchScript by calling the `to_torchscript`
    method.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥é€šè¿‡è°ƒç”¨`to_torchscript`æ–¹æ³•è½»æ¾åœ°å°†Lightningæ¨¡å—è½¬æ¢ä¸ºTorchScriptã€‚
- en: '[PRE7]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: After running some tests, I found that the inference time on GPU using TorchScript
    was 2 times lower than the inference time of PyTorch Lightning. However, this
    only happens for small batches (1 or 2 as per my tests)
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: ç»è¿‡ä¸€äº›æµ‹è¯•ï¼Œæˆ‘å‘ç°ä½¿ç”¨ TorchScript çš„ GPU æ¨ç†æ—¶é—´æ¯” PyTorch Lightning çš„æ¨ç†æ—¶é—´ä½ 2 å€ã€‚ç„¶è€Œï¼Œè¿™ä»…å‘ç”Ÿåœ¨å°æ‰¹é‡ï¼ˆæ ¹æ®æˆ‘çš„æµ‹è¯•ï¼Œ1
    æˆ– 2 ä¸ªæ ·æœ¬ï¼‰æ—¶ã€‚
- en: '**In any case, if you want to enjoy the benefits of TorchScript, you need to
    run your model outside of a Python runtime.**'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '**æ— è®ºå¦‚ä½•ï¼Œå¦‚æœä½ æƒ³äº«å— TorchScript çš„å¥½å¤„ï¼Œä½ éœ€è¦åœ¨ Python è¿è¡Œæ—¶ä¹‹å¤–è¿è¡Œä½ çš„æ¨¡å‹ã€‚**'
- en: 3 â€” Build an image classification service with BentoML + TorchScript ğŸ±
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 3 â€” ä½¿ç”¨ BentoML + TorchScript ğŸ± æ„å»ºä¸€ä¸ªå›¾åƒåˆ†ç±»æœåŠ¡
- en: In this section, we will build a BentoML service and run it locally to serve
    the TorchScript model.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ª BentoML æœåŠ¡å¹¶åœ¨æœ¬åœ°è¿è¡Œï¼Œä»¥æœåŠ¡äº TorchScript æ¨¡å‹ã€‚
- en: If you want to follow along, I recommend you install the projectâ€™s dependencies
    using Poetry.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æƒ³è·Ÿéšæœ¬æ•™ç¨‹ï¼Œæˆ‘å»ºè®®ä½ ä½¿ç”¨ Poetry å®‰è£…é¡¹ç›®çš„ä¾èµ–é¡¹ã€‚
- en: '[PRE8]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'You need to download the model from S3:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ éœ€è¦ä» S3 ä¸‹è½½æ¨¡å‹ï¼š
- en: '[PRE9]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Now, we can save the TorchScript model locally using the BentoML API. This will
    automatically provide a tag for versioning and will allow you to easily load the
    model as a runner later on.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ BentoML API å°† TorchScript æ¨¡å‹æœ¬åœ°ä¿å­˜ã€‚è¿™å°†è‡ªåŠ¨æä¾›ä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾ï¼Œå¹¶å…è®¸ä½ ç¨åè½»æ¾åœ°å°†æ¨¡å‹åŠ è½½ä¸ºè¿è¡Œå™¨ã€‚
- en: BentoML integrates well with TorchScript so you can save the model by calling
    the **bentoml.torchscript.save_model** method.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: BentoML ä¸ TorchScript é›†æˆè‰¯å¥½ï¼Œå› æ­¤ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ **bentoml.torchscript.save_model** æ–¹æ³•æ¥ä¿å­˜æ¨¡å‹ã€‚
- en: More info [here](https://docs.bentoml.org/en/latest/reference/frameworks/torchscript.html).
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: æ›´å¤šä¿¡æ¯ [here](https://docs.bentoml.org/en/latest/reference/frameworks/torchscript.html)ã€‚
- en: '[PRE10]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: You can check that the model has been saved with a unique identifier by running
    `**bentoml models list**`.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥é€šè¿‡è¿è¡Œ `**bentoml models list**` æ¥æ£€æŸ¥æ¨¡å‹æ˜¯å¦å·²ç»ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç¬¦ä¿å­˜ã€‚
- en: '![](../Images/1308db90a0ec0ba4f67e44dde99a5a78.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/1308db90a0ec0ba4f67e44dde99a5a78.png)'
- en: Image by the author
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: Now that the model is saved with BentoML API, we can create a service.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æ¨¡å‹å·²ç»ä½¿ç”¨ BentoML API ä¿å­˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæœåŠ¡ã€‚
- en: 'We first import the dependencies, load the model, get a runner from it, and
    define a service:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆæˆ‘ä»¬å¯¼å…¥ä¾èµ–é¡¹ï¼ŒåŠ è½½æ¨¡å‹ï¼Œä»ä¸­è·å–ä¸€ä¸ªè¿è¡Œå™¨ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªæœåŠ¡ï¼š
- en: '[PRE11]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Then, we define an API route that takes an image as input and returns a JSON
    as output with the predicted labels and the corresponding probabilities.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª API è·¯ç”±ï¼Œè¯¥è·¯ç”±ä»¥å›¾åƒä½œä¸ºè¾“å…¥ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«é¢„æµ‹æ ‡ç­¾å’Œç›¸åº”æ¦‚ç‡çš„ JSON ä½œä¸ºè¾“å‡ºã€‚
- en: '[PRE12]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'To launch the service locally, run the following command:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: è¦åœ¨æœ¬åœ°å¯åŠ¨æœåŠ¡ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
- en: '[PRE13]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![](../Images/10673f7782dab9ac0e40a54a8b51a781.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/10673f7782dab9ac0e40a54a8b51a781.png)'
- en: Image by the author
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: If you want to try out the API, visit the Swagger UI (at http://localhost:3000)
    and upload your image directly.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æƒ³å°è¯•è¿™ä¸ª APIï¼Œå¯ä»¥è®¿é—® Swagger UIï¼ˆåœ¨ http://localhost:3000ï¼‰å¹¶ç›´æ¥ä¸Šä¼ ä½ çš„å›¾ç‰‡ã€‚
- en: Hereâ€™s an example.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ã€‚
- en: '![](../Images/85f1af3109eab9be40f447f7b7a3a92f.png)![](../Images/18fb9cd72b11e7201db2cceb437072fd.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/85f1af3109eab9be40f447f7b7a3a92f.png)![](../Images/18fb9cd72b11e7201db2cceb437072fd.png)'
- en: Demo
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: æ¼”ç¤º
- en: 4 â€” Deploy the service to the cloud
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 4 â€” å°†æœåŠ¡éƒ¨ç½²åˆ°äº‘ç«¯
- en: In this section, weâ€™ll build a bento and deploy it to a cloud platform thatâ€™s
    specifically designed to host it and scale it.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ª bento å¹¶å°†å…¶éƒ¨ç½²åˆ°ä¸“é—¨è®¾è®¡ç”¨äºæ‰˜ç®¡å’Œæ‰©å±•çš„äº‘å¹³å°ä¸Šã€‚
- en: '**what is a bento?**'
  id: totrans-109
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**ä»€ä¹ˆæ˜¯ bentoï¼Ÿ**'
- en: ''
  id: totrans-110
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: BentoML packages everything you need in an ML project into a distribution format
    called a ***bento*** ğŸ±(this is where the analogy makes sense, as a *bento* is
    originally a Japanese lunch box that holds a single portion meal consisting of
    a main dish and some sides)
  id: totrans-111
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: BentoML å°† ML é¡¹ç›®ä¸­æ‰€éœ€çš„ä¸€åˆ‡æ‰“åŒ…æˆä¸€ç§å«åš ***bento*** ğŸ±çš„åˆ†å‘æ ¼å¼ï¼ˆè¿™é‡Œçš„ç±»æ¯”æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸º *bento* åŸæœ¬æ˜¯ä¸€ä¸ªæ—¥æœ¬çš„ä¾¿å½“ç›’ï¼Œé‡Œé¢è£…æœ‰ä¸€ä»½ä¸»è¦èœè‚´å’Œä¸€äº›é…èœï¼‰
- en: When a bento is built, you can deploy it to any cloud infrastructure.
  id: totrans-112
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å½“ä¸€ä¸ª bento æ„å»ºå®Œæˆåï¼Œä½ å¯ä»¥å°†å…¶éƒ¨ç½²åˆ°ä»»ä½•äº‘åŸºç¡€è®¾æ–½ä¸Šã€‚
- en: ğŸ‘‰ Build the bento
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ğŸ‘‰ æ„å»º bento
- en: To build a bento, you must first provide a configuration file called `bentofile.yaml`
    that tells how the bento must be built i.e what files should be included in it
    and what python dependencies are needed.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: è¦æ„å»ºä¸€ä¸ª bentoï¼Œä½ å¿…é¡»é¦–å…ˆæä¾›ä¸€ä¸ªåä¸º `bentofile.yaml` çš„é…ç½®æ–‡ä»¶ï¼Œè¯´æ˜ bento åº”å¦‚ä½•æ„å»ºï¼Œå³è¦åŒ…å«å“ªäº›æ–‡ä»¶å’Œæ‰€éœ€çš„ python
    ä¾èµ–é¡¹ã€‚
- en: '[PRE14]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Running the following command will build the bento.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†æ„å»º bentoã€‚
- en: '[PRE15]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](../Images/0c346944701d58d3977879b38e8f893f.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/0c346944701d58d3977879b38e8f893f.png)'
- en: Image by the author
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: ğŸ‘‰ Connect to BentoCloud and push the bento
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ğŸ‘‰ è¿æ¥åˆ° BentoCloud å¹¶æ¨é€ bento
- en: Before pushing the bento, you need to make sure youâ€™re logged in to a cloud
    platform that acts as a remote registry (something like Dockerhub for containers).
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ¨é€ bento ä¹‹å‰ï¼Œä½ éœ€è¦ç¡®ä¿ä½ å·²ç»ç™»å½•åˆ°ä¸€ä¸ªä½œä¸ºè¿œç¨‹æ³¨å†Œè¡¨çš„äº‘å¹³å°ï¼ˆç±»ä¼¼äº Dockerhub è¿™æ ·çš„å®¹å™¨å¹³å°ï¼‰ã€‚
- en: I was lucky enough that the BentoML team provided me with access to their [platform](https://default.cloud.bentoml.com/)
    where they push and host bentos.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å¾ˆå¹¸è¿ï¼ŒBentoML å›¢é˜Ÿä¸ºæˆ‘æä¾›äº†ä»–ä»¬çš„ [å¹³å°](https://default.cloud.bentoml.com/) çš„è®¿é—®æƒé™ï¼Œåœ¨é‚£é‡Œä»–ä»¬æ¨é€å’Œæ‰˜ç®¡
    bentosã€‚
- en: Want to create an account on BentoCloud and start deploying awesome models?
    Check out this [link](https://www.bentoml.com/bento-cloud/) to schedule a demo
    and talk to the BentoML team.
  id: totrans-123
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æƒ³åœ¨ BentoCloud ä¸Šåˆ›å»ºä¸€ä¸ªè´¦æˆ·å¹¶å¼€å§‹éƒ¨ç½²ç²¾å½©çš„æ¨¡å‹å—ï¼Ÿè¯·æŸ¥çœ‹è¿™ä¸ª [é“¾æ¥](https://www.bentoml.com/bento-cloud/)
    æ¥å®‰æ’æ¼”ç¤ºå¹¶ä¸ BentoML å›¢é˜Ÿè¿›è¡Œäº¤æµã€‚
- en: After signing up to BentoCloud, I was able to generate API tokens and log in
    using the `yatai` command. (*weâ€™ll see what Yatai is exactly in the last section
    of the post)*
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 'æ³¨å†Œ BentoCloud åï¼Œæˆ‘èƒ½å¤Ÿç”Ÿæˆ API ä»¤ç‰Œå¹¶ä½¿ç”¨ `yatai` å‘½ä»¤ç™»å½•ã€‚ (*æˆ‘ä»¬å°†åœ¨æœ¬æ–‡çš„æœ€åä¸€éƒ¨åˆ†ä¸­è¯¦ç»†äº†è§£ Yatai çš„å…·ä½“æƒ…å†µ*) '
- en: '[PRE16]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![](../Images/0903b427eb3a8de6f4e7546219c87c43.png)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/0903b427eb3a8de6f4e7546219c87c43.png)'
- en: Logging in to BentoCloud
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: ç™»å½• BentoCloud
- en: 'Once logged in, you can push: this will upload your **bento** and the underlying
    **model** simultaneously to the cloud.'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: ç™»å½•åï¼Œä½ å¯ä»¥æ¨é€ï¼šè¿™å°†åŒæ—¶å°†ä½ çš„ **bento** å’ŒåŸºç¡€çš„ **æ¨¡å‹** ä¸Šä¼ åˆ°äº‘ç«¯ã€‚
- en: '[PRE17]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![](../Images/152cbab52fbc7f071a868063d16e756d.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/152cbab52fbc7f071a868063d16e756d.png)'
- en: Pushing my first bento
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: æ¨é€æˆ‘çš„ç¬¬ä¸€ä¸ª bento
- en: You can check that these two artifacts are visible on the interface, along with
    other bentos and models (from other users)
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥æ£€æŸ¥è¿™ä¸¤ä¸ªå·¥ä»¶æ˜¯å¦åœ¨ç•Œé¢ä¸Šå¯è§ï¼Œè¿åŒå…¶ä»– bentos å’Œæ¨¡å‹ï¼ˆæ¥è‡ªå…¶ä»–ç”¨æˆ·ï¼‰
- en: '![](../Images/0814a55f6b3c42dd5cd895ba002158f6.png)![](../Images/fb0a670457ba7f931ffdf47c0bce791e.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/0814a55f6b3c42dd5cd895ba002158f6.png)![](../Images/fb0a670457ba7f931ffdf47c0bce791e.png)'
- en: the bento and the model
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: bento å’Œæ¨¡å‹
- en: ğŸ‘‰ Create a deployment
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ğŸ‘‰ åˆ›å»ºéƒ¨ç½²
- en: Deploying your bento from the platform is very simple. Head over to the Deployments
    tab and click on the top right black **Create** button.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: ä»å¹³å°éƒ¨ç½²ä½ çš„ bento éå¸¸ç®€å•ã€‚å‰å¾€éƒ¨ç½²é€‰é¡¹å¡ï¼Œç‚¹å‡»å³ä¸Šè§’çš„é»‘è‰² **åˆ›å»º** æŒ‰é’®ã€‚
- en: '![](../Images/7c41ada79e9c7ddc44a97b01cc87ec1f.png)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7c41ada79e9c7ddc44a97b01cc87ec1f.png)'
- en: Image by the author
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: 'This will open up the following form where you need to fill in the deployment
    information:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°†æ‰“å¼€ä»¥ä¸‹è¡¨å•ï¼Œä½ éœ€è¦å¡«å†™éƒ¨ç½²ä¿¡æ¯ï¼š
- en: '**The cluster information and the deployment name**'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**é›†ç¾¤ä¿¡æ¯å’Œéƒ¨ç½²åç§°**'
- en: '![](../Images/2b9136dfb15c86c8fed2175ff0c0f7d1.png)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2b9136dfb15c86c8fed2175ff0c0f7d1.png)'
- en: Image by the author
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: '**The bento repository and the version**'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**bento å­˜å‚¨åº“åŠå…¶ç‰ˆæœ¬**'
- en: '![](../Images/bb31da335e8ee3ded50cee65f1336758.png)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/bb31da335e8ee3ded50cee65f1336758.png)'
- en: Image by the author
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: '**Configurations for the API server: number of replicas, CPU, and memory requests**'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**API æœåŠ¡å™¨çš„é…ç½®ï¼šå‰¯æœ¬æ•°é‡ã€CPU å’Œå†…å­˜è¯·æ±‚**'
- en: '![](../Images/819afa1a457ad5a190738bef214236cb.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/819afa1a457ad5a190738bef214236cb.png)'
- en: Image by the author
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: '**Configuration for each runner: thereâ€™s only one in our case**'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**æ¯ä¸ªè¿è¡Œç¨‹åºçš„é…ç½®ï¼šåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­åªæœ‰ä¸€ä¸ª**'
- en: '![](../Images/26e4f5d55318af30ae6767b82ecc26e9.png)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/26e4f5d55318af30ae6767b82ecc26e9.png)'
- en: Image by the author
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: Once you hit the **Submit** button, you can start the deployment. This will
    build the image and deploy the API server and the runners on separate pods. **This
    is a killer feature that separates BentoML from any serving platform Iâ€™ve used
    before.**
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦ç‚¹å‡» **æäº¤** æŒ‰é’®ï¼Œä½ å¯ä»¥å¼€å§‹éƒ¨ç½²ã€‚è¿™å°†æ„å»ºé•œåƒå¹¶åœ¨å•ç‹¬çš„ Pod ä¸Šéƒ¨ç½² API æœåŠ¡å™¨å’Œè¿è¡Œç¨‹åºã€‚**è¿™æ˜¯ä¸€ä¸ªä½¿ BentoML ä¸æˆ‘ä¹‹å‰ä½¿ç”¨çš„ä»»ä½•æœåŠ¡å¹³å°åŒºåˆ†å¼€çš„æ€æ‰‹çº§ç‰¹æ€§ã€‚**
- en: '![](../Images/79466e715e49f1f46edf877143a8480c.png)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/79466e715e49f1f46edf877143a8480c.png)'
- en: Image by the author
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: 'Once your bento is successfully deployed, click on your deployment, then on
    the URL:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦ä½ çš„ bento æˆåŠŸéƒ¨ç½²ï¼Œç‚¹å‡»ä½ çš„éƒ¨ç½²ï¼Œç„¶åç‚¹å‡» URLï¼š
- en: '![](../Images/0d4602dc41a74aa5ff647c88fbec0844.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/0d4602dc41a74aa5ff647c88fbec0844.png)'
- en: 'If everything works as expected, opening this URL in the browser will lead
    you to this:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä¸€åˆ‡æŒ‰é¢„æœŸå·¥ä½œï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ­¤ URL å°†ä¼šå¸¦ä½ åˆ°è¿™ä¸ªé¡µé¢ï¼š
- en: '![](../Images/987e5bf21635aaeaa84549e05302b3df.png)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/987e5bf21635aaeaa84549e05302b3df.png)'
- en: 'The API is now deployed: you can query it from everywhere on the internet.'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: API ç°åœ¨å·²ç»éƒ¨ç½²ï¼šä½ å¯ä»¥ä»äº’è”ç½‘ä¸Šçš„ä»»ä½•åœ°æ–¹æŸ¥è¯¢å®ƒã€‚
- en: Need to manage your bentos on your own infrastructure? Try Yatai
  id: totrans-160
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: éœ€è¦åœ¨è‡ªå·±çš„åŸºç¡€è®¾æ–½ä¸Šç®¡ç†ä½ çš„ bentos å—ï¼Ÿè¯•è¯• Yatai
- en: You can replicate the BentoCloud platform on your own cloud infrastructure thanks
    to the [Yatai](https://github.com/bentoml/Yatai) project that the BentoML team
    open-sourced.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥é€šè¿‡ BentoML å›¢é˜Ÿå¼€æºçš„ [Yatai](https://github.com/bentoml/Yatai) é¡¹ç›®åœ¨ä½ è‡ªå·±çš„äº‘åŸºç¡€è®¾æ–½ä¸Šå¤åˆ¶
    BentoCloud å¹³å°ã€‚
- en: '![](../Images/f86f6feb8ad7b0e333465938d3915e03.png)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f86f6feb8ad7b0e333465938d3915e03.png)'
- en: 'source: [https://github.com/bentoml/Yatai](https://github.com/bentoml/Yatai)'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 'æ¥æº: [https://github.com/bentoml/Yatai](https://github.com/bentoml/Yatai)'
- en: Yatai acts as a centralized registry that you can deploy to any Kebernetes-native
    environment.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: Yatai ä½œä¸ºä¸€ä¸ªé›†ä¸­å¼æ³¨å†Œè¡¨ï¼Œä½ å¯ä»¥å°†å…¶éƒ¨ç½²åˆ°ä»»ä½•KubernetesåŸç”Ÿç¯å¢ƒä¸­ã€‚
- en: Itâ€™s compatible with all major cloud platforms (AWS, Azure, and GCP),
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒä¸æ‰€æœ‰ä¸»è¦äº‘å¹³å°ï¼ˆAWSã€Azure å’Œ GCPï¼‰å…¼å®¹ã€‚
- en: It helps you manage the deployment lifecycle to deploy, update, or roll back
    via API or Web UI.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒå¸®åŠ©ä½ ç®¡ç†éƒ¨ç½²ç”Ÿå‘½å‘¨æœŸï¼Œé€šè¿‡APIæˆ–Web UIè¿›è¡Œéƒ¨ç½²ã€æ›´æ–°æˆ–å›æ»šã€‚
- en: Conclusion ğŸ”š
  id: totrans-167
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç»“è®º ğŸ”š
- en: If youâ€™ve made it this far, I thank you for your time and hope youâ€™ve enjoyed
    learning about PyTorch Lightning, TorchScript, and BentoML.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ è¯»åˆ°è¿™é‡Œï¼Œæˆ‘æ„Ÿè°¢ä½ çš„æ—¶é—´ï¼Œå¹¶å¸Œæœ›ä½ å–œæ¬¢äº†è§£PyTorch Lightningã€TorchScriptå’ŒBentoMLã€‚
- en: Combined together, these three tools help you prototype and deploy industrial-grade
    deep learning models with the best-in-class DevOps practices.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: å°†è¿™ä¸‰ç§å·¥å…·ç»“åˆèµ·æ¥ï¼Œå¸®åŠ©ä½ ä½¿ç”¨æœ€ä½³å®è·µçš„DevOpsæ–¹æ³•æ¥åŸå‹è®¾è®¡å’Œéƒ¨ç½²å·¥ä¸šçº§æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚
- en: 'Of course, thereâ€™s room for improvement in the different steps of the workflow
    Iâ€™ve shown: I just hope this post was a good starter to dive into MLOps.'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œæˆ‘å±•ç¤ºçš„å·¥ä½œæµä¸­çš„ä¸åŒæ­¥éª¤è¿˜æœ‰æ”¹è¿›çš„ç©ºé—´ï¼šæˆ‘åªæ˜¯å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿä½œä¸ºä¸€ä¸ªå¥½çš„èµ·ç‚¹ï¼Œå¸®åŠ©ä½ æ·±å…¥äº†è§£MLOpsã€‚
- en: Resources ğŸ—
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: èµ„æº ğŸ—
- en: '[https://towardsdatascience.com/10-ways-bentoml-can-help-you-serve-and-scale-machine-learning-models-4060f1e59d0d](/10-ways-bentoml-can-help-you-serve-and-scale-machine-learning-models-4060f1e59d0d)'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://towardsdatascience.com/10-ways-bentoml-can-help-you-serve-and-scale-machine-learning-models-4060f1e59d0d](/10-ways-bentoml-can-help-you-serve-and-scale-machine-learning-models-4060f1e59d0d)'
- en: '[https://towardsdatascience.com/10-ways-bentoml-can-help-you-serve-and-scale-machine-learning-models-4060f1e59d0d](/10-ways-bentoml-can-help-you-serve-and-scale-machine-learning-models-4060f1e59d0d)'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://towardsdatascience.com/10-ways-bentoml-can-help-you-serve-and-scale-machine-learning-models-4060f1e59d0d](/10-ways-bentoml-can-help-you-serve-and-scale-machine-learning-models-4060f1e59d0d)'
- en: '[https://youtu.be/Dk88zv1KYMI](https://youtu.be/Dk88zv1KYMI)'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://youtu.be/Dk88zv1KYMI](https://youtu.be/Dk88zv1KYMI)'
- en: '[https://youtu.be/2awmrMRf0dA](https://youtu.be/2awmrMRf0dA)'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://youtu.be/2awmrMRf0dA](https://youtu.be/2awmrMRf0dA)'
- en: New to Medium? You can subscribe for $5 per month and unlock unlimited articles
    on various topics (tech, design, entrepreneurshipâ€¦) You can support me by clicking
    on my referral [link](https://ahmedbesbes.medium.com/membership)
  id: totrans-176
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¯¹Mediumä¸ç†Ÿæ‚‰ï¼Ÿä½ å¯ä»¥æ¯æœˆæ”¯ä»˜5ç¾å…ƒè®¢é˜…ï¼Œè§£é”å„ç§è¯é¢˜çš„æ— é™æ–‡ç« ï¼ˆç§‘æŠ€ã€è®¾è®¡ã€åˆ›ä¸šâ€¦â€¦ï¼‰ä½ å¯ä»¥é€šè¿‡ç‚¹å‡»æˆ‘çš„æ¨è[é“¾æ¥](https://ahmedbesbes.medium.com/membership)æ¥æ”¯æŒæˆ‘ã€‚
- en: '[](https://ahmedbesbes.medium.com/membership?source=post_page-----f61136fd0244--------------------------------)
    [## Join Medium with my referral link - Ahmed Besbes'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://ahmedbesbes.medium.com/membership?source=post_page-----f61136fd0244--------------------------------)
    [## ä½¿ç”¨æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥Medium - Ahmed Besbes'
- en: Read every story from Ahmed Besbes (and thousands of other writers on Medium).
    Your membership fee directly supportsâ€¦
  id: totrans-178
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: é˜…è¯»Ahmed Besbesï¼ˆä»¥åŠMediumä¸Šæˆåƒä¸Šä¸‡çš„å…¶ä»–ä½œè€…ï¼‰çš„æ¯ä¸€ä¸ªæ•…äº‹ã€‚ä½ çš„ä¼šå‘˜è´¹ç”¨ç›´æ¥æ”¯æŒâ€¦â€¦
- en: ahmedbesbes.medium.com](https://ahmedbesbes.medium.com/membership?source=post_page-----f61136fd0244--------------------------------)
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: '[ahmedbesbes.medium.com](https://ahmedbesbes.medium.com/membership?source=post_page-----f61136fd0244--------------------------------)'
