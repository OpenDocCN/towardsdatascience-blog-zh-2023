- en: How to Skip Tasks in Airflow DAGs
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¦‚ä½•åœ¨ Airflow DAGs ä¸­è·³è¿‡ä»»åŠ¡
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/airflow-skip-task-a5a6ab319378](https://towardsdatascience.com/airflow-skip-task-a5a6ab319378)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/airflow-skip-task-a5a6ab319378](https://towardsdatascience.com/airflow-skip-task-a5a6ab319378)
- en: Skipping tasks in Airflow DAGs based on specific conditions
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ ¹æ®ç‰¹å®šæ¡ä»¶è·³è¿‡ Airflow DAGs ä¸­çš„ä»»åŠ¡
- en: '[](https://gmyrianthous.medium.com/?source=post_page-----a5a6ab319378--------------------------------)[![Giorgos
    Myrianthous](../Images/ff4b116e4fb9a095ce45eb064fde5af3.png)](https://gmyrianthous.medium.com/?source=post_page-----a5a6ab319378--------------------------------)[](https://towardsdatascience.com/?source=post_page-----a5a6ab319378--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----a5a6ab319378--------------------------------)
    [Giorgos Myrianthous](https://gmyrianthous.medium.com/?source=post_page-----a5a6ab319378--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://gmyrianthous.medium.com/?source=post_page-----a5a6ab319378--------------------------------)[![Giorgos
    Myrianthous](../Images/ff4b116e4fb9a095ce45eb064fde5af3.png)](https://gmyrianthous.medium.com/?source=post_page-----a5a6ab319378--------------------------------)[](https://towardsdatascience.com/?source=post_page-----a5a6ab319378--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----a5a6ab319378--------------------------------)
    [Giorgos Myrianthous](https://gmyrianthous.medium.com/?source=post_page-----a5a6ab319378--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----a5a6ab319378--------------------------------)
    Â·9 min readÂ·Feb 8, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----a5a6ab319378--------------------------------)
    Â·9åˆ†é’Ÿé˜…è¯»Â·2023å¹´2æœˆ8æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/881b8b4f1e7bf014f76b61f5f78e7900.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/881b8b4f1e7bf014f76b61f5f78e7900.png)'
- en: Photo by [Hello Iâ€™m Nik](https://unsplash.com/@helloimnik?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/l4ADb9OVqTY?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”± [Hello Iâ€™m Nik](https://unsplash.com/@helloimnik?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    æä¾›ï¼Œæ¥æºäº [Unsplash](https://unsplash.com/photos/l4ADb9OVqTY?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
- en: Recently, I was attempting to add a new task in an existing Airflow DAG that
    would only run on specific days of the week. However, I was surprised to find
    that skipping tasks in Airflow isnâ€™t as straightforward as I anticipated.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€è¿‘ï¼Œæˆ‘å°è¯•åœ¨ç°æœ‰çš„ Airflow DAG ä¸­æ·»åŠ ä¸€ä¸ªä»…åœ¨ç‰¹å®šæ˜ŸæœŸå‡ è¿è¡Œçš„æ–°ä»»åŠ¡ã€‚ç„¶è€Œï¼Œæˆ‘æƒŠè®¶åœ°å‘ç°ï¼Œåœ¨ Airflow ä¸­è·³è¿‡ä»»åŠ¡å¹¶ä¸åƒæˆ‘é¢„æœŸçš„é‚£æ ·ç®€å•ã€‚
- en: In this article, I will demonstrate how to skip tasks in Airflow DAGs, specifically
    focusing on the use of `AirflowSkipException` when working with `PythonOperator`
    or Operators that inherit from built-in operators (such as `TriggerDagRunOperator`).
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†æ¼”ç¤ºå¦‚ä½•åœ¨ Airflow DAGs ä¸­è·³è¿‡ä»»åŠ¡ï¼Œç‰¹åˆ«æ˜¯ä¸“æ³¨äºåœ¨ä½¿ç”¨ `PythonOperator` æˆ–ç»§æ‰¿è‡ªå†…ç½®æ“ä½œç¬¦çš„æ“ä½œç¬¦ï¼ˆå¦‚ `TriggerDagRunOperator`ï¼‰æ—¶ä½¿ç”¨
    `AirflowSkipException`ã€‚
- en: Lastly, I will discuss the use of `BranchPythonOperator` and `ShortCircuitOperator`
    and how then can potentially be used to decide when a tasks needs to be skipped.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œæˆ‘å°†è®¨è®º `BranchPythonOperator` å’Œ `ShortCircuitOperator` çš„ä½¿ç”¨æ–¹å¼ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•æ½œåœ¨åœ°å†³å®šä½•æ—¶è·³è¿‡ä»»åŠ¡ã€‚
- en: '[](/run-airflow-docker-1b83a57616fb?source=post_page-----a5a6ab319378--------------------------------)
    [## How to Run Airflow Locally With Docker'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '[](/run-airflow-docker-1b83a57616fb?source=post_page-----a5a6ab319378--------------------------------)
    [## å¦‚ä½•åœ¨æœ¬åœ°ä½¿ç”¨ Docker è¿è¡Œ Airflow'
- en: A step by step guide for running Airflow with Docker on your local machine
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: æœ¬åœ°æœºå™¨ä¸Šä½¿ç”¨ Docker è¿è¡Œ Airflow çš„é€æ­¥æŒ‡å—
- en: towardsdatascience.com](/run-airflow-docker-1b83a57616fb?source=post_page-----a5a6ab319378--------------------------------)
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: towardsdatascience.com](/run-airflow-docker-1b83a57616fb?source=post_page-----a5a6ab319378--------------------------------)
- en: Now letâ€™s assume we have an Airlflow DAG consisting of three tasks
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªä»»åŠ¡çš„ Airflow DAG
- en: '![](../Images/35643715c6392e0bb7ec4e3b925a78b7.png)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/35643715c6392e0bb7ec4e3b925a78b7.png)'
- en: 'Example DAG consisting of three `` `PythonOperator` ta ``sks â€” Source: Author'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: åŒ…å«ä¸‰ä¸ª `` `PythonOperator` ta ``sks çš„ç¤ºä¾‹ DAG â€” æ¥æºï¼šä½œè€…
- en: '[PRE0]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Skipping PythonOperator tasks
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è·³è¿‡ PythonOperator ä»»åŠ¡
- en: The most intuitive way to skip tasks created via `PythonOperator` is to raise
    `[AirflowSkipException](https://airflow.apache.org/docs/apache-airflow/stable/_api/airflow/exceptions/index.html#airflow.exceptions.AirflowSkipException)`.
    This means `python_callable` function that gets executed via `PythonOperator`
    needs to implement the logic that decides when to raise exception.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: è·³è¿‡é€šè¿‡ `PythonOperator` åˆ›å»ºçš„ä»»åŠ¡çš„æœ€ç›´è§‚æ–¹æ³•æ˜¯æŠ›å‡º `[AirflowSkipException](https://airflow.apache.org/docs/apache-airflow/stable/_api/airflow/exceptions/index.html#airflow.exceptions.AirflowSkipException)`ã€‚è¿™æ„å‘³ç€é€šè¿‡
    `PythonOperator` æ‰§è¡Œçš„ `python_callable` å‡½æ•°éœ€è¦å®ç°å†³å®šä½•æ—¶æŠ›å‡ºå¼‚å¸¸çš„é€»è¾‘ã€‚
- en: Letâ€™s return to the example DAG we previously discussed and consider a scenario
    where task `task_b` must only run on Mondays of every week of the year.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å›åˆ°ä¹‹å‰è®¨è®ºçš„ç¤ºä¾‹DAGï¼Œå¹¶è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œå³`task_b`å¿…é¡»ä»…åœ¨æ¯å¹´çš„æ¯å‘¨å‘¨ä¸€è¿è¡Œã€‚
- en: '[PRE1]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: If DagRunâ€™s start date is not a Monday, then `task_b` will be skipped and appear
    in pink colour (that denotes skipped tasks as per the legend on the UI).
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœDagRunçš„å¼€å§‹æ—¥æœŸä¸æ˜¯å‘¨ä¸€ï¼Œåˆ™`task_b`å°†è¢«è·³è¿‡ï¼Œå¹¶ä»¥ç²‰çº¢è‰²æ˜¾ç¤ºï¼ˆè¿™è¡¨ç¤ºUIä¸­çš„è·³è¿‡ä»»åŠ¡ï¼‰ã€‚
- en: '![](../Images/f85a539d002cd7a8e4b5d91b1a484b86.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f85a539d002cd7a8e4b5d91b1a484b86.png)'
- en: 'Skip condition is met, and trigger_rule for task_c is set to `none_failed`
    â€” Source: Author'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: æ»¡è¶³è·³è¿‡æ¡ä»¶ï¼Œ`task_c`çš„`trigger_rule`è®¾ç½®ä¸º`none_failed`â€”â€”æ¥æºï¼šä½œè€…
- en: Itâ€™s important to pay attention to the `'none_failed'` value provided to `trigger_rule`
    keyword argument of `third_task`. If we skip this configuration, then `task_c`
    will also be skipped whenever `task_b` is also skipped.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: é‡è¦çš„æ˜¯è¦æ³¨æ„ä¼ é€’ç»™`third_task`çš„`trigger_rule`å…³é”®å­—å‚æ•°çš„`'none_failed'`å€¼ã€‚å¦‚æœæˆ‘ä»¬è·³è¿‡æ­¤é…ç½®ï¼Œé‚£ä¹ˆæ¯å½“`task_b`ä¹Ÿè¢«è·³è¿‡æ—¶ï¼Œ`task_c`ä¹Ÿä¼šè¢«è·³è¿‡ã€‚
- en: '![](../Images/f599ccae951ef14922a5e1b87f00e0c4.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f599ccae951ef14922a5e1b87f00e0c4.png)'
- en: 'task_c is also skipped given that trigger_rule will get the default `all_success`
    value â€” Source: Author'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äº`trigger_rule`å°†å¾—åˆ°é»˜è®¤çš„`all_success`å€¼ï¼Œ`task_c`ä¹Ÿä¼šè¢«è·³è¿‡â€”â€”æ¥æºï¼šä½œè€…
- en: By default, `trigger_rule` is set to `all_success` which means that a task will
    be executed only if all of the upstream tasks are not skipped and are successful.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: é»˜è®¤æƒ…å†µä¸‹ï¼Œ`trigger_rule`è®¾ç½®ä¸º`all_success`ï¼Œè¿™æ„å‘³ç€åªæœ‰åœ¨æ‰€æœ‰ä¸Šæ¸¸ä»»åŠ¡æœªè¢«è·³è¿‡ä¸”æˆåŠŸçš„æƒ…å†µä¸‹ï¼Œä»»åŠ¡æ‰ä¼šè¢«æ‰§è¡Œã€‚
- en: 'If the DagRunâ€™s start date is a Monday, then `task_b` will be executed:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœDagRunçš„å¼€å§‹æ—¥æœŸæ˜¯å‘¨ä¸€ï¼Œé‚£ä¹ˆ`task_b`å°†è¢«æ‰§è¡Œï¼š
- en: '![](../Images/4dd4c9ee164db3dd8798a7b42d045061.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/4dd4c9ee164db3dd8798a7b42d045061.png)'
- en: 'Skip condition is not met â€” Source: Author'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: è·³è¿‡æ¡ä»¶ä¸æ»¡è¶³â€”â€”æ¥æºï¼šä½œè€…
- en: Skipping built-in Operator tasks
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è·³è¿‡å†…ç½®æ“ä½œç¬¦ä»»åŠ¡
- en: Now letâ€™s assume we have another DAG consisting of three tasks, including a
    `TriggerDagRunOperator` that is used to trigger another DAG.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: å‡è®¾æˆ‘ä»¬æœ‰å¦ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªä»»åŠ¡çš„DAGï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªç”¨äºè§¦å‘å¦ä¸€ä¸ªDAGçš„`TriggerDagRunOperator`ã€‚
- en: '[PRE2]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![](../Images/b660db5918493144b89bc94292256ca7.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b660db5918493144b89bc94292256ca7.png)'
- en: 'A DAG consisting of TriggerDagRunOperator â€” Source: Author'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€ä¸ªåŒ…å«TriggerDagRunOperatorçš„DAGâ€”â€”æ¥æºï¼šä½œè€…
- en: Now things are a bit more complicated if you are looking into skipping tasks
    created using built-in operators (or even custom ones that inherit from built-in
    operators). To do so, there are essentially a few different options we can consider.
    In this section, Iâ€™m going to provide all of them and itâ€™s up to you to pick the
    one that best suits your needs.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æ­£åœ¨è€ƒè™‘è·³è¿‡ä½¿ç”¨å†…ç½®æ“ä½œç¬¦ï¼ˆç”šè‡³ç»§æ‰¿è‡ªå†…ç½®æ“ä½œç¬¦çš„è‡ªå®šä¹‰æ“ä½œç¬¦ï¼‰åˆ›å»ºçš„ä»»åŠ¡ï¼Œé‚£ä¹ˆæƒ…å†µä¼šå¤æ‚ä¸€äº›ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å‡ ä¸ªä¸åŒçš„é€‰é¡¹ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘å°†æä¾›æ‰€æœ‰è¿™äº›é€‰é¡¹ï¼Œå…·ä½“é€‰æ‹©å“ªä¸ªæœ€é€‚åˆä½ çš„éœ€æ±‚ç”±ä½ å†³å®šã€‚
- en: The **first option** we have is `**BranchPythonOperator**` that is used to create
    a branching logic such that the DAG can take certain direction based on some conditional
    logic. Once again, letâ€™s assume that `trigger_other_dag` â€” that essentially uses
    a `TriggerDagRunOperator` to trigger another Airflow DAG â€” needs to be executed
    only on Mondays.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çš„**ç¬¬ä¸€ä¸ªé€‰é¡¹**æ˜¯ä½¿ç”¨`**BranchPythonOperator**`æ¥åˆ›å»ºåˆ†æ”¯é€»è¾‘ï¼Œä½¿DAGå¯ä»¥æ ¹æ®æŸäº›æ¡ä»¶é€»è¾‘é‡‡å–ç‰¹å®šæ–¹å‘ã€‚å†ä¸€æ¬¡ï¼Œå‡è®¾`trigger_other_dag`â€”â€”æœ¬è´¨ä¸Šä½¿ç”¨`TriggerDagRunOperator`æ¥è§¦å‘å¦ä¸€ä¸ªAirflow
    DAGâ€”â€”éœ€è¦ä»…åœ¨å‘¨ä¸€æ‰§è¡Œã€‚
- en: We can choose when to skip a task using a `BranchPythonOperator` with two branches
    and a callable that underlying branching logic.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦æœ‰ä¸¤ä¸ªåˆ†æ”¯çš„`BranchPythonOperator`å’Œä¸€ä¸ªåº•å±‚åˆ†æ”¯é€»è¾‘çš„å¯è°ƒç”¨å¯¹è±¡æ¥é€‰æ‹©ä½•æ—¶è·³è¿‡ä¸€ä¸ªä»»åŠ¡ã€‚
- en: '[PRE3]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Now letâ€™s go ahead and create the Airlfow Tasks.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨è®©æˆ‘ä»¬ç»§ç»­åˆ›å»ºAirflowä»»åŠ¡ã€‚
- en: '[PRE4]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](../Images/72bf570f1e7fa047ad8771b799638547.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/72bf570f1e7fa047ad8771b799638547.png)'
- en: 'Using `BranchPythonOperator` to decide when to skip a task â€” Source: Author'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨`BranchPythonOperator`æ¥å†³å®šä½•æ—¶è·³è¿‡ä»»åŠ¡â€”â€”æ¥æºï¼šä½œè€…
- en: 'Note that branch operators cannot have empty paths and thus weâ€™ve had to create
    a dummy task using `DummyOperator` and corresponds to skipping task. Whenever
    the trigger task needs to be skipped, then `skip` operator will be executed (not
    really..) instead:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œåˆ†æ”¯æ“ä½œç¬¦ä¸èƒ½æœ‰ç©ºè·¯å¾„ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¾—ä¸ä½¿ç”¨`DummyOperator`åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿä»»åŠ¡ï¼Œå¹¶å¯¹åº”äºè·³è¿‡ä»»åŠ¡ã€‚æ¯å½“éœ€è¦è·³è¿‡è§¦å‘ä»»åŠ¡æ—¶ï¼Œ`skip`æ“ä½œç¬¦å°†è¢«æ‰§è¡Œï¼ˆå®é™…ä¸Šå¹¶ä¸æ˜¯è¿™æ ·ï¼‰ï¼š
- en: '![](../Images/c010dafdb0c733246ca58229cb35cc59.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c010dafdb0c733246ca58229cb35cc59.png)'
- en: 'Skip `trigger_other_dag` taskâ€” Source: Author'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: è·³è¿‡`trigger_other_dag`ä»»åŠ¡â€”â€”æ¥æºï¼šä½œè€…
- en: The **second option** we have is to use `**ShortCircuitOperator**` in order
    to implement a conditional logic to decide when to skip a particular task.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çš„**ç¬¬äºŒä¸ªé€‰é¡¹**æ˜¯ä½¿ç”¨`**ShortCircuitOperator**`æ¥å®ç°æ¡ä»¶é€»è¾‘ï¼Œä»¥å†³å®šä½•æ—¶è·³è¿‡ç‰¹å®šä»»åŠ¡ã€‚
- en: The ShortCircuitOperator is derived from the PythonOperator and evaluates the
    result of a `python_callable`. If the returned result is `False` or a falsy value,
    the pipeline will be short-circuited. Downstream tasks will be marked with a state
    of â€œskippedâ€ based on the short-circuiting mode configured. If the returned result
    is `True` or a truthy value, downstream tasks proceed as normal and an `XCom`
    of the returned result is pushed.
  id: totrans-49
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ShortCircuitOperatorç»§æ‰¿è‡ªPythonOperatorï¼Œå¹¶è¯„ä¼°`python_callable`çš„ç»“æœã€‚å¦‚æœè¿”å›ç»“æœä¸º`False`æˆ–è™šå€¼ï¼Œç®¡é“å°†çŸ­è·¯ã€‚ä¸‹æ¸¸ä»»åŠ¡å°†æ ¹æ®é…ç½®çš„çŸ­è·¯æ¨¡å¼è¢«æ ‡è®°ä¸ºâ€œè·³è¿‡â€ã€‚å¦‚æœè¿”å›ç»“æœä¸º`True`æˆ–çœŸå€¼ï¼Œä¸‹æ¸¸ä»»åŠ¡å°†æ­£å¸¸è¿›è¡Œï¼Œå¹¶æ¨é€è¿”å›ç»“æœçš„`XCom`ã€‚
- en: ''
  id: totrans-50
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: â€” [Airflow Docs](https://airflow.apache.org/docs/apache-airflow/stable/_api/airflow/operators/python/index.html#airflow.operators.python.ShortCircuitOperator)
  id: totrans-51
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: â€” [Airflowæ–‡æ¡£](https://airflow.apache.org/docs/apache-airflow/stable/_api/airflow/operators/python/index.html#airflow.operators.python.ShortCircuitOperator)
- en: '[PRE5]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![](../Images/c211d468d0bb01050768e0204e7bb0dc.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c211d468d0bb01050768e0204e7bb0dc.png)'
- en: 'Skipping Airflow tasks uisng ShortCircuitOperator â€” Source: Author'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ShortCircuitOperatorè·³è¿‡Airflowä»»åŠ¡â€”æ¥æºï¼šä½œè€…
- en: Now if `is_monday()` evaluates to False Airflow will skip all downstream tasks.
    However, this is the default behaviour which means that if we want just one task
    to be skipped we also need to provide `ignore_downstream_trigger_rules=False`
    when creating an instance of `ShortCircuitOperator`. This configuration will then
    take into account the corresponding trigger rules for downstream tasks and decide
    which should still be skipped or executed (note the trigger rule in our last task
    `task_c`).
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œå¦‚æœ`is_monday()`çš„ç»“æœä¸ºFalseï¼ŒAirflowå°†è·³è¿‡æ‰€æœ‰ä¸‹æ¸¸ä»»åŠ¡ã€‚ç„¶è€Œï¼Œè¿™æ˜¯ä¸€ç§é»˜è®¤è¡Œä¸ºï¼Œè¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬åªæƒ³è·³è¿‡ä¸€ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨åˆ›å»º`ShortCircuitOperator`å®ä¾‹æ—¶æä¾›`ignore_downstream_trigger_rules=False`ã€‚è¿™ä¸ªé…ç½®å°†è€ƒè™‘ä¸‹æ¸¸ä»»åŠ¡çš„ç›¸åº”è§¦å‘è§„åˆ™ï¼Œå¹¶å†³å®šå“ªäº›ä»»åŠ¡ä»éœ€è·³è¿‡æˆ–æ‰§è¡Œï¼ˆæ³¨æ„æˆ‘ä»¬æœ€åä¸€ä¸ªä»»åŠ¡`task_c`ä¸­çš„è§¦å‘è§„åˆ™ï¼‰ã€‚
- en: '![](../Images/a0019eb7973e345834537ba5520efa4b.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a0019eb7973e345834537ba5520efa4b.png)'
- en: 'If `is_monday` ShortCircuitOperator returns False, then skip only â€” Source:
    Author'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœ`is_monday` ShortCircuitOperatorè¿”å›Falseï¼Œåˆ™åªè·³è¿‡â€”æ¥æºï¼šä½œè€…
- en: If the result from `python_callable` is `True` then downstream tasks will also
    be executed.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœ`python_callable`çš„ç»“æœä¸º`True`ï¼Œåˆ™ä¸‹æ¸¸ä»»åŠ¡ä¹Ÿå°†è¢«æ‰§è¡Œã€‚
- en: '![](../Images/3c74272f54778254e95ab149bb9087bb.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3c74272f54778254e95ab149bb9087bb.png)'
- en: 'If `is_monday` ShortCircuitOperator returns True, then all downstream tasks
    will be executed â€” Source: Author'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœ`is_monday` ShortCircuitOperatorè¿”å›Trueï¼Œåˆ™æ‰€æœ‰ä¸‹æ¸¸ä»»åŠ¡å°†è¢«æ‰§è¡Œâ€”æ¥æºï¼šä½œè€…
- en: Lastly, the **third option** involves the **implementation of a sub-class that
    inherits** from a built-in operator, such as `TriggerDagRunOperator`.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œ**ç¬¬ä¸‰ç§é€‰é¡¹**æ¶‰åŠåˆ°**å®ç°ä¸€ä¸ªä»å†…ç½®æ“ä½œç¬¦ç»§æ‰¿çš„å­ç±»**ï¼Œä¾‹å¦‚`TriggerDagRunOperator`ã€‚
- en: The following custom operator inhertis from the built-in `TriggerDagRunOperator`
    and takes an additional callable argument that will be used to decide whether
    an `AirflowSkipException` will be raised.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹è‡ªå®šä¹‰æ“ä½œç¬¦ç»§æ‰¿è‡ªå†…ç½®çš„`TriggerDagRunOperator`ï¼Œå¹¶æ¥å—ä¸€ä¸ªé¢å¤–çš„å¯è°ƒç”¨å‚æ•°ï¼Œç”¨äºå†³å®šæ˜¯å¦ä¼šå¼•å‘`AirflowSkipException`ã€‚
- en: '[PRE6]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: If the result of `conditional_checker_callable` returns `True`, then the operator
    will be executed otherwise it will be skipped. Now the full code for our DAG becomes
    as
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœ`conditional_checker_callable`çš„ç»“æœè¿”å›`True`ï¼Œåˆ™æ“ä½œç¬¦å°†è¢«æ‰§è¡Œï¼Œå¦åˆ™å°†è¢«è·³è¿‡ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„DAGçš„å®Œæ•´ä»£ç å˜ä¸ºï¼š
- en: '[PRE7]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](../Images/f15d6eb6466a31efaff165a2d9dd0ead.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f15d6eb6466a31efaff165a2d9dd0ead.png)'
- en: 'Creating a custom operator that is capable of being skipped. Note that for
    this option, no additional tasks are requiredâ€” Source: Author'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ›å»ºä¸€ä¸ªå¯ä»¥è¢«è·³è¿‡çš„è‡ªå®šä¹‰æ“ä½œç¬¦ã€‚æ³¨æ„ï¼Œå¯¹äºè¿™ä¸ªé€‰é¡¹ï¼Œä¸éœ€è¦é¢å¤–çš„ä»»åŠ¡â€”æ¥æºï¼šä½œè€…
- en: Now if the condition results in `False`, the task created using our custom operator
    will be skipped.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œå¦‚æœæ¡ä»¶ç»“æœä¸º`False`ï¼Œä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰æ“ä½œç¬¦åˆ›å»ºçš„ä»»åŠ¡å°†è¢«è·³è¿‡ã€‚
- en: '![](../Images/a364b09dd2dca0a6fcbfb849626d7504.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a364b09dd2dca0a6fcbfb849626d7504.png)'
- en: 'Skipping the task if the condition is False â€” Source: Author'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ¡ä»¶ä¸ºFalseï¼Œåˆ™è·³è¿‡ä»»åŠ¡â€”æ¥æºï¼šä½œè€…
- en: Likewise, if the condition is `True` the task will be executed.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: åŒæ ·åœ°ï¼Œå¦‚æœæ¡ä»¶ä¸º`True`ï¼Œä»»åŠ¡å°†è¢«æ‰§è¡Œã€‚
- en: '![](../Images/9bd6057b500b13d64e51b8d8acd1f909.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/9bd6057b500b13d64e51b8d8acd1f909.png)'
- en: 'Executing the task if the condition is True â€” Source: Author'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ¡ä»¶ä¸ºTrueï¼Œåˆ™æ‰§è¡Œä»»åŠ¡â€”æ¥æºï¼šä½œè€…
- en: Notice that for this particular option, we donâ€™t need to create additional tasks
    like we did in the two previous examples with `BranchPythonOperator` and `ShortCircuitOperator`
    which is something I personally like given that it declutters our DAG.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œå¯¹äºè¿™ä¸ªç‰¹å®šé€‰é¡¹ï¼Œæˆ‘ä»¬ä¸éœ€è¦åƒåœ¨å‰ä¸¤ä¸ªç¤ºä¾‹ä¸­é‚£æ ·åˆ›å»ºé¢å¤–çš„ä»»åŠ¡ä½¿ç”¨`BranchPythonOperator`å’Œ`ShortCircuitOperator`ï¼Œè¿™ç‚¹æˆ‘ä¸ªäººå¾ˆå–œæ¬¢ï¼Œå› ä¸ºå®ƒä½¿æˆ‘ä»¬çš„DAGæ›´ç®€æ´ã€‚
- en: Note that a similar behaviour can be achived by inheriting functionality from
    `SkipMixin` Mixin Airlflow class. For more information, feel free to take a look
    at the documentation.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œç±»ä¼¼çš„è¡Œä¸ºå¯ä»¥é€šè¿‡ç»§æ‰¿`SkipMixin` Mixin Airflowç±»çš„åŠŸèƒ½æ¥å®ç°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·éšæ—¶æŸ¥çœ‹æ–‡æ¡£ã€‚
- en: Personally, I do like the last approach as itâ€™s a bit more clear when it comes
    to the DAG visualisation on the Airflow UI and at the same time, by creating a
    sub-class from a built-in operator to implement skipping logic, you can re-use
    it for other DAGs as well. But this comes down to the specific use-case and any
    preference you may have, so feel free to choose the approach that best suits your
    needs.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘å–œæ¬¢æœ€åä¸€ç§æ–¹æ³•ï¼Œå› ä¸ºå®ƒåœ¨Airflow UIä¸­çš„DAGå¯è§†åŒ–æ—¶æ›´ä¸ºæ¸…æ™°ï¼ŒåŒæ—¶ï¼Œé€šè¿‡ä»å†…ç½®æ“ä½œç¬¦åˆ›å»ºä¸€ä¸ªå­ç±»æ¥å®ç°è·³è¿‡é€»è¾‘ï¼Œä½ è¿˜å¯ä»¥å°†å…¶é‡ç”¨åˆ°å…¶ä»–DAGä¸­ã€‚ä½†è¿™å–å†³äºå…·ä½“çš„ç”¨ä¾‹å’Œä½ çš„ä»»ä½•åå¥½ï¼Œæ‰€ä»¥è¯·éšæ„é€‰æ‹©æœ€é€‚åˆä½ éœ€æ±‚çš„æ–¹æ³•ã€‚
- en: Final Thoughts
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æœ€åçš„æƒ³æ³•
- en: Skipping tasks while authoring Airflow DAGs is a very common requirement that
    lets Engineers orchestrate tasks in a more dynamic and sophisticated way.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ç¼–å†™Airflow DAGæ—¶è·³è¿‡ä»»åŠ¡æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„éœ€æ±‚ï¼Œå®ƒä½¿å·¥ç¨‹å¸ˆèƒ½å¤Ÿä»¥æ›´åŠ¨æ€å’Œå¤æ‚çš„æ–¹å¼åè°ƒä»»åŠ¡ã€‚
- en: In this article, we demonstrate many different options when it comes to implementing
    logic that requires conditional execution of certain Airflow tasks. More specifically,
    we demonstrated how you can implement such functionality when using `PythonOperator`
    by raising `AirflowSkipException`.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†è®¸å¤šä¸åŒçš„é€‰é¡¹ï¼Œç”¨äºå®ç°éœ€è¦æ¡ä»¶æ‰§è¡Œçš„Airflowä»»åŠ¡é€»è¾‘ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡å¼•å‘`AirflowSkipException`æ¥å®ç°è¿™ç§åŠŸèƒ½ã€‚
- en: Furthermore, we also demonstrated a few different approaches when it comes to
    skipping tasks created using built-in Operators, other than the `PythonOperator`.
    Based on your specific use-case itâ€™s up to you to decide which approach to take.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æ¼”ç¤ºäº†å‡ ç§ä¸åŒçš„æ–¹æ³•ï¼Œç”¨äºè·³è¿‡ä½¿ç”¨å†…ç½®æ“ä½œç¬¦åˆ›å»ºçš„ä»»åŠ¡ï¼Œé™¤äº†`PythonOperator`ã€‚æ ¹æ®ä½ çš„å…·ä½“ç”¨ä¾‹ï¼Œä½ å¯ä»¥å†³å®šé‡‡ç”¨å“ªç§æ–¹æ³•ã€‚
- en: Even though skipping tasks is a common requirement, it doesnâ€™t seem that Airflow
    has a built-in feature to perform conditional runs within a specific DAG. I would
    expect that a feature allowing developers to specify trigger conditions in specific
    tasks would be available, but I am pretty sure that sooner or later this functionality
    will be implemented and packed into a future Airflow version.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡è·³è¿‡ä»»åŠ¡æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œä½†ä¼¼ä¹Airflowæ²¡æœ‰å†…ç½®çš„åŠŸèƒ½æ¥åœ¨ç‰¹å®šçš„DAGä¸­æ‰§è¡Œæ¡ä»¶è¿è¡Œã€‚æˆ‘æœŸå¾…èƒ½å¤Ÿè®©å¼€å‘è€…åœ¨ç‰¹å®šä»»åŠ¡ä¸­æŒ‡å®šè§¦å‘æ¡ä»¶çš„åŠŸèƒ½ï¼Œä½†æˆ‘å¾ˆç¡®å®šè¿™ç§åŠŸèƒ½è¿Ÿæ—©ä¼šè¢«å®ç°å¹¶æ‰“åŒ…è¿›æœªæ¥çš„Airflowç‰ˆæœ¬ä¸­ã€‚
- en: ğŸ‘‰ [**Become a member**](https://gmyrianthous.medium.com/membership) **and read
    every story on Medium. Your membership fee directly supports me and other writers
    you read. Youâ€™ll also get full access to every story on Medium.**
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ‘‰ [**æˆä¸ºä¼šå‘˜**](https://gmyrianthous.medium.com/membership) **å¹¶é˜…è¯»Mediumä¸Šçš„æ¯ä¸€ç¯‡æ•…äº‹ã€‚ä½ çš„ä¼šå‘˜è´¹ç›´æ¥æ”¯æŒæˆ‘å’Œä½ é˜…è¯»çš„å…¶ä»–ä½œè€…ã€‚ä½ è¿˜å°†è·å¾—Mediumä¸Šæ¯ä¸ªæ•…äº‹çš„å®Œæ•´è®¿é—®æƒé™ã€‚**
- en: '[](https://gmyrianthous.medium.com/membership?source=post_page-----a5a6ab319378--------------------------------)
    [## Join Medium with my referral link â€” Giorgos Myrianthous'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://gmyrianthous.medium.com/membership?source=post_page-----a5a6ab319378--------------------------------)
    [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥Medium â€” Giorgos Myrianthous'
- en: As a Medium member, a portion of your membership fee goes to writers you read,
    and you get full access to every storyâ€¦
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä½œä¸ºMediumä¼šå‘˜ï¼Œä½ çš„éƒ¨åˆ†ä¼šå‘˜è´¹ä¼šæµå‘ä½ é˜…è¯»çš„ä½œè€…ï¼Œå¹¶ä¸”ä½ å°†è·å¾—å¯¹æ¯ä¸ªæ•…äº‹çš„å®Œæ•´è®¿é—®æƒé™â€¦â€¦
- en: gmyrianthous.medium.com](https://gmyrianthous.medium.com/membership?source=post_page-----a5a6ab319378--------------------------------)
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: gmyrianthous.medium.com](https://gmyrianthous.medium.com/membership?source=post_page-----a5a6ab319378--------------------------------)
- en: ğŸ‘‡**Related articles you may also like** ğŸ‘‡
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ‘‡**ä½ å¯èƒ½è¿˜å–œæ¬¢çš„ç›¸å…³æ–‡ç« ** ğŸ‘‡
- en: '[](/etl-vs-elt-68e221d78719?source=post_page-----a5a6ab319378--------------------------------)
    [## ETL vs ELT: Whatâ€™s the Difference?'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '[](/etl-vs-elt-68e221d78719?source=post_page-----a5a6ab319378--------------------------------)
    [## ETLä¸ELTï¼šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ'
- en: A comparison between ETL and ELT in the context of Data Engineering
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: æ•°æ®å·¥ç¨‹èƒŒæ™¯ä¸‹ETLä¸ELTçš„æ¯”è¾ƒ
- en: towardsdatascience.com](/etl-vs-elt-68e221d78719?source=post_page-----a5a6ab319378--------------------------------)
    [](/dbt-55b35c974533?source=post_page-----a5a6ab319378--------------------------------)
    [## What is dbt (data build tool)
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: towardsdatascience.com](/etl-vs-elt-68e221d78719?source=post_page-----a5a6ab319378--------------------------------)
    [](/dbt-55b35c974533?source=post_page-----a5a6ab319378--------------------------------)
    [## ä»€ä¹ˆæ˜¯dbtï¼ˆæ•°æ®æ„å»ºå·¥å…·ï¼‰
- en: A gentle introduction to dbt that is taking over the data world
  id: totrans-90
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: å¯¹æ­£åœ¨é¢ è¦†æ•°æ®ä¸–ç•Œçš„dbtçš„æ¸©é¦¨ä»‹ç»
- en: towardsdatascience.com](/dbt-55b35c974533?source=post_page-----a5a6ab319378--------------------------------)
    [](/apache-airflow-architecture-496b9cb28288?source=post_page-----a5a6ab319378--------------------------------)
    [## Apache Airflow Architecture
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '[towardsdatascience.com](/dbt-55b35c974533?source=post_page-----a5a6ab319378--------------------------------)
    [](/apache-airflow-architecture-496b9cb28288?source=post_page-----a5a6ab319378--------------------------------)
    [## Apache Airflow æ¶æ„'
- en: A deep dive into Apache Airflow architecture and how it orchestrates workflows
  id: totrans-92
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: æ·±å…¥æ¢è®¨ Apache Airflow æ¶æ„åŠå…¶å¦‚ä½•åè°ƒå·¥ä½œæµ
- en: towardsdatascience.com](/apache-airflow-architecture-496b9cb28288?source=post_page-----a5a6ab319378--------------------------------)
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '[towardsdatascience.com](/apache-airflow-architecture-496b9cb28288?source=post_page-----a5a6ab319378--------------------------------)'
