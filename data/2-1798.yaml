- en: Run Things in the Background with Julia
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åœ¨ Julia ä¸­åå°è¿è¡Œä»»åŠ¡
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/run-things-in-the-background-with-julia-c9e72e59fc48](https://towardsdatascience.com/run-things-in-the-background-with-julia-c9e72e59fc48)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/run-things-in-the-background-with-julia-c9e72e59fc48](https://towardsdatascience.com/run-things-in-the-background-with-julia-c9e72e59fc48)
- en: Stop waiting and start multi-threading
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: åœæ­¢ç­‰å¾…ï¼Œå¼€å§‹å¤šçº¿ç¨‹
- en: '[](https://niczky12.medium.com/?source=post_page-----c9e72e59fc48--------------------------------)[![Bence
    Komarniczky](../Images/d4de94667bcac6d9001390515592eab9.png)](https://niczky12.medium.com/?source=post_page-----c9e72e59fc48--------------------------------)[](https://towardsdatascience.com/?source=post_page-----c9e72e59fc48--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----c9e72e59fc48--------------------------------)
    [Bence Komarniczky](https://niczky12.medium.com/?source=post_page-----c9e72e59fc48--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://niczky12.medium.com/?source=post_page-----c9e72e59fc48--------------------------------)[![æœ¬æ–¯Â·ç§‘é©¬å°”å°¼èŒ¨åŸº](../Images/d4de94667bcac6d9001390515592eab9.png)](https://niczky12.medium.com/?source=post_page-----c9e72e59fc48--------------------------------)[](https://towardsdatascience.com/?source=post_page-----c9e72e59fc48--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----c9e72e59fc48--------------------------------)
    [æœ¬æ–¯Â·ç§‘é©¬å°”å°¼èŒ¨åŸº](https://niczky12.medium.com/?source=post_page-----c9e72e59fc48--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----c9e72e59fc48--------------------------------)
    Â·4 min readÂ·May 26, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘å¸ƒäº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----c9e72e59fc48--------------------------------)
    Â·é˜…è¯»æ—¶é•¿ 4 åˆ†é’ŸÂ·2023å¹´5æœˆ26æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/b6d8943bd405300d84e92529392e8559.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b6d8943bd405300d84e92529392e8559.png)'
- en: Photo by [Max Wolfs](https://unsplash.com/ko/@yesterdazed?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ç…§ç‰‡ç”± [Max Wolfs](https://unsplash.com/ko/@yesterdazed?utm_source=medium&utm_medium=referral)
    æä¾›ï¼Œæ¥è‡ª [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
- en: Even though Julia is one of the fastest languages out there, sometimes it can
    take time for things to execute. If youâ€™re a data scientist or analyst using Julia,
    maybe you want to send computation off to a server, wait for it to finish, and
    then do something with the results.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: å³ä½¿ Julia æ˜¯ç°æœ‰çš„æœ€å¿«è¯­è¨€ä¹‹ä¸€ï¼Œæœ‰æ—¶æ‰§è¡Œä»»åŠ¡ä¹Ÿéœ€è¦æ—¶é—´ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªä½¿ç”¨ Julia çš„æ•°æ®ç§‘å­¦å®¶æˆ–åˆ†æå¸ˆï¼Œä¹Ÿè®¸ä½ å¸Œæœ›å°†è®¡ç®—ä»»åŠ¡å‘é€åˆ°æœåŠ¡å™¨ï¼Œç­‰å¾…å®Œæˆåå†å¤„ç†ç»“æœã€‚
- en: But waiting is boring.
  id: totrans-9
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä½†ç­‰å¾…æ˜¯æ— èŠçš„ã€‚
- en: When youâ€™re in the middle of your work, full of ideas and enthusiasm to deliver
    something interesting, you want to **keep pounding that keyboard to find something
    else**.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ä½ åœ¨å·¥ä½œä¸­å……æ»¡åˆ›æ„å’Œçƒ­æƒ…ï¼Œæ¸´æœ›äº¤ä»˜æœ‰è¶£çš„å†…å®¹æ—¶ï¼Œä½ å¸Œæœ› **ä¸æ–­æ•²å‡»é”®ç›˜å¯»æ‰¾å…¶ä»–å†…å®¹**ã€‚
- en: Let me show you a simple technique in Julia, how you can **dispatch computation
    to another thread** and get on with your work.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘å‘ä½ å±•ç¤º Julia ä¸­ä¸€ä¸ªç®€å•çš„æŠ€å·§ï¼Œå¦‚ä½• **å°†è®¡ç®—ä»»åŠ¡åˆ†é…åˆ°å¦ä¸€ä¸ªçº¿ç¨‹**ï¼Œç„¶åç»§ç»­ä½ çš„å·¥ä½œã€‚
- en: Setting things up
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è®¾ç½®å·¥ä½œç¯å¢ƒ
- en: As I said before, Julia is fast. As a modern language, it is also **built with
    multiprocessing in mind**. So using those extra cores in your machine is easy
    if you know how to do it.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: æ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¯´ï¼ŒJulia å¾ˆå¿«ã€‚ä½œä¸ºä¸€ç§ç°ä»£è¯­è¨€ï¼Œå®ƒä¹Ÿ **è€ƒè™‘äº†å¤šçº¿ç¨‹å¤„ç†**ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çŸ¥é“å¦‚ä½•æ“ä½œï¼Œä½¿ç”¨è®¡ç®—æœºä¸Šçš„é¢å¤–æ ¸å¿ƒéå¸¸å®¹æ˜“ã€‚
- en: 'First of all, we must make sure we start a Julia instance with multiple threads:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿ä»¥å¤šä¸ªçº¿ç¨‹å¯åŠ¨ Julia å®ä¾‹ï¼š
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'This will start Julia using 4 threads. We can confirm this by asking for the
    number of threads:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°†ä½¿ç”¨ 4 ä¸ªçº¿ç¨‹å¯åŠ¨ Juliaã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥è¯¢çº¿ç¨‹æ•°æ¥ç¡®è®¤è¿™ä¸€ç‚¹ï¼š
- en: '[PRE1]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Making a slow function
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: åˆ¶ä½œä¸€ä¸ªæ…¢é€Ÿå‡½æ•°
- en: '![](../Images/04421f6811cb6df54cb72c074f69ac46.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/04421f6811cb6df54cb72c074f69ac46.png)'
- en: Photo by [Frederick Yang](https://unsplash.com/@fredericksail?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: ç…§ç‰‡ç”± [Frederick Yang](https://unsplash.com/@fredericksail?utm_source=medium&utm_medium=referral)
    æä¾›ï¼Œæ¥è‡ª [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
- en: Now that we have more threads itâ€™s time to see this magic in action. But we
    need something to run for a while for this to make sense. I assume if youâ€™re reading
    this article, you already have something in mind, but because I prefer to have
    complete examples in my articles, Iâ€™ll write a little function here to entertain
    myself.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬æœ‰äº†æ›´å¤šçš„çº¿ç¨‹ï¼Œæ˜¯æ—¶å€™çœ‹çœ‹è¿™äº›é­”æ³•çš„å®é™…æ•ˆæœäº†ã€‚ä½†æˆ‘ä»¬éœ€è¦ä¸€äº›ä¸œè¥¿è¿è¡Œä¸€æ®µæ—¶é—´æ‰æœ‰æ„ä¹‰ã€‚æˆ‘å‡è®¾ä½ åœ¨é˜…è¯»è¿™ç¯‡æ–‡ç« æ—¶å·²ç»æœ‰äº†ä¸€äº›æƒ³æ³•ï¼Œä½†å› ä¸ºæˆ‘å–œæ¬¢åœ¨æ–‡ç« ä¸­æä¾›å®Œæ•´çš„ç¤ºä¾‹ï¼Œæˆ‘ä¼šåœ¨è¿™é‡Œå†™ä¸€ä¸ªå°å‡½æ•°æ¥å¨±ä¹ä¸€ä¸‹è‡ªå·±ã€‚
- en: This â€œslowâ€ function could be a call to build an ML model, run some SQL-like
    queries on a database or fetch some data from cloud storage. Use your imagination
    and go wild!
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: è¿™ä¸ªâ€œæ…¢â€çš„å‡½æ•°å¯èƒ½æ˜¯æ„å»º ML æ¨¡å‹çš„è°ƒç”¨ï¼Œè¿è¡Œä¸€äº›ç±»ä¼¼ SQL çš„æ•°æ®åº“æŸ¥è¯¢ï¼Œæˆ–ä»äº‘å­˜å‚¨ä¸­è·å–ä¸€äº›æ•°æ®ã€‚å‘æŒ¥ä½ çš„æƒ³è±¡åŠ›ï¼Œå°½æƒ…å°è¯•å§ï¼
- en: '[PRE2]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: If youâ€™re curious about what the above is about and why I picked 989,345,275,647
    then [read this Wiki page](https://en.wikipedia.org/wiki/Collatz_conjecture).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ å¯¹ä¸Šè¿°å†…å®¹æ„Ÿåˆ°å¥½å¥‡ï¼Œä»¥åŠä¸ºä»€ä¹ˆæˆ‘é€‰æ‹©äº† 989,345,275,647ï¼Œé‚£ä¹ˆ[é˜…è¯»è¿™ä¸ªç»´åŸºé¡µé¢](https://en.wikipedia.org/wiki/Collatz_conjecture)ã€‚
- en: Fetching some magic
  id: totrans-25
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è·å–ä¸€äº›é­”æ³•
- en: '![](../Images/fe87378468a88af2ccaf2d451455f5df.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/fe87378468a88af2ccaf2d451455f5df.png)'
- en: Photo by [K. Mitch Hodge](https://unsplash.com/@kmitchhodge?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”± [K. Mitch Hodge](https://unsplash.com/@kmitchhodge?utm_source=medium&utm_medium=referral)
    åœ¨ [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„
- en: Since we have `Threads` in our namespace, we can use the `**@spawn**` **macro
    to send computation to another thread**. This means that we get our REPL back
    immediately and we can continue working as before.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºæˆ‘ä»¬åœ¨å‘½åç©ºé—´ä¸­æœ‰ `Threads`ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `**@spawn**` **å®å°†è®¡ç®—å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹**ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç«‹å³è¿”å› REPLï¼Œå¹¶ç»§ç»­åƒä»¥å‰ä¸€æ ·å·¥ä½œã€‚
- en: '[PRE3]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '*Ignore my lack of imagination, I just couldnâ€™t be bothered to come up with
    something more sophisticated after spawning.*'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '*å¿½ç•¥æˆ‘ç¼ºä¹æƒ³è±¡åŠ›ï¼Œç”Ÿæˆåæˆ‘åªæ˜¯æ‡’å¾—æƒ³å‡ºæ›´å¤æ‚çš„ä¸œè¥¿ã€‚*'
- en: Basically, whatâ€™s happening here is that `@spawn` returns a `Task`. T**his task
    is automatically dispatched to a free thread** that can work on it in the background
    allowing you to write more code and ask more questions in the meanwhile. Once
    you need the results, you can **collect the results of the tasks with** `**fetch**`
    which will wait for the `Task` to finish and return the results.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: åŸºæœ¬ä¸Šï¼Œè¿™é‡Œå‘ç”Ÿçš„äº‹æƒ…æ˜¯ `@spawn` è¿”å›ä¸€ä¸ª `Task`ã€‚**è¿™ä¸ªä»»åŠ¡ä¼šè‡ªåŠ¨åˆ†æ´¾åˆ°ä¸€ä¸ªç©ºé—²çš„çº¿ç¨‹**ï¼Œè¯¥çº¿ç¨‹å¯ä»¥åœ¨åå°å¤„ç†å®ƒï¼Œå…è®¸ä½ åœ¨æ­¤æœŸé—´ç¼–å†™æ›´å¤šä»£ç å’Œæå‡ºæ›´å¤šé—®é¢˜ã€‚ä¸€æ—¦ä½ éœ€è¦ç»“æœï¼Œä½ å¯ä»¥ç”¨
    `**fetch**` **æ”¶é›†ä»»åŠ¡çš„ç»“æœ**ï¼Œå®ƒä¼šç­‰å¾… `Task` å®Œæˆå¹¶è¿”å›ç»“æœã€‚
- en: Proof that this works
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è¯æ˜è¿™æœ‰æ•ˆ
- en: One way to show that this indeed works is to show some timings.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€ç§å±•ç¤ºè¿™ç¡®å®æœ‰æ•ˆçš„æ–¹æ³•æ˜¯å±•ç¤ºä¸€äº›æ—¶é—´è®°å½•ã€‚
- en: First, weâ€™ll run our function on the current thread and measure the time it
    takes. Then weâ€™ll spawn a `Task` and finally weâ€™ll spawn and immediately wait
    for the results.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œæˆ‘ä»¬å°†åœ¨å½“å‰çº¿ç¨‹ä¸Šè¿è¡Œæˆ‘ä»¬çš„å‡½æ•°å¹¶æµ‹é‡æ‰€éœ€æ—¶é—´ã€‚ç„¶åæˆ‘ä»¬å°†ç”Ÿæˆä¸€ä¸ª `Task`ï¼Œæœ€åæˆ‘ä»¬å°†ç”Ÿæˆå¹¶ç«‹å³ç­‰å¾…ç»“æœã€‚
- en: '[PRE4]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: As you can see, our function takes about 16s to run. But if we dispatch the
    task, then we **immediately return a Task**. This comes with some overhead as
    you can see in the final row, since this is slightly (0.3s) slower than just running
    the computation on the main thread.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: æ­£å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬çš„å‡½æ•°è¿è¡Œå¤§çº¦éœ€è¦ 16 ç§’ã€‚ä½†å¦‚æœæˆ‘ä»¬è°ƒåº¦ä»»åŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ **ä¼šç«‹å³è¿”å›ä¸€ä¸ªä»»åŠ¡**ã€‚è¿™å¸¦æ¥äº†ä¸€äº›å¼€é”€ï¼Œå¦‚ä½ åœ¨æœ€åä¸€è¡Œæ‰€è§ï¼Œå› ä¸ºè¿™æ¯”åœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œè®¡ç®—ç¨å¾®æ…¢äº†
    0.3 ç§’ã€‚
- en: Thanks for reading!
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ„Ÿè°¢é˜…è¯»ï¼
- en: Hopefully, this little trick will enlighten newcomers to Julia about the awesome
    superpowers a modern, multi-threaded language can give them. If you enjoyed reading
    my ramble about this topic, give me a ğŸ‘ or ğŸ‘ ğŸ‘.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: å¸Œæœ›è¿™ä¸ªå°æŠ€å·§èƒ½è®©æ–°æ‰‹å¯¹ Julia çš„ç°ä»£å¤šçº¿ç¨‹è¯­è¨€çš„å¼ºå¤§åŠŸèƒ½æœ‰æ›´å¤šäº†è§£ã€‚å¦‚æœä½ å–œæ¬¢æˆ‘å…³äºè¿™ä¸ªè¯é¢˜çš„å•°å—¦ï¼Œè¯·ç»™æˆ‘ä¸€ä¸ª ğŸ‘ æˆ– ğŸ‘ ğŸ‘ã€‚
