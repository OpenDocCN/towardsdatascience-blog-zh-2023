- en: A classy approach to solving Traveling Salesman Problems effectively with Python
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä¸€ç§ä¼˜é›…çš„æ–¹å¼æ¥æœ‰æ•ˆè§£å†³æ—…è¡Œæ¨é”€å‘˜é—®é¢˜
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/a-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9?source=collection_archive---------5-----------------------#2023-08-28](https://towardsdatascience.com/a-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9?source=collection_archive---------5-----------------------#2023-08-28)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/a-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9?source=collection_archive---------5-----------------------#2023-08-28](https://towardsdatascience.com/a-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9?source=collection_archive---------5-----------------------#2023-08-28)
- en: Implementing the TSP model in a scikit-learn-like fashion to ease the building
    and solving of routing optimization models
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä»¥ç±»ä¼¼ scikit-learn çš„æ–¹å¼å®ç° TSP æ¨¡å‹ï¼Œç®€åŒ–è·¯çº¿ä¼˜åŒ–æ¨¡å‹çš„æ„å»ºå’Œæ±‚è§£
- en: '[](https://medium.com/@carlosjuribe?source=post_page-----dbb44e7d30b9--------------------------------)[![Carlos
    J. Uribe](../Images/902c5f4ac5d404dd99916f145be6756c.png)](https://medium.com/@carlosjuribe?source=post_page-----dbb44e7d30b9--------------------------------)[](https://towardsdatascience.com/?source=post_page-----dbb44e7d30b9--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----dbb44e7d30b9--------------------------------)
    [Carlos J. Uribe](https://medium.com/@carlosjuribe?source=post_page-----dbb44e7d30b9--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@carlosjuribe?source=post_page-----dbb44e7d30b9--------------------------------)[![Carlos
    J. Uribe](../Images/902c5f4ac5d404dd99916f145be6756c.png)](https://medium.com/@carlosjuribe?source=post_page-----dbb44e7d30b9--------------------------------)[](https://towardsdatascience.com/?source=post_page-----dbb44e7d30b9--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----dbb44e7d30b9--------------------------------)
    [Carlos J. Uribe](https://medium.com/@carlosjuribe?source=post_page-----dbb44e7d30b9--------------------------------)'
- en: Â·
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4337eddb94ed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9&user=Carlos+J.+Uribe&userId=4337eddb94ed&source=post_page-4337eddb94ed----dbb44e7d30b9---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----dbb44e7d30b9--------------------------------)
    Â·27 min readÂ·Aug 28, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdbb44e7d30b9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9&user=Carlos+J.+Uribe&userId=4337eddb94ed&source=-----dbb44e7d30b9---------------------clap_footer-----------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[å…³æ³¨](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4337eddb94ed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9&user=Carlos+J.+Uribe&userId=4337eddb94ed&source=post_page-4337eddb94ed----dbb44e7d30b9---------------------post_header-----------)
    å‘è¡¨åœ¨ [Towards Data Science](https://towardsdatascience.com/?source=post_page-----dbb44e7d30b9--------------------------------)
    Â·27åˆ†é’Ÿé˜…è¯»Â·2023å¹´8æœˆ28æ—¥'
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdbb44e7d30b9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9&source=-----dbb44e7d30b9---------------------bookmark_footer-----------)![](../Images/44dbc85e4fab1ee01aca3f8d40880deb.png)'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdbb44e7d30b9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9&source=-----dbb44e7d30b9---------------------bookmark_footer-----------)![](../Images/44dbc85e4fab1ee01aca3f8d40880deb.png)'
- en: 'Image generated by DALLÂ·E 3 with authorâ€™s prompt: â€œa series of optimal routes
    traversing the planet with Python code in the backgroundâ€'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”± DALLÂ·E 3 æ ¹æ®ä½œè€…çš„æç¤ºç”Ÿæˆï¼šâ€œä¸€ç³»åˆ—ä¼˜åŒ–è·¯çº¿ç©¿è¶Šåœ°çƒï¼ŒèƒŒæ™¯ä¸­æœ‰ Python ä»£ç â€
- en: 'ğŸ‘ï¸ **This is article #5 of the series** **covering the project â€œ**[**An Intelligent
    Decision Support System for Tourism in Python**](https://medium.com/@carlosjuribe/list/an-intelligent-decision-support-system-for-tourism-in-python-b6ba165b4236)**â€.**
    I encourage you to check it out to get a general overview of the whole project.
    If youâ€™re only interested in solving TSPs, this article is still for you, as I
    show an approach that makes it incredibly simple to solve any TSP. **The article
    does build upon the previous ones, but reading them is optional**; do so if youâ€™d
    like to know the â€œhowâ€, or skip them if you want to have something working as
    soon as possible.'
  id: totrans-9
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 'ğŸ‘ï¸ **è¿™æ˜¯ç³»åˆ—æ–‡ç« çš„ç¬¬ #5 ç¯‡** **æ¶µç›–äº†é¡¹ç›®â€œ**[**Pythonä¸­çš„æ™ºèƒ½æ—…æ¸¸å†³ç­–æ”¯æŒç³»ç»Ÿ**](https://medium.com/@carlosjuribe/list/an-intelligent-decision-support-system-for-tourism-in-python-b6ba165b4236)**â€**ã€‚æˆ‘é¼“åŠ±ä½ æŸ¥çœ‹å®ƒï¼Œä»¥è·å¾—æ•´ä¸ªé¡¹ç›®çš„ä¸€èˆ¬æ¦‚è¿°ã€‚å¦‚æœä½ åªæ˜¯å¯¹è§£å†³TSPæ„Ÿå…´è¶£ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿé€‚åˆä½ ï¼Œå› ä¸ºæˆ‘å±•ç¤ºäº†ä¸€ç§æ–¹æ³•ï¼Œä½¿è§£å†³ä»»ä½•TSPå˜å¾—éå¸¸ç®€å•ã€‚**è¿™ç¯‡æ–‡ç« ç¡®å®å»ºç«‹åœ¨ä¹‹å‰çš„æ–‡ç« åŸºç¡€ä¸Šï¼Œä½†é˜…è¯»å®ƒä»¬æ˜¯å¯é€‰çš„**ï¼›å¦‚æœä½ æƒ³äº†è§£â€œå¦‚ä½•â€ï¼Œå¯ä»¥é˜…è¯»ï¼›å¦‚æœä½ æƒ³å°½å¿«å¾—åˆ°æˆæœï¼Œåˆ™å¯ä»¥è·³è¿‡ã€‚'
- en: Table of contents
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[1\. Previous sprints recap](#9b5c)'
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[1. ä¹‹å‰å†²åˆºå›é¡¾](#9b5c)'
- en: '[2\. Read data for the sites to be visited](#fa87)'
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[2. è¯»å–å¾…è®¿é—®åœ°ç‚¹çš„æ•°æ®](#fa87)'
- en: '[3\. The basic architecture](#336e)'
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[3. åŸºæœ¬æ¶æ„](#336e)'
- en: '[3.1\. The Optimizer class diagram](#7b91)'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[3.1. ä¼˜åŒ–å™¨ç±»å›¾](#7b91)'
- en: '[3.2\.](#eefc) `[**GeoAnalyzer**](#eefc)`[, revisited](#eefc)'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[3.2.](#eefc) `[**åœ°ç†åˆ†æå™¨**](#eefc)`[, å›é¡¾](#eefc)'
- en: '[3.3\. Laying the *bases*: a base class for optimization utilities](#43ef)'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[3.3. æ‰“ä¸‹*åŸºç¡€*ï¼šä¼˜åŒ–å·¥å…·çš„åŸºç±»](#43ef)'
- en: '[4\. One class to route them all: the](#c043) `[TravelingSalesmanOptimizer](#c043)`'
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[4. ä¸€ä¸ªç±»æ¥è§£å†³æ‰€æœ‰é—®é¢˜ï¼š](#c043) `[æ—…è¡Œæ¨é”€å‘˜ä¼˜åŒ–å™¨](#c043)`'
- en: '[4.1\.](#127d) `[**TravelingSalesmanOptimizer**](#127d)` [design](#127d)'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[4.1.](#127d) `[**æ—…è¡Œæ¨é”€å‘˜ä¼˜åŒ–å™¨**](#127d)` [è®¾è®¡](#127d)'
- en: '[4.2\.](#419d) `[**TravelingSalesmanOptimizer**](#419d)` [implementation](#419d)'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[4.2.](#419d) `[**æ—…è¡Œæ¨é”€å‘˜ä¼˜åŒ–å™¨**](#419d)` [å®ç°](#419d)'
- en: '[4.3\.](#9ab8) `[**TravelingSalesmanOptimizer**](#9ab8)` [for dummies](#9ab8)'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[4.3.](#9ab8) `[**æ—…è¡Œæ¨é”€å‘˜ä¼˜åŒ–å™¨**](#9ab8)` [ä¸ºåˆå­¦è€…](#9ab8)'
- en: '[5\. Beyond the optimal solution: extracting insights with the optimizer](#754e)'
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[5. è¶…è¶Šæœ€ä¼˜è§£ï¼šä½¿ç”¨ä¼˜åŒ–å™¨æå–è§è§£](#754e)'
- en: '[6\. Conclusion (or planning for next sprint)](#c3ec)'
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[6. ç»“è®ºï¼ˆæˆ–ä¸‹ä¸€æ¬¡å†²åˆºçš„è®¡åˆ’ï¼‰](#c3ec)'
- en: 1\. Previous sprints recap
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1. ä¹‹å‰å†²åˆºå›é¡¾
- en: In [sprint 1](https://medium.com/@carlosjuribe/plan-an-optimal-trip-for-your-next-holidays-with-the-help-of-operations-research-and-python-481b1ea38fef)
    we reasoned our way through a ubiquitous tourism planning problem and concluded
    that its **minimum valuable problem** took the form of the [**Traveling Salesman
    Problem** (TSP)](https://en.wikipedia.org/wiki/Travelling_salesman_problem). That
    is why we dedicated [sprint 2](https://medium.com/@carlosjuribe/modeling-the-traveling-salesman-problem-from-first-principles-bd6530c9c07)
    and [sprint 3](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c)
    to develop a mathematical model, and a computer model, respectively, of the TSP.
    However, the goal then was only to **demonstrate the viability** of using optimization
    modeling to solve such a problem. Once this proof-of-concept was deemed viable,
    the new goal was to upgrade it, to refine it into a **Minimum Viable Product**
    (MVP) that could be used to **solve this *kind* of problems systematically, and
    in a more general fashion**. We noticed that, as a prerequisite, we needed a way
    of **obtaining distance data** from arbitrary locations. We tackled this issue
    in [sprint 4](https://medium.com/@carlosjuribe/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e),
    where we built the `GeoAnalyzer` class to compute the distance matrix for any
    set of locations given only their coordinates.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ [å†²åˆº 1](https://medium.com/@carlosjuribe/plan-an-optimal-trip-for-your-next-holidays-with-the-help-of-operations-research-and-python-481b1ea38fef)
    ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ™®éçš„æ—…æ¸¸è§„åˆ’é—®é¢˜è¿›è¡Œäº†æ¨ç†ï¼Œå¹¶å¾—å‡ºå…¶**æœ€å°å¯è¡Œé—®é¢˜**ä¸º [**æ—…è¡Œæ¨é”€å‘˜é—®é¢˜** (TSP)](https://en.wikipedia.org/wiki/Travelling_salesman_problem)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†
    [å†²åˆº 2](https://medium.com/@carlosjuribe/modeling-the-traveling-salesman-problem-from-first-principles-bd6530c9c07)
    å’Œ [å†²åˆº 3](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c)
    ä¸“é—¨ç”¨äºå¼€å‘ TSP çš„æ•°å­¦æ¨¡å‹å’Œè®¡ç®—æœºæ¨¡å‹ã€‚ç„¶è€Œï¼Œå½“æ—¶çš„ç›®æ ‡åªæ˜¯**å±•ç¤ºä½¿ç”¨ä¼˜åŒ–å»ºæ¨¡è§£å†³æ­¤ç±»é—®é¢˜çš„å¯è¡Œæ€§**ã€‚ä¸€æ—¦æ­¤æ¦‚å¿µéªŒè¯è¢«è®¤ä¸ºæ˜¯å¯è¡Œçš„ï¼Œæ–°çš„ç›®æ ‡æ˜¯å‡çº§å®ƒï¼Œå°†å…¶ç²¾ç‚¼ä¸ºä¸€ä¸ª**æœ€å°å¯è¡Œäº§å“**
    (MVP)ï¼Œä»¥**ç³»ç»Ÿåœ°å’Œæ›´é€šç”¨åœ°è§£å†³è¿™ç§*ç±»å‹*çš„é—®é¢˜**ã€‚æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œä½œä¸ºå‰ææ¡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§**ä»ä»»æ„ä½ç½®è·å–è·ç¦»æ•°æ®**çš„æ–¹æ³•ã€‚æˆ‘ä»¬åœ¨ [å†²åˆº 4](https://medium.com/@carlosjuribe/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e)
    ä¸­è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬æ„å»ºäº† `GeoAnalyzer` ç±»æ¥è®¡ç®—ä»»ä½•ä½ç½®é›†åˆçš„è·ç¦»çŸ©é˜µï¼Œåªéœ€å®ƒä»¬çš„åæ ‡å³å¯ã€‚
- en: 'All those iterative advancements take us here, to sprint 5, where we finally
    hit a major milestone: the creation of **an estimator-like class that solves *general*
    TSPs, quickly and intuitively**. We will accomplish this by integrating what weâ€™ve
    built so far in an extensible fashion, thereby paving the way for future enhancements
    that will extend the capabilities of our model far beyond the TSP, something we
    must do if our system is to solve realistic tourism problems. That said, **the
    Traveling Salesman Problem** â€” arguably the most famous transportation problem
    in all Operations Research â€” **is in a class of its own, so in this article, weâ€™ll
    give it a *class* of its own**. This class will hide away all the low-level modeling
    and solution parsing details, thereby enabling the **seamless solution of any
    TSP problem with just a method call**. If you feel this article lacks enough context
    or makes big jumps, please read the prep work to learn [how to implement a model
    for the TSP in Pyomo](/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c),'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€æœ‰è¿™äº›è¿­ä»£è¿›å±•å°†æˆ‘ä»¬å¸¦åˆ°äº†ç¬¬äº”é˜¶æ®µï¼Œæˆ‘ä»¬æœ€ç»ˆè¾¾æˆäº†ä¸€ä¸ªé‡å¤§é‡Œç¨‹ç¢‘ï¼šåˆ›å»ºä¸€ä¸ª**åƒä¼°ç®—å™¨ä¸€æ ·çš„ç±»ï¼Œå¯ä»¥å¿«é€Ÿç›´è§‚åœ°è§£å†³*é€šç”¨* TSP**ã€‚æˆ‘ä»¬å°†é€šè¿‡ä»¥å¯æ‰©å±•çš„æ–¹å¼é›†æˆåˆ°ç›®å‰ä¸ºæ­¢æ‰€æ„å»ºçš„å†…å®¹æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼Œä»è€Œä¸ºæœªæ¥çš„å¢å¼ºé“ºå¹³é“è·¯ï¼Œè¿™äº›å¢å¼ºå°†ä½¿æˆ‘ä»¬çš„æ¨¡å‹çš„èƒ½åŠ›è¿œè¶…
    TSPã€‚å¦‚æœæˆ‘ä»¬è¦è§£å†³ç°å®ä¸–ç•Œçš„æ—…æ¸¸é—®é¢˜ï¼Œè¿™æ˜¯å¿…é¡»åšçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**æ—…è¡Œæ¨é”€å‘˜é—®é¢˜**â€”â€”å¯ä»¥è¯´æ˜¯æ‰€æœ‰è¿ç­¹å­¦ä¸­æœ€è‘—åçš„è¿è¾“é—®é¢˜â€”â€”**ç‹¬å…·ä¸€æ ¼ï¼Œå› æ­¤åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºå…¶æä¾›ä¸€ä¸ª*ç‹¬ç‰¹çš„ç±»***ã€‚è¿™ä¸ªç±»å°†éšè—æ‰€æœ‰ä½çº§å»ºæ¨¡å’Œè§£å†³æ–¹æ¡ˆè§£æçš„ç»†èŠ‚ï¼Œä»è€Œä½¿**é€šè¿‡æ–¹æ³•è°ƒç”¨å³å¯æ— ç¼è§£å†³ä»»ä½•
    TSP é—®é¢˜**ã€‚å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« ç¼ºä¹è¶³å¤Ÿçš„èƒŒæ™¯æˆ–è·³è·ƒè¾ƒå¤§ï¼Œè¯·é˜…è¯»å‡†å¤‡å·¥ä½œï¼Œäº†è§£[å¦‚ä½•åœ¨ Pyomo ä¸­å®ç° TSP æ¨¡å‹](https://towardsdatascience.com/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c?source=post_page-----dbb44e7d30b9--------------------------------)
- en: '[](/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c?source=post_page-----dbb44e7d30b9--------------------------------)
    [## Implementing, solving and visualizing the Traveling Salesman Problem with
    Python'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '[## ä½¿ç”¨ Python å®ç°ã€è§£å†³å’Œå¯è§†åŒ–æ—…è¡Œæ¨é”€å‘˜é—®é¢˜](https://towardsdatascience.com/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c?source=post_page-----dbb44e7d30b9--------------------------------)'
- en: Learn how to translate an optimization model from Math to Python, optimize it,
    and visualize the solution to gain quickâ€¦
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: å­¦ä¹ å¦‚ä½•å°†ä¼˜åŒ–æ¨¡å‹ä»æ•°å­¦è½¬æ¢ä¸º Pythonï¼Œä¼˜åŒ–å®ƒï¼Œå¹¶å¯è§†åŒ–è§£å†³æ–¹æ¡ˆä»¥å¿«é€Ÿè·å¾—ç»“æœâ€¦
- en: towardsdatascience.com](/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c?source=post_page-----dbb44e7d30b9--------------------------------)
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '[towardsdatascience.com](https://towardsdatascience.com/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c?source=post_page-----dbb44e7d30b9--------------------------------)'
- en: and [how to find distances between locations in an automatic manner](/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e),
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥åŠ[å¦‚ä½•ä»¥è‡ªåŠ¨æ–¹å¼æŸ¥æ‰¾åœ°ç‚¹ä¹‹é—´çš„è·ç¦»](https://towardsdatascience.com/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e)
- en: '[](/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e?source=post_page-----dbb44e7d30b9--------------------------------)
    [## Compute the Distance Matrix of a Set of Sites from Their Coordinates in Python'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '[## ä»åæ ‡è®¡ç®—ä¸€ç»„ç«™ç‚¹çš„è·ç¦»çŸ©é˜µ](https://towardsdatascience.com/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e?source=post_page-----dbb44e7d30b9--------------------------------)'
- en: Estimate the distance between any pair of sites from their geographical coordinates
    as a stepping stone to solvingâ€¦
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä¼°ç®—ä»»æ„ä¸€å¯¹ç«™ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œä½œä¸ºè§£å†³é—®é¢˜çš„ä¸€ä¸ªæ­¥éª¤â€¦
- en: towardsdatascience.com](/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e?source=post_page-----dbb44e7d30b9--------------------------------)
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '[## ä»åæ ‡è®¡ç®—ä¸€ç»„ç«™ç‚¹çš„è·ç¦»çŸ©é˜µ](https://towardsdatascience.com/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e?source=post_page-----dbb44e7d30b9--------------------------------)'
- en: and you will understand, in more depth, where the ideas and code weâ€™ll discuss
    here come from. If youâ€™re already versed on the TSP, jump right in!
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å°†æ›´æ·±å…¥åœ°ç†è§£æˆ‘ä»¬å°†åœ¨è¿™é‡Œè®¨è®ºçš„æƒ³æ³•å’Œä»£ç çš„æ¥æºã€‚å¦‚æœä½ å·²ç»ç†Ÿæ‚‰ TSPï¼Œå¯ä»¥ç›´æ¥è·³å…¥ï¼
- en: 2\. Read data for the sites to be visited
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2\. è¯»å–è¦è®¿é—®çš„ç«™ç‚¹æ•°æ®
- en: 'The basic input for the generic TSP is the locations we want to visit. In our
    example, we have a list of sites of interest in Paris, including our hotel. Letâ€™s
    read them into a dataframe:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: é€šç”¨ TSP çš„åŸºæœ¬è¾“å…¥æ˜¯æˆ‘ä»¬è¦è®¿é—®çš„åœ°ç‚¹ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå·´é»çš„å…´è¶£ç‚¹åˆ—è¡¨ï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„é…’åº—ã€‚è®©æˆ‘ä»¬å°†å®ƒä»¬è¯»å…¥æ•°æ®æ¡†ï¼š
- en: '[PRE0]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![](../Images/a8ac65de957710474d2d97505db2075b.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a8ac65de957710474d2d97505db2075b.png)'
- en: '**Figure 1.** Input coordinates for the optimizer (Image by author)'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '**å›¾ 1.** ä¼˜åŒ–å™¨çš„è¾“å…¥åæ ‡ï¼ˆä½œè€…æä¾›çš„å›¾ç‰‡ï¼‰'
- en: 3\. The basic architecture
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 3\. åŸºæœ¬æ¶æ„
- en: Before we start coding, itâ€™s important to have a high-level understanding, and
    thus a design, of what we are about to do and why. Our goal is the creation of
    a class that **takes in some geographical coordinates of some sites, and solves
    the TSP problem for them, *i.e.*, outputs the order in which we ought to visit
    those sites** to minimize the total distance traveled. We wonâ€™t create just one
    class that does everything; we will keep different functionalities in different
    classes, and then combine them together[Â¹](#0558).
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æˆ‘ä»¬å¼€å§‹ç¼–ç ä¹‹å‰ï¼Œé‡è¦çš„æ˜¯å¯¹æˆ‘ä»¬å³å°†åšçš„å·¥ä½œå’ŒåŸå› æœ‰ä¸€ä¸ªé«˜å±‚æ¬¡çš„ç†è§£å’Œè®¾è®¡ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ª**æ¥å—æŸäº›ç«™ç‚¹çš„åœ°ç†åæ ‡ï¼Œå¹¶ä¸ºå®ƒä»¬è§£å†³TSPé—®é¢˜ï¼Œ*å³*ï¼Œè¾“å‡ºæˆ‘ä»¬åº”è¯¥è®¿é—®è¿™äº›ç«™ç‚¹çš„é¡ºåº**ä»¥æœ€å°åŒ–æ€»æ—…è¡Œè·ç¦»ã€‚æˆ‘ä»¬ä¸ä¼šåˆ›å»ºä¸€ä¸ªå®Œæˆæ‰€æœ‰ä»»åŠ¡çš„ç±»ï¼›æˆ‘ä»¬å°†æŠŠä¸åŒçš„åŠŸèƒ½ä¿å­˜åœ¨ä¸åŒçš„ç±»ä¸­ï¼Œç„¶åå°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·[Â¹](#0558)ã€‚
- en: 3.1\. The Optimizer class diagram
  id: totrans-41
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 3.1\. ä¼˜åŒ–å™¨ç±»å›¾
- en: I believe it is convenient for our class to have a scikit-learn-ish API. However,
    I wonâ€™t refer to our new class as an â€œ*estimator*â€, but rather, as an â€œ*optimizer*â€[Â²](#4124).
    A self-explanatory name is `TravelingSalesmanOptimizer`. One of its helper attributes
    will be the `GeoAnalyzer` class built in [sprint 4](https://medium.com/@carlosjuribe/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e).
    Also, as this won't be the only optimizer class we'll end up creating in this
    project, we will store all the functionality related to the solving of models
    inside a separate class, `BaseOptimizer`. The reason is that all optimizers, no
    matter what internal model they implement, will need to optimize it, so it's best
    to keep the logic related to the optimization itself in a separate class, a base
    class which all optimizers will inherit from.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘è®¤ä¸ºæˆ‘ä»¬çš„ç±»é‡‡ç”¨ç±»ä¼¼scikit-learnçš„APIæ˜¯ä¾¿åˆ©çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä¸ä¼šå°†æˆ‘ä»¬çš„æ–°ç±»ç§°ä¸ºâ€œ*ä¼°ç®—å™¨*â€ï¼Œè€Œæ˜¯ç§°ä¸ºâ€œ*ä¼˜åŒ–å™¨*â€[Â²](#4124)ã€‚ä¸€ä¸ªè‡ªè§£é‡Šçš„åç§°æ˜¯
    `TravelingSalesmanOptimizer`ã€‚å®ƒçš„ä¸€ä¸ªè¾…åŠ©å±æ€§å°†æ˜¯[ç¬¬4é˜¶æ®µ](https://medium.com/@carlosjuribe/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e)ä¸­æ„å»ºçš„
    `GeoAnalyzer` ç±»ã€‚æ­¤å¤–ï¼Œç”±äºè¿™å°†ä¸æ˜¯æˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®ä¸­åˆ›å»ºçš„å”¯ä¸€ä¼˜åŒ–å™¨ç±»ï¼Œæˆ‘ä»¬å°†æŠŠæ‰€æœ‰ä¸æ¨¡å‹æ±‚è§£ç›¸å…³çš„åŠŸèƒ½å­˜å‚¨åœ¨ä¸€ä¸ªå•ç‹¬çš„ç±» `BaseOptimizer`
    ä¸­ã€‚åŸå› æ˜¯æ‰€æœ‰ä¼˜åŒ–å™¨ï¼Œæ— è®ºå®ƒä»¬å®ç°ä»€ä¹ˆå†…éƒ¨æ¨¡å‹ï¼Œéƒ½éœ€è¦ä¼˜åŒ–å®ƒï¼Œå› æ­¤æœ€å¥½å°†ä¸ä¼˜åŒ–æœ¬èº«ç›¸å…³çš„é€»è¾‘ä¿å­˜åœ¨ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸­ï¼Œä½œä¸ºæ‰€æœ‰ä¼˜åŒ–å™¨çš„åŸºç±»ã€‚
- en: In the class diagram below, we can see how the three classes fit together. Inside
    each, I have included their **main attributes and methods** (but not all) for
    us to get the idea.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸‹é¢çš„ç±»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸‰ä¸ªç±»å¦‚ä½•ç»„åˆåœ¨ä¸€èµ·ã€‚åœ¨æ¯ä¸ªç±»å†…éƒ¨ï¼Œæˆ‘åŒ…å«äº†å®ƒä»¬çš„**ä¸»è¦å±æ€§å’Œæ–¹æ³•**ï¼ˆä½†ä¸æ˜¯å…¨éƒ¨ï¼‰ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½ç†è§£æ•´ä½“æ¦‚å¿µã€‚
- en: '![](../Images/e8c714186abc4b21a798483e156f5f3a.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/e8c714186abc4b21a798483e156f5f3a.png)'
- en: '**Figure 2.** Class diagram for the TSP Optimizer (Image by author)'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '**å›¾2ã€‚** TSPä¼˜åŒ–å™¨çš„ç±»å›¾ï¼ˆä½œè€…æä¾›çš„å›¾åƒï¼‰'
- en: 'Hereâ€™s the main purpose of each class, in a nutshell:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯ä¸ªç±»çš„ä¸»è¦ç›®çš„ï¼Œç®€è€Œè¨€ä¹‹ï¼š
- en: '`BaseOptimizer` is responsible for the optimization of the models of "proper"
    optimizer subclasses, it''s not intended to be instantiated on its own.'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`BaseOptimizer` è´Ÿè´£ä¼˜åŒ–â€œé€‚å½“â€çš„ä¼˜åŒ–å™¨å­ç±»çš„æ¨¡å‹ï¼Œå®ƒä¸æ‰“ç®—å•ç‹¬å®ä¾‹åŒ–ã€‚'
- en: '`GeoAnalyzer` is a self-contained class of geo-utilities. It aids in the crucial
    step of computing a distance matrix from user-given coordinates, needed to construct
    a model if the user doesn''t have custom distance data at hand.'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`GeoAnalyzer` æ˜¯ä¸€ä¸ªè‡ªåŒ…å«çš„åœ°ç†å·¥å…·ç±»ã€‚å®ƒåœ¨è®¡ç®—ç”¨æˆ·æä¾›çš„åæ ‡çš„è·ç¦»çŸ©é˜µçš„å…³é”®æ­¥éª¤ä¸­æä¾›å¸®åŠ©ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰è‡ªå®šä¹‰è·ç¦»æ•°æ®ï¼Œè¿™ä¸€æ­¥æ˜¯æ„å»ºæ¨¡å‹æ‰€å¿…éœ€çš„ã€‚'
- en: The `TravelingSalesmanOptimizer` is an optimizer that can be fitted to a dataframe
    having the coordinates of the sites. Once fitted, the "visit order" of those sites
    can be retrieved. Internally, it implements a [mathematical model](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c)
    of the Traveling Salesman Problem as a [Pyomo model](https://pyomo.readthedocs.io/en/stable/pyomo_overview/simple_examples.html)
    object.
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`TravelingSalesmanOptimizer` æ˜¯ä¸€ä¸ªä¼˜åŒ–å™¨ï¼Œå¯ä»¥æ‹Ÿåˆå…·æœ‰ç«™ç‚¹åæ ‡çš„æ•°æ®æ¡†ã€‚ä¸€æ—¦æ‹Ÿåˆï¼Œä¾¿å¯ä»¥æ£€ç´¢è¿™äº›ç«™ç‚¹çš„â€œè®¿é—®é¡ºåºâ€ã€‚åœ¨å†…éƒ¨ï¼Œå®ƒå®ç°äº†[æ—…è¡Œå•†é—®é¢˜çš„æ•°å­¦æ¨¡å‹](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c)ä½œä¸ºä¸€ä¸ª[Pyomoæ¨¡å‹](https://pyomo.readthedocs.io/en/stable/pyomo_overview/simple_examples.html)å¯¹è±¡ã€‚'
- en: With a concrete design in mind, letâ€™s assemble it.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰äº†å…·ä½“çš„è®¾è®¡ï¼Œæˆ‘ä»¬æ¥ç»„è£…å®ƒã€‚
- en: 3.2\. `GeoAnalyzer`, revisited
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 3.2\. `GeoAnalyzer` çš„é‡æ–°å®¡è§†
- en: 'As the code for `GeoAnalyzer` was already developed in the previous sprint,
    here we just move it to a new module, `geoutils.py`, and import the class from
    there. If you haven''t read [the article in which it was created](https://medium.com/@carlosjuribe/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e),
    don''t worry, all you need to know is that it takes in some dataframe of coordinates
    and outputs a distance matrix, like this:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äº`GeoAnalyzer`çš„ä»£ç å·²åœ¨å‰ä¸€æ¬¡å†²åˆºä¸­å¼€å‘å®Œæˆï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯å°†å…¶ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°æ¨¡å—`geoutils.py`ä¸­ï¼Œå¹¶ä»é‚£é‡Œå¯¼å…¥è¯¥ç±»ã€‚å¦‚æœä½ æ²¡æœ‰é˜…è¯»[åˆ›å»ºå®ƒçš„æ–‡ç« ](https://medium.com/@carlosjuribe/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e)ï¼Œä¸è¦æ‹…å¿ƒï¼Œä½ éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œå®ƒæ¥å—ä¸€äº›åæ ‡æ•°æ®æ¡†å¹¶è¾“å‡ºä¸€ä¸ªè·ç¦»çŸ©é˜µï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE1]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![](../Images/4f12661ff8fbe9db8e0db9e08440b218.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/4f12661ff8fbe9db8e0db9e08440b218.png)'
- en: '**Figure 3.** Distance matrix generated by GeoAnalyzer (Image by author)'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '**å›¾ 3.** GeoAnalyzerç”Ÿæˆçš„è·ç¦»çŸ©é˜µï¼ˆå›¾ç‰‡ç”±ä½œè€…æä¾›ï¼‰'
- en: This dataframe of distances is what weâ€™ll use inside `TravelingSalesmanOptimizer`
    to create an internal model, as the real data that is needed to model a Traveling
    Salesman problem is distances, not coordinates.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªè·ç¦»æ•°æ®æ¡†æ˜¯æˆ‘ä»¬å°†åœ¨`TravelingSalesmanOptimizer`å†…éƒ¨ç”¨äºåˆ›å»ºå†…éƒ¨æ¨¡å‹çš„ï¼Œå› ä¸ºå»ºæ¨¡æ—…è¡Œé”€å”®å‘˜é—®é¢˜æ‰€éœ€çš„çœŸå®æ•°æ®æ˜¯è·ç¦»ï¼Œè€Œä¸æ˜¯åæ ‡ã€‚
- en: '3.3\. Laying the bases: a base class for optimization utilities'
  id: totrans-57
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 3.3\. æ‰“ä¸‹åŸºç¡€ï¼šä¼˜åŒ–å·¥å…·çš„åŸºç±»
- en: In the [article for sprint 3](http://localhost:8888/lab/workspaces/auto-c/tree/Projects/TWDS/traveling_tourist_problem/TTPOptimizer_part3.ipynb#https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c),
    the very first code snippet is about instantiating a Pyomo solver and printing
    its version. A bit further below, in [section 2.1](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=validating%20the%20model-,2.1.%20Solving%20the%20model,-The%20next%20step),
    we used this solver to optimize the model. With that in mind, creating `BaseOptimizer`
    is only a matter of putting these pieces together into a class. We will modify
    the original code slightly so that it becomes easier to read, but essentially
    it's the same thing wrapped conveniently.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨[ç¬¬ä¸‰æ¬¡å†²åˆºçš„æ–‡ç« ](http://localhost:8888/lab/workspaces/auto-c/tree/Projects/TWDS/traveling_tourist_problem/TTPOptimizer_part3.ipynb#https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c)ä¸­ï¼Œç¬¬ä¸€ä¸ªä»£ç ç‰‡æ®µæ˜¯å…³äºå®ä¾‹åŒ–Pyomoæ±‚è§£å™¨å¹¶æ‰“å°å…¶ç‰ˆæœ¬ã€‚ç¨ååœ¨[2.1èŠ‚](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=validating%20the%20model-,2.1.%20Solving%20the%20model,-The%20next%20step)ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è¿™ä¸ªæ±‚è§£å™¨æ¥ä¼˜åŒ–æ¨¡å‹ã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œåˆ›å»º`BaseOptimizer`åªéœ€å°†è¿™äº›éƒ¨åˆ†ç»„åˆæˆä¸€ä¸ªç±»å³å¯ã€‚æˆ‘ä»¬å°†ç¨å¾®ä¿®æ”¹åŸå§‹ä»£ç ï¼Œä»¥ä¾¿æ›´æ˜“äºé˜…è¯»ï¼Œä½†æœ¬è´¨ä¸Šå®ƒæ˜¯ç›¸åŒçš„ï¼Œæ–¹ä¾¿åœ°å°è£…èµ·æ¥ã€‚
- en: '[PRE2]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The main things to keep in mind about this class are:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: å…³äºè¿™ä¸ªç±»éœ€è¦è®°ä½çš„ä¸»è¦äº‹é¡¹æ˜¯ï¼š
- en: At instantiation, the solver is set up internally by `_setup_solver`. As we
    can't solve any model without a solver, if the setup fails, an exception will
    be raised. If the solver is found, it's kept as a private attribute.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨å®ä¾‹åŒ–æ—¶ï¼Œæ±‚è§£å™¨ç”±`_setup_solver`åœ¨å†…éƒ¨è®¾ç½®ã€‚ç”±äºæ²¡æœ‰æ±‚è§£å™¨æˆ‘ä»¬æ— æ³•è§£å†³ä»»ä½•æ¨¡å‹ï¼Œå¦‚æœè®¾ç½®å¤±è´¥ï¼Œå°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœæ‰¾åˆ°äº†æ±‚è§£å™¨ï¼Œå®ƒä¼šè¢«ä½œä¸ºç§æœ‰å±æ€§ä¿å­˜ã€‚
- en: The method `_optimize` will be invoked whenever a subclass to `BaseOptimizer`
    calls a `fit`-like method. `_optimize` takes in a model and **attempts** to solve
    it, using the internal solver. If an optimal solution *exists*, the attribute
    `_solution_exists` will cease to be `None` and will take the value `True`. If
    *no optimal solution exists*[*Â³*](#f7e6), it will take the value `False`, and
    a warning is printed.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ¯å½“ä¸€ä¸ª`BaseOptimizer`çš„å­ç±»è°ƒç”¨ç±»ä¼¼`fit`çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•`_optimize`å°†ä¼šè¢«è°ƒç”¨ã€‚`_optimize`æ¥å—ä¸€ä¸ªæ¨¡å‹ï¼Œå¹¶ä½¿ç”¨å†…éƒ¨æ±‚è§£å™¨**å°è¯•**è§£å†³å®ƒã€‚å¦‚æœ*å­˜åœ¨*æœ€ä¼˜è§£ï¼Œå±æ€§`_solution_exists`å°†ä¸å†æ˜¯`None`ï¼Œè€Œæ˜¯å–å€¼`True`ã€‚å¦‚æœ*æ²¡æœ‰æœ€ä¼˜è§£å­˜åœ¨*[*Â³*](#f7e6)ï¼Œå®ƒå°†å–å€¼`False`ï¼Œå¹¶ä¼šæ‰“å°ä¸€ä¸ªè­¦å‘Šã€‚
- en: The remaining methods are explained in their docstrings. Now, time to build
    our first optimizer.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: å‰©ä½™çš„æ–¹æ³•åœ¨å®ƒä»¬çš„æ–‡æ¡£å­—ç¬¦ä¸²ä¸­è¿›è¡Œäº†è¯´æ˜ã€‚ç°åœ¨ï¼Œå¼€å§‹æ„å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªä¼˜åŒ–å™¨ã€‚
- en: '4\. One class to route them all: the `TravelingSalesmanOptimizer`'
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 4\. ä¸€ä¸ªç±»è§£å†³æ‰€æœ‰é—®é¢˜ï¼š`TravelingSalesmanOptimizer`
- en: Here we wonâ€™t start from scratch. As stated earlier, we already developed the
    code that builds a Pyomo model of the TSP and solves it in [sprint 3](http://localhost:8888/lab/workspaces/auto-c/tree/Projects/TWDS/traveling_tourist_problem/TTPOptimizer_part3.ipynb#https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c).
    And trust me, that was the hardest part. Now, we have the easier task of organizing
    what we did in a way that makes it general, hiding the details while keeping the
    *essential* elements visible. In a sense, we want the optimizer to look like a
    â€œmagic boxâ€ that even users not familiar with math modeling are able to use to
    solve their TSP problems intuitively.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ä¸ä¼šä»å¤´å¼€å§‹ã€‚æ­£å¦‚å‰é¢æ‰€è¿°ï¼Œæˆ‘ä»¬å·²ç»å¼€å‘äº†æ„å»ºTSPçš„Pyomoæ¨¡å‹å¹¶åœ¨[sprint 3](http://localhost:8888/lab/workspaces/auto-c/tree/Projects/TWDS/traveling_tourist_problem/TTPOptimizer_part3.ipynb#https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c)ä¸­è§£å†³å®ƒçš„ä»£ç ã€‚ç›¸ä¿¡æˆ‘ï¼Œé‚£æ˜¯æœ€éš¾çš„éƒ¨åˆ†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯å°†æˆ‘ä»¬æ‰€åšçš„ç»„ç»‡æˆä¸€ç§é€šç”¨çš„æ–¹å¼ï¼Œéšè—ç»†èŠ‚åŒæ—¶ä¿ç•™*åŸºæœ¬*å…ƒç´ ã€‚æŸç§æ„ä¹‰ä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›ä¼˜åŒ–å™¨çœ‹èµ·æ¥åƒä¸€ä¸ªâ€œé­”æ³•ç›’å­â€ï¼Œå³ä½¿æ˜¯å¯¹æ•°å­¦å»ºæ¨¡ä¸ç†Ÿæ‚‰çš„ç”¨æˆ·ä¹Ÿèƒ½ç›´è§‚åœ°è§£å†³ä»–ä»¬çš„TSPé—®é¢˜ã€‚
- en: 4.1\. `TravelingSalesmanOptimizer` design
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.1. `TravelingSalesmanOptimizer`è®¾è®¡
- en: Our optimizer class will have â€œcoreâ€ methods, doing the bulk of the work, and
    â€œsuperficialâ€ methods, serving as the high-level interface of the class, which
    invoke the core methods underneath.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çš„ä¼˜åŒ–å™¨ç±»å°†åŒ…å«â€œæ ¸å¿ƒâ€æ–¹æ³•ï¼Œå¤„ç†å¤§éƒ¨åˆ†å·¥ä½œï¼Œè¿˜æœ‰â€œè¡¨é¢â€æ–¹æ³•ï¼Œä½œä¸ºç±»çš„é«˜çº§æ¥å£ï¼Œè°ƒç”¨åº•å±‚çš„æ ¸å¿ƒæ–¹æ³•ã€‚
- en: 'These are the steps that will lie at the core of the optimizerâ€™s logic:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™äº›æ­¥éª¤å°†æˆä¸ºä¼˜åŒ–å™¨é€»è¾‘çš„æ ¸å¿ƒï¼š
- en: '**Create a Pyomo model** out of a distance matrix. This is done by the `_create_model`
    method, which basically wraps [the code of the proof-of-concept](/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=start%20coding%20along!-,1.2.%20Math%20becomes%20code,First%2C%20let%E2%80%99s%20make%20sure%20the%20GLPK%20solver%20is%20findable%20by%20Pyomo,-%23%23%23%20%3D%3D%3D%3D%3D%20%20Code%20block%203.1)
    we already did. It accepts a dataframe of a distance matrix and builds a Pyomo
    model out of it. The only important difference between what we did and what we''re
    doing is that, now, the initial site is not hard-coded as simply `"hotel"`, but
    is *assumed* to be the site of the first row in `df_distances`. In the general
    case, thus, **the initial site is taken to be the first one in the coordinates
    dataframe**[â´](#8dd4) `df_sites`. This generalization allows the optimizer to
    solve any instance.'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**ä»è·ç¦»çŸ©é˜µåˆ›å»ºä¸€ä¸ªPyomoæ¨¡å‹**ã€‚è¿™ç”±`_create_model`æ–¹æ³•å®Œæˆï¼Œè¯¥æ–¹æ³•åŸºæœ¬ä¸Šå°è£…äº†æˆ‘ä»¬å·²ç»å®Œæˆçš„[æ¦‚å¿µéªŒè¯ä»£ç ](/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=start%20coding%20along!-,1.2.%20Math%20becomes%20code,First%2C%20let%E2%80%99s%20make%20sure%20the%20GLPK%20solver%20is%20findable%20by%20Pyomo,-%23%23%23%20%3D%3D%3D%3D%3D%20%20Code%20block%203.1)ã€‚å®ƒæ¥å—ä¸€ä¸ªè·ç¦»çŸ©é˜µçš„æ•°æ®æ¡†ï¼Œå¹¶åŸºäºæ­¤æ„å»ºä¸€ä¸ªPyomoæ¨¡å‹ã€‚æˆ‘ä»¬æ‰€åšçš„ä¸æˆ‘ä»¬ç°åœ¨è¦åšçš„å”¯ä¸€é‡è¦åŒºåˆ«åœ¨äºï¼Œåˆå§‹ç«™ç‚¹ä¸å†ç¡¬ç¼–ç ä¸ºç®€å•çš„`"hotel"`ï¼Œè€Œæ˜¯*å‡å®š*ä¸º`df_distances`ä¸­ç¬¬ä¸€è¡Œçš„ç«™ç‚¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ**åˆå§‹ç«™ç‚¹è¢«è®¤ä¸ºæ˜¯åæ ‡æ•°æ®æ¡†**[â´](#8dd4)
    `df_sites`ä¸­çš„ç¬¬ä¸€ä¸ªã€‚è¿™ä¸€æ¨å¹¿ä½¿å¾—ä¼˜åŒ–å™¨èƒ½å¤Ÿè§£å†³ä»»ä½•å®ä¾‹ã€‚'
- en: '**(Attempt to) Solve the model**. This is performed in the `_optimize` method
    inherited from `BaseOptimizer`, which returns `True` only if a solution is found.'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**ï¼ˆå°è¯•ï¼‰è§£å†³æ¨¡å‹**ã€‚è¿™æ˜¯åœ¨ç»§æ‰¿è‡ª`BaseOptimizer`çš„`_optimize`æ–¹æ³•ä¸­æ‰§è¡Œçš„ï¼Œåªæœ‰æ‰¾åˆ°è§£å†³æ–¹æ¡ˆæ—¶æ‰è¿”å›`True`ã€‚'
- en: '**Extract the solution from the model and parse it** in a way that is easy
    to interpret and use. This happens inside `_store_solution_from_model`, which
    is a method that inspects the solved model and extracts the values of the decision
    variables, and the value of the objective function, to *create* the attributes
    `tour_` and `tour_distance_`, respectively. This method *gets invoked* ***only
    if*** *a solution exists*, so if no solution is found, the "solution attributes"
    `tour_` and `tour_distance_` never get created. The benefit of this is that the
    presence of these two "solution attributes", after fitting, will inform the user
    of the existence of a solution. As a plus, the optimal values of both the variables
    and objective can be conveniently retrieved at any point, not necessarily at the
    moment of fitting.'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**ä»æ¨¡å‹ä¸­æå–è§£å†³æ–¹æ¡ˆå¹¶è§£æ**æˆæ˜“äºç†è§£å’Œä½¿ç”¨çš„å½¢å¼ã€‚è¿™å‘ç”Ÿåœ¨`_store_solution_from_model`æ–¹æ³•å†…éƒ¨ï¼Œè¯¥æ–¹æ³•æ£€æŸ¥å·²è§£å†³çš„æ¨¡å‹å¹¶æå–å†³ç­–å˜é‡çš„å€¼ï¼Œä»¥åŠç›®æ ‡å‡½æ•°çš„å€¼ï¼Œä»¥*åˆ›å»º*å±æ€§`tour_`å’Œ`tour_distance_`ã€‚æ­¤æ–¹æ³•*ä»…åœ¨*å­˜åœ¨è§£å†³æ–¹æ¡ˆæ—¶*è¢«è°ƒç”¨ï¼Œå› æ­¤å¦‚æœæœªæ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œâ€œè§£å†³æ–¹æ¡ˆå±æ€§â€`tour_`å’Œ`tour_distance_`å°†ä¸ä¼šè¢«åˆ›å»ºã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œåœ¨æ‹Ÿåˆä¹‹åï¼Œè¿™ä¸¤ä¸ªâ€œè§£å†³æ–¹æ¡ˆå±æ€§â€çš„å­˜åœ¨å°†é€šçŸ¥ç”¨æˆ·å­˜åœ¨è§£å†³æ–¹æ¡ˆã€‚æ­¤å¤–ï¼Œå˜é‡å’Œç›®æ ‡çš„æœ€ä¼˜å€¼å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»æ–¹ä¾¿åœ°æ£€ç´¢ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨æ‹Ÿåˆæ—¶ã€‚'
- en: The last 2 steps â€” finding and extracting the solution â€” are wrapped inside
    the last â€œcoreâ€ method, `_fit_to_distances`.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åçš„ä¸¤ä¸ªæ­¥éª¤â€”â€”æ‰¾åˆ°å¹¶æå–è§£å†³æ–¹æ¡ˆâ€”â€”è¢«å°è£…åœ¨æœ€åä¸€ä¸ªâ€œæ ¸å¿ƒâ€æ–¹æ³• `_fit_to_distances` ä¸­ã€‚
- en: â€œBut waitâ€ â€” you might think â€” â€œAs the name implies, `_fit_to_distances` requires
    distances as input; isn't our goal to solve TSP problems using only *coordinates*,
    not *distances*?". Yes, that's where the `fit` method *fits* in. We pass *coordinates*
    to it, and we take advantage of `GeoAnalyzer` to construct the distance matrix,
    which is then processed normally by `_fit_to_distances`. In this way, if the user
    does not want to collect the distances himself, he can delegate the task by using
    `fit`. If, however, he prefers to use custom data, he can assemble it in a `df_distances`
    and pass it to `_fit_to_distances` instead.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: â€œä½†è¯·ç¨ç­‰â€â€”â€”ä½ å¯èƒ½ä¼šæƒ³â€”â€”â€œå¦‚åå­—æ‰€ç¤ºï¼Œ`_fit_to_distances` éœ€è¦è·ç¦»ä½œä¸ºè¾“å…¥ï¼›æˆ‘ä»¬çš„ç›®æ ‡ä¸æ˜¯ä»…ä½¿ç”¨ *åæ ‡* æ¥è§£å†³ TSP é—®é¢˜å—ï¼Œè€Œä¸æ˜¯
    *è·ç¦»*ï¼Ÿâ€ æ˜¯çš„ï¼Œè¿™å°±æ˜¯ `fit` æ–¹æ³• *é€‚é…* çš„åœ°æ–¹ã€‚æˆ‘ä»¬å°† *åæ ‡* ä¼ é€’ç»™å®ƒï¼Œå¹¶åˆ©ç”¨ `GeoAnalyzer` æ„å»ºè·ç¦»çŸ©é˜µï¼Œç„¶åç”± `_fit_to_distances`
    æ­£å¸¸å¤„ç†ã€‚è¿™æ ·ï¼Œå¦‚æœç”¨æˆ·ä¸æƒ³è‡ªå·±æ”¶é›†è·ç¦»ï¼Œä»–å¯ä»¥é€šè¿‡ä½¿ç”¨ `fit` å§”æ´¾ä»»åŠ¡ã€‚ç„¶è€Œï¼Œå¦‚æœä»–æ›´æ„¿æ„ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®ï¼Œä»–å¯ä»¥å°†å…¶ç»„è£…æˆ `df_distances`
    å¹¶ä¼ é€’ç»™ `_fit_to_distances`ã€‚
- en: 4.2\. `TravelingSalesmanOptimizer` implementation
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.2. `TravelingSalesmanOptimizer` å®ç°
- en: Letâ€™s follow the design outlined above to incrementally build the optimizer.
    First, a minimalist version that just builds a model and solves it â€” without any
    solution parsing yet. Notice how the `__repr__` method allows us to know the name
    and number of sites the optimizer contains whenever we print it.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬æŒ‰ç…§ä¸Šé¢æ¦‚è¿°çš„è®¾è®¡é€æ­¥æ„å»ºä¼˜åŒ–å™¨ã€‚é¦–å…ˆæ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬ï¼Œåªæ„å»ºæ¨¡å‹å¹¶è§£å†³å®ƒâ€”â€”å°šæœªè¿›è¡Œä»»ä½•è§£å†³æ–¹æ¡ˆè§£æã€‚æ³¨æ„ `__repr__` æ–¹æ³•å¦‚ä½•åœ¨æˆ‘ä»¬æ‰“å°ä¼˜åŒ–å™¨æ—¶è®©æˆ‘ä»¬çŸ¥é“å®ƒåŒ…å«çš„ç«™ç‚¹çš„åç§°å’Œæ•°é‡ã€‚
- en: '[PRE3]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Letâ€™s quickly check how the optimizer behaves. Upon instantiation, the optimizer
    does not contain any number of sites, as the representation string shows, or an
    internal model, and itâ€™s of course not fitted:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å¿«é€Ÿæ£€æŸ¥ä¼˜åŒ–å™¨çš„è¡Œä¸ºã€‚å®ä¾‹åŒ–æ—¶ï¼Œä¼˜åŒ–å™¨ä¸åŒ…å«ä»»ä½•ç«™ç‚¹æ•°é‡ï¼Œå¦‚è¡¨ç¤ºå­—ç¬¦ä¸²æ‰€ç¤ºï¼Œä¹Ÿæ²¡æœ‰å†…éƒ¨æ¨¡å‹ï¼Œå¹¶ä¸”å½“ç„¶æ²¡æœ‰è¿›è¡Œé€‚é…ã€‚
- en: '[PRE4]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'We now fit it to the distance data, and if we donâ€™t get a warning, it means
    that it all went well. We can see that now the representation string tells us
    we provided 9 sites, thereâ€™s an internal model, and that the optimizer was fitted
    to the distance data:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç°åœ¨å°†å…¶é€‚é…åˆ°è·ç¦»æ•°æ®ä¸Šï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°è­¦å‘Šï¼Œæ„å‘³ç€ä¸€åˆ‡é¡ºåˆ©ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨è¡¨ç¤ºå­—ç¬¦ä¸²å‘Šè¯‰æˆ‘ä»¬æˆ‘ä»¬æä¾›äº† 9 ä¸ªç«™ç‚¹ï¼Œå­˜åœ¨ä¸€ä¸ªå†…éƒ¨æ¨¡å‹ï¼Œå¹¶ä¸”ä¼˜åŒ–å™¨å·²ç»é€‚é…åˆ°è·ç¦»æ•°æ®ä¸Šï¼š
- en: '[PRE5]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'That the optimal solution was found is corroborated by the presence of definite
    values in the rank decision variables of the model:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€ä¼˜è§£çš„å‘ç°é€šè¿‡æ¨¡å‹çš„æ’åå†³ç­–å˜é‡ä¸­çš„æ˜ç¡®å€¼å¾—åˆ°äº†è¯å®ï¼š
- en: '[PRE6]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: These rank variables represent the chronological order of the stops in the optimal
    tour. If you recall from [their definition](/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=rank%20variables%2C%20r%E1%B5%A2%3A%20to%20keep%20track%20of%20the%20order%20in%20which%20sites%20are%20visited%3A),
    they are defined over all sites except the initial one[âµ](#f9a3), and thatâ€™s why
    the hotel does not appear in them. Easy, we could add the hotel with rank 0, and
    there we would have **the answer to our problem**. We donâ€™t need to extract ğ›¿áµ¢â±¼,
    the decision variables for the *individual* arcs of the tour, to know in which
    order we should visit the sites. Although thatâ€™s true, weâ€™re still going to use
    the arc variables ğ›¿áµ¢â±¼ to extract the exact sequence of stops from the solved model.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™äº›æ’åå˜é‡è¡¨ç¤ºæœ€ä¼˜æ—…è¡Œä¸­çš„åœé ç‚¹çš„æ—¶é—´é¡ºåºã€‚å¦‚æœä½ å›å¿†ä¸€ä¸‹ [å®ƒä»¬çš„å®šä¹‰](/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=rank%20variables%2C%20r%E1%B5%A2%3A%20to%20keep%20track%20of%20the%20order%20in%20which%20sites%20are%20visited%3A)ï¼Œå®ƒä»¬åœ¨æ‰€æœ‰ç«™ç‚¹ä¸Šå®šä¹‰ï¼Œé™¤äº†åˆå§‹ç«™ç‚¹[âµ](#f9a3)ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé…’åº—æ²¡æœ‰å‡ºç°åœ¨å…¶ä¸­ã€‚å¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥å°†é…’åº—æ·»åŠ ä¸ºæ’å
    0ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰äº† **é—®é¢˜çš„ç­”æ¡ˆ**ã€‚æˆ‘ä»¬ä¸éœ€è¦æå– ğ›¿áµ¢â±¼ï¼Œå³æ—…è¡Œçš„ *ä¸ªåˆ«* å¼§çš„å†³ç­–å˜é‡ï¼Œæ¥çŸ¥é“æˆ‘ä»¬åº”è¯¥ä»¥ä»€ä¹ˆé¡ºåºè®¿é—®ç«™ç‚¹ã€‚è™½ç„¶è¿™æ˜¯çœŸçš„ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šä½¿ç”¨å¼§å˜é‡
    ğ›¿áµ¢â±¼ æ¥ä»è§£å†³çš„æ¨¡å‹ä¸­æå–ç¡®åˆ‡çš„åœé é¡ºåºã€‚
- en: '*ğŸ’¡* **Agile *doesnâ€™t need to be* fragile**'
  id: totrans-85
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*ğŸ’¡* **æ•æ· *ä¸å¿…æ˜¯* è„†å¼±çš„**'
- en: ''
  id: totrans-86
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '*If our only aim were to solve the TSP, without looking to* extend *the model
    to encompass more details of our real-life problem, it would be enough to use
    the rank variables to extract the optimal tour. However, as the TSP is just* ***the
    initial prototype of what will become a more sophisticated model****, weâ€™re better
    off extracting the solution from the arc decision variables ğ›¿áµ¢â±¼, as they will
    be present in any model that involves routing decisions. All other decision variables
    are auxiliary, and, when needed, their job is to represent states or indicate
    conditions dependant on the* true *decision variables, ğ›¿áµ¢â±¼. As youâ€™ll see in the
    next articles, choosing the rank variables to extract the tour works for a pure
    TSP model, but wonâ€™t work for extensions of it that make it* optional *to visit
    some sites. Hence, if we extract the solution from ğ›¿áµ¢â±¼,* ***our approach will
    be general and re-usable, no matter how complex the model weâ€™re using****.*'
  id: totrans-87
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*å¦‚æœæˆ‘ä»¬çš„å”¯ä¸€ç›®æ ‡æ˜¯è§£å†³TSPé—®é¢˜ï¼Œè€Œä¸è€ƒè™‘* æ‰©å±• *æ¨¡å‹ä»¥æ¶µç›–æˆ‘ä»¬å®é™…é—®é¢˜çš„æ›´å¤šç»†èŠ‚ï¼Œä½¿ç”¨æ’åå˜é‡æ¥æå–æœ€ä¼˜æ—…è¡Œè·¯å¾„å°±è¶³å¤Ÿäº†ã€‚ç„¶è€Œï¼Œç”±äºTSPä»…ä»…æ˜¯*
    ***å°†æˆä¸ºæ›´å¤æ‚æ¨¡å‹çš„åˆå§‹åŸå‹****ï¼Œæˆ‘ä»¬æœ€å¥½ä»å¼§å†³ç­–å˜é‡ğ›¿áµ¢â±¼ä¸­æå–è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºä»»ä½•æ¶‰åŠè·¯ç”±å†³ç­–çš„æ¨¡å‹ä¸­éƒ½ä¼šåŒ…å«è¿™äº›å˜é‡ã€‚å…¶ä»–å†³ç­–å˜é‡æ˜¯è¾…åŠ©çš„ï¼Œå½“éœ€è¦æ—¶ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯è¡¨ç¤ºçŠ¶æ€æˆ–æŒ‡ç¤ºä¾èµ–äº*
    çœŸå® *å†³ç­–å˜é‡ğ›¿áµ¢â±¼çš„æ¡ä»¶ã€‚æ­£å¦‚ä½ å°†åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­çœ‹åˆ°çš„ï¼Œé€‰æ‹©æ’åå˜é‡æ¥æå–æ—…è¡Œè·¯å¾„é€‚ç”¨äºçº¯TSPæ¨¡å‹ï¼Œä½†å¯¹äºé‚£äº›ä½¿è®¿é—®æŸäº›ç«™ç‚¹* å¯é€‰ *çš„æ‰©å±•åˆ™ä¸é€‚ç”¨ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä»ğ›¿áµ¢â±¼ä¸­æå–è§£å†³æ–¹æ¡ˆï¼Œ*
    ***æˆ‘ä»¬çš„æ–¹æ³•å°†æ˜¯é€šç”¨å’Œå¯é‡å¤ä½¿ç”¨çš„ï¼Œæ— è®ºæˆ‘ä»¬ä½¿ç”¨å¤šä¹ˆå¤æ‚çš„æ¨¡å‹****ã€‚*'
- en: The benefits of this approach will become apparent in the following articles,
    where new requirements are added, and thus additional variables are needed inside
    the model. With the *why* covered, letâ€™s jump into the *how*.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç§æ–¹æ³•çš„å¥½å¤„å°†åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­æ˜¾ç°å‡ºæ¥ï¼Œè¿™äº›æ–‡ç« ä¸­å¢åŠ äº†æ–°çš„è¦æ±‚ï¼Œå› æ­¤æ¨¡å‹ä¸­éœ€è¦é¢å¤–çš„å˜é‡ã€‚åœ¨*ä¸ºä»€ä¹ˆ*éƒ¨åˆ†è®²è§£å®Œæ¯•åï¼Œè®©æˆ‘ä»¬è¿›å…¥*å¦‚ä½•*éƒ¨åˆ†ã€‚
- en: '**4.2.1 Extracting the optimal tour from the model**'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: '**4.2.1 ä»æ¨¡å‹ä¸­æå–æœ€ä¼˜æ—…è¡Œè·¯å¾„**'
- en: '**We have** the variable ğ›¿áµ¢â±¼, indexed by possible arcs (i, j), where ğ›¿áµ¢â±¼=0
    means the arc is not selected and ğ›¿áµ¢â±¼=1 means the arc is selected.'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**æˆ‘ä»¬æœ‰**å˜é‡ğ›¿áµ¢â±¼ï¼ŒæŒ‰å¯èƒ½çš„å¼§ï¼ˆi, jï¼‰ç´¢å¼•ï¼Œå…¶ä¸­ğ›¿áµ¢â±¼=0è¡¨ç¤ºå¼§æœªè¢«é€‰æ‹©ï¼Œğ›¿áµ¢â±¼=1è¡¨ç¤ºå¼§è¢«é€‰æ‹©ã€‚'
- en: '**We want** a dataframe where the sites are in the index (as in our input `df_sites`),
    and where the stop number is indicated in the column `"visit_order"`.'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**æˆ‘ä»¬æƒ³è¦**ä¸€ä¸ªæ•°æ®æ¡†ï¼Œå…¶ä¸­ç«™ç‚¹ä½äºç´¢å¼•ä¸­ï¼ˆå¦‚æˆ‘ä»¬çš„è¾“å…¥`df_sites`æ‰€ç¤ºï¼‰ï¼Œå¹¶ä¸”åœé ç‚¹ç¼–å·åœ¨åˆ— `"visit_order"`ä¸­æŒ‡ç¤ºã€‚'
- en: '**We write** a method to extract such dataframe from the fitted optimizer.
    These are the steps weâ€™ll follow, with each step encapsulated in its own helper
    method(s):'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**æˆ‘ä»¬ç¼–å†™**ä¸€ä¸ªæ–¹æ³•ä»æ‹Ÿåˆçš„ä¼˜åŒ–å™¨ä¸­æå–è¿™æ ·çš„æ•°æ®æ¡†ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬å°†éµå¾ªçš„æ­¥éª¤ï¼Œæ¯ä¸€æ­¥éƒ½å°è£…åœ¨è‡ªå·±çš„è¾…åŠ©æ–¹æ³•ä¸­ï¼š'
- en: Extract the selected arcs from ğ›¿áµ¢â±¼, which represents the tour. Done in `_get_selected_arcs_from_model`.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä»ğ›¿áµ¢â±¼ä¸­æå–æ‰€é€‰çš„å¼§ï¼Œğ›¿áµ¢â±¼è¡¨ç¤ºæ—…è¡Œè·¯å¾„ã€‚å®Œæˆåœ¨`_get_selected_arcs_from_model`ä¸­ã€‚
- en: Convert the list of arcs (edges) into a list of stops (nodes). Done in `_get_stops_order_list`.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å°†å¼§ï¼ˆè¾¹ï¼‰åˆ—è¡¨è½¬æ¢ä¸ºåœé ç‚¹ï¼ˆèŠ‚ç‚¹ï¼‰åˆ—è¡¨ã€‚å®Œæˆåœ¨`_get_stops_order_list`ä¸­ã€‚
- en: Convert the list of stops into a dataframe with a consistent structure. Done
    in `_get_tour_stops_dataframe`.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å°†åœé ç‚¹åˆ—è¡¨è½¬æ¢ä¸ºå…·æœ‰ä¸€è‡´ç»“æ„çš„æ•°æ®æ¡†ã€‚å®Œæˆåœ¨`_get_tour_stops_dataframe`ä¸­ã€‚
- en: As the selected arcs are mixed (*i.e.*, not in â€œtraversing orderâ€), getting
    a list of ordered stops is not that straight-forward. To avoid convoluted code,
    we exploit the fact that the arcs represent a *graph*, and we use the graph object
    `G_tour` to traverse the tour nodes in order, arriving at the list easily.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºæ‰€é€‰å¼§æ˜¯æ··åˆçš„ï¼ˆ*å³*ï¼Œä¸æŒ‰â€œéå†é¡ºåºâ€ï¼‰ï¼Œè·å¾—æœ‰åºçš„åœé ç‚¹åˆ—è¡¨å¹¶ä¸é‚£ä¹ˆç›´æ¥ã€‚ä¸ºäº†é¿å…å¤æ‚çš„ä»£ç ï¼Œæˆ‘ä»¬åˆ©ç”¨å¼§è¡¨ç¤º*å›¾*çš„äº‹å®ï¼Œä½¿ç”¨å›¾å¯¹è±¡`G_tour`æŒ‰é¡ºåºéå†æ—…è¡Œè·¯å¾„èŠ‚ç‚¹ï¼Œä»è€Œè½»æ¾åœ°å¾—åˆ°åˆ—è¡¨ã€‚
- en: '[PRE8]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Letâ€™s see what this new method gives us:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ–°æ–¹æ³•ç»™äº†æˆ‘ä»¬ä»€ä¹ˆï¼š
- en: '[PRE9]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](../Images/dc75bd513f652b2d63c68f741e8680e4.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/dc75bd513f652b2d63c68f741e8680e4.png)'
- en: '**Figure 4**. Solution (optimal tour) as ranked sites (Image by Author)'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '**å›¾ 4**ã€‚è§£å†³æ–¹æ¡ˆï¼ˆæœ€ä¼˜æ—…è¡Œè·¯å¾„ï¼‰æŒ‰æ’åç«™ç‚¹ï¼ˆå›¾ç”±ä½œè€…æä¾›ï¼‰'
- en: The `visit_order` column indicates we should go from the hotel to Notre Dame,
    then to the Louvre, and so on, until the last stop before closing the tour, Sacre
    Coeur. After that, it's trivial that one must return to the hotel. Good, now we
    have the solution in a format easy to interpret and work with. But the sequence
    of stops is not all we care about. **The value of the objective function is also
    an important metric to keep track of**, as it's the criterion guiding our decisions.
    For our particular case of the TSP, this means getting the total distance of the
    optimal tour.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '`visit_order`åˆ—è¡¨æ˜æˆ‘ä»¬åº”è¯¥ä»é…’åº—å‰å¾€å·´é»åœ£æ¯é™¢ï¼Œç„¶ååˆ°å¢æµ®å®«ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°æœ€åä¸€ä¸ªåœé ç‚¹ï¼Œè’™é©¬ç‰¹é«˜åœ°ã€‚ä¹‹åï¼Œæ˜¾ç„¶å¿…é¡»è¿”å›é…’åº—ã€‚å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ˜“äºè§£é‡Šå’Œä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆæ ¼å¼ã€‚ä½†åœé ç‚¹çš„é¡ºåºå¹¶ä¸æ˜¯æˆ‘ä»¬å”¯ä¸€å…³å¿ƒçš„ã€‚**ç›®æ ‡å‡½æ•°çš„å€¼ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„æŒ‡æ ‡**ï¼Œå› ä¸ºå®ƒæ˜¯æŒ‡å¯¼æˆ‘ä»¬å†³ç­–çš„æ ‡å‡†ã€‚å¯¹äºæˆ‘ä»¬ç‰¹åˆ«çš„TSPé—®é¢˜ï¼Œè¿™æ„å‘³ç€è·å–æœ€ä¼˜è·¯çº¿çš„æ€»è·ç¦»ã€‚'
- en: '**4.2.2 Extracting the optimal objective from the model**'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '**4.2.2 ä»æ¨¡å‹ä¸­æå–æœ€ä¼˜ç›®æ ‡**'
- en: In the same manner that we didnâ€™t use the rank variables to extract the sequence
    of stops because in more complex models their values wouldnâ€™t coincide with the
    tour stops, we wonâ€™t use the objective function *directly* to obtain the total
    distance of the tour, even though, here too, both measures are equivalent. **In
    more complex models, the objective function will also incorporate other targets**,
    so this equivalence will no longer hold.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: å°±åƒæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨æ’åå˜é‡æ¥æå–åœé ç‚¹åºåˆ—ä¸€æ ·ï¼Œå› ä¸ºåœ¨æ›´å¤æ‚çš„æ¨¡å‹ä¸­ï¼Œå®ƒä»¬çš„å€¼ä¸ä¼šä¸è·¯çº¿åœé ç‚¹ä¸€è‡´ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼š*ç›´æ¥*ä½¿ç”¨ç›®æ ‡å‡½æ•°æ¥è·å¾—è·¯çº¿çš„æ€»è·ç¦»ï¼Œå°½ç®¡åœ¨è¿™é‡Œè¿™ä¸¤ç§æµ‹é‡éƒ½æ˜¯ç­‰æ•ˆçš„ã€‚**åœ¨æ›´å¤æ‚çš„æ¨¡å‹ä¸­ï¼Œç›®æ ‡å‡½æ•°è¿˜ä¼šåŒ…å«å…¶ä»–ç›®æ ‡**ï¼Œå› æ­¤è¿™ç§ç­‰æ•ˆæ€§å°†ä¸å†æˆç«‹ã€‚
- en: 'For now, weâ€™ll keep it simple and create a non-public method, `_get_tour_total_distance`,
    which clearly indicates the intent. The details of where this distance comes from
    are hidden, and will depend on the particular targets that more advanced models
    care about. For now, the details are simple: get the objective value of the solved
    model.'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¿æŒç®€å•ï¼Œåˆ›å»ºä¸€ä¸ªéå…¬å¼€æ–¹æ³•`_get_tour_total_distance`ï¼Œè¿™æ˜ç¡®è¡¨ç¤ºäº†æ„å›¾ã€‚è¿™ä¸ªè·ç¦»æ¥æºçš„ç»†èŠ‚æ˜¯éšè—çš„ï¼Œå¹¶ä¸”ä¼šä¾èµ–äºæ›´é«˜çº§æ¨¡å‹å…³å¿ƒçš„ç‰¹å®šç›®æ ‡ã€‚ç›®å‰ï¼Œç»†èŠ‚å¾ˆç®€å•ï¼šè·å–è§£å†³æ¨¡å‹çš„ç›®æ ‡å€¼ã€‚
- en: '[PRE10]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'It may look superfluous now, but itâ€™ll serve as a reminder to our future selves
    that there is a design for grabbing objective values weâ€™d better follow. Letâ€™s
    check it:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨çœ‹èµ·æ¥å¯èƒ½æœ‰äº›å¤šä½™ï¼Œä½†å®ƒå°†ä½œä¸ºä¸€ä¸ªæé†’ï¼Œå‘Šè¯‰æˆ‘ä»¬æœªæ¥çš„è‡ªå·±ï¼Œåº”è¯¥éµå¾ªæŠ“å–ç›®æ ‡å€¼çš„è®¾è®¡ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ï¼š
- en: '[PRE11]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Itâ€™s around 14.9 km. As both the optimal tour and its distance are important,
    letâ€™s make the optimizer store them together whenever the `_fit_to_distances`
    method gets called, **and only when an optimal solution is found**.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: æ€»è·ç¦»çº¦ä¸º14.9å…¬é‡Œã€‚ç”±äºæœ€ä¼˜è·¯çº¿åŠå…¶è·ç¦»éƒ½å¾ˆé‡è¦ï¼Œè®©æˆ‘ä»¬ä½¿ä¼˜åŒ–å™¨åœ¨æ¯æ¬¡è°ƒç”¨`_fit_to_distances`æ–¹æ³•æ—¶ï¼Œå°†å®ƒä»¬ä¸€èµ·å­˜å‚¨ï¼Œ**å¹¶ä¸”åªæœ‰åœ¨æ‰¾åˆ°æœ€ä¼˜è§£æ—¶**ã€‚
- en: '**4.2.3 Storing the solution in attributes**'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '**4.2.3 å°†è§£å†³æ–¹æ¡ˆå­˜å‚¨åœ¨å±æ€§ä¸­**'
- en: 'In the implementation of `_fit_to_distances` above, we just created a model
    and solved it, we didn''t do any parsing of the solution stored inside the model.
    Now, we''ll modify `_fit_to_distances` so that **when the model solution succeeds,
    two new attributes are created and made available** with the two relevant parts
    of the solution: the `tour_` and the `tour_distance_`. To make it simple, the
    `tour_` attribute won''t return the dataframe we did earlier, it will return the
    list with ordered stops. The new method `_store_solution_from_model` takes care
    of this.'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸Šé¢çš„`_fit_to_distances`å®ç°ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ¨¡å‹å¹¶è§£å†³äº†å®ƒï¼Œæ²¡æœ‰å¯¹æ¨¡å‹ä¸­å­˜å‚¨çš„è§£å†³æ–¹æ¡ˆè¿›è¡Œä»»ä½•è§£æã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¿®æ”¹`_fit_to_distances`ï¼Œ**ä»¥ä¾¿å½“æ¨¡å‹è§£å†³æ–¹æ¡ˆæˆåŠŸæ—¶ï¼Œä¼šåˆ›å»ºå¹¶æä¾›ä¸¤ä¸ªæ–°çš„å±æ€§**ï¼Œå³è§£å†³æ–¹æ¡ˆçš„ä¸¤ä¸ªç›¸å…³éƒ¨åˆ†ï¼š`tour_`å’Œ`tour_distance_`ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œ`tour_`å±æ€§ä¸ä¼šè¿”å›æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„æ•°æ®æ¡†ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæŒ‰é¡ºåºæ’åˆ—çš„åœé ç‚¹åˆ—è¡¨ã€‚æ–°çš„æ–¹æ³•`_store_solution_from_model`è´Ÿè´£è¿™ä¸ªä»»åŠ¡ã€‚
- en: '[PRE12]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Letâ€™s fit the optimizer again to the distance data and see how easy it is to
    get the solution now:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å†æ¬¡å°†ä¼˜åŒ–å™¨æ‹Ÿåˆåˆ°è·ç¦»æ•°æ®ä¸Šï¼Œçœ‹çœ‹ç°åœ¨è·å–è§£å†³æ–¹æ¡ˆæœ‰å¤šå®¹æ˜“ï¼š
- en: '[PRE13]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Nice. But we can do even better. To further **increase the usability of this
    class**, letâ€™s allow the user to solve the problem by only providing the dataframe
    of sites coordinates. As not everyone will be able to collect a distance matrix
    for their sites of interest, the class can take care of it and provide an approximate
    distance matrix. This was done above in section 3.2 with the `GeoAnalyzer`, here
    we just put it under the new `fit` method:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: å¾ˆå¥½ã€‚ä½†æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ã€‚ä¸ºäº†è¿›ä¸€æ­¥**æé«˜è¿™ä¸ªç±»çš„å¯ç”¨æ€§**ï¼Œè®©æˆ‘ä»¬å…è®¸ç”¨æˆ·ä»…æä¾›ç«™ç‚¹åæ ‡çš„æ•°æ®æ¡†æ¥è§£å†³é—®é¢˜ã€‚ç”±äºä¸æ˜¯æ¯ä¸ªäººéƒ½èƒ½ä¸ºä»–ä»¬æ„Ÿå…´è¶£çš„ç«™ç‚¹æ”¶é›†è·ç¦»çŸ©é˜µï¼Œç±»å¯ä»¥å¤„ç†è¿™ä¸ªé—®é¢˜å¹¶æä¾›ä¸€ä¸ªè¿‘ä¼¼çš„è·ç¦»çŸ©é˜µã€‚è¿™åœ¨ç¬¬3.2èŠ‚ä¸­é€šè¿‡`GeoAnalyzer`å®ç°äº†ï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯å°†å…¶æ”¾åœ¨æ–°çš„`fit`æ–¹æ³•ä¸‹ï¼š
- en: '[PRE14]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'And now we have achieved our goal: **find the optimal tour from just the sites
    locations** (and not from the distances as before):'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®æ ‡ï¼š**ä»ä»…ä»…æ˜¯ç«™ç‚¹ä½ç½®ä¸­æ‰¾åˆ°æœ€ä½³æ—…è¡Œè·¯çº¿**ï¼ˆè€Œä¸æ˜¯åƒä»¥å‰é‚£æ ·ä»è·ç¦»ä¸­æ‰¾åˆ°ï¼‰ï¼š
- en: '[PRE15]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 4.3\. `TravelingSalesmanOptimizer` for dummies
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4.3. `TravelingSalesmanOptimizer` ç®€æ˜æŒ‡å—
- en: 'Congratulations! We reached the point where the optimizer is very intuitive
    to use. For mere convenience, Iâ€™ll add another method that will be quite helpful
    later on when we do [sensitivity analysis] and compare the results of different
    models. The optimizer, as it is now, tells me the optimal visit order in a list,
    or in a separate dataframe returned by `get_tour_stops_dataframe()`, but I''d
    like it to tell me **the visit order by *transforming* the locations dataframe**
    that I give it directlyâ€”by returning the same dataframe with a new column having
    the optimal sequence of stops. The method `fit_prescribe` will be in charge of
    this:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: æ­å–œï¼æˆ‘ä»¬å·²ç»è¾¾åˆ°äº†ä¼˜åŒ–å™¨éå¸¸ç›´è§‚çš„ä½¿ç”¨é˜¶æ®µã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘å°†æ·»åŠ å¦ä¸€ç§æ–¹æ³•ï¼Œè¿™åœ¨æˆ‘ä»¬åš[æ•æ„Ÿæ€§åˆ†æ]å’Œæ¯”è¾ƒä¸åŒæ¨¡å‹çš„ç»“æœæ—¶ä¼šéå¸¸æœ‰ç”¨ã€‚ä¼˜åŒ–å™¨ç°åœ¨ä¼šä»¥åˆ—è¡¨æˆ–ç”±`get_tour_stops_dataframe()`è¿”å›çš„å•ç‹¬æ•°æ®æ¡†çš„å½¢å¼å‘Šè¯‰æˆ‘æœ€ä½³çš„è®¿é—®é¡ºåºï¼Œä½†æˆ‘å¸Œæœ›å®ƒèƒ½å‘Šè¯‰æˆ‘**é€šè¿‡*è½¬æ¢*æˆ‘ç›´æ¥æä¾›çš„ä½ç½®æ•°æ®æ¡†**çš„è®¿é—®é¡ºåºâ€”â€”å³è¿”å›å…·æœ‰æœ€ä½³åœé é¡ºåºçš„æ–°åˆ—çš„æ•°æ®æ¡†ã€‚æ–¹æ³•`fit_prescribe`å°†è´Ÿè´£è¿™ä¸€ç‚¹ï¼š
- en: '[PRE16]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Now we can solve any TSP in just **one line**:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨**ä¸€è¡Œä»£ç **è§£å†³ä»»ä½• TSP é—®é¢˜ï¼š
- en: '[PRE17]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![](../Images/5d2606e413b5c613d32d084a580c17d1.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/5d2606e413b5c613d32d084a580c17d1.png)'
- en: '**Figure 6**. Solution (optimal tour) appended to dataframe of sites (Image
    by Author)'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '**å›¾ 6**ã€‚è§£å†³æ–¹æ¡ˆï¼ˆæœ€ä½³æ—…è¡Œè·¯çº¿ï¼‰é™„åŠ åˆ°ç«™ç‚¹æ•°æ®æ¡†ä¸­ï¼ˆå›¾åƒæ¥æºäºä½œè€…ï¼‰'
- en: 'If weâ€™d like to conserve the original order of locations as they were in `df_sites`,
    we can do it by specifying `sort=False`:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬æƒ³ä¿æŒä½ç½®çš„åŸå§‹é¡ºåºï¼Œå°±åƒå®ƒä»¬åœ¨`df_sites`ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®š`sort=False`æ¥å®ç°ï¼š
- en: '[PRE18]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![](../Images/fba80c8ddb8a99700fb200517675ec64.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/fba80c8ddb8a99700fb200517675ec64.png)'
- en: '**Figure 7**. Solution appended to dataframe of sites, sites order preserved
    (Image by Author)'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '**å›¾ 7**ã€‚è§£å†³æ–¹æ¡ˆé™„åŠ åˆ°ç«™ç‚¹æ•°æ®æ¡†ä¸­ï¼Œç«™ç‚¹é¡ºåºä¿æŒä¸å˜ï¼ˆå›¾åƒæ¥æºäºä½œè€…ï¼‰'
- en: And if weâ€™re curious we can also check the number of variables and constraints
    the internal model needed to solve our particular instance of the TSP. This will
    be handy when doing debugging or performance analysis.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬å¥½å¥‡çš„è¯ï¼Œä¹Ÿå¯ä»¥æ£€æŸ¥å†…éƒ¨æ¨¡å‹åœ¨è§£å†³æˆ‘ä»¬ç‰¹å®šçš„ TSP å®ä¾‹æ—¶æ‰€éœ€çš„å˜é‡å’Œçº¦æŸæ•°é‡ã€‚è¿™åœ¨è¿›è¡Œè°ƒè¯•æˆ–æ€§èƒ½åˆ†ææ—¶ä¼šå¾ˆæœ‰ç”¨ã€‚
- en: '[PRE19]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '5\. Beyond the optimal solution: extracting insights with the optimizer'
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 5. è¶…è¶Šæœ€ä½³è§£å†³æ–¹æ¡ˆï¼šåˆ©ç”¨ä¼˜åŒ–å™¨æå–è§è§£
- en: Before we close this article, I would like to show you some brief examples of
    how easy it is to use this class, **not just to solve TSP problems, but to also
    answer general questions that usually arise when planning a trip**.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æˆ‘ä»¬ç»“æŸæœ¬æ–‡ä¹‹å‰ï¼Œæˆ‘æƒ³ç»™ä½ å±•ç¤ºä¸€äº›ç®€çŸ­çš„ä¾‹å­ï¼Œè¯´æ˜ä½¿ç”¨è¿™ä¸ªç±»æ˜¯å¤šä¹ˆç®€å•ï¼Œ**ä¸ä»…å¯ä»¥è§£å†³ TSP é—®é¢˜ï¼Œè¿˜èƒ½å›ç­”è§„åˆ’æ—…è¡Œæ—¶é€šå¸¸ä¼šå‡ºç°çš„ä¸€èˆ¬é—®é¢˜**ã€‚
- en: 'For example, suppose you have already come up with a list of sites to visit
    in one day of your trip to Paris, and you have them in a dataframe called `df_sites`.
    You''d like to know *only* the total length of the optimal tour to traverse them
    all. You don''t have to go to *great lengths* to know that; this one-liner has
    you covered:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚ï¼Œå‡è®¾ä½ å·²ç»åˆ¶å®šäº†ä¸€ä»½ä¸€å¤©å†…åœ¨å·´é»æ—…è¡Œä¸­è¦è®¿é—®çš„ç«™ç‚¹æ¸…å•ï¼Œå¹¶å°†å®ƒä»¬æ”¾åœ¨åä¸º`df_sites`çš„æ•°æ®æ¡†ä¸­ã€‚ä½ æƒ³çŸ¥é“*ä»…ä»…*æ˜¯éå†å®ƒä»¬çš„æœ€ä½³æ—…è¡Œè·¯çº¿çš„æ€»é•¿åº¦ã€‚ä½ ä¸éœ€è¦å»*æå¤§åœ°*äº†è§£è¿™ä¸€ç‚¹ï¼›è¿™è¡Œä»£ç å°±å¯ä»¥è§£å†³ï¼š
- en: '[PRE20]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Now suppose youâ€™re not very sure of your set of sites, and are thinking of
    trimming it down a little. You are pondering over skipping the visit to *Arc de
    Triomphe*, as it is far from the hotel. **You may wonder: â€œHow much does the optimal
    tour change if I donâ€™t go to this site?â€**. Thanks to the optimizer, getting the
    answer is straightforward:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨å‡è®¾ä½ å¯¹ä½ çš„ç«™ç‚¹é›†åˆä¸æ˜¯å¾ˆç¡®å®šï¼Œè€ƒè™‘ç¨å¾®ç¼©å‡ä¸€ä¸‹ã€‚ä½ æ­£åœ¨è€ƒè™‘è·³è¿‡å¯¹*å‡¯æ—‹é—¨*çš„è®¿é—®ï¼Œå› ä¸ºå®ƒç¦»é…’åº—å¾ˆè¿œã€‚**ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå¦‚æœæˆ‘ä¸å»è¿™ä¸ªç«™ç‚¹ï¼Œæœ€ä½³æ—…è¡Œè·¯çº¿ä¼šå˜åŒ–å¤šå°‘ï¼Ÿâ€**ã€‚æ„Ÿè°¢ä¼˜åŒ–å™¨ï¼Œå¾—åˆ°ç­”æ¡ˆéå¸¸ç®€å•ï¼š
- en: '[PRE21]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: With this, you know that you would save around 768 m of walking if you skipped
    *Arc de Triomphe*. Itâ€™s up to you to decide whether thatâ€™s worth it or not.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡è¿™ä¸ªï¼Œä½ å¯ä»¥çŸ¥é“å¦‚æœä½ è·³è¿‡*å‡¯æ—‹é—¨*ï¼Œä½ å°†èŠ‚çœå¤§çº¦ 768 ç±³çš„æ­¥è¡Œè·ç¦»ã€‚æ˜¯å¦å€¼å¾—å°±ç”±ä½ æ¥å†³å®šã€‚
- en: '**Itâ€™s not just about optimal routes: we can find â€œoptimalâ€ hotels too!**'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '**è¿™ä¸ä»…ä»…æ˜¯å…³äºæœ€ä½³è·¯çº¿ï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰¾åˆ°â€œæœ€ä½³â€é…’åº—ï¼**'
- en: 'As another practical example, imagine that you have settled with a list of
    sites to visit, but havenâ€™t picked a hotel yet. You have several options, and
    in order to decide better, **you would like to know how each choice of hotel impacts
    the total distance of the tour youâ€™ll make**. Then itâ€™s just a matter of **fitting
    another optimizer** with a sites dataframe containing the new candidate hotel,
    **and comparing the optimal distance with the optimal distance of using the initial
    hotel**:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œä¸ºå¦ä¸€ä¸ªå®é™…ç¤ºä¾‹ï¼Œå‡è®¾ä½ å·²ç»ç¡®å®šäº†è¦è®¿é—®çš„æ™¯ç‚¹åˆ—è¡¨ï¼Œä½†è¿˜æ²¡æœ‰é€‰æ‹©é…’åº—ã€‚ä½ æœ‰å‡ ä¸ªé€‰æ‹©ï¼Œä¸ºäº†æ›´å¥½åœ°å†³ç­–ï¼Œ**ä½ æƒ³çŸ¥é“æ¯ä¸ªé…’åº—é€‰æ‹©å¯¹ä½ å°†è¦è¿›è¡Œçš„æ—…è¡Œæ€»è·ç¦»çš„å½±å“**ã€‚ç„¶åï¼Œè¿™åªæ˜¯**ç”¨åŒ…å«æ–°å€™é€‰é…’åº—çš„æ™¯ç‚¹æ•°æ®æ¡†æ‹Ÿåˆå¦ä¸€ä¸ªä¼˜åŒ–å™¨**ï¼Œ**å¹¶å°†æœ€ä½³è·ç¦»ä¸ä½¿ç”¨åˆå§‹é…’åº—çš„æœ€ä½³è·ç¦»è¿›è¡Œæ¯”è¾ƒ**ï¼š
- en: '[PRE22]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The conclusion is that **if we choose â€œhotel 2â€, we will have to *walk 2.8 km
    more* than if we chose â€œhotel 1â€**, on a tour traversing the same set of sites.
    All other things being equal, this informs us that â€œhotel 1â€ is a better choice
    than â€œhotel 2â€ (*given* the sites we want to visit).
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: ç»“è®ºæ˜¯ï¼Œ**å¦‚æœæˆ‘ä»¬é€‰æ‹©â€œé…’åº—2â€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†æ¯”é€‰æ‹©â€œé…’åº—1â€å¤š*æ­¥è¡Œ2.8å…¬é‡Œ*ï¼Œåœ¨ç©¿è¶Šç›¸åŒæ™¯ç‚¹çš„æ—…æ¸¸ä¸­**ã€‚åœ¨å…¶ä»–æ¡ä»¶ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬â€œé…’åº—1â€æ¯”â€œé…’åº—2â€æ›´ä½³é€‰æ‹©ï¼ˆ*è€ƒè™‘åˆ°*æˆ‘ä»¬æƒ³å‚è§‚çš„æ™¯ç‚¹ï¼‰ã€‚
- en: 6\. Conclusion (or planning for next sprint)
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 6\. ç»“è®ºï¼ˆæˆ–è®¡åˆ’ä¸‹ä¸€ä¸ªè¿­ä»£ï¼‰
- en: In this article, we have created two new classes (`BaseOptimizer` and `TravelingSalesmanOptimizer`).
    In future sprints, we'll be using them, extending them, and adding more advanced
    optimizers to the toolkit, so to do things cleanly, let's move them to a new module,
    `routimizers.py`.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªæ–°ç±»ï¼ˆ`BaseOptimizer` å’Œ `TravelingSalesmanOptimizer`ï¼‰ã€‚åœ¨æœªæ¥çš„è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒä»¬ã€æ‰©å±•å®ƒä»¬ï¼Œå¹¶å°†æ›´é«˜çº§çš„ä¼˜åŒ–å™¨æ·»åŠ åˆ°å·¥å…·åŒ…ä¸­ï¼Œæ‰€ä»¥ä¸ºäº†åšåˆ°å¹²å‡€æ•´æ´ï¼Œè®©æˆ‘ä»¬å°†å®ƒä»¬ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°æ¨¡å—`routimizers.py`ä¸­ã€‚
- en: Now, one final thing to keep in mind is the scope of this MVP. This first optimizer
    gives us the answer to the question â€œin which **order** should I visit the sites?â€,
    but it doesnâ€™t tell us *how to go* from one site to the next. That is fine, as
    thatâ€™s the job of GIS applications like Google Maps, not of our humble optimizer.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œæœ€åä¸€ç‚¹éœ€è¦è®°ä½çš„æ˜¯è¿™ä¸ªMVPçš„èŒƒå›´ã€‚è¿™ä¸ªåˆå§‹ä¼˜åŒ–å™¨ç»™å‡ºäº†â€œ**æˆ‘åº”è¯¥ä»¥ä»€ä¹ˆ**é¡ºåºè®¿é—®è¿™äº›æ™¯ç‚¹ï¼Ÿâ€çš„é—®é¢˜çš„ç­”æ¡ˆï¼Œä½†å®ƒæ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬*å¦‚ä½•ä»ä¸€ä¸ªæ™¯ç‚¹åˆ°ä¸‹ä¸€ä¸ªæ™¯ç‚¹*ã€‚è¿™æ²¡å…³ç³»ï¼Œå› ä¸ºè¿™æ­£æ˜¯åƒGoogle
    Mapsè¿™æ ·çš„GISåº”ç”¨ç¨‹åºçš„å·¥ä½œï¼Œè€Œä¸æ˜¯æˆ‘ä»¬è°¦é€Šçš„ä¼˜åŒ–å™¨ã€‚
- en: '***ğŸ‘*** *Our optimizer solves the* ***tactical*** *problem of telling us the
    optimal* sequence of stops *on a tour, not the* ***operational*** *problem of
    guiding us along that tour. The latter problem is easily solvable by many great
    GIS applications, like Google Maps.*'
  id: totrans-146
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***ğŸ‘*** *æˆ‘ä»¬çš„ä¼˜åŒ–å™¨è§£å†³äº†* ***æˆ˜æœ¯*** *é—®é¢˜ï¼Œå³å‘Šè¯‰æˆ‘ä»¬åœ¨æ—…æ¸¸ä¸­æœ€ä½³çš„* åœç•™é¡ºåºï¼Œ*è€Œä¸æ˜¯* ***æ“ä½œæ€§*** *é—®é¢˜ï¼Œå³å¼•å¯¼æˆ‘ä»¬å®Œæˆè¿™æ¬¡æ—…è¡Œã€‚åè€…é—®é¢˜å¯ä»¥é€šè¿‡è®¸å¤šä¼˜ç§€çš„GISåº”ç”¨ç¨‹åºè½»æ¾è§£å†³ï¼Œä¾‹å¦‚Google
    Mapsã€‚*'
- en: 'If youâ€™re happy with the result (the tour), and youâ€™d like to actually implement
    it in *real life*, itâ€™s easy: go straight to Google Maps and introduce these sites
    as stops in the *order specified by the optimizer*. Hit â€œgoâ€ and there you have
    your *operational* answer.'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ å¯¹ç»“æœï¼ˆæ—…è¡Œï¼‰æ„Ÿåˆ°æ»¡æ„ï¼Œå¹¶ä¸”æƒ³è¦åœ¨*ç°å®ç”Ÿæ´»ä¸­*å®é™…å®ç°å®ƒï¼Œé‚£ä¹ˆå¾ˆç®€å•ï¼šç›´æ¥å»Google Mapsï¼Œå°†è¿™äº›æ™¯ç‚¹æŒ‰*ä¼˜åŒ–å™¨æŒ‡å®šçš„é¡ºåº*è¾“å…¥ä¸ºåœç•™ç‚¹ã€‚ç‚¹å‡»â€œå¼€å§‹â€ï¼Œä½ å°±èƒ½å¾—åˆ°*æ“ä½œæ€§*ç­”æ¡ˆã€‚
- en: 'Nevertheless, it still feels like one should be able to *visualize* the results,
    not just be content with the numbers that the optimizer puts in a new column;
    if not for the implementation in real life, at least for a better understanding
    of the solutions. In sprint 3 we did [visualize the solution a bit](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=valuable%20final%20check.-,4.2.%20Plotting%20the%20augmented%20model%E2%80%99s%20solution,-Let%E2%80%99s%20solve%20the),
    even without having the coordinates. Now that we *do have* the coordinates of
    the sites, we can do much better and visualize the resulting optimal tours in
    a more realistic fashion. That is precisely the goal of [our next sprint](/visualizing-routes-on-interactive-maps-with-python-part-1-44f8d25d0761):
    **to create nice visuals that enable us to better understand the solutions** (tours)
    **provided by the optimizer**, and, in the process, ask and answer more and better
    questions that allow us to plan better trips. Grab a cup of coffee, and jump right
    in:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œä»ç„¶æ„Ÿè§‰åº”è¯¥èƒ½å¤Ÿ*å¯è§†åŒ–*ç»“æœï¼Œè€Œä¸ä»…ä»…æ»¡è¶³äºä¼˜åŒ–å™¨åœ¨æ–°åˆ—ä¸­æ”¾ç½®çš„æ•°å­—ï¼›å³ä½¿ä¸æ˜¯ä¸ºäº†å®é™…åº”ç”¨ï¼Œä¹Ÿåº”è¯¥æ˜¯ä¸ºäº†æ›´å¥½åœ°ç†è§£è§£å†³æ–¹æ¡ˆã€‚åœ¨ç¬¬ä¸‰æ¬¡å†²åˆºä¸­ï¼Œæˆ‘ä»¬ç¡®å®[ç¨å¾®å¯è§†åŒ–äº†ä¸€ä¸‹è§£å†³æ–¹æ¡ˆ](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=valuable%20final%20check.-,4.2.%20Plotting%20the%20augmented%20model%E2%80%99s%20solution,-Let%E2%80%99s%20solve%20the)ï¼Œå³ä½¿æ²¡æœ‰åæ ‡ã€‚ç°åœ¨æˆ‘ä»¬*ç¡®å®æœ‰*äº†ç«™ç‚¹çš„åæ ‡ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ï¼Œä»¥æ›´ç°å®çš„æ–¹å¼å¯è§†åŒ–æœ€ç»ˆçš„æœ€ä½³è·¯çº¿ã€‚è¿™æ­£æ˜¯[æˆ‘ä»¬ä¸‹ä¸€æ¬¡å†²åˆº](/visualizing-routes-on-interactive-maps-with-python-part-1-44f8d25d0761)çš„ç›®æ ‡ï¼š**åˆ›å»ºå‡ºè‰²çš„è§†è§‰æ•ˆæœï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£ä¼˜åŒ–å™¨æä¾›çš„è§£å†³æ–¹æ¡ˆ**ï¼ˆè·¯çº¿ï¼‰ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­æå‡ºå’Œå›ç­”æ›´å¤šã€æ›´å¥½çš„é—®é¢˜ï¼Œä»è€Œå¸®åŠ©æˆ‘ä»¬è§„åˆ’æ›´å¥½çš„è¡Œç¨‹ã€‚æ‹¿ä¸€æ¯å’–å•¡ï¼Œç›´æ¥å¼€å§‹å§ï¼š
- en: '[](/visualizing-routes-on-interactive-maps-with-python-part-1-44f8d25d0761?source=post_page-----dbb44e7d30b9--------------------------------)
    [## Visualizing Routes on Interactive Maps with Python: Part 1'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '[](/visualizing-routes-on-interactive-maps-with-python-part-1-44f8d25d0761?source=post_page-----dbb44e7d30b9--------------------------------)
    [## ä½¿ç”¨Pythonåœ¨äº’åŠ¨åœ°å›¾ä¸Šå¯è§†åŒ–è·¯çº¿ï¼šç¬¬ä¸€éƒ¨åˆ†'
- en: A pragmatic guide to interactive data visualization for transportation problems
    with Folium
  id: totrans-150
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä¸€ä»½æœ‰å…³è¿è¾“é—®é¢˜çš„äº’åŠ¨æ•°æ®å¯è§†åŒ–çš„åŠ¡å®æŒ‡å—ï¼Œä½¿ç”¨Folium
- en: towardsdatascience.com](/visualizing-routes-on-interactive-maps-with-python-part-1-44f8d25d0761?source=post_page-----dbb44e7d30b9--------------------------------)
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: towardsdatascience.com](/visualizing-routes-on-interactive-maps-with-python-part-1-44f8d25d0761?source=post_page-----dbb44e7d30b9--------------------------------)
- en: '*Footnotes*'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '*è„šæ³¨*'
- en: The benefits of this separation will become apparent in future sprints for problems
    that extend the TSP. [â†©](#7894)
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è¿™ç§åˆ†ç¦»çš„å¥½å¤„å°†åœ¨æœªæ¥çš„å†²åˆºä¸­å˜å¾—æ˜æ˜¾ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹æ‰©å±•TSPçš„é—®é¢˜ã€‚[â†©](#7894)
- en: 'Because our class will optimize decisions, not estimate parameters. Thereâ€™s
    a subtle difference. Granted, `scikit-learn` estimators do carry out an optimization
    under the hood during model training, but the distinction still matters because
    **optimization means different things in Machine Learning and in Operations Research**.
    An *estimator* uses optimization to ***estimate*** the unknown values of the *model
    parameters*, while an *optimizer* uses optimization to ***find*** the optimum
    values of the variables representing *decisions* we need to make. Inside estimators,
    the objective function is always a *loss function,* which measures **the extent
    to which a *predicted* outcome differs from a *true* outcome**. In optimizers
    (or more generally, in OR models) **the objective function** can be arbitrary,
    as it i**s a measure of *our* desired global state of the world**,dependent on
    our decisions. In other words: *in Machine Learning, we seek the* ***optimal model
    parameters*** *that produce the* ***best generalization*** *of the data* we have.
    *In Operations Research*, however, our possible actions are represented in the
    models, so *we seek the* ***optimal actions*** *that will produce the* ***best
    outcome*** *given the resources we have.* The key distinction is that there''s
    no such thing as "true decisions" that need to be "estimated from data" through
    optimization techniques. **Decisions are prescribed *given* the data, not estimated
    *from* the data**. [â†©](#c61f)'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å› ä¸ºæˆ‘ä»¬çš„è¯¾ç¨‹å°†ä¼˜åŒ–å†³ç­–ï¼Œè€Œä¸æ˜¯ä¼°è®¡å‚æ•°ã€‚ä¸¤è€…æœ‰å¾®å¦™çš„å·®åˆ«ã€‚ç¡®å®ï¼Œ`scikit-learn` ä¼°ç®—å™¨åœ¨æ¨¡å‹è®­ç»ƒæœŸé—´ç¡®å®ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œä½†è¿™ç§åŒºåˆ«ä»ç„¶å¾ˆé‡è¦ï¼Œå› ä¸º
    **ä¼˜åŒ–åœ¨æœºå™¨å­¦ä¹ å’Œè¿ç­¹å­¦ä¸­çš„æ„ä¹‰ä¸åŒ**ã€‚ä¸€ä¸ª *ä¼°ç®—å™¨* ä½¿ç”¨ä¼˜åŒ–æ¥ ***ä¼°è®¡*** *æ¨¡å‹å‚æ•°* çš„æœªçŸ¥å€¼ï¼Œè€Œä¸€ä¸ª *ä¼˜åŒ–å™¨* ä½¿ç”¨ä¼˜åŒ–æ¥ ***æ‰¾åˆ°***
    ä»£è¡¨æˆ‘ä»¬éœ€è¦åšçš„ *å†³ç­–* çš„æœ€ä½³å€¼ã€‚åœ¨ä¼°ç®—å™¨ä¸­ï¼Œç›®æ ‡å‡½æ•°å§‹ç»ˆæ˜¯ *æŸå¤±å‡½æ•°*ï¼Œå®ƒè¡¡é‡ **é¢„æµ‹ç»“æœä¸çœŸå®ç»“æœä¹‹é—´çš„å·®å¼‚ç¨‹åº¦**ã€‚åœ¨ä¼˜åŒ–å™¨ä¸­ï¼ˆæˆ–æ›´ä¸€èˆ¬åœ°ï¼Œåœ¨è¿ç­¹å­¦æ¨¡å‹ä¸­ï¼‰**ç›®æ ‡å‡½æ•°**
    å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œå› ä¸ºå®ƒ **æ˜¯è¡¡é‡æˆ‘ä»¬æ‰€æœŸæœ›çš„å…¨çƒçŠ¶æ€çš„æ ‡å‡†**ï¼Œå–å†³äºæˆ‘ä»¬çš„å†³ç­–ã€‚æ¢å¥è¯è¯´ï¼š*åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å¯»æ‰¾* ***æœ€ä½³æ¨¡å‹å‚æ•°*** *ä»¥äº§ç”Ÿ*
    ***æœ€ä½³æ³›åŒ–*** *çš„æ•°æ®*ã€‚ç„¶è€Œï¼Œ*åœ¨è¿ç­¹å­¦ä¸­*ï¼Œæˆ‘ä»¬çš„å¯èƒ½è¡ŒåŠ¨è¢«è¡¨ç¤ºåœ¨æ¨¡å‹ä¸­ï¼Œå› æ­¤ *æˆ‘ä»¬å¯»æ‰¾* ***æœ€ä½³è¡ŒåŠ¨*** *ä»¥äº§ç”Ÿ* ***æœ€ä½³ç»“æœ***
    *åœ¨æˆ‘ä»¬æ‹¥æœ‰çš„èµ„æºä¸‹*ã€‚å…³é”®åŒºåˆ«åœ¨äºæ²¡æœ‰æ‰€è°“çš„â€œçœŸå®å†³ç­–â€éœ€è¦é€šè¿‡ä¼˜åŒ–æŠ€æœ¯ä»æ•°æ®ä¸­â€œä¼°è®¡â€å‡ºæ¥ã€‚**å†³ç­–æ˜¯æ ¹æ®æ•°æ®ç»™å‡ºçš„ï¼Œè€Œä¸æ˜¯ä»æ•°æ®ä¸­ä¼°è®¡çš„**ã€‚[â†©](#c61f)
- en: 'This can happen only due to [two reasons](https://en.wikipedia.org/wiki/Linear_programming#:~:text=An%20optimal%20solution%20need,of%20the%20objective%20function.):
    the model is *infeasible* (the most common), or the model is *unbounded* (less
    common, but possible). [â†©](#97f0)'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'è¿™åªèƒ½å› ä¸º [ä¸¤ä¸ªåŸå› ](https://en.wikipedia.org/wiki/Linear_programming#:~:text=An%20optimal%20solution%20need,of%20the%20objective%20function.):
    æ¨¡å‹æ˜¯ *ä¸å¯è¡Œ*ï¼ˆæœ€å¸¸è§ï¼‰ï¼Œæˆ–è€…æ¨¡å‹æ˜¯ *æ— ç•Œ*ï¼ˆè¾ƒå°‘è§ï¼Œä½†å¯èƒ½ï¼‰ã€‚[â†©](#97f0)'
- en: Thatâ€™s why, when reading the input coordinates into a dataframe, we read the
    coordinates of the hotel first. [â†©](#d459)
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œåœ¨å°†è¾“å…¥åæ ‡è¯»å…¥æ•°æ®æ¡†æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆè¯»å–é…’åº—çš„åæ ‡ã€‚[â†©](#d459)
- en: It is a [technical requirement](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=It%E2%80%99s%20crucial%20that,variable%3A%20the%20hotel)
    that *exactly* one of the sites does not have an associated rank variable (it
    doesnâ€™t matter which, but generally the â€œinitial siteâ€ is picked). As the hotel
    was in the index of the first row of `df_distances`, it was considered the initial
    site and stored inside the Pyomo model (see attribute `tsp.model.initial_site`)
    without an associated rank variable. Remember that the job of the ranks ráµ¢ is
    *not* to indicate the order of visits (that's inherent in ğ›¿áµ¢â±¼), but only to prevent
    the formation of subtours. [â†©](#7f87)
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è¿™æ˜¯ä¸€ä¸ª [æŠ€æœ¯è¦æ±‚](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=It%E2%80%99s%20crucial%20that,variable%3A%20the%20hotel)
    *å‡†ç¡®* åœ°è¯´ï¼Œå…¶ä¸­ä¸€ä¸ªç«™ç‚¹æ²¡æœ‰ç›¸å…³çš„æ’åå˜é‡ï¼ˆå“ªä¸€ä¸ªæ— å…³ç´§è¦ï¼Œä½†é€šå¸¸é€‰æ‹©â€œåˆå§‹ç«™ç‚¹â€ï¼‰ã€‚ç”±äºé…’åº—åœ¨ `df_distances` çš„ç¬¬ä¸€è¡Œçš„ç´¢å¼•ä¸­ï¼Œå› æ­¤è¢«è®¤ä¸ºæ˜¯åˆå§‹ç«™ç‚¹å¹¶å­˜å‚¨åœ¨
    Pyomo æ¨¡å‹ä¸­ï¼ˆè§å±æ€§ `tsp.model.initial_site`ï¼‰ï¼Œæ²¡æœ‰ç›¸å…³çš„æ’åå˜é‡ã€‚è¯·è®°ä½ï¼Œæ’å ráµ¢ çš„å·¥ä½œæ˜¯ *ä¸æ˜¯* æŒ‡ç¤ºè®¿é—®é¡ºåºï¼ˆè¿™åœ¨
    ğ›¿áµ¢â±¼ ä¸­å›ºæœ‰ï¼‰ï¼Œè€Œä»…ä»…æ˜¯é˜²æ­¢å½¢æˆå­å·¡å›ã€‚[â†©](#7f87)
- en: Thanks for reading, and see you in [the next one](/visualizing-routes-on-interactive-maps-with-python-part-1-44f8d25d0761)!
    ğŸ“ˆğŸ˜Š
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: æ„Ÿè°¢é˜…è¯»ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« è§ [è¿™é‡Œ](/visualizing-routes-on-interactive-maps-with-python-part-1-44f8d25d0761)!
    ğŸ“ˆğŸ˜Š
- en: Feel free to follow me, ask me questions, **give me feedback**, or contact me
    on [LinkedIn](https://www.linkedin.com/in/carlosjuribe/).
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: éšæ—¶å¯ä»¥å…³æ³¨æˆ‘ï¼Œå‘æˆ‘æé—®ï¼Œ**ç»™æˆ‘åé¦ˆ**ï¼Œæˆ–é€šè¿‡ [LinkedIn](https://www.linkedin.com/in/carlosjuribe/)
    è”ç³»æˆ‘ã€‚
