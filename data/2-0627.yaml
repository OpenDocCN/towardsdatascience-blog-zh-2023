- en: 'Data Aggregation in Python with Pandas: Analysing Geological Lithology Data'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Pandas进行Python中的数据汇总：分析地质岩性数据
- en: 原文：[https://towardsdatascience.com/data-aggregation-in-python-with-pandas-analysing-geological-lithology-data-94192f5631c0](https://towardsdatascience.com/data-aggregation-in-python-with-pandas-analysing-geological-lithology-data-94192f5631c0)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/data-aggregation-in-python-with-pandas-analysing-geological-lithology-data-94192f5631c0](https://towardsdatascience.com/data-aggregation-in-python-with-pandas-analysing-geological-lithology-data-94192f5631c0)
- en: Exploring lithology variations within the Zechstein Group of the Norwegian Continental
    Shelf
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 探索挪威大陆架上Zechstein组的岩性变化
- en: '[](https://andymcdonaldgeo.medium.com/?source=post_page-----94192f5631c0--------------------------------)[![Andy
    McDonald](../Images/df11d647be032aeb3d31852affb33a64.png)](https://andymcdonaldgeo.medium.com/?source=post_page-----94192f5631c0--------------------------------)[](https://towardsdatascience.com/?source=post_page-----94192f5631c0--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----94192f5631c0--------------------------------)
    [Andy McDonald](https://andymcdonaldgeo.medium.com/?source=post_page-----94192f5631c0--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://andymcdonaldgeo.medium.com/?source=post_page-----94192f5631c0--------------------------------)[![Andy
    McDonald](../Images/df11d647be032aeb3d31852affb33a64.png)](https://andymcdonaldgeo.medium.com/?source=post_page-----94192f5631c0--------------------------------)[](https://towardsdatascience.com/?source=post_page-----94192f5631c0--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----94192f5631c0--------------------------------)
    [Andy McDonald](https://andymcdonaldgeo.medium.com/?source=post_page-----94192f5631c0--------------------------------)'
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----94192f5631c0--------------------------------)
    ·6 min read·Jun 29, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: ·发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----94192f5631c0--------------------------------)
    ·6分钟阅读·2023年6月29日
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/d088a32dac22c1b514824f1a9acdc8f6.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d088a32dac22c1b514824f1a9acdc8f6.png)'
- en: Image generated by the author using Midjourney (Paid subscription plan).
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 图片由作者使用Midjourney（付费订阅计划）生成。
- en: Using data aggregation techniques can help us transform an overwhelming and
    almost incomprehensible numeric dataset into something that is easily digestible
    and much more reader-friendly. The process of data aggregation involves summarising
    multiple data points into single metrics that can be used to provide a high-level
    overview of the data.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 使用数据汇总技术可以帮助我们将一个庞大且几乎无法理解的数字数据集转换成易于消化且更具可读性的内容。数据汇总过程涉及将多个数据点总结为单一的度量指标，以提供数据的高层次概述。
- en: One way we can apply this process within petrophysics and geoscience is to summarise
    the lithological composition of geological formations that have been interpreted
    from well log measurements.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在岩石物理学和地球科学中，我们可以应用这个过程来总结从井日志测量中解释出的地质构造的岩性组成。
- en: Within this short tutorial, we will see how we can take a large dataset consisting
    of 90 plus wells from the Norwegian Continental Shelf, and extract the lithology
    composition of the Zechstein Group.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个简短的教程中，我们将看到如何处理来自挪威大陆架的90多个油井的大型数据集，并提取Zechstein组的岩性组成。
- en: Importing Libraries and Loading Data
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 导入库和加载数据
- en: To begin, we first need to import the [**pandas**](https://pandas.pydata.org)
    library, which will be used to load our datafile from CSV and carry out the aggregations.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要导入 [**pandas**](https://pandas.pydata.org) 库，该库将用于从CSV加载数据文件并进行汇总。
- en: '[PRE0]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Once the pandas library has been imported, we can then read the CSV file using
    `pd.read_csv()`.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦导入了pandas库，我们就可以使用 `pd.read_csv()` 读取CSV文件。
- en: The data we are going to be using is from the combined [**XEEK and Force 2020
    Machine Learning competition**](https://xeek.ai/challenges/force-well-logs) which
    aimed to predict lithology from well log measurements. The dataset we are using
    represents all of the available training data. Further details of this dataset
    can be found at the end of the article.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用的数据来自[**XEEK和Force 2020机器学习竞赛**](https://xeek.ai/challenges/force-well-logs)，该竞赛旨在从井日志测量中预测岩性。我们使用的数据集代表了所有可用的训练数据。有关此数据集的更多详细信息，请参见文章末尾。
- en: As this CSV file contains data that is separated by a semi-colon rather than
    by a comma, we need to pass in a colon to the `sep` parameter.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 由于此CSV文件中的数据是用分号而不是逗号分隔的，我们需要在`sep`参数中传递一个冒号。
- en: '[PRE1]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: We can then run this code to begin the loading process. As we have a large dataset
    (11 million + rows), this may take several seconds. But, once it has finished
    loading, we can view our dataframe by calling upon the `df` object. This will
    return our dataframe and show the first five and last five rows from it.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们可以运行这段代码开始加载过程。由于我们有一个大数据集（1100万+行），这可能需要几秒钟。但一旦加载完成，我们可以通过调用`df`对象来查看数据框。这将返回数据框，并显示前五行和最后五行。
- en: '![](../Images/319373d0bba633c6b6147e410779575f.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/319373d0bba633c6b6147e410779575f.png)'
- en: Dataframe containing well log data from the Norwegian Continental Shelf. Image
    by the author.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 包含挪威大陆架井日志数据的数据框。图片由作者提供。
- en: Using pandas .map() to Convert Numeric Codes to Lithology Strings
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用pandas的.map()将数值代码转换为岩性字符串
- en: Within this dataset, the lithology data is stored within the `FORCE_2020_LITHOFACIES_LITHOLOGY`
    column. However, when we look closely at our data, we will see that the lithology
    values are encoded numerically. Unless you know the key, it will be hard to decipher
    what number represents what lithology.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个数据集中，岩性数据存储在`FORCE_2020_LITHOFACIES_LITHOLOGY`列中。然而，当我们仔细查看数据时，会发现岩性值是以数字编码的。如果你不知道键，就很难解读哪个数字代表哪个岩性。
- en: Luckily for this dataset, we have the key and can create a dictionary with the
    key and lithology pairs.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，对于这个数据集，我们有键，可以创建一个包含键和岩性对的字典。
- en: '[PRE2]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: To apply this to our dataset, we can use the pandas `map()` function, which
    will perform a lookup using our dictionary and then assign the correct lithology
    label to the numeric value.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 要将这应用于我们的数据集，我们可以使用pandas的`map()`函数，它将使用我们的字典进行查找，然后将正确的岩性标签分配给数值。
- en: '[PRE3]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Once this has run, we can view the dataframe again to make sure the mapping
    has been successful and a new LITH column has been added to the end of the dataframe.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦运行完成，我们可以再次查看数据框，以确保映射成功并且数据框末尾添加了新的LITH列。
- en: '![](../Images/e68e6e4d1bbeb11a678e6589f21bd8d1.png)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/e68e6e4d1bbeb11a678e6589f21bd8d1.png)'
- en: Dataframe containing well log data from the Norwegian Continental Shelf. Image
    by the author.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 包含挪威大陆架井日志数据的数据框。图片由作者提供。
- en: Filtering the Dataframe for a Specific Geological Group
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为特定地质组过滤数据框
- en: As we have a rather large dataset with 11,705,511 rows, it would be good to
    focus on a particular geological group for our lithology compositional analysis.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们有一个相当大的数据集，包含11,705,511行，因此对我们的岩性组成分析来说，关注特定的地质组会更好。
- en: In this case, we will subset the data and look at the Zechstein Group.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们将对子集数据进行处理，关注Zechstein组。
- en: 'We can do this by using the `query()` method and passing in a simple string:
    `GROUP == "ZECHSTEIN GP."`'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过使用`query()`方法并传入一个简单的字符串来实现：`GROUP == "ZECHSTEIN GP."`
- en: '[PRE4]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: We can check how many wells we have in the subset by calling upon `df_zechstein.WELL.unique()`,
    which returns the following array containing 8 wells.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过调用`df_zechstein.WELL.unique()`来检查子集中有多少个井，它返回包含8个井的数组。
- en: '[PRE5]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: As we are only interested in the lithologies, we can simply extract the Well
    name and the lithology columns. This will also make it easier to carry out the
    aggregation.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们只对岩性感兴趣，我们可以简单地提取井名和岩性列。这也将使聚合过程更加便捷。
- en: '[PRE6]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](../Images/d36052cce552ce69e671c133ab538299.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d36052cce552ce69e671c133ab538299.png)'
- en: Well names and associated lithologies. Image by the author.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 井名及相关岩性。图片由作者提供。
- en: Aggregating the Data Using Chained Pandas Functions
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用链式Pandas函数进行数据聚合
- en: Now that we have the data in a format that can be worked with we can begin the
    aggregation process. For this, we are going to chain multiple pandas methods together
    in a single.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经将数据整理成可以处理的格式，我们可以开始聚合过程。为此，我们将把多个pandas方法链在一起使用。
- en: First, we will group the data by the WELL column using the `groupby` function.
    This essentially makes subsets of the dataframe for each unique well name within
    the WELL column
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将使用`groupby`函数按WELL列对数据进行分组。这实际上为WELL列中的每个唯一井名创建数据框的子集。
- en: Next, we will count the occurrences of each lithology type within each group.
    The `normalize=True` part means it will give a proportion (between 0 and 1) rather
    than absolute counts. For example, if in one well (group), 'Sandstone' occurs
    5 times and 'Shale' occurs 15 times, the function will return 0.25 for 'Sandstone'
    and 0.75 for 'Shale' instead of 5 and 15.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将计算每个组中每种岩性类型的出现次数。`normalize=True`部分意味着它将给出比例（介于0和1之间），而不是绝对计数。例如，如果在一个井（组）中，‘砂岩’出现了5次，而‘页岩’出现了15次，该函数将返回0.25给‘砂岩’和0.75给‘页岩’，而不是5和15。
- en: Finally, we need to rearrange our resulting dataframe so that the row index
    contains the well names and the columns contain the lithology names. If a well
    did not have any instances of a certain lithology then they are filled with zero,
    due to `fill_value=0`.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们需要重新排列结果数据框，使得行索引包含井名称，列包含岩性名称。如果某口井中没有某种岩性的实例，则用零填充，因为`fill_value=0`。
- en: '[PRE7]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: What we get back is the following dataframe with the decimal proportions of
    each lithology within each of the wells.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到的是以下数据框，展示了每口井中每种岩性的十进制比例。
- en: '![](../Images/de1a20c35a3742ebddf37251361fe791.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/de1a20c35a3742ebddf37251361fe791.png)'
- en: Lithology composition of the Zechstein Group in decimal form. Image by the author.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 以十进制形式表示的Zechstein组岩性组成。图片由作者提供。
- en: 'If we want to view these as percentages, we can change how they are displayed
    using the following code:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想以百分比的形式查看这些数据，我们可以使用以下代码改变它们的显示方式：
- en: '[PRE8]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: When we run the code, we get back the following dataframe which provides a more
    readable table and can be incorporated into a report.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们运行代码时，我们得到以下数据框，它提供了一个更易读的表格，可以纳入报告中。
- en: '![](../Images/ee515a22ee1d934f6d526053afe2da57.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ee515a22ee1d934f6d526053afe2da57.png)'
- en: Lithology composition of the Zechstein Group after aggregation and changing
    the numbers to display as percentages. Image by the author.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 聚合后的Zechstein组的岩性组成，并将数字转换为百分比。图片由作者提供。
- en: Applying this styling does not change the actual values. They will still be
    stored as their decimal equivalents.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 应用这种样式不会改变实际值。它们仍将以其十进制等效值存储。
- en: If we do want to change the values permanently to percentages, we can do so
    by multiplying the dataframe by 100.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们确实想将值永久更改为百分比，可以通过将数据框乘以100来实现。
- en: '[PRE9]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](../Images/c2e3454b59949c293d66f9ccef16bf52.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c2e3454b59949c293d66f9ccef16bf52.png)'
- en: Lithology composition of the Zechstein Group after aggregation and converting
    to percentages. Image by the author.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 聚合后并转换为百分比的Zechstein组岩性组成。图片由作者提供。
- en: Once the data is in this format, we can use it to create something similar to
    the infographic below, which shows the percentages for the lithologies for each
    of the wells.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦数据呈现此格式，我们可以用它创建类似于下方信息图的内容，该图展示了每口井的岩性百分比。
- en: '![](../Images/9c6c88b42a6a79564abfc124d56ec981.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/9c6c88b42a6a79564abfc124d56ec981.png)'
- en: An infographic showing the percentage variation for each lithology within each
    well. Created with matplotlib by the author.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 展示每口井中每种岩性的百分比变化的信息图。由作者使用matplotlib创建。
- en: Summary
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: Within this short tutorial, we have seen how we can take a large collection
    of well log data (from 90 plus wells) and extract and summarise a particular geological
    group. This allows us to understand the lithological composition of the geological
    group in an easy-to-read and understandable format that can be incorporated into
    a report or presentation.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个简短的教程中，我们已经了解了如何从90多口井的大量测井数据中提取和总结特定的地质组。这使我们能够以易于阅读和理解的格式来了解地质组的岩性组成，并可纳入报告或演示文稿中。
- en: Dataset Used in this Tutorial
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 本教程中使用的数据集
- en: Training dataset used as part of a Machine Learning competition run by Xeek
    and FORCE 2020 *(Bormann et al., 2020)*. This dataset is licensed under Creative
    Commons Attribution 4.0 International.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 训练数据集用作Xeek和FORCE 2020（*Bormann et al., 2020*）举办的机器学习竞赛的一部分。该数据集采用创作共用署名4.0国际许可证。
- en: 'The full dataset can be accessed at the following link: [https://doi.org/10.5281/zenodo.4351155](https://doi.org/10.5281/zenodo.4351155).'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '完整的数据集可以通过以下链接访问: [https://doi.org/10.5281/zenodo.4351155](https://doi.org/10.5281/zenodo.4351155)。'
- en: '*Thanks for reading. Before you go, you should definitely subscribe to my content
    and get my articles in your inbox.* [***You can do that here!***](https://andymcdonaldgeo.medium.com/subscribe)'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '*感谢阅读。在你离开之前，你绝对应该订阅我的内容，将我的文章送到你的收件箱中。* [***你可以在这里订阅！***](https://andymcdonaldgeo.medium.com/subscribe)'
- en: '*Secondly, you can get the full Medium experience and support thousands of
    other writers and me by signing up for a membership. It only costs you $5 a month,
    and you have full access to all of the fantastic Medium articles, as well as the
    chance to make money with your writing.*'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '*其次，你可以通过注册会员获得完整的 Medium 体验，并支持成千上万的其他作者和我。它每月只需 $5，你可以完全访问所有精彩的 Medium 文章，还可以通过写作赚取收入。*'
- en: '*If you sign up using* [***my link***](https://andymcdonaldgeo.medium.com/membership)***,***
    *you will support me directly with a portion of your fee, and it won’t cost you
    more. If you do so, thank you so much for your support.*'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '*如果你通过* [***我的链接***](https://andymcdonaldgeo.medium.com/membership)***注册***，*你将直接用你的费用的一部分支持我，这不会让你多花钱。如果你这样做，非常感谢你的支持。*'
