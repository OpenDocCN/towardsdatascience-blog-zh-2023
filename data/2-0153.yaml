- en: A 3-Step Approach to Evaluate a Retrieval Augmented Generation (RAG)
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è¯„ä¼°æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰çš„ 3 æ­¥æ³•
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/a-3-step-approach-to-evaluate-a-retrieval-augmented-generation-rag-5acf2aba86de](https://towardsdatascience.com/a-3-step-approach-to-evaluate-a-retrieval-augmented-generation-rag-5acf2aba86de)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/a-3-step-approach-to-evaluate-a-retrieval-augmented-generation-rag-5acf2aba86de](https://towardsdatascience.com/a-3-step-approach-to-evaluate-a-retrieval-augmented-generation-rag-5acf2aba86de)
- en: Stop selecting the parameters of your RAG randomly
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: åœæ­¢éšæœºé€‰æ‹©ä½ çš„ RAG å‚æ•°
- en: '[](https://ahmedbesbes.medium.com/?source=post_page-----5acf2aba86de--------------------------------)[![Ahmed
    Besbes](../Images/93804d9291439715e578f204b79c9bdd.png)](https://ahmedbesbes.medium.com/?source=post_page-----5acf2aba86de--------------------------------)[](https://towardsdatascience.com/?source=post_page-----5acf2aba86de--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----5acf2aba86de--------------------------------)
    [Ahmed Besbes](https://ahmedbesbes.medium.com/?source=post_page-----5acf2aba86de--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://ahmedbesbes.medium.com/?source=post_page-----5acf2aba86de--------------------------------)[![Ahmed
    Besbes](../Images/93804d9291439715e578f204b79c9bdd.png)](https://ahmedbesbes.medium.com/?source=post_page-----5acf2aba86de--------------------------------)[](https://towardsdatascience.com/?source=post_page-----5acf2aba86de--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----5acf2aba86de--------------------------------)
    [Ahmed Besbes](https://ahmedbesbes.medium.com/?source=post_page-----5acf2aba86de--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----5acf2aba86de--------------------------------)
    Â·9 min readÂ·Nov 23, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘è¡¨äº[Towards Data Science](https://towardsdatascience.com/?source=post_page-----5acf2aba86de--------------------------------)
    Â·9åˆ†é’Ÿé˜…è¯»Â·2023å¹´11æœˆ23æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/3398735846db1df7203b650519c9909b.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3398735846db1df7203b650519c9909b.png)'
- en: Photo by [Adi Goldstein](https://unsplash.com/@adigold1?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ç…§ç‰‡ç”±[Adi Goldstein](https://unsplash.com/@adigold1?utm_source=medium&utm_medium=referral)æ‹æ‘„ï¼Œæ¥æºäº[Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
- en: 'Tuning your RAG to get optimal performance takes time, as this depends on various
    interdependent parameters: **chunk size, overlap, top K retrieved docs, embedding
    models, LLM, etc.**'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: è°ƒæ•´ä½ çš„ RAG ä»¥è·å¾—æœ€ä½³æ€§èƒ½éœ€è¦æ—¶é—´ï¼Œå› ä¸ºè¿™å–å†³äºå„ç§ç›¸äº’å…³è”çš„å‚æ•°ï¼š**å—å¤§å°ã€é‡å ã€æ£€ç´¢çš„å‰ K ä¸ªæ–‡æ¡£ã€åµŒå…¥æ¨¡å‹ã€LLM ç­‰ã€‚**
- en: 'The best combination often depends on your data and your use case: you canâ€™t
    simply plug in the settings you used in the last project and hope for the same
    results.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€ä½³ç»„åˆé€šå¸¸ä¾èµ–äºä½ çš„æ•°æ®å’Œä½¿ç”¨æ¡ˆä¾‹ï¼šä½ ä¸èƒ½ä»…ä»…å¥—ç”¨ä¸Šä¸€ä¸ªé¡¹ç›®ä¸­çš„è®¾ç½®æ¥æœŸæœ›å¾—åˆ°ç›¸åŒçš„ç»“æœã€‚
- en: Most people donâ€™t address this issue properly and pick parameters almost randomly.
    While some are comfortable with this approach, I decided to tackle the problem
    numerically.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: å¤§å¤šæ•°äººæ²¡æœ‰å¦¥å–„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯å‡ ä¹éšæœºåœ°é€‰æ‹©å‚æ•°ã€‚è™½ç„¶æœ‰äº›äººå¯¹æ­¤æ–¹æ³•æ„Ÿåˆ°èˆ’é€‚ï¼Œä½†æˆ‘å†³å®šç”¨æ•°å€¼æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
- en: '**Hereâ€™s where evaluating your RAG comes in.**'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '**è¿™å°±æ˜¯è¯„ä¼°ä½ çš„ RAG çš„åœ°æ–¹ã€‚**'
- en: In ***this post, Iâ€™ll show you a quick 3-step method you can follow to efficiently
    and quickly evaluate your RAGs across two tasks.***
  id: totrans-12
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åœ¨***è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å±•ç¤ºä¸€ä¸ªå¿«é€Ÿçš„ 3 æ­¥æ³•ï¼Œä½ å¯ä»¥ç”¨æ¥é«˜æ•ˆã€å¿«é€Ÿåœ°è¯„ä¼°ä½ çš„ RAG åœ¨ä¸¤ä¸ªä»»åŠ¡ä¸­çš„è¡¨ç°ã€‚***
- en: '**Retrieval**'
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**æ£€ç´¢**'
- en: '**Generation**'
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**ç”Ÿæˆ**'
- en: By mastering this evaluation pipeline, you can iterate, perform multiple experiments,
    compare them with metrics, and hopefully land on the best configuration
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡æŒæ¡è¿™ä¸ªè¯„ä¼°æµç¨‹ï¼Œä½ å¯ä»¥è¿›è¡Œè¿­ä»£ï¼Œæ‰§è¡Œå¤šæ¬¡å®éªŒï¼Œç”¨æŒ‡æ ‡è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä¸”å¸Œæœ›æ‰¾åˆ°æœ€ä½³é…ç½®
- en: Letâ€™s see how this works ğŸ‘‡.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå¦‚ä½•è¿ä½œ ğŸ‘‡ã€‚
- en: '*PS: In each section, code snippets are provided to help you start implementing
    these ideas.*'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '*é™„æ³¨ï¼šåœ¨æ¯ä¸€èŠ‚ä¸­ï¼Œéƒ½æä¾›äº†ä»£ç ç‰‡æ®µä»¥å¸®åŠ©ä½ å¼€å§‹å®ç°è¿™äº›æƒ³æ³•ã€‚*'
- en: 'If youâ€™re interested in practical tips to increase your productivity in building
    ML systems, you feel free to subscribe to my [newsletter](https://thetechbuffet.substack.com/):
    The Tech Buffet.'
  id: totrans-18
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 'å¦‚æœä½ å¯¹æé«˜æ„å»º ML ç³»ç»Ÿç”Ÿäº§åŠ›çš„å®ç”¨æŠ€å·§æ„Ÿå…´è¶£ï¼Œå¯ä»¥éšæ—¶è®¢é˜…æˆ‘çš„[é€šè®¯](https://thetechbuffet.substack.com/):
    The Tech Buffetã€‚'
- en: I send weekly insights in programming and system design to help you ship AI
    products faster.
  id: totrans-19
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æˆ‘æ¯å‘¨å‘é€ç¼–ç¨‹å’Œç³»ç»Ÿè®¾è®¡çš„è§è§£ï¼Œä»¥å¸®åŠ©ä½ æ›´å¿«åœ°å‘å¸ƒ AI äº§å“ã€‚
- en: 1 â€” Create a synthetic dataset
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1 â€” åˆ›å»ºä¸€ä¸ªåˆæˆæ•°æ®é›†
- en: Evaluating an LLM often requires annotating a test set manually. This takes
    time, requires domain expertise, and is prone to human errors.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: è¯„ä¼° LLM é€šå¸¸éœ€è¦æ‰‹åŠ¨æ ‡æ³¨æµ‹è¯•é›†ã€‚è¿™éœ€è¦æ—¶é—´ã€é¢†åŸŸä¸“ä¸šçŸ¥è¯†ï¼Œå¹¶ä¸”å®¹æ˜“å‡ºé”™ã€‚
- en: Hopefully, LLMs can help us with this task.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: å¸Œæœ› LLM èƒ½å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™é¡¹ä»»åŠ¡ã€‚
- en: Sample N chunks from your data. For each chunk, instruct an LLM to generate
    K tuples of questions and answers.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: ä»ä½ çš„æ•°æ®ä¸­æŠ½å–Nä¸ªå—ã€‚å¯¹äºæ¯ä¸ªå—ï¼ŒæŒ‡ç¤ºLLMç”ŸæˆKä¸ªé—®é¢˜å’Œç­”æ¡ˆçš„å…ƒç»„ã€‚
- en: After the generation is complete, you will obtain a dataset of N*K tuples, each
    one having (question, answer, context).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: ç”Ÿæˆå®Œæˆåï¼Œä½ å°†è·å¾—ä¸€ä¸ªåŒ…å«N*Kå…ƒç»„çš„æ•°æ®é›†ï¼Œæ¯ä¸ªå…ƒç»„éƒ½æœ‰ï¼ˆé—®é¢˜ï¼Œç­”æ¡ˆï¼Œä¸Šä¸‹æ–‡ï¼‰ã€‚
- en: '*Ps: The context here is the original chunk and its metadata*'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '*é™„æ³¨ï¼šè¿™é‡Œçš„ä¸Šä¸‹æ–‡æ˜¯åŸå§‹å—åŠå…¶å…ƒæ•°æ®*'
- en: In the following example, weâ€™ll consider a paragraph that refers to Sir Isaac
    Newton.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä¸€ä¸ªæåˆ°è‰¾è¨å…‹Â·ç‰›é¡¿çš„æ®µè½ã€‚
- en: Isaac Newton is best know for his theory about the law of gravity, but his â€œPrincipia
    Mathematicaâ€ (1686)
  id: totrans-27
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: è‰¾è¨å…‹Â·ç‰›é¡¿å› å…¶å…³äºå¼•åŠ›å®šå¾‹çš„ç†è®ºè€Œé—»åï¼Œä½†ä»–çš„ã€Šè‡ªç„¶å“²å­¦çš„æ•°å­¦åŸç†ã€‹ï¼ˆ1686å¹´ï¼‰
- en: with its three laws of motion greatly influenced the Enlightenment in Europe.
    Born in 1643
  id: totrans-28
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: é€šè¿‡å…¶ä¸‰å¤§è¿åŠ¨å®šå¾‹æå¤§åœ°å½±å“äº†æ¬§æ´²çš„å¯è’™æ—¶ä»£ã€‚ç”Ÿäº1643å¹´
- en: in Woolsthorpe, England, Sir Isaac Newton began developing his theories
  id: totrans-29
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åœ¨è‹±æ ¼å…°çš„ä¼å°”ç´¢æ™®ï¼Œè‰¾è¨å…‹Â·ç‰›é¡¿çˆµå£«å¼€å§‹å‘å±•ä»–çš„ç†è®º
- en: on light, calculus and celestial mechanics while on break from Cambridge University.
  id: totrans-30
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å…³äºå…‰ã€å¾®ç§¯åˆ†å’Œå¤©ä½“åŠ›å­¦ï¼ŒåŒæ—¶åœ¨å‰‘æ¡¥å¤§å­¦ä¼‘å‡æœŸé—´ã€‚
- en: Weâ€™ll instruct an LLM to generate three pairs of questions and answers from
    it.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†æŒ‡ç¤ºLLMä»ä¸­ç”Ÿæˆä¸‰å¯¹é—®é¢˜å’Œç­”æ¡ˆã€‚
- en: '![](../Images/454300ccb8cb45367792c96f10991ded.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/454300ccb8cb45367792c96f10991ded.png)'
- en: Image by the author
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: This can be done using this prompt. (Adapted from one of my projects)
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å¯ä»¥ä½¿ç”¨è¿™ä¸ªæç¤ºå®Œæˆã€‚ï¼ˆæ”¹ç¼–è‡ªæˆ‘çš„ä¸€ä¸ªé¡¹ç›®ï¼‰
- en: '[PRE0]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Weâ€™ll learn more about the limitations of this synthetic dataset but for now,
    itâ€™s a quick solution to evaluate our experiments.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†è¿›ä¸€æ­¥äº†è§£è¿™ä¸ªåˆæˆæ•°æ®é›†çš„å±€é™æ€§ï¼Œä½†ç°åœ¨ï¼Œå®ƒæ˜¯è¯„ä¼°æˆ‘ä»¬å®éªŒçš„ä¸€ä¸ªå¿«é€Ÿè§£å†³æ–¹æ¡ˆã€‚
- en: Code ğŸ’»
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä»£ç  ğŸ’»
- en: In the following section, Iâ€™ll show you how you can create your synthetic evaluation
    dataset with LangChain.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨LangChainåˆ›å»ºä½ çš„åˆæˆè¯„ä¼°æ•°æ®é›†ã€‚
- en: 'We first define the prompt and the LLM: Iâ€™m working on GCP, so Iâ€™m going to
    use VertexAI.'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬é¦–å…ˆå®šä¹‰æç¤ºå’ŒLLMï¼šæˆ‘æ­£åœ¨ä½¿ç”¨GCPï¼Œæ‰€ä»¥æˆ‘å°†ä½¿ç”¨VertexAIã€‚
- en: '[PRE1]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Then, we load some data from BQ and split it into chunks. Chunks will be the
    context needed for generating the questions and answers.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬ä»BQåŠ è½½ä¸€äº›æ•°æ®å¹¶å°†å…¶æ‹†åˆ†æˆå—ã€‚å—å°†æ˜¯ç”Ÿæˆé—®é¢˜å’Œç­”æ¡ˆæ‰€éœ€çš„ä¸Šä¸‹æ–‡ã€‚
- en: '[PRE2]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Once the data is loaded and split, you need to sample some chunks to generate
    the pairs of questions/answers from.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æ•°æ®åŠ è½½å¹¶æ‹†åˆ†å®Œæ¯•ï¼Œä½ éœ€è¦ä»ä¸­æŠ½å–ä¸€äº›å—ä»¥ç”Ÿæˆé—®é¢˜/ç­”æ¡ˆå¯¹ã€‚
- en: This is done in the following loop.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™åœ¨ä»¥ä¸‹å¾ªç¯ä¸­å®Œæˆã€‚
- en: '[PRE3]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 2 â€” Run your RAG over each synthetic question
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2 â€” å¯¹æ¯ä¸ªåˆæˆé—®é¢˜è¿è¡Œä½ çš„RAG
- en: Once the synthetic dataset is built, you can use your RAG to perform predictions
    on each question.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦åˆæˆæ•°æ®é›†æ„å»ºå®Œæˆï¼Œä½ å¯ä»¥ä½¿ç”¨ä½ çš„RAGå¯¹æ¯ä¸ªé—®é¢˜è¿›è¡Œé¢„æµ‹ã€‚
- en: This will generate answers grounded by a set of retrieved sources.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°†ç”ŸæˆåŸºäºä¸€ç»„æ£€ç´¢æ¥æºçš„ç­”æ¡ˆã€‚
- en: 'For each question, make sure you extract the retrieved documents: these will
    be useful for running the evaluation.'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºæ¯ä¸ªé—®é¢˜ï¼Œè¯·ç¡®ä¿ä½ æå–äº†æ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼šè¿™äº›æ–‡æ¡£å°†ç”¨äºè¿›è¡Œè¯„ä¼°ã€‚
- en: '![](../Images/55f0058a3f8a23e00a77ee0b482ea32c.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/55f0058a3f8a23e00a77ee0b482ea32c.png)'
- en: Image by the author
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: Code ğŸ’»
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä»£ç  ğŸ’»
- en: In the following section, weâ€™ll see how to build the RAG and make predictions
    on the evaluation data.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•æ„å»ºRAGå¹¶å¯¹è¯„ä¼°æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚
- en: We first need to create a vector database to index the chunks.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªå‘é‡æ•°æ®åº“æ¥ç´¢å¼•è¿™äº›å—ã€‚
- en: '[PRE4]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The default RAG implementation in LangChain uses a specific prompt template.
    In our case, weâ€™ll modify it a bit to prevent hallucinations.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: LangChainä¸­é»˜è®¤çš„RAGå®ç°ä½¿ç”¨äº†ä¸€ä¸ªç‰¹å®šçš„æç¤ºæ¨¡æ¿ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ç¨å¾®ä¿®æ”¹å®ƒä»¥é˜²æ­¢äº§ç”Ÿå¹»è§‰ã€‚
- en: '[PRE5]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Then, we wrap our RAG implementation in a Python class.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬çš„RAGå®ç°åŒ…è£…åœ¨ä¸€ä¸ªPythonç±»ä¸­ã€‚
- en: '[PRE6]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Once the RAG is built and initialized, you can make the predictions:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦RAGæ„å»ºå’Œåˆå§‹åŒ–å®Œæˆï¼Œä½ å¯ä»¥è¿›è¡Œé¢„æµ‹ï¼š
- en: '[PRE7]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'After itâ€™s done, hereâ€™s what youâ€™ll roughly get:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: å®Œæˆåï¼Œä½ å°†å¤§è‡´å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š
- en: '![](../Images/e78ceb88f9a94cc94b9ff18afd317e5f.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/e78ceb88f9a94cc94b9ff18afd317e5f.png)'
- en: Screenshot by the author
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: æˆªå›¾ç”±ä½œè€…æä¾›
- en: 3 â€” Compute two evaluation metrics
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 3 â€” è®¡ç®—ä¸¤ä¸ªè¯„ä¼°æŒ‡æ ‡
- en: Now, you can compute two evaluation metrics on the predictions you made for
    each question.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œä½ å¯ä»¥å¯¹ä½ ä¸ºæ¯ä¸ªé—®é¢˜åšå‡ºçš„é¢„æµ‹è®¡ç®—ä¸¤ä¸ªè¯„ä¼°æŒ‡æ ‡ã€‚
- en: A **retrieval score** to assess the relevance of the retrieved documents
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä¸€ä¸ª**æ£€ç´¢åˆ†æ•°**ç”¨äºè¯„ä¼°æ£€ç´¢åˆ°çš„æ–‡æ¡£çš„ç›¸å…³æ€§
- en: This score can be binary (1/0 for each prediction) and tells whether the true
    source of each question is in the list of the retrieved sources. You can see this
    score as a *recall.*
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: è¿™ä¸ªåˆ†æ•°å¯ä»¥æ˜¯äºŒè¿›åˆ¶çš„ï¼ˆæ¯ä¸ªé¢„æµ‹ä¸º1/0ï¼‰ï¼Œå¹¶ä¸”è¡¨ç¤ºæ¯ä¸ªé—®é¢˜çš„çœŸå®æ¥æºæ˜¯å¦åœ¨æ£€ç´¢åˆ°çš„æ¥æºåˆ—è¡¨ä¸­ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªåˆ†æ•°çœ‹ä½œæ˜¯*å¬å›ç‡*ã€‚
- en: A **quality score** to evaluate the generated answer given the question and
    the ground-truth answer. Again, an LLM can be used in this task to produce such
    evaluation over 5.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä¸€ä¸ª**è´¨é‡è¯„åˆ†**ç”¨äºè¯„ä¼°ç”Ÿæˆçš„ç­”æ¡ˆï¼Œç»™å®šé—®é¢˜å’ŒçœŸå®ç­”æ¡ˆã€‚å†æ¬¡åœ°ï¼Œå¯ä»¥ä½¿ç”¨LLMåœ¨æ­¤ä»»åŠ¡ä¸­æä¾›5åˆ†è¯„ä»·ã€‚
- en: Here is the prompt I used to ask the LLM to rate the generated answer.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯æˆ‘ç”¨æ¥è¦æ±‚LLMè¯„åˆ†ç”Ÿæˆç­”æ¡ˆçš„æç¤ºã€‚
- en: '[PRE8]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: After obtaining these scores for each question, average them over the dataset
    to obtain the final two metrics.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è·å¾—æ¯ä¸ªé—®é¢˜çš„åˆ†æ•°åï¼Œå¯¹æ•°æ®é›†è¿›è¡Œå¹³å‡ä»¥è·å¾—æœ€ç»ˆçš„ä¸¤ä¸ªæŒ‡æ ‡ã€‚
- en: '![](../Images/1149d76870704912ed16f1e5d9124ce3.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/1149d76870704912ed16f1e5d9124ce3.png)'
- en: Image by the author
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…å›¾ç‰‡
- en: Code ğŸ’»
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä»£ç  ğŸ’»
- en: In this section, we start with the`df_evaluations` dataframe and compute the
    different metrics.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ä»`df_evaluations`æ•°æ®æ¡†å¼€å§‹å¹¶è®¡ç®—ä¸åŒçš„æŒ‡æ ‡ã€‚
- en: '**1 â€” Retrieval scores**'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '**1 â€” æ£€ç´¢åˆ†æ•°**'
- en: We can start by computing the top_k metrics that indicate whether the ground
    truth source is among the top k predicted sources.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¡ç®—top_kæŒ‡æ ‡å¼€å§‹ï¼Œè¿™äº›æŒ‡æ ‡è¡¨æ˜çœŸå®æ¥æºæ˜¯å¦åœ¨å‰kä¸ªé¢„æµ‹æ¥æºä¸­ã€‚
- en: '[PRE9]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Averaging over all the documents will give us the retrieval scores for each
    k.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹æ‰€æœ‰æ–‡æ¡£è¿›è¡Œå¹³å‡ï¼Œå°†ç»™æˆ‘ä»¬æ¯ä¸ªkçš„æ£€ç´¢åˆ†æ•°ã€‚
- en: '![](../Images/6cc4be8b748707ba32aca1b64799e006.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/6cc4be8b748707ba32aca1b64799e006.png)'
- en: Screenshot by the author
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æˆªå›¾
- en: '**How to read these scores:**'
  id: totrans-83
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**å¦‚ä½•è§£è¯»è¿™äº›åˆ†æ•°ï¼š**'
- en: 'Example: there is 0.37 probability that the ground truth source is among the
    top four retrieved source.'
  id: totrans-84
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç¤ºä¾‹ï¼šçœŸå®æ¥æºåœ¨å‰å››ä¸ªæ£€ç´¢æ¥æºä¸­çš„æ¦‚ç‡ä¸º0.37ã€‚
- en: '**2 â€” Generation scores**'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '**2 â€” ç”Ÿæˆåˆ†æ•°**'
- en: To assess the quality of the generated answer, we will use an LLM thatâ€™ll provide
    its rating and reasoning.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†è¯„ä¼°ç”Ÿæˆç­”æ¡ˆçš„è´¨é‡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªLLMï¼Œå®ƒå°†æä¾›å…¶è¯„åˆ†å’Œæ¨ç†ã€‚
- en: '[PRE10]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'In this function, we instruct this LLM and fetch its rating and reasoning given:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æŒ‡å¯¼è¿™ä¸ªLLMå¹¶è·å–å…¶è¯„åˆ†å’Œæ¨ç†ï¼š
- en: the query
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æŸ¥è¯¢
- en: the predicted answer
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é¢„æµ‹çš„ç­”æ¡ˆ
- en: the reference answer
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å‚è€ƒç­”æ¡ˆ
- en: '[PRE11]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Then, we run this function over the evaluation data:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬å¯¹è¯„ä¼°æ•°æ®è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼š
- en: '[PRE12]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'After generating the ratings, hereâ€™s the distribution we obtain:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: ç”Ÿæˆè¯„åˆ†åï¼Œæˆ‘ä»¬å¾—åˆ°çš„åˆ†å¸ƒå¦‚ä¸‹ï¼š
- en: '![](../Images/06af084f3a1d30576f291d49bed50d64.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/06af084f3a1d30576f291d49bed50d64.png)'
- en: Screenshot by the author
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æˆªå›¾
- en: 'Filtering on the ratings, here are some questions the RAG failed to generate
    an answer to:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: æ ¹æ®è¯„åˆ†è¿‡æ»¤ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›RAGæœªèƒ½ç”Ÿæˆç­”æ¡ˆçš„é—®é¢˜ï¼š
- en: '![](../Images/8d0b1d499bbf9d53c5c50c23c40d7d52.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/8d0b1d499bbf9d53c5c50c23c40d7d52.png)'
- en: Screenshot by the author
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æˆªå›¾
- en: And here are some other questions where it succeeded.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œæ˜¯ä¸€äº›å…¶ä»–æˆåŠŸçš„ä¾‹å­ã€‚
- en: '![](../Images/6c4b4aee3353839f3272efc1501111f6.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/6c4b4aee3353839f3272efc1501111f6.png)'
- en: Screenshot by the author
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æˆªå›¾
- en: Analyzing this data helps diagnose and address the errors the RAG makes.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ†æè¿™äº›æ•°æ®æœ‰åŠ©äºè¯Šæ–­å’Œè§£å†³RAGå‡ºç°çš„é”™è¯¯ã€‚
- en: Limitations of this evaluation approach
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è¿™ç§è¯„ä¼°æ–¹æ³•çš„å±€é™æ€§
- en: I applied this evaluation method while building multiple RAGs for the pharmaceutical
    industry.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸ºåˆ¶è¯è¡Œä¸šæ„å»ºå¤šä¸ªRAGæ—¶ï¼Œæˆ‘åº”ç”¨äº†è¿™ç§è¯„ä¼°æ–¹æ³•ã€‚
- en: 'While it quickly provides an end-to-end pipeline and avoids manually labeling
    data, I noticed two main issues with it:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶å®ƒå¿«é€Ÿæä¾›äº†ä¸€ä¸ªç«¯åˆ°ç«¯çš„ç®¡é“å¹¶é¿å…äº†æ‰‹åŠ¨æ ‡è®°æ•°æ®ï¼Œä½†æˆ‘æ³¨æ„åˆ°å®ƒæœ‰ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š
- en: Some of the generated questions are too specific and donâ€™t make any sense to
    someone who didnâ€™t read the context. Consequently, they impact the evaluation
    metrics badly since theyâ€™re *impossible* to answer.
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä¸€äº›ç”Ÿæˆçš„é—®é¢˜è¿‡äºå…·ä½“ï¼Œå¯¹äºæ²¡æœ‰é˜…è¯»ä¸Šä¸‹æ–‡çš„äººæ¥è¯´æ¯«æ— æ„ä¹‰ã€‚å› æ­¤ï¼Œå®ƒä»¬å¯¹è¯„ä¼°æŒ‡æ ‡é€ æˆäº†å¾ˆå¤§çš„è´Ÿé¢å½±å“ï¼Œå› ä¸ºå®ƒä»¬æ˜¯*ä¸å¯èƒ½*å›ç­”çš„ã€‚
- en: 'Hereâ€™s an example: â€œWhat was the main issue discussed in this study?â€'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚ï¼šâ€œè¿™é¡¹ç ”ç©¶è®¨è®ºçš„ä¸»è¦é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿâ€
- en: Some other questions, on the other hand, are way too simple or are just a bare
    rephrasing of the original chunks.
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¦ä¸€æ–¹é¢ï¼Œä¸€äº›å…¶ä»–é—®é¢˜è¿‡äºç®€å•ï¼Œæˆ–è€…åªæ˜¯åŸå§‹ç‰‡æ®µçš„ç®€å•æ”¹è¿°ã€‚
- en: Conclusion
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: If you want to learn more about this evaluation method (also called cold start),
    have a look at this [guide](https://www.anyscale.com/blog/a-comprehensive-guide-for-building-rag-based-llm-applications-part-1#cold-start).
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºè¿™ç§è¯„ä¼°æ–¹æ³•ï¼ˆä¹Ÿç§°ä¸ºå†·å¯åŠ¨ï¼‰ï¼Œå¯ä»¥æŸ¥çœ‹è¿™ä¸ª[æŒ‡å—](https://www.anyscale.com/blog/a-comprehensive-guide-for-building-rag-based-llm-applications-part-1#cold-start)ã€‚
- en: If youâ€™re new to RAGs and want to deepen your understanding, you can also check
    some of my previous posts to learn more.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æ˜¯RAGçš„æ–°æ‰‹å¹¶æƒ³æ·±å…¥äº†è§£ï¼Œä½ ä¹Ÿå¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„ä¸€äº›å¸–å­ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚
- en: '[Why Your RAG is Not Reliable in Production](https://thetechbuffet.substack.com/p/the-probelms-behind-rag)'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[ä¸ºä»€ä¹ˆä½ çš„RAGåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸å¯é ](https://thetechbuffet.substack.com/p/the-probelms-behind-rag)'
- en: '[Getting a RAG To Work Well Is Hard â€” 5 Blog Posts To Become a RAG Master](https://thetechbuffet.substack.com/p/5-curated-rag-blog-posts)'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[è®© RAG å·¥ä½œå¾—æ›´å¥½æ˜¯å¾ˆå›°éš¾çš„ â€” æˆä¸º RAG å¤§å¸ˆçš„ 5 ç¯‡åšå®¢æ–‡ç« ](https://thetechbuffet.substack.com/p/5-curated-rag-blog-posts)'
- en: Do you know other evaluation methods that proved to be effective when building
    RAGs? Please tell me.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ çŸ¥é“å…¶ä»–åœ¨æ„å»º RAG æ—¶è¢«è¯æ˜æœ‰æ•ˆçš„è¯„ä¼°æ–¹æ³•å—ï¼Ÿè¯·å‘Šè¯‰æˆ‘ã€‚
- en: If youâ€™re also dissecting RAGs for optimal performance, Iâ€™m also interested
    in discussing this topic.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ ä¹Ÿåœ¨ç ”ç©¶ RAG çš„æœ€ä½³æ€§èƒ½ï¼Œæˆ‘ä¹Ÿå¾ˆæ„¿æ„è®¨è®ºè¿™ä¸ªè¯é¢˜ã€‚
- en: Thatâ€™d be all for me today. Until next time! ğŸ‘‹
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: ä»Šå¤©å°±åˆ°è¿™é‡Œã€‚ä¸‹æ¬¡å†è§ï¼ğŸ‘‹
