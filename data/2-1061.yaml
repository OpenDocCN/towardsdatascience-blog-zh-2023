- en: How Data Leakage affects model performance claims
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据泄漏如何影响模型性能声明
- en: 原文：[https://towardsdatascience.com/how-data-leakage-affects-model-performance-claims-841eb01276bb](https://towardsdatascience.com/how-data-leakage-affects-model-performance-claims-841eb01276bb)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/how-data-leakage-affects-model-performance-claims-841eb01276bb](https://towardsdatascience.com/how-data-leakage-affects-model-performance-claims-841eb01276bb)
- en: '[](https://medium.com/@georgiadeaconu?source=post_page-----841eb01276bb--------------------------------)[![Georgia
    Deaconu](../Images/39ba1bea77aa46bb39b2975108c3adaa.png)](https://medium.com/@georgiadeaconu?source=post_page-----841eb01276bb--------------------------------)[](https://towardsdatascience.com/?source=post_page-----841eb01276bb--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----841eb01276bb--------------------------------)
    [Georgia Deaconu](https://medium.com/@georgiadeaconu?source=post_page-----841eb01276bb--------------------------------)'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@georgiadeaconu?source=post_page-----841eb01276bb--------------------------------)[![Georgia
    Deaconu](../Images/39ba1bea77aa46bb39b2975108c3adaa.png)](https://medium.com/@georgiadeaconu?source=post_page-----841eb01276bb--------------------------------)[](https://towardsdatascience.com/?source=post_page-----841eb01276bb--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----841eb01276bb--------------------------------)
    [Georgia Deaconu](https://medium.com/@georgiadeaconu?source=post_page-----841eb01276bb--------------------------------)'
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----841eb01276bb--------------------------------)
    ·4 min read·Jan 2, 2023
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: ·发布于[数据科学之路](https://towardsdatascience.com/?source=post_page-----841eb01276bb--------------------------------)
    ·4分钟阅读·2023年1月2日
- en: --
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: This year has seen [several](https://www.science.org/doi/10.1126/science.abi6983)
    [important](https://www.deepmind.com/blog/alphafold-reveals-the-structure-of-the-protein-universe)
    [scientific advancements](https://www.nature.com/articles/s41586-021-04086-x.pdf)
    enabled by [machine learning driven research](https://www.deepmind.com/blog/accelerating-fusion-science-through-learned-plasma-control).
    Along with the enthusiasm came also some worry related to the [reproducibility
    issues encountered in ML-based science](https://arxiv.org/pdf/2207.07048.pdf).
    Several methodological problems have been identified, out of which data leakage
    seems to be the most widespread. Generally, data leakage can skew results and
    lead to overly optimistic conclusions.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 今年出现了[几项](https://www.science.org/doi/10.1126/science.abi6983) [重要](https://www.deepmind.com/blog/alphafold-reveals-the-structure-of-the-protein-universe)
    [科学进展](https://www.nature.com/articles/s41586-021-04086-x.pdf)，这些进展得益于[机器学习驱动的研究](https://www.deepmind.com/blog/accelerating-fusion-science-through-learned-plasma-control)。随着热情的增长，也带来了与[基于ML的科学中遇到的可重复性问题](https://arxiv.org/pdf/2207.07048.pdf)相关的一些担忧。已经发现了几种方法论问题，其中数据泄漏似乎是最普遍的。通常，数据泄漏会扭曲结果，并导致过于乐观的结论。
- en: There are several different ways in which data leakage can occur. The objective
    of this post is to present some of the most commonly encountered types, along
    with a few tips about how to identify and mitigate them.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 数据泄漏可能通过多种方式发生。本帖的目的是介绍一些最常遇到的类型，并提供一些关于如何识别和缓解它们的提示。
- en: '![](../Images/a384eb770d0aa46df6ec4405d4a75f92.png)'
  id: totrans-7
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a384eb770d0aa46df6ec4405d4a75f92.png)'
- en: Image generated by the author using dreamstudio.ai
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 图像由作者使用dreamstudio.ai生成
- en: '*Data leakage* can be defined as an artificial relationship between the target
    variable and its predictors which is unwillingly introduced through the data collection
    method or the pre-processing strategy.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '*数据泄漏* 可以定义为目标变量与其预测变量之间通过数据收集方法或预处理策略无意中引入的人工关系。'
- en: 'The main sources of data leakage I will try to exemplify are:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 我将尝试举例说明的主要数据泄漏来源有：
- en: The improper separation between training and test datasets
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 训练数据集和测试数据集之间的分离不当
- en: The usage of features that are not legitimate (proxy variables)
  id: totrans-12
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用不合法的特征（代理变量）
- en: The test set is not drawn from the distribution of interest
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试集并非从感兴趣的分布中抽取
- en: 1\. The improper separation between training and test datasets
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1. 训练数据集和测试数据集之间的分离不当
- en: Data scientists know that they need to divide their input data into train and
    test sets, only train their model using the training set and compute evaluation
    metrics only on the test set. This is a textbook error that most people know to
    avoid. However, the initial exploratory analysis is often performed on the complete
    data set. If this initial analysis also involves pre-processing and data cleaning
    steps, it can be a source of data leakage.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 数据科学家知道他们需要将输入数据划分为训练集和测试集，仅使用训练集来训练模型，并且只在测试集上计算评估指标。这是一个大多数人都知道要避免的教科书错误。然而，初步的探索性分析通常是在完整的数据集上进行的。如果这初步分析也涉及预处理和数据清理步骤，那么它可能成为数据泄露的来源。
- en: 'Pre-processing steps that can introduce data leakage:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 可能引入数据泄露的预处理步骤：
- en: performing missing values imputation or scaling before splitting the two sets.
    By using the complete data set to compute imputation parameters (mean, standard
    deviation, etc.), some information that shouldn’t be available to the model during
    its training is introduced in the training set
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在拆分两个数据集之前进行缺失值插补或缩放。通过使用完整的数据集来计算插补参数（均值、标准差等），一些在训练过程中不应对模型可用的信息被引入到训练集中。
- en: '[performing under/oversampling before splitting the two sets](/why-we-need-to-deal-with-imbalanced-classes-ec0dc1a7b803)
    also leads to an improper separation between the training and test sets (oversampled
    data from the training set would be present in the test set leading to optimistic
    conclusions)'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[在拆分两个数据集之前进行过采样/欠采样](https://wiki.example.org/why-we-need-to-deal-with-imbalanced-classes-ec0dc1a7b803)
    也会导致训练集和测试集之间的不正确分离（训练集中的过采样数据可能会出现在测试集中，导致过于乐观的结论）'
- en: not removing duplicates from the data set before splitting. In this case, the
    same values could be part of the training and test sets after splitting, leading
    to optimistic evaluation metrics.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在拆分之前未删除数据集中的重复项。在这种情况下，相同的值可能会在拆分后成为训练集和测试集的一部分，导致过于乐观的评估指标。
- en: 2\. The usage of features that are not legitimate
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2\. 使用不合法的特征
- en: It is considered data leakage also when the data set contains features that
    should not legitimately be used in modeling. An intuitive example would be if
    one of the features is a proxy for the outcome variable.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 当数据集包含不应在建模中合法使用的特征时，也被视为数据泄露。一个直观的例子是，如果其中一个特征是结果变量的代理。
- en: The [Seattle Building Energy Benchmarking data set](https://data.seattle.gov/dataset/2015-Building-Energy-Benchmarking/h7rm-fz6m)
    contains an example of such a variable. Seattle’s objective was to predict a building’s
    energy performance based on characteristics that are already publicly available,
    such as building surface, building type, property usage, date when it was built,
    etc. Their dataset also contains the Electricity and Natural Gas consumption values,
    along with the target variables Site Energy Use and GHG Emissions. Electricity
    and Natural Gas consumption values are highly correlated with the target variable,
    including them in the features when building a prediction model would yield very
    accurate results.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '[西雅图建筑能源基准数据集](https://data.seattle.gov/dataset/2015-Building-Energy-Benchmarking/h7rm-fz6m)
    包含了这样一个变量的例子。西雅图的目标是根据已经公开的特征（如建筑表面、建筑类型、物业用途、建造日期等）来预测建筑的能源性能。它们的数据集中还包含电力和天然气消耗值，以及目标变量场地能源使用和温室气体排放。电力和天然气消耗值与目标变量高度相关，在构建预测模型时包含这些特征将产生非常准确的结果。'
- en: '![](../Images/0a951a3d8dfe8351a6de41ec78f051fa.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/0a951a3d8dfe8351a6de41ec78f051fa.png)'
- en: Correlation between some features and the target variables (Image by the author)
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 某些特征与目标变量之间的相关性（作者图片）
- en: 'However, these features are just *proxies for the output variable.* They do
    not actually explain anything that common sense does not already tell us: buildings
    that use a lot of electricity will have a high energy usage overall.'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这些特征只是*结果变量的代理*。它们实际上并没有解释任何常识没有告诉我们的事情：使用大量电力的建筑总体能源使用会很高。
- en: If the Electricity usage values are available at the prediction time, then the
    prediction of Site Energy Use becomes a trivial task and there is no actual need
    to build a model.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 如果电力使用值在预测时是可用的，那么预测场地能源使用变成了一项微不足道的任务，实际上没有必要建立模型。
- en: The example given here is simple but, in general, the judgment of whether to
    use a particular feature or not requires domain knowledge and can be problem specific.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 这里给出的例子很简单，但通常，是否使用特定特征的判断需要领域知识，并且可能是特定于问题的。
- en: 3\. The test set is not drawn from the distribution of interest
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 3. 测试集不是从感兴趣的分布中抽取的
- en: 'This particular source of data leakage can be a bit harder to exemplify but
    can be intuitively explained. We can divide it into several sub-categories:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 这种特定的数据泄漏源可能更难举例，但可以直观地解释。我们可以将其分为几个子类别：
- en: '[Temporal leakage](https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.TimeSeriesSplit.html):
    if a model is used to make predictions about the future, then the test set should
    not contain any data that pre-dates the training set (the model would be built
    based on *data from the future*)'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[时间泄漏](https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.TimeSeriesSplit.html)：如果模型用于对未来进行预测，那么测试集不应包含任何早于训练集的数据（模型将基于*未来的数据*进行构建）'
- en: 'Non-independence between train and test samples: this problem arises more in
    the medical domain, where several samples are collected from the same patients
    over some period of time This issue can be handled by using specific methods such
    as [block cross-validation](https://neptune.ai/blog/cross-validation-mistakes),
    but it is a [difficult problem in the generic case](https://arxiv.org/abs/2002.05193)
    since all the underlying dependencies in the data might be known'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 训练和测试样本之间的非独立性：这个问题在医学领域更为常见，其中有多个样本是从同一个患者身上在一段时间内收集的。这个问题可以通过使用特定的方法如 [块交叉验证](https://neptune.ai/blog/cross-validation-mistakes)来处理，但在[通用情况下是一个困难的问题](https://arxiv.org/abs/2002.05193)，因为数据中所有的潜在依赖关系可能都不为人知。
- en: 'Sampling bias: choosing a non-representative subset of the dataset for evaluation.
    An example of such bias would be choosing only cases with extreme depression to
    evaluate the effectiveness of an anti-depressive drug and make claims about the
    drug''s effectiveness for treating depression in general'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 采样偏差：选择数据集中一个不具代表性的子集进行评估。一个这样的偏差例子是仅选择极端抑郁的病例来评估抗抑郁药物的有效性，并就该药物对一般抑郁症的治疗效果做出声明。
- en: Conclusion
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结论
- en: Data leakage can be introduced at various stages of the modeling pipeline and
    detecting it might not be obvious. The pre-processing steps and the test/train
    split method will depend on the characteristics of the dataset and might require
    specific domain knowledge. As a general rule, if the obtained results are too
    good to be true then there is a high chance of data leakage.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 数据泄漏可以在建模流程的各个阶段引入，检测它可能并不明显。预处理步骤和测试/训练分割方法将取决于数据集的特性，并可能需要特定领域的知识。一般来说，如果获得的结果好得令人难以置信，那么数据泄漏的可能性很高。
