- en: Creating an Information Edge with Conversational Access to Data
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过对话式数据访问创造信息优势
- en: 原文：[https://towardsdatascience.com/enabling-the-data-driven-organisation-with-text2sql-f8e07089dd0c?source=collection_archive---------1-----------------------#2023-06-11](https://towardsdatascience.com/enabling-the-data-driven-organisation-with-text2sql-f8e07089dd0c?source=collection_archive---------1-----------------------#2023-06-11)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/enabling-the-data-driven-organisation-with-text2sql-f8e07089dd0c?source=collection_archive---------1-----------------------#2023-06-11](https://towardsdatascience.com/enabling-the-data-driven-organisation-with-text2sql-f8e07089dd0c?source=collection_archive---------1-----------------------#2023-06-11)
- en: A guide to implementing Text2SQL to power data-driven organisations
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 实现 Text2SQL 以推动数据驱动型组织的指南
- en: '[](https://medium.com/@janna.lipenkova_52659?source=post_page-----f8e07089dd0c--------------------------------)[![Dr.
    Janna Lipenkova](../Images/112fe9a8c5936869243f2a43fde6dfee.png)](https://medium.com/@janna.lipenkova_52659?source=post_page-----f8e07089dd0c--------------------------------)[](https://towardsdatascience.com/?source=post_page-----f8e07089dd0c--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----f8e07089dd0c--------------------------------)
    [Dr. Janna Lipenkova](https://medium.com/@janna.lipenkova_52659?source=post_page-----f8e07089dd0c--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@janna.lipenkova_52659?source=post_page-----f8e07089dd0c--------------------------------)[![Dr.
    Janna Lipenkova](../Images/112fe9a8c5936869243f2a43fde6dfee.png)](https://medium.com/@janna.lipenkova_52659?source=post_page-----f8e07089dd0c--------------------------------)[](https://towardsdatascience.com/?source=post_page-----f8e07089dd0c--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----f8e07089dd0c--------------------------------)
    [Dr. Janna Lipenkova](https://medium.com/@janna.lipenkova_52659?source=post_page-----f8e07089dd0c--------------------------------)'
- en: ·
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: ·
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff215f8e427a2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fenabling-the-data-driven-organisation-with-text2sql-f8e07089dd0c&user=Dr.+Janna+Lipenkova&userId=f215f8e427a2&source=post_page-f215f8e427a2----f8e07089dd0c---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----f8e07089dd0c--------------------------------)
    ·19 min read·Jun 11, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff8e07089dd0c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fenabling-the-data-driven-organisation-with-text2sql-f8e07089dd0c&user=Dr.+Janna+Lipenkova&userId=f215f8e427a2&source=-----f8e07089dd0c---------------------clap_footer-----------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[关注](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff215f8e427a2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fenabling-the-data-driven-organisation-with-text2sql-f8e07089dd0c&user=Dr.+Janna+Lipenkova&userId=f215f8e427a2&source=post_page-f215f8e427a2----f8e07089dd0c---------------------post_header-----------)
    发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----f8e07089dd0c--------------------------------)
    ·19分钟阅读·2023年6月11日'
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff8e07089dd0c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fenabling-the-data-driven-organisation-with-text2sql-f8e07089dd0c&source=-----f8e07089dd0c---------------------bookmark_footer-----------)![](../Images/42f16105568d40cff91bfa5e2f217ff4.png)'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff8e07089dd0c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fenabling-the-data-driven-organisation-with-text2sql-f8e07089dd0c&source=-----f8e07089dd0c---------------------bookmark_footer-----------)![](../Images/42f16105568d40cff91bfa5e2f217ff4.png)'
- en: 'Figure 1: Representation of the Text2SQL flow'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 图1：Text2SQL 流程的表示
- en: As our world is getting more global and dynamic, businesses are more and more
    dependent on data for making informed, objective and timely decisions. In this
    article, we will see how AI can be used for intuitive conversational data access.
    We will use the mental model shown in Figure 2 to illustrate the implementation
    of Text2SQL systems (cf. [**Building AI products with a holistic mental model**](https://medium.com/towards-data-science/building-ai-products-with-a-holistic-mental-model-33f8729e3ad9)for
    an introduction to the mental model). After considering the market opportunities
    and the business value, we will explain the additional “machinery” in terms of
    data, LLM fine-tuning, and UX design that needs to be set up to make data widely
    accessible throughout the organization.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们的世界变得越来越全球化和动态化，企业对数据的依赖越来越大，以便做出明智、客观和及时的决策。在本文中，我们将探讨如何利用人工智能进行直观的对话数据访问。我们将使用图2中显示的心理模型来说明Text2SQL系统的实现（有关心理模型的介绍，请参考[**利用整体心理模型构建人工智能产品**](https://medium.com/towards-data-science/building-ai-products-with-a-holistic-mental-model-33f8729e3ad9)）。在考虑市场机会和商业价值之后，我们将解释需要建立的数据、LLM微调和UX设计等额外的“机制”，以便使数据在整个组织中广泛可访问。
- en: '![](../Images/7b86867e84a6eb440d24cc1e28c5a903.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7b86867e84a6eb440d24cc1e28c5a903.png)'
- en: 'Figure 2: Mental model of an AI system'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 图2：人工智能系统的心理模型
- en: 1\. Opportunity
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1\. 机会
- en: 'As of now, unleashing the full potential of organisational data is often a
    privilege of a handful of data scientists and analysts. Most employees don’t master
    the conventional data science toolkit (SQL, Python, R etc.). To access the desired
    data, they go via an additional layer where analysts or BI teams “translate” the
    prose of business questions into the language of data. The potential for friction
    and inefficiency on this journey is high — for example, the data might be delivered
    with delays or even when the question has already become obsolete. Information
    might get lost along the way when the requirements are not accurately translated
    into analytical queries. Besides, generating high-quality insights requires an
    iterative approach which is discouraged with every additional step in the loop.
    On the other side, these ad-hoc interactions create disruption for expensive data
    talent and distract them from more strategic data work, as described in these
    “confessions” of a data scientist:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，释放组织数据的全部潜力通常是少数数据科学家和分析师的特权。大多数员工不精通传统的数据科学工具（如SQL、Python、R等）。为了访问所需的数据，他们通过额外的层次，由分析师或BI团队将业务问题的语言“翻译”为数据语言。在这一过程中潜在的摩擦和低效率非常高——例如，数据可能会延迟交付，甚至在问题已经变得过时时才被提供。当需求未被准确翻译成分析查询时，信息可能在传递过程中丢失。此外，生成高质量见解需要一种迭代的方法，而每增加一步都会使这种方法变得更加困难。另一方面，这些临时互动会对昂贵的数据人才造成干扰，使他们无法专注于更具战略性的工作，正如这些数据科学家的“自白”中所描述的那样：
- en: When I was at Square and the team was smaller we had a dreaded “analytics on-call”
    rotation. It was strictly rotated on a weekly basis, and if it was your turn up
    you knew you would get very little “real” work done that week and spend most of
    your time fielding ad-hoc questions from the various product and operations teams
    at the company (SQL monkeying, we called it). There was cutthroat competition
    for manager roles on the analytics team and I think this was entirely the result
    of managers being exempted from this rotation — no status prize could rival the
    carrot of not doing on-call work.[1]
  id: totrans-14
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 当我在Square工作时，团队较小，我们有一个让人畏惧的“分析值班”轮班制度。这是严格按周轮换的，如果轮到你，你就知道那一周你几乎不会有“真正”的工作，而是花大部分时间处理来自公司各个产品和运营团队的临时问题（我们称之为SQL猴子工作）。在分析团队中，管理角色的竞争非常激烈，我认为这完全是因为管理人员被免于这种轮班——没有什么荣誉可以与不做值班工作的诱饵相比。[1]
- en: 2\. Value
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2\. 价值
- en: 'Wouldn’t it be cool to talk directly to your data instead of having to go through
    multiple rounds of interaction with your data staff? This vision is embraced by
    conversational interfaces which allow humans to interact with data using language,
    our most intuitive and universal channel of communication. After parsing a question,
    an algorithm encodes it into a structured logical form in the query language of
    choice, such as SQL. Thus, non-technical users can chat with their data and quickly
    get their hands on specific, relevant and timely information, without making the
    detour via a BI team. The three main benefits are:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 直接与数据对话而不必经历多轮与数据团队互动的过程岂不是很酷吗？这一愿景被对话式界面所接受，这种界面允许人类使用语言与数据互动，这是我们最直观和普遍的沟通渠道。解析问题后，算法将其编码成查询语言（如SQL）的结构化逻辑形式。因此，非技术用户可以与他们的数据聊天，快速获取具体、相关和及时的信息，而无需通过BI团队绕道获取。主要有以下三大好处：
- en: '**Business users** can access organisational data in a direct and timely way.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**业务用户**可以以直接和及时的方式访问组织数据。'
- en: This relieves **data scientists and analysts** from the burden of ad-hoc requests
    from business users and allows them to focus on advanced data challenges.
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这可以减轻**数据科学家和分析师**因业务用户的临时请求而产生的负担，使他们能够专注于高级数据挑战。
- en: The **business** can leverage its data in a more fluid and strategic way, finally
    turning it into a solid basis for decision making.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**业务**可以以更流畅和战略性的方式利用其数据，最终将其转化为决策的坚实基础。'
- en: 'Now, what are the product scenarios in which you might consider Text2SQL? The
    three main settings are:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，在什么样的产品场景下你可能会考虑使用Text2SQL呢？主要有以下三种设置：
- en: You are offering a **scalable data/BI product** and want to enable more users
    to access their data in a non-technical way, thus growing both the usage and the
    user base. As an example, ServiceNow has [integrated data queries into a larger
    conversational offering](https://www.servicenow.com/products/conversational-ai.html),
    and [Atlan](https://atlan.com/) has recently [announced natural-language data
    exploration](https://atlan.com/ai/).
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你提供一个**可扩展的数据/BI产品**，并希望以一种非技术性的方式让更多用户访问他们的数据，从而增加使用率和用户基础。例如，ServiceNow已经[将数据查询集成到更大的对话式产品中](https://www.servicenow.com/products/conversational-ai.html)，而[Atlan](https://atlan.com/)最近[宣布了自然语言数据探索](https://atlan.com/ai/)。
- en: You are looking to build something in the data/AI space to democratise data
    access in companies, in which case you could potentially consider an **MVP with
    Text2SQL at the core**. Providers like [AI2SQL](https://www.ai2sql.io/) and [Text2sql.ai](https://www.text2sql.ai/)
    are already making an entrance in this space.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你希望在数据/AI领域构建某些东西，以便在公司中普及数据访问，这种情况下你可能会考虑以**Text2SQL为核心的MVP**。像[AI2SQL](https://www.ai2sql.io/)和[Text2sql.ai](https://www.text2sql.ai/)这样的提供商已经开始进入这一领域。
- en: You are working on a **custom BI system** and want to maximise and democratise
    its use in the individual company.
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你正在开发一个**定制BI系统**，并希望最大化和普及其在个别公司中的使用。
- en: 'As we will see in the following sections, Text2SQL requires a non-trivial upfront
    setup. To estimate the ROI, consider the nature of the decisions that are to be
    supported as well as the available data. Text2SQL can be an absolute win in dynamic
    environments where data is changing quickly and is actively and frequently used
    in decision making, such as investing, marketing, manufacturing and the energy
    industry. In these environments, traditional tools for knowledge management are
    too static, and more fluent ways to access data and information help companies
    generate a competitive advantage. In terms of the data, Text2SQL provides the
    biggest value with a database that is:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在接下来的章节中将看到的，Text2SQL需要一个非凡的前期设置。为了估算投资回报率，考虑一下要支持的决策性质以及可用的数据。Text2SQL在数据变化迅速并被积极和频繁用于决策的动态环境中，可以带来绝对的收益，如投资、营销、制造和能源行业。在这些环境中，传统的知识管理工具过于静态，更流畅的数据和信息访问方式有助于公司生成竞争优势。在数据方面，Text2SQL在以下数据库中提供最大的价值：
- en: '**Large and growing**, so that Text2SQL can unfold its value over time as more
    and more of the data is leveraged.'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**大且不断增长**，使得Text2SQL可以随着越来越多的数据被利用而逐渐展现其价值。'
- en: '**High-quality**, so that the Text2SQL algorithm does not have to deal with
    excessive noise (inconsistencies, empty values etc.) in the data. In general,
    data that is automatically generated by applications has a higher quality and
    consistency than data that is created and maintained by humans.'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**高质量**，以便 Text2SQL 算法不必处理数据中的过多噪音（不一致性、空值等）。通常，由应用程序自动生成的数据比由人类创建和维护的数据具有更高的质量和一致性。'
- en: '**Semantically mature** as opposed to raw, so that humans can query the data
    based on central concepts, relationships and metrics that exist in their mental
    model. Note that semantic maturity can be achieved by an additional transformation
    step which conforms raw data into a conceptual structure (cf. section “Enriching
    the prompt with database information”).'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**语义成熟**，而不是原始数据，这样人类可以根据其心理模型中存在的核心概念、关系和度量来查询数据。请注意，语义成熟可以通过额外的转换步骤来实现，该步骤将原始数据转化为概念结构（参见“用数据库信息丰富提示”部分）。'
- en: '**3\. Data**'
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '**3. 数据**'
- en: Any machine learning endeavour starts with data, so we will start by clarifying
    the structure of the input and target data that are used during training and prediction.
    Throughout the article, we will use the Text2SQL flow from Figure 1 as our running
    representation, and highlight the currently considered components and relationships
    in yellow.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 任何机器学习工作都从数据开始，因此我们将从澄清在训练和预测过程中使用的输入和目标数据的结构开始。本文中，我们将使用图 1 中的 Text2SQL 流程作为我们的运行表示，并以黄色突出显示当前考虑的组件和关系。
- en: '![](../Images/1d4bd7ba190333441278d248f480f256.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/1d4bd7ba190333441278d248f480f256.png)'
- en: 'Figure 3: In this Text2SQL representation, data-related elements and relations
    are marked in yellow.'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3：在此 Text2SQL 表示中，与数据相关的元素和关系用黄色标记。
- en: '**1\. 1 Format and structure of the data**'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '**1.1 数据的格式和结构**'
- en: 'Typically, a raw Text2SQL input-output pair consists of a natural-language
    question and the corresponding SQL query, for example:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，原始 Text2SQL 输入-输出对包括一个自然语言问题和相应的 SQL 查询，例如：
- en: '**Question**: “*List the name and number of followers for each user.”*'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '**问题**：“*列出每个用户的名字和关注者数量。*”'
- en: '**SQL query**:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '**SQL 查询**：'
- en: '[PRE0]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'In the training data space, the mapping between questions and SQL queries is
    many-to-many:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在训练数据空间中，问题与 SQL 查询之间的映射是多对多的：
- en: 'A SQL query can be mapped to many different questions in natural language;
    for example, the above query semantics can be expressed by: “*show me the names
    and numbers of followers per user*”, “*how many followers are there for each user?*”
    etc.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 SQL 查询可以映射到许多不同的自然语言问题；例如，上述查询语义可以表示为：“*展示每个用户的名字和关注者数量*”、“*每个用户有多少关注者？*”等。
- en: SQL syntax is highly versatile, and almost every question can be represented
    in SQL in multiple ways. The simplest example are different orderings of WHERE
    clauses. On a more advanced stance, everyone who has done SQL query optimisation
    will know that many roads lead to the same result, and semantically equivalent
    queries might have completely different syntax.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SQL 语法高度灵活，几乎每个问题都可以用多种方式表示。最简单的例子是 WHERE 子句的不同排序。从更高级的角度来看，每个人做过 SQL 查询优化都会知道，许多途径都可以得到相同的结果，语义上等价的查询可能具有完全不同的语法。
- en: The manual collection of training data for Text2SQL is particularly tedious.
    It not only requires SQL mastery on the part of the annotator, but also more time
    per example than more general linguistic tasks such as sentiment analysis and
    text classification. To ensure a sufficient quantity of training examples, data
    augmentation can be used — for example, LLMs can be used to generate paraphrases
    for the same question. [3] provides a more complete survey of Text2SQL data augmentation
    techniques.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 Text2SQL，手动收集训练数据特别繁琐。这不仅要求标注者掌握 SQL，还比情感分析和文本分类等更一般的语言学任务每个示例花费更多时间。为了确保足够的训练示例，可以使用数据增强，例如，LLMs
    可以用来生成相同问题的同义句。[3] 提供了对 Text2SQL 数据增强技术的更全面调查。
- en: '**1.2 Enriching the prompt with database information**'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '**1.2 用数据库信息丰富提示**'
- en: 'Text2SQL is an algorithm at the interface between unstructured and structured
    data. For optimal performance, both types of data need to be present during training
    and prediction. Specifically, the algorithm has to know about the queried database
    and be able to formulate the query in such a way that it can be executed against
    the database. This knowledge can encompass:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: Text2SQL 是一种位于非结构化数据和结构化数据之间的算法。为了获得最佳性能，两种类型的数据在训练和预测期间都需要存在。具体而言，算法必须了解查询的数据库，并能够以能够在数据库上执行的方式来制定查询。这些知识可以包括：
- en: Columns and tables of the database
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库的列和表
- en: Relations between tables (foreign keys)
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 表之间的关系（外键）
- en: Database content
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库内容
- en: 'There are two options for incorporating database knowledge: on the one hand,
    the training data can be restricted to examples written for the specific database,
    in which case the schema is learned directly from the SQL query and its mapping
    to the question. This single-database setting allows to optimise the algorithm
    for an individual database and/or company. However, it kills off any ambitions
    for scalability, since the model needs to be fine-tuned for every single customer
    or database. Alternatively, in a multi-database setting, the database schema can
    be provided as part of the input, allowing the algorithm to “generalise” to new,
    unseen database schemas. While you will absolutely need to go for this approach
    if you want to use Text2SQL on many different databases, keep in mind that it
    requires considerable prompt engineering effort. For any reasonable business database,
    including the full information in the prompt will be extremely inefficient and
    most probably impossible due to prompt length limitations. Thus, the function
    responsible for prompt formulation should be smart enough to select a subset of
    database information which is most “useful” for a given question, and to do this
    for potentially unseen databases.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 融入数据库知识有两种选择：一方面，训练数据可以限制为针对特定数据库编写的示例，这样，模式可以直接从 SQL 查询及其与问题的映射中学习。这个单数据库设置允许对特定数据库和/或公司优化算法。然而，这会扼杀扩展的任何雄心，因为模型需要为每一个客户或数据库进行微调。另一种选择是，在多数据库设置中，可以将数据库模式作为输入的一部分提供，这样算法就可以“泛化”到新的、未见过的数据库模式。如果你希望在多个不同的数据库上使用
    Text2SQL，你绝对需要采用这种方法，但请记住，这需要相当大的提示工程努力。对于任何合理的业务数据库，包括完整的信息在提示中将非常低效，并且由于提示长度限制，可能几乎不可能。因此，负责提示制定的函数应该足够智能，以选择对给定问题最“有用”的数据库信息子集，并对潜在的未见过的数据库进行此操作。
- en: Finally, database structure plays a crucial role. In those scenarios where you
    have enough control over the database, you can make your model’s life easier by
    letting it learn from an intuitive structure. As a rule of thumb, the more your
    database reflects how business users talk about the business, the better and faster
    your model can learn from it. Thus, consider applying additional transformations
    to the data, such as assembling normalised or otherwise dispersed data into wide
    tables or a data vault, naming tables and columns in an explicit and unambiguous
    way etc. All business knowledge that you can encode up-front will reduce the burden
    of probabilistic learning on your model and help you achieve better results.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，数据库结构起着至关重要的作用。在你对数据库有足够控制的情况下，你可以通过让模型从直观的结构中学习来简化模型的任务。作为经验法则，你的数据库越能反映业务用户谈论业务的方式，你的模型从中学习的速度和效果就越好。因此，考虑对数据应用额外的转换，例如将标准化或以其他方式分散的数据组装成宽表或数据仓库，以明确和无歧义的方式命名表和列等。你可以提前编码的所有业务知识将减少模型的概率学习负担，并帮助你获得更好的结果。
- en: '**2\. Intelligence**'
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '**2\. 智能**'
- en: '![](../Images/64cd42647130f82bb6039733da49c1d6.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/64cd42647130f82bb6039733da49c1d6.png)'
- en: 'Figure 4: In this Text2SQL representation, algorithm-related elements and relations
    are marked in yellow.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 图4：在这个 Text2SQL 表示中，与算法相关的元素和关系标记为黄色。
- en: 'Text2SQL is a type of **semantic parsing** — the mapping of texts to logical
    representations. Thus, the system has not only to “learn” natural language, but
    also the target representation — in our case, SQL. Specifically, it needs to acquire
    the following bits of knowledge:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: Text2SQL 是一种 **语义解析** —— 文本到逻辑表示的映射。因此，系统不仅要“学习”自然语言，还要学习目标表示——在我们的案例中是 SQL。具体来说，它需要掌握以下知识：
- en: SQL syntax and semantics
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SQL 语法和语义
- en: Database structure
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库结构
- en: Natural Language Understanding (NLU)
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自然语言理解（NLU）
- en: Mapping between natural language and SQL queries (syntactic, lexical and semantic)
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自然语言与 SQL 查询之间的映射（句法、词汇和语义）
- en: '**2.1 Solving linguistic variability in the input**'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**2.1 解决输入中的语言变异性**'
- en: 'At the input, the main challenge of Text2SQL lies in the flexibility of language:
    as described in the section Format and structure of the data, the same question
    can be paraphrased in many different ways. Additionally, in the real-life conversational
    context, we have to deal with a number of issues such as spelling and grammar
    mistakes, incomplete and ambiguous inputs, multilingual inputs etc.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在输入阶段，Text2SQL 的主要挑战在于语言的灵活性：正如在“数据的格式和结构”部分所描述的，相同的问题可以用许多不同的方式进行表述。此外，在实际的对话上下文中，我们还需要处理拼写和语法错误、不完整和模糊的输入、多语言输入等问题。
- en: '![](../Images/2afbd70985674d6f0b3a22562961e97d.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2afbd70985674d6f0b3a22562961e97d.png)'
- en: 'Figure 5: The Text2SQL algorithm has to deal with many different variants of
    a question'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '图 5: Text2SQL 算法必须处理多种不同形式的问题。'
- en: LLMs such as the GPT models, T5, and CodeX are coming closer and closer to solving
    this challenge. Learning from huge quantities of diverse text, they learn to deal
    with a large number of linguistic patterns and irregularities. In the end, they
    become able to generalise over questions which are semantically similar despite
    having different surface forms. LLMs can be applied out-of-the-box (zero-shot)
    or after fine-tuning. The former, while convenient, leads to lower accuracy. The
    latter requires more skill and work, but can significantly increase accuracy.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 诸如 GPT 模型、T5 和 CodeX 这样的 LLMs 正越来越接近解决这一挑战。通过学习大量多样化的文本，它们学会了处理大量的语言模式和不规则现象。最终，它们能够对在表面形式不同但语义相似的问题进行概括。LLMs
    可以直接使用（零样本）或在微调后使用。前者虽然方便，但准确性较低。后者需要更多的技能和工作，但可以显著提高准确性。
- en: 'In terms of accuracy, as expected, the best-performing models are the latest
    models of the GPT family including the CodeX models. In April 2023, GPT-4 led
    to a dramatic accuracy increase of more than 5% over the previous state-of-the-art
    and achieved an accuracy of 85.3% (оn the metric “execution with values”).[4]
    In the open-source camp, initial attempts at solving the Text2SQL puzzle were
    focussed on auto-encoding models such as BERT, which excel at NLU tasks.[5, 6,
    7] However, amidst the hype around generative AI, recent approaches focus on autoregressive
    models such as the T5 model. T5 is pre-trained using multi-task learning and thus
    easily adapts to new linguistic tasks, incl. different variants of semantic parsing.
    However, autoregressive models have an intrinsic flaw when it comes to semantic
    parsing tasks: they have an unconstrained output space and no semantic guardrails
    that would constrain their output, which means they can get stunningly creative
    in their behaviour. While this is amazing stuff for generating free-form content,
    it is a nuisance for tasks like Text2SQL where we expect a constrained, well-structured
    target output.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在准确性方面，正如预期的那样，表现最好的模型是包括 CodeX 模型在内的最新 GPT 系列模型。2023 年 4 月，GPT-4 在“带值执行”这一指标上相比之前的最先进技术提高了超过
    5% 的准确率，达到了 85.3% 的准确率。[4] 在开源阵营中，最初尝试解决 Text2SQL 难题的焦点集中在如 BERT 等自动编码模型，这些模型在
    NLU 任务中表现出色。[5, 6, 7] 然而，在生成 AI 的炒作中，最近的方法集中在如 T5 模型等自回归模型上。T5 通过多任务学习进行预训练，因此能够轻松适应新的语言任务，包括不同的语义解析变体。然而，自回归模型在语义解析任务中存在一个固有的缺陷：它们的输出空间不受约束，缺乏语义限制，这意味着它们在行为上可能变得非常有创意。虽然这对生成自由格式内容来说很惊人，但对于像
    Text2SQL 这样需要受限、结构良好的目标输出的任务来说，这是一个烦恼。
- en: '**2.2 Query validation and improvement**'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '**2.2 查询验证与改进**'
- en: To constrain the LLM output, we can introduce additional mechanisms for validating
    and improving the query. This can be implemented as an extra validation step,
    as proposed in the PICARD system.[8] PICARD uses a SQL parser that can verify
    whether a partial SQL query can lead to a valid SQL query after completion. At
    each generation step by the LLM, tokens that would invalidate the query are rejected,
    and the highest-probability valid tokens are kept. Being deterministic, this approach
    ensures 100% SQL validity as long as the parser observes correct SQL rules. It
    also decouples the query validation from the generation, thus allowing to maintain
    both components independently of one another and to upgrade and modify the LLM.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 为了约束 LLM 的输出，我们可以引入额外的机制来验证和改进查询。这可以作为额外的验证步骤来实现，如 PICARD 系统中所提议的。[8] PICARD
    使用 SQL 解析器来验证部分 SQL 查询在完成后是否能转化为有效的 SQL 查询。在 LLM 的每个生成步骤中，那些会使查询无效的令牌会被拒绝，而概率最高的有效令牌会被保留。由于该方法是确定性的，只要解析器遵循正确的
    SQL 规则，就能确保 100% 的 SQL 有效性。它还将查询验证与生成过程解耦，从而允许两个组件独立维护和升级 LLM。
- en: Another approach is to incorporate structural and SQL knowledge directly into
    the LLM. For example, Graphix [9] uses graph-aware layers to inject structured
    SQL knowledge into the T5 model. Due to the probabilistic nature of this approach,
    it biases the system towards correct queries, but doesn’t provide a guarantee
    for success.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种方法是将结构性和 SQL 知识直接融入 LLM。例如，Graphix [9] 使用图感知层将结构化 SQL 知识注入 T5 模型。由于这种方法的概率特性，它会使系统偏向于正确的查询，但并不能保证成功。
- en: Finally, the LLM can be used as a multi-step agent that can autonomously check
    and improve the query.[10] Using multiple steps in a chain-of-thought prompt,
    the agent can be tasked to reflect on the correctness of its own queries and improve
    any flaws. If the validated query can still not be executed, the SQL exception
    traceback can be passed to the agent as an additional feedback for improvement.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，LLM 可以作为一个多步骤的代理，能够自主检查和改进查询。[10] 使用链式思维提示中的多个步骤，代理可以被要求反思自己查询的正确性并改进任何缺陷。如果验证后的查询仍然无法执行，SQL
    异常回溯可以作为额外的反馈传递给代理，以供改进。
- en: Beyond these automated methods which happen in the backend, it is also possible
    to involve the user during the query checking process. We will describe this in
    more detail in the section on User experience.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 除了这些在后台发生的自动化方法外，还可以在查询检查过程中涉及用户。我们将在用户体验部分更详细地描述这一点。
- en: '**2.3 Evaluation**'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '**2.3 评估**'
- en: To evaluate our Text2SQL algorithm, we need to generate a test (validation)
    dataset, run our algorithm on it and apply relevant evaluation metrics on the
    result. A naive dataset split into training, development and validation data would
    be based on question-query pairs and lead to suboptimal results. Validation queries
    might be revealed to the model during training and lead to an overly optimistic
    view on its generalisation skills. A **query-based split**, where the dataset
    is split in such a way that no query appears both during training and during validation,
    provides more truthful results.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 为了评估我们的 Text2SQL 算法，我们需要生成一个测试（验证）数据集，在其上运行我们的算法，并对结果应用相关的评估指标。一个基于问题-查询对的天真的数据集划分，将数据分为训练、开发和验证数据，可能会导致次优结果。验证查询可能会在训练过程中暴露给模型，从而对其泛化能力产生过于乐观的看法。**基于查询的划分**，即将数据集划分为在训练和验证期间都不会出现相同查询的方式，提供了更真实的结果。
- en: 'In terms of evaluation metrics, what we care about in Text2SQL is not to generate
    queries that are completely identical to the gold standard. This **“exact string
    match”** method is too strict and will generate many false negatives, since different
    SQL queries can lead to the same returned dataset. Instead, we want to achieve
    high **semantic accuracy** and evaluate whether the predicted and the “gold standard”
    queries would always return the same datasets. There are three evaluation metrics
    that approximate this goal:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 就评估指标而言，我们在 Text2SQL 中关心的不是生成完全与黄金标准相同的查询。这个**“精确字符串匹配”**方法过于严格，会生成许多假负例，因为不同的
    SQL 查询可以导致相同的返回数据集。相反，我们希望实现高**语义准确性**，评估预测查询和“黄金标准”查询是否总是返回相同的数据集。有三种评估指标可以接近这一目标：
- en: '**Exact-set match accuracy**: the generated and target SQL queries are split
    into their constituents, and the resulting sets are compared for identity.[11]
    The shortcoming here is that it only accounts for order variations in the SQL
    query, but not for more pronounced syntactic differences between semantically
    equivalent queries.'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**精确集匹配准确性**：将生成的 SQL 查询与目标 SQL 查询拆分为其组成部分，并比较结果集的一致性。[11] 此处的缺点是仅考虑了 SQL 查询中的顺序变化，而未考虑语义上等效查询之间更明显的句法差异。'
- en: '**Execution accuracy**: the datasets resulting from the generated and target
    SQL queries are compared for identity. With good luck, queries with different
    semantics can still pass this test on a specific database instance. For example,
    assuming a database where all users are aged over 30, the following two queries
    would return identical results despite having different semantics:'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**执行准确性**：通过比较生成的 SQL 查询与目标 SQL 查询产生的数据集来验证一致性。运气好的话，即使语义不同的查询也可能在特定数据库实例上通过此测试。例如，假设一个数据库中所有用户年龄都超过
    30 岁，以下两个查询虽然语义不同，却会返回相同的结果：'
- en: select * from user
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: select * from user
- en: select * from user where age > 30
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: select * from user where age > 30
- en: '**Test-suite accuracy**: test-suite accuracy is a more advanced and less permissive
    version of execution accuracy. For each query, a set (”test suite”) of databases
    is generated that are highly differentiated with respect to the variables, conditions
    and values in the query. Then, execution accuracy is tested on each of these databases.
    While requiring additional effort to engineer the test-suite generation, this
    metric also significantly reduces the risk of false positives in the evaluation[.](https://aclanthology.org/2020.emnlp-main.29.pdf)[12]'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**测试套件准确性**：测试套件准确性是执行准确性的一个更高级和更严格的版本。对于每个查询，生成一个（“测试套件”）的数据库集合，这些数据库在查询的变量、条件和值方面具有高度差异化。然后，在这些数据库上测试执行准确性。尽管需要额外的努力来设计测试套件，但此指标也显著减少了评估中的假阳性风险[.](https://aclanthology.org/2020.emnlp-main.29.pdf)[12]'
- en: '**3\. User experience**'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '**3\. 用户体验**'
- en: '![](../Images/027e84c09a68f36f9636e67d7ca59cdc.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/027e84c09a68f36f9636e67d7ca59cdc.png)'
- en: 'Figure 6: In this Text2SQL representation, UX-related elements and relations
    are marked in yellow.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6：在这个 Text2SQL 表示中，UX 相关的元素和关系用黄色标记。
- en: The current state-of-the-art of Text2SQL doesn’t allow a completely seamless
    integration into production systems — instead, it is necessary to actively manage
    the expectations and the behaviour of the user, who should always be aware that
    she is interacting with an AI system.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，Text2SQL 的最先进技术还不允许完全无缝地集成到生产系统中——相反，必须主动管理用户的期望和行为，用户应始终意识到她正在与 AI 系统交互。
- en: '**3.1 Failure management**'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '**3.1 失败管理**'
- en: 'Text2SQL can fail in two modes, which need to be caught in different ways:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: Text2SQL 可能会以两种模式失败，需要以不同的方式捕捉：
- en: '**SQL errors**: the generated query is not valid — either the SQL is invalid,
    or it cannot be executed against the specific database due to lexical or semantic
    flaws. In this case, no result can be returned to the user.'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SQL 错误**：生成的查询无效——要么 SQL 无效，要么由于词汇或语义缺陷无法在特定数据库上执行。在这种情况下，无法向用户返回结果。'
- en: '**Semantic errors**: the generated query is valid but it does not reflect the
    semantics of the question, thus leading to a wrong returned dataset.'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**语义错误**：生成的查询是有效的，但未能反映问题的语义，从而导致返回错误的数据集。'
- en: The second mode is particularly tricky since the risk of “silent failures” —
    errors that go undetected by the user — is high. The prototypical user will have
    neither the time nor the technical skill to verify the correctness of the query
    and/or the resulting data. When data is used for decision making in the real world,
    this kind of failure can have devastating consequences. To avoid this, it is critical
    to educate users and establish **guardrails on a business level** that limit the
    potential impact, such as additional data checks for decisions with a higher impact.
    On the other hand, we can also use the user interface to manage the human-machine
    interaction and help the user detect and improve problematic requests.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 第二种模式特别棘手，因为“静默失败”——用户未检测到的错误——的风险很高。典型用户既没有时间也没有技术技能来验证查询和/或结果数据的正确性。当数据用于现实世界的决策时，这种失败可能带来严重后果。为避免这种情况，关键在于教育用户并建立
    **业务层面的保护措施**，如对高影响决策的额外数据检查。另一方面，我们也可以利用用户界面来管理人机交互，帮助用户发现和改进有问题的请求。
- en: '**3.2 Human-machine interaction**'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '**3.2 人机交互**'
- en: Users can get involved with your AI system with different degrees of intensity.
    More interaction per request can lead to better results, but it also slows down
    the fluidity of the user experience. Besides the potential negative impact of
    erroneous queries and results, also consider how motivated your users will be
    to provide back-and-forth feedback in order to get more accurate results and also
    help improve the product in the long term.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 用户可以以不同的强度参与你的 AI 系统。每次请求的更多互动可能会带来更好的结果，但也会减缓用户体验的流畅度。除了错误查询和结果可能产生的负面影响外，还需要考虑用户提供来回反馈的积极性，以获得更准确的结果，并帮助长期改善产品。
- en: The easiest and least engaging way is to work with confidence scores. While
    the naive calculation of confidence as an average of the probabilities of the
    generated tokens is overly simplistic, more advanced methods like verbalised feedback
    can be used. [13] The confidence can be displayed in the interface and highlighted
    with an explicit alert in case it is dangerously low. This way, the responsibility
    of an appropriate follow-up in the “real world” — be it a rejection, acceptance
    or an additional check of the data — lands on the shoulders of your user. While
    this is a safe bet for you as a vendor, transferring this work to the user can
    also reduce the value of your product.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 最简单且最少参与的方式是使用置信度评分。虽然将置信度简单地计算为生成标记概率的平均值过于简单，但可以使用更先进的方法，如口头反馈。[13] 置信度可以在界面上显示，并在其危险低时用明确警报突出显示。这样，“现实世界”中适当跟进的责任——无论是拒绝、接受还是对数据进行额外检查——都落在你的用户肩上。虽然对你作为供应商来说这是一种安全的选择，但将这项工作转移给用户也可能减少你的产品价值。
- en: A second possibility is to engage the user in a clarification dialogue in the
    case of low-confidence, ambiguous or otherwise suspicious queries. For example,
    your system might suggest orthographic or grammar corrections to the input and
    ask to disambiguate specific words or grammatical structures. It might also allow
    the user to proactively ask for corrections in the query:[14]
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种可能性是在低信心、模糊或其他可疑查询的情况下，邀请用户进行澄清对话。例如，你的系统可能会建议对输入进行拼写或语法纠正，并要求澄清特定单词或语法结构。它还可能允许用户主动要求对查询进行纠正：[14]
- en: 'USER: *Show me John’s tasks in this sprint.*'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 用户：*显示 John 在这次冲刺中的任务。*
- en: 'ASSISTANT: *Would you like to see tasks John created, or those he is working
    on?*'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 助手：*你想查看 John 创建的任务，还是他正在进行的任务？*
- en: 'USER: *tasks John created*'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 用户：*John 创建的任务*
- en: 'ASSISTANT: *Ok, here are the task IDs:*'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 助手：*好的，以下是任务 ID：*
- en: '![](../Images/47e1f5220deba265ee2811b790700550.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/47e1f5220deba265ee2811b790700550.png)'
- en: 'USER: *Thanks, I would also like to see more information about the tasks. Please
    also sort by urgency.*'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 用户：*谢谢，我还想查看更多关于任务的信息。请按紧急程度排序。*
- en: 'ASSISTANT: *Sure, here are the tasks along with short descriptions, assignees
    and deadlines, sorted by deadline.*'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 助手：*当然，以下是任务及其简短描述、负责人和截止日期，按截止日期排序。*
- en: '![](../Images/7557c8d8f923a271bf886f34a1f170e3.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7557c8d8f923a271bf886f34a1f170e3.png)'
- en: Finally, to ease the understanding of queries by the user, your system can also
    provide an explicit textual reformulation of the query and ask the user to either
    confirm or correct it.[15]
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，为了便于用户理解查询，你的系统还可以提供查询的明确文本重新表述，并要求用户确认或更正。[15]
- en: '**4\. Non-functional requirements**'
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '**4\. 非功能性要求**'
- en: 'In this section, we discuss the specific non-functional requirements for Text2SQL
    as well as the trade-offs between them. We will focus on the six requirements
    that seem most important for the task: accuracy, scalability, speed, explainability,
    privacy and adaptability over time.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们讨论了 Text2SQL 的特定非功能性要求以及它们之间的权衡。我们将重点关注任务中最重要的六个要求：准确性、可扩展性、速度、可解释性、隐私和时间上的适应性。
- en: '**4.1 Accuracy**'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '**4.1 准确性**'
- en: 'For Text2SQL, the requirements on accuracy are high. First, Text2SQL is typically
    applied in a conversation setting where predictions are made one-by-one. Thus,
    the “Law of large numbers” which typically helps balance off the error in batched
    predictions, does not help. Second, syntactic and lexical validity is a “hard”
    condition: the model has to generate a well-formed SQL query, potentially with
    complex syntax and semantics, otherwise the request cannot be executed against
    the database. And if this goes well and the query can be executed, it can still
    contain semantic errors and lead to a wrong returned dataset (cf. section 3.1
    Failure management).'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 Text2SQL，准确性的要求很高。首先，Text2SQL 通常应用于对话设置中，其中预测是逐个进行的。因此，“大数法则”通常有助于平衡批量预测中的误差，但在这里无济于事。其次，句法和词汇的有效性是一个“硬”条件：模型必须生成一个结构良好的
    SQL 查询，可能具有复杂的语法和语义，否则请求无法在数据库中执行。如果查询成功执行，它仍然可能包含语义错误并导致返回错误的数据集（参见第 3.1 节 失败管理）。
- en: '**4.2 Scalability**'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '**4.2 可扩展性**'
- en: The main scalability considerations are whether you want to apply Text2SQL on
    one or multiple databases — and in the latter case, whether the set of databases
    is known and closed. If yes, you will have an easier time since you can include
    the information about these databases during training. However, in a scenario
    of a scalable product — be it a standalone Text2SQL application or an integration
    into an existing data product — your algorithm has to cope with any new database
    schema on the fly. This scenario also doesn’t give you the opportunity to transform
    the database structure to make it more intuitive for learning (link!). All of
    this leads to a heavy trade-off with accuracy, which might also explain why current
    Text2SQL providers that offer ad-hoc querying of new databases have not yet achieve
    a significant market penetration.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 主要的可扩展性考虑因素是你是否希望将 Text2SQL 应用于一个或多个数据库——如果是后者，那么数据库集是否已知且固定。如果是的话，你会有更轻松的时间，因为你可以在训练过程中包含这些数据库的信息。然而，在可扩展产品的场景中——无论是独立的
    Text2SQL 应用程序还是集成到现有的数据产品中——你的算法必须能够即时处理任何新的数据库模式。这个场景也没有给你机会去转换数据库结构，使其对学习更直观（[链接](https://example.org)）。所有这些都导致了与准确性之间的重大权衡，这也可能解释了为什么目前提供对新数据库进行临时查询的
    Text2SQL 供应商尚未取得显著的市场渗透。
- en: '**4.3 Speed**'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '**4.3 速度**'
- en: Since Text2SQL requests will typically be processed online in a conversation,
    the speed aspect is important for user satisfaction. On the positive side, users
    are often aware of the fact that data requests can take a certain time and show
    the required patience. However, this goodwill can be undermined by the chat setting,
    where users subconsciously expect human-like conversation speed. Brute-force optimisation
    methods like reducing the size of the model might have an unacceptable impact
    on accuracy, so consider inference optimisation to satisfy this expectation.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 Text2SQL 请求通常会在对话中在线处理，速度方面对用户满意度非常重要。积极的一面是，用户通常意识到数据请求可能需要一定时间，并表现出所需的耐心。然而，这种善意可能会被聊天设置所削弱，因为用户在潜意识中期望类似人类的对话速度。像减少模型大小这样的强力优化方法可能对准确性产生不可接受的影响，因此请考虑推理优化以满足这一期望。
- en: '**4.4 Explainability and transparency**'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '**4.4 可解释性和透明度**'
- en: In the ideal case, the user can follow how the query was generated from the
    text, see the mapping between specific words or expressions in the question and
    the SQL query etc. This allows to verify the query and make any adjustments when
    interacting with the system. Besides, the system could also provide an explicit
    textual reformulation of the query and ask the user to either confirm or correct
    it.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在理想情况下，用户可以跟踪查询是如何从文本中生成的，查看问题中特定词汇或表达与 SQL 查询之间的映射等。这允许验证查询并在与系统交互时进行任何调整。此外，系统还可以提供查询的明确文本重述，并要求用户确认或更正。
- en: '**4.5 Privacy**'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '**4.5 隐私**'
- en: 'The Text2SQL function can be isolated from query execution, so the returned
    database information can be kept invisible. However, the critical question is
    how much information about the database is included in the prompt. The three options
    (by decreasing privacy level) are:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: Text2SQL 功能可以与查询执行隔离，因此返回的数据库信息可以保持不可见。然而，关键问题是提示中包含了多少数据库信息。三种选项（按隐私级别递减）是：
- en: No information about the database
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 没有关于数据库的信息
- en: Database schema
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库模式
- en: Database content
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库内容
- en: Privacy trades off with accuracy — the less constrained you are in including
    useful information in the prompt, the better the results.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 隐私与准确性之间存在权衡——在提示中包含有用信息的限制越少，结果越好。
- en: '**4.6 Adaptability over time**'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '**4.6 随时间的适应性**'
- en: To use Text2SQL in a durable way, you need to adapt to data drift, i. e. the
    changing distribution of the data to which the model is applied. For example,
    let’s assume that the data used for initial fine-tuning reflects the simple querying
    behaviour of users when they start using the BI system. As time passes, information
    needs of users become more sophisticated and require more complex queries, which
    overwhelm your naive model. Besides, the goals or the strategy of a company change
    might also drift and direct the information needs towards other areas of the database.
    Finally, a Text2SQL-specific challenge is database drift. As the company database
    is extended, new, unseen columns and tables make their way into the prompt. While
    Text2SQL algorithms that are designed for multi-database application can handle
    this issue well, it can significantly impact the accuracy of a single-database
    model. All of these issues are best solved with a fine-tuning dataset that reflects
    the current, real-world behaviour of users. Thus, it is crucial to log user questions
    and results, as well as any associated feedback that can be collected from usage.
    Additionally, semantic clustering algorithms, for example using embeddings or
    topic modelling, can be applied to detect underlying long-term changes in user
    behaviour and use these as an additional source of information for perfecting
    your fine-tuning dataset
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 要以持久的方式使用 Text2SQL，您需要适应数据漂移，即模型应用的数据分布变化。例如，假设用于初始微调的数据反映了用户在开始使用 BI 系统时的简单查询行为。随着时间的推移，用户的信息需求变得更加复杂，要求更复杂的查询，这会让您的简单模型不堪重负。此外，公司的目标或策略的变化也可能导致信息需求向数据库的其他领域转移。最后，Text2SQL
    特有的挑战是数据库漂移。随着公司数据库的扩展，新的、未见过的列和表会出现在提示中。虽然设计用于多数据库应用的 Text2SQL 算法可以很好地处理这个问题，但它可能会显著影响单一数据库模型的准确性。所有这些问题最好通过反映当前实际用户行为的微调数据集来解决。因此，记录用户问题和结果，以及从使用中收集的任何相关反馈是至关重要的。此外，例如使用嵌入或主题建模的语义聚类算法，可以用于检测用户行为中的长期变化，并将这些作为完善微调数据集的额外信息来源。
- en: '**Conclusion**'
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '**结论**'
- en: 'Let’s summarise the key points of the article:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们总结一下文章的关键点：
- en: Text2SQL allows to implement intuitive and democratic data access in a business,
    thus maximising the value of the available data.
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Text2SQL 允许在企业中实现直观且民主的数据访问，从而最大化现有数据的价值。
- en: Text2SQL data consist of questions at the input, and SQL queries at the output.
    The mapping between questions and SQL queries is many-to-many.
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Text2SQL 数据包括输入中的问题和输出中的 SQL 查询。问题与 SQL 查询之间是多对多的映射关系。
- en: It is important to provide information about the database as part of the prompt.
    Additionally, the database structure can be optimised to make it easier for the
    algorithm to learn and understand it.
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重要的是在提示中提供关于数据库的信息。此外，可以优化数据库结构，使其更容易被算法学习和理解。
- en: On the input, the main challenge is the linguistic variability of natural-language
    questions, which can be approached using LLMs that were pre-trained on a wide
    variety of different text styles
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在输入方面，主要挑战是自然语言问题的语言变异性，这可以通过使用在各种文本风格上进行预训练的 LLMs 来解决。
- en: The output of Text2SQL should be a valid SQL query. This constraint can be incorporated
    by “injecting” SQL knowledge into the algorithm; alternatively, using an iterative
    approach, the query can be checked and improved in multiple steps.
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Text2SQL 的输出应该是一个有效的 SQL 查询。可以通过“注入” SQL 知识到算法中来实现这一约束；另外，使用迭代方法，可以在多个步骤中检查和改进查询。
- en: Due to the potentially high impact of “silent failures” which return wrong data
    for decision-making, failure management is a primary concern in the user interface.
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于“静默失败”可能对决策造成错误数据的高影响，故失败管理在用户界面中是一个主要关注点。
- en: In an “augmented” fashion, users can be actively involved in iterative validation
    and improvement of SQL queries. While this makes the application less fluid, it
    also reduces failure rates, allows users to explore data in a more flexible way
    and creates valuable signals for further learning.
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以“增强”的方式，用户可以积极参与 SQL 查询的迭代验证和改进。虽然这会使应用程序的流畅性降低，但也能减少失败率，使用户以更灵活的方式探索数据，并为进一步学习创造有价值的信号。
- en: The major non-functional requirements to consider are accuracy, scalability,
    speed, explainability, privacy and adaptability over time. The main trade-offs
    consist between accuracy on the one hand, and scalability, speed and privacy on
    the other hand.
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主要的非功能性需求包括准确性、可扩展性、速度、可解释性、隐私和时间上的适应性。主要的权衡在于准确性与可扩展性、速度和隐私之间。
- en: '**References**'
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: '[1] Ken Van Haren. 2023\. [Replacing a SQL analyst with 26 recursive GPT prompts](https://www.patterns.app/blog/2023/01/18/crunchbot-sql-analyst-gpt/)'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: '[1] Ken Van Haren. 2023\. [用 26 个递归 GPT 提示替代 SQL 分析师](https://www.patterns.app/blog/2023/01/18/crunchbot-sql-analyst-gpt/)'
- en: '[2] Nitarshan Rajkumar et al. 2022\. [Evaluating the Text-to-SQL Capabilities
    of Large Language Models](https://arxiv.org/abs/2204.00498)'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '[2] Nitarshan Rajkumar 等. 2022\. [评估大型语言模型的文本到 SQL 能力](https://arxiv.org/abs/2204.00498)'
- en: '[3] Naihao Deng et al. 2023\. [Recent Advances in Text-to-SQL: A Survey of
    What We Have and What We Expect](https://aclanthology.org/2022.coling-1.190.pdf)'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '[3] Naihao Deng 等. 2023\. [文本到 SQL 的最新进展：我们拥有的和我们期望的](https://aclanthology.org/2022.coling-1.190.pdf)'
- en: '[4] Mohammadreza Pourreza et al. 2023\. [DIN-SQL: Decomposed In-Context Learning
    of Text-to-SQL with Self-Correction](https://arxiv.org/abs/2304.11015)'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '[4] Mohammadreza Pourreza 等. 2023\. [DIN-SQL: 分解的上下文学习文本到 SQL 及自我纠正](https://arxiv.org/abs/2304.11015)'
- en: '[5] Victor Zhong et al. 2021\. [Grounded Adaptation for Zero-shot Executable
    Semantic Parsing](https://arxiv.org/abs/2009.07396)'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '[5] Victor Zhong 等. 2021\. [用于零样本可执行语义解析的基础适应](https://arxiv.org/abs/2009.07396)'
- en: '[6] Xi Victoria Lin et al. 2020\. [Bridging Textual and Tabular Data for Cross-Domain
    Text-to-SQL Semantic Parsing](https://aclanthology.org/2020.findings-emnlp.438/)'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '[6] Xi Victoria Lin 等. 2020\. [跨领域文本到 SQL 语义解析中的文本和表格数据桥接](https://aclanthology.org/2020.findings-emnlp.438/)'
- en: '[7] Tong Guo et al. 2019\. [Content Enhanced BERT-based Text-to-SQL Generation](https://arxiv.org/pdf/2012.12627.pdf)'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '[7] Tong Guo 等. 2019\. [内容增强的基于 BERT 的文本到 SQL 生成](https://arxiv.org/pdf/2012.12627.pdf)'
- en: '[8] Torsten Scholak et al. 2021\. [PICARD: Parsing Incrementally for Constrained
    Auto-Regressive Decoding from Language Models](https://arxiv.org/abs/2109.05093)'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '[8] Torsten Scholak 等. 2021\. [PICARD: 从语言模型中逐步解析以进行约束自回归解码](https://arxiv.org/abs/2109.05093)'
- en: '[9] Jinyang Li et al. 2023\. [Graphix-T5: Mixing Pre-Trained Transformers with
    Graph-Aware Layers for Text-to-SQL Parsing](https://arxiv.org/abs/2301.07507)'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '[9] Jinyang Li 等. 2023\. [Graphix-T5: 混合预训练变换器与图感知层进行文本到 SQL 解析](https://arxiv.org/abs/2301.07507)'
- en: '[10] LangChain. 2023\. [LLMs and SQL](https://blog.langchain.dev/llms-and-sql/)'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '[10] LangChain. 2023\. [LLMs 和 SQL](https://blog.langchain.dev/llms-and-sql/)'
- en: '[11] Tao Yu et al. 2018\. [Spider: A Large-Scale Human-Labeled Dataset for
    Complex and Cross-Domain Semantic Parsing and Text-to-SQL Task](https://aclanthology.org/D18-1425.pdf)'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '[11] Tao Yu 等. 2018\. [Spider: 用于复杂和跨领域语义解析及文本到 SQL 任务的大规模人工标注数据集](https://aclanthology.org/D18-1425.pdf)'
- en: '[12] Ruiqi Zhong et al. 2020\. [Semantic Evaluation for Text-to-SQL with Distilled
    Test Suites](https://aclanthology.org/2020.emnlp-main.29.pdf)'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '[12] Ruiqi Zhong 等. 2020\. [用于文本到 SQL 的语义评估与提炼测试套件](https://aclanthology.org/2020.emnlp-main.29.pdf)'
- en: '[13] Katherine Tian et al. 2023\. [Just Ask for Calibration: Strategies for
    Eliciting Calibrated Confidence Scores from Language Models Fine-Tuned with Human
    Feedback](https://arxiv.org/pdf/2305.14975.pdf)'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '[13] Katherine Tian 等. 2023\. [仅需请求校准：从经过人类反馈微调的语言模型中获取校准信心水平的策略](https://arxiv.org/pdf/2305.14975.pdf)'
- en: '[14] Braden Hancock et al. 2019\. [Learning from Dialogue after Deployment:
    Feed Yourself, Chatbot!](https://arxiv.org/abs/1901.05415)'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '[14] Braden Hancock 等. 2019\. [部署后的对话学习：喂饱自己，聊天机器人！](https://arxiv.org/abs/1901.05415)'
- en: '[15] Ahmed Elgohary et al. 2020\. [Speak to your Parser: Interactive Text-to-SQL
    with Natural Language Feedback](https://arxiv.org/pdf/2005.02539.pdf)'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '[15] Ahmed Elgohary 等. 2020\. [与解析器对话：带自然语言反馈的互动文本到 SQL](https://arxiv.org/pdf/2005.02539.pdf)'
- en: '[16] Janna Lipenkova. 2022\. [Talk to me! Text2SQL conversations with your
    company’s data](https://www.youtube.com/watch?v=GCU_1thWAmc), talk at New York
    Natural Language Processing meetup.'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '[16] Janna Lipenkova. 2022\. [和我聊聊！与你公司数据的 Text2SQL 对话](https://www.youtube.com/watch?v=GCU_1thWAmc)，在纽约自然语言处理会议上的演讲。'
- en: '*All images are by the author.*'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '*所有图片均由作者提供。*'
