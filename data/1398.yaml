- en: Architecture of AI-Driven Security Operations with a Low False Positive Rate
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 人工智能驱动的安全运营架构，具有低误报率
- en: 原文：[https://towardsdatascience.com/architecture-of-ai-driven-security-operations-with-a-low-false-positive-rate-a33dbbad55b4?source=collection_archive---------1-----------------------#2023-04-21](https://towardsdatascience.com/architecture-of-ai-driven-security-operations-with-a-low-false-positive-rate-a33dbbad55b4?source=collection_archive---------1-----------------------#2023-04-21)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/architecture-of-ai-driven-security-operations-with-a-low-false-positive-rate-a33dbbad55b4?source=collection_archive---------1-----------------------#2023-04-21](https://towardsdatascience.com/architecture-of-ai-driven-security-operations-with-a-low-false-positive-rate-a33dbbad55b4?source=collection_archive---------1-----------------------#2023-04-21)
- en: This article discusses a mindset on building **production-ready** **machine
    learning solutions** when applied to **cyber-security needs**
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 本文讨论了在应对**网络安全需求**时建立**生产就绪的机器学习解决方案**的思路
- en: '[](https://ditrizna.medium.com/?source=post_page-----a33dbbad55b4--------------------------------)[![Dmitrijs
    Trizna](../Images/4a7a925e4383f4b3b087e85c0fba0ca4.png)](https://ditrizna.medium.com/?source=post_page-----a33dbbad55b4--------------------------------)[](https://towardsdatascience.com/?source=post_page-----a33dbbad55b4--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----a33dbbad55b4--------------------------------)
    [Dmitrijs Trizna](https://ditrizna.medium.com/?source=post_page-----a33dbbad55b4--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://ditrizna.medium.com/?source=post_page-----a33dbbad55b4--------------------------------)[![Dmitrijs
    Trizna](../Images/4a7a925e4383f4b3b087e85c0fba0ca4.png)](https://ditrizna.medium.com/?source=post_page-----a33dbbad55b4--------------------------------)[](https://towardsdatascience.com/?source=post_page-----a33dbbad55b4--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----a33dbbad55b4--------------------------------)
    [Dmitrijs Trizna](https://ditrizna.medium.com/?source=post_page-----a33dbbad55b4--------------------------------)'
- en: ·
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: ·
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2fbea2ebee7a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Farchitecture-of-ai-driven-security-operations-with-a-low-false-positive-rate-a33dbbad55b4&user=Dmitrijs+Trizna&userId=2fbea2ebee7a&source=post_page-2fbea2ebee7a----a33dbbad55b4---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----a33dbbad55b4--------------------------------)
    ·12 min read·Apr 21, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa33dbbad55b4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Farchitecture-of-ai-driven-security-operations-with-a-low-false-positive-rate-a33dbbad55b4&user=Dmitrijs+Trizna&userId=2fbea2ebee7a&source=-----a33dbbad55b4---------------------clap_footer-----------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[关注](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2fbea2ebee7a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Farchitecture-of-ai-driven-security-operations-with-a-low-false-positive-rate-a33dbbad55b4&user=Dmitrijs+Trizna&userId=2fbea2ebee7a&source=post_page-2fbea2ebee7a----a33dbbad55b4---------------------post_header-----------)
    发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----a33dbbad55b4--------------------------------)
    ·12 min 阅读·Apr 21, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa33dbbad55b4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Farchitecture-of-ai-driven-security-operations-with-a-low-false-positive-rate-a33dbbad55b4&user=Dmitrijs+Trizna&userId=2fbea2ebee7a&source=-----a33dbbad55b4---------------------clap_footer-----------)'
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa33dbbad55b4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Farchitecture-of-ai-driven-security-operations-with-a-low-false-positive-rate-a33dbbad55b4&source=-----a33dbbad55b4---------------------bookmark_footer-----------)![](../Images/f9e75555920db760e316903cce5618f0.png)'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa33dbbad55b4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Farchitecture-of-ai-driven-security-operations-with-a-low-false-positive-rate-a33dbbad55b4&source=-----a33dbbad55b4---------------------bookmark_footer-----------)![](../Images/f9e75555920db760e316903cce5618f0.png)'
- en: Figure 1\. Anomalies on [NL2Bash data](https://github.com/TellinaTool/nl2bash).
    [Code](https://github.com/dtrizna/slp/blob/main/examples/jupyterthon_ml_unix.ipynb).
    Security analysts want to avoid seeing this picture in their dashboards. Image
    by the author.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 图1\. [NL2Bash 数据](https://github.com/TellinaTool/nl2bash) 上的异常。 [代码](https://github.com/dtrizna/slp/blob/main/examples/jupyterthon_ml_unix.ipynb)。安全分析人员希望在他们的仪表盘上避免看到这幅图片。作者提供的图片。
- en: Even today, in a world where LLMs [compromise the integrity](https://www.nytimes.com/2023/01/12/technology/chatgpt-schools-teachers.html)
    of the educational system we used for decades, and [we (finally) started to fear](https://futureoflife.org/open-letter/pause-giant-ai-experiments/)
    an [existential dread](https://www.lesswrong.com/posts/uMQ3cqWDPHhjtiesc/agi-ruin-a-list-of-lethalities)
    from AGI, the applicability of artificial intelligence (AI) systems to non-conventional
    data science domains is far from achieving futuristic milestones and requires
    a distinct approach.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 即使在今天，在一个使用了数十年的教育系统的完整性被LLMs [侵蚀](https://www.nytimes.com/2023/01/12/technology/chatgpt-schools-teachers.html)，并且
    [我们（终于）开始担忧](https://futureoflife.org/open-letter/pause-giant-ai-experiments/)
    AGI 带来的 [存在主义恐惧](https://www.lesswrong.com/posts/uMQ3cqWDPHhjtiesc/agi-ruin-a-list-of-lethalities)
    的世界里，人工智能（AI）系统在非传统数据科学领域的适用性远未达到未来的里程碑，并且需要一种独特的方法。
- en: In this article, we have a conceptual discussion about AI applicability to *cyber-security*,
    **why** most applications fail, and **what** methodology actually **works**. Speculatively,
    the provided approach and conclusions are transferable to other application domains
    with low false-positive requirements, especially ones that rely on inference from
    system logs.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在本文中，我们将进行关于 AI 在 *网络安全* 中适用性的概念讨论，**为什么** 大多数应用程序失败，以及 **什么** 方法实际上 **有效**。从推测的角度来看，所提供的方法和结论可以转移到其他具有低误报要求的应用领域，特别是那些依赖系统日志推理的领域。
- en: 'We will **not** cover **how** to implement machine learning (ML) logic on data
    relevant to information security. I have already provided functional implementations
    with code samples in the following articles:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将 **不会** 涉及 **如何** 在与信息安全相关的数据上实施机器学习（ML）逻辑。我已经在以下文章中提供了带有代码示例的功能实现：
- en: '[Anomaly Detection Engineering Based on Power Law Distribution in Enterprise
    Security Telemetry](/data-centric-security-threat-hunting-based-on-zipfs-law-50ad919fc135);'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[基于幂律分布的企业安全遥测异常检测工程](/data-centric-security-threat-hunting-based-on-zipfs-law-50ad919fc135)；'
- en: '[Shell Language Processing: Intrusion Detection with TF-IDF and Hash Encoding
    on Linux auditd logs](/shell-language-processing-machine-learning-for-security-intrusion-detection-with-linux-auditd-73d7196995c7);'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[Shell语言处理：在Linux auditd日志中使用TF-IDF和哈希编码进行入侵检测](/shell-language-processing-machine-learning-for-security-intrusion-detection-with-linux-auditd-73d7196995c7)；'
- en: '[Which GPT-like Model Engineering Techniques Work on System Logs?](https://medium.com/towards-data-science/which-gpt-like-engineering-strategies-work-on-system-logs-6b0a3a1ebcad)'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[哪些类似GPT的模型工程技术适用于系统日志？](https://medium.com/towards-data-science/which-gpt-like-engineering-strategies-work-on-system-logs-6b0a3a1ebcad)'
- en: Signatures
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 签名
- en: 'Even today, the **fundamental** and the **most valuable** component of mature
    **security** posture is just targeted **signature rules**. Heuristics, like those
    exemplified below, are an essential part of our defenses:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 即使在今天，成熟的 **安全** 状态的 **根本** 和 **最有价值** 的组成部分仍然是有针对性的 **签名规则**。像下面示例的启发式，是我们防御的一个重要部分：
- en: '[PRE0]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Honestly, rules like these are great. This is just an example, a (simplified)
    logic [shared by the Red Canary](https://redcanary.com/threat-detection-report/threats/impacket/)
    for lateral movement detection via WMI that can be achieved with tools like [impacket](https://github.com/fortra/impacket).
    Never turn such rules off, and keep stacking further!
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 老实说，像这样的规则非常好。这只是一个例子，(简化版) 逻辑 [由红色金丝雀共享](https://redcanary.com/threat-detection-report/threats/impacket/)
    用于通过 WMI 进行横向移动检测，可以通过像 [impacket](https://github.com/fortra/impacket) 这样的工具实现。绝不要关闭这样的规则，并继续不断增加！
- en: But this approach leaves gaps...
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 但是这种方法存在漏洞...
- en: 'That’s why once in a while, every Chief Information Security Officer (CISO)
    spends money, human, and time resources on a solution that offers to solve security
    problems through the magic of “machine learning”. Usually, this appears to be
    a rabbit hole with low return on investment: (1) dashboards of security analysts
    illuminate like a Christmas tree, consider Figure 1 above; (2) analysts got alert
    fatigue; (3) ML heuristics are disabled or just ignored.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是为什么每个首席信息安全官（CISO）时不时会花费资金、人力和时间资源在一个通过“机器学习”的魔力来解决安全问题的解决方案上。通常，这看起来像是一个投资回报低的兔子洞：（1）安全分析师的仪表盘亮得像圣诞树一样，见上图
    Figure 1；（2）分析师感到警报疲劳；（3）ML 启发式被禁用或仅被忽略。
- en: General vs. Narrow Heuristics
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通用 vs. 狭义启发式
- en: Let me first bring to your attention the concept of **narrow** and **general**
    intelligence since this directly transfers to security heuristics.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 首先让我提请你注意 **狭义** 和 **通用** 智能的概念，因为这直接影响到安全启发式。
- en: '**Intelligence,** in broad terms, is an ability to achieve **goals**. Humans
    are believed to have general intelligence since we are able to “generalize” and
    achieve goals that we would never require to reach in an environment driven by
    natural selection and genetic imperative, like landing on the moon.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '**智能**，广义上说，是实现**目标**的能力。人类被认为具有一般智能，因为我们能够“归纳”并实现那些在自然选择和遗传驱动的环境中不需要达到的目标，比如登月。'
- en: While generalization allowed our species to conquer the world, there are entities
    that are much better than we are on a narrow set of tasks. For instance, calculators
    are way better at arithmetics than the cleverest of us like [von Neumann](https://en.wikipedia.org/wiki/John_von_Neumann)
    ever could be, or squirrels (!) can significantly outperform humans on memorizing
    locations of acorns hidden last year.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然归纳允许我们的物种征服了世界，但有些实体在某些狭窄任务上的表现远胜于我们。例如，计算器在算术方面比最聪明的我们如[冯·诺依曼](https://en.wikipedia.org/wiki/John_von_Neumann)更为优秀，或者松鼠（！）在记忆去年隐藏的橡实位置方面显著超过人类。
- en: '![](../Images/339a69f7396bbe68e48818b9fd0ca77e.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/339a69f7396bbe68e48818b9fd0ca77e.png)'
- en: Figure 2\. Schematic view on intelligence. Image by the author.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图2\. 智能的示意图。图片由作者提供。
- en: 'We can reason about security heuristics in a similar way. There are rules that
    are heavily focused on a specific tool or CVE, and rules that attempt to detect
    a broader set of techniques. For instance, consider [this detection logic](https://github.com/SigmaHQ/sigma/blob/master/rules/linux/process_creation/proc_creation_lnx_sudo_cve_2019_14287.yml)
    focused solely on `sudo` privilege escalation abusing [CVE-2019–14287](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-14287):'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以以类似的方式推理安全启发式方法。有些规则高度关注特定工具或CVE，而有些规则尝试检测更广泛的技术集。例如，考虑[这一检测逻辑](https://github.com/SigmaHQ/sigma/blob/master/rules/linux/process_creation/proc_creation_lnx_sudo_cve_2019_14287.yml)，专注于`sudo`权限提升，利用[CVE-2019–14287](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-14287)：
- en: '[PRE1]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'On the contrary, [this webshell detection rule](https://github.com/SigmaHQ/sigma/blob/master/rules/linux/process_creation/proc_creation_lnx_webshell_detection.yml)
    (replicated in redacted form) attempts to implement a significantly broader logic:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，[这个webshell检测规则](https://github.com/SigmaHQ/sigma/blob/master/rules/linux/process_creation/proc_creation_lnx_webshell_detection.yml)（以隐去形式复制）尝试实现更广泛的逻辑：
- en: '[PRE2]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: It defines a more sophisticated behavioral heuristic that maps the parent process
    of common HTTP servers to the [enumeration](https://attack.mitre.org/tactics/TA0007/)
    activity on the compromised host.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 它定义了一种更复杂的行为启发式方法，将常见HTTP服务器的父进程映射到[枚举](https://attack.mitre.org/tactics/TA0007/)活动上。
- en: 'Resembling the intelligence landscape above, we can visualize a security posture
    by mapping detection rules to a landscape of offensive techniques, tools, and
    procedures (TTPs) as follows:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于上述的智能景观，我们可以通过将检测规则映射到攻击技术、工具和程序（TTPs）的景观来可视化安全态势，如下所示：
- en: '![](../Images/a85042886a82e15022329694f3223de9.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a85042886a82e15022329694f3223de9.png)'
- en: Figure 3\. Schematic view of your security posture. Note the gaps, and don’t
    flatter yourself — you have more of them. Image by the author.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 图3\. 您的安全态势的示意图。注意漏洞，不要自满——您有更多漏洞。图片由作者提供。
- en: False-Positives vs. False-Negatives
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 假阳性与假阴性
- en: Sudo CVE rule detects **only one** specific technique and misses **all the others**
    (extremely high False-Negative rate). On the contrary, the web shell rule *might*
    detect a set of offensive techniques and [webshell tools from the Kali Linux arsenal](https://www.kali.org/tools/webshells/).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: Sudo CVE规则**仅检测**一个特定技术，而忽略了**所有其他**（假阴性率极高）。相反，webshell规则*可能*检测到一系列攻击性技术和[来自Kali
    Linux工具箱的webshell工具](https://www.kali.org/tools/webshells/)。
- en: The obvious question is — why, then, do we just not cover all possible TTPs
    with several broad behavioral rules?
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 显而易见的问题是——那么，为什么我们不使用几个广泛的行为规则来覆盖所有可能的TTP？
- en: Because they bring False-Positives… A lot.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 因为它们带来假阳性……很多。
- en: Here we observe a **False-Positive vs. False-Negative trade-off**.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们观察到**假阳性与假阴性权衡**。
- en: While most organizations can just copy-paste the sudo CVE rule and enable it
    right away in their SIEMs, the webshell rule might run for a while in “monitor
    only” mode while security analysts filter out all legitimate triggers observed
    in their environment.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管大多数组织可以直接复制粘贴sudo CVE规则并立即在他们的SIEM中启用，但webshell规则可能会在“仅监控”模式下运行一段时间，同时安全分析师会过滤掉他们环境中观察到的所有合法触发。
- en: '**By building detections, security engineers try to answer what is** m̶a̶l̶i̶c̶i̶o̶u̶s̶̶
    **not representative to their environment.**'
  id: totrans-41
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**通过构建检测，安全工程师试图回答什么是** m̶a̶l̶i̶c̶i̶o̶u̶s̶̶ **不代表其环境的。**'
- en: They might see alerts from automation created by system administrators that
    run a REST API request which triggers one of the enumeration actions or an Ansible
    shell script that, when deployed, creates weird parent-child process relationships.
    Eventually, I observed how broad behavioral rules become lists with dozen exclusions
    and more edits per month than active code repositories. That’s why security engineers
    balance between broadness of their rules — expanding generalization is costly,
    and they try to keep the False-Positive rate as low as possible.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 他们可能会看到系统管理员创建的自动化警报，这些警报会运行一个 REST API 请求，触发其中一个枚举操作，或者是一个 Ansible shell 脚本，当其部署时，会创建奇怪的父子进程关系。最终，我观察到广泛的行为规则变成了包含几十个排除项的列表，每月的编辑次数比活动代码库还要多。这就是为什么安全工程师在规则的广泛性和保持尽可能低的误报率之间做平衡。
- en: Failures of Machine Learning as a Security Heuristic
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 机器学习作为安全启发式方法的失败
- en: Here security professionals start to look for alternative techniques to implement
    behavioral heuristics. Requirements for ML implementations are *a priori* broad.
    Given the applicability of ML algorithms, most often, the intuition of security
    professionals leads them to unsupervised learning. We task AI to [capture anomalies
    in the network](https://ieeexplore.ieee.org/document/9610045), alert on [anomalous
    command lines](https://blog.developer.adobe.com/using-machine-learning-to-detect-command-line-anomalies-a3257daafeab),
    et cetera. These tasks are at the generalization level of “solve security for
    me”. No surprise it works poorly in production.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，安全专业人员开始寻找替代技术来实施行为启发式。机器学习实现的要求是 *a priori* 宽泛的。鉴于机器学习算法的适用性，安全专业人员的直觉往往会引导他们走向无监督学习。我们要求人工智能
    [捕捉网络中的异常](https://ieeexplore.ieee.org/document/9610045)，对 [异常命令行](https://blog.developer.adobe.com/using-machine-learning-to-detect-command-line-anomalies-a3257daafeab)
    发出警报，等等。这些任务处于“为我解决安全问题”的泛化水平。因此，生产环境中表现不佳也就不足为奇了。
- en: Actually, oftentimes ML does exactly what we ask. It may report an anomalous
    *elevator.exe* binary, which IntelliJ uses to update itself for the first time,
    or a new CDN Spotify started using for updates with jittered delay exactly like
    [Command and Control](https://attack.mitre.org/tactics/TA0011/) callback. And
    hundreds of similar behaviors, all of which were anomalous that day.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，机器学习往往正是按照我们要求的方式执行。它可能会报告一个异常的*elevator.exe* 二进制文件，这个文件是 IntelliJ 首次用来更新自身的，或者是一个新的
    CDN，Spotify 开始使用以便更新，其延迟与 [Command and Control](https://attack.mitre.org/tactics/TA0011/)
    回调的抖动延迟完全一致。还有成百上千个类似的行为，这些行为在那一天都显得异常。
- en: In the case of supervised learning, where it is possible to assemble large labeled
    datasets, for instance, [malware detection](https://arxiv.org/abs/2006.09271),
    we indeed are capable of building qualitative modeling schemes like [EMBER](https://github.com/elastic/ember)
    that are able to generalize well.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在监督学习的情况下，如果能够组装大量标记的数据集，例如 [恶意软件检测](https://arxiv.org/abs/2006.09271)，我们确实能够建立像
    [EMBER](https://github.com/elastic/ember) 这样的定性建模方案，这些方案能够很好地泛化。
- en: But even in solutions like these — modern AI models in infosec do not yet possess
    wide enough context to parse the “gray” area. For instance, do we consider TeamViewer
    bad or good? Many small and medium-sized businesses use it as a cheap VPN. At
    the same time, some of these small businesses are [ransomware groups](https://www.synacktiv.com/publications/legitimate-rats-a-comprehensive-forensic-analysis-of-the-usual-suspects.html)
    that backdoor target networks using such tools.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 但即使在这些解决方案中——现代人工智能模型在信息安全领域仍然没有足够广泛的背景来解析“灰色”区域。例如，我们应该将 TeamViewer 视为好还是坏？许多中小型企业将其用作廉价的
    VPN。同时，一些中小型企业也是 [勒索软件组织](https://www.synacktiv.com/publications/legitimate-rats-a-comprehensive-forensic-analysis-of-the-usual-suspects.html)，利用这些工具对目标网络进行后门攻击。
- en: Successes of Machine Learning as a Security Heuristic
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 机器学习作为安全启发式方法的成功
- en: ML-based heuristics should follow the same ideology as rule-based detection
    — be focused on a specific set of malicious TTPs. To apply AI in security — you
    actually need to have some knowledge and intuition in security, sorry data scientists.
    ¯\_(ツ)_/¯ *At least today, until LLMs achieve generalization so broad, they can
    solve security challenges (and many other tasks) collaterally.*
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 基于 ML 的启发式方法应遵循与基于规则的检测相同的理念——专注于特定的恶意 TTP 集。要在安全领域应用 AI —— 实际上你需要对安全有一些知识和直觉，抱歉数据科学家们。¯\_(ツ)_/¯
    *至少在今天，直到 LLM 实现广泛的泛化，它们可以协同解决安全挑战（以及许多其他任务）。*
- en: 'For instance, instead of asking for anomalies in command lines (and getting
    results as in top Figure 1 of this article with 634 anomalies on humble size dataset),
    ask for out-of-baseline activity around a specific offensive technique — e.g.,
    anomalous Python executions ([T1059.006](https://attack.mitre.org/techniques/T1059/006/))
    and *viola!* — given **the same** ML algorithm, preprocessing, and modeling technique,
    we get only anomaly which is actually a Python reverse shell:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，与其要求命令行中的异常（并得到如本文图1所示的634个异常结果），不如要求围绕特定攻击技术的超出基线的活动——例如，异常的 Python 执行 ([T1059.006](https://attack.mitre.org/techniques/T1059/006/))
    和 *哇！* —— 在 **相同** 的 ML 算法、预处理和建模技术下，我们仅得到一个异常，即 Python 反向 shell：
- en: '![](../Images/0ef2e56506c6e3186c890c8071671e8f.png)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/0ef2e56506c6e3186c890c8071671e8f.png)'
- en: Figure 4\. Python anomalies in the [NL2Bash dataset](https://github.com/TellinaTool/nl2bash)
    expanded by malicious techniques. Anomaly reports Python reverse shell. [Code](https://github.com/dtrizna/slp/blob/main/examples/jupyterthon_ml_unix.ipynb).
    Image by the author.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图4\. Python 异常在 [NL2Bash 数据集](https://github.com/TellinaTool/nl2bash)中由于恶意技术的扩展。异常报告
    Python 反向 shell。[代码](https://github.com/dtrizna/slp/blob/main/examples/jupyterthon_ml_unix.ipynb)。图片由作者提供。
- en: '**Examples of unsupervised Unix-focused techniques that work:**'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: '**有效的无监督 Unix 重点技术示例：**'
- en: Anomalous python/perl/ruby process (execution via scripting interpreter, [T1059.006](https://attack.mitre.org/techniques/T1059/006/));
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 异常的 python/perl/ruby 进程（通过脚本解释器执行，[T1059.006](https://attack.mitre.org/techniques/T1059/006/)）；
- en: Anomalous *systemd* command (persistence via systemd process, [T1543.002](https://attack.mitre.org/techniques/T1543/002/));
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 异常的 *systemd* 命令（通过 systemd 进程持久化，[T1543.002](https://attack.mitre.org/techniques/T1543/002/)）；
- en: Anomalous ssh login source to high severity jumpbox ([T1021.004](https://attack.mitre.org/techniques/T1021/004/)).
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 高严重性跳板机的异常 ssh 登录源 ([T1021.004](https://attack.mitre.org/techniques/T1021/004/))。
- en: '**Examples of unsupervised Windows-focused techniques that work:**'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '**有效的无监督 Windows 重点技术示例：**'
- en: Anomalous user logged on Domain Controllers, MSSQL servers ([T1021.002](https://attack.mitre.org/techniques/T1021/002/));
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在域控制器、MSSQL 服务器上登录的异常用户 ([T1021.002](https://attack.mitre.org/techniques/T1021/002/))；
- en: An anomalous process that loads NTDLL.DLL ([T1129](https://attack.mitre.org/techniques/T1129/));
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 加载 NTDLL.DLL 的异常进程 ([T1129](https://attack.mitre.org/techniques/T1129/))；
- en: Network connection with anomalous RDP client and server combination ([T1021.001](https://attack.mitre.org/techniques/T1021/001/)).
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 异常的 RDP 客户端和服务器组合的网络连接 ([T1021.001](https://attack.mitre.org/techniques/T1021/001/))。
- en: '**Examples of functional supervised ML baselines:**'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '**功能性监督 ML 基线示例：**'
- en: 'Reverse shell model: generate malicious part of a dataset from known methods
    (inspire yourself with [generators like this](https://www.revshells.com/)); use
    the process creation events from your environment telemetry as a legitimate counterpart
    of a dataset.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 反向 shell 模型：从已知方法生成数据集中的恶意部分（可以参考 [类似生成器](https://www.revshells.com/)）；使用环境遥测中的进程创建事件作为数据集的合法对照。
- en: 'Rather than building rules in mind with robustness against obfuscation, like
    one exemplified in Figure 5 below (spoiler: you won’t succeed), better build a
    separate ML model that detects obfuscation as a separate technique. [Here is a
    good article on this topic by Mandiant](https://www.mandiant.com/resources/blog/obfuscated-command-line-detection-using-machine-learning).'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与其在思维中建立具有对抗混淆的稳健规则，如下图5所示（剧透：你不会成功），不如建立一个单独的 ML 模型，将混淆检测作为一种独立技术。[这是 Mandiant
    关于此主题的好文章](https://www.mandiant.com/resources/blog/obfuscated-command-line-detection-using-machine-learning)。
- en: '![](../Images/0c664391a2289ef4e9796b7f6a6447e1.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/0c664391a2289ef4e9796b7f6a6447e1.png)'
- en: Figure 5\. Example of simple cmd.exe command line obfuscation. Image by the
    author.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 图5\. 简单 cmd.exe 命令行混淆的示例。图片由作者提供。
- en: Machine Learning is an Extension of Signature Logic
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 机器学习是签名逻辑的扩展
- en: 'To systematize the examples above, successful application of the ML heuristic
    consists of these two steps:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 为了系统化上述示例，成功应用机器学习启发式方法包括这两个步骤：
- en: Narrow down input data so it captures telemetry generated by specific TTP as
    precise as possible;
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 缩小输入数据范围，使其尽可能精确地捕捉特定TTP生成的遥测数据；
- en: Define as few dimensions as possible along which to look for out-of-baseline
    activity (e.g., a logic that looks only at the *process.image* will bring up fewer
    alerts than logic that, in addition, looks on *parent.process.image* and *process.args*).
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义尽可能少的维度来寻找偏离基线的活动（例如，仅查看*process.image*的逻辑会比同时查看*parent.process.image*和*process.args*的逻辑产生更少的警报）。
- en: '**Step 1** above actually ***is*** how we create **signature rules**.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 上述**步骤1**实际上***是***我们创建**签名规则**的方法。
- en: Do you remember how we discussed above that prior to enabling the web shell
    rule, “*security analysts filter out all triggers representative for their environment*”?
    This is **Step 2**.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 你是否记得我们上面讨论过在启用Web Shell规则之前，“*安全分析师过滤掉代表其环境的所有触发器*”？这就是**步骤2**。
- en: In the previous case, a person builds a decision boundary between legitimate
    and malicious activity. This is actually where contemporary ML algorithms are
    good. ML heuristics can remove the burden of manually filtering out vast quantities
    of legitimate activity close to a specific TTP. Thus, ML allows building broader
    heuristics than signature rules with less work.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的例子中，一个人建立了合法活动和恶意活动之间的决策边界。这实际上是当代机器学习算法擅长的领域。机器学习启发式方法可以减轻手动过滤大量接近特定TTP的合法活动的负担。因此，机器学习允许以更少的工作构建比签名规则更广泛的启发式方法。
- en: ML is just another way to achieve the same goal, an extension of signatures.
  id: totrans-73
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 机器学习只是实现相同目标的另一种方式，是签名的扩展。
- en: Swiss Cheese Model
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 瑞士奶酪模型
- en: Now we are ready to outline a holistic vision.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们准备勾勒出一个整体的愿景。
- en: The traditional detection engineering approach is to stack as many signature
    rules as possible without overflowing [SOC](https://en.wikipedia.org/wiki/Security_operations_center)
    dashboards. Each of these rules has a high False Negative Rate (FNR) but a low
    False Positive Rate (FPR).
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 传统的检测工程方法是尽可能多地堆叠签名规则，而不至于溢出[SOC](https://en.wikipedia.org/wiki/Security_operations_center)仪表盘。这些规则中的每一个都有较高的假阴性率（FNR）但较低的假阳性率（FPR）。
- en: 'We can further continue stacking ML heuristics with the same requirement towards
    FPR – it has to be low to protect the only bottleneck: human analyst attention.
    ML heuristics allow covering gaps in rule-based detections by introducing more
    general behavioral logic without significantly depleting security engineer time
    resources.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以进一步继续堆叠具有相同FPR要求的机器学习启发式方法——它必须保持低FPR以保护唯一的瓶颈：人工分析师的注意力。机器学习启发式方法通过引入更通用的行为逻辑来弥补基于规则的检测中的空白，而不会显著消耗安全工程师的时间资源。
- en: If you have covered most of the low-hanging fruits and want to go deeper into
    behavioral analytics, you can bring deep learning logic on top of what you have.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经覆盖了大多数容易解决的问题并希望深入行为分析，可以在已有基础上引入深度学习逻辑。
- en: '![](../Images/3d23f1c983a7c5ad3b4a8d1cd54ebdb9.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3d23f1c983a7c5ad3b4a8d1cd54ebdb9.png)'
- en: Figure 6\. A holistic view of collaborative work of security heuristics that
    use different techniques to achieve the same goal.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 图6\. 展示了使用不同技术实现相同目标的安全启发式的协作工作全景图。
- en: Remember the Occam razor principle, and implement every new heuristic as simply
    as possible. Do not use ML unless signature rules cannot define a reliable baseline.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 记住奥卡姆剃刀原则，并尽可能简单地实现每个新启发式方法。除非签名规则无法定义可靠的基线，否则不要使用机器学习。
- en: Each of slices in this model should have low False Positive Rate. You can ignore
    high number of False Negatives — to combat that just add slices.
  id: totrans-82
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 这个模型中的每一片段都应该有低假阳性率。你可以忽略高假阴性数量——为解决这个问题，只需添加更多片段。
- en: 'For instance, in the example above with anomalous Python executions — Python
    arguments might still be too variable in your environment, alerting you with too
    much anomalous activity. You might need to narrow it down further. For instance,
    capture only processes that have `-c` in the command line to look for cases where
    code is passed in as an argument to Python binary, therefore, only focusing on
    techniques like this Python reverse shell:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在上面的异常Python执行示例中——Python参数在你的环境中可能仍然变化太大，会导致过多的异常活动警报。你可能需要进一步缩小范围。例如，仅捕捉命令行中包含`-c`的进程，以查找作为Python二进制文件参数传递的代码，从而只专注于像这样的Python反向shell技术：
- en: '[PRE3]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Since we decrease FPR, we increase False-Negatives. Therefore, you might miss
    executions of Python from scripts with unusual names, like `python fake_server.py`,
    that an attacker might use to spoof a legitimate service. For that, you might
    want to create a separate heuristic that focuses on this subset of TTPs but has
    a low FPR on its own.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们降低了假阳性率（FPR），因此我们增加了假阴性。因此，你可能会错过执行具有不寻常名称的Python脚本，例如`python fake_server.py`，攻击者可能会使用这些脚本来伪装成合法服务。为此，你可能需要创建一个专注于这一子集TTPs的单独启发式方法，但它自身的FPR较低。
- en: Meta-Detection Layer
  id: totrans-86
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 元检测层
- en: Worth noting that even despite following the Swiss Cheese methodology, you will
    end up with verbose heuristics. Usually, those do not represent maliciousness
    *a priori*, however, are interested in the context.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 值得注意的是，即使遵循瑞士奶酪方法论，你也会得到冗长的启发式方法。通常，这些方法不代表*先验*的恶意性，但会关注上下文。
- en: For instance, SSH/RDP login to a high-severity host from a new source is not
    bad (just a new employee or workstation), as well as execution of `whoami /all`
    might be usual among skilled users. Thus both of these heuristics are not suitable
    for a direct trigger of an alert. However, a combination of the two might be worth
    analyst attention.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，从新源登录到高严重性主机的SSH/RDP并不是坏事（可能只是新员工或工作站），以及执行`whoami /all`在熟练用户中可能很常见。因此，这两种启发式方法都不适合直接触发警报。然而，这两者的组合可能值得分析师关注。
- en: The solution to this dilemma comes with the introduction of additional logic
    on top of such verbose rules that yield “True Positive Benigns”. We can call it
    the *meta-detection layer*.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 解决这一困境的方法是在这种冗长的规则之上引入额外的逻辑，以产生“真正的正面结果”。我们可以称之为*元检测层*。
- en: '![](../Images/b4b0ddc6ef9d945933ef3f01cc94c248.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b4b0ddc6ef9d945933ef3f01cc94c248.png)'
- en: Figure 7\. A schematic view of alerting setup that includes a dedicated parsing
    of verbose but useful rules.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 图7\. 包括专门解析冗长但有用规则的警报设置示意图。
- en: 'The meta-logic that is applied on top of rule activations can vary but usually
    involves two steps:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 应用于规则激活之上的元逻辑可能有所不同，但通常涉及两个步骤：
- en: '*“Group by”* all activations by an “*entity*”, e.g., host, username, source
    IP, cookie, etc.'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*“按组”*对所有由“*实体*”触发的事件进行分组，例如主机、用户名、源IP、cookie等。'
- en: Apply an “*aggregate function*” on activations within some *time period*.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对某个*时间段*内的激活应用“*聚合函数*”。
- en: 'Examples of simple yet functional meta-detection logic:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 简单而有效的元检测逻辑示例：
- en: just *count* the number of different rule triggers from a single entity, like
    a single host or user, and report if it exceeds a threshold, e.g., more than three
    different rules triggered within three hours;
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 只需*计算*来自单一实体（例如单一主机或用户）的不同规则触发次数，并报告是否超过阈值，例如在三小时内触发三条不同规则；
- en: the same as above, but apply *weighted sum* on rules based on severity, e.g.,
    “critical” rule counts as 3, “medium” as 2, “info” as 1 — report if exceeds a
    threshold, like *sum > 6*;
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如上所述，但根据严重性对规则应用*加权和*，例如，“关键”规则计为3，“中等”计为2，“信息”计为1——如果超过阈值则报告，例如*总和 > 6*；
- en: More sophisticated methods exist, like one defined in [the following AISec ’22
    publication](https://dl.acm.org/doi/10.1145/3560830.3563726), where I use the
    second layer of ML on malware representations. These should be tuned to a specific
    application and environment since the data specifics, amount of telemetry, and
    infrastructure size might require a different approach to stay below the acceptable
    alert limit.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 存在更复杂的方法，例如在[以下AISec ’22出版物](https://dl.acm.org/doi/10.1145/3560830.3563726)中定义的方法，其中我在恶意软件表示上使用了第二层机器学习（ML）。这些方法应根据特定的应用和环境进行调整，因为数据特性、遥测量和基础设施规模可能需要不同的方法以保持在可接受的警报限度内。
- en: Conclusions
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结论
- en: In this article, we discussed a mindset behind expanding your security operations
    arsenal beyond a signature approach. Most of the implementations fail to do it
    properly since security professionals define too broad requirements for behavioral
    heuristics through machine learning (ML).
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在本文中，我们讨论了在签名方法之外扩展安全操作工具库的思维模式。大多数实现都未能正确完成此操作，因为安全专业人员通过机器学习（ML）定义了过于广泛的行为启发式要求。
- en: We argue that proper application should be driven by offensive techniques, tactics,
    and procedures (TTPs). Given proper use, ML techniques save a vast amount of human
    resources, efficiently filtering out a baseline of legitimate activity around
    specific TTPs.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 我们认为，正确的应用应该由攻击性技术、战术和程序（TTPs）驱动。在适当使用的情况下，机器学习技术可以节省大量的人力资源，有效地过滤出围绕特定TTPs的合法活动基线。
- en: A mature and successful security posture will consist of signature and behavioral
    heuristics combined, where every separate detection logic has a low False-Positive
    rate, and limitations in missing False-Negatives are offset by stacking multiple
    heuristics in parallel.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 一个成熟且成功的安全姿态将结合签名和行为启发式，其中每个单独的检测逻辑都有低假阳性率，而缺失的假阴性被并行堆叠的多个启发式算法所弥补。
- en: Examples in this article included cases from detection engineering if applied
    to conventional security operations. However, we argue that the same methodology
    with limited modifications will be useful in other security applications, for
    instance, EDR/XDR heuristic space, network traffic analysis, and counting.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 本文中的示例包括如果应用于传统安全操作的检测工程案例。然而，我们认为，经过有限修改的相同方法在其他安全应用中也会有用，例如EDR/XDR启发式空间、网络流量分析和计数。
- en: Appendix
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录
- en: 'Technical Note: Estimate Detection Rate under Fixed False Positive Rate'
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 技术说明：在固定假阳性率下估算检测率
- en: This is a notice with a code sample on how to evaluate behavioral ML heuristic
    utility in a production environment.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个关于如何在生产环境中评估行为机器学习启发式算法效用的通知及代码示例。
- en: Data scientists — forget about the *accuracy*, *F1*-*score*, and *AUC* — these
    give little to no information on the production readiness of security solutions.
    These metrics can be used to reason about the **relative** utility of multiple
    solutions but not an **absolute** value.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 数据科学家——忘记*准确率*、*F1*评分和*AUC*——这些对安全解决方案的生产准备性几乎没有信息。这些指标可以用来推理多个解决方案的**相对**效用，但不是**绝对**值。
- en: This is because of the **base rate fallacy** in security telemetry — basically,
    all data your model will see are benign samples (until it is not, which really
    matters). Therefore, even a false-positive rate of *0.001%* will bring you 10
    alerts a day if your heuristic performs 10 000 checks daily.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 这是因为安全遥测中的**基准率谬误**——基本上，你的模型看到的所有数据都是良性样本（直到它不是，这才是重要的）。因此，即使是*0.001%*的假阳性率，如果你的启发式算法每天执行10
    000次检查，也会带来每天10个警报。
- en: The only true value of your model can be estimated by looking at the **Detection
    Rate (aka, True Positive Rate, TPR) under a fixed False Positive Rate (FPR).**
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 你模型的唯一真实价值可以通过查看**在固定假阳性率（FPR）下的检测率（即真实阳性率，TPR）**来估算。
- en: 'Consider the plot below — the **x**-**axis** represent a **true label** of
    a data sample. It is either malicious or benign. On the **y-axis** is the model’s
    probabilistic **prediction** — how bad it thinks the sample is:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 请考虑下图——**x**-**轴**表示数据样本的**真实标签**。它要么是恶意的，要么是良性的。在**y轴**上是模型的概率**预测**——它认为样本有多糟糕：
- en: '![](../Images/c8f10dd6895e94d98e48eb5ac44737ad.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c8f10dd6895e94d98e48eb5ac44737ad.png)'
- en: Figure 7\. Distribution on predictions on extended [NL2Bash](https://github.com/TellinaTool/nl2bash)
    data. [Code](https://github.com/dtrizna/slp/blob/main/examples/jupyterthon_ml_unix.ipynb).
    Image by the author.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 图7\. 在扩展的[NL2Bash](https://github.com/TellinaTool/nl2bash)数据上的预测分布。[代码](https://github.com/dtrizna/slp/blob/main/examples/jupyterthon_ml_unix.ipynb)。图片由作者提供。
- en: If you are allowed to bring **only one false alert**, you have to set a decision
    threshold of a model to be around ~0.75 (dashed red line), just above the second
    false positive. Therefore, the realistic detection rate of the model is ~50% (the
    dotted line almost overlaps with the mean value of boxplot).
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你只能接受**一个假警报**，你必须将模型的决策阈值设置在大约~0.75（虚线红色线），稍高于第二个假阳性。因此，模型的实际检测率大约是~50%（虚线几乎与箱线图的均值重合）。
- en: 'Evaluation of detection rates under variable false positive rates, given you
    have *y_true* (true labels) and *preds* (model predictions), can be done with
    the code sample below:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在给定有*y_true*（真实标签）和*preds*（模型预测）的情况下，可以通过下面的代码示例来评估在可变假阳性率下的检测率：
