- en: Presenting Spatial Data With Web Maps
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用网络地图展示空间数据
- en: 原文：[https://towardsdatascience.com/presenting-spatial-data-with-web-maps-4069c01e26ac](https://towardsdatascience.com/presenting-spatial-data-with-web-maps-4069c01e26ac)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/presenting-spatial-data-with-web-maps-4069c01e26ac](https://towardsdatascience.com/presenting-spatial-data-with-web-maps-4069c01e26ac)
- en: A deep dive into map tiles, base maps, map layers and vector data
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 深入探讨地图图块、基础地图、地图图层和矢量数据
- en: '[](https://medium.com/@mm1718?source=post_page-----4069c01e26ac--------------------------------)[![Mary
    M](../Images/549561899f2bd146ef32039ab1495875.png)](https://medium.com/@mm1718?source=post_page-----4069c01e26ac--------------------------------)[](https://towardsdatascience.com/?source=post_page-----4069c01e26ac--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----4069c01e26ac--------------------------------)
    [Mary M](https://medium.com/@mm1718?source=post_page-----4069c01e26ac--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@mm1718?source=post_page-----4069c01e26ac--------------------------------)[![Mary
    M](../Images/549561899f2bd146ef32039ab1495875.png)](https://medium.com/@mm1718?source=post_page-----4069c01e26ac--------------------------------)[](https://towardsdatascience.com/?source=post_page-----4069c01e26ac--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----4069c01e26ac--------------------------------)
    [Mary M](https://medium.com/@mm1718?source=post_page-----4069c01e26ac--------------------------------)'
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----4069c01e26ac--------------------------------)
    ·15 min read·Aug 15, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: ·发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----4069c01e26ac--------------------------------)
    ·15 分钟阅读·2023年8月15日
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/3a11fdfd0efd8f0644ba1bcdf58e4d19.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3a11fdfd0efd8f0644ba1bcdf58e4d19.png)'
- en: Map of historical peat bogland in the west of Ireland, Corine Land Cover data
    2000
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 爱尔兰西部历史泥炭沼泽地图，Corine 土地覆盖数据 2000
- en: '[https://github.com/mmc1718/webmap-ireland](https://github.com/mmc1718/webmap-ireland)'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://github.com/mmc1718/webmap-ireland](https://github.com/mmc1718/webmap-ireland)'
- en: 🗺 Contents
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 🗺 内容
- en: '**Introduction**'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**简介**'
- en: '- [How web maps work](#5d68)'
  id: totrans-11
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '- [网络地图的工作原理](#5d68)'
- en: '[**Preparing the Base Map**](#3ae2)'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[**准备基础地图**](#3ae2)'
- en: '- [Creating a vector tileset](#a134)'
  id: totrans-13
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '- [创建矢量图块集](#a134)'
- en: '- [Identifying required changes](#c058)'
  id: totrans-14
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '- [识别所需的更改](#c058)'
- en: '- [Modifying the tileset](#f889)'
  id: totrans-15
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '- [修改图块集](#f889)'
- en: '[**Styling the Base Map**](#f083) **-** [Create a JSON style file](#96b2)'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[**样式化基础地图**](#f083) **-** [创建 JSON 样式文件](#96b2)'
- en: '- [Serve styled map tiles](#d5a8)'
  id: totrans-17
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '- [提供样式化的地图图块](#d5a8)'
- en: '[**Creating the Web Map**](#ea4d) **-** [Loading the base map](#c765)'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[**创建网络地图**](#ea4d) **-** [加载基础地图](#c765)'
- en: '- [Overlaying data on the map](#883f)'
  id: totrans-19
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '- [在地图上叠加数据](#883f)'
- en: There are many ways to make a map. We can use desktop GIS software such as QGIS
    or ArcGIS, web frameworks such as Leaflet or Mapbox GL JS, or do things the old
    fashioned way with ink and paper.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 制作地图的方式有很多种。我们可以使用桌面 GIS 软件，如 QGIS 或 ArcGIS，使用 Web 框架，如 Leaflet 或 Mapbox GL
    JS，或者使用传统的墨水和纸张来完成。
- en: Web maps are a great choice for presenting spatial data because they are easily
    shareable and have the benefit of being interactive. There are a number of tools
    available that make the process of creating a web map straightforward whilst giving
    us full control over the different elements of the map.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 网络地图是展示空间数据的绝佳选择，因为它们易于分享且具有互动性。现在有许多工具可以使创建网络地图的过程变得简单，同时让我们完全控制地图的各个元素。
- en: '**I will be going through of the full process of creating your own map using
    open source software and open data sources**, including how to create a custom
    vector base map with **OpenStreetMap** and **Natural** **Earth** data, serve tiles
    using **Tileserver**, load your base map on a web page and overlay spatial data
    on the map using **Maplibre**.'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '**我将介绍使用开源软件和开放数据源创建您自己的地图的完整过程**，包括如何使用**OpenStreetMap**和**Natural** **Earth**数据创建自定义矢量基础地图，使用**Tileserver**提供图块，将基础地图加载到网页上，并使用**Maplibre**在地图上叠加空间数据。'
- en: As an example, I will create a peat bog of Ireland showing bog loss over a ten
    year period. I have prepared data from the Corine Land Cover inventory so that
    it is ready to display on a web map. The result will be an aesthetically pleasing
    map of Ireland’s bogs viewable in the browser.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 作为示例，我将创建一个展示十年期间泥炭沼泽损失的爱尔兰泥炭沼泽地图。我已准备好来自 Corine 土地覆盖清单的数据，使其可以在网络地图上显示。最终结果将是一个在浏览器中可查看的美观的爱尔兰沼泽地图。
- en: 'You can view a deployed version of the final map here: [https://marymcguire.dev/ireland-bog-map](https://marymcguire.dev/ireland-bog-map.html)'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '你可以在这里查看已部署的最终地图版本: [https://marymcguire.dev/ireland-bog-map](https://marymcguire.dev/ireland-bog-map.html)'
- en: 'The repository for this project is found [here](https://github.com/mmc1718/webmap-ireland):'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 这个项目的代码库可以在[这里](https://github.com/mmc1718/webmap-ireland)找到：
- en: '[](https://github.com/mmc1718/webmap-ireland?source=post_page-----4069c01e26ac--------------------------------)
    [## GitHub - mmc1718/webmap-ireland: webmap displaying peat bogs in Ireland'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://github.com/mmc1718/webmap-ireland?source=post_page-----4069c01e26ac--------------------------------)
    [## GitHub - mmc1718/webmap-ireland: 显示爱尔兰泥炭沼泽的网络地图'
- en: webmap displaying peat bogs in Ireland. Contribute to mmc1718/webmap-ireland
    development by creating an account on…
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 显示爱尔兰泥炭沼泽的网络地图。通过创建账户来为mmc1718/webmap-ireland的发展做贡献…
- en: github.com](https://github.com/mmc1718/webmap-ireland?source=post_page-----4069c01e26ac--------------------------------)
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: github.com](https://github.com/mmc1718/webmap-ireland?source=post_page-----4069c01e26ac--------------------------------)
- en: Docker will be the main dependency in this project, so if you haven’t already
    you will need to install it in order to follow along. Some basic knowledge of
    GIS concepts will be assumed, along with basic use of the terminal, reading JSON
    files, and an ability to follow simple examples using JavaScript and HTML.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: Docker将是这个项目的主要依赖，因此如果你还没有安装，你需要先安装它才能继续。假设你具有一些基本的GIS概念知识，基本的终端使用、读取JSON文件的能力，并能够跟随使用JavaScript和HTML的简单示例。
- en: How web maps work
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网络地图如何工作
- en: 'Digital maps are comprised of two main parts: the base map, and the data layer.
    If you aren’t already familiar with web maps, they are no different.'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 数字地图由两个主要部分组成：基础地图和数据层。如果你还不熟悉网络地图，它们与此无异。
- en: '![](../Images/e345905b73b9fa9195ccc40937cd8690.png)![](../Images/43af9a50646f79bd82da4a20c15a17d7.png)![](../Images/1118d9d74e974465a05e4d8583c6abdd.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/e345905b73b9fa9195ccc40937cd8690.png)![](../Images/43af9a50646f79bd82da4a20c15a17d7.png)![](../Images/1118d9d74e974465a05e4d8583c6abdd.png)'
- en: Three web map views of Dublin, map data copyright OpenStreetMap
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 都柏林的三个网络地图视图，地图数据版权归OpenStreetMap所有
- en: The data layer is usually the reason for making a map in the first place. The
    base map provides a basic map for us to overlay our data on. Styling is important
    both for the base map, to support the data layer whilst not being distracting,
    and for the data layer by making the data legible and conveying additional information
    about its value (darker or lighter colours, or larger or smaller symbols convey
    meaning).
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 数据层通常是制作地图的根本原因。基础地图为我们提供了一个基础地图，以便我们在其上叠加数据。样式设计对基础地图很重要，以支持数据层而不分散注意力，并且对数据层也很重要，使数据可读并传达关于其价值的附加信息（较暗或较亮的颜色，或较大或较小的符号传达不同的意义）。
- en: Typically, web base maps come in the form of sets of individual map tile pieces,
    which fit together to make a map.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，网络基础地图以一组单独的地图瓦片的形式出现，这些瓦片拼接在一起形成一张地图。
- en: '![](../Images/bb58f4bc4fd4fe639f279659a113f506.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/bb58f4bc4fd4fe639f279659a113f506.png)'
- en: 'Diagram taken from **Web Map Tile Services for Spatial Data Infrastructures:
    Management and Optimization**, chapter published under CC BY license available
    at [https://www.intechopen.com/chapters/38302#F1](https://www.intechopen.com/chapters/38302#F1)'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 图示摘自**《空间数据基础设施的Web地图瓦片服务：管理与优化》**，该章节在CC BY许可证下发布，详细信息请参见[https://www.intechopen.com/chapters/38302#F1](https://www.intechopen.com/chapters/38302#F1)
- en: Importantly, the map tiles are sorted into different zoom levels, meaning that
    a complete map tileset actually includes many versions of the map — one for each
    zoom level. As you scroll in and out on a web map (or ‘slippy map’), the features
    become more or less detailed, with some only appearing once you have hit certain
    zoom levels. In the background, the page loads new tile pieces corresponding to
    the zoom level and section of the map you are viewing.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是，这些地图瓦片被分类为不同的缩放级别，这意味着完整的地图瓦片集实际上包括了许多版本的地图——每个缩放级别一个。当你在网络地图（或“滑动地图”）上放大或缩小时，地图特征会变得更加详细或不那么详细，有些特征只有在达到某些缩放级别时才会出现。在后台，页面会加载与当前查看的缩放级别和地图部分相对应的新瓦片。
- en: Put together, this collection of tiles is known as a tile pyramid. We visualise
    it as a pyramid because the higher the zoom, the more tiles are needed to cover
    the entire area. [Maptiler has a great visualisation of this](https://www.maptiler.com/google-maps-coordinates-tile-bounds-projection/#3/-46.28/26.66)
    which you can refer to when getting started with web maps.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 将这些瓦片拼凑在一起，就形成了一个瓦片金字塔。我们将其视为金字塔，因为缩放级别越高，覆盖整个区域所需的瓦片就越多。[Maptiler提供了一个很好的可视化图示](https://www.maptiler.com/google-maps-coordinates-tile-bounds-projection/#3/-46.28/26.66)，你可以在开始使用网络地图时参考。
- en: You have likely heard of the distinction between vector and raster data when
    working with geospatial data. Map tiles are no different; the individual tiles
    can either be vector tiles, usually in the form of a .pbf file, or raster (.png)
    files.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理地理空间数据时，你可能听说过矢量数据和栅格数据之间的区别。地图切片也不例外；单个切片可以是矢量切片，通常是 .pbf 文件，也可以是栅格 (.png)
    文件。
- en: I will be creating a tileset of vector tiles stored in Mapbox’s MBTiles format
    for the base map. I prefer vector because of the flexibility they provide.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 我将创建一个存储在 Mapbox 的 MBTiles 格式中的矢量切片集作为基础地图。我更喜欢矢量，因为它们提供了更多的灵活性。
- en: Preparing The Base Map
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备基础地图
- en: Creating a vector tileset
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建矢量切片集
- en: The first step is to create the base map tileset. There are many pre made base
    maps available, however I want the map to put the focus on the island of Ireland,
    excluding Great Britain. This is not commonly available, so I will be making my
    own base map.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是创建基础地图切片集。有许多现成的基础地图可用，但我希望地图将重点放在爱尔兰岛上，排除大不列颠。这并不常见，因此我将制作自己的基础地图。
- en: I use [**Planetiler**](https://github.com/onthegomap/planetiler) to create vector
    tile base maps. Planetiler is a tool for creating vector map tilesets and is impressively
    fast. There is even a Docker image available, which makes generating a full tileset
    using Planetiler easy. Planetiler uses OpenStreetMap data to create map tiles
    and luckily for me, data extracts for Ireland and Northern Ireland are already
    available.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 我使用[**Planetiler**](https://github.com/onthegomap/planetiler)来创建矢量切片基础地图。Planetiler
    是一个创建矢量地图切片集的工具，速度非常快。甚至还有一个 Docker 镜像，这使得使用 Planetiler 生成完整的切片集变得简单。Planetiler
    使用 OpenStreetMap 数据来创建地图切片，而对我来说，爱尔兰和北爱尔兰的数据提取已经可用。
- en: 'Running the following command will download the required data and generate
    a tileset using the OpenMapTiles schema as default:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 运行以下命令将下载所需的数据，并使用 OpenMapTiles 架构作为默认值生成切片集：
- en: '[PRE0]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Notice the minzoom parameter is set to 4\. This is because since our map focuses
    on Ireland only, there is no need to generate tiles at the very low zooms where
    Ireland is too small to see properly. Zoom 4 is the lowest that we need to go
    and setting a limit will save us tile generation time.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 注意 minzoom 参数设置为 4。这是因为我们的地图仅关注爱尔兰，所以不需要在爱尔兰过于小的非常低的缩放级别生成切片。缩放级别 4 是我们需要的最低级别，设置限制将节省切片生成时间。
- en: The amount of time Planetiler will take to finish will vary depending on your
    hardware, but can take an hour or more. Leave the process running and do something
    else while waiting.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: Planetiler 完成的时间将根据你的硬件而有所不同，但可能需要一个小时或更长时间。让进程运行，等待的同时做些其他事情。
- en: Once the tiles are finished, we are ready to view them. I use [**Tileserver**](https://github.com/maptiler/tileserver-gl)
    to do this. Once again, we can use Docker to run this step and save us time. Make
    sure you run this command in your terminal from the same directory as the tiles,
    or run using the full path to the mbtiles.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦切片完成，我们就可以查看它们。我使用[**Tileserver**](https://github.com/maptiler/tileserver-gl)来完成这项工作。同样，我们可以使用
    Docker 来运行此步骤，从而节省时间。确保在与切片相同的目录中运行此命令，或者使用 mbtiles 的完整路径运行。
- en: '[PRE1]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Our tiles will now be viewable at http://localhost:8080.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的切片现在可以在 http://localhost:8080 上查看。
- en: By default, Tileserver gives us the option to view either the raw tile data
    or styled tiles using the basic style. This is useful for checking our tiles are
    as expected and identifying any problems.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Tileserver 允许我们查看原始切片数据或使用基本样式的样式化切片。这对于检查我们的切片是否符合预期并识别任何问题非常有用。
- en: Even though the raw data isn’t styled, the features are colour coded according
    the data layer they are in, with a legend at the side with the details. This will
    be important to note when it comes to styling.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 即使原始数据没有样式，功能也会根据它们所在的数据层进行颜色编码，并且旁边有一个图例显示详细信息。这在样式化时需要特别注意。
- en: Identifying required changes
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 确定所需的更改
- en: Viewing the tile data reveals an immediate problem with the tiles as they are.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 查看切片数据揭示了切片本身存在的一个直接问题。
- en: '![](../Images/98dd783a9410ac2c9070723852d6cfe1.png)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/98dd783a9410ac2c9070723852d6cfe1.png)'
- en: Viewing the unstyled vector tileset using Tileserver GL
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Tileserver GL 查看未样式化的矢量切片集
- en: Even though we used data for Ireland and Northern Ireland only to generate our
    map, the outline of Great Britain is still visible. This is because Planetiler
    generates ocean polygons to fill in the water extent, leaving the land mass empty.
    What we are seeing is a hole in the ocean where the island of Great Britain should
    be — if you click on the island, you will see there are no features, not even
    land mass.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我们仅使用了爱尔兰和北爱尔兰的数据来生成地图，但大不列颠的轮廓仍然可见。这是因为 Planetiler 生成了填充水域的海洋多边形，使得陆地部分为空。我们看到的是大不列颠岛应在的位置的海洋空洞——如果你点击岛屿，你会发现没有特征，连陆地都没有。
- en: What can we do about the cut-out ocean effect? There is nothing we can do to
    fill in the hole, but what matters for our purposes is that we can style the background
    and land borders. Usually this would be done by styling the ocean around the land
    so that the background fills in the land. We will need to do this the other way
    around, and include a landmass polygon for the island of Ireland to style and
    contrast with the background.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 我们该如何处理切割海洋效果？我们无法填补空洞，但对我们来说重要的是，我们可以对背景和陆地边界进行样式设置。通常这会通过给陆地周围的海洋设置样式来完成，以使背景填充陆地。我们需要反过来做，为爱尔兰岛包括一个陆地多边形，以对背景进行样式设置和对比。
- en: Before creating a style file, some changes will need to be made. Firstly we
    will need to supplement the data with an extra feature — the land mass of Ireland.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建样式文件之前，需要做一些更改。首先，我们需要用额外的特征来补充数据——爱尔兰的陆地面积。
- en: There is a second issue with the tileset as it is which is a little less obvious
    but seen when zooming in.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 切片集还有一个稍微不那么明显的问题，但在放大时会看到。
- en: '![](../Images/f61c0260c556546df0260d4c4855d094.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f61c0260c556546df0260d4c4855d094.png)'
- en: Notice the county boundaries (in pink) disappear after zoom 4\. Between zooms
    1–4, the Planetiler OpenMapTiles schema uses data from Natural Earth instead of
    OSM for generating a lower resolution map of the planet. After zoom 4, data from
    OpenStreetMap is used. Since we generated tiles starting from zoom 4, this is
    noticeable.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 注意到县界（粉色）在缩放级别 4 之后消失。在缩放级别 1-4 之间，Planetiler OpenMapTiles 模式使用 Natural Earth
    的数据而非 OSM 来生成地球的低分辨率地图。缩放级别 4 之后，使用的是 OpenStreetMap 的数据。由于我们从缩放级别 4 开始生成切片，这一点很明显。
- en: Because the Planetiler OpenMapTiles schema applies for the whole planet, there
    are inevitably some inconsistencies between countries. Irish county borders being
    filtered out of the OSM data is one of these inconsistencies. Our map is of Ireland
    in particular, so we want to get this right.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 Planetiler OpenMapTiles 模式适用于整个星球，不可避免地在国家之间存在一些不一致性。爱尔兰县界被从 OSM 数据中过滤掉就是这些不一致性之一。我们的地图特别是关于爱尔兰的，因此我们希望把它做对。
- en: Aside from the inconsistency, county boundaries are an important feature in
    a map of Ireland that we would prefer to include at all zooms.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 除了不一致性外，县界在爱尔兰地图上是一个重要特征，我们希望在所有缩放级别中都包括它。
- en: The easy solution is to add the county boundaries from Natural Earth back into
    the tileset from zoom 4 upwards.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 简单的解决方案是从缩放级别 4 开始，将 Natural Earth 的县界添加回切片集中。
- en: Modifying the tileset
  id: totrans-68
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 修改切片集
- en: '[**Tippecanoe**](https://github.com/felt/tippecanoe) is a really useful tool
    for working with MBTiles tilesets. It allows us to create mbtiles from GeoJSON
    data and merge MBtiles files together. All we need is the required extra data
    in GeoJSON format and we can merge the required features into the tileset.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '[**Tippecanoe**](https://github.com/felt/tippecanoe) 是一个非常有用的工具，用于处理 MBTiles
    切片集。它允许我们从 GeoJSON 数据创建 mbtiles，并将 MBtiles 文件合并在一起。我们只需要所需的额外数据（GeoJSON 格式），就可以将所需的特征合并到切片集中。'
- en: '[](https://github.com/felt/tippecanoe?source=post_page-----4069c01e26ac--------------------------------)
    [## GitHub - felt/tippecanoe: Build vector tilesets from large collections of
    GeoJSON features.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://github.com/felt/tippecanoe?source=post_page-----4069c01e26ac--------------------------------)
    [## GitHub - felt/tippecanoe: 从大型 GeoJSON 特征集合中构建矢量切片集。'
- en: 'Build vector tilesets from large collections of GeoJSON features. - GitHub
    - felt/tippecanoe: Build vector tilesets…'
  id: totrans-71
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '从大型 GeoJSON 特征集合中构建矢量切片集。- GitHub - felt/tippecanoe: 从大型 GeoJSON 特征集合中构建矢量切片集…'
- en: github.com](https://github.com/felt/tippecanoe?source=post_page-----4069c01e26ac--------------------------------)
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '[**GitHub - felt/tippecanoe**](https://github.com/felt/tippecanoe?source=post_page-----4069c01e26ac--------------------------------)'
- en: For fetching a polygon representing Ireland - or more likely multipolygon, thanks
    to its islands - I turn to OpenStreetMap, specifically [Overpass Turbo](https://overpass-turbo.eu/).
    It is not immediately clear which feature we need (the island of Ireland? Ireland
    and Northern Ireland?) so some exploration is needed.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 为了获取表示爱尔兰的多边形——或更可能是多多边形，感谢其岛屿——我转向OpenStreetMap，特别是[Overpass Turbo](https://overpass-turbo.eu/)。不立即清楚我们需要哪个特征（爱尔兰岛？爱尔兰和北爱尔兰？），因此需要一些探索。
- en: By using the ‘query features’ tool on [openstreetmap.org](https://www.openstreetmap.org/),
    I am able to find two relations which when combined, result in exactly the feature
    I need. By inspecting the tags I can create a query to use with Overpass.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在[openstreetmap.org](https://www.openstreetmap.org/)上使用‘查询特征’工具，我能够找到两个关系，当它们结合时，结果正是我所需要的特征。通过检查标签，我可以创建一个查询以供Overpass使用。
- en: 'Fetching the two features using **Overpass Turbo** looks like this:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**Overpass Turbo**获取两个特征如下所示：
- en: '![](../Images/7f751f4fd2ba3c1d59a8bd059d9f833d.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7f751f4fd2ba3c1d59a8bd059d9f833d.png)'
- en: Screenshot of Overpass Turbo with relations of Ireland and Ulster displayed
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: Overpass Turbo的截图，显示了爱尔兰和阿尔斯特的关系
- en: 'The query:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 查询：
- en: '[PRE2]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The export button gives us the option to save the results as a GeoJSON file.
    All that is left to do is merge the two features so that we are left with one
    MultiPolygon.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 导出按钮允许我们将结果保存为GeoJSON文件。剩下的就是合并这两个特征，以便得到一个MultiPolygon。
- en: 'The county boundaries are available to download from the [Natural Earth site](https://www.naturalearthdata.com/downloads/10m-cultural-vectors/).
    In fact, Planetiler will have already downloaded a copy of the Natural Earth data
    for you, but since we need country boundaries only, it will be simpler to download
    this extract separately. The file is called *Admin 1 — States, Provinces* and
    the download link here:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 县界线可以从[Natural Earth网站](https://www.naturalearthdata.com/downloads/10m-cultural-vectors/)下载。实际上，Planetiler已经为你下载了Natural
    Earth数据的副本，但由于我们只需要国家边界，单独下载此提取文件会更简单。文件名为*Admin 1 — States, Provinces*，下载链接如下：
- en: '[https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_1_states_provinces.zip](https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_1_states_provinces.zip)'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_1_states_provinces.zip](https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_1_states_provinces.zip)'
- en: You can find an example notebook preparing the two [GeoJSON files in the repo
    for this project](https://github.com/mmc1718/webmap-ireland/blob/main/notebooks/ireland_outline_counties.ipynb).
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在这个项目的[GeoJSON文件示例笔记本](https://github.com/mmc1718/webmap-ireland/blob/main/notebooks/ireland_outline_counties.ipynb)中找到准备两个GeoJSON文件的例子。
- en: 'Once the GeoJSON files are ready, you can clone the [Tippecanoe repo](https://github.com/felt/tippecanoe)
    from GitHub and build the image using Docker or install from source (see the README
    for instructions). The commands I used to merge the data to my tileset are:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦GeoJSON文件准备好后，你可以从GitHub克隆[Tippecanoe repo](https://github.com/felt/tippecanoe)，并使用Docker构建镜像或从源代码安装（请参阅README获取说明）。我用于将数据合并到我的tileset中的命令如下：
- en: '[PRE3]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Using Tileserver to preview the new tiles after merging the new data in, we
    notice some changes.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Tileserver预览合并新数据后的新图块时，我们注意到了一些变化。
- en: 'Tip: when running Tileserver, make sure you are using the correct mbtiles file,
    the one you created using Tippecanoe. Use the parameter `--mbtiles` when running
    Tileserver to specify the file.'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 提示：运行Tileserver时，请确保使用的是正确的mbtiles文件，即你使用Tippecanoe创建的文件。运行Tileserver时使用参数`--mbtiles`来指定文件。
- en: '![](../Images/17d7441d51a350009b991bbcec93d8c0.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/17d7441d51a350009b991bbcec93d8c0.png)'
- en: Unstyled view of the vector data including Ireland and county boundary layers
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 未样式化的矢量数据视图，包括爱尔兰和县界层
- en: The legend provides a quick way to verify our new layers are present. We can
    see two new layers here; ‘ireland’ and ‘counties*’*.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 图例提供了一种快速验证我们新图层是否存在的方法。我们可以在这里看到两个新图层；‘ireland’和‘counties*’*。
- en: Styling the base map
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 样式化基础地图
- en: Creating a JSON style file
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建JSON样式文件
- en: Now we have prepared our base tileset, we are ready to start styling. When making
    the style I chose to highlight natural features such as mountains, with a reduced
    focus on man made infrastructure such as motorways, in-keeping with the subject
    matter of bogs.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经准备好基础tileset，准备开始样式化。当制作样式时，我选择突出自然特征如山脉，减少对如高速公路等人造基础设施的关注，以保持沼泽主题。
- en: If you aren’t familiar with map styles, they are JSON documents which contain
    information about how to style the vector data in your tileset. [**Maputnik**](https://maputnik.github.io/)
    is an style editor we can use for creating and editing styles which allows us
    to preview our style as well as the raw data whilst working. It is an open source
    alternative to Mapbox’s style editor and can be run using the publicly available
    Docker image.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你对地图样式不熟悉，它们是包含有关如何样式化切片集中矢量数据的信息的 JSON 文档。 [**Maputnik**](https://maputnik.github.io/)
    是一个样式编辑器，我们可以用来创建和编辑样式，它允许我们在工作时预览样式和原始数据。它是 Mapbox 样式编辑器的一个开源替代品，可以使用公开的 Docker
    镜像运行。
- en: '[](https://github.com/maputnik/editor?source=post_page-----4069c01e26ac--------------------------------)
    [## GitHub - maputnik/editor: An open source visual editor for the ''Mapbox Style
    Specification'''
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://github.com/maputnik/editor?source=post_page-----4069c01e26ac--------------------------------)
    [## GitHub - maputnik/editor: 一个开源的视觉编辑器，用于''Mapbox Style Specification'''
- en: 'An open source visual editor for the ''Mapbox Style Specification'' - GitHub
    - maputnik/editor: An open source visual…'
  id: totrans-96
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '一个开源的视觉编辑器，用于''Mapbox Style Specification'' - GitHub - maputnik/editor: 一个开源的视觉…'
- en: github.com](https://github.com/maputnik/editor?source=post_page-----4069c01e26ac--------------------------------)
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: github.com](https://github.com/maputnik/editor?source=post_page-----4069c01e26ac--------------------------------)
- en: Once Maputnik is open, open an empty style.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦 Maputnik 打开，打开一个空白样式。
- en: The first thing we need to do is connect it to our tileset. This is done using
    the ‘Data Sources’ tab. You will need to copy the link to your TileJSON file —
    viewable using Tileserver — and paste it into the `#OpenMapTiles` active data
    source. The TileJSON file is a JSON metadata file containing information about
    your tileset including the source URL.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要将其连接到我们的切片集。这是通过‘数据源’选项卡完成的。你需要复制你的 TileJSON 文件的链接 —— 使用 Tileserver 可以查看
    —— 并将其粘贴到 `#OpenMapTiles` 活跃的数据源中。TileJSON 文件是一个包含有关你的切片集信息的 JSON 元数据文件，包括源 URL。
- en: '![](../Images/af62051af037826a81fe2bae5a6f2444.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/af62051af037826a81fe2bae5a6f2444.png)'
- en: Screenshot of Maputnik with Sources window open
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: Maputnik 截图，显示了 Sources 窗口
- en: If all is working well, you should be able to switch the view from ‘Map’ to
    ‘Inspect’ and see your data on the screen. The data will look similar to the raw
    data viewed using Tileserver. Until you have created some style layers, your ‘Map’
    view will just show a blank screen.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切正常，你应该能够将视图从‘地图’切换到‘检查’，并在屏幕上看到你的数据。数据将类似于使用 Tileserver 查看的原始数据。在你创建了一些样式图层之前，你的‘地图’视图将只显示一个空白屏幕。
- en: '![](../Images/141d2f4ba24e4005b9b4bc7af3afd5f2.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/141d2f4ba24e4005b9b4bc7af3afd5f2.png)'
- en: Switching between map and inspect views in Maputnik
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Maputnik 中切换地图和检查视图
- en: Specifying how the features should be styled is done using style layers. These
    layers can be edited in the side panel in Maputnik and will be translated into
    JSON objects in the ‘layers’ field within our final style JSON file. Click the
    ‘Add Layer’ button to get started.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 指定特征样式的方式是通过样式图层完成的。这些图层可以在 Maputnik 的侧边面板中编辑，并将被转换为我们最终样式 JSON 文件中的‘layers’字段中的
    JSON 对象。点击‘添加图层’按钮开始操作。
- en: The first layer to create is typically the background. After that, add layers
    to target different features as you wish. Note the ordering of the layers makes
    a difference — features will be rendered on top of or behind each other depending
    on the style ordering.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个创建的图层通常是背景。之后，根据需要添加图层以定位不同的特征。注意图层的顺序会有所不同 —— 特征将根据样式顺序显示在彼此的上方或下方。
- en: Which features a style layer affects depends on its source (which data layer
    the features are in, e.g. transportation or landuse) and the filters we set. You
    can specify this when making the layer.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 样式图层影响哪些特征取决于其源（特征所在的数据层，例如运输或土地使用）以及我们设置的过滤器。你可以在创建图层时指定这一点。
- en: 'For example, we can filter the boundary style layer to only affect land boundaries
    within the boundary source layer, ignoring the sea boundaries present by using
    the maritime tag:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们可以过滤边界样式图层，以仅影响边界源图层中的陆地边界，通过使用 maritime 标签忽略海洋边界：
- en: '![](../Images/c9154a6b2b79503b53f820b81a0dc2d1.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c9154a6b2b79503b53f820b81a0dc2d1.png)'
- en: County boundary style options viewed in Maputnik
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Maputnik 中查看的县界样式选项
- en: 'In the JSON this field ends up being the following:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在 JSON 中，这个字段最终变成如下：
- en: '[PRE4]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: In the side panel at the bottom you can see what the raw JSON looks like.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在底部的侧边面板中，你可以看到原始 JSON 的样子。
- en: Note that multiple style sheets can affect the same feature(s). This makes it
    possible to render different versions of the same feature, e.g. a point feature
    can show as both a label and an image.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，多个样式表可以影响相同的特征。这使得能够渲染相同特征的不同版本，例如一个点特征可以同时显示为标签和图像。
- en: Styles created using Maputnik adhere to the Mapbox Style Specification, so if
    in doubt you can [check the documentation](https://docs.mapbox.com/mapbox-gl-js/style-spec/).
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Maputnik 创建的样式遵循 Mapbox 样式规范，因此如果有疑问，你可以 [查看文档](https://docs.mapbox.com/mapbox-gl-js/style-spec/)。
- en: You can view my final style [here](https://github.com/mmc1718/webmap-ireland/blob/main/tileserver/styles/ireland.json).
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在 [这里](https://github.com/mmc1718/webmap-ireland/blob/main/tileserver/styles/ireland.json)
    查看我最终的样式。
- en: There in a wealth of information online when it comes to tips on cartography.
    Esri has published [a list of online resources](https://www.esri.com/arcgis-blog/products/product/mapping/favorite-tools-and-resources-for-cartographers/),
    which is a great place to start.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在线有大量关于制图的提示信息。Esri 发布了 [一份在线资源列表](https://www.esri.com/arcgis-blog/products/product/mapping/favorite-tools-and-resources-for-cartographers/)，这是一个很好的起点。
- en: Note for the style I have added an extra remote source for fonts and sprites
    (logos or images). This can be done in the sources window in Maputnik where we
    added our tile source. The sources I use are `https://orangemug.github.io/font-glyphs/glyphs/{fontstack}/{range}.pbf`
    for fonts and `https://openmaptiles.github.io/osm-bright-gl-style/sprite` for
    sprites. (check out Orange Mug’s custom fonts repo here [https://github.com/orangemug/font-glyphs](https://github.com/orangemug/font-glyphs))
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，我为样式添加了一个额外的远程字体和精灵（徽标或图像）源。这可以在 Maputnik 的源窗口中完成，我们在这里添加了我们的图块源。我使用的源是
    `https://orangemug.github.io/font-glyphs/glyphs/{fontstack}/{range}.pbf` 用于字体和
    `https://openmaptiles.github.io/osm-bright-gl-style/sprite` 用于精灵。（查看 Orange Mug
    的自定义字体库 [https://github.com/orangemug/font-glyphs](https://github.com/orangemug/font-glyphs)）
- en: Serving styled map tiles
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 提供样式地图图块
- en: Once your style is ready, download it from Maputnik and save it in the same
    directory as your MBTiles tileset. We will need to create a config file for Tileserver
    so that it can find your custom style when serving tiles.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你的样式准备好，从 Maputnik 下载它并保存在与你的 MBTiles 图块集相同的目录中。我们需要为 Tileserver 创建一个配置文件，以便在提供图块时它可以找到你的自定义样式。
- en: Create a new file called config.json and make sure it contains something like
    the following.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个名为 config.json 的新文件，并确保其包含如下内容。
- en: '[PRE5]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: This config file will load an mbtiles file named ireland.mbtiles (using the
    path defined under options -> paths -> mbtiles). Tileserver will look for a style
    file called ireland.json found in the styles directory (options -> paths -> styles)
    to serve. Note that the paths for fonts, styles and mbtiles are assumed to be
    relative to root.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 这个配置文件将加载一个名为 ireland.mbtiles 的 mbtiles 文件（使用在选项 -> 路径 -> mbtiles 下定义的路径）。Tileserver
    将查找在样式目录（选项 -> 路径 -> styles）中名为 ireland.json 的样式文件来提供服务。请注意，字体、样式和 mbtiles 的路径假定是相对于根目录的。
- en: Restarting Tileserver in the directory containing our new config file will make
    our new style available for viewing at localhost:8080.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在包含新配置文件的目录中重新启动 Tileserver 将使我们新的样式在 localhost:8080 上可供查看。
- en: 'Tip: If you want your tiles to be available somewhere other than localhost,
    you will need to include ‘domains’ in your config. See the [Tileserver docs](https://tileserver.readthedocs.io/en/latest/config.html)
    for details.'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 提示：如果你希望你的图块在 localhost 之外的地方可用，你需要在配置文件中包含‘domains’。详细信息请参见 [Tileserver 文档](https://tileserver.readthedocs.io/en/latest/config.html)。
- en: Creating the Web Map
  id: totrans-126
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建 Web 地图
- en: Loading the base map
  id: totrans-127
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 加载基础地图
- en: We have our base map and style. Now all that is left is to overlay the data
    on the map. I have two data files concerning bogs across Ireland. The steps I
    took to prepare the data can be viewed [on GitHub](https://github.com/mmc1718/webmap-ireland/tree/main/notebooks).
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经有了基础地图和样式。现在剩下的就是将数据叠加到地图上。我有两个关于爱尔兰沼泽的数据文件。我准备数据的步骤可以在 [GitHub](https://github.com/mmc1718/webmap-ireland/tree/main/notebooks)
    上查看。
- en: I am using [Maplibre](https://maplibre.org/) to create my map. Maplibre is the
    open source alternative to Mapbox GL JS and is very similar. We can add a JavaScript
    script directly in our HTML file, or we can use a JavaScript file and import it.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 我使用 [Maplibre](https://maplibre.org/) 来创建我的地图。Maplibre 是 Mapbox GL JS 的开源替代品，非常相似。我们可以直接在
    HTML 文件中添加 JavaScript 脚本，或者使用 JavaScript 文件并导入它。
- en: Following the example in [Maplibre’s documentation,](https://maplibre.org/maplibre-gl-js/docs/)
    get started by creating an HTML file. Include a `<script>` tag with the following
    snippet which will create a map instance using the newly created custom base map.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 按照[Maplibre 文档](https://maplibre.org/maplibre-gl-js/docs/)中的示例，首先创建一个 HTML 文件。包含一个`<script>`标签，标签内的代码将使用新创建的自定义底图创建地图实例。
- en: '[PRE6]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Note I have included the link to my style file being served by Tileserver in
    the ‘style’ field.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我在‘style’字段中包含了由 Tileserver 提供的样式文件链接。
- en: 'Setting bounds means the user will not be able to pan the map outside the defined
    bounding box coordinates, which is useful since our data is confined to a small
    area of the map. By default it is possible to pan accross the whole world, not
    what we want in our case. Custom bounds can be found using this handy tool: [https://norbertrenner.de/osm/bbox.html](https://norbertrenner.de/osm/bbox.html).'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 设置边界意味着用户将无法将地图平移到定义的边界框坐标之外，这很有用，因为我们的数据仅限于地图上的一个小区域。默认情况下，可以平移整个世界，这在我们的情况下并不是我们想要的。可以使用这个方便的工具找到自定义边界：[https://norbertrenner.de/osm/bbox.html](https://norbertrenner.de/osm/bbox.html)。
- en: 'To view our page we will need a web server. I use [VSCode’s Live Server](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer)
    extension for quickly viewing web pages while developing locally. It is free to
    install and means you can serve web apps with the click of a button. Loading the
    page will show us our base map:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看我们的页面，我们需要一个 Web 服务器。我使用[VSCode 的 Live Server](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer)
    扩展来快速查看开发中的网页。它可以免费安装，并且意味着你只需点击一下按钮即可提供 Web 应用。加载页面将显示我们的底图：
- en: '![](../Images/8b09e5c4d3090e556143ab75257f3435.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/8b09e5c4d3090e556143ab75257f3435.png)'
- en: Base map of Ireland, styled by author
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 作者样式的爱尔兰底图
- en: Overlaying data on the map
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在地图上叠加数据
- en: Next, we add the data layers to our map. Again, the Maplibre website has many
    examples covering a range of scenarios which you can use when creating your map.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将数据图层添加到地图中。同样，Maplibre 网站提供了许多示例，涵盖了创建地图时可能遇到的各种场景。
- en: To load GeoJSON files, we first need to add the file paths as sources. Once
    we have defined the file sources, we can then add layers with styling options
    to the map. This is all done inside a function which is run when the map’s ‘load’
    event triggers (this is what `map.on(“load" …)`means). I have named the new function
    `setUpMap` and passed it into`map.on(“load")` as the second parameter.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 要加载 GeoJSON 文件，我们首先需要将文件路径添加为源。定义文件源后，我们可以将具有样式选项的图层添加到地图上。这一切都在一个函数中完成，该函数在地图的“加载”事件触发时运行（这就是`map.on(“load"
    …)`的意思）。我将新函数命名为`setUpMap`并将其作为第二个参数传递给`map.on(“load")`。
- en: '[PRE7]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Each layer is styled using a different colour and is slightly transparent to
    allow place labels and details in the base map to show through. I used [this handy
    tool](https://www.colorhexa.com/647433) for choosing and comparing colours.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 每个图层使用不同的颜色进行样式设置，并且稍微透明，以便基础地图中的地点标签和细节能够显示出来。我使用了[这个方便的工具](https://www.colorhexa.com/647433)来选择和比较颜色。
- en: 'I also added an interactive legend using a plug-in called maplibre-gl-legend
    found here: [https://github.com/watergis/maplibre-gl-legend](https://github.com/watergis/maplibre-gl-legend).
    The following code defines the legend:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 我还使用了一个名为 maplibre-gl-legend 的插件，插件可以在这里找到：[https://github.com/watergis/maplibre-gl-legend](https://github.com/watergis/maplibre-gl-legend)。以下代码定义了图例：
- en: '[PRE8]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The legend also provides a way for me to include an attribution for the data
    source without having to add this elsewhere.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 图例还提供了一种方式，使我能够为数据源包含署名，而无需在其他地方添加这一内容。
- en: 'Viewing the final result shows us a map of bogland complete with an interactive
    legend:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 查看最终结果，我们可以看到一个完整的沼泽地地图，附带互动图例：
- en: '![](../Images/55218bc6cdf3434c780312d6c6b4090f.png)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/55218bc6cdf3434c780312d6c6b4090f.png)'
- en: Map of peat bog loss in Ireland between 2000–2012 with legend
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 爱尔兰2000–2012年间泥炭沼泽损失的地图，附带图例
- en: '*Thanks for reading! If you found this article useful, consider leaving a clap,
    following the author or starring the project on GitHub👏*'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '*感谢阅读！如果你觉得这篇文章有用，可以考虑点赞、关注作者或在 GitHub 上给项目加星👏*'
