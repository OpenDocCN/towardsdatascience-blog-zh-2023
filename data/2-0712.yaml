- en: Learn How to Build and Deploy a Voice Chatbot with Langchain and BentoML
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å­¦ä¹ å¦‚ä½•ä½¿ç”¨Langchainå’ŒBentoMLæ„å»ºå’Œéƒ¨ç½²ä¸€ä¸ªè¯­éŸ³èŠå¤©æœºå™¨äºº
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/deploy-a-voice-based-chatbot-with-bentoml-langchain-and-gradio-7f25af3e45df](https://towardsdatascience.com/deploy-a-voice-based-chatbot-with-bentoml-langchain-and-gradio-7f25af3e45df)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/deploy-a-voice-based-chatbot-with-bentoml-langchain-and-gradio-7f25af3e45df](https://towardsdatascience.com/deploy-a-voice-based-chatbot-with-bentoml-langchain-and-gradio-7f25af3e45df)
- en: BentoML is Like Lego for ML engineers
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BentoML å¯¹æœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆå°±åƒä¹é«˜ç§¯æœ¨
- en: '[](https://ahmedbesbes.medium.com/?source=post_page-----7f25af3e45df--------------------------------)[![Ahmed
    Besbes](../Images/93804d9291439715e578f204b79c9bdd.png)](https://ahmedbesbes.medium.com/?source=post_page-----7f25af3e45df--------------------------------)[](https://towardsdatascience.com/?source=post_page-----7f25af3e45df--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----7f25af3e45df--------------------------------)
    [Ahmed Besbes](https://ahmedbesbes.medium.com/?source=post_page-----7f25af3e45df--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://ahmedbesbes.medium.com/?source=post_page-----7f25af3e45df--------------------------------)[![Ahmed
    Besbes](../Images/93804d9291439715e578f204b79c9bdd.png)](https://ahmedbesbes.medium.com/?source=post_page-----7f25af3e45df--------------------------------)[](https://towardsdatascience.com/?source=post_page-----7f25af3e45df--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----7f25af3e45df--------------------------------)
    [Ahmed Besbes](https://ahmedbesbes.medium.com/?source=post_page-----7f25af3e45df--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----7f25af3e45df--------------------------------)
    Â·11 min readÂ·May 2, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘è¡¨äº[Towards Data Science](https://towardsdatascience.com/?source=post_page-----7f25af3e45df--------------------------------)
    Â·é˜…è¯»æ—¶é•¿11åˆ†é’ŸÂ·2023å¹´5æœˆ2æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/62bdc77c059993e827235577879e894c.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/62bdc77c059993e827235577879e894c.png)'
- en: Photo by [Jason Leung](https://unsplash.com/@ninjason?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '[Jason Leung](https://unsplash.com/@ninjason?utm_source=medium&utm_medium=referral)çš„ç…§ç‰‡ï¼Œæ¥è‡ª[Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)'
- en: In this post, we will guide you through the process of building a voice-based
    ChatGPT clone that relies on the OpenAI API and uses Wikipedia as an additional
    data source.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æŒ‡å¯¼ä½ å¦‚ä½•æ„å»ºä¸€ä¸ªåŸºäºè¯­éŸ³çš„ChatGPTå…‹éš†ï¼Œä¾èµ–äºOpenAI APIå¹¶ä½¿ç”¨ç»´åŸºç™¾ç§‘ä½œä¸ºé¢å¤–çš„æ•°æ®æºã€‚
- en: 'To build and deploy this app, weâ€™ll be using [BentoML](https://github.com/bentoml/BentoML):
    a Python framework for model serving and deployment.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: è¦æ„å»ºå’Œéƒ¨ç½²è¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨[BentoML](https://github.com/bentoml/BentoML)ï¼šä¸€ä¸ªç”¨äºæ¨¡å‹æœåŠ¡å’Œéƒ¨ç½²çš„Pythonæ¡†æ¶ã€‚
- en: BentoML not only helps you build services that connect to third-party proprietary
    APIs. It also supercharges those services by combining them with other open-source
    models, resulting in complex and powerful inference graphs.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: BentoMLä¸ä»…å¸®åŠ©ä½ æ„å»ºè¿æ¥åˆ°ç¬¬ä¸‰æ–¹ä¸“æœ‰APIçš„æœåŠ¡ï¼Œè¿˜é€šè¿‡å°†è¿™äº›æœåŠ¡ä¸å…¶ä»–å¼€æºæ¨¡å‹ç»“åˆèµ·æ¥ï¼Œè¶…çº§å¢å¼ºäº†è¿™äº›æœåŠ¡ï¼Œå½¢æˆå¤æ‚ä¸”å¼ºå¤§çš„æ¨ç†å›¾ã€‚
- en: In fact, the app weâ€™ll be building will have **speech-to-text** and **text-to-speech**
    tasks that will be handled by separate models from the HuggingFace [hub](https://huggingface.co/)
    and an LLM task that will be managed by [**LangChain**](https://langchain.readthedocs.io/).
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: å®é™…ä¸Šï¼Œæˆ‘ä»¬å°†è¦æ„å»ºçš„åº”ç”¨ç¨‹åºå°†åŒ…å«**è¯­éŸ³è½¬æ–‡æœ¬**å’Œ**æ–‡æœ¬è½¬è¯­éŸ³**ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å°†ç”±æ¥è‡ªHuggingFace [hub](https://huggingface.co/)çš„ä¸åŒæ¨¡å‹å¤„ç†ï¼ŒLLMä»»åŠ¡å°†ç”±[**LangChain**](https://langchain.readthedocs.io/)ç®¡ç†ã€‚
- en: After testing the project locally, we will push it to BentoCloud, a platform
    that smoothes the process of versioning, tracking, and deploying ML services to
    the cloud.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬åœ°æµ‹è¯•é¡¹ç›®åï¼Œæˆ‘ä»¬å°†æŠŠå®ƒæ¨é€åˆ°BentoCloudï¼Œè¿™ä¸ªå¹³å°ç®€åŒ–äº†ç‰ˆæœ¬æ§åˆ¶ã€è·Ÿè¸ªå’Œå°†æœºå™¨å­¦ä¹ æœåŠ¡éƒ¨ç½²åˆ°äº‘ç«¯çš„è¿‡ç¨‹ã€‚
- en: '***By the end of this article, you should have comprehensive knowledge of building
    and deploying multi-model services using BentoML. Youâ€™ll also learn about some
    of its specific features that make industrializing models easier.***'
  id: totrans-13
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***åœ¨æœ¬æ–‡ç»“æŸæ—¶ï¼Œä½ åº”è¯¥å¯¹ä½¿ç”¨BentoMLæ„å»ºå’Œéƒ¨ç½²å¤šæ¨¡å‹æœåŠ¡æœ‰å…¨é¢çš„äº†è§£ã€‚ä½ è¿˜å°†å­¦ä¹ åˆ°ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ï¼Œä½¿æ¨¡å‹å·¥ä¸šåŒ–å˜å¾—æ›´å®¹æ˜“ã€‚***'
- en: Without further ado, letâ€™s have a look ğŸ”.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸å†èµ˜è¨€ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ ğŸ”ã€‚
- en: Demo
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ¼”ç¤º
- en: Hereâ€™s a one-minute demo of the app.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯åº”ç”¨ç¨‹åºçš„ä¸€åˆ†é’Ÿæ¼”ç¤ºã€‚
- en: Video by the author â€” A quick demo
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…çš„è§†é¢‘ â€” å¿«é€Ÿæ¼”ç¤º
- en: Why BentoML? ğŸ±
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä¸ºä»€ä¹ˆé€‰æ‹©BentoMLï¼ŸğŸ±
- en: With the ever-increasing number of open-source ML models that solve a huge variety
    of tasks, software applications will gradually become some sort of AI application
    that integrates pre-trained models, self-trained models, or models accessed through
    APIs.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: éšç€è¶Šæ¥è¶Šå¤šçš„å¼€æºæœºå™¨å­¦ä¹ æ¨¡å‹è§£å†³å„ç§ä»»åŠ¡ï¼Œè½¯ä»¶åº”ç”¨ç¨‹åºå°†é€æ¸æˆä¸ºä¸€ç§é›†æˆäº†é¢„è®­ç»ƒæ¨¡å‹ã€è‡ªæˆ‘è®­ç»ƒæ¨¡å‹æˆ–é€šè¿‡APIè®¿é—®æ¨¡å‹çš„äººå·¥æ™ºèƒ½åº”ç”¨ç¨‹åºã€‚
- en: Given that many SOTA models are large and require powerful hardware and distributed
    deployment, fitting everything in one machine will not be a practical solution,
    especially if the application combines at least 2 or 3 models.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: é‰´äºè®¸å¤š SOTA æ¨¡å‹å¾ˆå¤§å¹¶ä¸”éœ€è¦å¼ºå¤§çš„ç¡¬ä»¶å’Œåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå°†æ‰€æœ‰å†…å®¹æ”¾å…¥ä¸€å°æœºå™¨ä¸­å¹¶ä¸æ˜¯ä¸€ä¸ªå®é™…çš„è§£å†³æ–¹æ¡ˆï¼Œå°¤å…¶æ˜¯å½“åº”ç”¨ç¨‹åºç»“åˆäº†è‡³å°‘ 2 æˆ– 3 ä¸ªæ¨¡å‹æ—¶ã€‚
- en: '***â†’ BentoML is a framework that helps solve this problem by letting user write
    simple Python code yet deploy models as distributed microservices.***'
  id: totrans-21
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***â†’ BentoML æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œé€šè¿‡è®©ç”¨æˆ·ç¼–å†™ç®€å•çš„ Python ä»£ç æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒåŒæ—¶å°†æ¨¡å‹éƒ¨ç½²ä¸ºåˆ†å¸ƒå¼å¾®æœåŠ¡ã€‚***'
- en: 'Iâ€™ve been playing and experimenting with BentoML for a while now and itâ€™s definitely
    my go-to solution to deploy machine learning models and services. With its own
    distribution format known as a *bento,* this library makes it easy to package
    everything ML-related into one place: source code and dependencies, API definitions,
    model weights, Docker image, etc.'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å·²ç»ç©å¼„å’Œå®éªŒäº† BentoML ä¸€æ®µæ—¶é—´ï¼Œå®ƒç»å¯¹æ˜¯æˆ‘éƒ¨ç½²æœºå™¨å­¦ä¹ æ¨¡å‹å’ŒæœåŠ¡çš„é¦–é€‰è§£å†³æ–¹æ¡ˆã€‚å‡­å€Ÿå…¶è‡ªå·±çš„åˆ†å‘æ ¼å¼ *bento*ï¼Œè¿™ä¸ªåº“ä½¿å¾—å°†æ‰€æœ‰ä¸
    ML ç›¸å…³çš„å†…å®¹æ‰“åŒ…åˆ°ä¸€ä¸ªåœ°æ–¹å˜å¾—éå¸¸ç®€å•ï¼šæºä»£ç å’Œä¾èµ–é¡¹ã€API å®šä¹‰ã€æ¨¡å‹æƒé‡ã€Docker é•œåƒç­‰ã€‚
- en: Deploying is even easier since it relies on pushing that said bento to the cloud.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: éƒ¨ç½²å˜å¾—æ›´åŠ å®¹æ˜“ï¼Œå› ä¸ºå®ƒä¾èµ–äºå°†ä¸Šè¿° bento æ¨é€åˆ°äº‘ç«¯ã€‚
- en: In this tutorial, weâ€™ll first prototype the app, build the bento locally and
    push it to BentoCloud for deployment.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†é¦–å…ˆåŸå‹åŒ–åº”ç”¨ç¨‹åºï¼Œæ„å»ºæœ¬åœ°çš„ bentoï¼Œå¹¶å°†å…¶æ¨é€åˆ° BentoCloud è¿›è¡Œéƒ¨ç½²ã€‚
- en: You can perform this last step on your own by self-managing a deployment platform
    (check the [Yatai](https://github.com/bentoml/Yatai) project for more details)
    or using a deployment utility called [bentoctl](https://github.com/bentoml/bentoctl)
    that deploys your bento to a variety of cloud services.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥é€šè¿‡è‡ªæˆ‘ç®¡ç†ä¸€ä¸ªéƒ¨ç½²å¹³å°ï¼ˆæŸ¥çœ‹ [Yatai](https://github.com/bentoml/Yatai) é¡¹ç›®äº†è§£æ›´å¤šç»†èŠ‚ï¼‰æˆ–ä½¿ç”¨åä¸º
    [bentoctl](https://github.com/bentoml/bentoctl) çš„éƒ¨ç½²å·¥å…·ï¼Œå°†ä½ çš„ bento éƒ¨ç½²åˆ°å„ç§äº‘æœåŠ¡ä¸­ã€‚
- en: If you want to learn more about BentoML and the different deployment strategies,
    you can have a look at my previous posts *â¬*
  id: totrans-26
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº BentoML å’Œä¸åŒéƒ¨ç½²ç­–ç•¥çš„ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„å¸–å­ *â¬*
- en: '[](/10-ways-bentoml-can-help-you-serve-and-scale-machine-learning-models-4060f1e59d0d?source=post_page-----7f25af3e45df--------------------------------)
    [## 10 Ways BentoML Can Help You Serve and Scale Machine Learning Models'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '[## BentoML å¦‚ä½•å¸®åŠ©ä½ æœåŠ¡å’Œæ‰©å±•æœºå™¨å­¦ä¹ æ¨¡å‹çš„ 10 ç§æ–¹å¼](https://towardsdatascience.com/10-ways-bentoml-can-help-you-serve-and-scale-machine-learning-models-4060f1e59d0d?source=post_page-----7f25af3e45df--------------------------------)'
- en: Moving from Jupyter notebooks to production is not that difficult after all
  id: totrans-28
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä» Jupyter ç¬”è®°æœ¬è¿ç§»åˆ°ç”Ÿäº§å…¶å®å¹¶ä¸æ˜¯é‚£ä¹ˆå›°éš¾
- en: towardsdatascience.com](/10-ways-bentoml-can-help-you-serve-and-scale-machine-learning-models-4060f1e59d0d?source=post_page-----7f25af3e45df--------------------------------)
    [](https://levelup.gitconnected.com/quickly-deploy-a-machine-learning-api-on-aws-ec2-using-bentoml-dbb13bc09d51?source=post_page-----7f25af3e45df--------------------------------)
    [## Quickly Deploy A Machine Learning API On AWS EC2 Using BentoML
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '[## å¿«é€Ÿåœ¨ AWS EC2 ä¸Šä½¿ç”¨ BentoML éƒ¨ç½²æœºå™¨å­¦ä¹  API](https://levelup.gitconnected.com/quickly-deploy-a-machine-learning-api-on-aws-ec2-using-bentoml-dbb13bc09d51?source=post_page-----7f25af3e45df--------------------------------)'
- en: 'Use case: an end-to-end service to summarize Youtube videos ğŸ¥'
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ç”¨ä¾‹ï¼šä¸€ä¸ªç«¯åˆ°ç«¯çš„æœåŠ¡æ¥æ€»ç»“ YouTube è§†é¢‘ ğŸ¥
- en: levelup.gitconnected.com](https://levelup.gitconnected.com/quickly-deploy-a-machine-learning-api-on-aws-ec2-using-bentoml-dbb13bc09d51?source=post_page-----7f25af3e45df--------------------------------)
    [](/how-to-deploy-pytorch-models-as-production-ready-apis-f61136fd0244?source=post_page-----7f25af3e45df--------------------------------)
    [## How To Deploy PyTorch Models as Production-Ready APIs?
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '[## å¦‚ä½•å°† PyTorch æ¨¡å‹éƒ¨ç½²ä¸ºç”Ÿäº§å°±ç»ªçš„ APIï¼Ÿ](https://levelup.gitconnected.com/how-to-deploy-pytorch-models-as-production-ready-apis-f61136fd0244?source=post_page-----7f25af3e45df--------------------------------)'
- en: An end-to-end use-case combining PyTorch Lightning and BentoML ğŸš€
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä¸€ä¸ªç»“åˆäº† PyTorch Lightning å’Œ BentoML çš„ç«¯åˆ°ç«¯ç”¨ä¾‹ ğŸš€
- en: towardsdatascience.com](/how-to-deploy-pytorch-models-as-production-ready-apis-f61136fd0244?source=post_page-----7f25af3e45df--------------------------------)
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '[## å¦‚ä½•å°† PyTorch æ¨¡å‹éƒ¨ç½²ä¸ºç”Ÿäº§å°±ç»ªçš„ APIï¼Ÿ](https://towardsdatascience.com/how-to-deploy-pytorch-models-as-production-ready-apis-f61136fd0244?source=post_page-----7f25af3e45df--------------------------------)'
- en: Code ğŸ’»
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä»£ç  ğŸ’»
- en: The code of this project is available on [Github](https://github.com/ahmedbesbes/BentoChain).
    You can clone it and run the app locally or build a self-contained bento for later
    deployment.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬é¡¹ç›®çš„ä»£ç å¯ä»¥åœ¨ [Github](https://github.com/ahmedbesbes/BentoChain) ä¸Šæ‰¾åˆ°ã€‚ä½ å¯ä»¥å…‹éš†å®ƒå¹¶åœ¨æœ¬åœ°è¿è¡Œåº”ç”¨ç¨‹åºï¼Œæˆ–æ„å»ºä¸€ä¸ªè‡ªåŒ…å«çš„
    bento ä»¥ä¾¿åç»­éƒ¨ç½²ã€‚
- en: Dependencies
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä¾èµ–é¡¹
- en: Weâ€™ll use [transformers](https://github.com/huggingface/transformers) with a
    couple of other libraries that process audio data and the popular [LangChain](https://langchain.readthedocs.io/)
    package to easily integrate with Large Language Models (LLMs).
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†ä½¿ç”¨ [transformers](https://github.com/huggingface/transformers) å’Œå…¶ä»–å‡ ä¸ªå¤„ç†éŸ³é¢‘æ•°æ®çš„åº“ï¼Œä»¥åŠæµè¡Œçš„
    [LangChain](https://langchain.readthedocs.io/) åŒ…æ¥è½»æ¾é›†æˆå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰ã€‚
- en: Weâ€™ll use [poetry](https://python-poetry.org/) to manage the projectâ€™s dependencies.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†ä½¿ç”¨ [poetry](https://python-poetry.org/) æ¥ç®¡ç†é¡¹ç›®çš„ä¾èµ–ã€‚
- en: '[PRE0]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: After installing the packages, youâ€™ll need to generate an SSL key and certificate.
    This will establish an HTTPS connexion that will be needed on modern browsers
    to allow the use of the microphone.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: å®‰è£…åŒ…åï¼Œä½ éœ€è¦ç”ŸæˆSSLå¯†é’¥å’Œè¯ä¹¦ã€‚è¿™å°†å»ºç«‹ä¸€ä¸ªHTTPSè¿æ¥ï¼Œç°ä»£æµè§ˆå™¨éœ€è¦æ­¤è¿æ¥ä»¥å…è®¸ä½¿ç”¨éº¦å…‹é£ã€‚
- en: '[PRE1]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Download the models and save them
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä¸‹è½½æ¨¡å‹å¹¶ä¿å­˜
- en: This project assumes no training. We will simply download the modelsâ€™ weights
    from HuggingFaceâ€™s hub and save them as BentoML Models.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: è¯¥é¡¹ç›®å‡è®¾æ²¡æœ‰è®­ç»ƒã€‚æˆ‘ä»¬å°†ä»HuggingFaceçš„hubä¸‹è½½æ¨¡å‹æƒé‡ï¼Œå¹¶å°†å…¶ä¿å­˜ä¸ºBentoMLæ¨¡å‹ã€‚
- en: Saving the models as BentoML artifacts helps incorporate them in the bento archive
    so that they donâ€™t constitute an external dependency.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: å°†æ¨¡å‹ä¿å­˜ä¸ºBentoMLå·¥ä»¶æœ‰åŠ©äºå°†å®ƒä»¬çº³å…¥bentoå½’æ¡£ä¸­ï¼Œä»¥ä¾¿å®ƒä»¬ä¸ä¼šæ„æˆå¤–éƒ¨ä¾èµ–ã€‚
- en: After figuring out what models are needed precisely, you can first download
    them locally by simply initializing them.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ç²¾ç¡®ç¡®å®šæ‰€éœ€æ¨¡å‹åï¼Œä½ å¯ä»¥é€šè¿‡åˆå§‹åŒ–æ¨¡å‹å…ˆå°†å…¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚
- en: '[PRE2]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Then, you can save them as BentoML models by calling the `bentoml.transformers.save_model`
    function:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨`bentoml.transformers.save_model`å‡½æ•°å°†å…¶ä¿å­˜ä¸ºBentoMLæ¨¡å‹ï¼š
- en: '[PRE3]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The full code is available in the`train.py` script and should be run once:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: å®Œæ•´ä»£ç åœ¨`train.py`è„šæœ¬ä¸­ï¼Œå¹¶åº”è¿è¡Œä¸€æ¬¡ï¼š
- en: '[PRE4]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](../Images/4eeac49acaaf50c39b99fa9fbba8bb55.png)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/4eeac49acaaf50c39b99fa9fbba8bb55.png)'
- en: Saving models âœ… â€” Screenshot by the author
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ä¿å­˜æ¨¡å‹ âœ… â€” ä½œè€…æˆªå›¾
- en: Overview of the appâ€™s architecture
  id: totrans-53
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åº”ç”¨æ¶æ„æ¦‚è¿°
- en: 'Before going into more detail, letâ€™s first clarify the data workflow to understand
    how the app works:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¯¦ç»†è¯´æ˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆæ¾„æ¸…æ•°æ®å·¥ä½œæµç¨‹ï¼Œä»¥äº†è§£åº”ç”¨çš„å·¥ä½œæ–¹å¼ï¼š
- en: The user sends an audio message to the API server over an HTTP POST request
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç”¨æˆ·é€šè¿‡HTTP POSTè¯·æ±‚å‘APIæœåŠ¡å™¨å‘é€éŸ³é¢‘æ¶ˆæ¯
- en: The API server redirects the audio message to the speech2text runner that transcribes
    it into text and sends it back
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: APIæœåŠ¡å™¨å°†éŸ³é¢‘æ¶ˆæ¯é‡å®šå‘åˆ°speech2textè¿è¡Œå™¨ï¼Œè¯¥è¿è¡Œå™¨å°†å…¶è½¬å½•ä¸ºæ–‡æœ¬å¹¶å°†å…¶è¿”å›
- en: The API server takes the transcribed text message as input, passes it through
    a LangChain agent, generates a response, and sends it to the text2speech runner
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: APIæœåŠ¡å™¨å°†è½¬å½•çš„æ–‡æœ¬æ¶ˆæ¯ä½œä¸ºè¾“å…¥ï¼Œé€šè¿‡LangChainä»£ç†ä¼ é€’ï¼Œç”Ÿæˆå“åº”ï¼Œç„¶åå°†å…¶å‘é€åˆ°text2speechè¿è¡Œå™¨
- en: The text2speech runner generates an audio clip from the input text and returns
    it to the API server which in turn sends it back to the user
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: text2speechè¿è¡Œå™¨ä»è¾“å…¥æ–‡æœ¬ç”ŸæˆéŸ³é¢‘ç‰‡æ®µï¼Œå¹¶å°†å…¶è¿”å›ç»™APIæœåŠ¡å™¨ï¼Œåè€…å†å°†å…¶å‘é€å›ç”¨æˆ·
- en: The following diagram summarizes these steps.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹å›¾è¡¨æ€»ç»“äº†è¿™äº›æ­¥éª¤ã€‚
- en: '![](../Images/7ad715efc3619895dadcb6660ec5dd9e.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7ad715efc3619895dadcb6660ec5dd9e.png)'
- en: The architecture of the app âœ… â€” Image by the author
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: åº”ç”¨æ¶æ„ âœ… â€” ä½œè€…å›¾ç‰‡
- en: Why are we using 2 runners?
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªè¿è¡Œå™¨ï¼Ÿ
- en: Whatâ€™s interesting about BentoML is that when deploying to the BentoCloud (or
    to any self-managed platform) the runners and the API server can be deployed separately
    on three different Kubernetes pods.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: BentoMLçš„æœ‰è¶£ä¹‹å¤„åœ¨äºï¼Œå½“éƒ¨ç½²åˆ°BentoCloudï¼ˆæˆ–ä»»ä½•è‡ªæˆ‘ç®¡ç†çš„å¹³å°ï¼‰æ—¶ï¼Œè¿è¡Œå™¨å’ŒAPIæœåŠ¡å™¨å¯ä»¥åœ¨ä¸‰ä¸ªä¸åŒçš„Kubernetes podä¸Šåˆ†åˆ«éƒ¨ç½²ã€‚
- en: 'This provides 3 main benefits:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æä¾›äº†3ä¸ªä¸»è¦å¥½å¤„ï¼š
- en: '**Separation of concerns**: runners are focused on the compute and are decoupled
    from web serving'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**å…³æ³¨åˆ†ç¦»**ï¼šè¿è¡Œå™¨ä¸“æ³¨äºè®¡ç®—ï¼Œå¹¶ä¸ç½‘é¡µæœåŠ¡è§£è€¦'
- en: '**Customization**: Each runner can have a specific hardware configuration depending
    on the task itâ€™s performing: for example, the text2speech runnerâ€™s config will
    have a GPU while the speech2text runner wonâ€™t require one'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**å®šåˆ¶åŒ–**ï¼šæ¯ä¸ªè¿è¡Œå™¨å¯ä»¥æ ¹æ®å…¶æ‰§è¡Œçš„ä»»åŠ¡å…·æœ‰ç‰¹å®šçš„ç¡¬ä»¶é…ç½®ï¼šä¾‹å¦‚ï¼Œtext2speechè¿è¡Œå™¨çš„é…ç½®å°†åŒ…æ‹¬GPUï¼Œè€Œspeech2textè¿è¡Œå™¨åˆ™ä¸éœ€è¦'
- en: '**Auto-scale**: Runners will also auto-scale independently based on resource
    usage'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**è‡ªåŠ¨æ‰©å±•**ï¼šè¿è¡Œå™¨è¿˜ä¼šæ ¹æ®èµ„æºä½¿ç”¨æƒ…å†µç‹¬ç«‹è‡ªåŠ¨æ‰©å±•'
- en: '*To learn more about BentoML runners, have a look at this* [*page*](https://docs.bentoml.org/en/latest/concepts/runner.html)*.*'
  id: totrans-68
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*æƒ³äº†è§£æ›´å¤šå…³äºBentoMLè¿è¡Œå™¨çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹è¿™ä¸ª* [*é¡µé¢*](https://docs.bentoml.org/en/latest/concepts/runner.html)*ã€‚*'
- en: 'Now that we have a global picture of the app, letâ€™s focus on each runner:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å¯¹åº”ç”¨æœ‰äº†æ•´ä½“äº†è§£ï¼Œè®©æˆ‘ä»¬å…³æ³¨æ¯ä¸ªè¿è¡Œå™¨ï¼š
- en: A Speech-to-text runner ğŸ¤ â†’ ğŸ“
  id: totrans-70
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è¯­éŸ³è½¬æ–‡æœ¬è¿è¡Œå™¨ ğŸ¤ â†’ ğŸ“
- en: This runner will rely on OpenAIâ€™s Whisper model to transcribe audio to text.
    Specifically, itâ€™ll use the **tiny** [model](https://huggingface.co/openai/whisper-tiny).
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªè¿è¡Œå™¨å°†ä¾èµ– OpenAI çš„ Whisper æ¨¡å‹å°†éŸ³é¢‘è½¬å½•ä¸ºæ–‡æœ¬ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå°†ä½¿ç”¨ **tiny** [æ¨¡å‹](https://huggingface.co/openai/whisper-tiny)ã€‚
- en: This model will receive a tensor of input features and will generate a transcription.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªæ¨¡å‹å°†æ¥æ”¶ä¸€ä¸ªè¾“å…¥ç‰¹å¾çš„å¼ é‡ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªè½¬å½•ç»“æœã€‚
- en: 'The code is pretty straightforward: it just defines a `**SpeechToTextRunnable**`
    class that inherits from `**bentoml.Runnable**`, instantiates the model and the
    processor, and defines the inference method.'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: ä»£ç éå¸¸ç›´æ¥ï¼šå®ƒåªå®šä¹‰äº†ä¸€ä¸ª`**SpeechToTextRunnable**`ç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ª`**bentoml.Runnable**`ï¼Œå®ä¾‹åŒ–äº†æ¨¡å‹å’Œå¤„ç†å™¨ï¼Œå¹¶å®šä¹‰äº†æ¨ç†æ–¹æ³•ã€‚
- en: '[PRE5]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: A Text-to-speech runner ğŸ“ â†’ ğŸ¤
  id: totrans-75
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä¸€ä¸ªæ–‡æœ¬åˆ°è¯­éŸ³çš„è¿è¡Œå™¨ ğŸ“ â†’ ğŸ¤
- en: 'This runner performs the exact opposite task: it takes a text as input and
    generates a speech that will be represented by a NumPy array.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªè¿è¡Œå™¨æ‰§è¡Œå®Œå…¨ç›¸åçš„ä»»åŠ¡ï¼šå®ƒæ¥å—æ–‡æœ¬ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªç”± NumPy æ•°ç»„è¡¨ç¤ºçš„è¯­éŸ³ã€‚
- en: Note that a device must be declared as an attribute of the `**Text2SpeechRunnable**`
    class to support the GPU acceleration when itâ€™s available.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œå½“è®¾å¤‡å¯ç”¨æ—¶ï¼Œå¿…é¡»å°†å…¶å£°æ˜ä¸º `**Text2SpeechRunnable**` ç±»çš„å±æ€§ï¼Œä»¥æ”¯æŒ GPU åŠ é€Ÿã€‚
- en: '[PRE6]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: A BentoML service
  id: totrans-79
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä¸€ä¸ª BentoML æœåŠ¡
- en: In this section, we will create a service that defines the API routes that can
    be accessed when the bento is deployed.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæœåŠ¡ï¼Œå®šä¹‰åœ¨ bento éƒ¨ç½²æ—¶å¯ä»¥è®¿é—®çš„ API è·¯ç”±ã€‚
- en: 'We first start by initializing the two previous runners we defined:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬é¦–å…ˆå¼€å§‹åˆå§‹åŒ–æˆ‘ä»¬å®šä¹‰çš„ä¸¤ä¸ªå‰ä¸€ä¸ªè¿è¡Œå™¨ï¼š
- en: '[PRE7]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Then, we create a Service object that depends on them:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¾èµ–äºè¿™äº›è·¯ç”±çš„ Service å¯¹è±¡ï¼š
- en: '[PRE8]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Once the service is created, we will define two API routes:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æœåŠ¡åˆ›å»ºå®Œæˆï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸¤ä¸ª API è·¯ç”±ï¼š
- en: '**generate_text:** this route will take an array as input and generate a text
    by calling the speech2text_runner'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**generate_text:** è¿™ä¸ªè·¯ç”±å°†æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºè¾“å…¥ï¼Œå¹¶é€šè¿‡è°ƒç”¨ speech2text_runner ç”Ÿæˆæ–‡æœ¬'
- en: '[PRE9]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '**generate_speech:** this route will take a text as input and generate an array
    as output by calling the text2speech_runner'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**generate_speech:** è¿™ä¸ªè·¯ç”±å°†æ¥å—ä¸€ä¸ªæ–‡æœ¬ä½œä¸ºè¾“å…¥ï¼Œå¹¶é€šè¿‡è°ƒç”¨ text2speech_runner ç”Ÿæˆä¸€ä¸ªæ•°ç»„ä½œä¸ºè¾“å‡º'
- en: '[PRE10]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The ChatWrapper utility class
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ChatWrapper å®ç”¨ç¨‹åºç±»
- en: We are not done yet with the service source code.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è¿˜æ²¡æœ‰å®ŒæˆæœåŠ¡æºä»£ç ã€‚
- en: In this section, we will mount a FastAPI app as an HTTP endpoint on the â€œ/chatbotâ€
    path.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠ FastAPI åº”ç”¨æŒ‚è½½ä¸ºâ€œ/chatbotâ€è·¯å¾„ä¸Šçš„ HTTP ç«¯ç‚¹ã€‚
- en: 'This app will serve a Gradio chatbot interface that will interact with the
    two previously defined API routes: `**generate_text**` and `**generate_speech**`
    .'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªåº”ç”¨å°†æä¾›ä¸€ä¸ª Gradio èŠå¤©æœºå™¨äººç•Œé¢ï¼Œè¯¥ç•Œé¢å°†ä¸ä¹‹å‰å®šä¹‰çš„ä¸¤ä¸ª API è·¯ç”±è¿›è¡Œäº¤äº’ï¼š`**generate_text**` å’Œ `**generate_speech**`ã€‚
- en: '[PRE11]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The â€œchatâ€ variable is an object that gets the user's audio input, transcribes
    it into text, passes it to LangChain, extracts the response, and returns a bunch
    of data that update the appâ€™s interface and state.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: â€œchatâ€å˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒè·å–ç”¨æˆ·çš„éŸ³é¢‘è¾“å…¥ï¼Œå°†å…¶è½¬å½•ä¸ºæ–‡æœ¬ï¼Œä¼ é€’ç»™ LangChainï¼Œæå–å“åº”ï¼Œå¹¶è¿”å›ä¸€å †æ›´æ–°åº”ç”¨ç•Œé¢å’ŒçŠ¶æ€çš„æ•°æ®ã€‚
- en: 'The chat object is a callable that expects the following parameters:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: chat å¯¹è±¡æ˜¯ä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡ï¼Œå®ƒæœŸæœ›ä»¥ä¸‹å‚æ•°ï¼š
- en: '**api_key**: OpenAI API key'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**api_key**: OpenAI API å¯†é’¥'
- en: '**audio_path**: temporary file location when an audio file is recorded with
    the microphone'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**audio_path**: å½“ä½¿ç”¨éº¦å…‹é£å½•åˆ¶éŸ³é¢‘æ–‡ä»¶æ—¶çš„ä¸´æ—¶æ–‡ä»¶ä½ç½®'
- en: '**text_message**: a text message sent instead of an audio file'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**text_message**: ä»£æ›¿éŸ³é¢‘æ–‡ä»¶å‘é€çš„æ–‡æœ¬æ¶ˆæ¯'
- en: '**history**: a tuple of questions and the corresponding responses ((â€œHelloâ€,
    â€œhiâ€), (â€œHow are you?â€, â€œFine, thank you. What about you?â€))'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**history**: ä¸€ä¸ªåŒ…å«é—®é¢˜åŠå…¶å¯¹åº”å“åº”çš„å…ƒç»„ï¼ˆï¼ˆâ€œHelloâ€, â€œhiâ€ï¼‰ï¼Œï¼ˆâ€œHow are you?â€, â€œFine, thank
    you. What about you?â€ï¼‰ï¼‰'
- en: '**chain**: a ConversationChain object from LangChain'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**chain**: ä¸€ä¸ªæ¥è‡ª LangChain çš„ ConversationChain å¯¹è±¡'
- en: In the following code snippet, the ChatWrapper __call__â€™s method first checks
    the input data. If itâ€™s in audio format, it transcribes it using the generate_text
    method, otherwise, it keeps it as is.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä»¥ä¸‹ä»£ç ç‰‡æ®µä¸­ï¼ŒChatWrapper __call__ æ–¹æ³•é¦–å…ˆæ£€æŸ¥è¾“å…¥æ•°æ®ã€‚å¦‚æœæ˜¯éŸ³é¢‘æ ¼å¼ï¼Œå®ƒä¼šä½¿ç”¨ generate_text æ–¹æ³•è¿›è¡Œè½¬å½•ï¼Œå¦åˆ™ä¿æŒåŸæ ·ã€‚
- en: Then, it checks whether the OpenAI key is correctly loaded. If itâ€™s not the
    case, it prints out the message â€œPlease paste your Open AI key.â€, along with the
    audio transcription.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œå®ƒä¼šæ£€æŸ¥ OpenAI å¯†é’¥æ˜¯å¦æ­£ç¡®åŠ è½½ã€‚å¦‚æœæ²¡æœ‰ï¼Œå®ƒä¼šæ‰“å°å‡ºâ€œPlease paste your Open AI key.â€çš„æ¶ˆæ¯ï¼Œå¹¶é™„ä¸ŠéŸ³é¢‘è½¬å½•ã€‚
- en: If the key is correctly loaded, the LangChain agent runs and outputs a message
    that is then passed to the generate_speech method to produce the output audio.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœå¯†é’¥æ­£ç¡®åŠ è½½ï¼ŒLangChain ä»£ç†å°†è¿è¡Œï¼Œå¹¶è¾“å‡ºä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™ generate_speech æ–¹æ³•ä»¥ç”Ÿæˆè¾“å‡ºéŸ³é¢‘ã€‚
- en: '[PRE12]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The Gradio UI
  id: totrans-106
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Gradio ç”¨æˆ·ç•Œé¢
- en: Remember the create_block function we saw earlier? This one takes a ChatWrapper
    instance as input and produces the UI.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ create_block å‡½æ•°å—ï¼Ÿè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ª ChatWrapper å®ä¾‹ä½œä¸ºè¾“å…¥å¹¶ç”Ÿæˆç”¨æˆ·ç•Œé¢ã€‚
- en: '[PRE13]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![](../Images/4077681d5e4f02c67fa9bc38c7795045.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/4077681d5e4f02c67fa9bc38c7795045.png)'
- en: The Appâ€™s UI â€” Screenshot by the user
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: åº”ç”¨çš„ UI â€” ç”¨æˆ·æˆªå›¾
- en: Letâ€™s break the UI into pieces to understand how the data flows exactly.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å°† UI æ‹†è§£å¼€æ¥ï¼Œä»¥å‡†ç¡®ç†è§£æ•°æ®çš„æµåŠ¨æ–¹å¼ã€‚
- en: '**openai_api_key_textbox:** This textbox expects you to paste your OpenAI key
    in it.'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '**openai_api_key_textbox:** è¿™ä¸ªæ–‡æœ¬æ¡†æœŸå¾…æ‚¨åœ¨å…¶ä¸­ç²˜è´´æ‚¨çš„ OpenAI å¯†é’¥ã€‚'
- en: '[PRE14]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: When the user pastes its key and submits it, the key is passed to the set_openai_api_key
    function that gets executed. This function then returns the loaded chain that
    is passed into the appâ€™s state. That way, the chain object is not None and can
    be used when passed to the chat object.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç”¨æˆ·ç²˜è´´å…¶å¯†é’¥å¹¶æäº¤æ—¶ï¼Œè¯¥å¯†é’¥ä¼šä¼ é€’ç»™æ‰§è¡Œçš„ set_openai_api_key å‡½æ•°ã€‚ç„¶åï¼Œè¿™ä¸ªå‡½æ•°è¿”å›åŠ è½½çš„é“¾ï¼Œå¹¶å°†å…¶ä¼ é€’åˆ°åº”ç”¨çš„çŠ¶æ€ä¸­ã€‚è¿™æ ·ï¼Œé“¾å¯¹è±¡å°±ä¸ä¸º
    Noneï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¼ é€’ç»™èŠå¤©å¯¹è±¡æ—¶ä½¿ç”¨ã€‚
- en: '[PRE15]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Here are the other UI components:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œæ˜¯å…¶ä»– UI ç»„ä»¶ï¼š
- en: '**chatbot:** It displays a chatbot output showing both user-submitted messages
    and responses.'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**chatbot:** æ˜¾ç¤ºèŠå¤©æœºå™¨äººè¾“å‡ºï¼Œå±•ç¤ºç”¨æˆ·æäº¤çš„æ¶ˆæ¯å’Œå›åº”ã€‚'
- en: '**audio:** A widget thatplays the userâ€™s recorded audio clip'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**audio:** ä¸€ä¸ªæ’­æ”¾ç”¨æˆ·å½•åˆ¶çš„éŸ³é¢‘ç‰‡æ®µçš„å°éƒ¨ä»¶'
- en: '**state**: a global state of the app'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**state**ï¼šåº”ç”¨çš„å…¨å±€çŠ¶æ€'
- en: '**audio_message:** userâ€™s submitted audio'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**audio_message:** ç”¨æˆ·æäº¤çš„éŸ³é¢‘'
- en: '**text_message**: userâ€™s submitted text'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**text_message**ï¼šç”¨æˆ·æäº¤çš„æ–‡æœ¬'
- en: Now, what happens when a user records an audio from the microphone? (same happens
    when he sends a text)
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: é‚£ä¹ˆï¼Œå½“ç”¨æˆ·ä»éº¦å…‹é£å½•åˆ¶éŸ³é¢‘æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿï¼ˆå‘é€æ–‡æœ¬æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰
- en: The chat object gets executed with a list of inputs from the UI [openai_api_key_textbox,
    audio_message, text_message, state, agent_state] and outputs a list of outputs
    that updates the following components [chatbot, state, audio, audio_message, text_message]
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: èŠå¤©å¯¹è±¡ä¼šä½¿ç”¨æ¥è‡ª UI çš„è¾“å…¥åˆ—è¡¨ [openai_api_key_textbox, audio_message, text_message, state,
    agent_state] æ‰§è¡Œï¼Œå¹¶è¾“å‡ºä¸€ä¸ªè¾“å‡ºåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨æ›´æ–°ä»¥ä¸‹ç»„ä»¶ [chatbot, state, audio, audio_message, text_message]
- en: '[PRE16]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: To put it simply, this allows displaying the userâ€™s questions and the botâ€™s
    answers as well as the history of the chat and the audio of the last response.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: ç®€è€Œè¨€ä¹‹ï¼Œè¿™å…è®¸æ˜¾ç¤ºç”¨æˆ·çš„é—®é¢˜å’Œæœºå™¨äººçš„å›ç­”ï¼Œä»¥åŠèŠå¤©è®°å½•å’Œæœ€åå“åº”çš„éŸ³é¢‘ã€‚
- en: '![](../Images/7493404c7f1969da8149143173c515f0.png)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7493404c7f1969da8149143173c515f0.png)'
- en: Screenshot by the author
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æˆªå›¾
- en: Serve the app locally
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åœ¨æœ¬åœ°æä¾›åº”ç”¨
- en: 'To serve the app locally, run the following command:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: è¦åœ¨æœ¬åœ°è¿è¡Œåº”ç”¨ç¨‹åºï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
- en: '[PRE17]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: This starts a SwaggerUI from which you can try the two endpoints.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°†å¯åŠ¨ä¸€ä¸ª SwaggerUIï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å°è¯•ä¸¤ä¸ªç«¯ç‚¹ã€‚
- en: This also serves the Gradio app on the â€œ/chatbotâ€ path.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¹Ÿåœ¨â€œ/chatbotâ€è·¯å¾„ä¸Šæä¾› Gradio åº”ç”¨ã€‚
- en: '![](../Images/c663a378e452b841d8d68e814613df44.png)![](../Images/f4395a4f7ca487b97d66faca46c2a7af.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c663a378e452b841d8d68e814613df44.png)![](../Images/f4395a4f7ca487b97d66faca46c2a7af.png)'
- en: Screenshot by the user
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: ç”¨æˆ·æˆªå›¾
- en: Deploy to BentoCloud
  id: totrans-135
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: éƒ¨ç½²åˆ° BentoCloud
- en: 'Before deploying to BentoCloud, we first need to build the bento:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨éƒ¨ç½²åˆ° BentoCloud ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ„å»º bentoï¼š
- en: '[PRE18]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![](../Images/ae1bb1ac88c9ad0b9e40dcff04f37327.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ae1bb1ac88c9ad0b9e40dcff04f37327.png)'
- en: Screenshot by the author
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æˆªå›¾
- en: Then, we need to push it using the following command.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¨é€å®ƒã€‚
- en: '[PRE19]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: This will upload our **bento** and the underlying **models** simultaneously
    to the cloud.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°†åŒæ—¶å°†æˆ‘ä»¬çš„ **bento** å’Œåº•å±‚çš„ **models** ä¸Šä¼ åˆ°äº‘ç«¯ã€‚
- en: '![](../Images/39ec450b96bb2398140d984d65c0f803.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/39ec450b96bb2398140d984d65c0f803.png)'
- en: Screenshot by the author
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æˆªå›¾
- en: 'Now, the easy part: you log in to BentoCloud, head over to the deployment tab,
    and hit create.'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œç®€å•çš„éƒ¨åˆ†ï¼šç™»å½• BentoCloudï¼Œå‰å¾€éƒ¨ç½²é€‰é¡¹å¡ï¼Œç„¶åç‚¹å‡»åˆ›å»ºã€‚
- en: You pick a deployment name, enable public access and select the appropriate
    bento tag version.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: é€‰æ‹©ä¸€ä¸ªéƒ¨ç½²åç§°ï¼Œå¯ç”¨å…¬å…±è®¿é—®å¹¶é€‰æ‹©åˆé€‚çš„ bento æ ‡ç­¾ç‰ˆæœ¬ã€‚
- en: '![](../Images/b40f1354a8791d04fa0f81883153a831.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b40f1354a8791d04fa0f81883153a831.png)'
- en: 'Now, you define the API server configuration:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œå®šä¹‰ API æœåŠ¡å™¨é…ç½®ï¼š
- en: '![](../Images/588fa38c5b62c70b9858533b17d4d278.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/588fa38c5b62c70b9858533b17d4d278.png)'
- en: API Server configuration â€” Screenshot by the author
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: API æœåŠ¡å™¨é…ç½® â€” ä½œè€…æˆªå›¾
- en: And you set a configuration for each runner.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¶ä¸ºæ¯ä¸ªè¿è¡Œå™¨è®¾ç½®é…ç½®ã€‚
- en: '![](../Images/2fdb1f88115a47e5a03e52774fd4ccf4.png)![](../Images/be11f4ea4b6b1dc8fbe9e876b1b4a58f.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2fdb1f88115a47e5a03e52774fd4ccf4.png)![](../Images/be11f4ea4b6b1dc8fbe9e876b1b4a58f.png)'
- en: Runners configuration â€” Screenshots by the author
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: Runners é…ç½® â€” ä½œè€…æˆªå›¾
- en: When everything is set, hit the submit button and wait for deployment.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ä¸€åˆ‡å‡†å¤‡å°±ç»ªæ—¶ï¼Œç‚¹å‡»æäº¤æŒ‰é’®å¹¶ç­‰å¾…éƒ¨ç½²ã€‚
- en: When the bento is marked as running, youâ€™ll see a public URL that serves the
    chatbot (donâ€™t forget to add the HTTPS)
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ bento è¢«æ ‡è®°ä¸ºæ­£åœ¨è¿è¡Œæ—¶ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªå…¬å…± URLï¼Œç”¨äºæä¾›èŠå¤©æœºå™¨äººæœåŠ¡ï¼ˆä¸è¦å¿˜è®°æ·»åŠ  HTTPSï¼‰
- en: Conclusion
  id: totrans-156
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: This project was an opportunity to take part in the ongoing hype around LLMs
    and build an app from scratch that not only calls LangChain but combines it with
    other models as well.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªæœºä¼šï¼Œå‚ä¸åˆ°å›´ç»• LLM çš„æŒç»­çƒ­æ½®ä¸­ï¼Œå¹¶ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªä¸ä»…è°ƒç”¨ LangChainï¼Œè¿˜ç»“åˆå…¶ä»–æ¨¡å‹çš„åº”ç”¨ã€‚
- en: 'Thereâ€™s of course room for improvement in the different steps of the workflow
    Iâ€™ve shown: I just hope this post was a good starter for you to start building
    more advanced bots.'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œæˆ‘å±•ç¤ºçš„å·¥ä½œæµç¨‹ä¸­ä¸åŒæ­¥éª¤è¿˜æœ‰æ”¹è¿›çš„ç©ºé—´ï¼šæˆ‘åªæ˜¯å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½ä¸ºä½ å¼€å§‹æ„å»ºæ›´é«˜çº§çš„æœºå™¨äººæä¾›ä¸€ä¸ªè‰¯å¥½çš„å¼€ç«¯ã€‚
- en: New to Medium? You can subscribe for $5 per month and unlock unlimited articles
    on various topics (tech, design, entrepreneurshipâ€¦) You can support me by clicking
    on my referral [link](https://ahmedbesbes.medium.com/membership)
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ–°åŠ å…¥ Mediumï¼Ÿä½ å¯ä»¥ä»¥æ¯æœˆ $5 è®¢é˜…ï¼Œè§£é”å„ç§ä¸»é¢˜ï¼ˆæŠ€æœ¯ã€è®¾è®¡ã€åˆ›ä¸šâ€¦â€¦ï¼‰çš„æ— é™æ–‡ç« ã€‚ä½ å¯ä»¥é€šè¿‡ç‚¹å‡»æˆ‘çš„æ¨è[é“¾æ¥](https://ahmedbesbes.medium.com/membership)æ¥æ”¯æŒæˆ‘ã€‚
- en: '[](https://ahmedbesbes.medium.com/membership?source=post_page-----7f25af3e45df--------------------------------)
    [## Join Medium with my referral link - Ahmed Besbes'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://ahmedbesbes.medium.com/membership?source=post_page-----7f25af3e45df--------------------------------)
    [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Medium - Ahmed Besbes'
- en: Read every story from Ahmed Besbes (and thousands of other writers on Medium).
    Your membership fee directly supportsâ€¦
  id: totrans-161
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: é˜…è¯» Ahmed Besbes çš„æ¯ä¸ªæ•…äº‹ï¼ˆä»¥åŠ Medium ä¸Šå…¶ä»–æ•°åƒä½ä½œè€…çš„æ–‡ç« ï¼‰ã€‚ä½ çš„ä¼šå‘˜è´¹ç›´æ¥æ”¯æŒâ€¦â€¦
- en: ahmedbesbes.medium.com](https://ahmedbesbes.medium.com/membership?source=post_page-----7f25af3e45df--------------------------------)
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: ahmedbesbes.medium.com](https://ahmedbesbes.medium.com/membership?source=post_page-----7f25af3e45df--------------------------------)
