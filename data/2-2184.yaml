- en: Understanding Group Sequential Testing
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解群体顺序测试
- en: 原文：[https://towardsdatascience.com/understanding-group-sequential-testing-befb35cec07a](https://towardsdatascience.com/understanding-group-sequential-testing-befb35cec07a)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/understanding-group-sequential-testing-befb35cec07a](https://towardsdatascience.com/understanding-group-sequential-testing-befb35cec07a)
- en: '[CAUSAL DATA SCIENCE](https://towardsdatascience.com/tagged/causal-data-science)'
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[因果数据科学](https://towardsdatascience.com/tagged/causal-data-science)'
- en: '*How to run valid experiments, with peeking and early stopping.*'
  id: totrans-3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '*如何进行有效的实验，包括窥视和提前停止。*'
- en: '[](https://medium.com/@matteo.courthoud?source=post_page-----befb35cec07a--------------------------------)[![Matteo
    Courthoud](../Images/d873eab35a0cf9fc696658c0bee16b33.png)](https://medium.com/@matteo.courthoud?source=post_page-----befb35cec07a--------------------------------)[](https://towardsdatascience.com/?source=post_page-----befb35cec07a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----befb35cec07a--------------------------------)
    [Matteo Courthoud](https://medium.com/@matteo.courthoud?source=post_page-----befb35cec07a--------------------------------)'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@matteo.courthoud?source=post_page-----befb35cec07a--------------------------------)[![Matteo
    Courthoud](../Images/d873eab35a0cf9fc696658c0bee16b33.png)](https://medium.com/@matteo.courthoud?source=post_page-----befb35cec07a--------------------------------)[](https://towardsdatascience.com/?source=post_page-----befb35cec07a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----befb35cec07a--------------------------------)
    [Matteo Courthoud](https://medium.com/@matteo.courthoud?source=post_page-----befb35cec07a--------------------------------)'
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----befb35cec07a--------------------------------)
    ·15 min read·Dec 26, 2023
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: ·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----befb35cec07a--------------------------------)
    ·15分钟阅读·2023年12月26日
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/36e109332a0572fb79582557617c167a.png)'
  id: totrans-7
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/36e109332a0572fb79582557617c167a.png)'
- en: Cover, image by Author
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 封面，图片由作者提供
- en: A/B tests are the golden standard of causal inference because they allow us
    to make valid causal statements under minimal assumptions, thanks to **randomization**.
    In fact, by randomly assigning a **treatment** (a drug, ad, product, …), we can
    compare the **outcome** of interest (a disease, firm revenue, customer satisfaction,
    …) across **subjects** (patients, users, customers, …) and attribute the average
    difference in outcomes to the causal effect of the treatment.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: A/B测试是因果推断的黄金标准，因为它们允许我们在最小假设下做出有效的因果陈述，这要归功于**随机化**。实际上，通过随机分配**处理**（药物、广告、产品等），我们可以比较**结果**（疾病、公司收入、客户满意度等）在**受试者**（患者、用户、客户等）之间的差异，并将结果的平均差异归因于处理的因果效应。
- en: The implementation of an A/B test is usually not instantaneous, especially in
    online settings. Often users are treated **live** or in **batches**. In these
    settings, one can look at the data before the data collection is completed, one
    or multiple times. This phenomenon is called **peeking**. While looking is not
    problematic in itself, using standard testing procedures when peeking can lead
    to **misleading conclusions**.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 实施A/B测试通常不是瞬间完成的，尤其是在在线环境中。用户通常是**实时**或**分批**处理的。在这些情况下，可以在数据收集完成之前多次查看数据。这种现象被称为**窥视**。虽然窥视本身并不成问题，但在窥视时使用标准测试程序可能会导致**误导性结论**。
- en: The **solution** to peeking is to adjust the testing procedure accordingly.
    The most famous and traditional approach is the so-called **Sequential Probability
    Ratio Test (SPRT)**, which dates back to the Second World War. If you want to
    know more about the test and its fascinating history, I wrote a blog post about
    it.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 解决**窥视**问题的方法是相应地调整测试程序。最著名和传统的方法是所谓的**序列概率比检验 (SPRT)**，该方法可以追溯到第二次世界大战。如果你想了解更多关于这个测试及其迷人的历史，我写了一篇博客文章。
- en: '[](/experiments-peeking-and-optimal-stopping-954506cec665?source=post_page-----befb35cec07a--------------------------------)
    [## Experiments, Peeking, and Optimal Stopping'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '[](/experiments-peeking-and-optimal-stopping-954506cec665?source=post_page-----befb35cec07a--------------------------------)
    [## 实验、窥视与最优停止'
- en: Edit description
  id: totrans-13
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 编辑描述
- en: towardsdatascience.com](/experiments-peeking-and-optimal-stopping-954506cec665?source=post_page-----befb35cec07a--------------------------------)
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: towardsdatascience.com](/experiments-peeking-and-optimal-stopping-954506cec665?source=post_page-----befb35cec07a--------------------------------)
- en: 'The main **advantage** of the Sequential Probability Ratio Test (SPRT) is that
    it guarantees the smallest possible sample size, given a target confidence level
    and power. However, the **main problem** with the SPRT is that it might continue
    indefinitely. This is a non-irrelevant problem in an applied setting with deadlines
    and budget constraints. In this article, we will explore an **alternative method**
    that allows *any* amount of intermediate peeks at the data, at *any* point of
    the data collection: **Group Sequential Testing**.'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 顺序概率比检验（SPRT）的主要**优点**是它在给定目标置信水平和功效的情况下，保证了最小的样本量。然而，SPRT的**主要问题**是它可能会无限期地继续。这在有截止日期和预算限制的应用环境中是一个非无关的问题。在这篇文章中，我们将探索一种**替代方法**，允许在数据收集的*任何*点进行*任何*数量的中间窥探：**分组顺序测试**。
- en: Simulation
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 模拟
- en: Let’s start with some simulated **data**. To keep the code as light as possible,
    I will abstract away from the experimental setting, and directly work with data
    coming out of a **normal distribution**. However, we can think of it as the distribution
    of the average treatment effect in a standard A/B test. The normal distribution
    is an asymptotic approximation based on the [central limit theorem](https://en.wikipedia.org/wiki/Central_limit_theorem).
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从一些模拟的**数据**开始。为了保持代码尽可能简洁，我将抽象化实验设置，直接处理来自**正态分布**的数据。然而，我们可以将其视为标准A/B测试中平均治疗效果的分布。正态分布是基于[中心极限定理](https://en.wikipedia.org/wiki/Central_limit_theorem)的渐近近似。
- en: Before generating the data, I import the relevant libraries and my plotting
    theme from [src.theme](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/theme.py).
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在生成数据之前，我从[src.theme](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/theme.py)导入相关库和我的绘图主题。
- en: '[PRE0]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Let’s assume the true data-generating process is indeed a normal distribution
    with **mean** *μ=1* and **standard deviation** *σ=5.644*. In the context of an
    A/B test, we can think of this as a positive average treatment effect with a standard
    deviation more than 5 times larger than the effect.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 假设真实的数据生成过程确实是一个正态分布，**均值**为*μ=1*，**标准差**为*σ=5.644*。在A/B测试的背景下，我们可以将其视为一个正的平均治疗效果，标准差比效果大5倍以上。
- en: '[PRE1]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: We would like to build a two-sided test with *95%* confidence and *80%* power.
    Therefore our target false positive error rate will be *α=0.05* and our target
    false negative error rate will be *β=0.2*.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 我们希望建立一个双侧检验，具有*95%*的置信度和*80%*的功效。因此，我们的目标假阳性错误率将是*α=0.05*，目标假阴性错误率将是*β=0.2*。
- en: '[PRE2]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: We can now compute the required sample size for the experiment, under the assumption
    of an average treatment effect of *1* and a standard deviation of *5.664*. Since
    we have abstracted from the two-group comparison, the formula for the power calculation
    is
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以计算实验所需的样本量，假设平均治疗效果为*1*，标准差为*5.664*。由于我们已经抽象化了两个组的比较，功效计算的公式是
- en: '![](../Images/9a84ad104e8ee6429d4a21bbef05c74f.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/9a84ad104e8ee6429d4a21bbef05c74f.png)'
- en: Power calculation formula, image by Author
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 功效计算公式，图片来源于作者
- en: where *zs* are the quantiles of a standard normal distribution, evaluated at
    *1-α/2* and *1-β*.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 其中*zs*是标准正态分布的分位数，计算在*1-α/2*和*1-β*处。
- en: '[PRE3]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '[PRE4]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: We need *N=1000* observations to achieve our target confidence level of *95%*
    and power of *80%*.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要*N=1000*个观察值来达到目标置信水平*95%*和功效*80%*。
- en: We can now draw the simulated data. Since we will often compare the results
    across different simulations, we draw *K=10,000* sequences of *N=1,000* data points.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以绘制模拟数据。由于我们将经常比较不同模拟结果，我们绘制*K=10,000*个*N=1,000*数据点的序列。
- en: '[PRE5]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: We are now ready to investigate peeking and group sequential testing.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在准备调查窥探和分组顺序测试。
- en: Peeking
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 窥探
- en: What happens if we **peek** at the data, **before the end** of the experiment?
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们在实验**结束前**对数据进行**窥探**会发生什么？
- en: Let’s suppose for example that we have a look at the data every *50* observations,
    starting at *100*. One reason could be that the data arrives in batches, or that
    we peek every day as soon as we start working.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 假设例如我们每*50*个观察值查看一次数据，从*100*开始。一个原因可能是数据以批次到达，或者我们每天一开始工作时就进行窥探。
- en: '[PRE6]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Looking at the data of course is not a problem *per-se*. However, we might be
    tempted to **draw conclusions**, given what we observe. Suppose that our *naive*
    experimentation platform continuously reports the latest average, standard deviation,
    and confidence interval, where the confidence interval is computed as
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 观察数据本身当然不是问题*per-se*。然而，我们可能会被诱使**得出结论**，基于我们观察到的内容。假设我们的*幼稚*实验平台持续报告最新的平均值、标准差和置信区间，其中置信区间计算方式如下：
- en: '![](../Images/4ecf095cfadb01e71cd486fc17c6546b.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/4ecf095cfadb01e71cd486fc17c6546b.png)'
- en: Confidence intervals without peeking, image by Author
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在不窥视的情况下的置信区间，图片由作者提供
- en: where *n* is the number of samples, *μ̂ₙ* is the estimated sample average after
    *n* samples, *σ̂ₙ* is the estimated standard deviation after *n* samples, *α*
    is the significance level, and *z* is the *1-α/2* quantile of a standard normal
    distribution.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *n* 是样本数量，*μ̂ₙ* 是经过 *n* 个样本后的估计样本均值，*σ̂ₙ* 是经过 *n* 个样本后的估计标准差，*α* 是显著性水平，*z*
    是标准正态分布的 *1-α/2* 分位数。
- en: '[PRE8]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Suppose that we decide to **stop the experiment** as soon as we get one significant
    result.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们决定**在获得一个显著结果后停止实验**。
- en: Let’s compute the confidence intervals that we would observe at each peeking
    point.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们计算在每个窥视点上观察到的置信区间。
- en: '[PRE9]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '[PRE10]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: What do these averages and confidence intervals look like over time? In the
    figure below, I plot the cumulative average over the data collection, together
    with the confidence intervals at each peeking time.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 这些平均值和置信区间随时间的变化是什么样的？在下图中，我绘制了数据收集的累积平均值，以及每次窥视时的置信区间。
- en: '[PRE11]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](../Images/a28e268c352f63b885af3d674c44a5eb.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a28e268c352f63b885af3d674c44a5eb.png)'
- en: Cumulative average effect and peeking confidence intervals, image by Author
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 累积平均效应和窥视置信区间，图片由作者提供
- en: As we can see, the first seven times we look at the data the confidence intervals
    cross the zero line and hence we do not reject the null hypothesis of zero mean.
    I have highlighted these confidence intervals in orange. However, at the eighth
    look at the data, at *450* observations, the confidence interval does not cross
    the zero line and hence we **reject the null hypothesis** of no effect and stop
    the experiment.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，前七次观察数据时，置信区间穿过零线，因此我们未能拒绝零均值的零假设。我用橙色标出了这些置信区间。然而，在第八次观察数据时，即*450*次观察，置信区间没有穿过零线，因此我们**拒绝零假设**，结束实验。
- en: 'The problem of this procedure is very similar to **multiple hypothesis testing**:
    we are building the confidence intervals for a single look at the data and therefore
    a *single* decision, but instead, we are making *multiple* decisions. In fact,
    we have *decided* not to stop the experiment seven times before reaching *450*
    observations and we have stopped it at *450*.'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 这个过程的问题与**多重假设检验**非常相似：我们为单次数据观察构建置信区间，因此做出*单个*决定，但实际上我们做出了*多个*决定。事实上，我们已经*决定*在达到
    *450* 次观察之前七次不停止实验，而在 *450* 次观察时停止了实验。
- en: 'What are the **consequences** of peeking and early stopping? Let’s have a look
    at what would happen if we were to repeat this experiment multiple times. We will
    now plot the confidence intervals for *100* different simulations at three different
    points in time: after *200*, *400,* and *600* observations are collected. Note
    that these correspond to the *3rd*, *7th,* and *11th* peek at the data, respectively.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 窥视和早期停止的**后果**是什么？让我们看看如果我们重复这个实验多次会发生什么。我们现在将绘制*100*个不同模拟在三个不同时间点的置信区间：在*200*、*400*
    和 *600* 次观察后。请注意，这些分别对应于第*3*次、第*7*次和第*11*次数据窥视。
- en: '[PRE12]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The first thing that we are going to inspect is **coverage**: do the confidence
    intervals actually *cover* the true treatment effect, as they are supposed to?
    I highlight the confidence intervals that don’t.'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先要检查的是**覆盖率**：置信区间是否真的*覆盖*了真实的处理效应，正如它们所应该的那样？我标出了那些没有覆盖的置信区间。
- en: '[PRE13]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![](../Images/96e0f2fe7643f67710163ef7b347a4b4.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/96e0f2fe7643f67710163ef7b347a4b4.png)'
- en: Coverage over 100 simulations with naive testing, image by Author
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 使用幼稚测试的100次模拟的覆盖情况，图片由作者提供
- en: It seems that our coverage is fine at each point in time. We have, respectively,
    *2*, *6*, and *2* simulations out of *100* in which the interval does not cover
    the true treatment effect, *μ=1*. This is expected since our confidence level
    is *5%* and therefore we expect *on average* that *5* intervals out of *100* do
    not cover the true treatment effect.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来我们的覆盖率在每个时间点都是正常的。我们分别在*100*次模拟中有*2*、*6*和*2*次不覆盖真实治疗效应（*μ=1*）。这是可以预期的，因为我们的置信水平是*5%*，因此我们期望*100*个区间中*平均*有*5*个不覆盖真实治疗效应。
- en: 'Next, we investigate **power**: the ability of our estimator to detect an effect
    when there is indeed one. Remember that power is always *relative* to the effect
    size. However, we did our power calculations using the true effect so we expect
    the experiment to have the expected power of *80%*.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们研究**功效**：我们估计量在确实存在效应时检测效应的能力。记住，功效总是*相对于*效应大小的。然而，我们在进行功效计算时使用了真实效应，因此我们期望实验达到*80%*的预期功效。
- en: Note that, since we are peeking, we reject the null hypothesis and stop the
    experiment *as soon as* one test is significant. Therefore, in our case, power
    at a specific point in time is the probability of rejecting the null hypothesis
    with that test or *any* of the previous ones.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，由于我们进行观察，我们会在*测试*显著时拒绝原假设并停止实验。因此，在我们案例中，特定时间点的功效是拒绝原假设的概率，无论是该测试还是*任何*之前的测试。
- en: '[PRE14]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![](../Images/3436e43ad2b5d1db8e8e92498f3a112b.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3436e43ad2b5d1db8e8e92498f3a112b.png)'
- en: Power over 100 simulations with naive testing, image by Author
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 使用朴素测试的100次模拟中的功效，图像由作者提供
- en: As we can see, at *200* observations we already reject the null hypothesis of
    no effect (*μ=0*) in *72* simulations out of *100*, close to the target power
    of *80%*. However, at *400* observations we reject the null hypothesis in well
    over *80* simulations over *100*, suggesting that we could have run the experiment
    for a shorter amount of time.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，在*200*次观察时，我们已经在*100*次模拟中的*72*次拒绝了没有效应的原假设（*μ=0*），接近目标功效的*80%*。然而，在*400*次观察时，我们在超过*100*次模拟中的*80*次拒绝了原假设，表明我们可以缩短实验时间。
- en: 'It seems that so far everything is going great: our intervals cover the true
    effect and reject the null hypothesis even faster than expected. Let’s check this
    for all the peeking stages and over *10,000* simulations. Let’s also check a third
    metric: the **false positive** error rate. In order to compute that, we change
    the null hypothesis to *μ=1* and check how often we reject it. Again, since we
    are peeking multiple times, what counts is the rejection rate at a specific peeking
    stage or *any* of the previous ones.'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，一切似乎都很顺利：我们的区间覆盖了真实效应，并且比预期更快地拒绝了原假设。让我们检查所有的观察阶段和*10,000*次模拟。我们还要检查第三个指标：**假阳性**错误率。为了计算这个，我们将原假设更改为*μ=1*并检查我们拒绝它的频率。同样，由于我们进行了多次观察，重要的是特定观察阶段或*任何*之前的阶段的拒绝率。
- en: In the figure below, I plot coverage, power, and false rejection rates over
    *10,000* simulations at each peeking stage.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在下图中，我绘制了每个观察阶段*10,000*次模拟中的覆盖率、功效和错误拒绝率。
- en: '[PRE15]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](../Images/5a3d2ad3f6003a6f7f33751348ab0762.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/5a3d2ad3f6003a6f7f33751348ab0762.png)'
- en: Estimator performance with naive testing over 10,000 simulations, image by Author
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 使用朴素测试的*10,000*次模拟中的估计器性能，图像由作者提供
- en: Coverage seems to be on target. Power is above *80%* starting at around *250*
    observations, confirming our previous insight. However, the false rejection rate
    is way higher than the target of *5%*. This means that when the null hypothesis
    is true, we reject it more often than we should.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 覆盖率似乎符合预期。功效在大约*250*次观察后已达到*80%*以上，确认了我们之前的见解。然而，错误拒绝率远高于目标的*5%*。这意味着当原假设为真时，我们的拒绝频率高于应有的水平。
- en: The last thing we want to check is whether the experiment is indeed shorter
    on average, and by how much. Let’s compute the **average experiment length**,
    in terms of the number of observations.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们最后要检查的是实验是否确实在平均上更短，以及短了多少。让我们计算**平均实验长度**，以观察次数为单位。
- en: '[PRE16]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '[PRE17]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: On average we need just *177* observations to reach a conclusion! However, because
    of the high false rejection rate, these might be the **wrong conclusions**.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 平均而言，我们只需*177*次观察即可得出结论！然而，由于较高的错误拒绝率，这些可能是**错误的结论**。
- en: What can we do to solve this issue? We need to build confidence intervals that
    take into account that we are doing multiple tests in sequence.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以怎么解决这个问题？我们需要构建考虑到我们在顺序中进行多次测试的置信区间。
- en: Alpha Corrections
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Alpha 修正
- en: In this section, we will explore a first set of corrections that modify the
    *α* value used to compute the confidence intervals in order to take into account
    peeking and early stopping.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨第一组校正，这些校正会修改用于计算置信区间的*α*值，以考虑窥视和提前停止。
- en: Bonferroni Correction
  id: totrans-80
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Bonferroni 校正
- en: Since the peeking problem is similar to multiple hypothesis testing, we can
    start by applying the same solution.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 由于窥视问题类似于多重假设测试，我们可以从应用相同的解决方案开始。
- en: 'The simplest way to account for multiple hypothesis testing is the so-called
    [**Bonferroni correction**](https://en.wikipedia.org/wiki/Bonferroni_correction).
    The idea is simple: decrease the significance level *α* proportionally to the
    number of looks. In particular, instead of using the same *α* for each look, we
    use'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 处理多重假设测试的最简单方法是所谓的 [**Bonferroni 校正**](https://en.wikipedia.org/wiki/Bonferroni_correction)。这个想法很简单：根据观察次数按比例减少显著性水平*α*。特别是，我们不再对每次观察使用相同的*α*，而是使用
- en: '![](../Images/c287adce0da3778a73fcef6023831aa4.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c287adce0da3778a73fcef6023831aa4.png)'
- en: Bonferroni’s α correction, image by Author
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: Bonferroni的α校正，作者提供的图像
- en: where *P* is the number of times we plan to peek.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *P* 是我们计划窥视的次数。
- en: '[PRE18]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'How does Bonferroni correction perform in terms of **coverage**? Let’s plot
    the confidence intervals for three peeking stages: after *200*, *400*, and *600*
    observations are collected.'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: Bonferroni 校正在**覆盖率**方面表现如何？让我们绘制三个窥视阶段的置信区间：在收集了*200*、*400* 和 *600* 次观察后。
- en: '[PRE19]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![](../Images/30c8a1a50d6d9dd53a843462b2c0ac5b.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/30c8a1a50d6d9dd53a843462b2c0ac5b.png)'
- en: Coverage over 100 simulations with Bonferroni correction, image by Author
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: Bonferroni 校正下的覆盖率在 100 次模拟中，作者提供的图像
- en: Coverage looks great! Only once at *n=200* one interval did not cover the true
    value *μ=1*.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 覆盖率看起来很棒！只有一次在*n=200*时一个区间没有覆盖真实值*μ=1*。
- en: While this might appear comforting at first, it should actually raise an eyebrow.
    In fact, with a significance level *α=0.05* we expect a coverage of *95%*. A higher
    coverage will most likely come at the expense of **power**. Let’s have a look.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这在一开始可能让人感到安慰，但实际上应该引起警觉。事实上，使用显著性水平*α=0.05*时，我们期望的覆盖率是*95%*。更高的覆盖率很可能会以**功效**为代价。我们来看看。
- en: '[PRE20]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![](../Images/c042febc1465b9db49bb60fe3cdd6dcc.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c042febc1465b9db49bb60fe3cdd6dcc.png)'
- en: Power over 100 simulations with Bonferroni correction, image by Author
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: Bonferroni 校正下的功效在 100 次模拟中，作者提供的图像
- en: The test is underpowered at *200* observations, while it is very close to the
    target power of *80%* at *400* observations. At *600* observations we have almost
    100% power.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在*200*次观察下测试功效不足，而在*400*次观察下功效非常接近目标的*80%*。在*600*次观察时，我们几乎达到了 100% 的功效。
- en: Let’s plot coverage, power, and false positive rate for each peeking stage over
    *K=10,000* simulations.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们绘制每个窥视阶段的覆盖率、功效和假阳性率，基于*K=10,000*次模拟。
- en: '[PRE21]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![](../Images/3a3bd13d292271b633125f5490d495a1.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3a3bd13d292271b633125f5490d495a1.png)'
- en: Estimator performance with Bonferroni correction over 10,000 simulations, image
    by Author
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: Bonferroni 校正在 10,000 次模拟中的估计性能，作者提供的图像
- en: Coverage is great, power is above target starting at around *450* observations,
    and the false rejection rate is always below the target of *5%*. What about the
    average experiment length?
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 覆盖率很好，功效在大约*450*次观察后达到目标，虚假拒绝率始终低于*5%*的目标。那么平均实验长度呢？
- en: '[PRE22]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '[PRE23]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: The average experiment length is *317* observations, higher than the naive testing
    procedure, but still sensibly lower than the *1000* observations required without
    peeking.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 平均实验长度为*317*次观察，高于朴素测试程序，但仍明显低于未经窥视所需的*1000*次观察。
- en: It seems that everything looks good, maybe even **too good**. Indeed, there
    might be room for improvement. Given such high coverage and low false rejection
    rate, the results suggest that we could have shorter confidence intervals and
    hence higher power and lower experiment length, without dropping below *95%* coverage
    or above *5%* false rejection rate. How?
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 一切看起来都不错，甚至可能**过于完美**。确实，可能还有改进的空间。考虑到如此高的覆盖率和低的虚假拒绝率，结果表明我们可以缩短置信区间，从而提高功效和降低实验长度，同时不低于*95%*的覆盖率或超过*5%*的虚假拒绝率。如何？
- en: The Bonferroni correction has **two drawbacks**. First, it was **not designed
    for sequential testing**, but rather for multiple-hypothesis testing. Second,
    even for multiple hypothesis testing, it is known to be very **conservative**.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: Bonferroni 校正有**两个缺点**。首先，它**不是为序列测试设计**的，而是为多重假设测试设计的。其次，即使是多重假设测试，它也被认为是非常**保守**的。
- en: Corrections
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 校正
- en: A first version of **Bonferroni’s correction for sequential testing** was [Pocock
    (1977)](https://www.jstor.org/stable/2335684). The idea was to take into account
    the **sequential** nature of testing which generates a very specific correlation
    structure between the test statistics. Thanks to this insight, Pocock was able
    to use a corrected *α* value that was in between the naive *α* and Bonferroni’s
    *α/P*. A larger *α* than Benferroni implies higher power while keeping high coverage
    and a low false positive rate. The values are found through a numeric algorithm
    that takes as input the significance level *α* and the total number of peeks *P*.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '**Bonferroni的序贯检验校正**的第一个版本是[Pocock (1977)](https://www.jstor.org/stable/2335684)。其思想是考虑检验的**序贯**特性，这会在检验统计量之间生成非常特定的相关结构。由于这一洞察，Pocock能够使用一个校正的*α*值，该值介于天真的*α*和Bonferroni的*α/P*之间。比Bonferroni更大的*α*意味着更高的功效，同时保持高覆盖率和低假阳性率。这些值是通过一个数值算法得出的，该算法以显著性水平*α*和总窥探次数*P*作为输入。'
- en: The problem with Pocock correction was that it did not fully exploit the sequential
    nature of the testing, since the confidence intervals were constant over time.
    [O’Brien, and Fleming (1979)](https://www.jstor.org/stable/2530245) proposed to
    use **time-varying** *α* corrections. Their idea was to adapt the width of the
    confidence interval not only to the significance level *α* and the total number
    of peeks *P*, but also the individual peek *p*.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: Pocock校正的问题在于它未能充分利用检验的序贯特性，因为置信区间随时间保持不变。[O’Brien 和 Fleming (1979)](https://www.jstor.org/stable/2530245)
    提出了使用**时间变化**的*α*校正。他们的想法是使置信区间的宽度不仅适应显著性水平*α*和总窥探次数*P*，还适应每次窥探*p*。
- en: However, the main drawback of all these procedures is that they require to **plan**
    the number of peeks in advance. This is often *not practical*, since peeking is
    an inherently spontaneous process, that comes from either the size of the data
    batch, pressure from management, or simply the experimenter’s curiosity.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这些程序的主要缺点是它们要求**提前规划**窥探次数。这通常是*不切实际的*，因为窥探是一个固有的自发过程，来源于数据批量的大小、管理层的压力或实验者的好奇心。
- en: What can we do when peeking is **not planned** in advance?
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 当窥探**未提前规划**时，我们该怎么办？
- en: Group Sequential Testing
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '**组序贯检验**'
- en: '[Lan, DeMets (1983)](https://www.jstor.org/stable/2336502) noticed that the
    important thing in peeking is not *how much* you peek, but rather *when* you peek.
    The main idea of **Group Sequential Testing (GST)** is to allow for peeking at
    any point in time and correct the significance level for the peeking point in
    time in the data collection process, *t = n/N*.'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '[Lan 和 DeMets (1983)](https://www.jstor.org/stable/2336502)注意到，窥探中重要的不是*你窥探了多少*，而是*你何时窥探*。**组序贯检验（GST）**的主要思想是允许在任何时间点进行窥探，并在数据收集过程中对窥探时间点的显著性水平进行校正，*t
    = n/N*。'
- en: The moving part of group sequential testing is the so-called **alpha spending
    function** that determines how to correct the significance level *α*, given peeking
    time *t*. In the rest of the article, we are going to review two alpha spending
    functions that approximate the corrections of [Pocock (1977)](https://www.jstor.org/stable/2335684)
    and [O’Brien and Fleming (1979)](https://www.jstor.org/stable/2530245), respectively.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 组序贯检验的动态部分是所谓的**α花费函数**，它决定了如何根据窥探时间*t*来校正显著性水平*α*。在本文的其余部分，我们将回顾两个α花费函数，分别近似于[Pocock
    (1977)](https://www.jstor.org/stable/2335684)和[O’Brien 和 Fleming (1979)](https://www.jstor.org/stable/2530245)的校正。
- en: GST Pocock Approximation
  id: totrans-115
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: GST Pocock近似
- en: The first alpha-spending function is an approximation of [Pocock (1977)](https://www.jstor.org/stable/2335684)
    and it is given by
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个α花费函数是[Pocock (1977)](https://www.jstor.org/stable/2335684)的近似，其表达式为
- en: '![](../Images/46ac994f14048165af6ab5bd9c36da45.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/46ac994f14048165af6ab5bd9c36da45.png)'
- en: Pocock’s α spending function for group sequential testing, image by Author
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: Pocock的α花费函数用于组序贯检验，图片来源于作者
- en: Note that as the share of observations *t=n/N* reaches the full sample (*t=1*),
    Pocock’s correction converges to the original significance level *α*.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，当观察比例*t=n/N*达到整个样本(*t=1*)时，Pocock的校正会收敛到原始显著性水平*α*。
- en: '[PRE24]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Let’s see how group sequential testing using Pocock’s alpha spending function
    works.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看使用Pocock的α花费函数的组序贯检验如何工作。
- en: '[PRE25]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '![](../Images/d411728a393bad4f796aa3e21f137177.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d411728a393bad4f796aa3e21f137177.png)'
- en: Estimator performance with Pococks’s GST over 10,000 simulations, image by Author
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Pocock的GST进行10,000次模拟的估计器性能，图片来源于作者
- en: As we noted before, coverage converges to the target coverage and the number
    of observations increases. The experiment seems also to be better powered than
    using Bonferroni’s correction, but the false rejection rate increases above the
    target of *5%* if the experiment runs too long.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前提到的，覆盖率趋向于目标覆盖率，观察次数增加。实验似乎也比使用Bonferroni校正的功效更强，但如果实验运行时间过长，虚假拒绝率会超过*5%*的目标。
- en: What about the average experiment length?
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 平均实验长度怎么样？
- en: '[PRE26]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '[PRE27]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: The average experiment length is indeed lower than Boferroni, with an average
    of *229* observations instead of *317*.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 平均实验长度确实低于Boferroni，平均为*229*次观察，而不是*317*次。
- en: GST O’Brien & Fleming Approximation
  id: totrans-130
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: GST O’Brien & Fleming近似
- en: The second alpha-spending function is an approximation of [O’Brien, Fleming
    (1979)](https://www.jstor.org/stable/2530245) and is given by
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个α支出函数是[O’Brien, Fleming (1979)](https://www.jstor.org/stable/2530245)的近似，其表达式为
- en: '![](../Images/150e368ddfcf6a29dde4676960f56b68.png)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/150e368ddfcf6a29dde4676960f56b68.png)'
- en: O’Brien and Fleming’s α spending function for group sequential testing, image
    by Author
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: O’Brien和Fleming的组序贯测试α支出函数，图像由作者提供
- en: where **Φ** is the cumulative distribution function (CDF) of a standard normal
    distribution, and *ρ* is a free parameter that is usually defaulted to *ρ=1*.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 其中**Φ**是标准正态分布的累积分布函数（CDF），而*ρ*是一个自由参数，通常默认为*ρ=1*。
- en: '[PRE28]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Let’s see how group sequential testing using O’Brien and Fleming approximation
    performs over *K=10,000* simulations.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看使用O’Brien和Fleming近似的组序贯测试在*K=10,000*次模拟中的表现。
- en: '[PRE29]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '![](../Images/ac4f34809cc78583f2b0044b6946f1c0.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ac4f34809cc78583f2b0044b6946f1c0.png)'
- en: Estimator performance with O’Brien and Flaming’s GST over 10,000 simulations,
    image by Author
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 使用O’Brien和Fleming的GST在10,000次模拟中的估计性能，图像由作者提供
- en: It seems that the O’Brien and Fleming approximation is more conservative than
    Pocock’s, with higher coverage and lower power, but keeping the false rejection
    rate closer to the *5%* target.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来O’Brien和Fleming的近似比Pocock的更保守，具有更高的覆盖率和较低的功效，但虚假拒绝率更接近*5%*目标。
- en: '[PRE30]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '[PRE31]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: The average experiment length is actually higher than Boferroni, with an average
    of *414* observations instead of *317*. However, it can be lowered by decreasing
    the parameter *ρ* in the correction formula. Let’s use for example *ρ=0.5* which
    corresponds to [Wang, Tsiatis (1987)](https://www.jstor.org/stable/2531959) correction.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 平均实验长度实际上高于Boferroni，平均为*414*次观察，而不是*317*次。然而，通过在校正公式中降低参数*ρ*，可以减少这一数值。以*ρ=0.5*为例，它对应于[Wang,
    Tsiatis (1987)](https://www.jstor.org/stable/2531959)的校正。
- en: '[PRE32]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '[PRE33]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Indeed, with a lower *ρ,* we have decreased the average experiment length from
    *414* to *303* observations.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 确实，使用较低的*ρ*，我们已将平均实验长度从*414*减少到*303*次观察。
- en: Alpha Spending Trade-off
  id: totrans-147
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: α支出权衡
- en: Before concluding, it is worth having a look at the peeking trade-offs. We have
    introduced a method that allows us to do valid inference while peeking any number
    of times, whenever we feel like. But **should we peek**? And, if so, **how much**?
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在总结之前，值得看看窥视的权衡。我们引入了一种方法，使我们能够在任何时候进行有效推断。然而，**我们应该窥视吗**？如果是的话，**窥视多少次**呢？
- en: In the figure below, I plot the testing performance using group sequential testing
    with Pocock’s approximation, when we **increase the peeking frequency** from *50*
    to *10* observations.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在下图中，我绘制了使用Pocock近似的组序贯测试的测试性能，当我们**增加窥视频率**从*50*次观察到*10*次观察时。
- en: '[PRE34]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '![](../Images/03f9db324688a150d7ff42419f683a56.png)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/03f9db324688a150d7ff42419f683a56.png)'
- en: Estimator performance with GST every 10 observations over 10,000 simulations,
    image by Author
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 每10次观察下的GST估计性能，图像由作者提供
- en: As we can see, coverage is basically unaffected, while power and false rejections
    have increased. The average experiment length has also decreased from *229* to
    *188* observations.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，覆盖率基本不受影响，而功效和虚假拒绝率有所增加。平均实验长度也从*229*减少到*188*次观察。
- en: '[PRE35]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '[PRE36]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: What if instead we **reduced the peeking frequency**? In the figure below, I
    plot the results when peeking every 200 observations.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们**减少窥视频率**会怎样？在下图中，我绘制了每200次观察时的结果。
- en: '[PRE37]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: '![](../Images/7f7d1feeb1007f086e40eeb7e5b658fc.png)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7f7d1feeb1007f086e40eeb7e5b658fc.png)'
- en: Estimator performance with GST every 200 observations over 10,000 simulations,
    image by Author
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 每200次观察下的GST估计性能，图像由作者提供
- en: 'From the figure, we see the opposite result: power and false rejections have
    decreased. On the other hand, we now need on average *311* observations to reach
    a conclusion instead of *229*.'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 从图中我们可以看到相反的结果：功效和虚假拒绝都减少了。另一方面，现在我们平均需要 *311* 次观测才能得出结论，而不是 *229* 次。
- en: '[PRE38]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: '[PRE39]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Conclusion
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结论
- en: In this article, we have explored **group sequential testing**, a procedure
    to do valid inference when peeking during an A/B test, any number of times, and
    at any point during the experiment. We have also seen how peeking does not come
    for free. The main **trade-off** is that the more we peek, the earlier we can
    stop an experiment but also the higher the false rejection rate.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 在本文中，我们探讨了 **组顺序测试**，一种在 A/B 测试中任何次数和任何时刻进行窥探时做出有效推断的程序。我们还看到窥探并不是免费的。主要的 **权衡**
    是，我们窥探的次数越多，实验停止得越早，但虚假拒绝率也越高。
- en: There are at least a couple of topics that I have not mentioned in the article,
    not to make it too long. The first one is **bias**. Sequential tests can easily
    introduce bias since early stopping could be due to either a low variance or a
    large effect. Because of the second, sequential tests can often lead to the *overestimation*
    of treatment effects. This phenomenon is often called the *winner’s curse* and
    typically occurs when the study is underpowered, which is happens at the early
    peeking stages. One solution is to design a **beta spending** function.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 文章中至少还有几个我没有提及的主题，以避免过长。第一个是 **偏倚**。顺序测试容易引入偏倚，因为提前停止可能是由于低方差或大效应。由于后者，顺序测试往往会导致对治疗效果的
    *高估*。这种现象通常称为 *赢家的诅咒*，通常发生在研究的功效不足时，即在早期窥探阶段。一种解决方案是设计一个 **β 花费** 函数。
- en: 'The second topic that I didn’t cover is what is called **stopping for futility**.
    In the examples of this article, we stopped experiments early if we got a statistically
    significant estimate. However, peeking can also inform a different stopping rule:
    stopping because it becomes extremely unlikely that continuing the test can produce
    significant results.'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 我没有涵盖的第二个主题是所谓的 **因无效而停止**。在本文的例子中，如果我们得到统计上显著的估计值，我们就提前停止实验。然而，窥探也可以告知另一种停止规则：因为继续测试变得极不可能产生显著结果而停止。
- en: One last topic I have not covered is how to do **power analysis** with sequential
    testing. In the example above, we ran the power analysis at the very beginning
    assuming no peeking. However, given that we knew we would have peeked, we could
    have anticipated the need for a smaller sample. A closely related topic is **optimal
    peeking**. Once you decide to peek, when should you do it?
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 我没有涵盖的最后一个主题是如何进行 **功效分析**。在上面的例子中，我们在一开始就进行了功效分析，假设没有窥探。然而，鉴于我们知道我们会窥探，我们本可以预期需要一个更小的样本。一个密切相关的主题是
    **最佳窥探**。一旦决定要窥探，应该何时进行？
- en: References
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参考文献
- en: 'Lakens, Pahlke, Wassmer (2021). [Group Sequential Designs: A Tutorial](https://osf.io/preprints/psyarxiv/x4azm)'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Lakens, Pahlke, Wassmer (2021). [组顺序设计：教程](https://osf.io/preprints/psyarxiv/x4azm)
- en: Lan, DeMets (1983). [Discrete Sequential Boundaries for Clinical Trials](https://academic.oup.com/biomet/article-abstract/70/3/659/247777)
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Lan, DeMets (1983). [临床试验的离散顺序边界](https://academic.oup.com/biomet/article-abstract/70/3/659/247777)
- en: Spotify (2023). [Choosing a Sequential Testing Framework](https://engineering.atspotify.com/2023/03/choosing-sequential-testing-framework-comparisons-and-discussions/)
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Spotify (2023). [选择顺序测试框架](https://engineering.atspotify.com/2023/03/choosing-sequential-testing-framework-comparisons-and-discussions/)
- en: Related Articles
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 相关文献
- en: '[Experiments, Peeking, and Optimal Stopping](/954506cec665)'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[实验、窥探和最佳停止](/954506cec665)'
- en: Code
  id: totrans-174
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 代码
- en: 'You can find the original Jupyter Notebook here:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在这里找到原始的 Jupyter Notebook：
- en: '[](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/group_sequential_testing.ipynb?source=post_page-----befb35cec07a--------------------------------)
    [## Blog-Posts/notebooks/group_sequential_testing.ipynb at main · matteocourthoud/Blog-Posts'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/group_sequential_testing.ipynb?source=post_page-----befb35cec07a--------------------------------)
    [## Blog-Posts/notebooks/group_sequential_testing.ipynb at main · matteocourthoud/Blog-Posts'
- en: Code and notebooks for my Medium blog posts. Contribute to matteocourthoud/Blog-Posts
    development by creating an…
  id: totrans-177
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 我的 Medium 博客文章的代码和笔记本。通过创建一个来贡献 matteocourthoud/Blog-Posts 开发…
- en: github.com](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/group_sequential_testing.ipynb?source=post_page-----befb35cec07a--------------------------------)
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: github.com](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/group_sequential_testing.ipynb?source=post_page-----befb35cec07a--------------------------------)
- en: Thank you for reading!
  id: totrans-179
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 感谢你的阅读！
- en: '*I really appreciate it!* 🤗 *If you liked the post and want to see more, consider*
    [***following me***](https://medium.com/@matteo.courthoud)*. I post once a week
    on topics related to causal inference and data analysis. I try to keep my posts
    simple but precise, always providing code, examples, and simulations.*'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '*非常感谢！* 🤗 *如果你喜欢这篇文章并希望看到更多内容，可以考虑* [***关注我***](https://medium.com/@matteo.courthoud)*。我每周发布一次关于因果推断和数据分析的内容。我尽量保持文章简洁但准确，始终提供代码、示例和模拟。*'
- en: '*Also, a small* ***disclaimer****: I write to learn, so mistakes are the norm,
    even though I try my best. Please, when you spot them, let me know. I also appreciate
    suggestions on new topics!*'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '*此外，一个小小的* ***免责声明****：我写作是为了学习，因此错误是常有的事，尽管我尽力做到最好。请在发现错误时告诉我。我也欢迎对新话题的建议！*'
