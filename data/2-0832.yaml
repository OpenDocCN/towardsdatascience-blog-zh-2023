- en: Evaluating Uplift Models
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 评估提升模型
- en: 原文：[https://towardsdatascience.com/evaluating-uplift-models-8a078996a113](https://towardsdatascience.com/evaluating-uplift-models-8a078996a113)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/evaluating-uplift-models-8a078996a113](https://towardsdatascience.com/evaluating-uplift-models-8a078996a113)
- en: '[CAUSAL DATA SCIENCE](https://towardsdatascience.com/tagged/causal-data-science)'
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[因果数据科学](https://towardsdatascience.com/tagged/causal-data-science)'
- en: How to compare and select the best uplift model
  id: totrans-3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何比较和选择最佳提升模型
- en: '[](https://medium.com/@matteo.courthoud?source=post_page-----8a078996a113--------------------------------)[![Matteo
    Courthoud](../Images/d873eab35a0cf9fc696658c0bee16b33.png)](https://medium.com/@matteo.courthoud?source=post_page-----8a078996a113--------------------------------)[](https://towardsdatascience.com/?source=post_page-----8a078996a113--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----8a078996a113--------------------------------)
    [Matteo Courthoud](https://medium.com/@matteo.courthoud?source=post_page-----8a078996a113--------------------------------)'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@matteo.courthoud?source=post_page-----8a078996a113--------------------------------)[![Matteo
    Courthoud](../Images/d873eab35a0cf9fc696658c0bee16b33.png)](https://medium.com/@matteo.courthoud?source=post_page-----8a078996a113--------------------------------)[](https://towardsdatascience.com/?source=post_page-----8a078996a113--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----8a078996a113--------------------------------)
    [Matteo Courthoud](https://medium.com/@matteo.courthoud?source=post_page-----8a078996a113--------------------------------)'
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----8a078996a113--------------------------------)
    ·18 min read·Jul 13, 2023
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: ·发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----8a078996a113--------------------------------)
    ·18分钟阅读·2023年7月13日
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/8182be522fb1050cb15fce92296a5526.png)'
  id: totrans-7
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/8182be522fb1050cb15fce92296a5526.png)'
- en: Cover, image by Author.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 封面，图片由作者提供。
- en: One of the most widespread applications of causal inference in the industry
    is **uplift modeling**, a.k.a. the estimation of Conditional Average Treatment
    Effects.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 因果推断在行业中最广泛的应用之一是**提升建模**，即条件平均处理效应的估计。
- en: When estimating the causal effect of a **treatment** (a drug, ad, product, …)
    on an **outcome** of interest (a disease, firm revenue, customer satisfaction,
    …), we are often not only interested in understanding whether the treatment works
    on average, but we would like to know for which **subjects** (patients, users,
    customers, …) it works better or worse.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在估计**处理**（药物、广告、产品等）对**结果**（疾病、公司收入、客户满意度等）的因果效应时，我们通常不仅仅关心处理是否有效，我们还希望了解对哪些**对象**（患者、用户、客户等）效果更好或更差。
- en: Estimating heterogeneous incremental effects, or uplift, is an essential intermediate
    step to improve the **targeting** of the policy of interest. For example, we might
    want to warn certain people that they are more likely to experience side effects
    from a drug or show an advertisement only to a specific set of customers.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 估计异质性增量效应，或称为提升，是改善**目标**政策的重要中间步骤。例如，我们可能希望警告某些人他们更有可能经历药物的副作用，或仅向特定客户展示广告。
- en: While there exist many methods to model uplift, it is not always clear which
    one to use in a specific application. Crucially, because of the **fundamental
    problem of causal inference**, the objective of interest, the uplift, is never
    observed, and therefore we cannot validate our estimators as we would do with
    a machine learning prediction algorithm. We cannot set aside a validation set
    and pick the best-performing model since we have **no ground truth**, not even
    in the validation set, and not even if we ran a randomized experiment.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然存在许多建模提升的方法，但在具体应用中并不总是清楚使用哪一种。关键在于，由于**因果推断的根本问题**，感兴趣的目标，即提升，永远无法观察到，因此我们无法像处理机器学习预测算法一样验证我们的估计器。我们不能划分验证集并选择表现最好的模型，因为我们**没有真实值**，即使在验证集中也没有，即使我们进行了随机实验也无法获得。
- en: What can we do then? In this article, I try to cover the most popular methods
    used to **evaluate uplift models**. If you are unfamiliar with uplift models,
    I suggest first reading my introductory article.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 那我们该怎么办呢？在这篇文章中，我尝试介绍最常用的**提升模型评估**方法。如果你对提升模型不太熟悉，我建议先阅读我的介绍文章。
- en: '[](/understanding-meta-learners-8a9c1e340832?source=post_page-----8a078996a113--------------------------------)
    [## Understanding Meta Learners'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '[](/understanding-meta-learners-8a9c1e340832?source=post_page-----8a078996a113--------------------------------)
    [## 理解元学习者'
- en: Edit description
  id: totrans-15
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 编辑描述
- en: towardsdatascience.com](/understanding-meta-learners-8a9c1e340832?source=post_page-----8a078996a113--------------------------------)
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: towardsdatascience.com](/understanding-meta-learners-8a9c1e340832?source=post_page-----8a078996a113--------------------------------)
- en: Uplift and Promotional Emails
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提升和促销邮件
- en: Imagine we were working in the marketing department of a product company interested
    in improving our **email marketing campaign**. Historically, we mostly sent emails
    to new customers. However, now we would like to adopt a data-driven approach and
    target customers for whom the email has the highest positive impact on revenue.
    This impact is also called **uplift** or **incrementality**.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下我们在一家产品公司的市场部门工作，致力于改进我们的**电子邮件营销活动**。从历史上看，我们主要向新客户发送邮件。然而，现在我们希望采用数据驱动的方法，针对那些邮件对收入有最大正面影响的客户。这种影响也称为**提升**或**增量性**。
- en: Let’s have a look at the data we have at our disposal. I import the data-generating
    process `dgp_promotional_email()` from `[src.dgp](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/dgp.py)`.
    I also import some plotting functions and libraries from `[src.utils](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/utils.py)`.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看我们可以使用的数据。我从`[src.dgp](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/dgp.py)`导入数据生成过程`dgp_promotional_email()`。我还从`[src.utils](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/utils.py)`导入了一些绘图函数和库。
- en: '[PRE0]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![](../Images/56bf3d1577f8467bf3c41f099cde4155.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/56bf3d1577f8467bf3c41f099cde4155.png)'
- en: Data snapshot, image by Author
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 数据快照，图片来源：作者
- en: We have information on 500 customers, for whom we observe whether they are `new`
    customers, their `age`, the sales they generated before the email campaign (`sales_old`),
    whether they were sent the `mail`, and the `sales` after the email campaign.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有500名客户的信息，我们观察到他们是否是`新`客户，他们的`年龄`，邮件活动前产生的销售额（`sales_old`），是否发送了`邮件`，以及邮件活动后的`销售`。
- en: The **outcome** of interest is `sales`, which we denote with the letter *Y*.
    The **treatment** or policy that we would like to improve is the `mail` campaign,
    which we denote with the letter *W*. We call all the remaining variables **confounders**
    or control variables and we denote them with *X*.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '**感兴趣的结果**是`销售`，我们用字母*Y*表示。**处理**或我们希望改进的政策是`邮件`活动，我们用字母*W*表示。我们将所有其他变量称为**混杂因素**或控制变量，用*X*表示。'
- en: '[PRE1]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The Directed Acyclic Graph (DAG) representing the causal relationships between
    the variables is the following. The causal relationship of interest is depicted
    in green.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 表示变量之间因果关系的有向无环图（DAG）如下。关注的因果关系以绿色显示。
- en: '![](../Images/3cd02967b39e52c491c51e76b93d8fe9.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3cd02967b39e52c491c51e76b93d8fe9.png)'
- en: Directed Acyclic Graph (DAG) of the data generating process
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 数据生成过程的有向无环图（DAG）
- en: From the DAG, we see that the `new` customer indicator is a confounder and needs
    to be controlled in order to identify the effect of `mail` on `sales.` `age` and
    `sales_old` instead are not essential for estimation but could be helpful for
    identification. For more information on DAGs and control variables, you can check
    my introductory article.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 从DAG中，我们看到`新`客户指标是一个混杂因素，需要控制以识别`邮件`对`销售`的影响。`年龄`和`sales_old`则不是估计的关键，但可能对识别有帮助。有关DAG和控制变量的更多信息，请查看我的介绍文章。
- en: '[](/controls-b63dc69e3d8c?source=post_page-----8a078996a113--------------------------------)
    [## DAGs and Control Variables'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '[](/controls-b63dc69e3d8c?source=post_page-----8a078996a113--------------------------------)
    [## DAGs和控制变量'
- en: Edit description
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 编辑描述
- en: towardsdatascience.com](/controls-b63dc69e3d8c?source=post_page-----8a078996a113--------------------------------)
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: towardsdatascience.com](/controls-b63dc69e3d8c?source=post_page-----8a078996a113--------------------------------)
- en: 'The objective of uplift modeling is to recover the **Individual Treatment Effects
    (ITE)** *τᵢ*, i.e. the incremental effect on `sales` of sending the promotional
    `mail`. We can express the ITE as the difference between two hypothetical quantities:
    the potential outcome of the customer if they had received the email, *Yᵢ⁽¹⁾*,
    minus the potential outcome of the customer if they had *not* received the email,
    *Yᵢ⁽⁰⁾*.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 提升建模的目标是恢复**个体处理效应（ITE）** *τᵢ*，即发送促销`邮件`对`销售`的增量效应。我们可以将ITE表示为两个假设量之间的差异：客户接收到邮件的潜在结果
    *Yᵢ⁽¹⁾*，减去客户如果*没有*收到邮件的潜在结果 *Yᵢ⁽⁰⁾*。
- en: '![](../Images/aac44a8c581fb6a58429a0ee35e3d2cf.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/aac44a8c581fb6a58429a0ee35e3d2cf.png)'
- en: Individual Treatment Effect (ITE), image by Author
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 个体处理效应（ITE），图片来源：作者
- en: Note that for each customer, we only observe one of the two realized outcomes,
    depending on whether they actually received the `mail` or not. Therefore, the
    ITE is inherently unobservable. What can be estimated instead is the **Conditional
    Average Treatment Effect (CATE),** i.e., the expected individual treatment effect
    *τᵢ*, conditional on covariates *X*. For example, the average effect of the `mail`
    on `sales` for older customers (`age` > 50).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，对于每位客户，我们只能观察到两个实现结果中的一个，具体取决于他们是否实际收到了`mail`。因此，ITE 本质上是不可观测的。可以估计的是**条件平均处理效应
    (CATE)**，即在协变量 *X* 条件下的期望个体处理效应 *τᵢ*。例如，对年龄大于 50 岁的客户 (`age` > 50) 来说，`mail` 对
    `sales` 的平均效应。
- en: '![](../Images/7c77d68e5b94093232b0aa8a73dfecde.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7c77d68e5b94093232b0aa8a73dfecde.png)'
- en: Conditional Average Treatment Effect (CATE), image by Author
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 条件平均处理效应 (CATE)，图像由作者提供
- en: In order to be able to recover the CATE, we need to make three assumptions.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 为了能够恢复 CATE，我们需要做出三个假设。
- en: '**Unconfoundedness**: *Y⁽⁰⁾, Y⁽¹⁾ ⊥ W | X*'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**无混淆**：*Y⁽⁰⁾, Y⁽¹⁾ ⊥ W | X*'
- en: '**Overlap**: *0 < e(X) < 1*'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**重叠**：*0 < e(X) < 1*'
- en: '**Consistency**: *Y = W ⋅ Y⁽¹⁾ + (1−W) ⋅ Y⁽⁰⁾*'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**一致性**：*Y = W ⋅ Y⁽¹⁾ + (1−W) ⋅ Y⁽⁰⁾*'
- en: Where *e(X)* is the **propensity score,** i.e., the expected probability of
    being treated, conditional on covariates *X*.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *e(X)* 是**倾向得分**，即在协变量 *X* 条件下的预期处理概率。
- en: '![](../Images/53ea9284b69f5874084c4d3b3c3bbfed.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/53ea9284b69f5874084c4d3b3c3bbfed.png)'
- en: Propensity score, image by Author
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 倾向得分，图像由作者提供
- en: In what follows, we will use machine learning methods to estimate the CATE *τ(x)*,
    the propensity scores *e(x)*, and the conditional expectation function (CEF) of
    the outcome, *μ(x)*
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将使用机器学习方法来估计CATE *τ(x)*、倾向得分 *e(x)* 以及结果的条件期望函数 (CEF) *μ(x)*
- en: '![](../Images/348e64d87bf5d9f047e446f0673fac50.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/348e64d87bf5d9f047e446f0673fac50.png)'
- en: Outcome Conditional Expectation Function (CEF), image by Author
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 结果条件期望函数 (CEF)，图像由作者提供
- en: We use [Random Forest Regression](https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html)
    algorithms to model the CATE and the outcome CEF, while we use [Logistic Regression](https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html)
    to model the propensity score.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用 [随机森林回归](https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html)
    算法来建模 CATE 和结果 CEF，而使用 [逻辑回归](https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html)
    来建模倾向得分。
- en: '[PRE2]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: In this article, we do not fine-tune the underlying machine learning models,
    but fine-tuning is strongly recommended to improve the accuracy of uplift models
    (for example, with auto-ml libraries like [FLAML](https://microsoft.github.io/FLAML/)).
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在本文中，我们不对基础机器学习模型进行微调，但强烈建议进行微调以提高提升模型的准确性（例如，使用像 [FLAML](https://microsoft.github.io/FLAML/)
    这样的 auto-ml 库）。
- en: Uplift Models
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提升模型
- en: There exist **many methods** to model uplift or, in other words, to estimate
    Conditional Average Treatment Effects (CATE). Since the objective of this article
    is to compare methods to *evaluate* uplift models, we will not explain the methods
    in detail. For a gentle introduction, you can check [my introductory article on
    meta-learners](https://medium.com/towards-data-science/understanding-meta-learners-8a9c1e340832).
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 存在**许多方法**来建模提升，或者换句话说，估计条件平均处理效应 (CATE)。由于本文的目的是比较方法以*评估*提升模型，我们将不详细解释这些方法。对于温和的介绍，您可以查看
    [我关于元学习者的介绍文章](https://medium.com/towards-data-science/understanding-meta-learners-8a9c1e340832)。
- en: 'The learners that we will consider are the following:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将考虑的学习者如下：
- en: S-learner or single-learner, introduced by [Kunzel, Sekhon, Bickel, Yu (2017)](https://arxiv.org/abs/1706.03461)
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: S-learner 或单学习者，由 [Kunzel, Sekhon, Bickel, Yu (2017)](https://arxiv.org/abs/1706.03461)
    提出
- en: T-learner or two-learner, introduced by [Kunzel, Sekhon, Bickel, Yu (2017)](https://arxiv.org/abs/1706.03461)
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: T-learner 或二学习者，由 [Kunzel, Sekhon, Bickel, Yu (2017)](https://arxiv.org/abs/1706.03461)
    提出
- en: X-learner or cross-learner, introduced by [Kunzel, Sekhon, Bickel, Yu (2017)](https://arxiv.org/abs/1706.03461)
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: X-learner 或交叉学习者，由 [Kunzel, Sekhon, Bickel, Yu (2017)](https://arxiv.org/abs/1706.03461)
    提出
- en: R-learner or [Robinson](https://www.jstor.org/stable/1912705)-learner introduced
    by [Nie, Wager (2017)](https://arxiv.org/abs/1712.04912)
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R-learner 或 [Robinson](https://www.jstor.org/stable/1912705) 学习者，由 [Nie, Wager
    (2017)](https://arxiv.org/abs/1712.04912) 提出
- en: DR-learner or doubly-robust-learner, introduced by [Kennedy (2022)](https://arxiv.org/abs/2004.14497)
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DR-learner 或双重稳健学习者，由 [Kennedy (2022)](https://arxiv.org/abs/2004.14497) 提出
- en: We import all the models from Microsoft’s [econml](https://econml.azurewebsites.net/)
    library.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从微软的 [econml](https://econml.azurewebsites.net/) 库导入所有模型。
- en: '[PRE3]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: We `fit()` the models on the data, specifying the outcome variable *Y*, the
    treatment variable *W* and covariates *X*.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在数据上`fit()`模型，指定结果变量 *Y*、处理变量 *W* 和协变量 *X*。
- en: '[PRE4]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: We are now ready to evaluate the models! Which model should we choose?
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在准备评估这些模型了！我们应该选择哪个模型？
- en: Oracle Loss Functions
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Oracle 损失函数
- en: 'The main problem of evaluating uplift models is that, even with a validation
    set and even with a randomized experiment or AB test, we do **not observe** our
    metric of interest: the Individual Treatment Effects. In fact, we only observe
    the realized outcomes, *Yᵢ⁽⁰⁾* for untreated customers and *Yᵢ⁽¹⁾* for treated
    customers. Therefore, we **cannot compute** the individual treatment effect, *τᵢ
    = Yᵢ⁽¹⁾ − Yᵢ⁽⁰⁾*, in the validation data for any customer.'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 评估提升模型的主要问题是，即使有验证集，甚至有随机实验或AB测试，我们也**未观察到**我们感兴趣的指标：个体治疗效应。事实上，我们只观察到实现的结果，*Yᵢ⁽⁰⁾*
    对于未处理的客户，*Yᵢ⁽¹⁾* 对于处理过的客户。因此，我们**无法计算**验证数据中任何客户的个体治疗效应，*τᵢ = Yᵢ⁽¹⁾ − Yᵢ⁽⁰⁾*。
- en: Can we still do something to **evaluate** our estimators?
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以做些什么来**评估**我们的估计器吗？
- en: The answer is yes, but before giving more details, let’s first understand what
    we would do if we **could observe** the Individual Treatment Effects *τᵢ*.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 答案是肯定的，但在给出更多细节之前，让我们首先了解如果我们**能够观察到**个体治疗效应 *τᵢ* 我们会怎么做。
- en: Oracle MSE Loss
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Oracle MSE 损失
- en: 'If we could observe the individual treatment effects (but we don’t, hence the
    “oracle” attribute), we could try to measure how far our estimates *τ̂(Xᵢ)* are
    from the true values *τᵢ*. This is what we normally do in machine learning when
    we want to evaluate a prediction method: we set aside a validation dataset, and
    we compare predicted and true values on that data. There exist plenty of loss
    functions to evaluate prediction accuracy, so let’s concentrate on the most popular
    one: the **Mean Squared Error (MSE) loss**.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们能够观察个体治疗效应（但我们不能，因此有“oracle”属性），我们可以尝试衡量我们的估计 *τ̂(Xᵢ)* 距离真实值 *τᵢ* 的距离。这就是我们在机器学习中评估预测方法时通常做的：我们保留一个验证数据集，并在该数据上比较预测值和真实值。有很多损失函数可以评估预测准确性，因此让我们集中于最流行的一个：**均方误差（MSE）损失**。
- en: '![](../Images/38df3b8e20ebf572d3b29f88eb6fdf1b.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/38df3b8e20ebf572d3b29f88eb6fdf1b.png)'
- en: Oracle MSE loss function, image by Author
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: Oracle MSE 损失函数，作者图
- en: '[PRE5]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The function `compare_methods` prints and plots evaluation metrics computed
    on a separate validation dataset.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 函数 `compare_methods` 打印和绘制在单独验证数据集上计算的评估指标。
- en: '[PRE6]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](../Images/718c577c72131582e4f5397735a2b60a.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/718c577c72131582e4f5397735a2b60a.png)'
- en: Oracle MSE loss values, image by Author
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: Oracle MSE 损失值，作者图
- en: In this case, we see that the T-learner clearly performs worst, with the S-learner
    just behind. On the other hand, the X-, R- and DR-learners perform significantly
    better, with the **DR-learner winning** the race.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们看到T-学习者表现最差，S-学习者紧随其后。另一方面，X-、R-和DR-学习者表现明显更好，**DR-学习者赢得了比赛**。
- en: 'However, this might *not* be the best loss function to evaluate our uplift
    model. In fact, uplift modeling is just an intermediate step towards our ultimate
    goal: improving revenue.'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这可能*不是*评估我们提升模型的最佳损失函数。实际上，提升建模只是通向我们最终目标的一步：提高收入。
- en: Oracle Policy Gain
  id: totrans-80
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Oracle 策略增益
- en: Since our ultimate goal is to **improve revenue**, we could evaluate estimators
    by how much they increase revenue, given a certain policy function. Suppose, for
    example, that we had a 0.01$ cost of sending an email. Then, our policy would
    be to treat each customer with a predicted Conditional Average Treatment Effect
    above 0.01$.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们最终的目标是**提高收入**，我们可以通过它们增加收入的多少来评估估计器，给定某个策略函数。例如，假设我们发送一封电子邮件的成本是0.01$。那么，我们的策略是处理每个预测的条件平均治疗效应高于0.01$的客户。
- en: '[PRE7]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'How much would our revenue actually increase? Let’s define with *d(τ̂)* our
    policy function, such that *d=1* if *τ ≥ 0.1* and *d=0* otherwise. Then our *gain*
    (higher is better) function is:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的收入实际会增加多少？让我们用 *d(τ̂)* 定义我们的策略函数，其中 *d=1* 如果 *τ ≥ 0.1*，否则 *d=0*。然后我们的*增益*（越高越好）函数是：
- en: '![](../Images/2d8ad6dd41a3932dc4d3572f1a44ee9b.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2d8ad6dd41a3932dc4d3572f1a44ee9b.png)'
- en: Oracle policy gain function, image by Author
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: Oracle 策略增益函数，作者图
- en: Again, this is an “oracle” loss function that **cannot be computed** in reality
    since we do not observe the individual treatment effects.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，这是一种“oracle”损失函数，在现实中**无法计算**，因为我们无法观察到个体治疗效应。
- en: '[PRE8]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](../Images/ef9d36d2a5b8ac807f36c43a6cfa320d.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ef9d36d2a5b8ac807f36c43a6cfa320d.png)'
- en: Oracle policy gain values, image by Author
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: Oracle policy gain values, image by Author
- en: In this case, the S-learner is clearly the worst performer, leading to no effect
    on revenues. The T-learner leads to modest gains, while the X-, R- and DR- learners
    all lead to aggregate gains, with the **X-learner slightly ahead**.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，S-学习者显然是表现最差的，导致收入没有效果。T-学习者带来了适度的收益，而X-、R-和DR-学习者都带来了整体收益，其中**X-学习者稍微领先**。
- en: Practical Loss Functions
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实用损失函数
- en: In the previous section, we have seen two examples of loss functions that we
    would like to compute if we could observe the Individual Treatment Effects *τᵢ*.
    However, in practice, even with a randomized experiment and even with a validation
    set, we do not observe the ITE, our object of interest. We will now cover some
    measures that try to evaluate uplift models, given this practical constraint.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一节中，我们已经看到两个损失函数的例子，如果我们能观察到个体治疗效应*τᵢ*，我们希望计算这些损失函数。然而，实际上，即使在随机实验和验证集的情况下，我们也不能观察到ITE，这是我们的兴趣对象。我们现在将介绍一些在这种实际限制下尝试评估提升模型的度量方法。
- en: Outcome Loss
  id: totrans-93
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 结果损失
- en: The first and simplest approach is to switch to a different loss variable. While
    we cannot observe the Individual Treatment Effects, *τᵢ*, we can still observe
    our outcome *Yᵢ*. This is not exactly our object of interest, but we might expect
    an uplift model that performs well in terms of predicting *y* also to produce
    good estimates of *τ*.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 第一种也是最简单的方法是切换到不同的损失变量。虽然我们不能观察个体治疗效应*τᵢ*，但我们仍然可以观察我们的结果*Yᵢ*。这不是我们确切的兴趣对象，但我们可以期望一个在预测*y*方面表现良好的提升模型也会提供良好的*τ*估计。
- en: One such loss function could be the **Outcome MSE loss**, which is the usual
    MSE loss function for prediction methods.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 一种这样的损失函数可能是**结果MSE损失**，这是预测方法中通常使用的MSE损失函数。
- en: '![](../Images/ae12af05bb02493c11b7263d8a1becb4.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ae12af05bb02493c11b7263d8a1becb4.png)'
- en: Outcome MSE loss function, image by Author
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 结果MSE损失函数，图像作者
- en: The problem here is that not all models directly produce an estimate of *μ(x)*.
    Therefore, we skip this comparison and switch to methods that can evaluate any
    uplift model.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 问题在于，并非所有模型都直接产生*μ(x)*的估计。因此，我们跳过这个比较，转而使用可以评估任何提升模型的方法。
- en: Prediction to Prediction Loss
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 预测到预测损失
- en: Another very simple approach could be to compare the predictions of the model
    trained on the training set with the predictions of another model trained on the
    validation set. While intuitive, this approach could be **extremely misleading**.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种非常简单的方法是将训练集上训练的模型的预测与在验证集上训练的另一个模型的预测进行比较。虽然直观，但这种方法可能会**极具误导性**。
- en: '[PRE9]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](../Images/8c286e12dbdbf510e239ac05e5628488.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/8c286e12dbdbf510e239ac05e5628488.png)'
- en: Prediction-to-prediction MSE losss values, image by Author
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 预测到预测MSE损失值，图像作者
- en: Unsurprisingly, this metric performs extremely badly, and you should **never
    use it** since it rewards models that are consistent, irrespectively of their
    quality. A model that always predicts a random constant CATE for each observation
    would obtain a perfect score.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 不出所料，这一指标表现极差，你**绝不应该使用它**，因为它奖励那些一致的模型，而不考虑它们的质量。一个始终为每个观测预测一个随机常数CATE的模型将获得完美的得分。
- en: Distribution Loss
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分布损失
- en: 'A different approach is to ask: how well can we match the distribution of potential
    outcomes? We can do this exercise for either the *treated* or *untreated* potential
    outcomes. Let’s take the last case. Suppose we take the observed `sales` for customers
    that did *not* receive the `mail` and the observed `sales` *minus* the estimated
    CATE *τ̂(x)* for customers that did receive the `mail`. By the **unconfoundedness**
    assumption, these two distributions of the untreated potential outcome should
    be similar, conditional on covariates *X*.'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种方法是问：我们能多好地匹配潜在结果的分布？我们可以对*处理组*或*未处理组*的潜在结果进行这个练习。以最后一种情况为例。假设我们对那些*没有*收到`邮件`的客户的观察到的`sales`以及对那些收到`邮件`的客户的观察到的`sales`
    *减去* 估计的CATE *τ̂(x)* 进行比较。根据**无混杂假设**，在协变量*X*的条件下，这两个未处理潜在结果的分布应该是相似的。
- en: Therefore, we expect the distance between the two distributions to be close
    if we have correctly estimated the treatment effects.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，如果我们正确估计了治疗效应，我们期望两个分布之间的距离较近。
- en: '![](../Images/eeb34245b68476c0bd20dee426c4ca85.png)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/eeb34245b68476c0bd20dee426c4ca85.png)'
- en: Untreated potential outcome distance, image by Author
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 未处理潜在结果距离，图像作者
- en: We can also do the same exercise for the *treated* potential outcome.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以对*处理过的*潜在结果做同样的分析。
- en: '![](../Images/453be0804bac6bfa71387084b6c92f4e.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/453be0804bac6bfa71387084b6c92f4e.png)'
- en: Treated potential outcome distance, image by Author
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 处理后的潜在结果距离，图像由作者提供
- en: We use the [energy distance](https://en.wikipedia.org/wiki/Energy_distance)
    as the distance metric.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用[能量距离](https://en.wikipedia.org/wiki/Energy_distance)作为距离度量。
- en: '[PRE10]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](../Images/590b5e9ba6819a8d225df4dacc459987.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/590b5e9ba6819a8d225df4dacc459987.png)'
- en: Untreated potential outcome distance values, image by Author
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 未处理的潜在结果距离值，图像由作者提供
- en: This measure is extremely noisy and rewards the S-learner followed by the T-learner,
    which are actually the two worst-performing models.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 该测量非常嘈杂，奖励了S-学习者，其次是T-学习者，这实际上是两个表现最差的模型。
- en: Above-below Median Difference
  id: totrans-118
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 上下中位数差异
- en: 'The above-below median loss tries to answer the question: is our uplift model
    detecting **any heterogeneity**? In particular, if we take the validation set
    and we split the sample into above-median and below-median predicted uplift *τ̂(x)*,
    how big is the actual difference in average effect, estimated with a difference-in-means
    estimator? We would expect better estimators to better split the sample into high-effects
    and low-effects.'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 上下中位数损失试图回答一个问题：我们的提升模型是否检测到**任何异质性**？特别是，如果我们取验证集并将样本分为中位数以上和中位数以下预测提升*τ̂(x)*，实际的平均效果差异有多大，用均值差异估计？我们期望更好的估计器能更好地区分高效和低效。
- en: '[PRE11]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](../Images/47e9b9ab0153043e44df1ca6c0b9b2ac.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/47e9b9ab0153043e44df1ca6c0b9b2ac.png)'
- en: Above-below median difference gain values, image by Author
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 上下中位数差异增益值，图像由作者提供
- en: Unfortunately, the above-below median difference rewards the T-learner, which
    is among the worst-performing models.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，上下中位数差异奖励了T-学习者，它在表现最差的模型中排名靠前。
- en: It’s important to note that the difference-in-means estimators in the two groups
    (above- and below- median *τ̂(x)*) are **not guaranteed to be unbiased**, even
    if the data came from a randomized experiment. In fact, we have split the two
    groups on a variable, *τ̂(x)*, that is highly endogenous. Therefore, the method
    should be used with a grain of salt.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，即使数据来自随机实验，两组（中位数以上和中位数以下*τ̂(x)*)的均值差异估计器**也不能保证无偏**。事实上，我们在一个高度内生的变量*τ̂(x)*上将两组进行分割。因此，方法应保持谨慎。
- en: Uplift Curve
  id: totrans-125
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 提升曲线
- en: 'An extension of the above-below median test is the **uplift curve**. The idea
    is simple: instead of splitting the sample into two groups based on the median
    (0.5 quantile), why not split the data into more groups (more quantiles)?'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 上下中位数检验的扩展是**提升曲线**。其思想很简单：与其根据中位数（0.5分位数）将样本分成两组，不如将数据分成更多组（更多分位数）？
- en: 'For each group, we compute the difference-in-means estimate, and we plot its
    cumulative sum against the corresponding quantile. The result is called the **uplift
    curve**. The interpretation is simple: the higher the curve, the better we are
    able to separate high- from low-effect observations. However, also the same **disclaimer**
    applies: the difference-in-means estimates are not unbiased. Therefore, they should
    be used with a grain of salt.'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个组，我们计算均值差异估计，并将其累积和与相应的分位数进行绘图。结果称为**提升曲线**。解释很简单：曲线越高，我们就越能有效地区分高效和低效观察值。然而，同样的**免责声明**适用：均值差异估计并不保证无偏。因此，使用时应保持谨慎。
- en: '[PRE12]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![](../Images/abbed6c32127b8eddc36c7d71d636f99.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/abbed6c32127b8eddc36c7d71d636f99.png)'
- en: Uplift curve, image by Author
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 提升曲线，图像由作者提供
- en: While probably not the best method to *evaluate* uplift models, the uplift curve
    is very important in **understanding** and **implementing** them. In fact, for
    each model, it tells us that is the expected average treatment effect (y-axis)
    as we increase the share of the treated population (x-axis).
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然可能不是评估提升模型的最佳方法，但提升曲线在**理解**和**实施**这些模型中非常重要。实际上，对于每个模型，它告诉我们在增加处理人群比例（x轴）时，预期的平均处理效果（y轴）是什么。
- en: Nearest Neighbor Match
  id: totrans-132
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 最近邻匹配
- en: The last couple of methods we analyzed used aggregated data in order to understand
    whether the methods work on larger groups. The nearest neighbor match tries instead
    to understand how well an uplift model predicts individual treatment effects.
    However, since the ITEs are not observable, it tries to build a **proxy by matching**
    treated and control observations on observable characteristics *X*.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 我们分析的最后几种方法使用了聚合数据来理解这些方法在更大群体中的效果。最近邻匹配方法则试图了解提升模型如何预测个体治疗效果。然而，由于ITE不可观察，它试图通过在可观察特征*X*上匹配处理组和对照组观察值来建立一个**代理**。
- en: 'For example, if we take all treated observations (*i: Wᵢ=1*), and we find the
    nearest neighbor in the control group (*NN₀(Xᵢ)*), the corresponding MSE loss
    function is'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '例如，如果我们取所有处理组观察值（*i: Wᵢ=1*），并在对照组中找到最近邻（*NN₀(Xᵢ)*），则相应的均方误差损失函数为'
- en: '![](../Images/03f3aba85a111b1373906b87985a9ac1.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/03f3aba85a111b1373906b87985a9ac1.png)'
- en: Nearest neighbor loss function, image by Author
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 最近邻损失函数，图片由作者提供
- en: '[PRE13]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![](../Images/81248da32377e026d4c4549b11e7c8d5.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/81248da32377e026d4c4549b11e7c8d5.png)'
- en: Nearest neighbor loss values, image by Author
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 最近邻损失值，图片由作者提供
- en: In this case, the nearest neighbor loss performs quite well, identifying the
    two worse performing methods, the S- and T-learner.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，最近邻损失表现得相当好，识别出了两个表现最差的方法，即S-学习者和T-学习者。
- en: IPW Loss
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: IPW损失
- en: The Inverse Probability Weighting (IPW) loss function was first proposed by
    [Gutierrez, Gerardy (2017)](https://proceedings.mlr.press/v67/gutierrez17a/gutierrez17a.pdf),
    and it is the first of three metrics that we are going to see that use a **pseudo-outcome**
    *Y** to evaluate the estimator. Pseudo-outcomes are variables whose expected value
    is the Conditional Average Treatment Effect, but that are too volatile to be directly
    used as estimates. For a more detailed explanation of pseudo-outcomes, I suggest
    [my article on causal regression trees](/920177462149). The pseudo-outcome corresponding
    to the IPW loss is
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 逆概率加权（IPW）损失函数首次由[Gutierrez, Gerardy (2017)](https://proceedings.mlr.press/v67/gutierrez17a/gutierrez17a.pdf)提出，它是我们将要看到的三种指标中的第一种，这些指标使用**伪结果**
    *Y* 来评估估计器。伪结果是其期望值为条件平均治疗效应的变量，但由于其波动性太大，不能直接用作估计。有关伪结果的详细解释，我建议阅读[我关于因果回归树的文章](/920177462149)。IPW损失对应的伪结果为
- en: '![](../Images/0e3772e78ac256bc120239afc7eb513d.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/0e3772e78ac256bc120239afc7eb513d.png)'
- en: IPW pseudo-outcome, image by Author
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: IPW伪结果，图片由作者提供
- en: so that the corresponding loss function is
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 使得相应的损失函数为
- en: '![](../Images/2dfb0b821e20461e93237350a7cd1fb0.png)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2dfb0b821e20461e93237350a7cd1fb0.png)'
- en: IPW loss function, image by Author
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: IPW损失函数，图片由作者提供
- en: '[PRE14]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![](../Images/b060450ccdbe90a962d595f5643d4e1d.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b060450ccdbe90a962d595f5643d4e1d.png)'
- en: IPW loss function values, image by Author
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: IPW损失函数值，图片由作者提供
- en: The IPW loss is extremely noisy. A solution is to use its more robust variations,
    the R-loss or the DR-loss which we present next.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: IPW损失函数非常嘈杂。一种解决方案是使用其更稳健的变体，即我们接下来介绍的R损失或DR损失。
- en: R Loss
  id: totrans-152
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: R损失
- en: The R-loss was introduced together with the R-learner by [Nie, Wager (2017)](https://arxiv.org/abs/1712.04912),
    and it is essentially the **objective function** of the R-learner. As for the
    IPW-loss, the idea is to try to match a pseudo outcome whose expected value is
    the Conditional Average Treatment Effect.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: R损失与R-学习者一起由[Nie, Wager (2017)](https://arxiv.org/abs/1712.04912)引入，它本质上是R-学习者的**目标函数**。与IPW损失一样，这个方法的想法是匹配一个伪结果，其期望值为条件平均治疗效应。
- en: '![](../Images/b507442670b3c32a4c1d0e69fb51b82d.png)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b507442670b3c32a4c1d0e69fb51b82d.png)'
- en: R pseudo-outcome, image by Author
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: R伪结果，图片由作者提供
- en: The corresponding loss function is
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 相应的损失函数为
- en: '![](../Images/c91ec81d39e03bb9ff29f5f35091a185.png)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c91ec81d39e03bb9ff29f5f35091a185.png)'
- en: R loss function, image by Author
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: R损失函数，图片由作者提供
- en: '[PRE15]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](../Images/1f3b6b7f182ad7889ec7409a11839ba5.png)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/1f3b6b7f182ad7889ec7409a11839ba5.png)'
- en: R loss values, image by Author
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: R损失值，图片由作者提供
- en: The R-loss is sensibly less noisy than the IPW loss, and it clearly isolates
    the S-learner. However, it tends to favor its corresponding learner, the R-learner.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: R损失函数明显比IPW损失函数噪声更小，而且它能清晰地孤立S-学习者。然而，它倾向于偏爱其对应的学习者，即R-学习者。
- en: DR Loss
  id: totrans-163
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DR损失
- en: The DR-loss is the **objective function** of the DR-learner, and it was first
    introduced by [Saito, Yasui (2020)](https://arxiv.org/abs/1909.05299). As for
    the IPW- and the R-loss, the idea is to try to match a pseudo outcome, whose expected
    value is the Conditional Average Treatment Effect. The DR pseudo-outcome is strongly
    related to the [AIPW estimator](/ed4097dab27a), also known as doubly-robust estimator,
    hence the DR name.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: DR-loss 是 DR-learner 的**目标函数**，首次由 [Saito, Yasui (2020)](https://arxiv.org/abs/1909.05299)
    提出。至于IPW和R-loss，概念是试图匹配一个伪结果，其期望值是条件平均处理效应。DR伪结果与 [AIPW估计器](/ed4097dab27a) 密切相关，也被称为双重稳健估计器，因此得名DR。
- en: '![](../Images/a57cdc115e7e040d659213351418157a.png)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a57cdc115e7e040d659213351418157a.png)'
- en: DR pseudo-outcome, image by Author
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: DR伪结果，图片由作者提供
- en: The corresponding loss function is
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 对应的损失函数是
- en: '![](../Images/2befa8823be6554364a382d23f223e92.png)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2befa8823be6554364a382d23f223e92.png)'
- en: DR loss function, image by Author
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: DR损失函数，图片由作者提供
- en: '[PRE16]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![](../Images/893b54ab36614552dd00282e3d0b36fe.png)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/893b54ab36614552dd00282e3d0b36fe.png)'
- en: DR loss values, image by Author
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: DR损失值，图片由作者提供
- en: As for the R-loss, the DR-loss tends to favor its corresponding learner, the
    DR-learner. However, it provides a more accurate ranking in terms of algorithms’
    accuracy.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 与R-loss类似，DR-loss 倾向于偏好其对应的学习器，即 DR-learner。然而，它在算法准确性方面提供了更准确的排名。
- en: Empirical Policy Gain
  id: totrans-174
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 实证政策收益
- en: 'The last loss function that we are going to analyze is different from all the
    others we have seen so far since it does *not* focus on how well we are able to
    estimate the treatment effects but rather on how well would the corresponding
    **optimal treatment policy** performs. In particular, [Hitsch, Misra, Zhang (2023)](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3111957)
    propose the following gain function:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将要分析的最后一个损失函数不同于迄今为止见过的所有其他函数，因为它*不*关注我们能够多好地估计治疗效应，而是关注相应的**最佳治疗政策**的表现。特别是，[Hitsch,
    Misra, Zhang (2023)](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3111957)
    提出了以下收益函数：
- en: '![](../Images/fe8feb6a39536a9c05ef4ff018220bfd.png)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/fe8feb6a39536a9c05ef4ff018220bfd.png)'
- en: Empirical policy gain function, image by Author
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 实证政策收益函数，图片由作者提供
- en: where *c* is the treatment cost and *d* is the optimal treatment policy given
    the estimated CATE *τ̂(Xᵢ)*. In our case, we assume an individual treatment cost
    of c=0.01$, so that the optimal policy is to treat every customer with an estimated
    CATE larger than 0.01.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *c* 是治疗成本，*d* 是给定估计CATE *τ̂(Xᵢ)* 的最佳治疗政策。在我们的案例中，我们假设个体治疗成本为 c=0.01$，因此最佳政策是对每个估计CATE大于0.01的客户进行治疗。
- en: The terms *Wᵢ⋅d(τ̂)* and (1-*Wᵢ)⋅(1-d(τ̂))* imply that we use for the calculation
    only individuals for whom the actual treatment *W* corresponds with the optimal
    one, *d*. However, this means that the metric is computed for a different number
    of observations for each model. The inverse weights *ê(X)* and *1-ê(X)* correct
    this imbalance.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: '*Wᵢ⋅d(τ̂)* 和 (1-*Wᵢ*)⋅(1-d(τ̂)*) 表明我们仅对实际治疗 *W* 与最佳治疗 *d* 相匹配的个体进行计算。然而，这意味着每个模型计算的度量观测数量不同。逆权重
    *ê(X)* 和 *1-ê(X)* 纠正了这种不平衡。'
- en: '[PRE17]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![](../Images/629b2d1e0b410b032ee314637d433ee1.png)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/629b2d1e0b410b032ee314637d433ee1.png)'
- en: Empirical policy gain values, image by Author
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 实证政策收益值，图片由作者提供
- en: The empirical policy gain performs well, isolating the two worst-performing
    methods, the S- and T-learners.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 实证政策收益表现良好，能够区分出两种最差表现的方法，S-学习者和T-学习者。
- en: Meta Studies
  id: totrans-184
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 元研究
- en: In this article, we have introduced a wide variety of methods to evaluate uplift
    models, a.k.a. Conditional Average Treatment Effect estimators. We have also tested
    in our simulated dataset, which is a very special and limited example. How do
    these metrics **perform** in general?
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在本文中，我们介绍了多种评估提升模型的方法，也就是条件平均处理效应估计器。我们还在我们的模拟数据集中进行了测试，这是一个非常特殊和有限的例子。这些度量在一般情况下**表现**如何？
- en: '[Schuler, Baiocchi, Tibshirani, Shah (2018)](https://arxiv.org/abs/1804.05146)
    compares the S-loss, T-loss, R-loss, on **simulated data**, for the corresponding
    estimators. They find that the R-loss “*is the validation set metric that, when
    optimized, most consistently leads to the selection of a high-performing model*”.
    The authors also detect the so-called **congeniality bias**: metrics such as the
    R- or DR-loss tend to be biased towards the corresponding learner.'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: '[Schuler, Baiocchi, Tibshirani, Shah (2018)](https://arxiv.org/abs/1804.05146)
    比较了**模拟数据**上S-loss、T-loss、R-loss的表现。研究发现R-loss“*是在优化时最一致地导致选择高性能模型的验证集指标*”。作者还发现了所谓的**亲和性偏差**：像R-loss或DR-loss这样的指标倾向于对相应的学习者产生偏见。'
- en: '[Curth, van der Schaar (2023)](https://arxiv.org/abs/2302.02923) studies a
    broader array of learners from a **theoretical perspective**. They find that “*no
    existing selection criterion is globally best across all experimental conditions
    we consider*”.'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: '[Curth, van der Schaar (2023)](https://arxiv.org/abs/2302.02923) 从**理论角度**研究了更广泛的学习者。他们发现“*在我们考虑的所有实验条件下，没有现有的选择标准在全球范围内最好*”。'
- en: '[Mahajan, Mitliagkas, Neal, Syrgkanis (2023)](https://arxiv.org/abs/2211.01939)
    is the **most comprehensive** study in terms of scope. The authors compare many
    metrics on 144 datasets and 415 estimators. They find that “*no metric significantly
    dominates the rest*” but “*metrics that use DR elements seem to always be among
    the candidate winners*”.'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: '[Mahajan, Mitliagkas, Neal, Syrgkanis (2023)](https://arxiv.org/abs/2211.01939)
    是**最全面**的研究，涵盖范围广泛。作者在144个数据集和415个估计器上比较了许多指标。他们发现“*没有指标显著优于其他指标*”，但“*使用DR元素的指标似乎总是出现在候选赢家中*”。'
- en: Conclusion
  id: totrans-189
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结论
- en: In this article, we have explored multiple methods to evaluate uplift models.
    The **main challenge** is the unobservability of the variable of interest, the
    Individual Treatment Effects. Therefore, different methods try to evaluate uplift
    models either using other variables, using proxy outcomes, or approximating the
    effect of implied optimal policies.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在本文中，我们探讨了多种评估提升模型的方法。**主要挑战**在于感兴趣变量——个体治疗效果的不可观测性。因此，不同的方法尝试通过使用其他变量、代理结果或近似隐含的最优政策效果来评估提升模型。
- en: It is hard to recommend using a single method since there is **no consensus**
    on which one performs best, neither from a theoretical nor from an empirical perspective.
    Loss functions that use R- and DR- elements tend to perform **consistently better**,
    but are also biased towards the corresponding learners. Understanding how these
    metrics work, however, can help in understanding their biases and limitations
    in order to make the most appropriate decisions depending on the specific scenario.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 很难推荐使用单一方法，因为**没有共识**哪一种表现最好，无论是从理论还是实证角度来看。使用R-和DR-元素的损失函数往往表现**一致较好**，但也对相应的学习者存在偏见。然而，理解这些指标的工作原理可以帮助理解它们的偏差和局限性，以便根据具体场景做出最适当的决策。
- en: References
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参考文献
- en: 'Curth, van der Schaar (2023), [“In Search of Insights, Not Magic Bullets: Towards
    Demystification of the Model Selection Dilemma in Heterogeneous Treatment Effect
    Estimation”](https://arxiv.org/abs/2302.02923)'
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Curth, van der Schaar (2023), [“寻求洞见，而非灵丹妙药：迈向异质治疗效果估计中的模型选择困境的揭秘”](https://arxiv.org/abs/2302.02923)
- en: 'Gutierrez, Gerardy (2017), [“Causal Inference and Uplift Modeling: A review
    of the literature”](https://proceedings.mlr.press/v67/gutierrez17a/gutierrez17a.pdf)'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Gutierrez, Gerardy (2017), [“因果推断与提升建模：文献综述”](https://proceedings.mlr.press/v67/gutierrez17a/gutierrez17a.pdf)
- en: Hitsch, Misra, Zhang (2023), [“Heterogeneous Treatment Effects and Optimal Targeting
    Policy Evaluation”](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3111957)
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Hitsch, Misra, Zhang (2023), [“异质治疗效果与最优目标政策评估”](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3111957)
- en: Kennedy (2022), [“Towards optimal doubly robust estimation of heterogeneous
    causal effects”](https://arxiv.org/abs/2004.14497)
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kennedy (2022), [“迈向最优双重稳健估计异质因果效应”](https://arxiv.org/abs/2004.14497)
- en: Kunzel, Sekhon, Bickel, Yu (2017), [“Meta-learners for Estimating Heterogeneous
    Treatment Effects using Machine Learning”](https://arxiv.org/abs/1706.03461)
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kunzel, Sekhon, Bickel, Yu (2017), [“使用机器学习估计异质治疗效果的元学习者”](https://arxiv.org/abs/1706.03461)
- en: Mahajan, Mitliagkas, Neal, Syrgkanis (2023), [“Empirical Analysis of Model Selection
    for Heterogeneous Causal Effect Estimation”](https://arxiv.org/abs/2211.01939)
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Mahajan, Mitliagkas, Neal, Syrgkanis (2023), [“异质因果效应估计模型选择的实证分析”](https://arxiv.org/abs/2211.01939)
- en: Nie, Wager (2017), [“Quasi-Oracle Estimation of Heterogeneous Treatment Effects”](https://arxiv.org/abs/1712.04912)
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Nie, Wager (2017), [“异质性处理效应的准 oracle 估计”](https://arxiv.org/abs/1712.04912)
- en: 'Saito, Yasui (2020), [“Counterfactual Cross-Validation: Stable Model Selection
    Procedure for Causal Inference Models”](https://arxiv.org/abs/1909.05299)'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Saito, Yasui (2020), [“反事实交叉验证：用于因果推断模型的稳定模型选择程序”](https://arxiv.org/abs/1909.05299)
- en: Schuler, Baiocchi, Tibshirani, Shah (2018), [“A comparison of methods for model
    selection when estimating individual treatment effects”](https://arxiv.org/abs/1804.05146)
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Schuler, Baiocchi, Tibshirani, Shah (2018), [“在估计个体处理效应时模型选择方法的比较”](https://arxiv.org/abs/1804.05146)
- en: Related Articles
  id: totrans-202
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 相关文章
- en: '[Understanding Meta Learners](/8a9c1e340832)'
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[理解元学习器](/8a9c1e340832)'
- en: '[Understanding AIPW, the Doubly-Robust Estimator](/ed4097dab27a)'
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[理解 AIPW，双重稳健估计量](/ed4097dab27a)'
- en: '[Understanding Causal Trees](/920177462149)'
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[理解因果树](/920177462149)'
- en: '[From Causal Trees to Forests](/43c4536f1481)'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[从因果树到森林](/43c4536f1481)'
- en: Code
  id: totrans-207
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 代码
- en: 'You can find the original Jupyter Notebook here:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在这里找到原始的 Jupyter Notebook：
- en: '[](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/evaluate_uplift.ipynb?source=post_page-----8a078996a113--------------------------------)
    [## Blog-Posts/notebooks/evaluate_uplift.ipynb at main · matteocourthoud/Blog-Posts'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/evaluate_uplift.ipynb?source=post_page-----8a078996a113--------------------------------)
    [## Blog-Posts/notebooks/evaluate_uplift.ipynb at main · matteocourthoud/Blog-Posts'
- en: Code and notebooks for my Medium blog posts. Contribute to matteocourthoud/Blog-Posts
    development by creating an…
  id: totrans-210
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 我在 Medium 博客文章中使用的代码和笔记本。通过创建一个…
- en: github.com](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/evaluate_uplift.ipynb?source=post_page-----8a078996a113--------------------------------)
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: github.com](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/evaluate_uplift.ipynb?source=post_page-----8a078996a113--------------------------------)
- en: Thank you for reading!
  id: totrans-212
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 感谢你的阅读！
- en: '*I really appreciate it!* 🤗 *If you liked the post and want to see more, consider*
    [***following me***](https://medium.com/@matteo.courthoud)*. I post once a week
    on topics related to causal inference and data analysis. I try to keep my posts
    simple but precise, always providing code, examples, and simulations.*'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: '*非常感谢！* 🤗 *如果你喜欢这篇文章并想查看更多内容，可以考虑* [***关注我***](https://medium.com/@matteo.courthoud)*。我每周发布一次与因果推断和数据分析相关的主题。我尽量保持我的文章简明但精准，始终提供代码、示例和模拟。*'
- en: '*Also, a small* ***disclaimer****: I write to learn, so mistakes are the norm,
    even though I try my best. Please, when you spot them, let me know. I also appreciate
    suggestions on new topics!*'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: '*另外，一个小小的* ***免责声明****：我写作是为了学习，所以错误是常有的，即使我尽力而为。请在发现错误时告知我。我也欢迎关于新主题的建议！*'
