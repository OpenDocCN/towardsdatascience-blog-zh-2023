- en: Conformal Predictions in Time Series Forecasting
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ—¶é—´åºåˆ—é¢„æµ‹ä¸­çš„ä¿å½¢é¢„æµ‹
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/conformal-predictions-in-time-series-forecasting-32d3243d7479](https://towardsdatascience.com/conformal-predictions-in-time-series-forecasting-32d3243d7479)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/conformal-predictions-in-time-series-forecasting-32d3243d7479](https://towardsdatascience.com/conformal-predictions-in-time-series-forecasting-32d3243d7479)
- en: Explore the concept of conformal predictions applied to the field of time series
    forecasting and implement it in Python
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ¢è®¨åº”ç”¨äºæ—¶é—´åºåˆ—é¢„æµ‹é¢†åŸŸçš„**ä¿å½¢é¢„æµ‹**æ¦‚å¿µï¼Œå¹¶åœ¨ Python ä¸­å®ç°å®ƒ
- en: '[](https://medium.com/@marcopeixeiro?source=post_page-----32d3243d7479--------------------------------)[![Marco
    Peixeiro](../Images/7cf0a81d87281d35ff47f51e3026a3e9.png)](https://medium.com/@marcopeixeiro?source=post_page-----32d3243d7479--------------------------------)[](https://towardsdatascience.com/?source=post_page-----32d3243d7479--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----32d3243d7479--------------------------------)
    [Marco Peixeiro](https://medium.com/@marcopeixeiro?source=post_page-----32d3243d7479--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@marcopeixeiro?source=post_page-----32d3243d7479--------------------------------)[![Marco
    Peixeiro](../Images/7cf0a81d87281d35ff47f51e3026a3e9.png)](https://medium.com/@marcopeixeiro?source=post_page-----32d3243d7479--------------------------------)[](https://towardsdatascience.com/?source=post_page-----32d3243d7479--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----32d3243d7479--------------------------------)
    [Marco Peixeiro](https://medium.com/@marcopeixeiro?source=post_page-----32d3243d7479--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----32d3243d7479--------------------------------)
    Â·10 min readÂ·Dec 12, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----32d3243d7479--------------------------------)
    Â·10 min é˜…è¯»Â·2023å¹´12æœˆ12æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/c4815b8031d5f2b1e038b0ee4a966ea6.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c4815b8031d5f2b1e038b0ee4a966ea6.png)'
- en: Photo by [Keith Markilie](https://unsplash.com/@rhino007?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ç”± [Keith Markilie](https://unsplash.com/@rhino007?utm_source=medium&utm_medium=referral)
    åœ¨ [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral) æä¾›çš„ç…§ç‰‡
- en: Consider the task of forecasting call volumes in a call center. The predictions
    play a primordial role, as they inform the budget allocation and workforce planning
    (if more calls are expected, more agents should be available to answer).
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: è€ƒè™‘é¢„æµ‹å‘¼å«ä¸­å¿ƒçš„å‘¼å«é‡è¿™ä¸€ä»»åŠ¡ã€‚è¿™äº›é¢„æµ‹åœ¨é¢„ç®—åˆ†é…å’Œå‘˜å·¥è§„åˆ’ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼ˆå¦‚æœé¢„è®¡ä¼šæœ‰æ›´å¤šçš„å‘¼å«ï¼Œå°±éœ€è¦æ›´å¤šçš„ä»£ç†æ¥æ¥å¬ï¼‰ã€‚
- en: So we build a forecasting model and report that next week the center will receive
    2451 calls.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥æˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªé¢„æµ‹æ¨¡å‹ï¼Œå¹¶æŠ¥å‘Šä¸‹å‘¨ä¸­å¿ƒå°†æ¥åˆ° 2451 ä¸ªç”µè¯ã€‚
- en: Of course, with any prediction in the future comes some error and uncertainty.
    But how can we quantify it?
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œä»»ä½•æœªæ¥çš„é¢„æµ‹éƒ½ä¼šå¸¦æ¥ä¸€äº›è¯¯å·®å’Œä¸ç¡®å®šæ€§ã€‚ä½†æˆ‘ä»¬å¦‚ä½•é‡åŒ–è¿™äº›å‘¢ï¼Ÿ
- en: The logical answer is using **prediction intervals**. That way, we can report
    a range of possible future values with a certain confidence level.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: åˆç†çš„ç­”æ¡ˆæ˜¯ä½¿ç”¨**é¢„æµ‹åŒºé—´**ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ä¸€å®šçš„ç½®ä¿¡æ°´å¹³æŠ¥å‘Šä¸€ç³»åˆ—å¯èƒ½çš„æœªæ¥å€¼ã€‚
- en: While there are many methods for calculating prediction intervals, they are
    not applicable for all models and often rely on a particular distribution.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶æœ‰å¾ˆå¤šè®¡ç®—é¢„æµ‹åŒºé—´çš„æ–¹æ³•ï¼Œä½†å®ƒä»¬å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰æ¨¡å‹ï¼Œå¹¶ä¸”é€šå¸¸ä¾èµ–äºç‰¹å®šçš„åˆ†å¸ƒã€‚
- en: This comes with two major problems. First, the distribution assumption may not
    hold in certain scenarios. Second, we may be restricted in our choice of modeling
    techniques.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å¸¦æ¥äº†ä¸¤ä¸ªä¸»è¦é—®é¢˜ã€‚é¦–å…ˆï¼ŒæŸäº›æƒ…å†µä¸‹åˆ†å¸ƒå‡è®¾å¯èƒ½ä¸æˆç«‹ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬åœ¨å»ºæ¨¡æŠ€æœ¯çš„é€‰æ‹©ä¸Šå¯èƒ½å—åˆ°é™åˆ¶ã€‚
- en: For example, there are no straightforward ways to measuring prediction intervals
    for neural networks, but these models can possibly generate better predictions.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚ï¼Œç›®å‰æ²¡æœ‰ç®€å•çš„æ–¹æ³•æ¥æµ‹é‡ç¥ç»ç½‘ç»œçš„é¢„æµ‹åŒºé—´ï¼Œä½†è¿™äº›æ¨¡å‹å¯èƒ½ç”Ÿæˆæ›´å¥½çš„é¢„æµ‹ã€‚
- en: This is where **conformal predictions** come in. They represent a method of
    quantifying uncertainty in predictions that is both model-free and distribution-free.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°±æ˜¯**ä¿å½¢é¢„æµ‹**æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚å®ƒä»¬ä»£è¡¨äº†ä¸€ç§é‡åŒ–é¢„æµ‹ä¸ç¡®å®šæ€§çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ—¢ä¸ä¾èµ–äºæ¨¡å‹ï¼Œä¹Ÿä¸ä¾èµ–äºåˆ†å¸ƒã€‚
- en: In this article, we first explore the general idea behind conformal predictions
    and discover the **EnbPI** method for time series forecasting. Finally, we apply
    it in a small forecasting exercise.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ¢è®¨äº†ä¿å½¢é¢„æµ‹èƒŒåçš„åŸºæœ¬æ¦‚å¿µï¼Œå¹¶å‘ç°äº†ç”¨äºæ—¶é—´åºåˆ—é¢„æµ‹çš„**EnbPI**æ–¹æ³•ã€‚æœ€åï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªå°çš„é¢„æµ‹ç»ƒä¹ ä¸­åº”ç”¨å®ƒã€‚
- en: '***Learn the latest time series analysis techniques with my*** [***free time
    series cheat sheet***](https://www.datasciencewithmarco.com/pl/2147608294) ***in
    Python! Get the implementation of statistical and deep learning techniques, all
    in Python and TensorFlow!***'
  id: totrans-17
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***é€šè¿‡æˆ‘çš„*** [***å…è´¹æ—¶é—´åºåˆ—å¤‡å¿˜å•***](https://www.datasciencewithmarco.com/pl/2147608294)
    ***åœ¨ Python ä¸­å­¦ä¹ æœ€æ–°çš„æ—¶é—´åºåˆ—åˆ†ææŠ€æœ¯ï¼è·å–ç»Ÿè®¡å’Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„å®ç°ï¼Œå…¨éƒ¨ä½¿ç”¨ Python å’Œ TensorFlowï¼***'
- en: Letâ€™s get started!
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å¼€å§‹å§ï¼
- en: Quick overview of conformal predictions
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä¸€è‡´æ€§é¢„æµ‹çš„å¿«é€Ÿæ¦‚è¿°
- en: Conformal predictions represent an entire field of study to quantify uncertainty
    in predictions.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€è‡´æ€§é¢„æµ‹ä»£è¡¨äº†ä¸€ä¸ªç ”ç©¶é¢†åŸŸï¼Œç”¨äºé‡åŒ–é¢„æµ‹çš„ä¸ç¡®å®šæ€§ã€‚
- en: They are applied across various tasks like regression, binary classification,
    multilabel classification and time series forecasting.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒä»¬åº”ç”¨äºå›å½’ã€äºŒå…ƒåˆ†ç±»ã€å¤šæ ‡ç­¾åˆ†ç±»å’Œæ—¶é—´åºåˆ—é¢„æµ‹ç­‰å„ç§ä»»åŠ¡ã€‚
- en: The general idea behind conformal predictions is to generate a calibrated prediction
    interval, at a given confidence level, that guarantees that a point will lie inside
    it.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€è‡´æ€§é¢„æµ‹çš„åŸºæœ¬æ€æƒ³æ˜¯åœ¨ç»™å®šçš„ç½®ä¿¡æ°´å¹³ä¸‹ç”Ÿæˆä¸€ä¸ªæ ¡å‡†çš„é¢„æµ‹åŒºé—´ï¼Œä¿è¯ä¸€ä¸ªç‚¹å°†ä½äºå…¶ä¸­ã€‚
- en: In other words, with conformal predictions, you can create an 80% confidence
    interval that guarantees that the future real value will fall inside that interval
    80% of the time.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: æ¢å¥è¯è¯´ï¼Œä½¿ç”¨ä¸€è‡´æ€§é¢„æµ‹ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª 80% çš„ç½®ä¿¡åŒºé—´ï¼Œä¿è¯æœªæ¥çš„çœŸå®å€¼æœ‰ 80% çš„æ¦‚ç‡è½åœ¨è¿™ä¸ªåŒºé—´å†…ã€‚
- en: Unlike other methods of estimating predictions intervals, conformal predictions
    can be used with any modeling techniques. Plus, they do not assume a normal distribution,
    which is usually the case for statistical methods.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸å…¶ä»–é¢„æµ‹åŒºé—´ä¼°è®¡æ–¹æ³•ä¸åŒï¼Œä¸€è‡´æ€§é¢„æµ‹å¯ä»¥ä¸ä»»ä½•å»ºæ¨¡æŠ€æœ¯ä¸€èµ·ä½¿ç”¨ã€‚è€Œä¸”ï¼Œå®ƒä»¬ä¸å‡è®¾æ­£æ€åˆ†å¸ƒï¼Œè¿™é€šå¸¸æ˜¯ç»Ÿè®¡æ–¹æ³•çš„æƒ…å†µã€‚
- en: Conformal predictions for time series forecasting
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ—¶é—´åºåˆ—é¢„æµ‹çš„ä¸€è‡´æ€§é¢„æµ‹
- en: Now, most methods of conformal predictions for regressions tasks rely on the
    *exchangeability hypothesis*.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œå¤§å¤šæ•°ä¸€è‡´æ€§é¢„æµ‹æ–¹æ³•ç”¨äºå›å½’ä»»åŠ¡ä¾èµ–äº *äº¤æ¢æ€§å‡è®¾*ã€‚
- en: This means that the order in which data arrives does not impact inference.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ„å‘³ç€æ•°æ®åˆ°è¾¾çš„é¡ºåºä¸ä¼šå½±å“æ¨æ–­ã€‚
- en: While this holds true for many regression scenarios, it is obviously not applicable
    in the context of time series forecasting.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡è¿™ä¸€ç‚¹åœ¨è®¸å¤šå›å½’åœºæ™¯ä¸­æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¾ç„¶åœ¨æ—¶é—´åºåˆ—é¢„æµ‹çš„èƒŒæ™¯ä¸‹å¹¶ä¸é€‚ç”¨ã€‚
- en: We know that time series are points ordered in time and that order must remain
    intact. In other words, Monday must always come after Sunday and before Tuesday.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çŸ¥é“æ—¶é—´åºåˆ—æ˜¯æŒ‰æ—¶é—´æ’åºçš„ç‚¹ï¼Œè¿™ä¸€é¡ºåºå¿…é¡»ä¿æŒä¸å˜ã€‚æ¢å¥è¯è¯´ï¼Œæ˜ŸæœŸä¸€å¿…é¡»æ€»æ˜¯å‡ºç°åœ¨æ˜ŸæœŸå¤©ä¹‹åï¼Œæ˜ŸæœŸäºŒä¹‹å‰ã€‚
- en: Hence the need for a dedicated method for generating conformal prediction for
    time series.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: å› æ­¤ï¼Œéœ€è¦ä¸€ç§ä¸“é—¨çš„æ–¹æ³•æ¥ç”Ÿæˆæ—¶é—´åºåˆ—çš„ä¸€è‡´æ€§é¢„æµ‹ã€‚
- en: In 2020, researchers Chen Xu and Yao Xie presented the **En**semble **b**atch
    **P**rediction **I**ntervals (**EnbPI**) method in their article [Conformal prediction
    for time series](https://arxiv.org/pdf/2010.09107.pdf).
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ 2020 å¹´ï¼Œç ”ç©¶äººå‘˜é™ˆæ—­å’Œè‚–è€€åœ¨ä»–ä»¬çš„æ–‡ç«  [æ—¶é—´åºåˆ—çš„ä¸€è‡´æ€§é¢„æµ‹](https://arxiv.org/pdf/2010.09107.pdf)
    ä¸­ä»‹ç»äº† **En**semble **b**atch **P**rediction **I**ntervals (**EnbPI**) æ–¹æ³•ã€‚
- en: This method removes the data exchangeability requirement and can thus be applied
    in time series forecasting.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: è¯¥æ–¹æ³•å–æ¶ˆäº†æ•°æ®å¯äº¤æ¢æ€§çš„è¦æ±‚ï¼Œå› æ­¤å¯ä»¥åº”ç”¨äºæ—¶é—´åºåˆ—é¢„æµ‹ã€‚
- en: Explore the EnbPI method
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ¢ç´¢ EnbPI æ–¹æ³•
- en: The EnbPI algorithm is a general conformal prediction framework for time series.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: EnbPI ç®—æ³•æ˜¯ä¸€ä¸ªç”¨äºæ—¶é—´åºåˆ—çš„é€šç”¨ä¸€è‡´æ€§é¢„æµ‹æ¡†æ¶ã€‚
- en: At a high level, the EnbPI method is composed of a training phase and a prediction
    phase. The training phase is shown in blue, and the prediction phase is shown
    in green in the figure below.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ä»é«˜å±‚æ¬¡æ¥çœ‹ï¼ŒEnbPI æ–¹æ³•ç”±è®­ç»ƒé˜¶æ®µå’Œé¢„æµ‹é˜¶æ®µç»„æˆã€‚è®­ç»ƒé˜¶æ®µåœ¨ä¸‹é¢çš„å›¾ä¸­ç”¨è“è‰²è¡¨ç¤ºï¼Œè€Œé¢„æµ‹é˜¶æ®µç”¨ç»¿è‰²è¡¨ç¤ºã€‚
- en: '![](../Images/949d09f06dad7c5ad47d0172fe4ded23.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/949d09f06dad7c5ad47d0172fe4ded23.png)'
- en: High-level overview of the EnbPI method. Image by the author.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: EnbPI æ–¹æ³•çš„é«˜çº§æ¦‚è¿°ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚
- en: During the training phase, we fit a fixed number of *B* bootstrap models on
    non-overlapping subsets of the data. Usually, *B* is set to a value between 20
    and 50.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è®­ç»ƒé˜¶æ®µï¼Œæˆ‘ä»¬åœ¨æ•°æ®çš„éé‡å å­é›†ä¸Šæ‹Ÿåˆå›ºå®šæ•°é‡çš„*B*è‡ªåŠ©æ¨¡å‹ã€‚é€šå¸¸ï¼Œ*B* è®¾ç½®åœ¨ 20 åˆ° 50 ä¹‹é—´ã€‚
- en: Of course, the number of models that we can fit depends on the amount of data
    available, especially since the subsets cannot overlap.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‹Ÿåˆçš„æ¨¡å‹æ•°é‡å–å†³äºå¯ç”¨çš„æ•°æ®é‡ï¼Œå°¤å…¶æ˜¯å› ä¸ºå­é›†ä¸èƒ½é‡å ã€‚
- en: Then, the predictions from each *B* model are aggregated in a leave-one-out
    (LOO) fashion, resulting in both LOO residuals and LOO models for predictions.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæ¯ä¸ª *B* æ¨¡å‹çš„é¢„æµ‹ä»¥ç•™ä¸€æ³• (LOO) èšåˆï¼Œ resulting in both LOO residuals and LOO models
    for predictions.
- en: In the prediction phase, EnbPI uses each predictor to make a prediction on every
    single test data point. The predictions are aggregated to compute the center of
    the prediction interval. Then, using the residuals, prediction intervals are constructed
    using the quantiles from the residuals. The width is also optimized in the process,
    such that we get the narrowest width possible for a certain confidence level.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨é¢„æµ‹é˜¶æ®µï¼ŒEnbPI ä½¿ç”¨æ¯ä¸ªé¢„æµ‹å™¨å¯¹æ¯ä¸€ä¸ªæµ‹è¯•æ•°æ®ç‚¹è¿›è¡Œé¢„æµ‹ã€‚è¿™äº›é¢„æµ‹è¢«æ±‡æ€»ä»¥è®¡ç®—é¢„æµ‹åŒºé—´çš„ä¸­å¿ƒã€‚ç„¶åï¼Œä½¿ç”¨æ®‹å·®æ„å»ºé¢„æµ‹åŒºé—´ï¼Œå¹¶ä½¿ç”¨æ®‹å·®çš„åˆ†ä½æ•°è¿›è¡Œæ„å»ºã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå®½åº¦ä¹Ÿä¼šè¢«ä¼˜åŒ–ï¼Œä»¥ä¾¿åœ¨ç‰¹å®šç½®ä¿¡æ°´å¹³ä¸‹è·å¾—å°½å¯èƒ½æœ€çª„çš„å®½åº¦ã€‚
- en: Note that in the prediction phase, as new values are observed, the intervals
    are updated to ensure their adpativeness.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œåœ¨é¢„æµ‹é˜¶æ®µï¼Œéšç€æ–°å€¼çš„è§‚å¯Ÿï¼ŒåŒºé—´ä¼šè¢«æ›´æ–°ä»¥ç¡®ä¿å…¶é€‚åº”æ€§ã€‚
- en: Now that we understand how the EnbPI method can generate prediction intervals
    for any forecasting model, letâ€™s apply it in a small forecasting project using
    Python.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬äº†è§£äº† EnbPI æ–¹æ³•å¦‚ä½•ä¸ºä»»ä½•é¢„æµ‹æ¨¡å‹ç”Ÿæˆé¢„æµ‹åŒºé—´ï¼Œè®©æˆ‘ä»¬åœ¨ä¸€ä¸ªå°çš„é¢„æµ‹é¡¹ç›®ä¸­ä½¿ç”¨ Python åº”ç”¨å®ƒã€‚
- en: Apply EnbPI in forecasting
  id: totrans-44
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åº”ç”¨ EnbPI è¿›è¡Œé¢„æµ‹
- en: We are now ready to use the EnbPI method to generate prediction intervals for
    our forecasting model.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç°åœ¨å‡†å¤‡ä½¿ç”¨ EnbPI æ–¹æ³•ä¸ºæˆ‘ä»¬çš„é¢„æµ‹æ¨¡å‹ç”Ÿæˆé¢„æµ‹åŒºé—´ã€‚
- en: Luckily for us, the EnbPI algorithm is implemented and ready to use through
    the [MAPIE library](https://mapie.readthedocs.io/en/latest/), which stands for
    **M**odel **A**gnostic **P**rediction **I**nterval **E**stimator.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¸è¿çš„æ˜¯ï¼ŒEnbPI ç®—æ³•å·²ç»é€šè¿‡[MAPIE åº“](https://mapie.readthedocs.io/en/latest/)å®ç°å¹¶å‡†å¤‡ä½¿ç”¨ï¼Œè¯¥åº“ä»£è¡¨**M**odel
    **A**gnostic **P**rediction **I**nterval **E**stimatorã€‚
- en: Here, we use a dataset recording the daily visits to a websiteâ€™s blog, publicly
    available [here](https://github.com/marcopeix/time-series-analysis/blob/master/data/medium_views_published_holidays.csv).
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªè®°å½•ç½‘ç«™åšå®¢æ¯æ—¥è®¿é—®é‡çš„æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/marcopeix/time-series-analysis/blob/master/data/medium_views_published_holidays.csv)å…¬å¼€è·å–ã€‚
- en: As always, the entire source code for this project is available on [GitHub](https://github.com/marcopeix/time-series-analysis/blob/master/data/medium_views_published_holidays.csv).
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€å¦‚æ—¢å¾€ï¼Œæ•´ä¸ªé¡¹ç›®çš„æºä»£ç å¯ä»¥åœ¨[GitHub](https://github.com/marcopeix/time-series-analysis/blob/master/data/medium_views_published_holidays.csv)ä¸Šæ‰¾åˆ°ã€‚
- en: The natural first step is to make the necessary imports and read our data.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: è‡ªç„¶çš„ç¬¬ä¸€æ­¥æ˜¯è¿›è¡Œå¿…è¦çš„å¯¼å…¥å’Œè¯»å–æˆ‘ä»¬çš„æ•°æ®ã€‚
- en: '[PRE0]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![](../Images/2ec997fc130ee11aa1619f43de9cfbed.png)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2ec997fc130ee11aa1619f43de9cfbed.png)'
- en: First five rows of the dataset. Image by the author.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: æ•°æ®é›†çš„å‰äº”è¡Œã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: From the figure above, we see that our dataset contains a timestamp, the number
    of unique visitors, a flag to indicate if a new article was published or not,
    and a flag to indicate a national holiday.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ•°æ®é›†åŒ…å«æ—¶é—´æˆ³ã€å”¯ä¸€è®¿é—®è€…æ•°é‡ã€ä¸€ä¸ªæ ‡å¿—æ¥æŒ‡ç¤ºæ˜¯å¦å‘å¸ƒäº†æ–°æ–‡ç« ï¼Œä»¥åŠä¸€ä¸ªæ ‡å¿—æ¥æŒ‡ç¤ºæ˜¯å¦ä¸ºå›½å®¶å‡æ—¥ã€‚
- en: Since we will be applying a machine learning model, we need to construct some
    features. Specifically, we extract the year, month and day from the date. We also
    add a flag to indicate the weekend and add the past seven lagged values.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºæˆ‘ä»¬å°†åº”ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€äº›ç‰¹å¾ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä»æ—¥æœŸä¸­æå–å¹´ä»½ã€æœˆä»½å’Œæ—¥æœŸã€‚æˆ‘ä»¬è¿˜æ·»åŠ ä¸€ä¸ªæ ‡å¿—æ¥æŒ‡ç¤ºæ˜¯å¦ä¸ºå‘¨æœ«ï¼Œå¹¶æ·»åŠ è¿‡å»ä¸ƒä¸ªæ»åå€¼ã€‚
- en: '[PRE1]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![](../Images/fb9e34451685241862b53446ae0a330b.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/fb9e34451685241862b53446ae0a330b.png)'
- en: Dataset with engineered features. Image by the author.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: åŒ…å«å·¥ç¨‹ç‰¹å¾çš„æ•°æ®é›†ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: In the figure above, we notice that we have missing values. This is normal,
    since the first seven entries of the dataset do not have a complete list of seven
    past values.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°å­˜åœ¨ç¼ºå¤±å€¼ã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæ•°æ®é›†çš„å‰ä¸ƒä¸ªæ¡ç›®æ²¡æœ‰å®Œæ•´çš„ä¸ƒä¸ªè¿‡å»å€¼åˆ—è¡¨ã€‚
- en: We can either drop the first seven rows of data or use a model that can natively
    deal with missing data. In this case, I decided to use a [Histogram-based Gradient
    Boosting Regressor](https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.HistGradientBoostingRegressor.html),
    which natively supports data with missing values.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸¢å¼ƒå‰ä¸ƒè¡Œæ•°æ®ï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªå¯ä»¥åŸç”Ÿå¤„ç†ç¼ºå¤±æ•°æ®çš„æ¨¡å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å†³å®šä½¿ç”¨ä¸€ä¸ª[åŸºäºç›´æ–¹å›¾çš„æ¢¯åº¦æå‡å›å½’å™¨](https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.HistGradientBoostingRegressor.html)ï¼Œå®ƒåŸç”Ÿæ”¯æŒç¼ºå¤±å€¼çš„æ•°æ®ã€‚
- en: Finally, we split our data into a training and a test set. Here, I decided to
    reserve 112 time steps for the test set.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œæˆ‘ä»¬å°†æ•°æ®æ‹†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å†³å®šä¸ºæµ‹è¯•é›†ä¿ç•™112ä¸ªæ—¶é—´æ­¥ã€‚
- en: '[PRE2]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Optionally, we can visualize the split of our data resulting in the figure below.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: å¯é€‰åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å¯è§†åŒ–æ•°æ®çš„åˆ†å‰²ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
- en: '[PRE3]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![](../Images/d05e53bc8728cd7ed0e430053fd2308e.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d05e53bc8728cd7ed0e430053fd2308e.png)'
- en: Visualizing the train/test split. The last 112 time steps are reserved for the
    test set. Image by the author.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: å¯è§†åŒ–è®­ç»ƒ/æµ‹è¯•æ‹†åˆ†ã€‚æœ€å112ä¸ªæ—¶é—´æ­¥è¢«ä¿ç•™ä¸ºæµ‹è¯•é›†ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: Train a model
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è®­ç»ƒæ¨¡å‹
- en: Once the data is preprocessed and split, we can focus on training a forecasting
    model.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æ•°æ®ç»è¿‡é¢„å¤„ç†å’Œåˆ†å‰²ï¼Œæˆ‘ä»¬å¯ä»¥ä¸“æ³¨äºè®­ç»ƒé¢„æµ‹æ¨¡å‹ã€‚
- en: As mentioned, we implement here a histogram-based gradient boosting regressor.
    We also perform hyperparameter tuning to have the optimal model using random search.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå®ç°äº†åŸºäºç›´æ–¹å›¾çš„æ¢¯åº¦æå‡å›å½’å™¨ã€‚æˆ‘ä»¬è¿˜é€šè¿‡éšæœºæœç´¢è¿›è¡Œè¶…å‚æ•°è°ƒä¼˜ï¼Œä»¥è·å¾—æœ€ä½³æ¨¡å‹ã€‚
- en: '[PRE4]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Note that the best model is then saved using the `best_estimator_` attribute.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œæœ€ä½³æ¨¡å‹ä¼šä½¿ç”¨`best_estimator_`å±æ€§è¿›è¡Œä¿å­˜ã€‚
- en: Once we have an optimized model, we can now build prediction intervals using
    the EnbPI method.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æˆ‘ä»¬æœ‰äº†ä¼˜åŒ–åçš„æ¨¡å‹ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨EnbPIæ–¹æ³•æ„å»ºé¢„æµ‹åŒºé—´ã€‚
- en: Estimate prediction intervals
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä¼°è®¡é¢„æµ‹åŒºé—´
- en: First, we make the necessary imports for this step.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œæˆ‘ä»¬è¿›è¡Œè¿™ä¸€æ­¥æ‰€éœ€çš„å¿…è¦å¯¼å…¥ã€‚
- en: '[PRE5]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: To apply the EnbPI algorithm, we must use the `MapieTimeSeriesRegressor` object
    with `BlockBootstrap`. Remember that EnbPI fits a fixed number of models on non-overlapping
    blocks, and `BlockBootstrap` handles that for us.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: è¦åº”ç”¨EnbPIç®—æ³•ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨`MapieTimeSeriesRegressor`å¯¹è±¡ä¸`BlockBootstrap`ã€‚è¯·è®°ä½ï¼ŒEnbPIåœ¨ä¸é‡å çš„å—ä¸Šæ‹Ÿåˆå›ºå®šæ•°é‡çš„æ¨¡å‹ï¼Œè€Œ`BlockBootstrap`ä¼šä¸ºæˆ‘ä»¬å¤„ç†è¿™ä¸€ç‚¹ã€‚
- en: Then, to evaluate the quality of our prediction intervals, we use the coverage
    and mean width score. Coverage reports the percentage of actual values that fall
    inside the intervals. The mean width score simply reports the average width of
    confidence intervals.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œä¸ºäº†è¯„ä¼°æˆ‘ä»¬é¢„æµ‹åŒºé—´çš„è´¨é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨è¦†ç›–ç‡å’Œå¹³å‡å®½åº¦è¯„åˆ†ã€‚è¦†ç›–ç‡æŠ¥å‘Šå®é™…å€¼åœ¨åŒºé—´å†…çš„ç™¾åˆ†æ¯”ã€‚å¹³å‡å®½åº¦è¯„åˆ†åˆ™æŠ¥å‘Šç½®ä¿¡åŒºé—´çš„å¹³å‡å®½åº¦ã€‚
- en: In an ideal situation, we have the narrowest intervals possible achieving the
    highest coverage possible.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å°½å¯èƒ½ç‹­çª„çš„åŒºé—´ï¼Œä»è€Œå®ç°æœ€é«˜çš„è¦†ç›–ç‡ã€‚
- en: With all of that in mind, letâ€™s complete the setup to generate the intervals.
    Here, we wish to have 95% confidence intervals, and our model will make forecasts
    for the next time step.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: è€ƒè™‘åˆ°è¿™äº›ï¼Œè®©æˆ‘ä»¬å®Œæˆè®¾ç½®ä»¥ç”ŸæˆåŒºé—´ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰95%çš„ç½®ä¿¡åŒºé—´ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„æ¨¡å‹å°†å¯¹ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥è¿›è¡Œé¢„æµ‹ã€‚
- en: '[PRE6]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: In the code block above, note that we use `n_blocks=9` since the training set
    is divisible by 9\. Also, make sure to set `overlapping=False` as the EnbPI methods
    requires the blocks to be non-overlapping.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œè¯·æ³¨æ„æˆ‘ä»¬ä½¿ç”¨äº†`n_blocks=9`ï¼Œå› ä¸ºè®­ç»ƒé›†å¯ä»¥è¢«9æ•´é™¤ã€‚å¦å¤–ï¼Œè¯·ç¡®ä¿è®¾ç½®`overlapping=False`ï¼Œå› ä¸ºEnbPIæ–¹æ³•è¦æ±‚å—ä¸èƒ½é‡å ã€‚
- en: Then, the regression model is simply wrapped in the `MapieTimeSeriesRegressor`object,
    which we can then fit and use to make predictions.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œå°†å›å½’æ¨¡å‹ç®€å•åœ°å°è£…åœ¨`MapieTimeSeriesRegressor`å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œæ‹Ÿåˆå¹¶ç”¨æ¥è¿›è¡Œé¢„æµ‹ã€‚
- en: '[PRE7]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Now, we have access to both the predictions of the model and the confidence
    intervals. We can visualize them using the code block below.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®æ¨¡å‹çš„é¢„æµ‹ç»“æœå’Œç½®ä¿¡åŒºé—´ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç å—è¿›è¡Œå¯è§†åŒ–ã€‚
- en: '[PRE8]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](../Images/a76e4dd6ee638d14360ccd44801151ef.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a76e4dd6ee638d14360ccd44801151ef.png)'
- en: Forecasting with a 95% confidence interval using the EnbPI method. Image by
    the author.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨EnbPIæ–¹æ³•è¿›è¡Œ95%ç½®ä¿¡åŒºé—´çš„é¢„æµ‹ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: From the figure above, we can see that the model fails to predict the peaks
    in visitors. However, it seems that the prediction intervals contain the majority
    of the actual values.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¨¡å‹æœªèƒ½é¢„æµ‹å‡ºè®¿å®¢çš„å³°å€¼ã€‚ç„¶è€Œï¼Œé¢„æµ‹åŒºé—´ä¼¼ä¹åŒ…å«äº†å¤§å¤šæ•°å®é™…å€¼ã€‚
- en: To verify that, we can compute the coverage and mean interval width.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—è¦†ç›–ç‡å’Œå¹³å‡åŒºé—´å®½åº¦ã€‚
- en: '[PRE9]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Here, we get a coverage of 58% and a mean interval width of 432.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¾—åˆ°58%çš„è¦†ç›–ç‡å’Œ432çš„å¹³å‡åŒºé—´å®½åº¦ã€‚
- en: Again, in an ideal situation, the coverage should approach the value of 95%,
    since that was the probability that we set earlier. However, due to the model
    not being able to forecast those peaks, the coverage clearly suffered.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: å†æ¬¡å¼ºè°ƒï¼Œåœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œè¦†ç›–ç‡åº”è¯¥æ¥è¿‘95%çš„å€¼ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬ä¹‹å‰è®¾å®šçš„æ¦‚ç‡ã€‚ç„¶è€Œï¼Œç”±äºæ¨¡å‹æ— æ³•é¢„æµ‹è¿™äº›å³°å€¼ï¼Œè¦†ç›–ç‡æ˜¾ç„¶å—åˆ°äº†å½±å“ã€‚
- en: To potentially improve the coverage, letâ€™s implement the EnbPI method with partial
    fit so that the intervals can adapt as new values are observed.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†æ½œåœ¨æé«˜è¦†ç›–ç‡ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨éƒ¨åˆ†æ‹Ÿåˆå®ç°EnbPIæ–¹æ³•ï¼Œä»¥ä¾¿éšç€æ–°å€¼çš„è§‚å¯Ÿï¼ŒåŒºé—´å¯ä»¥è‡ªé€‚åº”ã€‚
- en: Apply EnbPI with partial fit
  id: totrans-93
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: åº”ç”¨EnbPIä¸éƒ¨åˆ†æ‹Ÿåˆ
- en: As we learned earlier, the EnbPI method can benefit from new observed values
    and tweak the confidence intervals accordingly.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€å­¦ï¼ŒEnbPIæ–¹æ³•å¯ä»¥ä»æ–°çš„è§‚å¯Ÿå€¼ä¸­å—ç›Šï¼Œå¹¶ç›¸åº”åœ°è°ƒæ•´ç½®ä¿¡åŒºé—´ã€‚
- en: This can be simulated by fitting the model on parts of data and computing the
    prediction intervals at each step.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å¯ä»¥é€šè¿‡åœ¨æ•°æ®çš„éƒ¨åˆ†ä¸Šæ‹Ÿåˆæ¨¡å‹å¹¶åœ¨æ¯ä¸€æ­¥è®¡ç®—é¢„æµ‹åŒºé—´æ¥æ¨¡æ‹Ÿã€‚
- en: '[PRE10]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: In the code block above, the logic remains identical. This time, we are simply
    doing a for loop to gradually fit the model on more data, simulating the fact
    that new data is being observed and generating a new prediction.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œé€»è¾‘ä¿æŒä¸å˜ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬åªæ˜¯åšä¸€ä¸ªforå¾ªç¯ï¼Œé€æ¸å°†æ¨¡å‹æ‹Ÿåˆåˆ°æ›´å¤šæ•°æ®ä¸Šï¼Œæ¨¡æ‹Ÿæ–°æ•°æ®çš„è§‚æµ‹ï¼Œå¹¶ç”Ÿæˆæ–°çš„é¢„æµ‹ã€‚
- en: Again, we can visualize the predictions and their confidence intervals.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¯è§†åŒ–é¢„æµ‹åŠå…¶ç½®ä¿¡åŒºé—´ã€‚
- en: '[PRE11]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](../Images/c425bbf7fcbdaccee49f1f2030bac12c.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c425bbf7fcbdaccee49f1f2030bac12c.png)'
- en: Conformal prediction intervals using partial fit. Image by the author.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨éƒ¨åˆ†æ‹Ÿåˆçš„ç¬¦åˆæ€§é¢„æµ‹åŒºé—´ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: Visually, from the figure above, it seems that using partial fit does not make
    a significant difference.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: ä»ä¸Šé¢çš„å›¾ä¸­å¯ä»¥ç›´è§‚åœ°çœ‹å‡ºï¼Œä½¿ç”¨éƒ¨åˆ†æ‹Ÿåˆå¹¶æ²¡æœ‰æ˜¾è‘—çš„å·®å¼‚ã€‚
- en: For that reason, letâ€™s compute the coverage and mean interval width for the
    partial fit protocol.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: å› æ­¤ï¼Œè®©æˆ‘ä»¬è®¡ç®—éƒ¨åˆ†æ‹Ÿåˆåè®®çš„è¦†ç›–ç‡å’Œå¹³å‡åŒºé—´å®½åº¦ã€‚
- en: '[PRE12]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: This gives us a coverage of 63% and an average interval width of 436.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç»™æˆ‘ä»¬å¸¦æ¥äº†63%çš„è¦†ç›–ç‡å’Œ436çš„å¹³å‡åŒºé—´å®½åº¦ã€‚
- en: '![](../Images/49f74b39cc090af0fd46607d2abdc8f9.png)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/49f74b39cc090af0fd46607d2abdc8f9.png)'
- en: Comparing the coverage and mean interval width for each protocol. Image by the
    author.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯”è¾ƒæ¯ä¸ªåè®®çš„è¦†ç›–ç‡å’Œå¹³å‡åŒºé—´å®½åº¦ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: From the figure above, we can see that using partial fit allows us to increase
    the coverage while keeping the mean interval width fairly constant. Therefore,
    there is an advantage in using partial fit in this situation.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨éƒ¨åˆ†æ‹Ÿåˆå…è®¸æˆ‘ä»¬åœ¨ä¿æŒå¹³å‡åŒºé—´å®½åº¦ç›¸å¯¹æ’å®šçš„åŒæ—¶å¢åŠ è¦†ç›–ç‡ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨éƒ¨åˆ†æ‹Ÿåˆæ˜¯æœ‰ä¼˜åŠ¿çš„ã€‚
- en: Conclusion
  id: totrans-109
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: In this article we learned that conformal predictions group methodologies to
    estimate uncertainty in predictions. They can be applied for both classification
    and regression algorithms.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°ï¼Œç¬¦åˆæ€§é¢„æµ‹æ–¹æ³•ç”¨äºä¼°è®¡é¢„æµ‹çš„ä¸ç¡®å®šæ€§ã€‚è¿™äº›æ–¹æ³•å¯ä»¥åº”ç”¨äºåˆ†ç±»å’Œå›å½’ç®—æ³•ã€‚
- en: In the case of time series, the Ensemble Prediction Interval method fits a fixed
    number of models over non-overlapping blocks of data to get the residuals and
    estimate the confidence bounds from their distribution.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ—¶é—´åºåˆ—çš„æƒ…å†µä¸‹ï¼Œé›†æˆé¢„æµ‹åŒºé—´æ–¹æ³•é€šè¿‡åœ¨ä¸é‡å çš„æ•°æ®å—ä¸Šæ‹Ÿåˆå›ºå®šæ•°é‡çš„æ¨¡å‹æ¥è·å¾—æ®‹å·®ï¼Œå¹¶ä»å…¶åˆ†å¸ƒä¸­ä¼°è®¡ç½®ä¿¡ç•Œé™ã€‚
- en: To evaluate the quality of our intervals, we use the coverage and mean interval
    width. The coverage indicates the percentage of true values that fall inside the
    intervals. Ideally, this value should approach the confidence set by the user,
    while minimizing the width of the interval.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†è¯„ä¼°æˆ‘ä»¬åŒºé—´çš„è´¨é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨è¦†ç›–ç‡å’Œå¹³å‡åŒºé—´å®½åº¦ã€‚è¦†ç›–ç‡è¡¨ç¤ºçœŸå®å€¼è½åœ¨åŒºé—´å†…çš„ç™¾åˆ†æ¯”ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼åº”è¯¥æ¥è¿‘ç”¨æˆ·è®¾å®šçš„ç½®ä¿¡åº¦ï¼ŒåŒæ—¶æœ€å°åŒ–åŒºé—´å®½åº¦ã€‚
- en: As we have seen, this is not always the case, as it also depends on the quality
    of the predictions of the model.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œè¿™ç§æƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ï¼Œå› ä¸ºå®ƒè¿˜å–å†³äºæ¨¡å‹é¢„æµ‹çš„è´¨é‡ã€‚
- en: Still, thanks to MAPIE, we can generate conformal prediction intervals for virtually
    any model.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡å¦‚æ­¤ï¼Œæ„Ÿè°¢MAPIEï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå‡ ä¹ä»»ä½•æ¨¡å‹ç”Ÿæˆç¬¦åˆæ€§é¢„æµ‹åŒºé—´ã€‚
- en: Thanks for reading! I hope that you enjoyed it and that you learned something
    new!
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: æ„Ÿè°¢é˜…è¯»ï¼å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œå¹¶ä¸”å­¦åˆ°äº†æ–°ä¸œè¥¿ï¼
- en: Looking to master time series forecasting? Then check out my course [Applied
    Time Series Forecasting in Python](https://www.datasciencewithmarco.com/offers/zTAs2hi6/checkout?coupon_code=ATSFP10).
    This is the only course that uses Python to implement statistical, deep learning
    and state-of-the-art models in 16 guided hands-on projects.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: æƒ³è¦æŒæ¡æ—¶é—´åºåˆ—é¢„æµ‹å—ï¼Ÿé‚£ä¹ˆè¯·æŸ¥çœ‹æˆ‘çš„è¯¾ç¨‹ [Pythonä¸­çš„åº”ç”¨æ—¶é—´åºåˆ—é¢„æµ‹](https://www.datasciencewithmarco.com/offers/zTAs2hi6/checkout?coupon_code=ATSFP10)ã€‚è¿™æ˜¯å”¯ä¸€ä¸€é—¨ä½¿ç”¨Pythonåœ¨16ä¸ªæŒ‡å¯¼æ€§å®è·µé¡¹ç›®ä¸­å®ç°ç»Ÿè®¡ã€æ·±åº¦å­¦ä¹ å’Œæœ€å…ˆè¿›æ¨¡å‹çš„è¯¾ç¨‹ã€‚
- en: Cheers ğŸ»
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: å¹²æ¯ ğŸ»
- en: Support me
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ”¯æŒæˆ‘
- en: Enjoying my work? Show your support with [Buy me a coffee](http://buymeacoffee.com/dswm),
    a simple way for you to encourage me, and I get to enjoy a cup of coffee! If you
    feel like it, just click the button below ğŸ‘‡
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: å–œæ¬¢æˆ‘çš„å·¥ä½œå—ï¼Ÿé€šè¿‡ [ä¹°æˆ‘ä¸€æ¯å’–å•¡](http://buymeacoffee.com/dswm) æ”¯æŒæˆ‘ï¼Œè¿™æ˜¯ä½ é¼“åŠ±æˆ‘çš„ç®€å•æ–¹å¼ï¼ŒåŒæ—¶æˆ‘å¯ä»¥äº«å—ä¸€æ¯å’–å•¡ï¼å¦‚æœä½ æ„¿æ„ï¼Œåªéœ€ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®
    ğŸ‘‡
- en: '[![](../Images/79199b76a90721439ab41d9e1afcfb58.png)](https://www.buymeacoffee.com/dswm)'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '[![](../Images/79199b76a90721439ab41d9e1afcfb58.png)](https://www.buymeacoffee.com/dswm)'
- en: References
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å‚è€ƒæ–‡çŒ®
- en: Chen Xu, Yao Xie â€” [Conformal Predictions for Time Series](https://arxiv.org/pdf/2010.09107.pdf)
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: é™ˆæ—­ï¼Œè‚–å§š â€” [æ—¶é—´åºåˆ—çš„ç¬¦åˆæ€§é¢„æµ‹](https://arxiv.org/pdf/2010.09107.pdf)
- en: 'MAPIE: [official documentation](https://mapie.readthedocs.io/en/latest/)'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 'MAPIE: [å®˜æ–¹æ–‡æ¡£](https://mapie.readthedocs.io/en/latest/)'
