- en: How To Install A Private Docker Container Registry In Kubernetes
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¦‚ä½•åœ¨ Kubernetes ä¸­å®‰è£…ç§æœ‰ Docker å®¹å™¨æ³¨å†Œè¡¨
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/how-to-install-a-private-docker-container-registry-in-kubernetes-eadcfd6e0f27](https://towardsdatascience.com/how-to-install-a-private-docker-container-registry-in-kubernetes-eadcfd6e0f27)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/how-to-install-a-private-docker-container-registry-in-kubernetes-eadcfd6e0f27](https://towardsdatascience.com/how-to-install-a-private-docker-container-registry-in-kubernetes-eadcfd6e0f27)
- en: Get full control of where your images are stored
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å®Œå…¨æ§åˆ¶ä½ å›¾åƒå­˜å‚¨çš„ä½ç½®
- en: '[](https://medium.knulst.de/?source=post_page-----eadcfd6e0f27--------------------------------)[![Paul
    Knulst](../Images/9fcb767d927a1fe53ee739c584fdf92c.png)](https://medium.knulst.de/?source=post_page-----eadcfd6e0f27--------------------------------)[](https://towardsdatascience.com/?source=post_page-----eadcfd6e0f27--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----eadcfd6e0f27--------------------------------)
    [Paul Knulst](https://medium.knulst.de/?source=post_page-----eadcfd6e0f27--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.knulst.de/?source=post_page-----eadcfd6e0f27--------------------------------)[![Paul
    Knulst](../Images/9fcb767d927a1fe53ee739c584fdf92c.png)](https://medium.knulst.de/?source=post_page-----eadcfd6e0f27--------------------------------)[](https://towardsdatascience.com/?source=post_page-----eadcfd6e0f27--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----eadcfd6e0f27--------------------------------)
    [Paul Knulst](https://medium.knulst.de/?source=post_page-----eadcfd6e0f27--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----eadcfd6e0f27--------------------------------)
    Â·7 min readÂ·Feb 1, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----eadcfd6e0f27--------------------------------)
    Â·é˜…è¯»æ—¶é—´ 7 åˆ†é’ŸÂ·2023å¹´2æœˆ1æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/7845977d57ebf55058ab85daf608d88c.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7845977d57ebf55058ab85daf608d88c.png)'
- en: Photo by [Growtika](https://unsplash.com/@growtika?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/wLknZfsKmxQ?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ç…§ç‰‡ç”± [Growtika](https://unsplash.com/@growtika?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    æä¾›ï¼ŒåˆŠç™»åœ¨ [Unsplash](https://unsplash.com/photos/wLknZfsKmxQ?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
- en: Introduction
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä»‹ç»
- en: Hosting a Docker private registry gives you full control over the storage location
    of your images and how you can access them. This is especially useful if you develop
    private projects that shouldnâ€™t be publicly on Docker Hub.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰˜ç®¡ä¸€ä¸ª Docker ç§æœ‰æ³¨å†Œè¡¨ä½¿ä½ å¯ä»¥å®Œå…¨æ§åˆ¶å›¾åƒçš„å­˜å‚¨ä½ç½®ä»¥åŠå¦‚ä½•è®¿é—®å®ƒä»¬ã€‚å¦‚æœä½ å¼€å‘çš„æ˜¯ä¸åº”å…¬å¼€åœ¨ Docker Hub ä¸Šçš„ç§äººé¡¹ç›®ï¼Œè¿™ä¸€ç‚¹å°¤ä¸ºæœ‰ç”¨ã€‚
- en: In this tutorial, you will learn how to install a private Docker registry in
    any Kubernetes cluster. It is a [follow-up of a tutorial previously released on
    this blog](https://www.paulsblog.dev/how-to-install-traefik-ingress-controller-in-kubernetes/)
    because it will use a Traefik Ingress Controller to expose the Docker registry.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•åœ¨ä»»ä½• Kubernetes é›†ç¾¤ä¸­å®‰è£…ä¸€ä¸ªç§æœ‰ Docker æ³¨å†Œè¡¨ã€‚è¿™æ˜¯ [ä¹‹å‰åœ¨æœ¬åšå®¢å‘å¸ƒçš„æ•™ç¨‹çš„åç»­å†…å®¹](https://www.paulsblog.dev/how-to-install-traefik-ingress-controller-in-kubernetes/)ï¼Œå› ä¸ºå®ƒå°†ä½¿ç”¨
    Traefik Ingress Controller æ¥æš´éœ² Docker æ³¨å†Œè¡¨ã€‚
- en: Preparation
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å‡†å¤‡å·¥ä½œ
- en: Create Kubernetes Namespace
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: åˆ›å»º Kubernetes å‘½åç©ºé—´
- en: 'The first step is to create a Kubernetes namespace where all resources will
    be applied during this tutorial:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ª Kubernetes å‘½åç©ºé—´ï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­æ‰€æœ‰èµ„æºéƒ½å°†åœ¨è¯¥å‘½åç©ºé—´ä¸­åº”ç”¨ï¼š
- en: '[PRE0]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: PersistentVolumeClaim
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: PersistentVolumeClaim
- en: In this section, you will mount a volume into a dedicated Kubernetes Pod using
    a PersistentVolumeClaim. A PersistentVolumeClaim (`PVC`) is a Kubernetes resource
    to use a pre-defined abstract PersistentVolume (`PV`) storage without exposing
    how those volumes are implemented.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬èŠ‚ä¸­ï¼Œä½ å°†ä½¿ç”¨ PersistentVolumeClaim å°†ä¸€ä¸ªå·æŒ‚è½½åˆ°ä¸€ä¸ªä¸“ç”¨çš„ Kubernetes Pod ä¸­ã€‚PersistentVolumeClaimï¼ˆ`PVC`ï¼‰æ˜¯ä¸€ä¸ª
    Kubernetes èµ„æºï¼Œç”¨äºä½¿ç”¨é¢„å®šä¹‰çš„æŠ½è±¡ PersistentVolumeï¼ˆ`PV`ï¼‰å­˜å‚¨ï¼Œè€Œä¸æš´éœ²è¿™äº›å·æ˜¯å¦‚ä½•å®ç°çš„ã€‚
- en: ğŸ’¡ **Prerequisite:** *A PersistentVolume should exist within the Kubernetes cluster.
    A PersistentVolume (*`*PV*`*) is a storage definition that was either manually
    provisioned by a user or dynamically provisioned using a storage class.* [*See
    this link for further information*](https://kubernetes.io/docs/concepts/storage/persistent-volumes/)*.*
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ’¡ **å‰ææ¡ä»¶ï¼š** *Kubernetes é›†ç¾¤ä¸­åº”è¯¥å­˜åœ¨ä¸€ä¸ª PersistentVolumeã€‚PersistentVolumeï¼ˆ`*PV*`ï¼‰æ˜¯ä¸€ä¸ªå­˜å‚¨å®šä¹‰ï¼Œå¯ä»¥æ˜¯ç”¨æˆ·æ‰‹åŠ¨é…ç½®çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨å­˜å‚¨ç±»åŠ¨æ€é…ç½®çš„ã€‚*
    [*æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æ­¤é“¾æ¥*](https://kubernetes.io/docs/concepts/storage/persistent-volumes/)*ã€‚*
- en: To set up the PersistentVolumeClaim that will be used in the private Docker
    registry, this tutorial will assume that you already have a preconfigured PersistentVolume
    called `csi-cinder-classic`.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†è®¾ç½®å°†åœ¨ç§æœ‰ Docker æ³¨å†Œè¡¨ä¸­ä½¿ç”¨çš„ PersistentVolumeClaimï¼Œæœ¬æ•™ç¨‹å‡è®¾ä½ å·²ç»æœ‰ä¸€ä¸ªé¢„é…ç½®çš„ PersistentVolumeï¼Œåç§°ä¸º
    `csi-cinder-classic`ã€‚
- en: '1\. Create a new file (`registry-pvc.yaml`) containing the PersistentVolumeClaim
    using the `csi-cinder-classic` storage class:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼ˆ`registry-pvc.yaml`ï¼‰ï¼ŒåŒ…å«ä½¿ç”¨ `csi-cinder-classic` å­˜å‚¨ç±»çš„ PersistentVolumeClaimï¼š
- en: '[PRE1]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '2\. Apply it to the Kubernetes Cluster:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. å°†å…¶åº”ç”¨åˆ° Kubernetes é›†ç¾¤ï¼š
- en: '[PRE2]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '3\. Verify if the persistent volume claim was successfully created:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. éªŒè¯æŒä¹…å·å£°æ˜æ˜¯å¦æˆåŠŸåˆ›å»ºï¼š
- en: '[PRE3]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Set Up Docker Registry
  id: totrans-25
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è®¾ç½® Docker Registry
- en: Now, that you have created the namespace and the PersistentVolumeClaim you can
    deploy a Docker registry using the external storage and make the registry available
    across the entire Kubernetes cluster.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œä½ å·²åˆ›å»ºäº†å‘½åç©ºé—´å’Œ PersistentVolumeClaimï¼Œå¯ä»¥ä½¿ç”¨å¤–éƒ¨å­˜å‚¨éƒ¨ç½² Docker registryï¼Œå¹¶ä½¿å…¶åœ¨æ•´ä¸ª Kubernetes
    é›†ç¾¤ä¸­å¯ç”¨ã€‚
- en: Generate User & Password
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç”Ÿæˆç”¨æˆ·ä¸å¯†ç 
- en: To set up the Docker registry, you need to generate a user and password that
    will be used to push and pull images to the registry.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: è¦è®¾ç½® Docker registryï¼Œä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªç”¨æˆ·å’Œå¯†ç ï¼Œç”¨äºæ¨é€å’Œæ‹‰å–é•œåƒåˆ° registryã€‚
- en: 'Create a new file `gen-pass.sh` that contains the following content:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ `gen-pass.sh`ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
- en: '[PRE4]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: ğŸ’¡ **Note:** *Change REGISTRY_USER and REGISTRY_PASS to your needs. Also, since*
    `*htpasswd*` *was removed from the latest Docker images we will be using version
    2.7.0 to generate the user and password. For more information* [*have a look at
    this stack overflow post*](https://stackoverflow.com/questions/62531462/docker-local-registry-exec-htpasswd-executable-file-not-found-in-path)*.*
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ’¡ **æ³¨æ„ï¼š** *æ ¹æ®éœ€è¦æ›´æ”¹ REGISTRY_USER å’Œ REGISTRY_PASSã€‚æ­¤å¤–ï¼Œç”±äº`*htpasswd*` *åœ¨æœ€æ–°çš„ Docker
    é•œåƒä¸­å·²è¢«ç§»é™¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç‰ˆæœ¬ 2.7.0 æ¥ç”Ÿæˆç”¨æˆ·å’Œå¯†ç ã€‚æ›´å¤šä¿¡æ¯* [*è¯·æŸ¥çœ‹è¿™ä¸ª stack overflow æ–‡ç« *](https://stackoverflow.com/questions/62531462/docker-local-registry-exec-htpasswd-executable-file-not-found-in-path)*ã€‚*
- en: 'Execute the script which will create the credentials within the subfolder `./registry-creds`:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰§è¡Œè„šæœ¬ï¼Œè¿™å°†åˆ›å»ºåœ¨å­æ–‡ä»¶å¤¹ `./registry-creds` ä¸­çš„å‡­æ®ï¼š
- en: '[PRE5]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Install Docker Registry Using Helm
  id: totrans-34
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ Helm å®‰è£… Docker Registry
- en: In the following steps, you will use Helm to install the Docker registry.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ï¼Œä½ å°†ä½¿ç”¨ Helm å®‰è£… Docker registryã€‚
- en: ğŸ’¡ **Note:** *Helm is the package manager for Kubernetes, focused on automating
    the installation of all kinds of Kubernetes applications.*
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ’¡ **æ³¨æ„ï¼š** *Helm æ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨ï¼Œä¸“æ³¨äºè‡ªåŠ¨åŒ–å®‰è£…å„ç§ Kubernetes åº”ç”¨ç¨‹åºã€‚*
- en: '1\. Add the `twuni/docker-registry` Helm repository that is a successor of
    the official Docker registry:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. æ·»åŠ  `twuni/docker-registry` Helm ä»“åº“ï¼Œè¯¥ä»“åº“æ˜¯å®˜æ–¹ Docker registry çš„ç»§ä»»è€…ï¼š
- en: '[PRE6]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '2\. Update local Helm chart repository cache:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. æ›´æ–°æœ¬åœ° Helm å›¾è¡¨ä»“åº“ç¼“å­˜ï¼š
- en: '[PRE7]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '3\. Search for the latest version of `twuni/docker-registry` Helm chart version:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. æœç´¢ `twuni/docker-registry` Helm å›¾è¡¨çš„æœ€æ–°ç‰ˆæœ¬ï¼š
- en: '[PRE8]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '4\. Create a `registry-chart.yaml` which will be used to install the Docker
    registry in our Kubernetes cluster:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 4\. åˆ›å»ºä¸€ä¸ª `registry-chart.yaml` æ–‡ä»¶ï¼Œç”¨äºåœ¨æˆ‘ä»¬çš„ Kubernetes é›†ç¾¤ä¸­å®‰è£… Docker registryï¼š
- en: '[PRE9]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: ğŸ’¡**Note:** *Replace the* `*htpasswd*` *string with the content of the file that
    was generated by the* `*gen-pass.sh*` *script (*`*./registry-cred/htpasswd*`*)*
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ’¡**æ³¨æ„ï¼š** *å°†* `*htpasswd*` *å­—ç¬¦ä¸²æ›¿æ¢ä¸ºç”±* `*gen-pass.sh*` *è„šæœ¬ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹ (*`*./registry-cred/htpasswd*`*)*
- en: '5\. Install the Docker registry Helm chart using the `registry-chart.yaml`:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 5\. ä½¿ç”¨ `registry-chart.yaml` å®‰è£… Docker registry Helm å›¾è¡¨ï¼š
- en: '[PRE10]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '6\. Verify installation:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 6\. éªŒè¯å®‰è£…ï¼š
- en: '[PRE11]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'If you want to change something like the `replicaCount`, the `htpasswd` or
    the storage, you can do this by adjusting the `registry-chart.yaml` and reapply
    it by executing:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æƒ³æ›´æ”¹åƒ `replicaCount`ã€`htpasswd` æˆ–å­˜å‚¨ä¹‹ç±»çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´ `registry-chart.yaml` æ¥å®Œæˆï¼Œå¹¶é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°åº”ç”¨ï¼š
- en: '[PRE12]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: How To Uninstall?
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¦‚ä½•å¸è½½ï¼Ÿ
- en: 'To uninstall the Docker registry, you have to remove it from the Kubernetes
    cluster with Helm:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: è¦å¸è½½ Docker registryï¼Œä½ éœ€è¦ä½¿ç”¨ Helm å°†å…¶ä» Kubernetes é›†ç¾¤ä¸­ç§»é™¤ï¼š
- en: '[PRE13]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Then remove the Docker registry namespace from the Kubernetes cluster:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åä» Kubernetes é›†ç¾¤ä¸­åˆ é™¤ Docker registry å‘½åç©ºé—´ï¼š
- en: '[PRE14]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Add Docker Registry Ingress
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ·»åŠ  Docker Registry Ingress
- en: To expose the Docker registry, you will use Traefik Ingress Controller to allow
    access to the registry through HTTPS with a proper TLS certificate.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: è¦æš´éœ² Docker registryï¼Œä½ å°†ä½¿ç”¨ Traefik Ingress Controller é€šè¿‡ HTTPS å’Œé€‚å½“çš„ TLS è¯ä¹¦æ¥å…è®¸è®¿é—®
    registryã€‚
- en: ğŸ’¡**Note:** *Read about how to install Traefik Ingress Controller in any Kubernetes
    cluster within this tutorial:* [*https://www.paulsblog.dev/how-to-install-traefik-ingress-controller-in-kubernetes/*](https://www.paulsblog.dev/how-to-install-traefik-ingress-controller-in-kubernetes/)
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ’¡**æ³¨æ„ï¼š** *è¯·é˜…è¯»å…³äºå¦‚ä½•åœ¨ä»»ä½• Kubernetes é›†ç¾¤ä¸­å®‰è£… Traefik Ingress Controller çš„æ•™ç¨‹ï¼š* [*https://www.paulsblog.dev/how-to-install-traefik-ingress-controller-in-kubernetes/*](https://www.paulsblog.dev/how-to-install-traefik-ingress-controller-in-kubernetes/)
- en: '1\. Create a new file (`ingressroute.yaml`) and make sure to replace YOUR_DOMAIN
    with your Docker registry domain:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼ˆ`ingressroute.yaml`ï¼‰ï¼Œå¹¶ç¡®ä¿å°† YOUR_DOMAIN æ›¿æ¢ä¸ºä½ çš„ Docker registry åŸŸåï¼š
- en: '[PRE15]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '2\. Apply the IngressRoute by executing:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. é€šè¿‡æ‰§è¡Œæ¥åº”ç”¨ IngressRouteï¼š
- en: '[PRE16]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '3\. Verify if the Kubernetes resource was successfully created:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. éªŒè¯Kubernetesèµ„æºæ˜¯å¦æˆåŠŸåˆ›å»ºï¼š
- en: '[PRE17]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Push Images To Private Registry In Kubernetes Cluster
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å°†é•œåƒæ¨é€åˆ°Kubernetesé›†ç¾¤ä¸­çš„ç§æœ‰æ³¨å†Œè¡¨
- en: To show how to push a Docker Image to our new Docker registry, this tutorial
    will show how to pull a public Docker Hub image, tag it, and then push it to your
    registry.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†å±•ç¤ºå¦‚ä½•å°†Dockeré•œåƒæ¨é€åˆ°æˆ‘ä»¬çš„æ–°Dockeræ³¨å†Œè¡¨ï¼Œæœ¬æ•™ç¨‹å°†å±•ç¤ºå¦‚ä½•æ‹‰å–ä¸€ä¸ªå…¬å…±çš„Docker Hubé•œåƒï¼Œå¯¹å…¶è¿›è¡Œæ ‡è®°ï¼Œç„¶åå°†å…¶æ¨é€åˆ°ä½ çš„æ³¨å†Œè¡¨ã€‚
- en: 1\. Log in to the Docker registry by using the previously created credentials
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. ä½¿ç”¨å…ˆå‰åˆ›å»ºçš„å‡­æ®ç™»å½•Dockeræ³¨å†Œè¡¨
- en: '[PRE18]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '2\. Pull the `nginx:latest` Docker image:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. æ‹‰å–`nginx:latest` Dockeré•œåƒï¼š
- en: '[PRE19]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 3\. Tag the image with a custom name and prepend the private Docker registry
    domain name
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. ç”¨è‡ªå®šä¹‰åç§°æ ‡è®°é•œåƒï¼Œå¹¶åœ¨å‰é¢åŠ ä¸Šç§æœ‰Dockeræ³¨å†Œè¡¨åŸŸå
- en: '[PRE20]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 4\. Push the Docker Image to the registry
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 4\. å°†Dockeré•œåƒæ¨é€åˆ°æ³¨å†Œè¡¨
- en: '[PRE21]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Use Docker Registry To Pull Images In Your Kubernetes Cluster
  id: totrans-76
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä½¿ç”¨Dockeræ³¨å†Œè¡¨åœ¨Kubernetesé›†ç¾¤ä¸­æ‹‰å–é•œåƒ
- en: As you have a Docker registry deployed in your Kubernetes cluster, you can start
    using it by pulling previously pushed images for your Kubernetes Pods.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºä½ åœ¨Kubernetesé›†ç¾¤ä¸­éƒ¨ç½²äº†Dockeræ³¨å†Œè¡¨ï¼Œä½ å¯ä»¥é€šè¿‡æ‹‰å–ä¹‹å‰æ¨é€çš„é•œåƒæ¥å¼€å§‹ä½¿ç”¨å®ƒï¼Œä¸ºä½ çš„Kubernetes Podsã€‚
- en: To learn how a private Docker registry can be used for pulling images, you will
    create a simple Kubernetes pod in a new `test` namespace. This Kubernetes Pod
    will use the previously pushed image `YOUR_DOMAIN/my-nginx`.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: è¦äº†è§£å¦‚ä½•ä½¿ç”¨ç§æœ‰Dockeræ³¨å†Œè¡¨æ‹‰å–é•œåƒï¼Œä½ å°†åˆ›å»ºä¸€ä¸ªæ–°çš„`test`å‘½åç©ºé—´ä¸­çš„ç®€å•Kubernetes podã€‚è¿™ä¸ªKubernetes Podå°†ä½¿ç”¨ä¹‹å‰æ¨é€çš„é•œåƒ`YOUR_DOMAIN/my-nginx`ã€‚
- en: 'First, you have to create the `test` Kubernetes namespace:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œä½ å¿…é¡»åˆ›å»º`test` Kuberneteså‘½åç©ºé—´ï¼š
- en: '[PRE22]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Create Docker Registry Secret
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: åˆ›å»ºDockeræ³¨å†Œè¡¨Secret
- en: '**This is the most important step!**'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '**è¿™æ˜¯æœ€é‡è¦çš„ä¸€æ­¥ï¼**'
- en: 'You have to create a Docker Secret for accessing the Docker registry from your
    Kubernetes cluster. To do this, use the credentials from the previous step and
    create a Kubernetes Docker Secret in the `test` namespace:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¿…é¡»åˆ›å»ºä¸€ä¸ªDocker Secretï¼Œä»¥ä¾¿ä»Kubernetesé›†ç¾¤è®¿é—®Dockeræ³¨å†Œè¡¨ã€‚ä¸ºæ­¤ï¼Œä½¿ç”¨ä¸Šä¸€æ­¥çš„å‡­æ®ï¼Œåœ¨`test`å‘½åç©ºé—´ä¸­åˆ›å»ºä¸€ä¸ªKubernetes
    Docker Secretï¼š
- en: '[PRE23]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'ğŸ’¡ **Note: This Kubernetes Docker secret resource must be** *created within
    the correct namespace!*'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ’¡ **æ³¨æ„ï¼šè¿™ä¸ªKubernetes Docker secretèµ„æºå¿…é¡»** *åœ¨æ­£ç¡®çš„å‘½åç©ºé—´ä¸­åˆ›å»ºï¼*
- en: Create Kubernetes Pod With Image From Docker Registry
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä½¿ç”¨Dockeræ³¨å†Œè¡¨ä¸­çš„é•œåƒåˆ›å»ºKubernetes Pod
- en: 'After the Kubernetes secret containing the credentials for the Docker registry
    is created, you create a new Kubernetes Deployment (`test-nginx.yaml`) that uses
    your registry:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨åˆ›å»ºåŒ…å«Dockeræ³¨å†Œè¡¨å‡­æ®çš„Kubernetes secretåï¼Œä½ åˆ›å»ºä¸€ä¸ªæ–°çš„Kubernetes Deploymentï¼ˆ`test-nginx.yaml`ï¼‰ï¼Œè¯¥Deploymentä½¿ç”¨ä½ çš„æ³¨å†Œè¡¨ï¼š
- en: '[PRE24]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: If taking a close look at this file, you will see that it contains three essential
    differences from a normal `nginx` deployment.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä»”ç»†æŸ¥çœ‹æ­¤æ–‡ä»¶ï¼Œä½ ä¼šå‘ç°å®ƒä¸æ­£å¸¸çš„`nginx`éƒ¨ç½²æœ‰ä¸‰ä¸ªåŸºæœ¬çš„ä¸åŒä¹‹å¤„ã€‚
- en: '`image: YOUR_DOMAIN/my-nginx`'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`image: YOUR_DOMAIN/my-nginx`'
- en: '`imagePullSecrets: - name: regred`'
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`imagePullSecrets: - name: regred`'
- en: Both changes are necessary to use the Docker registry. The first option selects
    the image to use in the pod (registry URL as a prefix + image name). The second
    option sets which Docker secret is used to pull the image. If you changed credentials
    or names, you have to update both values.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸¤ä¸ªæ›´æ”¹éƒ½æ˜¯ä½¿ç”¨Dockeræ³¨å†Œè¡¨æ‰€å¿…éœ€çš„ã€‚ç¬¬ä¸€ä¸ªé€‰é¡¹é€‰æ‹©è¦åœ¨podä¸­ä½¿ç”¨çš„é•œåƒï¼ˆæ³¨å†Œè¡¨URLä½œä¸ºå‰ç¼€+é•œåƒåç§°ï¼‰ã€‚ç¬¬äºŒä¸ªé€‰é¡¹è®¾ç½®ç”¨äºæ‹‰å–é•œåƒçš„Docker
    secretã€‚å¦‚æœä½ æ›´æ”¹äº†å‡­æ®æˆ–åç§°ï¼Œä½ å¿…é¡»æ›´æ–°è¿™ä¸¤ä¸ªå€¼ã€‚
- en: 'Now, deploy the Kubernetes Deployment in your Cluster:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œåœ¨ä½ çš„é›†ç¾¤ä¸­éƒ¨ç½²Kubernetes Deploymentï¼š
- en: '[PRE25]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Use `kubectl describe podname -n test` to see if the image will be pulled and
    the container gets started correctly. The output should look like this:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨`kubectl describe podname -n test`æŸ¥çœ‹é•œåƒæ˜¯å¦ä¼šè¢«æ‹‰å–ï¼Œä»¥åŠå®¹å™¨æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®å¯åŠ¨ã€‚è¾“å‡ºåº”å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '![](../Images/2201868b5b2ce5b8408252b4fc36d20d.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2201868b5b2ce5b8408252b4fc36d20d.png)'
- en: Pod Pull Image Events after deployment my-nginx Kubernetes Deployment
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: éƒ¨ç½²my-nginx Kuberneteséƒ¨ç½²åçš„Podæ‹‰å–é•œåƒäº‹ä»¶
- en: Closing Notes
  id: totrans-98
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç»“æŸè¯­
- en: Hopefully, this article gave you a good overview of how to set up a private
    Docker registry in your Kubernetes cluster.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: å¸Œæœ›è¿™ç¯‡æ–‡ç« ç»™ä½ æä¾›äº†ä¸€ä¸ªå…³äºå¦‚ä½•åœ¨Kubernetesé›†ç¾¤ä¸­è®¾ç½®ç§æœ‰Dockeræ³¨å†Œè¡¨çš„è‰¯å¥½æ¦‚è¿°ã€‚
- en: Remember, having a Private Docker registry is essential if deploying Docker
    services that are not Open Source!
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: è®°ä½ï¼Œå¦‚æœéƒ¨ç½²çš„DockeræœåŠ¡ä¸æ˜¯å¼€æºçš„ï¼Œæ‹¥æœ‰ç§æœ‰Dockeræ³¨å†Œè¡¨æ˜¯è‡³å…³é‡è¦çš„ï¼
- en: 'To have an easy, repeatable procedure that you can run on any Kubernetes cluster,
    I created [a GitHub Gist containing all necessary files](https://gist.github.com/paulknulst/f077420faead4fd6e901d46eb9ba00d4).
    If you already [have a Traefik Ingress Controller running in your Kubernetes cluster](https://www.paulsblog.dev/how-to-install-traefik-ingress-controller-in-kubernetes/),
    you can simply download all files, adjust them to your needs, and then apply them
    by executing:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†æä¾›ä¸€ä¸ªå¯ä»¥åœ¨ä»»ä½• Kubernetes é›†ç¾¤ä¸Šè¿è¡Œçš„ç®€å•ã€å¯é‡å¤çš„æµç¨‹ï¼Œæˆ‘åˆ›å»ºäº† [ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¿…è¦æ–‡ä»¶çš„ GitHub Gist](https://gist.github.com/paulknulst/f077420faead4fd6e901d46eb9ba00d4)ã€‚å¦‚æœä½ å·²ç»
    [åœ¨ä½ çš„ Kubernetes é›†ç¾¤ä¸­è¿è¡Œäº† Traefik Ingress Controller](https://www.paulsblog.dev/how-to-install-traefik-ingress-controller-in-kubernetes/)ï¼Œä½ å¯ä»¥ç®€å•åœ°ä¸‹è½½æ‰€æœ‰æ–‡ä»¶ï¼Œè°ƒæ•´åˆ°ä½ çš„éœ€æ±‚ï¼Œç„¶åé€šè¿‡æ‰§è¡Œæ¥åº”ç”¨å®ƒä»¬ï¼š
- en: '[PRE26]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: I would love to hear your feedback about this tutorial. Furthermore, if you
    also have set up a Docker registry and use a different approach, please comment
    here and explain what you have done differently. Also, if you have any questions,
    please ask them in the comments. I will answer them if possible.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å¾ˆæƒ³å¬åˆ°ä½ å¯¹è¿™ä¸ªæ•™ç¨‹çš„åé¦ˆã€‚æ­¤å¤–ï¼Œå¦‚æœä½ ä¹Ÿè®¾ç½®äº† Docker æ³¨å†Œè¡¨å¹¶ä½¿ç”¨äº†ä¸åŒçš„æ–¹æ³•ï¼Œè¯·åœ¨è¿™é‡Œè¯„è®ºå¹¶è§£é‡Šä½ åšäº†ä»€ä¹ˆä¸åŒçš„æ“ä½œã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨è¯„è®ºä¸­æå‡ºã€‚æˆ‘ä¼šå°½å¯èƒ½å›ç­”ã€‚
- en: Feel free to connect with me on [my blog](https://www.paulsblog.dev), [LinkedIn](https://www.linkedin.com/in/paulknulst/),
    [Twitter](https://twitter.com/paulknulst), and [GitHub](https://github.com/paulknulst).
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: éšæ—¶é€šè¿‡ [æˆ‘çš„åšå®¢](https://www.paulsblog.dev)ã€[LinkedIn](https://www.linkedin.com/in/paulknulst/)ã€[Twitter](https://twitter.com/paulknulst)
    å’Œ [GitHub](https://github.com/paulknulst) ä¸æˆ‘è”ç³»ã€‚
- en: '*This article was initially published on my blog at* [*https://www.paulsblog.dev/how-to-install-a-private-docker-container-registry-in-kubernetes/*](https://www.paulsblog.dev/how-to-install-a-private-docker-container-registry-in-kubernetes/)'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '*è¿™ç¯‡æ–‡ç« æœ€åˆå‘å¸ƒåœ¨æˆ‘çš„åšå®¢ä¸Š* [*https://www.paulsblog.dev/how-to-install-a-private-docker-container-registry-in-kubernetes/*](https://www.paulsblog.dev/how-to-install-a-private-docker-container-registry-in-kubernetes/)'
