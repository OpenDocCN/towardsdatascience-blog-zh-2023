# 嵌入 + 知识图谱：RAG 系统的**终极工具**

> 原文：[`towardsdatascience.com/embeddings-knowledge-graphs-the-ultimate-tools-for-rag-systems-cbbcca29f0fd`](https://towardsdatascience.com/embeddings-knowledge-graphs-the-ultimate-tools-for-rag-systems-cbbcca29f0fd)

[](https://medium.com/@alcarazanthony1?source=post_page-----cbbcca29f0fd--------------------------------)![Anthony Alcaraz](https://medium.com/@alcarazanthony1?source=post_page-----cbbcca29f0fd--------------------------------)[](https://towardsdatascience.com/?source=post_page-----cbbcca29f0fd--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----cbbcca29f0fd--------------------------------) [Anthony Alcaraz](https://medium.com/@alcarazanthony1?source=post_page-----cbbcca29f0fd--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----cbbcca29f0fd--------------------------------) ·10 分钟阅读·2023 年 11 月 14 日

--

*人工智能软件被用来增强本文文本的语法、流畅性和可读性。*

大型语言模型（LLM）的出现，经过大量文本数据的训练，是自然语言处理领域最重要的突破之一。这些模型仅凭简短的提示生成流畅且连贯的文本，开辟了对话 AI、创意写作和广泛其他应用的新可能性。

然而，尽管它们表现出色，LLM 仍然有一些关键限制。它们的知识仅限于从训练数据中辨别出的模式，这意味着它们缺乏对世界的真正理解。

他们的推理能力也有限——他们无法进行逻辑推断或从多个来源综合事实。当我们提出更复杂、开放性的问题时，回答开始变得毫无意义或自相矛盾。

为了弥补这些不足，检索增强生成（RAG）系统引起了越来越多的关注。关键思想是从外部来源检索相关知识，为 LLM 提供背景，以做出更有信息量的回答。

目前大多数现有系统通过向量嵌入的语义相似性检索段落。然而，这种方法有其自身的缺陷，如缺乏真正的相关性、无法聚合事实以及没有推理链。

这就是知识图谱发挥作用的地方。知识图谱是对现实世界实体和关系的结构化表示。它们通过编码上下文事实之间的相互连接，克服了纯向量搜索的不足。遍历知识图谱能够在多样的信息源之间进行复杂的多跳推理。

在这篇文章中，我们深入探讨了如何将向量嵌入与知识图谱结合，以解锁 LLM 推理、准确性和解释能力的新层次。这种结合提供了表面语义与结构化知识和逻辑的完美融合。

像我们的思维一样，LLM 需要统计学习和符号表示的结合。

我们首先探讨了单独依赖向量搜索的固有弱点。

然后我们阐明了知识图谱和嵌入如何互相补充，单独使用任何一种技术都不够充分。

# 原始向量搜索的局限性

[## 向量搜索并非你所需的一切](https://towardsdatascience.com/vector-search-is-not-all-you-need-ecd0f16ad65e?source=post_page-----cbbcca29f0fd--------------------------------)

### 介绍

[towardsdatascience.com](https://towardsdatascience.com/vector-search-is-not-all-you-need-ecd0f16ad65e?source=post_page-----cbbcca29f0fd--------------------------------)

大多数 RAG 系统依赖于对文档集合中的段落进行向量搜索，以找到对 LLM 相关的上下文。此过程包括几个关键步骤：

1.  **文本编码：** 系统使用像 BERT 这样的嵌入模型将语料库中的文本段落编码成向量表示。每个段落都被压缩成一个密集的向量，捕捉语义意义。

1.  **索引：** 这些段落向量在高维向量空间中进行索引，以实现快速相似性搜索。常用的方法包括 ANNOY、Faiss 和 Pinecone。

1.  **查询编码：** 当用户查询到达时，它也会使用相同的嵌入模型编码成向量表示。

1.  **相似性检索：** 通过对索引的段落进行相似性搜索，找到那些与查询向量基于距离度量（如余弦相似性）最接近的段落。

1.  **段落返回：** 返回最相似的段落向量，并提取原始文本以提供 LLM 的上下文。

该管道存在几个关键限制：

+   段落向量可能未能完全捕捉查询的语义意图。重要的上下文可能被忽视，因为嵌入未能表示某些推理连接。

+   在将整个段落压缩为单一向量时，细微之处会丢失。分布在句子中的关键相关细节被掩盖。

+   匹配是针对每个段落独立进行的。没有跨不同段落进行联合分析以连接事实和推导需要聚合的答案。

+   排名和匹配过程不透明，无法提供为何某些段落被认为更相关的透明度。

+   只编码了语义相似性，没有表示内容之间关系、结构、规则和其他多样化连接的表示。

仅关注语义向量相似性会导致检索结果缺乏真实理解。随着查询变得更加复杂，这些局限性在无法跨检索内容进行推理时变得愈加明显。

# 融入知识图谱

知识图谱将信息表示为一个互联的实体和关系网络，能够在内容中进行更复杂的推理。

下面是它们如何增强检索：

1.  **显式事实** — 事实作为节点和边直接捕获，而不是压缩成不透明的向量。这保留了关键细节。

1.  **上下文细节** — 实体包含丰富的属性，如描述、别名和元数据，提供了关键的上下文。

1.  **网络结构** — 关系建模实体之间的现实世界连接，捕捉规则、层级、时间线等。

1.  **多跳推理** — 查询可以遍历关系以连接来自不同来源的事实。可以推导出需要多步骤推理的答案。

1.  **联合推理** — 实体解析将对同一现实世界对象的引用连接起来，允许集体分析。

1.  **可解释的相关性** — 图的拓扑结构提供了为什么某些事实基于其连接而相关的透明度。

1.  **个性化** — 捕捉用户属性、上下文和历史交互，以定制结果。

知识图谱使得图遍历过程成为可能，以收集与查询相关的相互连接的上下文事实，而不是孤立的匹配。根据拓扑结构可以实现可解释的排名。丰富的知识表示能力促进了更复杂的推理。

知识图谱通过编码结构化事实、关系和上下文来增强检索，从而实现精准的多步骤推理。与纯向量搜索相比，这提供了更大的相关性和解释力。

# 结合知识图谱与嵌入和约束

[## 提升知识图谱嵌入使用简单约束](https://arxiv.org/abs/1805.02408?source=post_page-----cbbcca29f0fd--------------------------------)

### 将知识图谱（KGs）嵌入到连续向量空间是当前研究的重点。早期的研究进行了…

[arxiv.org](https://arxiv.org/abs/1805.02408?source=post_page-----cbbcca29f0fd--------------------------------)

知识图谱将实体和关系表示为向量嵌入，以进行数学操作。额外的约束可以使表示更加优化：

1.  **非负约束** — 将实体嵌入限制在 0 到 1 之间的正值，诱导稀疏性。这仅显式地建模它们的正面属性，并提高可解释性。

1.  **蕴含约束** — 通过将预期的逻辑规则如对称性、反转、组合直接编码为关系嵌入的约束，强制这些模式。

1.  **置信度建模** — 通过松弛变量的软约束可以编码基于证据的逻辑规则的不同置信水平。

1.  **正则化** — 约束施加有用的归纳偏置，而不会使优化显著变得更加复杂。只增加一个投影步骤。

1.  **可解释性** — 结构化的约束提供了对模型学习到的模式的透明度。这解释了推理过程。

1.  **准确性** — 约束通过减少假设空间到符合的表示来提高泛化能力。这提高了对未见查询的准确性。

添加简单但通用的约束可以增强知识图谱嵌入，生成更优化、可解释且符合逻辑的表示。这些嵌入获得了模仿现实世界结构和规则的归纳偏差，从而带来更准确且易于解释的推理，而不增加额外的复杂性。

# 整合多样化的推理框架

[## Papers with Code - Graph Agent: Explicit Reasoning Agent for Graphs](https://paperswithcode.com/paper/graph-agent-explicit-reasoning-agent-for?source=post_page-----cbbcca29f0fd--------------------------------)

### 尚无可用代码。

[paperswithcode.com](https://paperswithcode.com/paper/graph-agent-explicit-reasoning-agent-for?source=post_page-----cbbcca29f0fd--------------------------------)

知识图谱需要推理来推导新事实、回答查询和进行预测。不同的技术具有互补的优势：

1.  **逻辑规则** — 将知识表达为逻辑公理和本体。通过定理证明进行可靠和完整的推理。处理不确定性的能力有限。

1.  **图谱嵌入** — 嵌入知识图谱结构以进行向量空间操作。处理不确定性，但缺乏表达能力。

1.  **神经证明器** — 可微分的定理证明模块与向量查找结合。自适应但推理不透明。

1.  **规则学习器** — 通过对图结构和数据的统计分析来引导规则。自动化规则创建但质量不确定。

1.  **混合管道** — 逻辑规则编码明确的约束。嵌入提供向量空间操作。神经证明器通过联合训练融合了这些优势。

1.  **可解释建模** — 使用基于案例、模糊或概率逻辑来增加透明度。表达规则中的不确定性和信心。

1.  **迭代增强** — 通过将推断出的事实和学习到的规则重新呈现到图谱中来扩展知识。提供反馈回路。

关键在于识别所需的推理类型并将其映射到适当的技术上。一个结合逻辑形式、向量表示和神经组件的可组合管道提供了鲁棒性和可解释性。

# 保持信息流向 LLM

从知识图谱中检索事实以供 LLM 使用会引入信息瓶颈。精心设计保持相关性：

1.  **分块** — 将内容拆分成小块可以提高隔离性，但会丧失周围的上下文。这阻碍了跨块的推理。

1.  **总结** — 生成内容块的摘要提供了更简洁的上下文。关键细节被浓缩以突出其重要性。

1.  **元数据** — 附加摘要、标题、标签等作为元数据以维护源内容的上下文。

1.  **查询重写** — 将原始查询重写为更详细的版本，提供更符合 LLM 需求的检索结果。

1.  **关系建模** — 知识图谱遍历保持事实之间的连接，维持上下文。

1.  **信息排序** — 按时间顺序或相关性排序事实，优化 LLM 的信息结构。

1.  **显式陈述** — 将隐含知识转换为为 LLM 陈述的显式事实，使推理更容易。

目标是优化检索知识的相关性、上下文、结构和明确性，以最大化推理能力。需要在粒度和连贯性之间取得平衡。知识图谱关系有助于将孤立的事实进行上下文化。

# 解锁推理能力

知识图谱和嵌入各有优点，相互结合可以弥补对方的不足：

1.  **知识图谱** — 提供实体和关系的结构化表示。通过图遍历赋能复杂推理。处理多跳推理。

1.  **嵌入** — 在向量空间中编码信息以进行基于相似性的操作。实现大规模高效的近似搜索。揭示潜在模式。

1.  **联合编码** — 为知识图谱中的实体和关系生成嵌入。这提炼了统计模式。

1.  **神经网络** — 图神经网络通过可微分的信息传递在图结构和嵌入元素上操作。这融合了优势。

1.  **推理流程** — 知识图谱遍历首先收集结构化知识。然后嵌入关注搜索并大规模检索相关内容。

1.  **可解释性** — 显式的知识图谱关系为推理过程提供了可解释性。嵌入增强了解释能力。

1.  **迭代改进** — 推断的知识可以扩展图。GNNs 提供持续的表示学习。

这种合作关系使结构化知识表示和推理得到了模式识别能力和神经网络的可扩展性的增强。这是推动语言 AI 的关键，需要统计学习和符号逻辑的结合。

# 通过协同过滤改进搜索

协同过滤利用实体之间的连接来增强搜索：

1.  **知识图谱** — 构建一个知识图谱，其中节点表示实体，边表示关系。

1.  **节点嵌入** — 为特定的关键节点属性（如标题、描述等）生成嵌入向量。

1.  **向量索引** — 在节点嵌入上构建向量相似性索引。

1.  **相似性搜索** — 对于搜索查询，找到具有最相似嵌入的节点。

1.  **协作调整** — 基于节点的连接，使用诸如 PageRank 的算法传播和调整相似性评分。

1.  **边权重** — 根据边的类型、强度、置信度等调整权重。

1.  **评分归一化** — 对调整后的评分进行归一化，以保持相对排名。

1.  **结果重新排序** — 基于调整后的协同评分重新排序初始结果。

1.  **用户背景** — 根据用户资料、历史和偏好进一步调整。

# 用飞轮学习推动知识图谱

[](https://ai.plainenglish.io/fueling-the-rag-engine-the-data-flywheel-fc958c6d68d8?source=post_page-----cbbcca29f0fd--------------------------------) [## 驱动 RAG 引擎：数据飞轮

### 构建一个高效的检索增强生成（RAG）系统，并不断改进，需要实施…

[ai.plainenglish.io](https://ai.plainenglish.io/fueling-the-rag-engine-the-data-flywheel-fc958c6d68d8?source=post_page-----cbbcca29f0fd--------------------------------)

知识图谱通过提供结构化的世界知识，为语言模型解锁了新的推理能力。然而，构建高质量的图谱仍然具有挑战性。这就是飞轮学习的作用所在——通过分析系统交互持续改进知识图谱。

## 知识图谱飞轮

1.  **仪器化** — 记录所有系统查询、响应、评分、用户行为等。提供对知识图谱使用情况的可见性。

1.  **分析** — 汇总使用数据以显现不佳的响应。对这些响应进行聚类和分析，以识别表明知识缺口的模式。

1.  **策划** — 手动审查问题响应，并追踪问题到图谱中的缺失或错误的事实。

1.  **修正** — 直接修改图谱，添加缺失的事实、改进结构、提高清晰度等。修复潜在的数据问题。

1.  **迭代** — 不断循环上述步骤。每次迭代进一步增强知识图谱。

## 流数据摄取

+   流媒体数据源，如新闻和社交媒体，提供了持续的信息流，以保持知识图谱的时效性。

+   专用基础设施处理高容量的数据摄取。

## 主动学习

+   利用查询生成识别并填补关键的知识空白，超越流媒体提供的信息。

+   发现图谱中的漏洞，提出问题，检索缺失的事实，并将其添加。

## 飞轮效应

每次循环，知识图谱通过分析使用模式和修正数据问题逐步增强。改进的图谱提升了系统性能。

这个飞轮过程使知识图谱和语言模型能够基于来自现实世界使用的反馈共同演化。图谱会根据模型的需求进行积极调整。

总结来说，飞轮学习为知识图谱提供了一个持续、自动化改进的框架，通过分析系统交互来实现。这推动了依赖于图谱的语言模型的准确性、相关性和适应性。

# 结论：

要达到人类水平的智能，语言 AI 需要结合外部知识和推理。这正是知识图谱发挥作用的地方。知识图谱提供了现实世界实体和关系的结构化表示，编码了关于世界的事实及其之间的连接。这允许通过遍历互联的事实进行复杂的逻辑推理。

然而，知识图谱有其自身的局限性，如稀疏性和缺乏不确定性处理能力。在这里，图嵌入发挥作用——通过将知识图谱元素编码到向量空间中，嵌入允许从大规模语料库中进行统计学习，以揭示潜在模式。它们还支持基于相似性的高效操作。

无论是知识图谱还是嵌入，单独使用都不足以实现类似人类的语言智能。但将它们结合起来，可以提供结构化知识表示、逻辑推理和统计学习的完美融合。知识图谱在神经网络的模式识别能力之上叠加了符号逻辑和关系。

像图神经网络这样的技术通过在图结构和嵌入上进行可微分的消息传递进一步统一了这些方法。这种共生关系使系统能够利用统计学习和符号逻辑的优势——结合了神经网络和结构化知识表示的优点。

这种合作关系为下一代 AI 提供了基础构件，这种 AI 超越了单纯的口才，达到了真正的理解——能够理解上下文和历史的对话代理，能够识别细微偏好的推荐引擎，通过连接事实来合成答案的搜索系统。

构建高质量知识图谱、基准测试、噪声处理等仍然面临挑战。但跨符号和神经方法的混合技术前景光明。随着知识图谱和语言模型的不断进步，它们的整合将开启可解释、智能语言 AI 的新领域。

![](img/06e2063970c7a7fc5562fd1c389719c4.png)

这张图像是使用 AI 图像生成模型创建的。
