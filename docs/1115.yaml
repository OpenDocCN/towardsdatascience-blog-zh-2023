- en: Sliding Windows in Pandas
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Pandasä¸­çš„æ»‘åŠ¨çª—å£
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/sliding-windows-in-pandas-40b79edefa34?source=collection_archive---------1-----------------------#2023-03-29](https://towardsdatascience.com/sliding-windows-in-pandas-40b79edefa34?source=collection_archive---------1-----------------------#2023-03-29)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/sliding-windows-in-pandas-40b79edefa34?source=collection_archive---------1-----------------------#2023-03-29](https://towardsdatascience.com/sliding-windows-in-pandas-40b79edefa34?source=collection_archive---------1-----------------------#2023-03-29)
- en: Identify Patterns in Time-Series Data with Overlapping Window Techniques
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä½¿ç”¨é‡å çª—å£æŠ€æœ¯è¯†åˆ«æ—¶é—´åºåˆ—æ•°æ®ä¸­çš„æ¨¡å¼
- en: '[](https://avrilaysha.medium.com/?source=post_page-----40b79edefa34--------------------------------)[![Avril
    Aysha](../Images/a3be4bcc007664fb10885df00d111732.png)](https://avrilaysha.medium.com/?source=post_page-----40b79edefa34--------------------------------)[](https://towardsdatascience.com/?source=post_page-----40b79edefa34--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----40b79edefa34--------------------------------)
    [Avril Aysha](https://avrilaysha.medium.com/?source=post_page-----40b79edefa34--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://avrilaysha.medium.com/?source=post_page-----40b79edefa34--------------------------------)[![Avril
    Aysha](../Images/a3be4bcc007664fb10885df00d111732.png)](https://avrilaysha.medium.com/?source=post_page-----40b79edefa34--------------------------------)[](https://towardsdatascience.com/?source=post_page-----40b79edefa34--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----40b79edefa34--------------------------------)
    [Avril Aysha](https://avrilaysha.medium.com/?source=post_page-----40b79edefa34--------------------------------)'
- en: Â·
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb016782a8709&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsliding-windows-in-pandas-40b79edefa34&user=Avril+Aysha&userId=b016782a8709&source=post_page-b016782a8709----40b79edefa34---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----40b79edefa34--------------------------------)
    Â·10 min readÂ·Mar 29, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F40b79edefa34&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsliding-windows-in-pandas-40b79edefa34&user=Avril+Aysha&userId=b016782a8709&source=-----40b79edefa34---------------------clap_footer-----------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[å…³æ³¨](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb016782a8709&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsliding-windows-in-pandas-40b79edefa34&user=Avril+Aysha&userId=b016782a8709&source=post_page-b016782a8709----40b79edefa34---------------------post_header-----------)
    å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----40b79edefa34--------------------------------)
    Â· 10 åˆ†é’Ÿé˜…è¯» Â· 2023å¹´3æœˆ29æ—¥[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F40b79edefa34&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsliding-windows-in-pandas-40b79edefa34&user=Avril+Aysha&userId=b016782a8709&source=-----40b79edefa34---------------------clap_footer-----------)'
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F40b79edefa34&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsliding-windows-in-pandas-40b79edefa34&source=-----40b79edefa34---------------------bookmark_footer-----------)![](../Images/a1d1cf6d0a5270fa1d5be035f895a29c.png)'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F40b79edefa34&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsliding-windows-in-pandas-40b79edefa34&source=-----40b79edefa34---------------------bookmark_footer-----------)![](../Images/a1d1cf6d0a5270fa1d5be035f895a29c.png)'
- en: Photo by [Eugene Chystiakov](https://unsplash.com/it/@eugenechystiakov?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/B-h3so_5UKA?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”± [å°¤é‡‘Â·èµ«æ–¯å­£äºšç§‘å¤«](https://unsplash.com/it/@eugenechystiakov?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    æä¾›ï¼Œæ¥è‡ª [Unsplash](https://unsplash.com/photos/B-h3so_5UKA?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
- en: Windowing techniques enable data analysts to identify valuable patterns in time-series
    data. Sliding windows are particularly powerful because they allow you to spot
    patterns earlier than other techniques. This is an important feature in situations
    when making a key decision a few minutes (or seconds) earlier can save you money.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: çª—å£æŠ€æœ¯ä½¿æ•°æ®åˆ†æå¸ˆèƒ½å¤Ÿè¯†åˆ«æ—¶é—´åºåˆ—æ•°æ®ä¸­çš„æœ‰ä»·å€¼æ¨¡å¼ã€‚æ»‘åŠ¨çª—å£ç‰¹åˆ«å¼ºå¤§ï¼Œå› ä¸ºå®ƒä»¬å…è®¸ä½ æ¯”å…¶ä»–æŠ€æœ¯æ›´æ—©åœ°å‘ç°æ¨¡å¼ã€‚åœ¨åšå‡ºå…³é”®å†³ç­–çš„å‡ åˆ†é’Ÿï¼ˆæˆ–å‡ ç§’é’Ÿï¼‰æ—©ä¸€ç‚¹å¯èƒ½ä¼šä¸ºä½ èŠ‚çœèµ„é‡‘ï¼Œè¿™æ˜¯ä¸€é¡¹é‡è¦çš„åŠŸèƒ½ã€‚
- en: 'This article will show you 3 ways to perform windowing in `pandas` and will
    discuss the tradeoffs and benefits of each approach. By the end, youâ€™ll be able
    to create a sliding window visualisation that looks something like this:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬æ–‡å°†å±•ç¤ºåœ¨`pandas`ä¸­æ‰§è¡Œçª—å£æ“ä½œçš„ä¸‰ç§æ–¹æ³•ï¼Œå¹¶è®¨è®ºæ¯ç§æ–¹æ³•çš„æƒè¡¡å’Œå¥½å¤„ã€‚åˆ°æœ€åï¼Œä½ å°†èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªç±»ä¼¼äºä¸‹é¢è¿™æ ·çš„æ»‘åŠ¨çª—å£å¯è§†åŒ–ï¼š
- en: '![](../Images/6b2a4896b580e0058fd59a8176824fa3.png)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/6b2a4896b580e0058fd59a8176824fa3.png)'
- en: image by author
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: Imagine youâ€™re an Uber or Lyft driver. Youâ€™re driving around New York waiting
    for your next rideâ€¦and burning expensive gas in the meantime. Not cool. You need
    to find a way to maximise your chance of getting a new ride quickly. How could
    you do this?
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: æƒ³è±¡ä¸€ä¸‹ä½ æ˜¯Uberæˆ–Lyftçš„å¸æœºã€‚ä½ åœ¨çº½çº¦é©¾é©¶ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªä¹˜å®¢â€¦â€¦åŒæ—¶è¿˜åœ¨çƒ§ç€æ˜‚è´µçš„æ±½æ²¹ã€‚è¿™ä¸å¤ªå¥½ã€‚ä½ éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥æœ€å¤§åŒ–è¿…é€Ÿè·å¾—æ–°ä¹˜å®¢çš„æœºä¼šã€‚ä½ è¯¥æ€ä¹ˆåšï¼Ÿ
- en: You could take an experience-driven approach and test out different strategies
    over a period of time to find out which parts of New York have high demand. You
    try starting in one neighbourhood the first day, another the second, and so onâ€¦
    But New York City is BIG and this way itâ€™s going to take you a *loooong* time
    before you can start to identify patterns with any degree of confidence.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥é‡‡å–ç»éªŒé©±åŠ¨çš„æ–¹æ³•ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´æµ‹è¯•ä¸åŒç­–ç•¥æ¥æ‰¾å‡ºçº½çº¦çš„é«˜éœ€æ±‚åŒºåŸŸã€‚ä½ å¯ä»¥å°è¯•ç¬¬ä¸€å¤©ä»ä¸€ä¸ªç¤¾åŒºå¼€å§‹ï¼Œç¬¬äºŒå¤©ä»å¦ä¸€ä¸ªç¤¾åŒºå¼€å§‹ï¼Œä¾æ­¤ç±»æ¨â€¦â€¦ä½†çº½çº¦å¸‚å¾ˆå¤§ï¼Œè¿™æ ·åšéœ€è¦èŠ±è´¹*å¾ˆé•¿*æ—¶é—´æ‰èƒ½å¼€å§‹ä»¥ä»»ä½•ç¨‹åº¦çš„ä¿¡å¿ƒè¯†åˆ«å‡ºæ¨¡å¼ã€‚
- en: It would be much more efficient to take **a data-driven approach**. Which is
    exactly what weâ€™ll be doing in this article.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: é‡‡ç”¨**æ•°æ®é©±åŠ¨çš„æ–¹æ³•**ä¼šæ›´æœ‰æ•ˆã€‚è¿™æ­£æ˜¯æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­è¦åšçš„ã€‚
- en: Letâ€™s get to it ğŸš€
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: å¼€å§‹å§ ğŸš€
- en: The Dataset
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ•°æ®é›†
- en: Weâ€™ll be working with 1 hour of rideshare (Uber/Lyft) data from the New York
    City Taxi and Limousine Commission (TLC) Trip Record* dataset, which is subsampled
    from the dataset for January 2022\. You can [download the complete Parquet file](https://d37ci6vzurychx.cloudfront.net/trip-data/fhvhv_tripdata_2022-01.parquet)
    for January 2022\. This contains data for more than 14.5 million rides (!) To
    replicate the dataset Iâ€™m using in this article, subsample to the first 100K rows.
    You can also [access the data and notebook directly](https://github.com/rrpelgrim/sliding-windows-pandas)
    from a dedicated Github repo.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ªçº½çº¦å¸‚å‡ºç§Ÿè½¦å’Œè±ªåè½¦å§”å‘˜ä¼šï¼ˆTLCï¼‰æ—…è¡Œè®°å½•*æ•°æ®é›†çš„1å°æ—¶æ‹¼è½¦ï¼ˆUber/Lyftï¼‰æ•°æ®ï¼Œè¯¥æ•°æ®é›†ä»2022å¹´1æœˆçš„å®Œæ•´æ•°æ®é›†ä¸­å­æ ·æœ¬æå–ã€‚ä½ å¯ä»¥[ä¸‹è½½å®Œæ•´çš„Parquetæ–‡ä»¶](https://d37ci6vzurychx.cloudfront.net/trip-data/fhvhv_tripdata_2022-01.parquet)ï¼ˆ2022å¹´1æœˆï¼‰ã€‚è¿™åŒ…å«äº†è¶…è¿‡1450ä¸‡æ¬¡çš„ä¹˜è½¦æ•°æ®ï¼ï¼ˆï¼‰è¦å¤åˆ¶æœ¬æ–‡ä½¿ç”¨çš„æ•°æ®é›†ï¼Œè¯·å°†æ•°æ®å­æ ·æœ¬æå–åˆ°å‰100Kè¡Œã€‚ä½ ä¹Ÿå¯ä»¥[ç›´æ¥è®¿é—®æ•°æ®å’Œç¬”è®°æœ¬](https://github.com/rrpelgrim/sliding-windows-pandas)çš„ä¸“ç”¨Githubä»“åº“ã€‚
- en: '[PRE0]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Remember: our objective is to **identify zones with peaks in demand, defined
    as number of requests per unit of time.**'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: è®°ä½ï¼šæˆ‘ä»¬çš„ç›®æ ‡æ˜¯**è¯†åˆ«éœ€æ±‚å³°å€¼åŒºåŸŸï¼Œå®šä¹‰ä¸ºæ¯å•ä½æ—¶é—´çš„è¯·æ±‚æ•°é‡ã€‚**
- en: '1\. Quick-n-Dirty: a GroupBy over the Entire Dataset'
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1\. å¿«é€Ÿç²—ç•¥ï¼šå¯¹æ•´ä¸ªæ•°æ®é›†è¿›è¡ŒGroupBy
- en: '![](../Images/1174363574132195f1f9ac852f304885.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/1174363574132195f1f9ac852f304885.png)'
- en: image by author
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: Weâ€™ll start by doing a very rough pass to identify high-demand zones over the
    entire 1-hour dataset.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†å¼€å§‹å¯¹æ•´ä¸ª1å°æ—¶æ•°æ®é›†è¿›è¡Œéå¸¸ç²—ç•¥çš„å¤„ç†ï¼Œä»¥è¯†åˆ«é«˜éœ€æ±‚åŒºåŸŸã€‚
- en: After using a `time_mask` to subset the data for a specific hour and sorting
    the values by the `request_datetime` column, this is essentially just a groupby
    operation.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä½¿ç”¨`time_mask`å°†æ•°æ®å­é›†æå–åˆ°ç‰¹å®šå°æ—¶ï¼Œå¹¶æŒ‰`request_datetime`åˆ—æ’åºå€¼ä¹‹åï¼Œè¿™åŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªgroupbyæ“ä½œã€‚
- en: '[PRE1]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: We now have a list of the number of requests per pickup location. Letâ€™s clean
    up the column names and sort the values to get a meaningful output.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç°åœ¨æœ‰æ¯ä¸ªå–è½¦åœ°ç‚¹çš„è¯·æ±‚æ•°é‡åˆ—è¡¨ã€‚è®©æˆ‘ä»¬æ¸…ç†åˆ—åå¹¶æ’åºå€¼ä»¥è·å–æœ‰æ„ä¹‰çš„è¾“å‡ºã€‚
- en: '[PRE2]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![](../Images/98a688ed6632f2d6d12e8fecf61674a9.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/98a688ed6632f2d6d12e8fecf61674a9.png)'
- en: data output generated by author from [this notebook]
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ä»[è¿™ä¸ªç¬”è®°æœ¬]ç”Ÿæˆçš„æ•°æ®è¾“å‡º
- en: Sweet. We can now identify the top-10 pick-up zones with highest demand during
    the hour for which we have data. We could run this code in batch once a hour.
    This is greatâ€¦but only sort of.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: å¤ªå¥½äº†ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥è¯†åˆ«å‡ºæ•°æ®ä¸­éœ€æ±‚æœ€é«˜çš„å‰10ä¸ªå–è½¦åŒºåŸŸã€‚æˆ‘ä»¬å¯ä»¥æ¯å°æ—¶æ‰¹é‡è¿è¡Œä¸€æ¬¡è¿™ä¸ªä»£ç ã€‚è¿™å¾ˆæ£’â€¦â€¦ä½†ä»…ä»…æ˜¯è¿™æ ·ã€‚
- en: Processing the data in 1-hour batches means that drivers will only receive the
    signal for a high-demand area *at the end of the hour.* What if the peak was actually
    happening during the first 15 or even 5 minutes of that hour? Then there would
    be absolutely no use in rushing to that part of town only to realise that the
    peak demand was long over.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥æ¯å°æ—¶ä¸ºæ‰¹æ¬¡å¤„ç†æ•°æ®æ„å‘³ç€å¸æœºåªèƒ½åœ¨*æ¯å°æ—¶ç»“æŸæ—¶*æ”¶åˆ°é«˜éœ€æ±‚åŒºåŸŸçš„ä¿¡å·ã€‚å¦‚æœé«˜å³°å®é™…ä¸Šå‘ç”Ÿåœ¨é‚£ä¸ªå°æ—¶çš„å‰15åˆ†é’Ÿç”šè‡³5åˆ†é’Ÿå†…å‘¢ï¼Ÿé‚£ä¹ˆï¼Œæ€¥åŒ†åŒ†åœ°èµ¶åˆ°é‚£ä¸ªåŸåŒºåªä¼šå‘ç°é«˜å³°éœ€æ±‚æ—©å·²è¿‡å»ï¼Œæ¯«æ— ç”¨å¤„ã€‚
- en: 2\. Tumbling Windows in Pandas
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2\. Pandasä¸­çš„æ»‘åŠ¨çª—å£
- en: '![](../Images/3ff46ba016b001212ea1a49c580ed6f8.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3ff46ba016b001212ea1a49c580ed6f8.png)'
- en: image by author
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾åƒ
- en: The drivers arenâ€™t happy. We need to do better. Letâ€™s build some code that can
    chop up our hour of data into [tumbling windows](https://pathway.com/glossary/tumbling-window)
    of 15 minutes each. This way we will get some more granularity and be able to
    give the drivers more helpful instructions on when to be in which part of town.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: å¸æœºä»¬ä¸æ»¡æ„ã€‚æˆ‘ä»¬éœ€è¦åšå¾—æ›´å¥½ã€‚è®©æˆ‘ä»¬ç¼–å†™ä¸€äº›ä»£ç ï¼Œå°†æˆ‘ä»¬çš„ä¸€å°æ—¶æ•°æ®åˆ†å‰²æˆ[tumbling windows](https://pathway.com/glossary/tumbling-window)
    æ¯15åˆ†é’Ÿä¸€ä¸ªçª—å£ã€‚è¿™æ ·æˆ‘ä»¬å°†è·å¾—æ›´å¤šçš„ç»†èŠ‚ï¼Œå¹¶èƒ½ç»™å¸æœºæä¾›æ›´æœ‰å¸®åŠ©çš„æŒ‡ç¤ºï¼Œå‘Šè¯‰ä»–ä»¬ä½•æ—¶åˆ°è¾¾åŸå¸‚çš„å“ªä¸ªéƒ¨åˆ†ã€‚
- en: We can use the pandas `pivot_table()` and `.resample()` methods to do this.
    Weâ€™ll need the index of our DataFrame to be set to a datetime column. Since weâ€™re
    interested in the number of requests, weâ€™ll use the `request_datetime` column.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨pandasçš„`pivot_table()`å’Œ`.resample()`æ–¹æ³•æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚æˆ‘ä»¬éœ€è¦å°†æ•°æ®æ¡†çš„ç´¢å¼•è®¾ç½®ä¸ºä¸€ä¸ªdatetimeåˆ—ã€‚ç”±äºæˆ‘ä»¬å¯¹è¯·æ±‚æ•°é‡æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`request_datetime`åˆ—ã€‚
- en: Note that the dataset is not sorted correctly by incoming requests and includes
    some trips that were requested before midnight on the year before. So letâ€™s clean
    those up first.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œæ•°æ®é›†æŒ‰è¯·æ±‚çš„é¡ºåºæœªæ­£ç¡®æ’åºï¼Œå¹¶ä¸”åŒ…æ‹¬ä¸€äº›åœ¨å‰ä¸€å¹´åˆå¤œä¹‹å‰è¯·æ±‚çš„è¡Œç¨‹ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å…ˆæ¸…ç†è¿™äº›æ•°æ®ã€‚
- en: '[PRE3]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Our DataFrame now looks like this:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çš„æ•°æ®æ¡†ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·ï¼š
- en: '![](../Images/68e0cc65d98c57006727bc7ec50dffbd.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/68e0cc65d98c57006727bc7ec50dffbd.png)'
- en: data output generated by author
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ç”Ÿæˆçš„æ•°æ®è¾“å‡º
- en: Remember that we are looking to group our dataset into 15-minute windows with
    the number of requests per pickup zone for each window. This means we want our
    output to have 4 rows (15 x 4 = 60 minutes) and a column for each PULocationID.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: è®°ä½ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ•°æ®é›†åˆ†ç»„åˆ°15åˆ†é’Ÿçš„çª—å£ä¸­ï¼Œæ¯ä¸ªçª—å£å¯¹åº”ä¸€ä¸ªæ¥é€åŒºçš„è¯·æ±‚æ•°é‡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¸Œæœ›è¾“å‡ºå…·æœ‰4è¡Œï¼ˆ15 x 4 = 60åˆ†é’Ÿï¼‰å’Œæ¯ä¸ªPULocationIDçš„åˆ—ã€‚
- en: 'We need a pivot:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé€è§†è¡¨ï¼š
- en: '[PRE4]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](../Images/27444de101ba31efca250adc0b75f012.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/27444de101ba31efca250adc0b75f012.png)'
- en: data output generated by author
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ç”Ÿæˆçš„æ•°æ®è¾“å‡º
- en: This is a sparse DataFrame with simply a count (1) for each row (request) in
    the column corresponding to that requestsâ€™ pickup zone.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯ä¸€ä¸ªç¨€ç–çš„æ•°æ®æ¡†ï¼Œå¯¹äºæ¯ä¸€è¡Œï¼ˆè¯·æ±‚ï¼‰ï¼Œåœ¨å¯¹åº”äºè¯¥è¯·æ±‚çš„æ¥é€åŒºçš„åˆ—ä¸­ä»…æœ‰ä¸€ä¸ªè®¡æ•°ï¼ˆ1ï¼‰ã€‚
- en: 'Letâ€™s resample our DataFrame with `.sum()`to group this data into 15-minute
    windows and sum up the counts for each PULocationID:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ä½¿ç”¨`.sum()`å¯¹æˆ‘ä»¬çš„æ•°æ®æ¡†è¿›è¡Œé‡é‡‡æ ·ï¼Œå°†æ•°æ®åˆ†ç»„åˆ°15åˆ†é’Ÿçš„çª—å£ä¸­ï¼Œå¹¶å¯¹æ¯ä¸ªPULocationIDçš„è®¡æ•°è¿›è¡Œæ±‚å’Œï¼š
- en: '[PRE5]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![](../Images/2ce7b5a0dbba7ee184ed752152df987d.png)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2ce7b5a0dbba7ee184ed752152df987d.png)'
- en: data output generated by author
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ç”Ÿæˆçš„æ•°æ®è¾“å‡º
- en: Nice! We now have the number of requests per pickup zone for each 15-minute
    window. All thatâ€™s left is to define exactly what we mean with â€œhigh-demandâ€ â€”
    letâ€™s say 40 requests per 15-minute window â€” and then we can use this DataFrame
    to filter out the windows and pickup zones that exceed that high-demand threshold.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: å¾ˆå¥½ï¼æˆ‘ä»¬ç°åœ¨æœ‰äº†æ¯ä¸ª15åˆ†é’Ÿçª—å£æ¯ä¸ªæ¥é€åŒºçš„è¯·æ±‚æ•°é‡ã€‚å‰©ä¸‹çš„å°±æ˜¯å‡†ç¡®åœ°å®šä¹‰â€œé«˜éœ€æ±‚â€çš„æ ‡å‡†â€”â€”å‡è®¾ä¸ºæ¯15åˆ†é’Ÿçª—å£40ä¸ªè¯·æ±‚â€”â€”ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ•°æ®æ¡†æ¥ç­›é€‰å‡ºè¶…è¿‡é«˜éœ€æ±‚é˜ˆå€¼çš„çª—å£å’Œæ¥é€åŒºã€‚
- en: 'We can also inspect the data visually to identify the peak-demand zones:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å¯è§†åŒ–æ•°æ®æ¥è¯†åˆ«é«˜å³°éœ€æ±‚åŒºåŸŸï¼š
- en: '[PRE6]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](../Images/4a9089534061e1526e24b601f7be5cf4.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/4a9089534061e1526e24b601f7be5cf4.png)'
- en: plot generated by author
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ç”Ÿæˆçš„å›¾è¡¨
- en: This is greatâ€¦but still only sort of. Weâ€™re still missing out on lots of granularity
    here. We need to wait for each 15-min window to finish before we can aggregate
    the data. What if the spike happens in the 15-minute window between minute 1 and
    minute 16 (rather than minute 0 and minute 15)? We will have missed the spike
    by just a minute but will need to wait 14 minutes before receiving the signal.
    By that time it may be too late to instruct drivers to that pickup zone.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å¾ˆå¥½â€¦â€¦ä½†ä»ç„¶åªæ˜¯æœ‰ç‚¹å¥½ã€‚æˆ‘ä»¬ä»ç„¶ç¼ºå°‘å¾ˆå¤šç»†èŠ‚ã€‚æˆ‘ä»¬éœ€è¦ç­‰å¾…æ¯ä¸ª15åˆ†é’Ÿçª—å£å®Œæˆåæ‰èƒ½èšåˆæ•°æ®ã€‚å¦‚æœå³°å€¼å‘ç”Ÿåœ¨ç¬¬1åˆ†é’Ÿåˆ°ç¬¬16åˆ†é’Ÿä¹‹é—´çš„15åˆ†é’Ÿçª—å£ï¼ˆè€Œä¸æ˜¯ç¬¬0åˆ†é’Ÿåˆ°ç¬¬15åˆ†é’Ÿä¹‹é—´ï¼‰ï¼Œæˆ‘ä»¬å°†é”™è¿‡å³°å€¼ä¸€åˆ†é’Ÿï¼Œä½†éœ€è¦ç­‰åˆ°14åˆ†é’Ÿåæ‰èƒ½æ”¶åˆ°ä¿¡å·ã€‚åˆ°é‚£æ—¶ï¼Œå¯èƒ½å·²ç»å¤ªæ™šäº†ï¼Œæ— æ³•æŒ‡ç¤ºå¸æœºå‰å¾€é‚£ä¸ªæ¥é€åŒºã€‚
- en: Do not fear, perfection is near!
  id: totrans-59
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä¸è¦å®³æ€•ï¼Œå®Œç¾å°±åœ¨çœ¼å‰ï¼
- en: 3\. Sliding Windows in Pandas
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 3\. Pandas ä¸­çš„æ»‘åŠ¨çª—å£
- en: '![](../Images/d4a6f7ffa180c3168146983ddcdda1a1.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d4a6f7ffa180c3168146983ddcdda1a1.png)'
- en: image by author
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: Ideally, we want a signal every minute that tells us which zones are experiencing
    peak demand. We also want to reduce the size of our windows to enable our drivers
    to react to the incoming data faster. So letâ€™s work with 5-minute windows and
    define â€œpeak demandâ€ as **more than 50 requests per 5-minute window**.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯åˆ†é’Ÿéƒ½æœ‰ä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰æˆ‘ä»¬å“ªäº›åŒºåŸŸæ­£åœ¨ç»å†é«˜å³°éœ€æ±‚ã€‚æˆ‘ä»¬è¿˜å¸Œæœ›å‡å°‘çª—å£çš„å¤§å°ï¼Œä»¥ä½¿æˆ‘ä»¬çš„é©±åŠ¨ç¨‹åºèƒ½å¤Ÿæ›´å¿«åœ°å¯¹ incoming æ•°æ®åšå‡ºååº”ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨5åˆ†é’Ÿçš„çª—å£ï¼Œå¹¶å°†â€œé«˜å³°éœ€æ±‚â€å®šä¹‰ä¸º**æ¯5åˆ†é’Ÿçª—å£å†…è¶…è¿‡50ä¸ªè¯·æ±‚**ã€‚
- en: 'We can accomplish this using the pandas `.rolling()` method to create **sliding
    windows**: 5-minute windows with a 4-minute overlap, so that we can track the
    rate of incoming requests every minute.'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ pandas çš„`.rolling()`æ–¹æ³•æ¥åˆ›å»º**æ»‘åŠ¨çª—å£**ï¼š5åˆ†é’Ÿçš„çª—å£ï¼Œé‡å 4åˆ†é’Ÿï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ¯åˆ†é’Ÿè·Ÿè¸ª incoming è¯·æ±‚çš„é€Ÿç‡ã€‚
- en: 'You can create sliding windows in pandas using the `.resample()` and `.rolling()`
    methods. Make sure to `.resample()` to **the size of your desired signal interval**
    instead of the size of your window:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥ä½¿ç”¨`.resample()`å’Œ`.rolling()`æ–¹æ³•åœ¨ pandas ä¸­åˆ›å»ºæ»‘åŠ¨çª—å£ã€‚ç¡®ä¿`.resample()`åˆ°**ä½ æ‰€éœ€ä¿¡å·é—´éš”çš„å¤§å°**ï¼Œè€Œä¸æ˜¯çª—å£çš„å¤§å°ï¼š
- en: '[PRE7]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Letâ€™s pick it apart step by step.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ‹†è§£ã€‚
- en: We want our output to be a series of rows in which each row is a 5-minute window
    and the columns contain the sum of requests per pickup zone for that 5-minute
    window. However, instead of starting the second row at the end of the first 5-minute
    window, we want it to start at the end of the first minute of that first 5-minute
    window.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¸Œæœ›è¾“å‡ºæ˜¯ä¸€ç³»åˆ—è¡Œï¼Œæ¯è¡Œæ˜¯ä¸€ä¸ª5åˆ†é’Ÿçª—å£ï¼Œåˆ—ä¸­åŒ…å«è¯¥5åˆ†é’Ÿçª—å£å†…æ¯ä¸ªå–ä»¶åŒºåŸŸçš„è¯·æ±‚æ€»æ•°ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¸Œæœ›ç¬¬äºŒè¡Œä¸æ˜¯ä»ç¬¬ä¸€ä¸ª5åˆ†é’Ÿçª—å£ç»“æŸæ—¶å¼€å§‹ï¼Œè€Œæ˜¯ä»ç¬¬ä¸€ä¸ª5åˆ†é’Ÿçª—å£çš„ç¬¬ä¸€åˆ†é’Ÿç»“æŸæ—¶å¼€å§‹ã€‚
- en: 'Still with me here? If not, maybe this diagram below will help:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: è¿˜è·Ÿå¾—ä¸Šå—ï¼Ÿå¦‚æœä¸è¡Œï¼Œä¹Ÿè®¸ä¸‹é¢çš„å›¾ç¤ºä¼šæœ‰å¸®åŠ©ï¼š
- en: '![](../Images/62ce4e0e63841c17874e49ac2fbd3250.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/62ce4e0e63841c17874e49ac2fbd3250.png)'
- en: image by author
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: What we really want is 56 rows of 5-minutes each, with a 4-minute overlap between
    each row. This will give us a signal every minute which zones (if any) are getting
    more than 50 requests per 5 minutes.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯56è¡Œæ¯è¡Œ5åˆ†é’Ÿï¼Œæ¯è¡Œä¹‹é—´æœ‰4åˆ†é’Ÿçš„é‡å ã€‚è¿™å°†ä¸ºæˆ‘ä»¬æä¾›æ¯åˆ†é’Ÿçš„ä¿¡å·ï¼Œå‘ŠçŸ¥å“ªäº›åŒºåŸŸï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æ¯5åˆ†é’Ÿå†…è¯·æ±‚è¶…è¿‡50ä¸ªã€‚
- en: 'To do this, weâ€™ll have to resample our DataFrame first in order to get a single
    row for every minute:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆé‡é‡‡æ ·æˆ‘ä»¬çš„ DataFrameï¼Œä»¥ä¾¿æ¯åˆ†é’Ÿè·å–ä¸€è¡Œæ•°æ®ï¼š
- en: '[PRE8]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](../Images/96e8822e16bdc6daacbe56c710267db3.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/96e8822e16bdc6daacbe56c710267db3.png)'
- en: data output generated by author
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ç”Ÿæˆçš„æ•°æ®è¾“å‡º
- en: '*(If you wanted to get a signal say every second, you would resample to* `*1s*`
    *here.)*'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '*(å¦‚æœä½ æƒ³æ¯ç§’é’Ÿè·å–ä¸€ä¸ªä¿¡å·ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œå°†é‡‡æ ·é¢‘ç‡è°ƒæ•´ä¸º`*1s*`ã€‚)*'
- en: 'Now that every row represents a single minute we can use `rolling()` and `sum()`
    to get the sum of the number of requests for every 5 rows (minutes):'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æ¯ä¸€è¡Œä»£è¡¨ä¸€åˆ†é’Ÿï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`rolling()`å’Œ`sum()`æ¥è·å¾—æ¯5è¡Œï¼ˆåˆ†é’Ÿï¼‰çš„è¯·æ±‚æ€»æ•°ï¼š
- en: '[PRE9]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](../Images/a14579fddc40d0e9f1206de9e94ea64b.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a14579fddc40d0e9f1206de9e94ea64b.png)'
- en: data output generated by author
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ç”Ÿæˆçš„æ•°æ®è¾“å‡º
- en: ğŸ˜± Yikes, thatâ€™s a lot of NaNs.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ˜± å“å‘€ï¼Œè¿™ä¹ˆå¤šNaNsã€‚
- en: But thatâ€™s only because `.rolling()` by default places the output of the window
    operation (in this case the sum) at the right edge of the window. This is technically
    correct since we will only get the first signal at the end of minute 4, when the
    first window has been completed.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†è¿™åªæ˜¯å› ä¸º`.rolling()`é»˜è®¤å°†çª—å£æ“ä½œï¼ˆåœ¨æ­¤ä¾‹ä¸­ä¸ºæ€»å’Œï¼‰çš„è¾“å‡ºæ”¾åœ¨çª—å£çš„å³è¾¹ç¼˜ã€‚è¿™åœ¨æŠ€æœ¯ä¸Šæ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºæˆ‘ä»¬åªèƒ½åœ¨ç¬¬4åˆ†é’Ÿæœ«è·å¾—ç¬¬ä¸€ä¸ªä¿¡å·ï¼Œå½“ç¬¬ä¸€ä¸ªçª—å£å·²å®Œæˆæ—¶ã€‚
- en: 'We can drop the first 4 columns if we want to get rid of the first 4 empty
    rows (minutes):'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬æƒ³å»æ‰å‰4åˆ—ï¼Œå¯ä»¥ä¸¢å¼ƒå‰4è¡Œç©ºæ•°æ®ï¼ˆåˆ†é’Ÿï¼‰ï¼š
- en: '[PRE10]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](../Images/4ee16f3f4aa9494c0d38517f41fb8e3f.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/4ee16f3f4aa9494c0d38517f41fb8e3f.png)'
- en: data output generated by author
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ç”Ÿæˆçš„æ•°æ®è¾“å‡º
- en: 'Side note: Forward-Looking Windows'
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: é™„æ³¨ï¼šå‰ç»æ€§çª—å£
- en: In some cases, you might want to move the values to the left edge to make it
    more easily readable. If you do so, be careful not to make the mistake of thinking
    that you will actually have data for window 1 at minute 1 (!) â€” youâ€™re really
    just shifting the results over to the first row.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å¸Œæœ›å°†å€¼ç§»åŠ¨åˆ°å·¦è¾¹ç¼˜ï¼Œä»¥ä½¿å…¶æ›´æ˜“è¯»ã€‚å¦‚æœä½ è¿™æ ·åšï¼Œè¯·å°å¿ƒä¸è¦çŠ¯é”™ï¼Œè¯¯è®¤ä¸ºç¬¬1åˆ†é’Ÿæ—¶çª—å£1ä¸­å®é™…ä¸Šä¼šæœ‰æ•°æ® (!) â€” ä½ å®é™…ä¸Šåªæ˜¯å°†ç»“æœç§»åŠ¨åˆ°äº†ç¬¬ä¸€è¡Œã€‚
- en: 'You can use the `FixedForwardWindowIndexer` object to place the window output
    on the left edge and create forward-looking windows:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥ä½¿ç”¨`FixedForwardWindowIndexer`å¯¹è±¡å°†çª—å£è¾“å‡ºæ”¾åœ¨å·¦è¾¹ç¼˜å¹¶åˆ›å»ºå‰ç»æ€§çª—å£ï¼š
- en: '[PRE11]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](../Images/b0fe34bea858226f190b4f4a9f96e445.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b0fe34bea858226f190b4f4a9f96e445.png)'
- en: data output generated by author
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ç”Ÿæˆçš„æ•°æ®è¾“å‡º
- en: The last 4 columns of our DataFrame are now empty (because there is no full
    5-minute window available after minute 55) and we can drop them.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: æ•°æ®æ¡†çš„æœ€å4åˆ—ç°åœ¨ä¸ºç©ºï¼ˆå› ä¸ºåœ¨ç¬¬55åˆ†é’Ÿä¹‹åæ²¡æœ‰å®Œæ•´çš„5åˆ†é’Ÿçª—å£ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤è¿™äº›åˆ—ã€‚
- en: '[PRE12]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![](../Images/f2d7ee6641a4e6e1791c84fb532f4e40.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f2d7ee6641a4e6e1791c84fb532f4e40.png)'
- en: data output generated by author
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ç”Ÿæˆçš„æ•°æ®è¾“å‡º
- en: This way of using the `.rolling()`method is not very well-known and is a little
    [buried in the docs](https://pandas.pydata.org/docs/user_guide/window.html#custom-window-rolling)
    but once you understand how it works itâ€™s pretty easy to use.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ `.rolling()` æ–¹æ³•çš„è¿™ç§æ–¹å¼å¹¶ä¸å¹¿ä¸ºäººçŸ¥ï¼Œä¸”åœ¨[æ–‡æ¡£ä¸­ç¨å¾®æœ‰äº›åŸ‹æ²¡](https://pandas.pydata.org/docs/user_guide/window.html#custom-window-rolling)ï¼Œä½†ä¸€æ—¦ä½ ç†è§£äº†å®ƒçš„å·¥ä½œåŸç†ï¼Œä½¿ç”¨èµ·æ¥è¿˜æ˜¯ç›¸å½“ç®€å•çš„ã€‚
- en: Visualise Sliding Windows in Pandas
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åœ¨ Pandas ä¸­å¯è§†åŒ–æ»‘åŠ¨çª—å£
- en: 'Letâ€™s visualise our data to identify some patterns and spot the pickup zones
    with the highest peaks in demand. Weâ€™ll work with `windows` to make it extra clear
    that we donâ€™t have any data for the first 5 minutes:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å¯è§†åŒ–æ•°æ®ï¼Œä»¥è¯†åˆ«ä¸€äº›æ¨¡å¼ï¼Œå¹¶æ‰¾åˆ°éœ€æ±‚å³°å€¼æœ€é«˜çš„æ¥é€åŒºåŸŸã€‚æˆ‘ä»¬å°†ä½¿ç”¨ `windows` æ¥æ˜ç¡®æ˜¾ç¤ºå‰5åˆ†é’Ÿçš„æ•°æ®ç¼ºå¤±ï¼š
- en: '[PRE13]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![](../Images/c58d83243423d5bdafc9c1baba33bc73.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c58d83243423d5bdafc9c1baba33bc73.png)'
- en: plot generated by author
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ç”Ÿæˆçš„å›¾è¡¨
- en: 'This is a very rough visualisation but even here we can already clearly see
    that:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯ä¸€ä¸ªéå¸¸ç²—ç•¥çš„å¯è§†åŒ–ï¼Œä½†å³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼š
- en: We donâ€™t have any data the first 5 minutes
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å‰5åˆ†é’Ÿçš„æ•°æ®ç¼ºå¤±
- en: There are clear peaks in the rate of pickup requests in specific zones.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨ç‰¹å®šåŒºåŸŸå†…ï¼Œæ¥é€è¯·æ±‚çš„é¢‘ç‡å­˜åœ¨æ˜æ˜¾çš„å³°å€¼ã€‚
- en: From here, we can now define a cutoff/threshold and identify zones with above-threshold
    requests in specific windows. We can then motivate drivers to go to that zone.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: ä»è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæˆªæ–­å€¼/é˜ˆå€¼ï¼Œå¹¶è¯†åˆ«åœ¨ç‰¹å®šçª—å£ä¸­è¯·æ±‚è¶…è¿‡é˜ˆå€¼çš„åŒºåŸŸã€‚ç„¶åæˆ‘ä»¬å¯ä»¥é¼“åŠ±å¸æœºå»è¿™äº›åŒºåŸŸã€‚
- en: 'One way to clarify the plot is to remove any columns with values below the
    threshold. Letâ€™s say we want to identify zones with more than 50 requests per
    5-minute window:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: æ¾„æ¸…å›¾è¡¨çš„ä¸€ç§æ–¹æ³•æ˜¯åˆ é™¤æ‰€æœ‰å€¼ä½äºé˜ˆå€¼çš„åˆ—ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦è¯†åˆ«æ¯5åˆ†é’Ÿçª—å£å†…è¯·æ±‚è¶…è¿‡50çš„åŒºåŸŸï¼š
- en: '[PRE14]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![](../Images/a986c6f7d4b27680048e9f17eab4a725.png)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a986c6f7d4b27680048e9f17eab4a725.png)'
- en: plot generated by author
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…ç”Ÿæˆçš„å›¾è¡¨
- en: Thereâ€™s much more we could do here. Play around with the code in [the notebook](https://github.com/rrpelgrim/sliding-windows-pandas/blob/main/pandas-sliding-windows-nyc-uber-lyft.ipynb)
    to perfect this further.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œè¿˜æœ‰å¾ˆå¤šå¯ä»¥åšçš„äº‹æƒ…ã€‚å¯ä»¥åœ¨ [è¿™ä¸ªç¬”è®°æœ¬](https://github.com/rrpelgrim/sliding-windows-pandas/blob/main/pandas-sliding-windows-nyc-uber-lyft.ipynb)
    ä¸­ç©ç©ä»£ç ï¼Œè¿›ä¸€æ­¥å®Œå–„å®ƒã€‚
- en: 'Sliding Windows in Pandas: Conclusion'
  id: totrans-113
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Pandas ä¸­çš„æ»‘åŠ¨çª—å£ï¼šç»“è®º
- en: This article has introduced you to the powerful capabilities of performing sliding
    windows on time-series data. By chopping up your dataset into small, overlapping
    windows you are now able to get valuable data signals *at an actionable rate*.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬æ–‡ä»‹ç»äº†åœ¨æ—¶é—´åºåˆ—æ•°æ®ä¸Šæ‰§è¡Œæ»‘åŠ¨çª—å£çš„å¼ºå¤§åŠŸèƒ½ã€‚é€šè¿‡å°†æ•°æ®é›†åˆ‡å‰²æˆå°çš„ã€é‡å çš„çª—å£ï¼Œä½ ç°åœ¨å¯ä»¥ä»¥*å¯æ“ä½œçš„é€Ÿç‡*è·å¾—æœ‰ä»·å€¼çš„æ•°æ®ä¿¡å·ã€‚
- en: Of course, ideally you would be doing all of this in real-time. Watch this space
    for more on that soon, but in the meantime you might want to check out [this real-time
    monitoring tutorial](https://www.dataengineeringweekly.com/p/unlocking-data-stream-processing).
    Be prepared for a slight context change from New York traffic to website traffic
    instead ;)
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œä½ ä¼šå®æ—¶å®Œæˆæ‰€æœ‰è¿™äº›æ“ä½œã€‚æ•¬è¯·å…³æ³¨æœ‰å…³å®æ—¶å¤„ç†çš„æ›´å¤šå†…å®¹ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œä½ å¯èƒ½æƒ³æŸ¥çœ‹ä¸€ä¸‹ [è¿™ä¸ªå®æ—¶ç›‘æ§æ•™ç¨‹](https://www.dataengineeringweekly.com/p/unlocking-data-stream-processing)ã€‚åšå¥½å‡†å¤‡ï¼Œä»çº½çº¦äº¤é€šè½¬åˆ°ç½‘ç«™æµé‡çš„èƒŒæ™¯å˜åŒ–
    ;)
- en: I hope you found this post helpful and engaging. [Follow me on LinkedIn](https://www.linkedin.com/in/avrilaysha/)
    to catch my latest content.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: å¸Œæœ›ä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ä¸”æœ‰è¶£ã€‚ [å…³æ³¨æˆ‘çš„ LinkedIn](https://www.linkedin.com/in/avrilaysha/) ä»¥è·å–æˆ‘çš„æœ€æ–°å†…å®¹ã€‚
- en: Happy data crunching! ğŸ‘‹
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: æ•°æ®å¤„ç†æ„‰å¿«ï¼ğŸ‘‹
- en: '**New York City Taxi and Limousine Commission (TLC) Trip Record Data was accessed
    on March 15, 2023 from* [*https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page*](https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page)*.
    License:* [*https://www.nyc.gov/home/terms-of-use.page*](https://www.nyc.gov/home/terms-of-use.page)'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '**çº½çº¦å¸‚å‡ºç§Ÿè½¦å’Œè±ªåè½¿è½¦å§”å‘˜ä¼šï¼ˆTLCï¼‰è¡Œç¨‹è®°å½•æ•°æ®äº2023å¹´3æœˆ15æ—¥è®¿é—®ï¼Œæ¥æºäº* [*https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page*](https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page)*ã€‚è®¸å¯è¯ï¼š*
    [*https://www.nyc.gov/home/terms-of-use.page*](https://www.nyc.gov/home/terms-of-use.page)'
