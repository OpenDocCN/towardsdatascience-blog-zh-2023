- en: 'Probing into Minimum Sample Size Formula: Derivation and Usage'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/probing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b?source=collection_archive---------0-----------------------#2023-02-01](https://towardsdatascience.com/probing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b?source=collection_archive---------0-----------------------#2023-02-01)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: A gentle walkthrough of the sample size formula in A/B tests
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@weimintaottt?source=post_page-----8db9a556280b--------------------------------)[![Mintao
    Wei](../Images/eec1a909df8e780ac6a2c1f9d754ba75.png)](https://medium.com/@weimintaottt?source=post_page-----8db9a556280b--------------------------------)[](https://towardsdatascience.com/?source=post_page-----8db9a556280b--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----8db9a556280b--------------------------------)
    [Mintao Wei](https://medium.com/@weimintaottt?source=post_page-----8db9a556280b--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: Â·
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6959c4b812af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprobing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b&user=Mintao+Wei&userId=6959c4b812af&source=post_page-6959c4b812af----8db9a556280b---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----8db9a556280b--------------------------------)
    Â·18 min readÂ·Feb 1, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8db9a556280b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprobing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b&user=Mintao+Wei&userId=6959c4b812af&source=-----8db9a556280b---------------------clap_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8db9a556280b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprobing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b&source=-----8db9a556280b---------------------bookmark_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: Too Long; Donâ€™t Read
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This article answers two important â€œhow-toâ€ questions centering on the minimum
    sample size calculation in A/B tests:'
  prefs: []
  type: TYPE_NORMAL
- en: '**1) How to derive the formula for the minimum sample size** ğœ¨**?**'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The essential idea behind the formula is to **reverse the p-value calculation
    in hypothesis testing**, with a particular focus on **statistical power**, which
    is the probability of rejecting the null hypothesis when the null hypothesis is
    indeed false.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/bf2c8037500f91060ac87fa8aee12159.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 1: Intuition Behind Minimum Sample Size Calculation Formula'
  prefs: []
  type: TYPE_NORMAL
- en: '**2) How to use the formula to calculate the minimum sample size in real-world
    scenarios?**'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: We use **historical data**, aggregated to the correct experiment unit, to calculate
    the **standard deviation** for our metric of interest as well as the historical
    average as the baseline level. Then, we **manually** determine the desired significance
    level **ğ›¼**, the statistical power **1-ğ›½**, and most importantly, the minimum
    detectable effect we expect between the treatment group and the control group
    **ğ‘‘ğ‘šğ‘–ğ‘›**.
  prefs: []
  type: TYPE_NORMAL
- en: These are the **four inputs** required for the sample size calculation. It is
    worthwhile to note that there are **trade-offs** between a *stronger statistical
    power* and a *longer experiment period* if we want to detect more subtle incremental
    lifts (small **ğ‘‘ğ‘šğ‘–ğ‘›).** Therefore, when designing A/B experiments, we often compute
    multiple versions of sample sizes under different levels of **ğ‘‘ğ‘šğ‘–ğ‘›** to quantify
    the trade-offs.
  prefs: []
  type: TYPE_NORMAL
- en: Table of Contents
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[Why Should We Care](#d90b)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[Set-up](#6649)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[I. Deriving Minimum Sample Size (The Naive Formulation/Without](#aa46) [ğ›½](#529a)[)](#aa46)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: â€¢ [Key Idea](#43b8)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: â€¢ [Formula Derivation](#c172)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'â€¢ [Example: Analyzing Download Speed Difference between Two Communities In
    Chicago](#516e)'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[II. Deriving Minimum Sample Size (The Standard Formulation/With ğ›½)](#529a)
    â€¢ [Key Idea](#6ea9) â€¢ [Formula Derivation](#2c44)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'â€¢ [Example: â€œDemystifyingâ€ Evanâ€™s Awesome A/B Sample Size Calculator](#b1ce)'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[Practical Issues](#76fa)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: â€¢ [How to derive the rule-of-thumb sample size from our general formula?](#efa2)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: â€¢ [How to determine ğ‘‘ğ‘šğ‘–ğ‘›?](#6675)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: â€¢ [What if the variances and the sizes of the two groups are unequal?](#cdbd)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: â€¢ [How to estimate the standard deviation ğœ using historical data?](#44bd)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: â€¢ [How much historical data do we need?](#9947)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: â€¢ [How shall we prepare those data?](#a0a5)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[Summary](#fc4f)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Why Shall We Care?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In 2022/2023, it seems unnecessary to delve into the principles behind the
    formula when there are numerous built-up sample size calculators on the web (e.g.
    [Evan Millerâ€™s Calculator](https://www.evanmiller.org/ab-testing/sample-size.html),
    [Optimizely](https://www.optimizely.com/sample-size-calculator/#/?conversion=3&effect=20&significance=95)),
    and when most tech firms have their own established experiment platforms and tools
    ready to use. Nevertheless, it is still important for us to know what is behind
    the scene because:'
  prefs: []
  type: TYPE_NORMAL
- en: A/B test sample size calculation is one of the most frequently asked questions
    in **product data scientist** **interviews**, and we are expected to give the
    rationale in addition to reciting the formula.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In both the online randomized A/B testing and the offline controlled trials,
    the real-world business context can be complex, so we need to know the ins and
    outs of the formula to **select or adapt these tools** correctly and avoid fallacies.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Furthermore, it is critically important for us to build up the â€œ**statistics
    acumen**â€ in hypothesis testing and power analysis because it is very common to
    encounter insignificant testing results due to insufficient sample size. We certainly
    want to sharpen our instinct for a possible type II error (neglecting a truly
    effective treatment strategy), and be prepared to estimate the required sample
    size for the next step. This goes beyond the typical data science work at tech
    companies to academia and research questions in our day-to-day life â€” â€œ*Are female
    employees given less compensation than males?*â€, â€œ*Do wealthier communities have
    a better internet connection and download speed than underserved communities?*â€,
    etc. We not only want to ask ourselves â€œis what we see from the data statistically
    significant?â€, but also â€œ**Do we have enough samples? If not, how much more data
    do we need or how many more surveys do we need to send out in the future?**â€
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There are many great introductory articles and resources on this topic, but
    most of them **simply â€œpresentâ€ the formula**. Standing on their shoulders, I
    hope to go one step further here to delve into the intuitions and derivations
    and answer the question **â€œwhy are the formulas defined in this wayâ€**. In addition,
    I will address some practical issues in using this formula.
  prefs: []
  type: TYPE_NORMAL
- en: Setup
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Tests
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The discussion of sample size calculation in this article will be mostly based
    on **two sample one-sided z-tests**.
  prefs: []
  type: TYPE_NORMAL
- en: The reasons are that, in A/B testing scenarios, the testing statistics are usually
    sample mean (*e.g. average XXX per user between the experiment period, where all
    the behaviors for a specific user in this period are regarded as a sample, and
    this metric is just the sample mean statistic across all users*) and they are
    usually normally distributed according to the central limited theorem. The one-sided
    tests are preferred here as we usually have a clear **directional** belief on
    the treatment effect (i.e. the treatment group should perform better or worse
    than the controlled group.
  prefs: []
  type: TYPE_NORMAL
- en: Notations and Concepts
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'ğœ¨: the minimum required sample size.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**ğ‘:** the p-value.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**ğ›¼:** the significance level, or the type I error.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**ğ›½:** the type II error. And 1-ğ›½ denotes the statistical power.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '***XÌ„1/XÌ„2/XÌ„d*:** the random variables of the metrics mean statistics for
    observations in group 1 (control), group 2 (treatment), and the difference between
    the two random mean variables.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '***xÌ„1/xÌ„2/xÌ„d***: the sample means of the observations in group 1 (control),
    group 2 (treatment), and the difference between the two mean statistics.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '***z_(1-*ğ›¼*)***: the z-score that cuts off the top **ğ›¼(%)**, or the critical
    value of a standard normal distribution. For example, in the one-side test, ***z_(1â€“5%)=z_(95%)â‰ˆ1.65;
    z_(1â€“2.5%)=z_(97.5%)â‰ˆ1.96; z_(2.5%)â‰ˆ-1.96.***'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**ğœ:** the standard deviation of the observations in each group. We assume
    the standard deviations to be the same in the two groups (*we will also discuss
    how to adjust the formula when the variances are unequal*).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**ğ‘‘ğ‘šğ‘–ğ‘›:** the minimum detectable effect, that is the level of statistically
    significant difference that can be detected given the sample size ğœ¨. For instance,
    if the conversion rate of the control group is 10% and **we expect** the treatment
    can actually increase the conversion from 10% to 15%(note that this is our expectation),
    then (the absolute) **ğ‘‘ğ‘šğ‘–ğ‘›** is 15%-10%=5%. Intuitively, if our **expected treatment
    effect is very small** (i.e. we are not confident of the treatment strategy),
    we will need many **more samples** to distinguish it from the natural variance
    because the true effect could be very subtle. If the minimum detectable effect
    is **large**, it should be fairly noticeable and thus **a small sample** will
    suffice to tell us whether the difference between the two groups is actually statistically
    significant or not.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Goal
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Given type I error **ğ›¼**, type II error **ğ›½**, the standard deviation **ğœ**,
    and the minimum detectable effect **ğ‘‘ğ‘šğ‘–ğ‘›**, we want to estimate the minimum required
    sample size ğœ¨ such that we have sufficient statistical power to detect a difference
    at least as large as **ğ‘‘ğ‘šğ‘–ğ‘›.**
  prefs: []
  type: TYPE_NORMAL
- en: In other words, the number of samples ğœ¨ (only) guarantees us to detect the treatment
    effect or inter-group difference at least **ğ‘‘ğ‘šğ‘–ğ‘›**. If the real treatment effect
    is actually smaller than **ğ‘‘ğ‘šğ‘–ğ‘›**, we might not be able to distinguish such minor
    improvement from the natural variation.
  prefs: []
  type: TYPE_NORMAL
- en: I. Deriving Minimum Sample Size ( The Naive Formulation/Without **ğ›½** )
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: While the statistical power **1-ğ›½,** or the probability of detecting a difference
    when there is actually such one,is a crucial component in estimating meaning sample
    size, I found it hard to wrap my head around when I started to learn A/B tests.
    For this reason, in this article, we start off first with this *â€œnaiveâ€* version
    of the minimum sample size estimation, where only the significance level **ğ›¼**
    is considered, and then progress into the â€œformalâ€ derivation in the next section,
    where the concept of statistical power steps in.
  prefs: []
  type: TYPE_NORMAL
- en: Key Idea
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The key idea to calculating the minimum required sample size is just the **reverse
    of hypothesis testing**, or put it differently, **asking the sample size *â€œas
    if the p-value is known to be the significance level* ğ›¼*â€***.
  prefs: []
  type: TYPE_NORMAL
- en: Given two samples, we could compute the p-value based on the **sample mean,
    standard deviation**, and ***N***. In the words of *Figure 2*, we want the sample
    mean difference statistic***XÌ„d*** to **fall within the red area**, as that is
    the rejection region for the null hypothesis H0.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/db7431cf1fd16c1599ac373fb5b0c925.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2: Rejection Area and Critical Value in Hypothesis Testing (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: Now, since the significance level ğ›¼ is essentially the **threshold** of p-values,
    we could compute ***N*** if we know the **standard deviation ğœ** from historical
    data and specify the level of **ğ›¼** as well as the expected difference between
    the two groups **ğ‘‘ğ‘šğ‘–ğ‘›** we want to detect. The minimum required sample size ***N***
    with this formulation guarantees us enough â€œsignificanceâ€ to detect the **ğ‘‘ğ‘šğ‘–ğ‘›**
    amount ofdifference between the two groups.
  prefs: []
  type: TYPE_NORMAL
- en: Formula Derivation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Based on the above-mentioned idea, we could outline the high-level formula
    below, and I will discuss the derivation of ***N*** step-by-step centering this
    logic:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3c0da9ee95bef36782e0ff7b17649699.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 1: High-level Idea behind the Naive Minimum Sample Size Formulation
    (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: To start off, I would like to explicitly define our hypotheses and the testing
    statistic. The null hypothesis is that there is no statistical difference between
    the mean statistics of group 1 (control group) and group 2 (treatment group).
    The alternative hypothesis asserts that our treatment group is â€˜betterâ€™ than the
    control group, indicating a one-sided test.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a6c705b17e02b1bf34086f1a7a3912f1.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 2: H0 and H1 in Two-sample One-sided T-test/Z-test (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: 'We focus on the difference in mean statistics of group 1 and group 2:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4554e1e17b2cf83aa7a26f01c1723e1e.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 3: Test Statistic for the Two-sample T-test/Z-test (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: Letâ€™s explore the distribution properties before delving any further. We donâ€™t
    require any distribution assumptions for the two groups ğ›¸1, ğ›¸2, because their
    **sample mean statistics** as well as the derived **sample mean difference statistic**
    follow normal distributions according to the Central Limit Theorem.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e3055ca906961dab057fdb26469f05eb.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 4: Distributional Properties of Key Random Variables and Test Statistics
    (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Recall p-value represents the probability for the random variable to obtain
    a value as or more extreme than the current sample statistic, assuming the null
    hypothesis is true. Therefore, the p-value and the z-statistic can be calculated
    by:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/10f93d853d31e7be3aa7b8a9b91edcce.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 5: P-value Formulation for the Two-Sample One-sided Z-test (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Hence, if we were performing hypothesis testing, then we would reject the null
    hypothesis at **ğ›¼** significance level if our p-value is smaller than **ğ›¼**, or
    the sample z-statistic is greater than the critical z-value:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6eb31af9bc882af659a92a3a077a6525.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 6: Hypothesis Testing Criteria when H0 is rejected for Two-Sample One-sided
    T-test/Z-test (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: Great! Now we derived the end formula for hypothesis testing given two sample
    groups. You may already notice ğœ¨ in the denominator. Straightforward as it is,
    the minimum required sample size is computed by (1) treating ***xÌ„d*** as a pre-determined
    Minimum Detectable Effect (MDE or **ğ‘‘ğ‘šğ‘–ğ‘›**); (2) assuming the null hypothesis
    is true (Î¼2-Î¼1=0), and (3) asking for ğœ¨ by reversing the inequation.
  prefs: []
  type: TYPE_NORMAL
- en: To conduct *hypothesis testing*, we compute ***xÌ„d*** by taking the difference
    between sample means from group 1 and group 2.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To calculate the *minimum sample size*, we replace the sample-based ***xÌ„d***
    with the expected Minimum Detectable Effect **ğ‘‘ğ‘šğ‘–ğ‘›**, which is the expected difference
    from group 1 (the control group) and group 2 (the treatment group), or in product
    analytics language, the potential incremental effect we anticipate our treatment
    strategy to obtain.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Accordingly, the derivation of ğœ¨ given **ğ‘‘ğ‘šğ‘–ğ‘›**, **ğ›¼**,and **ğœ** is illustrated
    below:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/efd580935995a198445f65466a799075.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 7: Derivation of ğœ¨ given **ğ‘‘ğ‘šğ‘–ğ‘›**, **ğ›¼**,and **ğœ** (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Example: Analyzing Download Speed Difference between Two Communities In Chicago'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Letâ€™s say you are a research assistant working with your professor. The teamâ€™s
    current research is about investigating internet inequity, which is measured by
    the **download speed, between underserved and wealthy communities,** and your
    professor has a very firm belief/hypothesis that there exists such inequity because
    of the differences in the infrastructure, service providers, and so forth.
  prefs: []
  type: TYPE_NORMAL
- en: The two geographic communities of focus are *Lincoln Park (Northside Chicago,
    one of the most affluent neighborhoods)* and *South Shore (Southside Chicago,
    usually considered an underserved community)*. The team has already surveyed **10
    randomly-selected households in each community**, and the professor asked you
    to conduct the data analysis to validate his hypothesis.
  prefs: []
  type: TYPE_NORMAL
- en: 'Table 1: The Initial Small Sample (N=10) (Synthetic Data, Made-up by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: You realized **t-tests** could be a good candidate to check **if there is a
    statistically significant difference in average download speed per household between
    Lincoln Park and South Shore.** However, after putting together the number, you
    found the result is **not statistically significant**, and you believe it is because
    the **sample size is too small** that the actual difference is covered by the
    natural variation.
  prefs: []
  type: TYPE_NORMAL
- en: 'The next question arises: **How many more samples should you suggest the team
    collect?** We need to know **three numbers:** **ğ›¼**, **ğœ, and ğ‘‘ğ‘šğ‘–ğ‘›** to calculate
    the minimum required sample size, according to the formula in *Formula 7*.'
  prefs: []
  type: TYPE_NORMAL
- en: 'We usually specify a 5% significance level and the standard deviation can be
    approximated using the sample standard deviation of group 1, assuming homogenous
    variance. For **ğ‘‘ğ‘šğ‘–ğ‘›**, we need to talk with the Professor to borrow the domain
    knowledge and determine the expected difference between *group 1 (South Shore)*
    and *group 2 (Lincoln Park)*. For now, letâ€™s assume Professor suggests that the
    expected difference, or the minimum detectable lift (%), in household download
    speed between these two communities should be 1%. Therefore, we have:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b43bb9acf26fd5d5403a19f35e2a7138.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 8: Specifications of **ğ›¼**, **ğœ**, and **ğ‘‘ğ‘šğ‘–ğ‘›** in the Download Speed
    Example(by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: Plugging in these numbers, we are able to calculate the minimum required sample
    size, which is **77**. This number implies that we should survey **67** more households
    (we already have 10) and this larger sample (***N*=77**) would enable us to detect
    the **1%** or larger difference in download internet speed if there does exist
    such difference between the two communities in Chicago.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4f20229e226cc2828d693c8c74fedaa2.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 9: Illustration of Calculating ğœ¨ given **ğ‘‘ğ‘šğ‘–ğ‘›**, **ğ›¼**,and **ğœ** in
    the Download Speed Example (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: 'The full Python implementation can be found on my [GitHub Gist](https://gist.github.com/mintaow/30506b7c2ae54da5d13623a3e4595beb)
    or the embedded notebook as follow:'
  prefs: []
  type: TYPE_NORMAL
- en: II. Deriving Minimum Sample Size ( The Standard Formulation/With **ğ›½ )**
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Key Idea
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'When designing and launching A/B tests at tech firms, in most cases, we not
    only care about obtaining significant p-values to reject the null hypothesis,
    but more importantly, to **reject the null hypothesis when it is actually wrong**,
    which indicates that our treatment is indeed effective rather than a Type I error.
    Therefore, the sample size we require needs to have sufficient **statistical power
    (1-ğ›½)** to detect such treatment effects**.** Graphically, as illustrated in *Figure
    3*, what we most â€˜desireâ€™ are two things:'
  prefs: []
  type: TYPE_NORMAL
- en: The sample statistic (***XÌ„d***) **falls beyond the critical value**, as that
    is the rejection region for H0.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The sample statistic (***XÌ„d***) **falls within the** **blue-shaded regions
    in the distribution Ha** because the blue area represents the alternative distribution,
    indicating the population difference between the treatment group and the control
    group is not zero.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: That is the key idea to calculating the minimum required sample size.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a852c0f5f3fa4d0d514829dce67dc71a.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 3: Rejection Area, Critical Value, Statistical Power in Hypothesis Testing
    (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: The transition in the formula from the above-mentioned **naive version** to
    the **formal representation**, reflecting the consideration of the statistical
    power **1-ğ›½**, is demonstrated below. The required sample size **increases** as
    the critical value specified by **1-ğ›½** is added to the numerator, which makes
    sense because we are â€œbuying inâ€ more efficiency in our inference.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a39c7a36a33cf0b5983da1d333b70bf3.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 10: From Naive Formulation to Standard Formulation in Sample Size Estimation
    (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: Another perspective is that the minimum required sample size for A/B tests is
    an extension of that of the naive version discussed above because the Type II
    Error **ğ›½** is now included/controlled. The logic of calculating the minimum sample
    size is still the **reverse of hypothesis testing** except that we need to consider
    two distributions, H0 and H1, and to incorporate both the type-I error/significance
    level **ğ›¼** and type-II error **ğ›½**.
  prefs: []
  type: TYPE_NORMAL
- en: Formula Derivation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Accordingly, we set up our high-level formula by asserting the probability of
    rejecting false H0 to be smaller than the pre-specified **statistical power (1-ğ›½)**
    as below.
  prefs: []
  type: TYPE_NORMAL
- en: Notice that we are now conditioning on H1 being the actual distribution where
    the statistic originates, rather than H0, which assumes no difference between
    the population in the treatment group and the control group.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](../Images/2be251a26867188d4cc0fb7627f3deca.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 11: High-level Idea behind the Formal Minimum Sample Size Derivation
    (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: 'There are **4 inputs** to calculate the minimum required sample size:'
  prefs: []
  type: TYPE_NORMAL
- en: The significance level **ğ›¼** we need to specify
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The statistical power **1-ğ›½** we need to specify
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The standard deviation **ğœ**, which we can calculate from historical data
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The magnitude of the expected treatment effect, or the difference between the
    two groups **ğ‘‘ğ‘šğ‘–ğ‘› (**Î¼2-Î¼1**)** we want to detect.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Recall that the sample means difference statistic follows a normal distribution
    with the mean of **Î¼2-Î¼1** and the standard deviation of the squared root of **2*ğœ/N*.***
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b6d981dd4a80bdacdbfcb3d609531f03.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 12: Distributional Properties of Key Random Variables and Test Statistics
    (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: The derivations of the high-level formula above comprise two steps. First, we
    represent ***x_crit***, or the critical value to reject the null hypothesis when
    H0 is assumed to be true, using **ğ›¼**.Second, we solve for the minimum sample
    size ğœ¨ using **ğ‘‘ğ‘šğ‘–ğ‘›**, **ğ›¼**, **ğ›½**.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/964eae2f8a0398eb08e6f897fbbb4d30.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 13: Derivation of ğœ¨ given **ğ‘‘ğ‘šğ‘–ğ‘›**, **ğ›¼**, **ğ›½,** and **ğœ** (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Example: â€œDemystifyingâ€ Evanâ€™s Awesome A/B Sample Size Calculator'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This â€œsimpleâ€ but elegant [A/B sample size calculator tool](https://www.evanmiller.org/ab-testing/sample-size.html),
    shown in *Figure 4*, was created and published by [Evan Miller](https://www.evanmiller.org/).
    It is referred to in the great introductory A/B test course series by Udacity
    and Google, and thus has become the first A/B test tool for many data science
    students, including me. While these sample-size calculator tools can be very convenient
    to use, people may have concerns and would not fully trust them because there
    are usually no concrete explanations about the logic behind the output. Therefore,
    I hope to provide a short briefing to help lift the curtain and demonstrate how
    these calculators work.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/5963a4a04cb070ebc59fdb7b5b6e6396.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 4: Evan Millerâ€™s Sample Size Calculator'
  prefs: []
  type: TYPE_NORMAL
- en: First and foremost, Evanâ€™s A/B test sample size calculator is curated specifically
    for the **z-proportional test** where the key metric of interest is a proportion
    (I believe the other article I wrote, [*How to Select the Right Statistical Tests
    for Different A/B Metrics*](https://medium.com/towards-data-science/how-to-select-the-right-statistical-tests-for-different-a-b-metrics-c8a1865851e),
    would be helpful if you are interested in different types of statistical testing).
  prefs: []
  type: TYPE_NORMAL
- en: It is worthwhile to note that **when estimating the sample size for proportional
    metrics, we donâ€™t need to input the standard deviation.** This is because the
    proportional metric such as conversion rate can be viewed as an aggregation of
    the conversion statuses for all the users. And since a **user is either converted
    or not converted**, which in statistical language, is a **random Bernoulli event**
    denoted as *Bernoulli(p)*. Therefore, the analytical variance estimate for the
    conversion rate is **ğ‘âˆ—(1-ğ‘)**. What this nice property implies is that we donâ€™t
    â€œneedâ€ to input the standard deviation to calculate the minimum sample size because
    we could always estimate the true analytical standard deviation using the sample
    average conversion rate **ğ‘**, which is the **baseline conversion rate**, as phrased
    in the input box of Evanâ€™s calculator.
  prefs: []
  type: TYPE_NORMAL
- en: 'With this important idea in mind, letâ€™s delve into the tool (*Figure 4*). The
    tool asks for four inputs:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Baseline conversion rate **ğ‘**: letâ€™s assume the current conversion level is
    20%.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Minimum detectable effect (MDE): The definition here can be tricky, but the
    idea is simple. There are â€œ**absolute**â€ MDE and â€œ**relative**â€ MDE. An absolute
    MDE of 5% states the sample size we calculated can only detect the range between
    15% and 25%, while the relative MDE defines the detectable range to be 20%*(1â€“5%)
    and 20%*(1+5%). For instance, if our product manager believes launching this new
    product feature will increase the conversion rate from 20% to 25%, then it means
    we should set **ğ‘‘ğ‘šğ‘–ğ‘›** as 5%, or the absolute MDE to be 5%, or the relative MDE
    to be 25% because 20%*1/4=5%.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Statistical power **1-ğ›½**
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Significance level **ğ›¼**
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Arranging them into the formula we have established so far:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/89d3a43a4d6283f7fb34b31e733895a1.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 14: Illustration of Calculating ğœ¨ given **ğ‘‘ğ‘šğ‘–ğ‘›**, **ğ›¼**, **ğ›½,** and
    **ğœ** (two-sided)in the A/B Tool Example (by Author). The difference between the
    hand-calculated sample size (1003) is slightly different from the result produced
    by the A/B test tool (1030), which is likely to be the rounding differences in
    precision.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e9258cc1c903df2fac9dce58147a61af.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 14: Illustration of Calculating ğœ¨ given **ğ‘‘ğ‘šğ‘–ğ‘›**, **ğ›¼**, **ğ›½,** and
    **ğœ** (two-sided)in the A/B Tool Example (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Talk is cheap:'
  prefs: []
  type: TYPE_NORMAL
- en: by Author
  prefs: []
  type: TYPE_NORMAL
- en: Practical Issues
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: I consider *Formula 13* as the general form of the minimum required sample size.
    The **Practical Issues** section below discusses several important extensions
    to more specific cases. For instance, when variances are not equal when the metrics
    are proportional ratios, and the relationship to a rule-of-thumb formula when
    the two-sided test is used.
  prefs: []
  type: TYPE_NORMAL
- en: '**How to derive the rule-of-thumb sample size from our general formula?**'
  prefs: []
  type: TYPE_NORMAL
- en: Many resources mentioned a handy formula that ***N*** is equal to **16*ğœ2/ğ‘‘ğ‘šğ‘–ğ‘›**.
    This can be easily transformed if we are doing **two-sided tests** and we specify
    **ğ›¼ = 0.05**, **ğ›½ = 0.2** and we can round the squared sum of the two z-scores
    times 2 up to 16\. See *Equation 17.6 in <Trustworthy Online Controlled Experiment>*
    or *Belle (2008)* for more details.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1d69a05d4d667f33248db958a9b9724c.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 15: From the General Form to the Rule-of-Thumb Form (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: '**How to determine ğ‘‘ğ‘šğ‘–ğ‘›?**'
  prefs: []
  type: TYPE_NORMAL
- en: 'I personally think that **ğ‘‘ğ‘šğ‘–ğ‘›** orthe Minimum Detectable Effect (MDE) should
    be determined through **close discussions between PM and DS**. It is a hard decision
    that requires careful communication and business intuition:'
  prefs: []
  type: TYPE_NORMAL
- en: DS can contribute insights relevant to (1) MDEs of similar historical experiments;
    (2) the magnitude of the volatility of key metrics; (3) the amount of available
    traffic/samples for the A/B test.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: PM can contribute insights relevant to (1) the expected magnitude of potential
    treatment effect; (2) the amount of confidence we have; (3) the importance/scope
    of this testing treatment; (4) the urgency/timeline of this testing treatment.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Back-and-forth communications might be needed, as a **trade-off** between **higher
    statistical power** and a **longer experiment period** emerges. Suppose the treatment
    effect is subtle (i.e. ğ‘‘ğ‘šğ‘–ğ‘› shall be set to be small) and requires higher statistical
    power to detect. In that case, we must accumulate more samples and thus expect
    a longer timeframe given the daily traffic is usually unchanged.
  prefs: []
  type: TYPE_NORMAL
- en: 'Tricky as it is to settle on **ğ‘‘ğ‘šğ‘–ğ‘›**, I would recommend a way of organizing
    scenarios under different **ğ‘‘ğ‘šğ‘–ğ‘›** and corresponding required sample sizes into
    a table as *Table 2 (The original Google Sheet table can be accessed through*
    [*here*](https://docs.google.com/spreadsheets/d/1I8dhHtYu42AoD-BCbM1I2PaGfH2zAbvgQcwd6RDLnuE/edit?usp=sharing)*)*.
    We data scientists first **pick a few possible MDEs** and **calculate the corresponding
    sample sizes** as well as **the number of days required**. The MDEs can be easily
    manipulated at any time and the table provides us with a straightforward comparative
    illustration so that it is easy to communicate with product managers regarding
    the above-mentioned trade-off:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/33a5ef4f4cbbc5000d636ecb8392a549.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Table 2: A Sample Table to Calculate Minimum Required Sample Sizes under Different
    MDEs (**ğ‘‘ğ‘šğ‘–ğ‘›**) (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: '**What if the variances and the sizes of the two groups are unequal?**'
  prefs: []
  type: TYPE_NORMAL
- en: It is very common that the two groups have different variances, especially in
    observational studies. While the homogenous-variance assumption fails, only trivial
    efforts are needed, that is to **replace 2*ğœ2 with the sum of treatment group
    variance and control group variance** when adapting the formula.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/638710eee635e80bca1211eaa93599b2.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 16: Adapting Sample Size Formula (12) under Unequal Variances (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: Whatâ€™s more, we could further release the implicit assumption that we have an
    **equal portion** of the traffic between the treatment group and the control group.
  prefs: []
  type: TYPE_NORMAL
- en: 'As you may have already noticed, the scale of the normally distributed sample
    means difference statistic demonstrated above is the population version of the
    so-called **pooled standard deviation** that we often see in online posts:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3844fdd89e6e1bc8152da950971f75cb.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Formula 17: Pooled Standard Deviation Formulation (by Author)'
  prefs: []
  type: TYPE_NORMAL
- en: '**How to estimate the standard deviation ğœ using historical data?**'
  prefs: []
  type: TYPE_NORMAL
- en: In A/B test scenarios, in order to gauge the potential traffic as well as the
    time length needed, sample size calculations are usually performed before the
    launch of the experiments. The (only) resource for the computation is historical
    data. The questions are thus, how much historical data do we need, and how shall
    we prepare those data?
  prefs: []
  type: TYPE_NORMAL
- en: '**How much historical data do we need?**'
  prefs: []
  type: TYPE_NORMAL
- en: It is advised that we use approximately the **same time length** of the past
    data as the expected A/B test period. In addition, the caveats are that we need
    to make sure the **scope of the historical data** is consistent with the treatment
    strategies. Otherwise, external validity is not guaranteed. For instance, if the
    product managers want to test the effectiveness of enlarging the size of the â€œNextâ€
    button and they hope to gather the experiment results about whether the conversion
    rate increases in two weeks, then we want to collect the conversion rate data
    for those eligible users who were (supposed to be) exposed to this button in the
    past two weeks.
  prefs: []
  type: TYPE_NORMAL
- en: '**How shall we prepare those data?**'
  prefs: []
  type: TYPE_NORMAL
- en: Aside from **selecting the right time frame** and **applying appropriate filters**
    to the historical data, we want to make sure the data are aggregated in a correct
    way such that the unit of analysis matches the unit of randomization. In other
    words, if the traffic is randomly diverted at the user level, considering the
    source data for the metrics are usually user-behavior level, we need to group
    by each user and aggregate their actions to calculate the metrics, before computing
    the historical sample mean and the standard deviations, which will be used to
    compute the required sample size.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this article, we probed into the derivation of the minimal sample size formula
    and discuss the practical issues extensively in using the formula. Youâ€™ve learned:'
  prefs: []
  type: TYPE_NORMAL
- en: How to **derive the minimum sample size formula** in A/B tests
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How to **understand the many online sample size calculators** as well as **other
    versions** of the minimum sample size formulas.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How to **use this formula** to calculate the sample size by preparing the historical
    data into the right format, discussing with product managers3 to determine **ğ‘‘ğ‘šğ‘–ğ‘›**
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This article is particularly inspired and grounded upon *<Trustworthy Online
    Controlled Experiments>* by Diane Tang, Ron Kohavi, and Ya Xu, Emma Dingâ€™s Youtube
    video â€œ*How to Estimate Sample Size in A/B Tests*â€, and my in-take from my work
    at TikTok.
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[Ding, E. (2021). How to Estimate Sample Size in A/B Tests. *Youtube*.](https://www.youtube.com/watch?v=JEAsoUrX6KQ)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Miller, E. (2013). Sample Size Calculator.](https://www.evanmiller.org/ab-testing/sample-size.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Glen, S. Sample Size in Statistics (How to Find it): Excel, Cochranâ€™s Formula,
    General Tips. *StatisticsHowTo.com*](https://www.statisticshowto.com/probability-and-statistics/find-sample-size/)*.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Israel, G. D. (1992). Determining sample size.](https://web.tarleton.edu/academicassessment/wp-content/uploads/sites/119/2022/05/Samplesize.pdf)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Kohavi, R., Tang, D., & Xu, Y. (2020). Trustworthy Online Controlled Experiments:
    A Practical Guide to A/B Testing. In *Trustworthy Online Controlled Experiments:
    A Practical Guide to A/B Testing* (p. I). Cambridge: Cambridge University Press.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Singh, A. S., & Masuku, M. B. (2014). Sampling techniques & determination of
    sample size in applied statistics research: An overview. *International Journal
    of economics, commerce and management*, *2*(11), 1â€“22.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Van Belle, G. (2008). Sample size. *Statistical rules of thumb*, 27â€“51.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Yadav, M. (2012). Sample size determination|Cochran formula|Yamane formula|
    Sample size calculation| â€” DU Professor. *Youtube.*](https://www.youtube.com/watch?v=-pwQJYjWWMc)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Yamane, T. (1973). Statistics: an introductory analysis-3.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
