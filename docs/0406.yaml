- en: CRPS — A Scoring Function for Bayesian Machine Learning Models
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/crps-a-scoring-function-for-bayesian-machine-learning-models-dd55a7a337a8?source=collection_archive---------1-----------------------#2023-01-28](https://towardsdatascience.com/crps-a-scoring-function-for-bayesian-machine-learning-models-dd55a7a337a8?source=collection_archive---------1-----------------------#2023-01-28)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The Continuous Ranked Probability Score is a statistical metric that compares
    distributional predictions to ground-truth values
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@itamar.faran?source=post_page-----dd55a7a337a8--------------------------------)[![Itamar
    Faran](../Images/aaef90d3cd4802c75407171875c336aa.png)](https://medium.com/@itamar.faran?source=post_page-----dd55a7a337a8--------------------------------)[](https://towardsdatascience.com/?source=post_page-----dd55a7a337a8--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----dd55a7a337a8--------------------------------)
    [Itamar Faran](https://medium.com/@itamar.faran?source=post_page-----dd55a7a337a8--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F153789513a7b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcrps-a-scoring-function-for-bayesian-machine-learning-models-dd55a7a337a8&user=Itamar+Faran&userId=153789513a7b&source=post_page-153789513a7b----dd55a7a337a8---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----dd55a7a337a8--------------------------------)
    ·5 min read·Jan 28, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdd55a7a337a8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcrps-a-scoring-function-for-bayesian-machine-learning-models-dd55a7a337a8&user=Itamar+Faran&userId=153789513a7b&source=-----dd55a7a337a8---------------------clap_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdd55a7a337a8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcrps-a-scoring-function-for-bayesian-machine-learning-models-dd55a7a337a8&source=-----dd55a7a337a8---------------------bookmark_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: 'An important part of the machine learning workflow is the model evaluation.
    The process itself can be considered common knowledge: split the data into train
    and test sets, train the model on the train set, and evaluate its performance
    on the test set using a score function.'
  prefs: []
  type: TYPE_NORMAL
- en: The score function (or [metric](https://scikit-learn.org/stable/modules/model_evaluation.html))
    is a mapping of the ground truth values and their predictions into a single and
    comparable value [1]. For example, for continuous predictions one could use score
    functions such as the RMSE, MAE, MAPE or R-squared. But what if the prediction
    is not a point-wise estimate, but a distribution?
  prefs: []
  type: TYPE_NORMAL
- en: In Bayesian machine learning, the predictions are often not point-wise estimates
    but distributions of values. For example, the prediction could be estimated parameters
    of a distribution, or, in the non-parametric case—an array of samples from an
    MCMC method.
  prefs: []
  type: TYPE_NORMAL
- en: In these cases, traditional score functions do not suit the statistical design;
    one could aggregate the predicted distributions into their mean or median values,
    but that would result with a great loss of information regarding the dispersion
    and shape of the predicted distribution.
  prefs: []
  type: TYPE_NORMAL
- en: The Continuous Ranked Probability Score
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The CRPS — Continuous Ranked Probability Score — is a score function that compares
    a single ground truth value to a Cumulative Distribution Function (CDF):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ffadb73ccd8ed3d3e2dbae231acfa283.png)'
  prefs: []
  type: TYPE_IMG
- en: Definition of the CRPS [1]. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: First introduced in the 70’s [4] and primarily used in weather forecasts, it
    is now gaining renewed attention in the literature and industry [1] [6]. It can
    be used as a metric to evaluate a model’s performance when the target variable
    is continuous and the model predicts the target’s distribution; Examples include
    Bayesian Regression or Bayesian Time Series models [5].
  prefs: []
  type: TYPE_NORMAL
- en: 'The fact that the theoretical definition includes the CDF makes the CRPS useful
    for both parametric and non-parametric predictions: for many distributions there
    is an analytic expression for the CRPS [3], and for non-parametric predictions,
    one could use the CRPS with the Empirical Cumulative Distribution Function (eCDF).'
  prefs: []
  type: TYPE_NORMAL
- en: 'After computing the CRPS for each observation in our test set, we are left
    to aggregate the results into a single value. Similarly to the RMSE and MAE, we’ll
    aggregate them using a (possibly weighted) average:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/693b4702ea961df404d44c8d2305bd54.png)'
  prefs: []
  type: TYPE_IMG
- en: Aggregation of CRPS over the test set, with empirical CDFs. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: Intuition
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The main challenge of comparing a single value to a distribution is how to
    translate the single value into the domain of distributions. The CRPS deals with
    that by translating the ground truth value into a [degenerate distribution](https://en.wikipedia.org/wiki/Degenerate_distribution)
    with the indicator function. For example, if our ground truth value is 7, we can
    translate it with:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/73387e8debe0345773a9445247ff7cb6.png)'
  prefs: []
  type: TYPE_IMG
- en: Example of a [degenerate distribution](https://en.wikipedia.org/wiki/Degenerate_distribution)
    with an indicator function. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: 'The indicator function is a valid CDF answering all the [requirements of a
    CDF](https://en.wikipedia.org/wiki/Cumulative_distribution_function#Properties).
    Now we are left with comparing the predicted distribution to the degenerate distribution
    of the ground truth value. Clearly, we want the predicted distribution to be as
    close as possible to the ground truth; this is expressed mathematically by measuring
    the (squared) area trapped between these two CDFs:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/48233724b8cca49e2d741c229e56637b.png)'
  prefs: []
  type: TYPE_IMG
- en: Visualization of the CRPS. The predicted distribution is marked in red, and
    the ground truth’s degenerate distribution is marked in blue. The CRPS is the
    (squared) area trapped between the two CDFs. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: Relation to the MAE
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The CRPS is closely related to the well-known [MAE](https://en.wikipedia.org/wiki/Mean_absolute_error)
    (Mean Absolute Error). If we take a point-wise prediction, treat it as a degenerate
    CDF and inject it into to the CRPS equation, we get:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/82c8fa95526d2cc6861145ef183860b6.png)'
  prefs: []
  type: TYPE_IMG
- en: Relation between the CRPS and the MAE. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: 'So, if the predicted distribution is a degenerate distribution (e.g. a point-wise
    estimate), the CRPS reduces to the MAE. This helps to get another intuition for
    the CRPS: it can be viewed as a **generalization of the MAE into distributional
    predictions**: **The MAE is a special case of the CRPS** when the predicted distribution
    is degenerate.'
  prefs: []
  type: TYPE_NORMAL
- en: Empirical Evaluation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'When the model’s prediction is a parametric distribution (e.g. the model predicts
    the distribution’s parameters), the CRPS has an analytic expression for some common
    distributions [3]. For example, if the model predicts the parameters *μ* & *σ*
    of the Normal distribution, the CRPS can be calculated with:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/67ccc0747d3413aabff964ecd015823f.png)'
  prefs: []
  type: TYPE_IMG
- en: Analytical solution of the CRPS for the normal distribution [3]. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: Analytic solutions are known for distributions such as Beta, Gamma, Logistic,
    Log-Normal and others [3].
  prefs: []
  type: TYPE_NORMAL
- en: 'When the prediction is non-parametric, or more specifically — the prediction
    is an array of simulations, calculating the integral over the eCDF is a hefty
    task. However, the CRPS can also be analytically expressed by:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4bca19a8c0aabede5910574683ffa553.png)'
  prefs: []
  type: TYPE_IMG
- en: Different forms of the CRPS and their names [2]. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: 'Where *X, X’* are independently and identically distributed according to *F*.
    These expressions, while still a bit computationally intensive, are simpler to
    estimate:'
  prefs: []
  type: TYPE_NORMAL
- en: An implementation of the CRPS function according the NRG form [2]. Adapted from
    pytorch to numpy from [pyro-ppl](https://docs.pyro.ai/en/stable/_modules/pyro/ops/stats.html#crps_empirical),
    Uber Technologies © [6]
  prefs: []
  type: TYPE_NORMAL
- en: An implementation of the CRPS function according the PWM form [2].
  prefs: []
  type: TYPE_NORMAL
- en: You can check out an example on a Bayesian Ridge Regression in a Jupyter notebook
    [here](https://github.com/itamarfaran/public-sandbox/blob/master/crps.ipynb),
    where I demonstrate the usage of both the parametric and non-parametric CRPS.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The Continuous Ranked Probability Score (CRPS) is a scoring function that compares
    a single ground-truth value to its predicted distribution. This property makes
    it relevant to Bayesian machine learning, where models usually output distributional
    predictions rather than point-wise estimates. It can be viewed as a generalization
    of the well known MAE to distributional predictions.
  prefs: []
  type: TYPE_NORMAL
- en: It has analytical expressions for parametric predictions, and can be simply
    computed for non-parametric predictions. All together, the CRPS emerges as the
    new standard way to evaluate the performance of Bayesian machine learning models
    with a continuous target.
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*Strictly Proper Scoring Rules, Prediction, and Estimation,* Gneiting & Raftery
    (2007)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*Estimation of the Continuous Ranked Probability Score with Limited Information
    and Applications to Ensemble Weather Forecasts*, Zamo & Naveau (2017)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*Calibrated Ensemble Forecasts Using Quantile Regression Forests and Ensemble
    Model Output Statistics*, Taillardat, Zamo & Naveau (2016)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*Scoring Rules for Continuous Probability Distributions*, Matheson & Winklers
    (1976)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*Distributional Regression and its Evaluation with the CRPS: Bounds and Convergence
    of the Minimax Risk,* Pic, Dombry, Naveau & Taillardat (2022)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[CRPS Implementation in Pyro-PPL](https://docs.pyro.ai/en/stable/ops.html#pyro.ops.stats.crps_empirical),
    Uber Technologies, Inc.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[CRPS Implementation in properscoring](https://github.com/properscoring/properscoring),
    The Climate Corporation'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
