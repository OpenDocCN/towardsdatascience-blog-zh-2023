- en: Comprehensive Guide to Ranking Evaluation Metrics
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 排名评估指标的综合指南
- en: 原文：[https://towardsdatascience.com/comprehensive-guide-to-ranking-evaluation-metrics-7d10382c1025?source=collection_archive---------0-----------------------#2023-07-29](https://towardsdatascience.com/comprehensive-guide-to-ranking-evaluation-metrics-7d10382c1025?source=collection_archive---------0-----------------------#2023-07-29)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/comprehensive-guide-to-ranking-evaluation-metrics-7d10382c1025?source=collection_archive---------0-----------------------#2023-07-29](https://towardsdatascience.com/comprehensive-guide-to-ranking-evaluation-metrics-7d10382c1025?source=collection_archive---------0-----------------------#2023-07-29)
- en: Explore an abundant choice of metrics and find the best one for your problem
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 探索丰富的指标选择，并找到适合你问题的最佳指标
- en: '[](https://medium.com/@slavahead?source=post_page-----7d10382c1025--------------------------------)[![Vyacheslav
    Efimov](../Images/db4b02e75d257063e8e9d3f1f75d9d6d.png)](https://medium.com/@slavahead?source=post_page-----7d10382c1025--------------------------------)[](https://towardsdatascience.com/?source=post_page-----7d10382c1025--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----7d10382c1025--------------------------------)
    [Vyacheslav Efimov](https://medium.com/@slavahead?source=post_page-----7d10382c1025--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@slavahead?source=post_page-----7d10382c1025--------------------------------)[![Vyacheslav
    Efimov](../Images/db4b02e75d257063e8e9d3f1f75d9d6d.png)](https://medium.com/@slavahead?source=post_page-----7d10382c1025--------------------------------)[](https://towardsdatascience.com/?source=post_page-----7d10382c1025--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----7d10382c1025--------------------------------)
    [Vyacheslav Efimov](https://medium.com/@slavahead?source=post_page-----7d10382c1025--------------------------------)'
- en: ·
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: ·
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc8a0ca9d85d8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomprehensive-guide-to-ranking-evaluation-metrics-7d10382c1025&user=Vyacheslav+Efimov&userId=c8a0ca9d85d8&source=post_page-c8a0ca9d85d8----7d10382c1025---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----7d10382c1025--------------------------------)
    ·13 min read·Jul 29, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7d10382c1025&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomprehensive-guide-to-ranking-evaluation-metrics-7d10382c1025&user=Vyacheslav+Efimov&userId=c8a0ca9d85d8&source=-----7d10382c1025---------------------clap_footer-----------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[关注](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc8a0ca9d85d8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomprehensive-guide-to-ranking-evaluation-metrics-7d10382c1025&user=Vyacheslav+Efimov&userId=c8a0ca9d85d8&source=post_page-c8a0ca9d85d8----7d10382c1025---------------------post_header-----------)
    发表在 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----7d10382c1025--------------------------------)
    · 13分钟阅读 · 2023年7月29日 [](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7d10382c1025&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomprehensive-guide-to-ranking-evaluation-metrics-7d10382c1025&user=Vyacheslav+Efimov&userId=c8a0ca9d85d8&source=-----7d10382c1025---------------------clap_footer-----------)'
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7d10382c1025&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomprehensive-guide-to-ranking-evaluation-metrics-7d10382c1025&source=-----7d10382c1025---------------------bookmark_footer-----------)![](../Images/9590e4ba65d5707f16a4ef8cc8b6d58c.png)'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7d10382c1025&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomprehensive-guide-to-ranking-evaluation-metrics-7d10382c1025&source=-----7d10382c1025---------------------bookmark_footer-----------)![](../Images/9590e4ba65d5707f16a4ef8cc8b6d58c.png)'
- en: Introduction
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: Ranking is a problem in machine learning where the objective is to sort a list
    of documents for an end user in the most suitable way, so the most relevant documents
    appear on top. Ranking appears in several domains of data science, starting from
    recommender systems where an algorithm suggests a set of items for purchase and
    ending up with NLP search engines where by a given query, the system tries to
    return the most relevant search results.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 排名是机器学习中的一个问题，其目标是以最合适的方式对文档列表进行排序，以便最相关的文档出现在顶部。排名出现在数据科学的多个领域，从推荐系统开始，在这些系统中，算法建议一组购买项目，直到
    NLP 搜索引擎，通过给定的查询，系统尝试返回最相关的搜索结果。
- en: The question which arises naturally is how to estimate the quality of a ranking
    algorithm. As in classical machine learning, there does not exist a single universal
    metric that would be suitable for any type of task. Why? Simply because every
    metric has its own application scope which depends on the nature of a given problem
    and data characteristics.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 自然产生的问题是如何评估排名算法的质量。与经典的机器学习一样，并不存在适用于任何类型任务的单一通用指标。为什么？原因很简单，因为每种指标都有其适用范围，这取决于特定问题的性质和数据特征。
- en: That is why it is crucial to be aware of all the main metrics to successfully
    tackle any machine learning problem. This is exactly what we are going to do in
    this article.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是为什么了解所有主要指标对于成功解决任何机器学习问题至关重要。正是我们将在本文中做到的。
- en: Nevertheless, before going ahead let us understand why certain popular metrics
    should not be normally used for ranking evaluation. By taking this information
    into consideration, it will be easier to understand the necessity of the existence
    of other, more sophisticated metrics.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在继续之前，让我们了解为什么某些流行指标通常不应被用于排名评估。通过考虑这些信息，将更容易理解其他更复杂指标存在的必要性。
- en: '*Note*. The article and used formulas are based on the presentation on [offline
    evaluation from Ilya Markov](https://drive.google.com/drive/folders/19OfEsLME1IR7bGPzVo8Dh31emcPNiaP_).'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '*注意*。本文及使用的公式基于[Ilya Markov的离线评估演示](https://drive.google.com/drive/folders/19OfEsLME1IR7bGPzVo8Dh31emcPNiaP_)。'
- en: Metrics
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 指标
- en: 'There are several types of information retrieval metrics that we are going
    to discuss in this article:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本文中讨论几种信息检索指标：
- en: '![](../Images/ed86835c8e52a6a2461e7378d45bbff6.png)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ed86835c8e52a6a2461e7378d45bbff6.png)'
- en: Different types of metrics
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 不同类型的指标
- en: Unranked metrics
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 未排序的指标
- en: Imagine a recommender system predicting ratings of movies and showing the most
    relevant films to users. Rating usually represents a positive real number. At
    first sight, a regression metric like *MSE* (*RMSE, MAE*, etc.) seems a reasonable
    choice to evaluate the quality of the system on a hold-out dataset.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 设想一个推荐系统预测电影评分并向用户展示最相关的电影。评分通常表示一个正的实数。乍看之下，像*MSE*（*RMSE，MAE*等）这样的回归指标似乎是评估系统在保留数据集上的质量的合理选择。
- en: '*MSE* takes all the predicted films into consideration and measures the average
    square error between true and predicted labels. However, end users are usually
    interested only in the top results which appear on the first page of a website.
    This indicates that they are not really interested in films with lower ratings
    appearing at the end of the search result which are also equally estimated by
    standard regression metrics.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '*MSE*考虑了所有预测的电影，并测量真实标签与预测标签之间的平均平方误差。然而，最终用户通常只对显示在网站首页的前几项结果感兴趣。这表明，他们对搜索结果末尾的低评分电影并不真正感兴趣，这些电影在标准回归指标下也被同等估计。'
- en: A simple example below demonstrates a pair of search results and measures the
    *MSE* value in each of them.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的简单示例演示了一对搜索结果，并测量每个结果中的*MSE*值。
- en: '![](../Images/6d98469d260e85bf22d7b32a9823e045.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/6d98469d260e85bf22d7b32a9823e045.png)'
- en: Error estimation for both queries shows that MSE is a bad metric for ranking.
    Green documents are relevant while red documents are irrelevant. The list of documents
    is shown in the order of predicted relevance (from left to right).
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 对两个查询的错误估计表明MSE是排名的糟糕指标。绿色文档是相关的，而红色文档是不相关的。文档列表按预测相关性排序（从左到右）。
- en: 'Though the second search result has a lower *MSE*, the user will not be satisfied
    with such a recommendation. By first looking only at non-relevant items, the user
    will have to scroll up all the way down to find the first relevant item. That
    is why from the user experience perspective, the first search result is much better:
    the user is just happy with the top item and proceeds to it while not caring about
    others.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管第二个搜索结果的*MSE*较低，但用户不会对这样的推荐感到满意。首先查看非相关项时，用户必须向下滚动才能找到第一个相关项。因此，从用户体验的角度来看，第一个搜索结果要好得多：用户对顶部的项感到满意，并继续使用，而不关心其他项。
- en: The same logic goes with classification metrics (*precision*, *recall*) which
    consider all items as well.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 相同的逻辑也适用于分类指标（*精确度*，*召回率*），这些指标也会考虑所有项目。
- en: '![](../Images/59d4c5db282399ff7a57603488e7dfb9.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/59d4c5db282399ff7a57603488e7dfb9.png)'
- en: Precision and recall formulas
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 精确度和召回率公式
- en: What do all of described metrics have in common? All of them treat all items
    equally and do not consider any differentiation between high and low-relevant
    results. That is why they are called **unranked**.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 所有描述的指标有什么共同点？它们都平等对待所有项，并且不考虑高相关和低相关结果之间的差异。这就是为什么它们被称为**未排序**的原因。
- en: 'By having gone through these two similar problematic examples above, the aspect
    we should focus on while designing a ranking metric seems more clear:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 通过上述两个相似的问题示例，我们在设计排名指标时需要关注的方面似乎更加明确：
- en: A ranking metric should put more weight on more relevant results while lowering
    or ignoring the less relevant ones.
  id: totrans-30
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 一个排名指标应该对更相关的结果给予更高的权重，同时降低或忽略不太相关的结果。
- en: Ranked metrics
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 排名指标
- en: Kendall Tau distance
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Kendall Tau 距离
- en: '[Kendall Tau distance](https://en.wikipedia.org/wiki/Kendall_tau_distance#:~:text=The%20Kendall%20tau%20rank%20distance,dissimilar%20the%20two%20lists%20are.)
    is based on the number of rank inversions.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '[Kendall Tau 距离](https://en.wikipedia.org/wiki/Kendall_tau_distance#:~:text=The%20Kendall%20tau%20rank%20distance,dissimilar%20the%20two%20lists%20are.)
    基于排名逆序对的数量。'
- en: An **invertion** is a pair of documents (i, j) such as document i having a greater
    relevance than document j, appears after on the search result than j.
  id: totrans-34
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**逆序对**是指文档 (i, j) 的一对，其中文档 i 的相关性大于文档 j，但在搜索结果中出现在 j 之后。'
- en: Kendall Tau distance calculates all the number of inversions in the ranking.
    The lower the number of inversions, the better the search result is. Though the
    metric might look logical, it still has a downside which is demonstrated in the
    example below.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: Kendall Tau 距离计算排名中的所有逆序对。逆序对越少，搜索结果越好。尽管该指标看起来合乎逻辑，但它仍然有一个缺点，这在下面的示例中有所展示。
- en: '![](../Images/a684a7b0cdb7d952f4199f8c4bb14aea.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a684a7b0cdb7d952f4199f8c4bb14aea.png)'
- en: Despite fewer number of inversions, the second ranking is still worse, from
    the user perspective
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管逆序对的数量较少，但从用户的角度来看，第二个排名仍然更差
- en: It seems like the second search result is better with only 8 inversions versus
    9 in the first one. Similarly to the *MSE* example above, the user is only interested
    in the first relevant result. By going through several non-relevant search results
    in the second case, the user experience will be worse than in the first case.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 似乎第二个搜索结果只有8个逆序对，比第一个结果的9个要好。类似于上面的*MSE*示例，用户只对第一个相关结果感兴趣。在第二种情况下经过几个不相关的搜索结果，用户体验会比第一种情况更差。
- en: Precision@k & Recall@k
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Precision@k & Recall@k
- en: Instead of usual *precision* and *recall*, it is possible to consider only at
    a certain number of top recommendations *k*. This way, the metric does not care
    about low-ranked results. Depending on the chosen value of *k*, the corresponding
    metrics are denoted as *precision@k* (*“precision at k”*) and *recall@k* (*“recall
    at k”*) respectively. Their formulas are shown below.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 与通常的*精确度*和*召回率*不同，我们可以考虑仅关注某个数量的前* k *个推荐项。这样，指标就不关心低排名的结果。根据所选的 *k* 值，相应的指标被称为*precision@k*（*“k时的精确度”*）和*recall@k*（*“k时的召回率”*）。它们的公式如下所示。
- en: '![](../Images/9686d387d426e71d6758a4479effeb6b.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/9686d387d426e71d6758a4479effeb6b.png)'
- en: precision@k and recall@k formulas
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: precision@k 和 recall@k 的公式
- en: Imagine top *k* results are shown to the user where each result can be relevant
    or not. *precision@k* measures the percentage of relevant results among top *k*
    results. At the same time, *recall@k* evaluates the ratio of relevant results
    among top *k* to the total number of relevant items in the whole dataset.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下，前* k *个结果显示给用户，其中每个结果可能相关也可能不相关。*precision@k* 衡量前 *k* 个结果中相关结果的百分比。同时，*recall@k*
    评估前 *k* 个相关结果占整个数据集中相关项总数的比例。
- en: To better understand the calculation process of these metrics, let us refer
    to the example below.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地理解这些指标的计算过程，让我们参考下面的示例。
- en: '![](../Images/383ebf3b1628d208bd32aa2141000c4d.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/383ebf3b1628d208bd32aa2141000c4d.png)'
- en: precision@k and recall@k calculation example. Green documents represent relevant
    items while the red ones correspond to irrelevant ones.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: precision@k 和 recall@k 计算示例。绿色文档表示相关项，而红色文档表示不相关项。
- en: 'There are 7 documents in the system (named from *A* to *G*). Based on its predictions,
    the algorithm chooses *k = 5* documents among them for the user. As we can notice,
    there are 3 relevant documents *(A, C, G)* among top *k = 5* which results in
    *precision@5* being equal to *3 / 5*. At the same time, *recall@5* takes into
    account relevant items in the whole dataset: there are 4 of them *(A, C, F* and
    *G)* making r*ecall@5 = 3 / 4*.'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 系统中有 7 个文档（命名为 *A* 到 *G*）。根据其预测，算法从中选择 *k = 5* 个文档给用户。如我们所见，前 *k = 5* 中有 3 个相关文档
    *(A, C, G)*，这导致 *precision@5* 等于 *3 / 5*。同时，*recall@5* 考虑了整个数据集中相关项目的数量：其中有 4
    个 *(A, C, F* 和 *G)*，使得 *recall@5 = 3 / 4*。
- en: '*recall@k* always increases with the growth of *k* making this metric not really
    objective in some scenarios. In the edge case where all the items in the system
    are shown to the user, the value of *recall@k* equals 100%. *precision@k* does
    not have the same monotonic property as *recall@k* has as it measures the ranking
    quality in relation to top *k* results, not in relation to the number of relevant
    items in the whole system. Objectivity is one of the reasons *precision@k* is
    usually a preferred metric over *recall@k* in practice.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '*recall@k* 随着 *k* 的增长总是增加，这使得该指标在某些情况下不完全客观。在边缘情况下，当系统中的所有项目都显示给用户时，*recall@k*
    的值等于 100%。*precision@k* 不具备与 *recall@k* 相同的单调性，因为它衡量的是与前 *k* 个结果相关的排名质量，而不是整个系统中相关项目的数量。客观性是
    *precision@k* 通常被实际应用中优于 *recall@k* 的原因之一。'
- en: AP@k (Average Precision) & MAP@k (Mean Average Precision)
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: AP@k (平均精度) & MAP@k (均值平均精度)
- en: The problem with vanilla *precision@k* is that it does not take into account
    the order of relevant items appearing among retrieved documents. For example,
    if there are 10 retrieved documents with 2 of them being relevant, *precision@10*
    will always be the same despite the location of these 2 documents among 10\. For
    instance, if the relevant items are located in positions *(1, 2)* or *(9, 10)*,
    the metric does differentiate both of these cases resulting in *precision@10*
    being equal to 0.2.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 普通的 *precision@k* 问题在于它没有考虑相关项在检索文档中的出现顺序。例如，如果检索到 10 个文档，其中 2 个是相关的，*precision@10*
    将始终相同，尽管这 2 个文档在 10 个文档中的位置不同。例如，如果相关项位于位置 *(1, 2)* 或 *(9, 10)*，该指标会区分这两种情况，结果
    *precision@10* 为 0.2。
- en: However, in real life, the system should give a higher weight to relevant documents
    ranked on the top rather than on the bottom. This issue is solved by another metric
    called ***average precision*** *(****AP****)*. As a normal *precision*, *AP* takes
    values between 0 and 1.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在实际应用中，系统应该对排名靠前的相关文档给予更高的权重，而不是排名靠后的。这一问题通过另一种指标 ***平均精度*** *(****AP****)*
    得以解决。与普通 *precision* 相同，*AP* 的取值范围在 0 和 1 之间。
- en: '![](../Images/bf4a3d8468dd45ddfa6c939bd0450003.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/bf4a3d8468dd45ddfa6c939bd0450003.png)'
- en: Average precision formula
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 平均精度公式
- en: '*AP@k* calculates the average value of *precision@i* for all values of *i*
    from 1 to *k* for those of which the *i*-th document is relevant.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '*AP@k* 计算从 1 到 *k* 所有值的 *precision@i* 的平均值，其中第 *i* 个文档是相关的。'
- en: '![](../Images/f9d8f96c85e626f45184ddd9311bd99c.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f9d8f96c85e626f45184ddd9311bd99c.png)'
- en: Average precision computed for two queries
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 对两个查询计算的平均精度
- en: 'In the figure above, we can see the same 7 documents. The response to the query
    *Q₁* resulted in *k* = 5 retrieved documents where 3 relevant documents are positioned
    at indexes *(1, 3, 4)*. For each of these positions *i*, *precision@i* is calculated:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在上图中，我们可以看到相同的 7 个文档。对查询 *Q₁* 的响应产生了 *k* = 5 个检索文档，其中 3 个相关文档位于索引 *(1, 3, 4)*。对每个位置
    *i*，计算 *precision@i*：
- en: '*precision@1 = 1 / 1*'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*precision@1 = 1 / 1*'
- en: '*precision@3 = 2 / 3*'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*precision@3 = 2 / 3*'
- en: '*precision@4 = 3 / 4*'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*precision@4 = 3 / 4*'
- en: 'All other mismatched indexes *i* are ignored. The final value of *AP@5* is
    computed as an average over the precisions above:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 所有其他不匹配的索引 *i* 被忽略。*AP@5* 的最终值是以上精度的平均值：
- en: '*AP@5 = (precision@1 + precision@3 + precision@4) / 3 = 0.81*'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*AP@5 = (precision@1 + precision@3 + precision@4) / 3 = 0.81*'
- en: For comparison, let us look at the response to another query *Q₂* which also
    contains 3 relevant documents among top *k*. Nevertheless, this time, 2 irrelevant
    documents are located higher in the top (at positions *(1, 3)*) than in the previous
    case which results in lower *AP@5* being equal to 0.53.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 为了比较，让我们看看对另一个查询 *Q₂* 的响应，该查询在前 *k* 个结果中也包含 3 个相关文档。然而，这次，2 个不相关的文档位于比前一个情况更高的位置（在位置
    *(1, 3)*)，这导致 *AP@5* 较低，为 0.53。
- en: 'Sometimes there is a need to evaluate the quality of the algorithm not on a
    single query but on multiple queries. For that purpose, the **mean average precision
    (*MAP*)** is utilised. Is is simply takes the mean of *AP* among several queries
    *Q*:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c8b4eaac9c7b671e0c16707a93edc155.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
- en: Mean average precision formula
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: 'The example below shows how *MAP* is calculated for 3 different queries:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/091d1dcf08fbe3ed72a37866e27c8c28.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
- en: AP and MAP computed for three queries
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: RR (Reciprocal Rank) & MRR (Mean Reciprocal Rank)
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Sometimes users are interested only in the first relevant result. Reciprocal
    rank is a metric which returns a number between 0 and 1 indicating how far from
    the top the first relevant result is located: if the document is located at position
    *k*, then the value of *RR* is *1 / k*.'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: Similarly to *AP* and *MAP*, ***mean reciprocal rank (MRR)*** measures the average
    *RR* among several queries.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ffb00e6581390162da75e400448751ea.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
- en: RR and MRR formulas
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: 'The example below shows how *RR* and *MRR* are computed for 3 queries:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/5e02fd3992f114c0a58a885e604f943c.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
- en: RR and MRR computed for three queries
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
- en: User-oriented metrics
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Though ranked metrics consider ranking positions of items thus being a preferable
    choice over the unranked ones, they still have a significant downside: the information
    about user behaviour is not taken into account.'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
- en: User-oriented approaches make certain assumptions about user behaviour and based
    on it, produce metrics that suit ranking problems better.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: DCG (Discounted Cumulative Gain) & nDCG (Normalized Discounted Cumulative Gain)
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The DCG metric usage is based on the following assumption:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: Highly relevant documents are more useful when appearing earlier in a search
    engine result list (have higher ranks) — [Wikipedia](https://en.wikipedia.org/wiki/Discounted_cumulative_gain)
  id: totrans-83
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: This assumption naturally represents how users evaluate higher search results,
    compared to those presented lower.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: 'In *DCG*, each document is assigned a gain which indicates how relevant a particular
    document is. Given a true relevance *Rᵢ* (real value) for every item, there exist
    several ways to define a gain. One of the most popular is:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6a71a47d9c564fc4d55b2a5eed8b59e3.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
- en: Possible gain formula in DCG
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: 'Basically, the exponent puts a strong emphasis on relevant items. For example,
    if a rating of a movie is assigned an integer between 0 and 5, then each film
    with a corresponding rating will approximatively have double importance, compared
    to a film with the rating reduced by 1:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7ecafe0a114225e95d136332d1942da1.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
- en: Gain function of relevance
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: 'Apart from it, based on its ranking position, each item receives a discount
    value: the higher the ranking position of an item, the higher the corresponding
    discount is. Discount acts as a penalty by proportionally reducing the item’s
    gain. In practice, the discount is usually chosen as a logarithmic function of
    a ranking index:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3033209d6c6bb2f563ccd481027548c5.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
- en: Discount formula in DCG
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/06a24bf09deacada8b4dde5250ebaad3.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
- en: Discount function of ranking position
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally, *DCG@k* is defined as the sum of a gain over a discount for all first
    k retrieved items:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/bd720cb2561e6555c1bf579671d84af7.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
- en: DCG formula in general
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: 'Replacing *gainᵢ* and *discountᵢ* with the formulas above, the expression takes
    the following form:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3150a812cca07bfde0acb0f987e71614.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
- en: DCG formula
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: To make *DCG* metric more interpretable, it is usually normalised by the maximum
    possible value of *DCGₘₐₓ* in the case of perfect ranking when all items are correctly
    sorted by their relevance. The resulting metric is called *nDCG* and takes values
    between 0 and 1.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0e294ad92e957a1b27fa26c682754a98.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
- en: nDCG formula
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: In the figure below, an example of *DCG* and *nDCG* calculation for 5 documents
    is shown.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b12d2758a69b238f31df63242006c4a2.png)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
- en: DCG and nDCG computed for a set of retrieved documents
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: RBP (Rank-Biased Precision)
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In the *RBP* workflow, the user does not have the intention to examine every
    possible item. Instead, he or she sequentially progresses from one document to
    another with probability *p* and with inverse probability *1 — p* terminates the
    search procedure at the current document. Each termination decision is taken independently
    and does not depend on the depth of the search. According to the conducted research,
    such user behaviour has been observed in many experiments. Based on the information
    from [Rank-Biased Precision for Measurement of Retrieval Effectiveness](https://people.eng.unimelb.edu.au/jzobel/fulltext/acmtois08.pdf),
    the workflow can be illustrated in the diagram below.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: Parameter p is called **persistence**.
  id: totrans-110
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](../Images/146a4b079a406eac2678d9934e7b65a1.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
- en: RBP model workflow
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: 'In this paradigm, the user looks always looks at the *1*-st document, then
    looks at the *2*-nd document with probability *p*, looks at the *3*-rd document
    with probability *p²* and so on. Ultimately, the probability of looking at document
    *i* becomes equal to:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/10d38ca1b4ea3472dfabb76e11f37cc1.png)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
- en: The user examines document *i* in only when document *i* has just already been
    looked at and the search procedure is immediately terminated with probability
    *1 — p*.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c640e05dcd36f7bc77d2ec22ba5f1d76.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
- en: 'After that, it is possible to estimate the expected number of examined documents.
    Since *0 ≤ p ≤ 1*, the series below is convergent and the expression can be transformed
    into the following format:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/40a3161fcd455c647538a9098324bf44.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
- en: Similarly, given each document’s relevance *Rᵢ*, let us find the expected document
    relevance. Higher values of expected relevance indicate that the user will be
    more satisfied with the document he or she decides to examine.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/5af81dfedbb10bd8d323c87ac5f2358e.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
- en: 'Finally, *RPB* is computed as the ratio of expected document relevance (utility)
    to the expected number of checked documents:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/fa08fe56d1ca7af9050dcb1af6d863f4.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
- en: '*RPB* formulation makes sure that it takes values between 0 and 1\. Normally,
    relevance scores are of binary type (1 if a document is relevant, 0 otherwise)
    but can take real values between 0 and 1 as well.'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: The appropriate value of *p* should be chosen, based on how persistent users
    are in the system. Small values of *p* (less than 0.5) place more emphasis on
    top-ranked documents in the ranking. With bigger values of *p*, the weight on
    first positions is reduced and is distributed across lower positions. Sometimes
    it might be difficult to find out a good value of persistence *p*, so it is better
    to run several experiments and choose *p* which works the best.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/fe23bb4fbc2bd80e997f0bfb6f6f8910.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
- en: ERR (Expected Reciprocal Rank)
  id: totrans-126
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As the name suggests, this metric measures the average reciprocal rank across
    many queries.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
- en: 'This model is similar to *RPB* but with a little difference: if the current
    item is relevant (*Rᵢ*) for the user, then the search procedure ends. Otherwise,
    if the item is not relevant (*1 — Rᵢ)*, then with probability *p* the user decides
    whether he or she wants to continue the search process. If so, the search proceeds
    to the next item. Otherwise, the users ends the search procedure.'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ecc5175b0790f4bf1933993247436107.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
- en: ERR model workflow
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
- en: According to the presentation on [offline evaluation from Ilya Markov](https://drive.google.com/drive/folders/19OfEsLME1IR7bGPzVo8Dh31emcPNiaP_),
    let us find the formula for *ERR* calculation.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
- en: 'First of all, let us calculate the probability that the user looks at document
    i. Basically, it means that all *i — 1* previous documents were not relevant and
    at each iteration, the user proceeded with probability p to the next item:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d5af8cac0fabed1de7d48f4d2f3595f7.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
- en: If a user stops at document *i*, it means that this document has already been
    looked and with probability *Rᵢ*, the user has decided to terminate the search
    procedure. The probability corresponding to this event is actually the same as
    the reciprocal rank equals *1 / i*.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/16825649c5da24f24cc38ae512a23727.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
- en: 'From now, by simply using the formula for the expected value, it is possible
    to estimate the expected reciprocal rank:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3ec4e7e74aea183bb51e98735996012a.png)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
- en: Parameter p is usually chosen close to 1.
  id: totrans-138
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: As in the case of *RBP*, the values of *Rᵢ* can either be binary or real in
    the range from 0 to 1\. An example of *ERR* calculation is demonstrated in the
    figure below for a set of 6 documents.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6c287b27c5ff6aceef544d5f71a87fb7.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
- en: ERR calculation. The best and worst possible rankings are shown on the left
    and on the right respectively. For simplicity, parameter p is chosen as 1.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: On the left, all the retrieved documents are sorted in the descending order
    of their relevance resulting in the best possible *ERR*. Contrary to the situation
    on the right, the documents are presented in the ascending order of their relevance
    leading to the worst possible *ERR*.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 左侧，所有检索到的文档按相关性降序排列，得出最佳的*ERR*。与右侧情况相反，文档按相关性升序排列，导致最差的*ERR*。
- en: 'ERR formula assumes that all relevance scores are in the range from 0 to 1\.
    In case when initial relevance scores are given from out of that range, they need
    to be normalised. One of the most popular ways to do it is to exponentially normalise
    them:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: ERR公式假设所有相关性分数的范围是0到1。如果初始相关性分数超出这个范围，则需要进行归一化。最常见的做法之一是通过指数归一化：
- en: '![](../Images/4402786be1dbc5e678eb7bb92dc467f5.png)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/4402786be1dbc5e678eb7bb92dc467f5.png)'
- en: Conclusion
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结论
- en: 'We have discussed all the main metrics used for quality evaluation in information
    retrieval. User-oriented metrics are used more often because they reflect real
    user behaviour. Additionally, *nDCG*, *BPR* and *ERR* metrics have an advantage
    over other metrics we have looked at so far: they work with multiple relevance
    levels making them more versatile, in comparison to metrics like *AP*, *MAP* or
    *MRR* which are designed only for binary levels of relevance.'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 我们讨论了信息检索中用于质量评估的所有主要指标。用户导向的指标更常使用，因为它们反映了真实用户行为。此外，*nDCG*、*BPR*和*ERR*指标相对于我们迄今为止看到的其他指标具有优势：它们能够处理多个相关性级别，使其更具通用性，而像*AP*、*MAP*或*MRR*这样的指标仅适用于二元相关性级别。
- en: Unfortunately, all of the described metrics are either discontinuous or flat
    making the gradient at problematic points equal to 0 or even not defined. As a
    consequence, it is difficult for most ranking algorithms to optimise these metrics
    directly. However, a lot of research has been elaborated in this area and many
    advanced heuristics have appeared under the hood of the most popular ranking algorithms
    to solve this issue.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，所有这些描述的指标要么是不连续的，要么是平坦的，使得在问题点的梯度为0或甚至未定义。因此，大多数排名算法难以直接优化这些指标。然而，许多研究已经在这一领域展开，许多先进的启发式方法已经出现在最流行的排名算法的背后，以解决这个问题。
- en: Resources
  id: totrans-148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 资源
- en: '[Kendall Tau distance | Wikipedia](https://en.wikipedia.org/wiki/Kendall_tau_distance#:~:text=The%20Kendall%20tau%20rank%20distance,dissimilar%20the%20two%20lists%20are.)'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[肯德尔τ距离 | 维基百科](https://en.wikipedia.org/wiki/Kendall_tau_distance#:~:text=The%20Kendall%20tau%20rank%20distance,dissimilar%20the%20two%20lists%20are.)'
- en: '[Rank-Biased Precision for Measurement of Retrieval Effectiveness](https://people.eng.unimelb.edu.au/jzobel/fulltext/acmtois08.pdf)'
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[排名偏差精度测量检索效果](https://people.eng.unimelb.edu.au/jzobel/fulltext/acmtois08.pdf)'
- en: '[Discounted Cumulative Gain | Wikipedia](https://en.wikipedia.org/wiki/Discounted_cumulative_gain)'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[折扣累积增益 | 维基百科](https://en.wikipedia.org/wiki/Discounted_cumulative_gain)'
- en: '[Uncertainty in Rank-Biased Precision](https://staff.cdms.westernsydney.edu.au/~lapark/publications/laparkRBP2016.pdf)'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[排名偏差精度的不确定性](https://staff.cdms.westernsydney.edu.au/~lapark/publications/laparkRBP2016.pdf)'
- en: '[Information Retrieval, Offline Evaluation | Ilya Markov](https://drive.google.com/drive/folders/19OfEsLME1IR7bGPzVo8Dh31emcPNiaP_)'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[信息检索，离线评估 | 伊利亚·马尔科夫](https://drive.google.com/drive/folders/19OfEsLME1IR7bGPzVo8Dh31emcPNiaP_)'
- en: '*All images unless otherwise noted are by the author.*'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '*除非另有说明，所有图像均为作者所作。*'
