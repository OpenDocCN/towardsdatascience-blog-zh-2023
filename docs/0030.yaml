- en: What I learned after running AB tests for one year as a data scientist — Part
    1/2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/what-i-learned-after-running-ab-tests-for-one-year-as-a-data-scientist-part-1-2-5277911e89ec?source=collection_archive---------9-----------------------#2023-01-03](https://towardsdatascience.com/what-i-learned-after-running-ab-tests-for-one-year-as-a-data-scientist-part-1-2-5277911e89ec?source=collection_archive---------9-----------------------#2023-01-03)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Set up your A/B tests like a data scientist by following these simple steps
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@alex.vamvakaris.ds?source=post_page-----5277911e89ec--------------------------------)[![Alex
    Vamvakaris](../Images/bf8cf7c92a94d2b0d9242afcc03bf425.png)](https://medium.com/@alex.vamvakaris.ds?source=post_page-----5277911e89ec--------------------------------)[](https://towardsdatascience.com/?source=post_page-----5277911e89ec--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----5277911e89ec--------------------------------)
    [Alex Vamvakaris](https://medium.com/@alex.vamvakaris.ds?source=post_page-----5277911e89ec--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8072260dd591&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-i-learned-after-running-ab-tests-for-one-year-as-a-data-scientist-part-1-2-5277911e89ec&user=Alex+Vamvakaris&userId=8072260dd591&source=post_page-8072260dd591----5277911e89ec---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----5277911e89ec--------------------------------)
    ·13 min read·Jan 3, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5277911e89ec&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-i-learned-after-running-ab-tests-for-one-year-as-a-data-scientist-part-1-2-5277911e89ec&user=Alex+Vamvakaris&userId=8072260dd591&source=-----5277911e89ec---------------------clap_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5277911e89ec&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-i-learned-after-running-ab-tests-for-one-year-as-a-data-scientist-part-1-2-5277911e89ec&source=-----5277911e89ec---------------------bookmark_footer-----------)![](../Images/4c386c57ec8515e24726eff34021fe0a.png)'
  prefs: []
  type: TYPE_NORMAL
- en: Photo by [Nathan Dumlao](https://unsplash.com/@nate_dumlao?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/tSGHEbYSUGw?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  prefs: []
  type: TYPE_NORMAL
- en: A big part of what data scientists do is measuring differences. More specifically,
    comparing different versions of a product or service and determining which performs
    better. This is done through **randomized controlled trials** **(RCT)** or its
    more fancy business name of **A/B testing**.
  prefs: []
  type: TYPE_NORMAL
- en: The idea is very simple. We want to improve a specific KPI, like the conversion
    rate on the checkout page. We then assume that a certain change might positively
    affect our KPI of interest. For example, we might want to test changing the color
    of the checkout button from grey to green. We then randomly assign half of the
    visitors in the checkout page to see the current version (grey button) and the
    other half to see the new version (green button). The proper terminology for the
    current and new versions are **control** and **treatment**, respectively. As data
    scientists, our job is to measure the difference in conversion rate between the
    two versions and determine if it is statistically significant or due to luck (random
    variation).
  prefs: []
  type: TYPE_NORMAL
- en: 'In this series, I will take you through the entire journey of an A/B test,
    from designing the experiment to analyzing and presenting the results. The case
    study is designed to simulate the types of challenges that occur when conducting
    an A/B test in a real-world environment but also cover the key questions that
    pop up in data science interviews. The guide will be structured in two parts as
    follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Part 1
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**The Idea:** Overview of the business case study'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Designing the Test:** Selecting the population and KPIs of interest'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Pre-Test Analysis:** Estimating sample size using power and simulations'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Part 2: AB Test Analysis](/what-i-learned-after-running-ab-tests-for-one-year-as-a-data-scientist-part-2-2-4b30118fec26)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**EDA:** Sanity checks, time series visualizations'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Analyzing the results of the experiment:** P-values, confidence intervals,
    bootstrapping, etc.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 1\. The Idea
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '![](../Images/0404d12dfa4fe695274b9ce9ab0f45b3.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Riccardo Annandale](https://unsplash.com/@pavement_special?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/7e2pe9wjL9M?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  prefs: []
  type: TYPE_NORMAL
- en: For our case study, let’s imagine an e-commerce retailer selling Brazilian coffee
    beans in the UK. Every Friday, the company offers £10 off for every £50 spent.
    One of the product managers has been trying to improve the performance of the
    promotion and, through research, came up with an idea. If we changed the copy
    of the offer to be a percentage discount, it would be 20% off for every £50 spent.
    The train of thought was that 20 is higher than 10, so customers might perceive
    the same offer as being of higher value (even though 20% and £10 off are the same
    deal).
  prefs: []
  type: TYPE_NORMAL
- en: This is where our protagonist appears. Being very excited about the idea, the
    product manager schedules a call with one of the data scientists in the company
    and walks him through the idea. Our data scientist is no stranger to the idea
    of A/B testing as he had to help business stakeholders make such decisions numerous
    times in the past. And so our journey begins.
  prefs: []
  type: TYPE_NORMAL
- en: 2\. Designing the Test
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '![](../Images/7fd284eafa8167dfe57302988b8da822.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Alex wong](https://unsplash.com/@killerfvith?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/l5Tzv1alcps?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  prefs: []
  type: TYPE_NORMAL
- en: Population of Interest
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before proceeding any further, it is important to clearly define our experiment’s
    population of interest. For our example, that would be anyone that will visit
    the website on a Friday (i.e., when the offer is live). This is an important distinction.
    If a user visited the site on Monday, for example, there would be no purpose in
    adding them to the experiment as they would not be affected by the change of the
    offer.
  prefs: []
  type: TYPE_NORMAL
- en: Following that logic, you might also ask whether it is appropriate to include
    all visitors on a Friday. The offer may not be present on all pages, so only those
    that visited a page with the offer displayed should be included. You would be
    correct. For our case study, we assume that the offer is a banner on top of every
    page on the website (as shown below) to simplify things.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f7085c3301d58e5f56f3bd9a97720e1f.png)'
  prefs: []
  type: TYPE_IMG
- en: Design of two versions for the A/B test [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: Selecting KPIs of Interest
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Whether the idea for the experiment came from the CEO or a junior analyst, the
    need for a clear definition of the KPIs of interest is always present. But why
    is that the case? Why can’t we run the experiment and then look at all possible
    metrics that could be influenced?
  prefs: []
  type: TYPE_NORMAL
- en: Besides compromising efficiency, there is another reason for defining our KPIs
    before we start the test. In order to estimate (key word) the needed sample size
    for making accurate inferences, we must also know the variance of our KPIs. A
    more volatile metric, like average spent, will likely be skewed and have higher
    variance and outliers and so would require a much higher sample size compared
    to a symmetrical normally distributed metric.
  prefs: []
  type: TYPE_NORMAL
- en: Okay, so let’s get down to business. For our experiment, we are interested in
    two KPIs. Both are at the **visitor level** and are reasonably linked with the
    effect we expect from the new version. More visitors redeeming the offer (so higher
    ATPV) without decreasing their overall spending (higher ARPV or at least no harm
    to ARPV).
  prefs: []
  type: TYPE_NORMAL
- en: '**Average Revenue per Visitor (ARPV):** Total Revenue / Total No. of Visitors'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '**Average Transactions per Visitor (ATPV):** Total Transactions / Total No.
    of Visitors'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Time Windows
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You might have noticed that Friday is not in the formula of either metric. This
    is because we don’t care about increasing visitors’ spending on a Friday if that
    cannibalizes sales from other days of the week, thus leading to the same weekly
    or monthly spent. What we really care about is incrementally increasing their
    overall transactions and spending on a set time window.
  prefs: []
  type: TYPE_NORMAL
- en: 'Since most companies report their key KPIs monthly, we will also report our
    two KPIs on a 28-day window (other companies might operate on a weekly or bi-weekly
    basis and so 7-day or 14-day KPIs might be more appropriate):'
  prefs: []
  type: TYPE_NORMAL
- en: Each visitor enters the experiment on the first Friday they visit the site after
    the test is live. That would be their day 1
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We then gather data on the next 27 days, and we have our 28-day kpis for each
    visitor
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: So 28-day ARPV would be the sum of revenue in the 28 days after visitors entered
    the test, divided by the count of visitors
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Only visitors that were in the test for at least 28 days are included (not all
    visitors, as we want to give everyone the same time window of opportunity for
    purchasing)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The 28-day window also ensures there is no novelty effect (visitors being initially
    hyped with a change, but that quickly fades out after one week or two)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](../Images/ab1baf76bed7e9bcc14a8228106952d5.png)'
  prefs: []
  type: TYPE_IMG
- en: Example of 28-day windows for KPIs [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: These are all very important points to cover in an interview. Demonstrate your
    understanding of the population and which part of the funnel users enter the test
    (is it all pages or specific pages). Finally, always tie it together with the
    business needs. Explain the importance of clearly communicating with stakeholders
    the need for defining the KPIs and how you have designed your experiment in a
    way that primed it to be an asset!
  prefs: []
  type: TYPE_NORMAL
- en: 3\. Pre-Test Analysis
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '![](../Images/25aebfeacb7ee9f6f27ecc0aefd3f11b.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [AbsolutVision](https://unsplash.com/es/@freegraphictoday?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/uCMKx2H1Y38?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  prefs: []
  type: TYPE_NORMAL
- en: 'This is where the exciting part starts. Our main goal in this part of the pipeline
    is to estimate the needed sample size to accurately make inferences on our two
    KPIs. This part is known as power analysis. **Power analysis** allows us to estimate
    the required sample size, given the following three quantities:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Effect size**'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Significance level** = P(Type I error) = probability of finding an effect
    that is not there'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Power** = 1 — P(Type II error) = probability of finding an effect that is
    there'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We will set the significance level to 5% and power to 80% (we will cover these
    concepts in more detail in [**Part 2**](/what-i-learned-after-running-ab-tests-for-one-year-as-a-data-scientist-part-2-2-4b30118fec26)).
    Then we only need to compute the effect size to get our required sample size.
    Fortunately, [Cohen 1988](https://www.amazon.com/Statistical-Power-Analysis-Behavioral-Sciences/dp/0805802835)
    has equipped us with the formulas to calculate effect size when comparing two
    means (I have also added the formula for proportions as it is an often selected
    KPI like payer rate, etc.).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3f65accaebae6667cd7bd838fa456e3e.png)'
  prefs: []
  type: TYPE_IMG
- en: Formulas for effect size by [Cohen 1988](https://www.amazon.com/Statistical-Power-Analysis-Behavioral-Sciences/dp/0805802835)
    [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: But we are still not out of the woods just yet. We need to figure out the mean
    for the current and new version and their standard deviation. Since we do not
    know how our KPIs will perform in the future, we can look at historical data to
    find these numbers (as our best guess of what we expect them to be when the test
    goes live). So we will go back two months and pretend we started the experiment
    then. We will then compute the 28-day ARPV and 28-day ATPV. That yielded data
    for 20000 visitors (those who have been in the test for at least 28 days).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/64efc4063ddb0504b9c299f4b76f83af.png)'
  prefs: []
  type: TYPE_IMG
- en: Histograms of historical revenue and transactions [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: From that data, we can initially get a better idea of the distribution of our
    two KPIs — as you can see from the plots above, half of the users (10000) did
    not make any purchases in the 28-day window (0 revenue and transactions). We can
    also compute the mean for the current version (ARPV and ATPV) and the standard
    deviation for our effect size formulas. However, we are still missing the value
    for the mean for the new version. Of course, this is unknown as we do not have
    any data on how the new version will perform. However, we can declare the **minimum
    detectable effect (MDE)** we are interested in measuring, which in our case will
    be a 5% difference. We can then compute the new version mean as the current version
    increased by 5%.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/32072eecb2df983dc31ed57a4d03d046.png)'
  prefs: []
  type: TYPE_IMG
- en: Power graph of **ARPV** [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a885030f7a314e4e34aa0093d4d30544.png)'
  prefs: []
  type: TYPE_IMG
- en: Power graph of **ATPV** [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: Looking at the above, we have an estimate of 6464 and 7279 as the sample size
    for ARPV and ATPV. These estimates refer to the sample size for control and treatment
    separately, so in total, we need approximately a sample of 14000 visitors.
  prefs: []
  type: TYPE_NORMAL
- en: The curious reader might have noticed that power calculations are based on the
    assumption we will use the two-sample t-test for our analysis and works backward
    to give us the required sample size for a given effect size, significance level,
    and power. But that technique has some assumptions. Notably, it assumes that our
    data loosely follow the Normal distribution (i.e., are approximately symmetrical
    and centered around the mean). Looking at the histograms, this is clearly different
    for revenue and transactions. This might still be okay due to the Central Limit
    Theorem. We will cover the CLT in detail in [**Part 2**](/what-i-learned-after-running-ab-tests-for-one-year-as-a-data-scientist-part-2-2-4b30118fec26),
    but in general, with adequate sample size, deviations from the normal do not cause
    issues (the more skewed and non-symmetric the data, the higher the sample size
    we require). Nonetheless, I would also like to estimate the needed sample size
    without making assumptions, i.e., using a non-parametric approach.
  prefs: []
  type: TYPE_NORMAL
- en: An alternative way is to use the historical data and generate 2000 samples of
    a given size. So we can simulate 2000 random samples, each of size 100, from our
    data of 20000 observations. In each one of these samples, we can then randomly
    allocate half of the users into control and the other half into treatment and
    compute the differences between the metrics. Finally, we can visualize the 95%
    interval (from 0.025 to 0.975 quantile) of the 2000 differences in ARPV and ATPV
    and understand the variability in our KPIs. By experimenting with different sample
    sizes, we can then find the needed sample size for our MDE of 5%. So let’s create
    the function we will use to simulate samples.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: We can now use our function to generate samples of a given size from our historical
    data. We will use sample sizes of 500, 1000, 2000, 3000, 4000, 10000, 15000, and
    20000 and generate 2000 samples of each size.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/07102030d75ce60b5c7b98e50ee09627.png)'
  prefs: []
  type: TYPE_IMG
- en: Simulating variation of metrics in 2,000 samples of different sizes [Image by
    the author]
  prefs: []
  type: TYPE_NORMAL
- en: The results from above are in symphony with the results of our power analysis.
    Looking at a sample size of 15000, the 95% interval for both KPIs is between a
    -2% and 2% change. So if we take a sample of 15000 and allocate 7500 to control
    and treatment, we expect in a scenario of no difference to have a variability
    of four percentage points (from -2% to 2%). So if the uplift from the new version
    is 5%, we expect a sample of 15000 to return results between 3% and 7% (5%- 2%
    = 3% and 5% + 2% = 7%).
  prefs: []
  type: TYPE_NORMAL
- en: '**Summary**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'And with that last step, we are ready to launch our **RCT experiment!** Let’s
    summarise where we are:'
  prefs: []
  type: TYPE_NORMAL
- en: ✅ We defined the two versions of the test
  prefs: []
  type: TYPE_NORMAL
- en: ✅ We defined the population as all visitors on a Friday
  prefs: []
  type: TYPE_NORMAL
- en: ✅ Once visitors enter the test, they will be split randomly into control and
    treatment (50% — 50%)
  prefs: []
  type: TYPE_NORMAL
- en: '✅ We defined our two KPIs of interest: 28-day ARPV and 28-day ATPV'
  prefs: []
  type: TYPE_NORMAL
- en: ✅ We estimated the sample size for our experiment using both power and simulations
    at 15000 (7500 for control and treatment, respectively)
  prefs: []
  type: TYPE_NORMAL
- en: In the next article of this series, we will dive in and learn how to analyze
    the results from our A/B test. If you want to play with the data yourself, you
    can see below the code I used to generate our dataset of 20000 observations.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '**Stay in Touch**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you enjoyed reading this article and want to learn more, don’t forget to
    [subscribe](https://medium.com/@alex.vamvakaris.ds/subscribe) to get my stories
    sent directly to your inbox.
  prefs: []
  type: TYPE_NORMAL
- en: On the link below, you can also find a free PDF Walkthrough on completing a
    Customer Cluster Analysis in a real-life business scenario using data science
    techniques and best practices in R.
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://www.aspiringdatascientist.net/community?source=post_page-----5277911e89ec--------------------------------)
    [## Data Science Project Checklist - Aspiring Data Scientist'
  prefs: []
  type: TYPE_NORMAL
- en: I am a Data Scientist with 7+ years of analytics experience, currently working
    in a gaming company in London, UK. My…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: www.aspiringdatascientist.net](https://www.aspiringdatascientist.net/community?source=post_page-----5277911e89ec--------------------------------)
  prefs: []
  type: TYPE_NORMAL
