# å®¤å†…å»ºæ¨¡çš„ 3D ç‚¹äº‘å½¢çŠ¶æ£€æµ‹

> åŽŸæ–‡ï¼š[`towardsdatascience.com/3d-point-cloud-shape-detection-for-indoor-modelling-70e36e5f2511`](https://towardsdatascience.com/3d-point-cloud-shape-detection-for-indoor-modelling-70e36e5f2511)

## [åŠ¨æ‰‹æ•™ç¨‹](https://towardsdatascience.com/tagged/hands-on-tutorials)ï¼Œ3D Python

## 10 æ­¥ Python æŒ‡å—ï¼Œç”¨äºŽè‡ªåŠ¨åŒ– 3D å½¢çŠ¶æ£€æµ‹ã€åˆ†å‰²ã€èšç±»å’Œä½“ç´ åŒ–ï¼Œä»¥å®žçŽ°å®¤å†…ç‚¹äº‘æ•°æ®é›†çš„ç©ºé—´å ç”¨ 3D å»ºæ¨¡ã€‚

[](https://medium.com/@florentpoux?source=post_page-----70e36e5f2511--------------------------------)![Florent Poux, Ph.D.](https://medium.com/@florentpoux?source=post_page-----70e36e5f2511--------------------------------)[](https://towardsdatascience.com/?source=post_page-----70e36e5f2511--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----70e36e5f2511--------------------------------) [Florent Poux, Ph.D.](https://medium.com/@florentpoux?source=post_page-----70e36e5f2511--------------------------------)

Â·å‘å¸ƒäºŽ [Towards Data Science](https://towardsdatascience.com/?source=post_page-----70e36e5f2511--------------------------------) Â·é˜…è¯»æ—¶é•¿ 28 åˆ†é’ŸÂ·2023 å¹´ 9 æœˆ 7 æ—¥

--

å¦‚æžœä½ æœ‰ç‚¹äº‘æˆ–æ•°æ®åˆ†æžçš„ç»éªŒï¼Œä½ çŸ¥é“è¯†åˆ«æ¨¡å¼æœ‰å¤šé‡è¦ã€‚è¯†åˆ«å…·æœ‰ç›¸ä¼¼æ¨¡å¼çš„æ•°æ®ç‚¹æˆ–â€œå¯¹è±¡â€å¯¹èŽ·å–æœ‰ä»·å€¼çš„è§è§£è‡³å…³é‡è¦ã€‚æˆ‘ä»¬çš„è§†è§‰è®¤çŸ¥ç³»ç»Ÿå¯ä»¥è½»æ¾å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼Œä½†é€šè¿‡è®¡ç®—æ–¹æ³•å¤åˆ¶è¿™ç§äººç±»èƒ½åŠ›æ˜¯ä¸€ä¸ªé‡å¤§æŒ‘æˆ˜ã€‚

ç›®æ ‡æ˜¯åˆ©ç”¨äººç±»è§†è§‰ç³»ç»Ÿè‡ªç„¶çš„å…ƒç´ åˆ†ç»„å€¾å‘ã€‚ðŸ‘€

![](img/f7a3a366e3f8d7cc6c3e1b7a11307505.png)

3D ç‚¹äº‘åˆ†å‰²é˜¶æ®µç»“æžœç¤ºä¾‹ã€‚Â© F. Poux

## ä½†è¿™æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

é¦–å…ˆï¼Œå®ƒé€šè¿‡å°†æ•°æ®åˆ†ç»„åˆ°ä¸åŒçš„æ®µä¸­ï¼Œè®©ä½ è½»æ¾è®¿é—®å’Œå¤„ç†æ•°æ®çš„ç‰¹å®šéƒ¨åˆ†ã€‚å…¶æ¬¡ï¼Œé€šè¿‡æŸ¥çœ‹åŒºåŸŸè€Œä¸æ˜¯å•ä¸ªç‚¹ï¼Œå®ƒä½¿æ•°æ®å¤„ç†æ›´å¿«ã€‚è¿™å¯ä»¥èŠ‚çœå¤§é‡æ—¶é—´å’Œç²¾åŠ›ã€‚æœ€åŽï¼Œåˆ†å‰²å¯ä»¥å¸®åŠ©ä½ å‘çŽ°é€šè¿‡æŸ¥çœ‹åŽŸå§‹æ•°æ®æ— æ³•çœ‹åˆ°çš„æ¨¡å¼å’Œå…³ç³»ã€‚ðŸ” æ€»çš„æ¥è¯´ï¼Œåˆ†å‰²å¯¹äºŽä»Žç‚¹äº‘æ•°æ®ä¸­èŽ·å–æœ‰ç”¨ä¿¡æ¯è‡³å…³é‡è¦ã€‚å¦‚æžœä½ ä¸ç¡®å®šå¦‚ä½•åšï¼Œåˆ«æ‹…å¿ƒâ€”â€”æˆ‘ä»¬ä¼šä¸€èµ·æžå®šçš„ï¼ðŸ¤¿

## ç­–ç•¥

åœ¨æˆ‘ä»¬ä»¥æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆå¤„ç†é¡¹ç›®ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ¡†å®šæ•´ä½“æ–¹æ³•ã€‚æœ¬æ•™ç¨‹éµå¾ªä¸€ä¸ªç”±åä¸ªç®€å•æ­¥éª¤ç»„æˆçš„ç­–ç•¥ï¼Œå¦‚ä¸‹æ–¹çš„ç­–ç•¥å›¾æ‰€ç¤ºã€‚

![](img/49c746a4375f4f284fe81f501c11fb4f.png)

æœ¬æŒ‡å—å±•ç¤ºäº† 3D ç‚¹äº‘å®¤å†…å»ºæ¨¡çš„å·¥ä½œæµç¨‹ã€‚Â© F. Poux

ç­–ç•¥å·²åˆ—å‡ºï¼Œä¸‹é¢ä½ å¯ä»¥æ‰¾åˆ°ä¸åŒæ­¥éª¤çš„å¿«æ·é“¾æŽ¥ï¼š

```py
Step 1\. Environment Setup
Step 2\. 3D Data Preparation
Step 3\. Data Pre-Processing
Step 4\. Parameter Setting
Step 5\. RANSAC Planar Detection
Step 6\. Multi-Order RANSAC
Step 7\. Euclidean Clustering Refinement
Step 8\. Voxelization Labelling
Step 9\. Indoor Spatial Modelling
Step 10\. 3D Workflow Export
```

æ—¢ç„¶æˆ‘ä»¬å·²åšå¥½å‡†å¤‡ï¼Œé‚£å°±ç›´æŽ¥å¼€å§‹å§ã€‚

ðŸŽµ**è¯»è€…æ³¨æ„**ï¼šæ­¤åŠ¨æ‰‹æŒ‡å—æ˜¯* [***UTWENTE***](https://www.itc.nl/) *è”åˆå·¥ä½œçš„ä¸€éƒ¨åˆ†ï¼Œç”±* ***F. Poux*** *å’Œ* ***V. Lehtola*** *å…±åŒä½œè€…ã€‚æˆ‘ä»¬æ„Ÿè°¢æ¥è‡ªæ•°å­—åŒèƒžèƒŽ* [*@ITC*](http://twitter.com/ITC) *é¡¹ç›®çš„èµ„åŠ©ï¼Œè¯¥é¡¹ç›®ç”±ç‰¹æ¸©ç‰¹å¤§å­¦ ITC ç³»æä¾›ã€‚***æ‰€æœ‰å›¾åƒ Â© Florent Poux***ã€‚*

# 1\. è®¾ç½®æ‚¨çš„ Python çŽ¯å¢ƒã€‚

![](img/b862dfa664dd54db82f77e3449a9a117.png)

åœ¨ä¸‹é¢çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•å¿«é€Ÿè®¾ç½® Anaconda çŽ¯å¢ƒå¹¶ä½¿ç”¨ IDE JupyterLab ç®¡ç†ä»£ç ã€‚å¦‚æžœæ‚¨ç»§ç»­ä»¥è¿™ç§æ–¹å¼è®¾ç½®è‡ªå·±ï¼Œæ‚¨å°†æˆä¸ºä¸€åå®Œæ•´çš„ Python åº”ç”¨ç¨‹åºå¼€å‘è€… ðŸ˜†ã€‚

[](/3d-python-workflows-for-lidar-point-clouds-100ff40e4ff0?source=post_page-----70e36e5f2511--------------------------------) ## 3D Python å·¥ä½œæµç¨‹ç”¨äºŽ LiDAR åŸŽå¸‚æ¨¡åž‹ï¼šé€æ­¥æŒ‡å—

### è§£é” 3D åŸŽå¸‚å»ºæ¨¡åº”ç”¨ç¨‹åºçš„ç²¾ç®€å·¥ä½œæµç¨‹çš„ç»ˆæžæŒ‡å—ã€‚æ•™ç¨‹æ¶µç›–äº† Python...

towardsdatascience.com

ðŸ¦Š **Florent**ï¼š*æˆ‘å¼ºçƒˆæŽ¨èä½¿ç”¨æ¡Œé¢è®¾ç½®æˆ– IDEï¼Œé¿å…ä½¿ç”¨ Google Colabï¼Œå°¤å…¶æ˜¯å½“æ‚¨éœ€è¦ä½¿ç”¨æä¾›çš„åº“å¯è§†åŒ– 3D ç‚¹äº‘æ—¶ï¼Œå› ä¸ºå®ƒä»¬åœ¨æœ€ä½³æƒ…å†µä¸‹ä¼šä¸ç¨³å®šï¼Œæœ€ç³Ÿç³•çš„æƒ…å†µä¸‹åˆ™æ— æ³•å·¥ä½œï¼ˆä¸å¹¸çš„æ˜¯â€¦ï¼‰ã€‚*

ðŸ¤  **Ville**ï¼š*æˆ‘ä»¬çŒœæ‚¨æ˜¯åœ¨ Windows ä¸Šè¿è¡Œï¼Ÿè¿™æ²¡é—®é¢˜ï¼Œä½†å¦‚æžœæ‚¨æƒ³è¿›å…¥è®¡ç®—æ–¹æ³•é¢†åŸŸï¼ŒLinux æ˜¯é¦–é€‰ï¼*

å¥½å§ï¼Œæˆ‘ä»¬å°†é‡‡å–ä¸€ç§â€œå¿«é€Ÿæˆæžœâ€çš„æ–¹æ³•ã€‚å®žé™…ä¸Šï¼Œæˆ‘ä»¬å°†é€šè¿‡éµå¾ªæœ€ç®€åŒ–çš„ç¼–ç æ–¹æ³•æ¥å®žçŽ°å“è¶Šçš„åˆ†å‰²ðŸ’»ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯¹åº•å±‚åº“éžå¸¸æŒ‘å‰”ï¼æˆ‘ä»¬å°†ä½¿ç”¨ä¸‰ä¸ªéžå¸¸å¼ºå¤§çš„åº“ï¼Œåˆ†åˆ«æ˜¯`numpy`ã€`matplotlib`å’Œ`open3d`ã€‚

å¥½çš„ï¼Œè¦åœ¨ä¸€ä¸ªå…¨æ–°çš„è™šæ‹ŸçŽ¯å¢ƒä¸­å®‰è£…ä¸Šè¿°åº“åŒ…ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä»Ž`cmd`ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```py
conda install numpy
conda install matplotlib
pip install open3d==0.16.0
```

ðŸœ ***å…è´£å£°æ˜Ž***ï¼š*æˆ‘ä»¬é€‰æ‹©äº† Pythonï¼Œè€Œä¸æ˜¯ C++ æˆ– Juliaï¼Œæ‰€ä»¥æ€§èƒ½å°±æ˜¯é‚£æ · ðŸ˜„ã€‚å¸Œæœ›å®ƒèƒ½æ»¡è¶³æ‚¨çš„åº”ç”¨éœ€æ±‚ ðŸ˜‰ï¼Œå¯¹äºŽæˆ‘ä»¬æ‰€è°“çš„â€œç¦»çº¿â€è¿‡ç¨‹ï¼ˆéžå®žæ—¶ï¼‰ã€‚*

åœ¨æ‚¨çš„ Python IDE ä¸­ï¼Œè¯·ç¡®ä¿å¯¼å…¥å°†è¢«é¢‘ç¹ä½¿ç”¨çš„ä¸‰ä¸ªåº“ï¼š

```py
#%% 1\. Library setup
import numpy as np
import open3d as o3d
import matplotlib.pyplot as plt
```

å°±è¿™æ ·ï¼æˆ‘ä»¬å‡†å¤‡å¥½è¿›è¡Œå®¤å†…ç‚¹äº‘å»ºæ¨¡å·¥ä½œæµç¨‹äº†ï¼

# 2\. ç‚¹äº‘æ•°æ®å‡†å¤‡

![](img/e18d10ffc4d22a7dfa415f9b85211b8a.png)

åœ¨ä¹‹å‰çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•å¤„ç†ç‚¹äº‘å¹¶åœ¨ä½¿ç”¨ AHN4 LiDAR æ´»åŠ¨èŽ·å–çš„ 3D æ•°æ®é›†ä¸Šè¿›è¡Œç½‘æ ¼åŒ–ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªé€šè¿‡åœ°é¢æ¿€å…‰æ‰«æä»ªæ”¶é›†çš„æ•°æ®é›†ï¼šITC æ–°å»ºç­‘ã€‚å®ƒè¢«ç»„ç»‡æˆä¸‰ä¸ªä¸åŒçš„é›†åˆä¾›æ‚¨å®žéªŒã€‚ç´«è‰²çš„æ˜¯æˆ·å¤–éƒ¨åˆ†ã€‚çº¢è‰²æ˜¯åœ°é¢å±‚ï¼Œç»¿è‰²æ˜¯ç¬¬ä¸€å±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](img/a3a4446fe2fae77b40da248fa8e3081b.png)

ä½¿ç”¨çš„ ITC æ•°æ®é›†çš„ 3D ç‚¹äº‘éƒ¨åˆ†ã€‚Â© F. Poux

ä½ å¯ä»¥ä»Žè¿™é‡Œä¸‹è½½æ•°æ®ï¼š[ITC æ•°æ®é›†](https://drive.google.com/drive/folders/1sCBT1lc9A8Zn4grpxwFrBrvos86c0HZR?usp=share_link)ã€‚ä¸€æ—¦ä½ åœ¨æœ¬åœ°å¯¹æ•°æ®æœ‰äº†ç‰¢å›ºçš„æŽŒæ¡ï¼Œä½ å¯ä»¥ç”¨ä¸¤è¡Œç®€å•çš„ä»£ç å°†æ•°æ®é›†åŠ è½½åˆ°ä½ çš„ Python æ‰§è¡ŒçŽ¯å¢ƒä¸­ï¼š

```py
DATANAME = "ITC_groundfloor.ply"
pcd = o3d.io.read_point_cloud("../DATA/" + DATANAME)
```

ðŸ¦Š **Florent**: *è¿™æ®µ Python ä»£ç ç‰‡æ®µä½¿ç”¨* `*Open3D*` *åº“æ¥è¯»å–ä½äºŽç›®å½•â€œ*`*../DATA/*`*â€ä¸­çš„ç‚¹äº‘æ•°æ®æ–‡ä»¶* `*ITC_groundfloor.ply*` *ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å˜é‡* `*pcd*`*ã€‚*

å˜é‡çŽ°åœ¨ä¿å­˜ç€ä½ çš„ç‚¹äº‘ `pcd`ï¼Œä½ å°†ç”¨ä»¥ä¸‹ä»£ç è¿›è¡Œæ“ä½œï¼š

![](img/6ac078d0d708734f455c9e8907b18642.png)

ä¸€æ—¦ç‚¹äº‘æ•°æ®æˆåŠŸåŠ è½½åˆ° Open3D ä¸­ï¼Œä¸‹ä¸€æ­¥æ˜¯åº”ç”¨å„ç§é¢„å¤„ç†æŠ€æœ¯æ¥æå‡å…¶è´¨é‡å¹¶æå–æœ‰æ„ä¹‰çš„ä¿¡æ¯ã€‚

# 3\. ç‚¹äº‘é¢„å¤„ç†

![](img/0bb8b750bb4d32115dac7abbc406fbde.png)

å¦‚æžœä½ æ‰“ç®—åœ¨ `open3d` ä¸­å¯è§†åŒ–ç‚¹äº‘ï¼Œå»ºè®®ä½ å°†ç‚¹äº‘ç§»åŠ¨ä»¥ç»•è¿‡å¤§åæ ‡çš„è¿‘ä¼¼ï¼Œè¿™æ ·å¯ä»¥é¿å…äº§ç”Ÿæ™ƒåŠ¨çš„å¯è§†åŒ–æ•ˆæžœã€‚è¦å¯¹ä½ çš„ `pcd` ç‚¹äº‘åº”ç”¨è¿™ç§ç§»åŠ¨ï¼Œé¦–å…ˆèŽ·å–ç‚¹äº‘çš„ä¸­å¿ƒï¼Œç„¶åŽé€šè¿‡ä»ŽåŽŸå§‹å˜é‡ä¸­å‡åŽ»å®ƒæ¥è¿›è¡Œå¹³ç§»ï¼š

```py
pcd_center = pcd.get_center()
pcd.translate(-pcd_center)
```

çŽ°åœ¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç è¡Œè¿›è¡Œäº¤äº’å¼å¯è§†åŒ–ï¼š

```py
o3d.visualization.draw_geometries([pcd])
```

ðŸ¦š **æ³¨æ„**: `o3d.visualization.draw_geometries([pcd])` *è°ƒç”¨äº†* `*draw_geometries()*` *å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å±žäºŽ Open3D çš„* `*visualization*` *æ¨¡å—ã€‚è¯¥å‡½æ•°æŽ¥å—ä¸€ä¸ªå‡ ä½•ä½“åˆ—è¡¨ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨å¯è§†åŒ–çª—å£ä¸­æ˜¾ç¤ºå®ƒä»¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ—è¡¨åŒ…å«ä¸€ä¸ªå‡ ä½•ä½“ï¼Œå³è¡¨ç¤ºç‚¹äº‘çš„* `*pcd*` *å˜é‡ã€‚* `*draw_geometries()*` *å‡½æ•°åˆ›å»ºä¸€ä¸ª 3D å¯è§†åŒ–çª—å£å¹¶æ¸²æŸ“ç‚¹äº‘ã€‚ä½ å¯ä»¥ä¸Žå¯è§†åŒ–çª—å£äº’åŠ¨ä»¥æ—‹è½¬ã€ç¼©æ”¾ï¼Œå¹¶ä»Žä¸åŒè§’åº¦æŽ¢ç´¢ç‚¹äº‘ã€‚*

![](img/38196ff8a2b3f0d77fa32690deefe8ba.png)![](img/1b23848831179d63eccaa3cf24969e6a.png)

å¤ªæ£’äº†ðŸ‘Œï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½æµ‹è¯•ä¸€äº›é‡‡æ ·ç­–ç•¥æ¥ç»Ÿä¸€æˆ‘ä»¬çš„ä¸‹æ¸¸å¤„ç†ã€‚

## 3.1\. ç‚¹äº‘éšæœºé‡‡æ ·

è®©æˆ‘ä»¬è€ƒè™‘é‚£äº›å¯ä»¥æœ‰æ•ˆå‡å°‘ç‚¹äº‘å¤§å°åŒæ—¶ä¿æŒæ•´ä½“ç»“æž„å®Œæ•´æ€§å’Œä»£è¡¨æ€§çš„æ–¹æ³•ã€‚å¦‚æžœæˆ‘ä»¬å°†ç‚¹äº‘å®šä¹‰ä¸ºä¸€ä¸ªçŸ©é˜µ (m x n)ï¼Œé‚£ä¹ˆé€šè¿‡ä¿ç•™è¯¥çŸ©é˜µæ¯éš” n è¡Œçš„ä¸€ä¸ªè¡Œï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ª**ç®€åŒ–çš„ç‚¹äº‘**ï¼š

![](img/43048e0ad321a1ec9cb3b8607d68133a.png)

ä¸€ä¸ªç‚¹äº‘ç®€åŒ–ç­–ç•¥ã€‚Â© F. Poux

åœ¨çŸ©é˜µçº§åˆ«ï¼Œç®€åŒ–æ“ä½œæ˜¯é€šè¿‡æ ¹æ® n å› å­ä¿ç•™æ¯éš” n è¡Œçš„ç‚¹æ¥è¿›è¡Œçš„ã€‚å½“ç„¶ï¼Œè¿™å–å†³äºŽç‚¹åœ¨æ–‡ä»¶ä¸­çš„å­˜å‚¨æ–¹å¼ã€‚ç”¨ `open3d` åˆ‡ç‰‡ç‚¹äº‘æ˜¯ç›¸å½“ç›´æŽ¥çš„ã€‚ä¸ºäº†ç®€åŒ–å’Œå‚æ•°åŒ–è¡¨è¾¾å¼ï¼Œä½ å¯ä»¥å†™å‡ºä»¥ä¸‹ä»£ç ï¼š

```py
retained_ratio = 0.2
sampled_pcd = pcd.random_down_sample(retained_ratio)
```

ðŸ¦š **æ³¨æ„**ï¼š`sampled_pcd = pcd.random_down_sample(retained_ratio)` *å¯¹åŽŸå§‹ç‚¹äº‘* `*pcd*` *åº”ç”¨éšæœºä¸‹é‡‡æ ·ï¼Œä½¿ç”¨çš„æ˜¯* `random_down_sample()` *å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”± Open3D æä¾›ã€‚* `retained_ratio` *å‚æ•°å†³å®šäº†ä¸‹é‡‡æ ·åŽä¿ç•™çš„ç‚¹çš„æ¯”ä¾‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœ* `retained_ratio` *è®¾ç½®ä¸º 0.5ï¼Œåˆ™å¤§çº¦ 50% çš„ç‚¹å°†è¢«éšæœºé€‰æ‹©å¹¶ä¿ç•™åœ¨é‡‡æ ·åŽçš„ç‚¹äº‘ä¸­ã€‚*

```py
o3d.visualization.draw_geometries([sampled_pcd], window_name = "Random Sampling")
```

![](img/f4d15aa96e162454499be387b499b6e3.png)

ç‚¹äº‘çš„ä¸‹é‡‡æ ·ç»“æžœã€‚Â© F. Poux

ðŸŒ± **å‘å±•**ï¼š*åœ¨ç ”ç©¶ 3D ç‚¹äº‘æ—¶ï¼Œéšæœºé‡‡æ ·æœ‰å…¶å±€é™æ€§ï¼Œå¯èƒ½ä¼šå¯¼è‡´é—æ¼é‡è¦ä¿¡æ¯å’Œåˆ†æžä¸å‡†ç¡®ã€‚å®ƒæ²¡æœ‰è€ƒè™‘ç‚¹ä¹‹é—´çš„ç©ºé—´ç»„ä»¶æˆ–å…³ç³»ã€‚å› æ­¤ï¼Œä½¿ç”¨å…¶ä»–æ–¹æ³•ä»¥ç¡®ä¿æ›´å…¨é¢çš„åˆ†æžæ˜¯è‡³å…³é‡è¦çš„ã€‚*

å°½ç®¡è¿™ç§ç­–ç•¥å¿«é€Ÿï¼Œä½†éšæœºé‡‡æ ·å¯èƒ½ä¸é€‚åˆâ€œæ ‡å‡†åŒ–â€ç”¨ä¾‹ã€‚ä¸‹ä¸€æ­¥æ˜¯é€šè¿‡ç»Ÿè®¡å¼‚å¸¸å€¼åŽ»é™¤æŠ€æœ¯æ¥å¤„ç†æ½œåœ¨çš„å¼‚å¸¸å€¼ï¼Œä»¥ç¡®ä¿æ•°æ®çš„è´¨é‡å’Œå¯é æ€§ï¼Œä»¥ä¾¿è¿›è¡ŒåŽç»­åˆ†æžå’Œå¤„ç†ã€‚

## 3.2\. ç»Ÿè®¡å¼‚å¸¸å€¼åŽ»é™¤

å¯¹ 3D ç‚¹äº‘æ•°æ®ä½¿ç”¨å¼‚å¸¸å€¼è¿‡æ»¤å™¨å¯ä»¥å¸®åŠ©è¯†åˆ«å’ŒåŽ»é™¤ä»»ä½•æ˜¾è‘—ä¸åŒäºŽæ•°æ®é›†å…¶ä½™éƒ¨åˆ†çš„æ•°æ®ç‚¹ã€‚è¿™äº›å¼‚å¸¸å€¼å¯èƒ½æ˜¯ç”±äºŽæµ‹é‡è¯¯å·®æˆ–å…¶ä»–å› ç´ é€ æˆçš„ï¼Œè¿™äº›å› ç´ å¯èƒ½ä¼šå½±å“åˆ†æžã€‚é€šè¿‡åŽ»é™¤è¿™äº›å¼‚å¸¸å€¼ï¼Œæˆ‘ä»¬å¯ä»¥èŽ·å¾—æ›´æœ‰æ•ˆçš„æ•°æ®è¡¨ç¤ºï¼Œå¹¶æ›´å¥½åœ°è°ƒæ•´ç®—æ³•ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬éœ€è¦å°å¿ƒä¸è¦åˆ é™¤æœ‰ä»·å€¼çš„ç‚¹ã€‚

æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ª `statistical_outlier_removal` è¿‡æ»¤å™¨ï¼Œä»¥åŽ»é™¤ä¸Žå…¶é‚»å±…ç›¸æ¯”è¿œç¦»å¹³å‡å€¼çš„ç‚¹ã€‚å®ƒéœ€è¦ä¸¤ä¸ªè¾“å…¥å‚æ•°ï¼š

+   `nb_neighbors`ï¼Œç”¨äºŽæŒ‡å®šåœ¨è®¡ç®—ç»™å®šç‚¹çš„å¹³å‡è·ç¦»æ—¶è€ƒè™‘å¤šå°‘ä¸ªé‚»å±…ã€‚

+   `std_ratio`ï¼Œå…è®¸æ ¹æ®ç‚¹äº‘ä¸­å¹³å‡è·ç¦»çš„æ ‡å‡†å·®è®¾ç½®é˜ˆå€¼æ°´å¹³ã€‚è¿™ä¸ªæ•°å€¼è¶Šä½Žï¼Œè¿‡æ»¤å™¨çš„ä½œç”¨å°±è¶Šå¼ºã€‚

è¿™åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

```py
nn = 16
std_multiplier = 10

filtered_pcd, filtered_idx = pcd.remove_statistical_outlier(nn, std_multiplier)
```

ðŸ¦š **æ³¨æ„**ï¼š*`*remove_statistical_outlier()*` *å‡½æ•°é€šè¿‡æŒ‡å®šæ•°é‡çš„æœ€è¿‘é‚»ï¼ˆ*`*nn*`*ï¼‰å’Œä¸€ä¸ªæ ‡å‡†å·®ä¹˜æ•°ï¼ˆ*`*std_multiplier*`*ï¼‰æ¥å¯¹ç‚¹äº‘åº”ç”¨ç»Ÿè®¡å¼‚å¸¸å€¼åŽ»é™¤ã€‚è¯¥å‡½æ•°è¿”å›žä¸¤ä¸ªå€¼ï¼š* `*filtered_pcd*` *å’Œ* `*filtered_idx*`*ã€‚* `*filtered_pcd*` *è¡¨ç¤ºç»è¿‡æ»¤çš„ç‚¹äº‘ï¼Œå…¶ä¸­å·²åŽ»é™¤ç»Ÿè®¡å¼‚å¸¸å€¼ã€‚* `*filtered_idx*` *æ˜¯ä¸€ä¸ªç´¢å¼•æ•°ç»„ï¼Œå¯¹åº”äºŽåœ¨å¼‚å¸¸å€¼åŽ»é™¤è¿‡ç¨‹ä¸­ä¿ç•™çš„åŽŸå§‹ç‚¹äº‘* `*pcd*` *ä¸­çš„ç‚¹ã€‚*

ä¸ºäº†å¯è§†åŒ–è¿™ç§è¿‡æ»¤æŠ€æœ¯çš„ç»“æžœï¼Œæˆ‘ä»¬å°†å¼‚å¸¸å€¼æ ‡è®°ä¸ºçº¢è‰²ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬å¸Œæœ›å¯è§†åŒ–çš„ç‚¹äº‘å¯¹è±¡åˆ—è¡¨ä¸­ï¼š

```py
outliers = pcd.select_by_index(filtered_idx, invert=True)
outliers.paint_uniform_color([1, 0, 0])
o3d.visualization.draw_geometries([filtered_pcd, outliers])
```

![](img/6ef3e983fc62a7eda4eaf143ce2330a5.png)

å¼‚å¸¸å€¼åœ¨ç‚¹äº‘ä¸­ç”¨çº¢è‰²æ ‡è®°å’Œå¯è§†åŒ–ã€‚Â© F. Poux

åœ¨ä»Žç‚¹äº‘ä¸­ç§»é™¤ç»Ÿè®¡å¼‚å¸¸å€¼ä¹‹åŽï¼Œä¸‹ä¸€æ­¥æ˜¯åº”ç”¨åŸºäºŽä½“ç´ çš„é‡‡æ ·æŠ€æœ¯ï¼Œè¿›ä¸€æ­¥ä¸‹é‡‡æ ·æ•°æ®ï¼Œä»¥ä¾¿é«˜æ•ˆå¤„ç†å’Œåˆ†æžï¼ŒåŒæ—¶ä¿ç•™ç‚¹äº‘çš„åŸºæœ¬ç»“æž„ç‰¹å¾ã€‚

## 3.3. ç‚¹äº‘ä½“ç´ ï¼ˆç½‘æ ¼ï¼‰é‡‡æ ·

ç½‘æ ¼ä¸‹é‡‡æ ·ç­–ç•¥åŸºäºŽå°† 3D ç©ºé—´åˆ’åˆ†ä¸ºè§„åˆ™çš„ç«‹æ–¹ä½“å•å…ƒï¼Œç§°ä¸ºä½“ç´ ã€‚å¯¹äºŽè¿™ä¸ªç½‘æ ¼çš„æ¯ä¸ªå•å…ƒï¼Œæˆ‘ä»¬åªä¿ç•™ä¸€ä¸ªä»£è¡¨æ€§ç‚¹ï¼Œå¹¶ä¸”å¯ä»¥ç”¨ä¸åŒçš„æ–¹å¼é€‰æ‹©è¿™ä¸ªç‚¹ã€‚å½“ä¸‹é‡‡æ ·æ—¶ï¼Œæˆ‘ä»¬ä¿ç•™è¯¥å•å…ƒæœ€æŽ¥è¿‘é‡å¿ƒçš„ç‚¹ã€‚

![](img/802a55909c5aa28b959e4357b8e2f9e4.png)

ä½“ç´ ç½‘æ ¼é‡‡æ ·ç¤ºä¾‹ã€‚Â© F. Poux

å…·ä½“è€Œè¨€ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª`voxel_size`ï¼Œç„¶åŽç”¨å®ƒæ¥è¿‡æ»¤æˆ‘ä»¬çš„ç‚¹äº‘ï¼š

```py
voxel_size = 0.05
pcd_downsampled = filtered_pcd.voxel_down_sample(voxel_size = voxel_size)
```

ðŸ¦š **æ³¨æ„**ï¼š*æ­¤è¡Œå¯¹è¿‡æ»¤åŽçš„ç‚¹äº‘æ‰§è¡Œä½“ç´ ä¸‹é‡‡æ ·ï¼Œ* `*filtered_pcd*`*ï¼Œä½¿ç”¨* `*voxel_down_sample()*` *å‡½æ•°ã€‚* `*voxel_size*` *å‚æ•°æŒ‡å®šä½“ç´ ä¸‹é‡‡æ ·ç‚¹äº‘çš„æ¯ä¸ªä½“ç´ çš„å¤§å°ã€‚è¾ƒå¤§çš„ä½“ç´ å°ºå¯¸ä¼šå¯¼è‡´ç‚¹äº‘å¯†åº¦æ˜¾è‘—å‡å°‘ã€‚ä¸‹é‡‡æ ·æ“ä½œçš„ç»“æžœåˆ†é…ç»™å˜é‡* `*pcd_downsampled*`*ï¼Œä»£è¡¨ä¸‹é‡‡æ ·åŽçš„ç‚¹äº‘*ã€‚

çŽ°åœ¨æ˜¯ä»”ç»†å¯è§†åŒ–ä¸‹é‡‡æ ·åŽåˆ†å¸ƒçš„æ—¶é—´ï¼š

```py
o3d.visualization.draw_geometries([pcd_downsampled])
```

![](img/f65a10e76a7e48feae0b94ffc246e5db.png)

åº”ç”¨åœ¨ç‚¹äº‘ä¸Šçš„é‡‡æ ·ç­–ç•¥ç»“æžœã€‚Â© F. Poux

åœ¨æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬æœ‰ä¸€ç»„æœªåœ¨è¿›ä¸€æ­¥å¤„ç†æ—¶è§¦åŠçš„å¼‚å¸¸ç‚¹å’Œä¸€ä¸ªä¸‹é‡‡æ ·åŽçš„ç‚¹äº‘ï¼Œæž„æˆäº†åŽç»­è¿‡ç¨‹çš„æ–°ä¸»é¢˜ã€‚

## 3.4. ç‚¹äº‘æ³•çº¿æå–

ç‚¹äº‘æ³•çº¿æŒ‡çš„æ˜¯ 3D ç‚¹äº‘ä¸­ç‰¹å®šç‚¹å¤„è¡¨é¢çš„æ–¹å‘ã€‚å®ƒå¯ä»¥ç”¨äºŽé€šè¿‡å°†ç‚¹äº‘åˆ’åˆ†ä¸ºå…·æœ‰ç›¸ä¼¼æ³•çº¿çš„åŒºåŸŸæ¥è¿›è¡Œåˆ†å‰²ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæ³•çº¿å°†æœ‰åŠ©äºŽè¯†åˆ«ç‚¹äº‘ä¸­çš„ç‰©ä½“å’Œè¡¨é¢ï¼Œä½¿å…¶æ›´å®¹æ˜“å¯è§†åŒ–ã€‚è¿™ä¹Ÿæ˜¯ä»‹ç»ä¸€ç§åŠè‡ªåŠ¨è®¡ç®—æ³•çº¿çš„æ–¹æ³•çš„ç»ä½³æœºä¼šã€‚æˆ‘ä»¬é¦–å…ˆå®šä¹‰ç‚¹äº‘ä¸­æ¯ä¸ªç‚¹ä¸Žå…¶é‚»å±…ä¹‹é—´çš„å¹³å‡è·ç¦»ï¼š

```py
nn_distance = 0.05
```

ç„¶åŽï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™äº›ä¿¡æ¯åœ¨åŠå¾„ä¸º`radius_normals`çš„èŒƒå›´å†…æå–æœ‰é™çš„`max_nn`ä¸ªç‚¹ï¼Œä¸º 3D ç‚¹äº‘ä¸­çš„æ¯ä¸ªç‚¹è®¡ç®—æ³•çº¿ï¼š

```py
radius_normals=nn_distance*4
pcd_downsampled.estimate_normals(search_param=o3d.geometry.KDTreeSearchParamHybrid(radius=radius_normals, max_nn=16), fast_normal_computation=True)
```

çŽ°åœ¨ï¼Œ`pcd_downsampled`ç‚¹äº‘å¯¹è±¡å¾ˆé«˜å…´åœ°æ‹¥æœ‰æ³•çº¿ï¼Œå‡†å¤‡å±•ç¤ºå…¶æœ€æ¼‚äº®çš„ä¸€é¢ðŸ˜Šã€‚æ­¤æ—¶ä½ çŸ¥é“è¯¥åšä»€ä¹ˆï¼š

```py
pcd_downsampled.paint_uniform_color([0.6, 0.6, 0.6])
o3d.visualization.draw_geometries([pcd_downsampled,outliers])
```

![](img/92aa19172478994bb05bcd86ef4bd146.png)

ç”¨äºŽåŽç»­å®žéªŒçš„ç‚¹äº‘ã€‚

å®Œæˆç‚¹äº‘çš„ä½“ç´ ä¸‹é‡‡æ ·åŽï¼Œä¸‹ä¸€æ­¥æ˜¯é…ç½®ç‚¹äº‘å½¢çŠ¶æ£€æµ‹å’Œèšç±»çš„å‚æ•°ï¼Œè¿™åœ¨å°†ç›¸ä¼¼ç‚¹åˆ†ç»„ä»¥åŠä»Žä¸‹é‡‡æ ·ç‚¹äº‘æ•°æ®ä¸­æå–æœ‰æ„ä¹‰çš„ç»“æž„æˆ–å¯¹è±¡ä¸­èµ·ç€å…³é”®ä½œç”¨ã€‚

# 4\. ç‚¹äº‘å‚æ•°è®¾ç½®

![](img/4d43adb22c40912f783a2cb44c0064b4.png)

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ‚¨ç²¾é€‰äº†ä¸¤ç§æœ€æœ‰æ•ˆä¸”å¯é çš„ 3D å½¢çŠ¶æ£€æµ‹å’Œèšç±»æ–¹æ³•ï¼šRANSAC å’Œä½¿ç”¨ DBSCAN çš„æ¬§å‡ é‡Œå¾—èšç±»ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨è¿™äº›æ–¹æ³•ä¹‹å‰ï¼Œäº†è§£å‚æ•°çš„åŒæ—¶ï¼Œç†è§£åŸºæœ¬æ¦‚å¿µæ˜¯è‡³å…³é‡è¦çš„ã€‚

## RANSAC

RANSAC ç®—æ³•ï¼ŒRANdom SAmple Consensus çš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºŽå¤„ç†åŒ…å«å¼‚å¸¸å€¼çš„æ•°æ®ï¼Œè¿™åœ¨ä½¿ç”¨çŽ°å®žä¸–ç•Œä¼ æ„Ÿå™¨æ—¶å¸¸å¸¸ä¼šé‡åˆ°ã€‚è¯¥ç®—æ³•é€šè¿‡å°†æ•°æ®ç‚¹åˆ†ä¸ºä¸¤ç±»ï¼šå†…ç‚¹å’Œå¤–ç‚¹æ¥å·¥ä½œã€‚é€šè¿‡è¯†åˆ«å¹¶å¿½ç•¥å¤–ç‚¹ï¼Œæ‚¨å¯ä»¥ä¸“æ³¨äºŽå¤„ç†å¯é çš„å†…ç‚¹ï¼Œä»Žè€Œä½¿åˆ†æžæ›´åŠ æœ‰æ•ˆã€‚

![](img/a5c122fcaa8c0f6453ae2b2363de65b9.png)

åœ¨ 3D ç‚¹äº‘ä¸­ä½¿ç”¨ RANSAC è¿›è¡Œå¹³é¢æ£€æµ‹ã€‚Â© F. Poux

è®©æˆ‘ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜Ž RANSAC çš„å·¥ä½œåŽŸç†ã€‚å‡è®¾æˆ‘ä»¬æƒ³é€šè¿‡ä¸‹é¢çš„ç‚¹äº‘æ‹Ÿåˆä¸€ä¸ªå¹³é¢ã€‚æˆ‘ä»¬æ€Žä¹ˆåšå‘¢ï¼Ÿ

![](img/bb85346e13ae187ec137bef80050cce3.png)

åœ¨éšæœºç‚¹äº‘ä¸­è¿›è¡Œçš„ RANSAC å¹³é¢æ£€æµ‹æ¨¡æ‹Ÿã€‚Â© F. Poux

é¦–å…ˆï¼Œæˆ‘ä»¬ä»Žæ•°æ®ä¸­åˆ›å»ºä¸€ä¸ªå¹³é¢ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬ä»Žç‚¹äº‘ä¸­éšæœºé€‰æ‹© 3 ä¸ªç‚¹æ¥å»ºç«‹å¹³é¢ã€‚ç„¶åŽï¼Œæˆ‘ä»¬ç®€å•åœ°æ£€æŸ¥å‰©ä½™çš„ç‚¹ä¸­æœ‰å¤šå°‘ç‚¹è½åœ¨è¯¥å¹³é¢ä¸Šï¼ˆè¾¾åˆ°æŸä¸ªé˜ˆå€¼ï¼‰ï¼Œè¿™å°†ä¸ºææ¡ˆæ‰“åˆ†ã€‚

![](img/4162c310eb51619b469d062fc8078732.png)

RANSAC è¯„åˆ†ç³»ç»Ÿè¯´æ˜Žã€‚æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡è¿­ä»£éƒ½ä¼šéšæœºæŠ½å– 3 ä¸ªç‚¹ï¼Œä»Žä¸­åˆ›å»ºä¸€ä¸ªå¹³é¢ï¼Œç„¶åŽé€‰æ‹©è½åœ¨å¹³é¢ä¸Šçš„ç‚¹ã€‚åœ¨è¿™é‡Œï¼Œç¬¬ 159 æ¬¡è¿­ä»£ä¼šæ˜¯æœ€ä½³å€™é€‰ã€‚Â© F. Poux

ç„¶åŽï¼Œæˆ‘ä»¬ç”¨ 3 ä¸ªæ–°çš„éšæœºç‚¹é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œçœ‹çœ‹æ•ˆæžœå¦‚ä½•ã€‚æ˜¯æ›´å¥½äº†å—ï¼Ÿæ›´å·®äº†å—ï¼Ÿç„¶åŽï¼Œæˆ‘ä»¬åå¤è¿›è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œæ¯”å¦‚è¯´ 10 æ¬¡ã€100 æ¬¡ã€1000 æ¬¡ï¼Œç„¶åŽé€‰æ‹©å¾—åˆ†æœ€é«˜çš„å¹³é¢æ¨¡åž‹ï¼ˆå³å…·æœ‰æœ€ä½³â€œæ”¯æŒâ€çš„å‰©ä½™æ•°æ®ç‚¹ï¼‰ã€‚è¿™å°†æ˜¯æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆï¼šæ”¯æŒç‚¹åŠ ä¸Šæˆ‘ä»¬é‡‡æ ·çš„ä¸‰ä¸ªç‚¹æž„æˆæˆ‘ä»¬çš„**å†…ç‚¹é›†**ï¼Œå…¶ä½™éƒ¨åˆ†æ˜¯æˆ‘ä»¬çš„**å¤–ç‚¹é›†**ã€‚å¤Ÿç®€å•å§ ðŸ˜ï¼Ÿ

å“ˆå“ˆï¼Œå¯¹äºŽé‚£äº›æ€€ç–‘è€…ï¼Œä½ ä»¬éš¾é“æ²¡æœ‰ä¸€ä¸ªä¸Šå‡çš„é—®é¢˜å—ï¼Ÿæˆ‘ä»¬å¦‚ä½•å®žé™…ç¡®å®šåº”è¯¥é‡å¤å¤šå°‘æ¬¡è¿‡ç¨‹ï¼Ÿæˆ‘ä»¬åº”è¯¥å¤šé¢‘ç¹åœ°å°è¯•ï¼Ÿå¥½å§ï¼Œè¿™å®žé™…ä¸Šæ˜¯å¯ä»¥è®¡ç®—çš„ï¼Œä½†æˆ‘ä»¬å…ˆæŠŠå®ƒæ”¾åˆ°ä¸€è¾¹ï¼Œä¸“æ³¨äºŽå½“å‰çš„é—®é¢˜ï¼šç‚¹äº‘åˆ†å‰²ðŸ˜‰ã€‚

## RANSAC å‚æ•°è®¾ç½®

æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ RANSAC æ¥æ£€æµ‹ç‚¹äº‘ä¸­çš„ 3D å¹³é¢å½¢çŠ¶ã€‚ä½¿ç”¨ RANSAC æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸‰ä¸ªå‚æ•°ï¼šä¸€ä¸ªè·ç¦»é˜ˆå€¼`distance_threshold`ï¼Œç”¨äºŽå°†ç‚¹æ ‡è®°ä¸ºå†…ç‚¹æˆ–å¤–ç‚¹ï¼›ä¸€ä¸ªæœ€å°ç‚¹æ•°`ransac_n`ï¼Œç”¨äºŽæ‹Ÿåˆå‡ ä½•æ¨¡åž‹ï¼›ä¸€ä¸ªè¿­ä»£æ¬¡æ•°`num_iterations`ã€‚

**è·ç¦»é˜ˆå€¼çš„ç¡®å®š**ï¼šæˆ‘ä»¬å¯èƒ½ä¼šå› ä¸ºéœ€è¦ä¸€äº›é¢†åŸŸçŸ¥è¯†æ¥è®¾ç½®æœªæ¥çš„åˆ†å‰²å’Œå»ºæ¨¡é˜ˆå€¼è€Œå—åˆ°é™åˆ¶ã€‚å› æ­¤ï¼Œå°è¯•ç»•è¿‡è¿™ä¸€ç‚¹ä»¥ä½¿æ–¹æ³•å¯¹éžä¸“å®¶å¼€æ”¾å°†æ˜¯ä»¤äººå…´å¥‹çš„ã€‚æˆ‘ä»¬å°†ä¸Žä½ åˆ†äº«ä¸€ä¸ªç®€å•çš„æƒ³æ³•ï¼Œè¿™å¯èƒ½ä¼šæœ‰ç”¨ã€‚å¦‚æžœæˆ‘ä»¬è®¡ç®—æ•°æ®é›†ä¸­ç‚¹ä¹‹é—´çš„å¹³å‡è·ç¦»ï¼Œå¹¶å°†å…¶ä½œä¸ºè®¾ç½®é˜ˆå€¼çš„åŸºç¡€ï¼Œä¼šæ€Žæ ·å‘¢ï¼Ÿ

å¥½å§ï¼Œè¿™æ˜¯ä¸€ä¸ªå€¼å¾—æŽ¢ç´¢çš„æƒ³æ³•ã€‚ä¸ºäº†ç¡®å®šè¿™æ ·çš„å€¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ `KD-Tree` æ¥åŠ é€Ÿæ¯ä¸ªç‚¹çš„æœ€è¿‘é‚»æŸ¥è¯¢è¿‡ç¨‹ã€‚ä»Žé‚£é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢ç‚¹äº‘ä¸­æ¯ä¸ªç‚¹çš„ k ä¸ªæœ€è¿‘é‚»ï¼Œç„¶åŽå°†å…¶æ‰“åŒ…åˆ°ä¸‹é¢æ˜¾ç¤ºçš„ `open3d` å‡½æ•°ä¸­ï¼š

```py
nn_distance = np.mean(pcd.compute_nearest_neighbor_distance())
```

æ¯«æ— æ„å¤–ï¼Œå®ƒæŽ¥è¿‘ 5 cmï¼Œå› ä¸ºæˆ‘ä»¬å°†ç‚¹äº‘é‡‡æ ·åˆ°è¿™ä¸ªå€¼ã€‚è¿™æ„å‘³ç€å¦‚æžœæˆ‘ä»¬è€ƒè™‘æœ€è¿‘é‚»ï¼Œæˆ‘ä»¬ä¼šæœ‰ 51 mm çš„å¹³å‡è·ç¦»ã€‚

ðŸŒ± **æˆé•¿**ï¼š*ä»Žè¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥å°† RANSAC å‚æ•°è®¾ç½®ä¸ºä»Ž nn_distance å˜é‡å¾—å‡ºçš„å€¼ï¼Œè¿™æ ·å¯ä»¥æ ¹æ®è€ƒè™‘çš„æ•°æ®é›†è¿›è¡Œè°ƒæ•´ï¼Œè€Œä¸ä¾èµ–äºŽé¢†åŸŸçŸ¥è¯†ã€‚ä½ ä¼šæ€Žä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜ï¼Ÿ*

**ç‚¹æ•°çš„ç¡®å®š**ï¼šè¿™é‡Œå¾ˆç®€å•ã€‚æˆ‘ä»¬æƒ³è¦æ‰¾å‡ºå¹³é¢ï¼Œå› æ­¤æˆ‘ä»¬å°†å–å®šä¹‰ 3D å¹³é¢æ‰€éœ€çš„æœ€å°ç‚¹æ•°ï¼š3ã€‚

**è¿­ä»£æ¬¡æ•°çš„ç¡®å®š**ï¼šè¿­ä»£æ¬¡æ•°è¶Šå¤šï¼Œä½ çš„ 3D å½¢çŠ¶æ£€æµ‹å°±è¶Šç¨³å¥ï¼Œä½†æ‰€éœ€æ—¶é—´ä¹Ÿè¶Šé•¿ã€‚ç›®å‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è®¾ç½®ä¸º 1000ï¼Œè¿™æ ·å¯ä»¥èŽ·å¾—è‰¯å¥½çš„ç»“æžœã€‚æˆ‘ä»¬å°†åœ¨æœªæ¥çš„æ•™ç¨‹ä¸­æŽ¢ç´¢æ›´å¤šå·§å¦™çš„æ–¹æ³•æ¥æ‰¾å‡ºç‚¹äº‘çš„å™ªå£°æ¯”ä¾‹ã€‚ðŸ˜‰

ðŸ§™â€â™‚ï¸ **ä¸“å®¶**ï¼š*æœ‰ä¸€ç§è‡ªåŠ¨èŽ·å–æ¯æ¬¡è¿­ä»£æ¬¡æ•°çš„æ–¹æ³•ã€‚å¦‚æžœæˆ‘ä»¬å¸Œæœ›ä»¥æ¦‚çŽ‡ pï¼ˆä¾‹å¦‚ 99%ï¼‰æˆåŠŸï¼Œæ•°æ®ä¸­çš„ç¦»ç¾¤ç‚¹æ¯”ä¾‹æ˜¯ eï¼ˆä¾‹å¦‚ 60%ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ s ä¸ªç‚¹æ¥å®šä¹‰æˆ‘ä»¬çš„æ¨¡åž‹ï¼ˆè¿™é‡Œæ˜¯ 3ï¼‰ã€‚ä»¥ä¸‹å…¬å¼ç»™å‡ºäº†é¢„æœŸçš„è¿­ä»£æ¬¡æ•°ï¼š*

![](img/f34e9a8ff5e9d1dd5f22f9c860ef44df.png)

çŽ°åœ¨æˆ‘ä»¬å·²ç»å®šä¹‰äº† RANSAC å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç ”ç©¶ç¬¬ä¸€æ¬¡åˆ†å‰²è¿‡ç¨‹ã€‚

# 5\. ä½¿ç”¨ RANSAC è¿›è¡Œç‚¹äº‘åˆ†å‰²

![](img/17e07a01da7ba28e3c757053c097f9b7.png)

é¦–å…ˆå°†ä¸åŒçš„é˜ˆå€¼è®¾ç½®ä¸ºéžè‡ªåŠ¨å€¼è¿›è¡Œæµ‹è¯•ï¼š

```py
distance_threshold = 0.1
ransac_n = 3
num_iterations = 1000
```

ä»Žé‚£é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ RANSAC å¯¹ç‚¹äº‘è¿›è¡Œåˆ†å‰²ä»¥æ£€æµ‹å¹³é¢ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

```py
plane_model, inliers = pcd.segment_plane(distance_threshold=distance_threshold,ransac_n=3,num_iterations=1000)
[a, b, c, d] = plane_model
print(fâ€Plane equation: {a:.2f}x + {b:.2f}y + {c:.2f}z + {d:.2f} = 0")
```

æˆ‘ä»¬å°†ç»“æžœæ”¶é›†åˆ°ä¸¤ä¸ªå˜é‡ä¸­ï¼š`plane_model`ï¼Œå®ƒåŒ…å«å¹³é¢çš„å‚æ•° `a`,`b`,`c`,`d`ï¼Œä»¥åŠ `inliers` ä½œä¸ºç‚¹ç´¢å¼•ã€‚

è¿™ä½¿å¾—å¯ä»¥ä½¿ç”¨ç´¢å¼•å°†ç‚¹äº‘åˆ†å‰²ä¸º `inlier_cloud` ç‚¹é›†ï¼ˆæˆ‘ä»¬å°†å…¶æ ‡è®°ä¸ºçº¢è‰²ï¼‰å’Œ `outlier_cloud` ç‚¹é›†ï¼ˆæˆ‘ä»¬å°†å…¶æ ‡è®°ä¸ºç°è‰²ï¼‰ï¼š

```py
inlier_cloud = pcd.select_by_index(inliers)
outlier_cloud = pcd.select_by_index(inliers, invert=True)

#Paint the clouds
inlier_cloud.paint_uniform_color([1.0, 0, 0])
outlier_cloud.paint_uniform_color([0.6, 0.6, 0.6])

#Visualize the inliers and outliers
o3d.visualization.draw_geometries([inlier_cloud, outlier_cloud]) 
```

ðŸ¦Š **Florent** *ï¼š`*invert=True*` *å‚æ•°å…è®¸é€‰æ‹©ç¬¬ä¸€ä¸ªå‚æ•°çš„åä¹‰ï¼Œå³æ‰€æœ‰ä¸åœ¨* `*inliers*`* ä¸­çš„ç´¢å¼•ã€‚å¦‚æžœä½ ç¼ºå°‘é˜´å½±ï¼Œè®°å¾—è®¡ç®—æ³•çº¿ï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚*

![](img/36f15121cce1019bae4e2e1fe3e1ebcc.png)

ðŸŒ± **æˆé•¿**ï¼š*å°è¯•è°ƒæ•´å„ç§å‚æ•°ï¼Œå¹¶é€šè¿‡å®šæ€§åˆ†æžç ”ç©¶å…¶å½±å“ã€‚é¦–å…ˆè®°ä½è¦åŽ»ç›¸å…³å˜åŒ–ï¼ˆä¸€æ¬¡ä¸€ä¸ªå˜é‡ï¼‰ï¼›å¦åˆ™ä½ çš„åˆ†æžå¯èƒ½ä¼šæœ‰åå·®* ðŸ˜Šã€‚

![](img/385ce6263c78e78ca2ce72c1d56b7849.png)![](img/d0cf065a6a1ee3ea0f54091a3c00d1fb.png)

å¾ˆæ£’ï¼ä½ çŸ¥é“å¦‚ä½•å°†ç‚¹äº‘åˆ†å‰²ä¸ºå†…ç‚¹é›†å’Œå¤–ç‚¹é›† ðŸ¥³ï¼çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬ç ”ç©¶å¦‚ä½•æ‰¾åˆ°å½¼æ­¤æŽ¥è¿‘çš„ä¸€äº›ç°‡ã€‚è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€æ—¦æˆ‘ä»¬æ£€æµ‹åˆ°å¤§çš„å¹³é¢éƒ¨åˆ†ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›â€œæ¼‚æµ®â€çš„ç‰©ä½“éœ€è¦ delineateã€‚æ€Žä¹ˆåšå‘¢ï¼Ÿï¼ˆæ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡é—®é¢˜ï¼Œæˆ‘ä»¬æœ‰ç­”æ¡ˆç»™ä½  ðŸ˜€ï¼‰

# 6\. æ‰©å±• 3D åˆ†å‰²ï¼šå¤šé˜¶ RANSAC

![](img/24389692747d404df62d0d88855514cd.png)

æˆ‘ä»¬çš„ç†å¿µå°†éžå¸¸ç®€å•ã€‚æˆ‘ä»¬å°†é¦–å…ˆå¤šæ¬¡è¿è¡Œ RANSACï¼ˆå‡è®¾ `n` æ¬¡ï¼‰ä»¥æå–æž„æˆåœºæ™¯çš„ä¸åŒå¹³é¢åŒºåŸŸã€‚ç„¶åŽï¼Œæˆ‘ä»¬å°†é€šè¿‡æ¬§å‡ é‡Œå¾—èšç±»ï¼ˆDBSCANï¼‰å¤„ç†â€œæ¼‚æµ®å…ƒç´ â€ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ç¡®ä¿æœ‰ä¸€ç§æ–¹æ³•åœ¨è¿­ä»£è¿‡ç¨‹ä¸­å­˜å‚¨ç»“æžœã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿ

å¥½çš„ï¼Œè®©æˆ‘ä»¬å®žä¾‹åŒ–ä¸€ä¸ªç©ºå­—å…¸ï¼Œä»¥ä¿å­˜è¿­ä»£ç»“æžœï¼ˆ`segment_models`ä¸­çš„å¹³é¢å‚æ•°å’Œ`segments`ä¸­çš„ç‚¹äº‘å¹³é¢åŒºåŸŸï¼‰ï¼š

```py
segment_models={}
segments={}
```

ç„¶åŽï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿å¯ä»¥å½±å“ä»¥åŽè¿­ä»£çš„æ¬¡æ•°ï¼Œä»¥æ£€æµ‹å¹³é¢ã€‚ä¸ºæ­¤ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå˜é‡`max_plane_idx`æ¥ä¿å­˜è¿­ä»£æ¬¡æ•°ï¼š

```py
max_plane_idx=10
```

ðŸ¦Š **Florent***ï¼šåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¯´æˆ‘ä»¬å¸Œæœ›è¿­ä»£ 10 æ¬¡ä»¥æ‰¾åˆ° 10 ä¸ªå¹³é¢ï¼Œä½†æœ‰æ›´èªæ˜Žçš„æ–¹æ³•æ¥å®šä¹‰è¿™æ ·çš„å‚æ•°ã€‚è¿™å®žé™…ä¸Šæ‰©å±•äº†æ–‡ç« çš„èŒƒå›´ï¼Œå°†åœ¨å¦ä¸€èŠ‚ä¸­è®¨è®ºã€‚*

çŽ°åœ¨è®©æˆ‘ä»¬è¿›å…¥ä¸€ä¸ªå·¥ä½œå¾ªçŽ¯ ðŸ˜ï¼Œæˆ‘å°†é¦–å…ˆå¿«é€Ÿè¯´æ˜Žã€‚

![](img/75431eb5d58c5a9972a73c461b4868ee.png)

æ‰§è¡Œä»¥åœ¨ RANSAC è¿‡ç¨‹ä¸­è¿›è¡Œåˆ†å‰²çš„å¾ªçŽ¯ã€‚Â© F. Poux

åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ï¼ˆå¾ªçŽ¯`i=0`ï¼‰ä¸­ï¼Œæˆ‘ä»¬å°†å†…ç‚¹ä¸Žå¤–ç‚¹åˆ†å¼€ã€‚æˆ‘ä»¬å°†å†…ç‚¹å­˜å‚¨åœ¨`segments`ä¸­ï¼Œç„¶åŽæˆ‘ä»¬åªå¯¹å­˜å‚¨åœ¨`rest`ä¸­çš„å‰©ä½™ç‚¹æ„Ÿå…´è¶£ï¼Œè¿™å°†æˆä¸ºå¾ªçŽ¯ n+1ï¼ˆå¾ªçŽ¯`i=1`ï¼‰çš„ç ”ç©¶å¯¹è±¡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¸Œæœ›å°†ä¸Šä¸€é˜¶æ®µçš„å¤–ç‚¹ä½œä¸ºåŸºç¡€ç‚¹äº‘ï¼Œç›´åˆ°è¾¾åˆ°ä¸Šè¿°çš„è¿­ä»£é˜ˆå€¼ï¼ˆä¸Ž RANSAC è¿­ä»£ä¸åŒï¼‰ã€‚è¿™è½¬åŒ–ä¸ºä»¥ä¸‹å†…å®¹ï¼š

```py
rest=pcd
for i in range(max_plane_idx):
    colors = plt.get_cmap("tab20")(i)
    segment_models[i], inliers = rest.segment_plane(
    distance_threshold=0.1,ransac_n=3,num_iterations=1000)
    segments[i]=rest.select_by_index(inliers)
    segments[i].paint_uniform_color(list(colors[:3]))
    rest = rest.select_by_index(inliers, invert=True)
    print("pass",i,"/",max_plane_idx,"done.")
```

å°±æ˜¯è¿™æ ·ï¼çŽ°åœ¨ï¼Œä¸ºäº†å¯è§†åŒ–æ•´ä½“ï¼Œæˆ‘ä»¬é€šè¿‡å¾ªçŽ¯ä¸­çš„ç¬¬ä¸€è¡Œå°†æ¯ä¸ªæ£€æµ‹åˆ°çš„åˆ†æ®µæ¶‚ä¸Šæ¥è‡ª`tab20`çš„é¢œè‰²ï¼ˆ`colors = plt.get_cmap("tab20")(i)`ï¼‰ï¼Œä½ åªéœ€å†™ï¼š

```py
o3d.visualization.draw_geometries([segments[i] for i in range(max_plane_idx)]+[rest])
```

ðŸ¦š **æ³¨æ„**ï¼šæˆ‘ä»¬ä¼ é€’ç»™å‡½æ•°`o3d.visualization.draw_geometries()`çš„åˆ—è¡¨`[segments[i] for i in range(max_plane_idx)]`å®žé™…ä¸Šæ˜¯ä¸€ä¸ªâ€œåˆ—è¡¨æŽ¨å¯¼å¼â€ðŸ¤”ã€‚å®ƒç­‰åŒäºŽç¼–å†™ä¸€ä¸ª`for`å¾ªçŽ¯ï¼Œå°†ç¬¬ä¸€ä¸ªå…ƒç´ `segments[i]`è¿½åŠ åˆ°åˆ—è¡¨ä¸­ã€‚æ–¹ä¾¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†`[rest]`æ·»åŠ åˆ°è¿™ä¸ªåˆ—è¡¨ä¸­ï¼Œ`draw.geometries()`æ–¹æ³•ä¼šç†è§£æˆ‘ä»¬æƒ³è¦ç»˜åˆ¶ä¸€ä¸ªç‚¹äº‘ã€‚è¿™ä¸æ˜¯å¾ˆé…·å—ï¼Ÿ

![](img/149829534a11885af97f3ff19dea8f8f.png)

DBSCAN å¯¹ 3D ç‚¹äº‘çš„ç¬¬ä¸€æ¬¡æ‰«æç»“æžœ

å“ˆï¼æˆ‘ä»¬ä»¥ä¸ºå®Œæˆäº†â€¦â€¦ä½†æˆ‘ä»¬çœŸçš„å®Œæˆäº†å—ï¼Ÿä½ æ³¨æ„åˆ°è¿™é‡Œæœ‰ä»€ä¹ˆå¥‡æ€ªçš„åœ°æ–¹å—ï¼Ÿå¦‚æžœä½ ä»”ç»†çœ‹ï¼Œä¼šå‘çŽ°ä¸€äº›å¥‡æ€ªçš„ä¼ªå½±ï¼Œæ¯”å¦‚å®žé™…åˆ‡å‰²ä¸€äº›å¹³é¢å…ƒç´ çš„â€œçº¢è‰²çº¿æ¡/å¹³é¢â€ã€‚ä¸ºä»€ä¹ˆï¼ŸðŸ§

![](img/1c67e5140011a746f7e66524ef332420.png)

å®žé™…ä¸Šï¼Œç”±äºŽæˆ‘ä»¬å°†æ‰€æœ‰ç‚¹æ‹Ÿåˆåˆ° RANSAC å¹³é¢å€™é€‰è€…ï¼ˆåœ¨æ¬§å‡ é‡Œå¾—ç©ºé—´ä¸­æ²¡æœ‰é™åˆ¶èŒƒå›´ï¼‰è€Œä¸è€ƒè™‘ç‚¹çš„å¯†åº¦è¿žç»­æ€§ï¼Œå› æ­¤æ ¹æ®å¹³é¢çš„æ£€æµ‹é¡ºåºï¼Œæˆ‘ä»¬ä¼šå‡ºçŽ°è¿™äº›â€œçº¿â€ä¼ªå½±ã€‚æ‰€ä»¥ä¸‹ä¸€æ­¥æ˜¯é˜²æ­¢è¿™ç§è¡Œä¸ºï¼ä¸ºæ­¤ï¼Œæˆ‘å»ºè®®åœ¨è¿­ä»£è¿‡ç¨‹ä¸­åŒ…å«ä¸€ä¸ªåŸºäºŽæ¬§å‡ é‡Œå¾—èšç±»çš„æ¡ä»¶ï¼Œä»¥åœ¨è¿žç»­çš„ç°‡ä¸­ç»†åŒ–å†…ç‚¹é›†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä¾èµ–äºŽ DBSCAN ç®—æ³•ã€‚

## æ¬§å‡ é‡Œå¾—èšç±»ï¼ˆDBSCANï¼‰

åœ¨ç‚¹äº‘æ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å°†ç©ºé—´ä¸Šè¿žç»­çš„ç‚¹é›†åˆï¼ˆå³åœ¨ 3D ç©ºé—´ä¸­ç‰©ç†ä¸ŠæŽ¥è¿‘æˆ–ç›¸é‚»ï¼‰è¿›è¡Œåˆ†ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ä½†æˆ‘ä»¬å¦‚ä½•æœ‰æ•ˆåœ°åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿ

![](img/2d3ff3a05173c7b35dfab22f6883f9a2.png)

åœ¨è¿™å¼ å›¾ä¸­ï¼Œå¾ˆæ˜Žæ˜¾æˆ‘ä»¬æƒ³è¦å°†å½¼æ­¤æŽ¥è¿‘çš„ç‚¹åˆ†ç»„ï¼Œæ‰¾åˆ° 5 ç»„ç‚¹ã€‚Â© F. Poux

DBSCANï¼ˆåŸºäºŽå¯†åº¦çš„ç©ºé—´èšç±»åº”ç”¨ä¸Žå™ªå£°ï¼‰ç®—æ³•äºŽ 1996 å¹´ä¸ºæ­¤ç›®çš„è€Œæå‡ºã€‚è¯¥ç®—æ³•è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå› æ­¤åœ¨ 2014 å¹´èŽ·å¾—äº†ç»å¾—èµ·æ—¶é—´è€ƒéªŒçš„ç§‘å­¦è´¡çŒ®å¥–ã€‚

DBSCAN ç®—æ³•æ¶‰åŠæ‰«ææ•°æ®é›†ä¸­çš„æ¯ä¸ªç‚¹ï¼Œå¹¶åŸºäºŽå¯†åº¦æž„å»ºä¸€ä¸ªå¯è¾¾ç‚¹é›†åˆã€‚è¿™æ˜¯é€šè¿‡åˆ†æžæ¯ä¸ªç‚¹çš„é‚»åŸŸå¹¶åœ¨å…¶åŒ…å«è¶³å¤Ÿç‚¹æ—¶å°†å…¶åŒ…å«åœ¨åŒºåŸŸå†…æ¥å®žçŽ°çš„ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹æ¯ä¸ªé‚»è¿‘ç‚¹é‡å¤ï¼Œç›´åˆ°ç°‡æ— æ³•å†æ‰©å±•ã€‚æ²¡æœ‰è¶³å¤Ÿé‚»å±…çš„ç‚¹è¢«æ ‡è®°ä¸ºå™ªå£°ï¼Œä½¿å¾—è¯¥ç®—æ³•å¯¹ç¦»ç¾¤ç‚¹å…·æœ‰é²æ£’æ€§ã€‚è¿™ä¸æ˜¯å¾ˆä»¤äººå°è±¡æ·±åˆ»å—ï¼ŸðŸ˜†

![](img/5f884ed20535463901f44913fbc652f1.png)

DBSCAN ç®—æ³•è¿‡ç¨‹å’Œä¸¤ä¸ªå‚æ•°Ïµå’Œ min_points å¯¹ç»“æžœçš„å½±å“çš„ç¤ºæ„å›¾ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œå€¼è¶Šå¤§ï¼Œç»„æˆçš„ç°‡å°±è¶Šå°‘ã€‚Â© F. Poux

å•Šï¼Œæˆ‘ä»¬å·®ç‚¹å¿˜äº†ã€‚å‚æ•°é€‰æ‹©ï¼ˆÏµç”¨äºŽé‚»åŸŸï¼Œn_min ç”¨äºŽæœ€å°ç‚¹æ•°ï¼‰ä¹Ÿå¯èƒ½å¾ˆæ£˜æ‰‹ï¼šè®¾ç½®å‚æ•°æ—¶å¿…é¡»å°å¿ƒï¼Œä»¥ç¡®ä¿åˆ›å»ºè¶³å¤Ÿçš„å†…éƒ¨ç‚¹ï¼ˆå¦‚æžœ n_min å¤ªå¤§æˆ–Ïµå¤ªå°ï¼Œå°±ä¸ä¼šå‘ç”Ÿï¼‰ã€‚ç‰¹åˆ«æ˜¯ï¼Œè¿™æ„å‘³ç€ DBSCAN åœ¨å‘çŽ°ä¸åŒå¯†åº¦çš„ç°‡æ—¶ä¼šé‡åˆ°å›°éš¾ã€‚ä½† DBSCAN æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œå°±æ˜¯è®¡ç®—æ•ˆçŽ‡é«˜ï¼Œä¸éœ€è¦åƒ Kmeans é‚£æ ·é¢„å®šä¹‰ç°‡çš„æ•°é‡ã€‚æœ€åŽï¼Œå®ƒå…è®¸å‘çŽ°ä»»æ„å½¢çŠ¶çš„ç°‡ã€‚çŽ°åœ¨æˆ‘ä»¬å‡†å¤‡æ·±å…¥æŽ¢è®¨å‚æ•°çš„é»‘æš—é¢ ðŸ’»

## DBSCAN ç”¨äºŽ 3D ç‚¹äº‘èšç±»

è®©æˆ‘è¯¦ç»†è¯´æ˜Žé€»è¾‘è¿‡ç¨‹ï¼ˆæ¿€æ´»çŒ›å…½æ¨¡å¼ðŸ‘¹ï¼‰ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰è¿è¡Œ DBSCAN çš„å‚æ•°ï¼š

```py
epsilon = 0.15
min_cluster_points = 5
```

ðŸŒ± **æˆé•¿**ï¼š*è¿™äº›å‚æ•°çš„å®šä¹‰æ˜¯ä¸€ä¸ªéœ€è¦æŽ¢ç´¢çš„é—®é¢˜ã€‚ä½ å¿…é¡»æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥å¹³è¡¡è¿‡åº¦åˆ†å‰²å’Œä¸è¶³åˆ†å‰²çš„é—®é¢˜ã€‚æœ€ç»ˆï¼Œä½ å¯ä»¥åŸºäºŽ RANSAC çš„åˆå§‹è·ç¦»å®šä¹‰ä½¿ç”¨ä¸€äº›å¯å‘å¼æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªå€¼å¾—æŽ¢ç´¢çš„æ–¹é¢* ðŸ˜‰ã€‚

åœ¨æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„ for å¾ªçŽ¯ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨åˆ†é…å†…ç‚¹ï¼ˆ`segments[i]=rest.select_by_index(inliers)`ï¼‰åŽç«‹å³è¿è¡Œ DBSCANï¼Œæ–¹æ³•æ˜¯ç´§æŽ¥ç€æ·»åŠ ä»¥ä¸‹ä¸€è¡Œï¼š

```py
labels = np.array(segments[i].cluster_dbscan(eps=epsilon, min_points=min_cluster_points))
```

ç„¶åŽï¼Œæˆ‘ä»¬å°†è®¡ç®—æ¯ä¸ªæ‰¾åˆ°çš„ç°‡åŒ…å«å¤šå°‘ä¸ªç‚¹ï¼Œä½¿ç”¨ä¸€ç§å¥‡æ€ªçš„ç¬¦å·è¡¨ç¤ºæ³•ï¼Œè¯¥è¡¨ç¤ºæ³•åˆ©ç”¨äº†åˆ—è¡¨æŽ¨å¯¼ã€‚ç»“æžœå­˜å‚¨åœ¨å˜é‡`candidates`ä¸­ï¼š

```py
candidates=[len(np.where(labels==j)[0]) for j in np.unique(labels)]
```

é‚£çŽ°åœ¨å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦æ‰¾åˆ°â€œæœ€ä½³å€™é€‰è€…â€ï¼Œé€šå¸¸æ˜¯åŒ…å«æœ€å¤šç‚¹çš„ç°‡ï¼ä¸ºæ­¤ï¼Œè¿™é‡Œæ˜¯è¿™è¡Œä»£ç ï¼š

```py
best_candidate=int(np.unique(labels)[np.where(candidates== np.max(candidates))[0]])
```

å¥½å§ï¼Œå¾ˆå¤šæŠ€å·§åœ¨è¿™é‡Œå‘ç”Ÿï¼Œä½†æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬åˆ©ç”¨ Numpy çš„ç†Ÿç»ƒåº¦æ¥æœç´¢å¹¶è¿”å›žå±žäºŽæœ€å¤§ç°‡çš„ç‚¹çš„ç´¢å¼•ã€‚ä»Žè¿™é‡Œå¼€å§‹ï¼ŒæŽ¥ä¸‹æ¥çš„è¿‡ç¨‹å°±ç®€å•äº†ï¼Œæˆ‘ä»¬åªéœ€ç¡®ä¿åœ¨æ¯æ¬¡è¿­ä»£ä¸­å°†ä»»ä½•å‰©ä½™ç°‡çº³å…¥åŽç»­ RANSAC è¿­ä»£ä¸­ï¼ˆðŸ”¥ æŽ¨èé˜…è¯» 5 éä»¥æ¶ˆåŒ–ï¼ï¼‰ï¼š

```py
rest = rest.select_by_index(inliers, invert=True) + segments[i].select_by_index(list(np.where(labels!=best_candidate)[0]))
segments[i]=segments[i].select_by_index(list(np.where(labels== best_candidate)[0]))
```

ðŸ¦š **æ³¨æ„**ï¼š*`rest`* å˜é‡çŽ°åœ¨ç¡®ä¿åŒ…å« RANSAC å’Œ DBSCAN å‰©ä½™çš„ç‚¹ã€‚å½“ç„¶ï¼Œå†…ç‚¹çŽ°åœ¨è¢«ç­›é€‰ä¸ºåŽŸå§‹ RANSAC å†…ç‚¹é›†ä¸­æœ€å¤§çš„ç°‡*ã€‚

å½“å¾ªçŽ¯ç»“æŸæ—¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ç»„å¹²å‡€çš„æ®µï¼Œè¿™äº›æ®µåŒ…å«ç©ºé—´ä¸Šè¿žç»­çš„ç‚¹é›†ï¼Œç¬¦åˆå¹³é¢å½¢çŠ¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç è¡Œä»¥ä¸åŒé¢œè‰²å¯è§†åŒ–ï¼š

```py
colors = plt.get_cmap("tab20")(i)
segments[i].paint_uniform_color(list(colors[:3]))
```

ç»“æžœåº”è¯¥ç±»ä¼¼äºŽè¿™ä¸ªï¼š

![](img/e91a792806f2bc948d988ded50f423c9.png)![](img/111103f10b8da9050953ae4423df66d6.png)

ä½†è¿™å°±ç»“æŸäº†å—ï¼Ÿä¸ï¼Œä¸å¯èƒ½çš„ ðŸ˜„ï¼ä¸€æ—¦å¯¹ç‚¹äº‘åº”ç”¨äº†å¤šé˜¶ RANSAC åˆ†å‰²ï¼Œä¸‹ä¸€é˜¶æ®µå°±æ˜¯é€šè¿‡åˆ©ç”¨ DBSCAN æ¥ç»†åŒ–å‰©ä½™çš„æœªåˆ†å‰²ç‚¹ï¼Œè¿™æœ‰åŠ©äºŽè¿›ä¸€æ­¥æå‡ç‚¹äº‘åˆ†æžçš„ç²’åº¦ï¼Œå¢žåŠ æ›´å¤šçš„ç°‡ã€‚

ðŸ¦š **æ³¨æ„**ï¼š*ç²’åº¦æ˜¯ä¸€ä¸ªåœ¨æ•°æ®ç§‘å­¦ä¸­ç»å¸¸ä½¿ç”¨çš„å­¦æœ¯è¯æ±‡ã€‚æ•°æ®çš„ç²’åº¦æ„å‘³ç€æ•°æ®ç»„ç»‡æˆ–å»ºæ¨¡çš„è¯¦ç»†ç¨‹åº¦ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä»Žç‚¹äº‘ä¸­å»ºæ¨¡çš„å¯¹è±¡è¶Šå°ï¼Œæˆ‘ä»¬çš„è¡¨ç¤ºçš„ç²’åº¦å°±è¶Šç»†ã€‚ï¼ˆå¾ˆé«˜å¤§ä¸Šï¼Œå¯¹å§ï¼Ÿï¼ï¼‰*

# 7\. æ¬§å‡ é‡Œå¾—èšç±»ç²¾ç‚¼

![](img/664bd457a80f786f5d09aa8239aaeca7.png)

å¥½äº†ï¼Œæ˜¯æ—¶å€™æ‘†è„±å¾ªçŽ¯ï¼Œå¤„ç†åˆ†é…ç»™ `rest` å˜é‡çš„å‰©ä½™ç‚¹ï¼Œè¿™äº›ç‚¹å°šæœªåˆ†é…ç»™ä»»ä½•æ®µã€‚è®©æˆ‘ä»¬é¦–å…ˆå¯¹æˆ‘ä»¬è®¨è®ºçš„å†…å®¹æœ‰ä¸€ä¸ªè§†è§‰ä¸Šçš„äº†è§£ï¼š

```py
o3d.visualization.draw_geometries([rest])
```

![](img/76fdada74949c1d91e41829464bb87af.png)

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ DBSCAN è¿›è¡Œç®€å•çš„æ¬§å‡ é‡Œå¾—èšç±»ï¼Œå¹¶å°†ç»“æžœæ•èŽ·åˆ°ä¸€ä¸ª `labels` å˜é‡ä¸­ã€‚ä½ çŸ¥é“æ€Žä¹ˆåšçš„ï¼š

```py
labels = np.array(pcd.cluster_dbscan(eps=0.1, min_points=10))
```

ðŸŒ± **ç”Ÿé•¿ï¼š** *æˆ‘ä»¬ä½¿ç”¨ 10 cm çš„åŠå¾„æ¥â€œç”Ÿé•¿â€ç°‡ï¼Œåªæœ‰åœ¨æ­¤æ­¥éª¤ä¹‹åŽè‡³å°‘æœ‰ 10 ä¸ªç‚¹æ—¶æ‰è€ƒè™‘ä¸€ä¸ªç°‡ã€‚ä½†è¿™æ˜¯æ­£ç¡®çš„é€‰æ‹©å—ï¼Ÿ* ðŸ¤”*å¯ä»¥éšæ„å®žéªŒä»¥æ‰¾åˆ°ä¸€ä¸ªå¥½çš„å¹³è¡¡ç‚¹ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæ‰¾åˆ°ä¸€ç§è‡ªåŠ¨åŒ–çš„æ–¹æ³•*ðŸ˜€ã€‚

æ ‡ç­¾çš„èŒƒå›´åœ¨ `-1` å’Œ `n` ä¹‹é—´ï¼Œå…¶ä¸­ `-1` è¡¨ç¤ºâ€œå™ªå£°â€ç‚¹ï¼Œ`0` åˆ° `n` çš„å€¼åˆ™æ˜¯åˆ†é…ç»™ç›¸åº”ç‚¹çš„ç°‡æ ‡ç­¾ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ ‡ç­¾ä½œä¸º NumPy æ•°ç»„èŽ·å–ã€‚

![](img/3eb8a5f384d733521bb73466db0acea9.png)![](img/4f479ccf0472670ad4b5a84553201700.png)

å·¦ä¾§ï¼šå‚æ•°å®šä¹‰ä¸ä½³ã€‚å³ä¾§ï¼Œæˆ‘ä»¬å¯¹ç‰©ä½“çš„è½®å»“æœ‰äº†æ›´å¥½çš„åˆ’åˆ†ï¼Œä»¥ä¾¿è¿›è¡ŒåŽç»­å¤„ç†ã€‚

å¾ˆå¥½ã€‚çŽ°åœ¨æˆ‘ä»¬å·²ç»å®šä¹‰äº†æ¯ä¸ªç‚¹çš„æ ‡ç­¾ç»„ï¼Œè®©æˆ‘ä»¬ä¸ºç»“æžœç€è‰²ã€‚è¿™æ˜¯å¯é€‰çš„ï¼Œä½†å¯¹äºŽè¿­ä»£è¿‡ç¨‹ä»¥æœç´¢åˆé€‚çš„å‚æ•°å€¼éžå¸¸æœ‰ç”¨ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ Matplotlib åº“èŽ·å–ç‰¹å®šçš„[é¢œè‰²èŒƒå›´](https://matplotlib.org/stable/tutorials/colors/colormaps.html)ï¼Œä¾‹å¦‚ tab20ï¼š

```py
max_label = labels.max()
colors = plt.get_cmap("tab20")(labels / (max_label 
if max_label > 0 else 1))
colors[labels < 0] = 0
rest.colors = o3d.utility.Vector3dVector(colors[:, :3])
o3d.visualization.draw_geometries([rest])
```

ðŸ¦š **æ³¨æ„**ï¼š*`max_label`* *åº”è¯¥æ˜¯ç›´è§‚çš„ï¼šå®ƒå­˜å‚¨æ ‡ç­¾åˆ—è¡¨ä¸­çš„æœ€å¤§å€¼ã€‚è¿™å…è®¸å°†å…¶ç”¨ä½œç€è‰²æ–¹æ¡ˆçš„åˆ†æ¯ï¼ŒåŒæ—¶å¤„ç†ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼Œå…¶ä¸­èšç±»è¢«æ‰­æ›²ï¼Œä»…äº§ç”Ÿå™ªå£°+ä¸€ä¸ªç°‡ã€‚ä¹‹åŽï¼Œæˆ‘ä»¬ç¡®ä¿å°†è¿™äº›å™ªå£°ç‚¹çš„æ ‡ç­¾è®¾ç½®ä¸º* `-1` *ï¼ˆé»‘è‰²*ï¼ˆ`0`ï¼‰*ï¼‰ã€‚*ç„¶åŽï¼Œæˆ‘ä»¬å°†ç‚¹äº‘* `pcd` *çš„* `colors` *å±žæ€§è®¾ç½®ä¸ºè¡¨ç¤º Rã€Gã€B çš„ 3 åˆ—çš„ 2D NumPy æ•°ç»„ã€‚*

å°±è¿™æ ·ï¼æˆ‘é‡‡ç”¨äº†ä¸Žä¹‹å‰ç›¸åŒçš„æ–¹æ³•ï¼Œæ²¡æœ‰ä»»ä½•é­”æ³•ï¼æˆ‘åªæ˜¯ç¡®ä¿ä½¿ç”¨ä¸€è‡´çš„å‚æ•°æ¥è¿›è¡Œç²¾ç»†çš„èšç±»ï¼Œä»¥èŽ·å¾—ä½ ä¸€ç›´æ¢¦æƒ³çš„ç¾Žä¸½å½©è™¹åœºæ™¯ ðŸ¥³ï¼

![](img/0e7ebe11fc52adac83a2b93374501062.png)![](img/727dec15d27cdf31f1fcf08a86dd71b1.png)![](img/a4fd6c629333ca0ddd5943b6fd1c602b.png)

åœ¨ä½¿ç”¨ DBSCAN ç²¾ç‚¼ç‚¹äº‘èšç±»ç»“æžœä¹‹åŽï¼Œç„¦ç‚¹è½¬å‘ä½“ç´ åŒ–æŠ€æœ¯ï¼Œè¿™æ¶‰åŠå°†æ•°æ®ç»„ç»‡æˆæœ‰æ„ä¹‰çš„ç©ºé—´ç»“æž„ï¼Œä»Žè€Œå®žçŽ°å¯¹ç‚¹äº‘ä¿¡æ¯çš„é«˜æ•ˆå»ºæ¨¡ã€‚

# 8\. ä½“ç´ åŒ–å’Œæ ‡è®°

![](img/b83044b78cead7000efc9944696472ca.png)

çŽ°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå¸¦æœ‰åˆ†æ®µæ ‡ç­¾çš„ç‚¹äº‘ï¼ŒæŸ¥çœ‹æˆ‘ä»¬æ˜¯å¦èƒ½é€‚åº”å®¤å†…å»ºæ¨¡å·¥ä½œæµå°†ä¼šéžå¸¸æœ‰è¶£ã€‚ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ä½“ç´ æ¥é€‚åº” O-Space å’Œ R-Spaceã€‚é€šè¿‡å°†ç‚¹äº‘åˆ’åˆ†ä¸ºå°ç«‹æ–¹ä½“ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£æ¨¡åž‹çš„å ç”¨å’Œç©ºç™½ç©ºé—´ã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ã€‚

## 9.1\. ä½“ç´ ç½‘æ ¼ç”Ÿæˆ

åˆ›å»ºå‡†ç¡®ä¸”è¯¦ç»†çš„ç©ºé—´ 3D æ¨¡åž‹æ„å‘³ç€ç”Ÿæˆä¸€ä¸ªç´§å‡‘çš„ä½“ç´ ç½‘æ ¼ã€‚è¿™ç§æŠ€æœ¯å°†ç‚¹äº‘åˆ’åˆ†ä¸ºå…·æœ‰è‡ªå·±åæ ‡ç³»ç»Ÿçš„å°ç«‹æ–¹ä½“æˆ–ä½“ç´ ã€‚

![](img/6ddeb653af9fa95611230f33d792e393.png)

ä½“ç´ ç½‘æ ¼ç”Ÿæˆä»¥ç»“æž„åŒ–å¸¦æœ‰åˆ†æ®µä¿¡æ¯çš„ 3D ç‚¹äº‘ã€‚Â© F. Poux

è¦åˆ›å»ºè¿™æ ·çš„ç»“æž„ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰æˆ‘ä»¬æ–°å®žä½“çš„å¤§å°ï¼šä½“ç´ ï¼š

```py
voxel_size=0.5
```

çŽ°åœ¨ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“æˆ‘ä»¬éœ€è¦å †å å¤šå°‘ä¸ªè¿™æ ·çš„ç«‹æ–¹ä½“æ‰èƒ½å¡«å……ç”±ç‚¹äº‘å®šä¹‰çš„è¾¹ç•Œæ¡†ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬é¦–å…ˆéœ€è¦è®¡ç®—ç‚¹äº‘çš„èŒƒå›´ï¼š

```py
min_bound = pcd.get_min_bound()
max_bound = pcd.get_max_bound()
```

å¾ˆå¥½ï¼ŒçŽ°åœ¨æˆ‘ä»¬ä½¿ç”¨`o3d.geometry.VoxelGrid.create_from_point_cloud()`å‡½æ•°å¯¹ä»»ä½•é€‰æ‹©çš„ç‚¹äº‘è¿›è¡Œæ“ä½œï¼Œä»¥ä¾¿åœ¨å…¶ä¸Šæ‹Ÿåˆä½“ç´ ç½‘æ ¼ã€‚ä½†æ˜¯ç­‰ç­‰ï¼Œæˆ‘ä»¬æƒ³åŒºåˆ†å“ªä¸ªç‚¹äº‘ä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†ï¼Ÿ

å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜Žä½ æƒ³æ‹¥æœ‰â€œç»“æž„æ€§â€å…ƒç´ çš„ä½“ç´ ä¸Žä¸å±žäºŽç»“æž„æ€§å…ƒç´ çš„æ‚ç‰©ä½“ç´ çš„æƒ…å†µã€‚æ²¡æœ‰æ ‡ç­¾çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®ƒä»¬æ˜¯å¦å±žäºŽ RANSAC åˆ†æ®µæˆ–å…¶ä»–åˆ†æ®µæ¥æŒ‡å¯¼æˆ‘ä»¬çš„é€‰æ‹©ï¼›è¿™æ„å‘³ç€é¦–å…ˆå°† RANSAC å¤„ç†çš„åˆ†æ®µè¿›è¡Œæ‹¼æŽ¥ï¼š

```py
pcd_ransac=o3d.geometry.PointCloud()
for i in segments:
 pcd_ransac += segments[i]
```

ðŸ¦š **æ³¨æ„**: *åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ æœ‰èƒ½åŠ›ç”¨ä½“ç´ ç¨åŽæ‹¾å–çš„å‡åŒ€é¢œè‰²ä¸ºç‚¹äº‘ç€è‰²ã€‚å¦‚æžœè¿™æ˜¯ä½ æƒ³è¦çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨ï¼š* `pcd_ransac.paint_uniform_color([1, 0, 0])`

ç„¶åŽï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æå–æˆ‘ä»¬çš„ä½“ç´ ç½‘æ ¼ï¼š

```py
voxel_grid_structural = o3d.geometry.VoxelGrid.create_from_point_cloud(pcd_ransac, voxel_size=voxel_size)
```

å¹¶å¯¹å‰©ä½™å…ƒç´ åšåŒæ ·çš„å¤„ç†ï¼š

```py
rest.paint_uniform_color([0.1, 0.1, 0.8])
voxel_grid_clutter = o3d.geometry.VoxelGrid.create_from_point_cloud(rest, voxel_size=voxel_size)
```

æœ€åŽä¸€æ­¥æ˜¯å¯è§†åŒ–æˆ‘ä»¬çš„ç»“æžœï¼š

```py
o3d.visualization.draw_geometries([voxel_grid_clutter,voxel_grid_structural])
```

![](img/a710cdc6698553309602a38d1349b361.png)

ä½¿ç”¨ä½“ç´ è¡¨ç¤ºçš„ç©ºé—´çš„è¯­ä¹‰è¡¨ç¤ºã€‚Â© F. Poux

è¿™å¤ªæ£’äº†ï¼å®ƒçœ‹èµ·æ¥åƒé‚£äº›æ•´ä¸ªä¸–ç•Œç”±ç«‹æ–¹ä½“æž„æˆçš„è®¡ç®—æœºæ¸¸æˆï¼è€Œä¸”æˆ‘ä»¬å®žé™…ä¸Šå¯ä»¥ä½¿ç”¨åˆ†æ®µæ ‡ç­¾æ¥æŒ‡å¯¼æˆ‘ä»¬çš„ä½“ç´ å»ºæ¨¡ï¼è¿™å¼€å¯äº†è®¸å¤šè§†è§’ï¼ä½†é—®é¢˜ä¾ç„¶å­˜åœ¨ã€‚ä½¿ç”¨ Open3Dï¼Œæå–æœªå¡«å……çš„ä½“ç´ æ˜¯å›°éš¾çš„ï¼›å› æ­¤ï¼Œå®Œæˆä½“ç´ åŒ–ç‚¹äº‘çš„ç»“æž„åŒ–åŽï¼Œä¸‹ä¸€æ­¥æ¶‰åŠæŽ¢ç´¢ä½“ç´ ç©ºé—´å»ºæ¨¡æŠ€æœ¯ï¼Œä»¥æä¾›åˆ†æžä½“ç´ åŒ–æ•°æ®ç©ºé—´å…³ç³»å’Œå±žæ€§çš„æ›¿ä»£è§†è§’ï¼Œä¸ºé«˜çº§ç‚¹äº‘å»ºæ¨¡å¼€è¾Ÿæ–°é€”å¾„ã€‚

ðŸ¤  **Ville**: *ä½“ç´ åŒ–æ˜¯å¯¹ç›¸åŒç‚¹äº‘æ•°æ®çš„ä¸åŒç©ºé—´è¡¨ç¤ºã€‚å¦‚æžœæœºå™¨äººéœ€è¦é¿å¼€ç¢°æ’žï¼Œè¿™ç§è¡¨ç¤ºéžå¸¸æœ‰ç”¨ï¼æ¯”å¦‚åœ¨æ¨¡æ‹Ÿâ€¦ç«ç¾æ¼”ä¹ æ—¶ä¹Ÿéžå¸¸æœ‰ç”¨ï¼*

# 9\. ç©ºé—´å»ºæ¨¡

![](img/8f45765461494fbd3c658993a1b48144.png)

åœ¨å®¤å†…å»ºæ¨¡åº”ç”¨ä¸­ï¼ŒåŸºäºŽä½“ç´ çš„ç‚¹äº‘è¡¨ç¤ºåœ¨æ•æ‰å’Œåˆ†æžå¤æ‚çŽ¯å¢ƒçš„å‡ ä½•å±žæ€§æ–¹é¢èµ·ç€å…³é”®ä½œç”¨ã€‚éšç€ç‚¹äº‘æ•°æ®é›†çš„è§„æ¨¡å’Œå¤æ‚æ€§çš„å¢žåŠ ï¼Œæ·±å…¥æŽ¢è®¨ä½“ç´ åˆ†å‰²æŠ€æœ¯å˜å¾—è‡³å…³é‡è¦ï¼Œä»¥æå–æœ‰æ„ä¹‰çš„ç»“æž„å¹¶ä¿ƒè¿›æ›´é«˜å±‚æ¬¡çš„åˆ†æžã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥æ‹Ÿåˆä½“ç´ ç½‘æ ¼ï¼Œå¹¶è¿”å›žå¡«å……å’Œç©ºç™½åŒºåŸŸï¼š

```py
def fit_voxel_grid(point_cloud, voxel_size, min_b=False, max_b=False):
# This is where we write what we want our function to do.
return voxel_grid, indices
```

åœ¨å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬å°† (1) ç¡®å®šç‚¹äº‘çš„æœ€å°å’Œæœ€å¤§åæ ‡ï¼Œ(2) è®¡ç®—ä½“ç´ ç½‘æ ¼çš„å°ºå¯¸ï¼Œ(3) åˆ›å»ºä¸€ä¸ªç©ºçš„ä½“ç´ ç½‘æ ¼ï¼Œ(4) è®¡ç®—å·²å æ®ä½“ç´ çš„ç´¢å¼•ä»¥åŠ (5) å°†å æ®ä½“ç´ æ ‡è®°ä¸º Trueã€‚

![](img/c8495062282952b988f871455aef9eb1.png)

ä»Žç‚¹äº‘åˆ›å»ºå æ®ç½‘æ ¼çš„ç®—æ³•å·¥ä½œæµç¨‹ã€‚Â© F. Poux

è¿™è½¬åŒ–ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨æ­¤å‡½æ•°ä¸­åŒ…å«çš„ä»¥ä¸‹ä»£ç ï¼š

```py
# Determine the minimum and maximum coordinates of the point cloud
 if type(min_b) == bool or type(max_b) == bool:
   min_coords = np.min(point_cloud, axis=0)
   max_coords = np.max(point_cloud, axis=0)
 else:
   min_coords = min_b
   max_coords = max_b
 # Calculate the dimensions of the voxel grid
 grid_dims = np.ceil((max_coords - min_coords) / voxel_size).astype(int)
 # Create an empty voxel grid
 voxel_grid = np.zeros(grid_dims, dtype=bool)
 # Calculate the indices of the occupied voxels
 indices = ((point_cloud - min_coords) / voxel_size).astype(int)
 # Mark occupied voxels as True
 voxel_grid[indices[:, 0], indices[:, 1], indices[:, 2]] = True
```

æˆ‘ä»¬å·²ç»å®šä¹‰äº†å‡½æ•°ï¼ŒçŽ°åœ¨å¯ä»¥ä½¿ç”¨å®ƒæå–ä½“ç´ ï¼ŒæŒ‰ç»“æž„ã€æ‚ä¹±å’Œç©ºä½“ç´ è¿›è¡Œåˆ†æ®µï¼š

```py
voxel_size = 0.3

#get the bounds of the original point cloud
min_bound = pcd.get_min_bound()
max_bound = pcd.get_max_bound()

ransac_voxels, idx_ransac = fit_voxel_grid(pcd_ransac.points, voxel_size, min_bound, max_bound)
rest_voxels, idx_rest = fit_voxel_grid(rest.points, voxel_size, min_bound, max_bound)

#Gather the filled voxels from RANSAC Segmentation
filled_ransac = np.transpose(np.nonzero(ransac_voxels))

#Gather the filled remaining voxels (not belonging to any segments)
filled_rest = np.transpose(np.nonzero(rest_voxels))

#Compute and gather the remaining empty voxels
total = pcd_ransac + rest
total_voxels, idx_total = fit_voxel_grid(total.points, voxel_size, min_bound, max_bound)
empty_indices = np.transpose(np.nonzero(~total_voxels))
```

ðŸ¦š **æ³¨æ„**ï¼š*NumPy ä¸­çš„ `*nonzero()*`* å‡½æ•°æŸ¥æ‰¾ `*ransac_voxels*` å˜é‡ä¸­éžé›¶å…ƒç´ çš„ç´¢å¼•ã€‚`*nonzero()*`* å‡½æ•°è¿”å›žä¸€ä¸ªæ•°ç»„çš„å…ƒç»„ï¼Œæ¯ä¸ªæ•°ç»„å¯¹åº”äºŽç‰¹å®šè½´ä¸Šéžé›¶å…ƒç´ çš„ç´¢å¼•ã€‚ç„¶åŽï¼Œæˆ‘ä»¬å°† `*np.transpose()*`* NumPy å‡½æ•°åº”ç”¨äºŽä»Ž `*np.nonzero(ransac_voxels)*`* èŽ·å¾—çš„ç»“æžœã€‚`*transpose()*`* å‡½æ•°æœ€ç»ˆä¼šæŽ’åˆ—æ•°ç»„çš„è½´ï¼ˆæœ‰æ•ˆåœ°äº¤æ¢è¡Œå’Œåˆ—ï¼‰ã€‚é€šè¿‡ç»“åˆè¿™äº›æ“ä½œï¼Œä»£ç è¡Œå¯¹ `*ransac_voxels*`* çš„éžé›¶å…ƒç´ ç´¢å¼•è¿›è¡Œè½¬ç½®ï¼Œç”Ÿæˆä¸€ä¸ªè½¬ç½®æ•°ç»„ï¼Œå…¶ä¸­æ¯è¡Œè¡¨ç¤ºåŽŸå§‹ `*ransac_voxels*`* æ•°ç»„ä¸­éžé›¶å…ƒç´ çš„åæ ‡æˆ–ç´¢å¼•ã€‚ðŸ˜Š

è¿™ç§ä½“ç´ å»ºæ¨¡æ–¹æ³•æä¾›äº†å¯¹ä½“ç´ åŒ–æ•°æ®ç©ºé—´å…³ç³»å’Œå±žæ€§çš„å®è´µè§è§£ã€‚ä¸ºäº†åœ¨ Python ä¹‹å¤–ä»¥é€æ˜Žåº¦å¯è§†åŒ–ç»“æžœï¼Œæˆ‘ä»¬éœ€è¦å¯¼å‡ºæ•°æ®ã€‚

![](img/26688159b8fd845b7e77716526a41603.png)![](img/b5cf1042943b2491366570bf5785fea4.png)![](img/ac7654c650a1171f5b0bc0629506989d.png)

å æ®ç½‘æ ¼åŒ¹é…çš„ç»“æžœã€‚å·¦ä¾§æ˜¯å¡«å……ä½“ç´ å’Œç©ºä½“ç´ ï¼Œä¸­é—´æ˜¯å¡«å……ä½“ç´ ï¼Œå³ä¾§æ˜¯ç©ºä½“ç´ ã€‚Â© F. Poux

åœ¨å®žçŽ°ä½“ç´ åŒ–ç‚¹äº‘çš„ç»“æž„åŒ–åŽï¼Œä¸‹ä¸€æ­¥æ¶‰åŠå°†ç‚¹äº‘å’Œä½“ç´ æ•°æ®å¯¼å‡ºä¸ºå¤–éƒ¨æ ¼å¼ï¼Œä»¥ä¾¿å®žçŽ°äº’æ“ä½œæ€§ï¼Œå¹¶ä¸Žå…¶ä»–è½¯ä»¶å·¥å…·å’Œå·¥ä½œæµç¨‹æ— ç¼é›†æˆã€‚æ­¤å¯¼å‡ºè¿‡ç¨‹ç¡®ä¿ç»“æž„åŒ–çš„ä½“ç´ æ•°æ®å’ŒåŽŸå§‹ç‚¹äº‘å¯ä»¥è½»æ¾å…±äº«ã€å¯è§†åŒ–æˆ–ç”¨äºŽè¿›ä¸€æ­¥åˆ†æžï¼Œä»Žè€Œä¿ƒè¿›å¯¹ç‚¹äº‘æ•°æ®åˆ©ç”¨çš„åä½œå’Œå¤šåŠŸèƒ½æ–¹æ³•ã€‚

# 10\. å¯¼å‡º 3D æ•°æ®é›†

![](img/61eb9b7f6baa27577836ecc3290f343b.png)

è®©æˆ‘ä»¬é¦–å…ˆå…³æ³¨å¯¼å‡ºç‚¹äº‘åˆ†å‰²æ•°æ®é›†ã€‚

## 10.1\. åˆ†å‰²ç‚¹äº‘å¯¼å‡º

è¦å¯¼å‡ºåˆ†å‰²åŽçš„ç‚¹äº‘ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿å¯ä»¥åœ¨å¯è¯»çš„ ASCII æ–‡ä»¶ä¸­ä¸ºæ¯ä¸ªç‚¹å†™å…¥æ ‡ç­¾ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª XYZ ç‰‡æ®µåˆ—è¡¨ï¼Œå¹¶å°†æ ‡ç­¾ç‰¹å¾é™„åŠ åˆ°è¯¥åˆ—è¡¨ã€‚è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹`for`å¾ªçŽ¯å®Œæˆï¼š

```py
xyz_segments=[]
for idx in segments:
 print(idx,segments[idx])
 a = np.asarray(segments[idx].points)
 N = len(a)
 b = idx*np.ones((N,3+1))
 b[:,:-1] = a
 xyz_segments.append(b)
```

ä»Žé‚£é‡Œï¼Œæˆ‘ä»¬ä¸æƒ³å¿˜è®° DBSCAN èšç±»ä¸­çš„å‰©ä½™å…ƒç´ ï¼Œå¯¹å…¶åº”ç”¨ç›¸åŒçš„åŽŸåˆ™ï¼š

```py
rest_w_segments=np.hstack((np.asarray(rest.points),(labels+max_plane_idx).reshape(-1, 1)))
```

æœ€åŽï¼Œæˆ‘ä»¬å°†å…¶é™„åŠ åˆ°ç‰‡æ®µåˆ—è¡¨ä¸­ï¼š

```py
 xyz_segments.append(rest_w_segments)
```

ç„¶åŽæˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ä½¿ç”¨ numpy å¯¼å‡ºæ•°æ®é›†å¹¶è¿›è¡Œå¤–éƒ¨å¯è§†åŒ–ï¼š

```py
np.savetxt("../RESULTS/" + DATANAME.split(".")[0] + ".xyz", np.concatenate(xyz_segments), delimiter=";", fmt="%1.9f")
```

![](img/9a6913b5b3158a617aa100ac50f293b6.png)![](img/3f317d5083906d7a4c6ef6e961bc04df.png)![](img/3d6ef345ce0c619c4c2e337ea05070c8.png)![](img/678224d1204a44582879919bd30270e1.png)![](img/a40abe9f177b691d00b9bc7991871a61.png)

åœ¨æˆåŠŸå¯¼å‡ºåˆ†å‰²åŽçš„ç‚¹äº‘æ•°æ®é›†åŽï¼ŒçŽ°åœ¨çš„é‡ç‚¹æ˜¯å°†ä½“ç´ æ•°æ®é›†å¯¼å‡ºä¸º`.obj`æ–‡ä»¶ã€‚

## 10.2\. ä½“ç´ æ¨¡åž‹å¯¼å‡º

è¦å¯¼å‡ºä½“ç´ ï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»ä¸ºæ¯ä¸ªä½“ç´ ç”Ÿæˆä¸€ä¸ªç«‹æ–¹ä½“ï¼›è¿™äº›ç«‹æ–¹ä½“ç„¶åŽåœ¨`voxel_assembly`ä¸­ç»„åˆåœ¨ä¸€èµ·ï¼Œå †å ç”Ÿæˆæœ€ç»ˆæ–‡ä»¶ã€‚æˆ‘ä»¬åˆ›å»ºäº†`voxel_modelling(filename, indices, voxel_size)`å‡½æ•°æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼š

```py
def voxel_modelling(filename, indices, voxel_size):
    voxel_assembly=[]
    with open(filename, "a") as f:
        cpt = 0
        for idx in indices:
            voxel = cube(idx,voxel_size,cpt)
            f.write(f"o {idx}  \n")
            np.savetxt(f, voxel,fmt='%s')
            cpt += 1
            voxel_assembly.append(voxel)
    return voxel_assembly
```

ðŸ¦š **æ³¨æ„**ï¼š*å‡½æ•°* `[cube()](https://drive.google.com/file/d/1kPu85YHl66gQH8Qumxlyd-Sp4PjgvBVm/view?usp=sharing)` *è¯»å–æä¾›çš„ç´¢å¼•ï¼Œæ ¹æ®ç´¢å¼•å’Œä½“ç´ å¤§å°ç”Ÿæˆä½“ç´ ç«‹æ–¹ä½“ï¼Œå°†ä½“ç´ ç«‹æ–¹ä½“å†™å…¥æ–‡ä»¶ï¼Œå¹¶è·Ÿè¸ªåœ¨* `*voxel_assembly*` *åˆ—è¡¨ä¸­çš„ç»„è£…ä½“ç´ ç«‹æ–¹ä½“ï¼Œæœ€ç»ˆç”±å‡½æ•°è¿”å›žã€‚*

ç„¶åŽç”¨æ¥å¯¼å‡ºä¸‰ç§ä¸åŒçš„ä½“ç´ ç»„åˆï¼š

```py
vrsac = voxel_modelling("../RESULTS/ransac_vox.obj", filled_ransac, 1)
vrest = voxel_modelling("../RESULTS/rest_vox.obj", filled_rest, 1)
vempty = voxel_modelling("../RESULTS/empty_vox.obj", empty_indices, 1)
```

![](img/2d627d5ec536ba3c638629a25ce4f5f5.png)![](img/7860e71bb83efd674302b5c044716254.png)![](img/442975beca59c66312b3cdbbcfc21310.png)

åˆ†å‰²å’Œä½“ç´ å»ºæ¨¡çš„ç»“æžœã€‚Â© F. Poux

+   ðŸ’» åœ¨è¿™é‡ŒèŽ·å–ä»£ç è®¿é—®æƒé™ï¼š[ä»£ç ç¤ºä¾‹](https://drive.google.com/drive/folders/1-sGlVvsPcyp9VZ8cw-J8kbhj4-aK_8p8?usp=sharing)

+   ðŸ‡ åœ¨è¿™é‡ŒèŽ·å–æ•°æ®è®¿é—®æƒé™ï¼š[3D æ•°æ®é›†](https://drive.google.com/drive/folders/1sCBT1lc9A8Zn4grpxwFrBrvos86c0HZR?usp=sharing)

+   ðŸ‘¨â€ðŸ«3D æ•°æ®å¤„ç†å’Œ AI è¯¾ç¨‹ï¼š[3D å­¦é™¢](https://learngeodata.eu/)

+   ðŸ“– è®¢é˜…ä»¥èŽ·å¾— 3D æ•™ç¨‹çš„æå‰è®¿é—®æƒé™ï¼š[3D AI è‡ªåŠ¨åŒ–](https://medium.com/@florentpoux/subscribe)

![](img/ceab061ce5f1ea698c109d269cc41fd2.png)

# ç»“è®º

ðŸ¦Š **Florent**ï¼šå¤§è§„æ¨¡ç¥è´ºðŸŽ‰ï¼ä½ åˆšåˆšå­¦ä¼šäº†å¦‚ä½•å¼€å‘ä¸€ä¸ªè‡ªåŠ¨å½¢çŠ¶æ£€æµ‹ã€èšç±»ã€ä½“ç´ åŒ–å’Œå®¤å†…å»ºæ¨¡ç¨‹åºï¼Œç”¨äºŽå¤„ç†ç”±æ•°ç™¾ä¸‡ä¸ªç‚¹ç»„æˆçš„ 3D ç‚¹äº‘ï¼Œå¹¶é‡‡ç”¨ä¸åŒçš„ç­–ç•¥ï¼çœŸå¿ƒåœ°ï¼Œåšå¾—å¾ˆå¥½ï¼ä½†é“è·¯æ˜¾ç„¶ä¸æ­¢äºŽæ­¤ï¼Œå› ä¸ºä½ åˆšåˆšè§£é”äº†ä¸€ä¸ªå·¨å¤§çš„æ™ºèƒ½è¿‡ç¨‹æ½œåŠ›ï¼Œèƒ½å¤Ÿåœ¨ç‰‡æ®µçº§åˆ«è¿›è¡ŒæŽ¨ç†ï¼

ðŸ¤  **Ville**ï¼šé‚£ä¹ˆï¼Œä½ æ˜¯å¦åœ¨æƒ³æˆ‘ä»¬æ˜¯å¦å¯ä»¥è®© 3D å»ºæ¨¡æˆä¸ºå®Œå…¨æ— éœ€äººå·¥å¹²é¢„çš„è¿‡ç¨‹ï¼Ÿå‡­å€Ÿæˆ‘ä»¬ç›®å‰çš„æŠ€æœ¯ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€åŠã€‚ä¸ºä»€ä¹ˆï¼Ÿæˆ‘ä»¬çš„æŠ€æœ¯å¯ä»¥æ‰¾åˆ°ï¼Œä¾‹å¦‚ï¼Œå¹³é¢æ¨¡åž‹çš„å‚æ•°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå­¦æœ¯ç•Œçš„äººç§°ä¹‹ä¸ºå‚æ•°å»ºæ¨¡ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä»”ç»†é€‰æ‹©å…¶ä»–ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚ RANSAC çš„å‚æ•°ã€‚æˆ‘é¼“åŠ±ä½ å°è¯•åœ¨ä¸åŒçš„ç‚¹äº‘ä¸Šåº”ç”¨ä½ çš„ä»£ç ï¼

![](img/4b6c35c1665bd5dbdfac5fc7031fb72a.png)

åŸºäºŽåœ°é¢è¯­ä¹‰çš„ 3D ç½‘æ ¼ç¤ºä¾‹ã€‚Â© F. Poux

# æ›´è¿›ä¸€æ­¥

å­¦ä¹ ä¹‹æ—…å¹¶æœªç»“æŸã€‚æˆ‘ä»¬çš„ç»ˆèº«æŽ¢ç´¢æ‰åˆšåˆšå¼€å§‹ï¼Œæœªæ¥çš„æ­¥éª¤å°†æ·±å…¥åˆ° 3D Voxel å·¥ä½œï¼ŒæŽ¢ç´¢è¯­ä¹‰å’Œç‚¹äº‘åˆ†æžä¸Žæ·±åº¦å­¦ä¹ æŠ€æœ¯ã€‚æˆ‘ä»¬å°†è§£é”é«˜çº§çš„ 3D LiDAR åˆ†æžå·¥ä½œæµç¨‹ã€‚ä»¤äººå…´å¥‹çš„äº‹æƒ…è¿˜æœ‰å¾ˆå¤šï¼

1.  **Lehtola, V.**ï¼ŒNikoohemat, S.ï¼Œ& NÃ¼chter, A.ï¼ˆ2020ï¼‰ã€‚å®¤å†… 3Dï¼šæ‰«æå’Œé‡å»ºæ–¹æ³•æ¦‚è¿°ã€‚å¤§åœ°ç©ºé—´æ•°æ®æ‰‹å†Œï¼Œ55â€“97\. [`doi.org/10.1007/978-3-030-55462-0_3`](https://doi.org/10.1007/978-3-030-55462-0_3)

1.  **Poux, F.**ï¼Œ& Billen, R.ï¼ˆ2019ï¼‰ã€‚åŸºäºŽä½“ç´ çš„ 3D ç‚¹äº‘è¯­ä¹‰åˆ†å‰²ï¼šæ— ç›‘ç£å‡ ä½•å’Œå…³ç³»ç‰¹å¾ä¸Žæ·±åº¦å­¦ä¹ æ–¹æ³•ã€‚*ISPRS å›½é™…åœ°ç†ä¿¡æ¯æ‚å¿—*ã€‚8(5)ï¼Œ213ï¼›[`doi.org/10.3390/ijgi8050213`](https://doi.org/10.3390/ijgi8050213) â€” Jack Dangermond å¥–ï¼ˆ[æ–°é—»æŠ¥é“é“¾æŽ¥](https://www.geographie.uliege.be/cms/c_5724437/en/florent-poux-and-roland-billen-winners-of-the-2019-jack-dangermond-award)ï¼‰

1.  Bassier, M., Vergauwen, M., **Poux, F.**ï¼Œï¼ˆ2020ï¼‰ã€‚å»ºç­‘å†…éƒ¨åˆ†ç±»ä¸­çš„ç‚¹äº‘ä¸Žç½‘æ ¼ç‰¹å¾ã€‚*é¥æ„Ÿ*ã€‚12ï¼Œ2224\. https://doi:10.3390/rs12142224
