# 探讨最小样本量公式：推导与应用

> 原文：[https://towardsdatascience.com/probing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b?source=collection_archive---------0-----------------------#2023-02-01](https://towardsdatascience.com/probing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b?source=collection_archive---------0-----------------------#2023-02-01)

## A/B 测试中的样本量公式简明指南

[](https://medium.com/@weimintaottt?source=post_page-----8db9a556280b--------------------------------)[![Mintao Wei](../Images/eec1a909df8e780ac6a2c1f9d754ba75.png)](https://medium.com/@weimintaottt?source=post_page-----8db9a556280b--------------------------------)[](https://towardsdatascience.com/?source=post_page-----8db9a556280b--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----8db9a556280b--------------------------------) [Mintao Wei](https://medium.com/@weimintaottt?source=post_page-----8db9a556280b--------------------------------)

·

[关注](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6959c4b812af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprobing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b&user=Mintao+Wei&userId=6959c4b812af&source=post_page-6959c4b812af----8db9a556280b---------------------post_header-----------) 发表在 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----8db9a556280b--------------------------------) · 18 分钟阅读 · 2023年2月1日 [](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8db9a556280b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprobing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b&user=Mintao+Wei&userId=6959c4b812af&source=-----8db9a556280b---------------------clap_footer-----------)

--

[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8db9a556280b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprobing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b&source=-----8db9a556280b---------------------bookmark_footer-----------)

# 太长；不读

本文回答了两个围绕A/B测试中最小样本量计算的重要“如何做”问题：

> **1) 如何推导最小样本量公式** 𝜨**?**

公式背后的核心思想是**反转假设检验中的p值计算**，特别关注于**统计功效**，即在原假设确实为假的情况下拒绝原假设的概率。

![](../Images/bf2c8037500f91060ac87fa8aee12159.png)

图1：最小样本量计算公式的直观解释

> **2) 如何在现实场景中使用公式计算最小样本量？**

我们使用**历史数据**，将其汇总到正确的实验单位，来计算我们感兴趣指标的**标准差**以及历史平均值作为基线水平。然后，我们**手动**确定所需的显著性水平**𝛼**、统计功效**1-𝛽**，以及最重要的，期望在处理组和对照组之间的最小可检测效果**𝑑𝑚𝑖𝑛**。

这些是样本量计算所需的**四个输入**。值得注意的是，如果我们想检测到更微妙的增量提升（小**𝑑𝑚𝑖𝑛**），则在*更强的统计能力*和*更长的实验周期*之间存在**权衡**。因此，在设计 A/B 实验时，我们通常会计算在不同**𝑑𝑚𝑖𝑛**水平下的多个样本量版本，以量化这些权衡。

# 目录

1.  [我们为什么要关心](#d90b)

1.  [设置](#6649)

1.  [I. 推导最小样本量（简单公式/无𝛽](#aa46) [𝛽](#529a)[)](#aa46)

    • [关键思想](#43b8)

    • [公式推导](#c172)

    • [示例：分析芝加哥两个社区之间的下载速度差异](#516e)

1.  [II. 推导最小样本量（标准公式/带𝛽）](#529a) • [关键思想](#6ea9) • [公式推导](#2c44)

    • [示例：“揭开”Evan 的 A/B 样本量计算器的神秘面纱](#b1ce)

1.  [实际问题](#76fa)

    • [如何从我们的通用公式推导经验法则样本量？](#efa2)

    • [如何确定𝑑𝑚𝑖𝑛？](#6675)

    • [如果两个组的方差和样本量不相等怎么办？](#cdbd)

    • [如何使用历史数据估算标准差𝜎？](#44bd)

    • [我们需要多少历史数据？](#9947)

    • [我们应该如何准备这些数据？](#a0a5)

1.  [总结](#fc4f)

# 为什么我们需要关心？

在 2022/2023 年，当网上有大量现成的样本量计算器（例如，[Evan Miller’s Calculator](https://www.evanmiller.org/ab-testing/sample-size.html)、[Optimizely](https://www.optimizely.com/sample-size-calculator/#/?conversion=3&effect=20&significance=95)）可用，以及大多数科技公司都有自己建立的实验平台和工具时，深入探讨公式背后的原理似乎没有必要。然而，了解这些原理仍然很重要，因为：

+   A/B 测试样本量计算是**产品数据科学家****面试**中最常见的问题之一，我们需要不仅能够背诵公式，还要能解释其原理。

+   在在线随机 A/B 测试和离线对照试验中，现实世界的业务背景可能很复杂，因此我们需要了解公式的来龙去脉，以**正确选择或调整这些工具**并避免谬误。

+   此外，我们在假设检验和功效分析中建立“**统计直觉**”至关重要，因为由于样本量不足，常常会遇到无显著性检验结果。我们当然希望提高对可能的第二类错误（忽视真正有效的处理策略）的敏感度，并准备估算下一步所需的样本量。这不仅仅涉及技术公司中的典型数据科学工作，还涉及学术界和日常生活中的研究问题——“*女性员工的薪酬是否低于男性？*”、“*财富更高的社区是否比欠发达社区有更好的互联网连接和下载速度？*”等。我们不仅要问自己“我们从数据中看到的是否具有统计学意义？”，还要问“**我们是否有足够的样本？如果没有，我们还需要多少数据或未来需要发送多少份调查问卷？**”

关于这个主题，有许多优秀的入门文章和资源，但大多数**仅仅“呈现”公式**。站在这些前人的肩膀上，我希望在这里进一步*深入探讨*直觉和推导，回答**“这些公式为何如此定义”**的问题。此外，我还将讨论使用这些公式的一些实际问题。

# 设置

## 测试

本文中样本量计算的讨论将主要基于**两个样本单侧z检验**。

原因在于，在A/B测试场景中，测试统计量通常是样本均值（*例如实验期间每用户的平均XXX，其中该期间特定用户的所有行为被视为一个样本，而该指标只是所有用户的样本均值统计量*），并且通常根据中心极限定理呈正态分布。这里倾向于使用单侧检验，因为我们通常对处理效果有明确的**方向性**信念（即处理组应表现得比对照组更好或更差）。

## 符号和概念

+   𝜨: 最小所需样本量。

+   **𝑝:** p值。

+   **𝛼:** 显著性水平，或称为第一类错误。

+   **𝛽:** 第二类错误。1-𝛽表示统计功效。

+   ***X̄1/X̄2/X̄d*:** 第1组（对照组）、第2组（处理组）和两个随机均值变量之间差异的样本均值。

+   ***x̄1/x̄2/x̄d***: 第1组（对照组）、第2组（处理组）和两个均值统计量之间差异的样本均值。

+   ***z_(1-*𝛼*)***: 切割顶部**𝛼(%)**的z分数，或标准正态分布的临界值。例如，在单侧检验中，***z_(1–5%)=z_(95%)≈1.65; z_(1–2.5%)=z_(97.5%)≈1.96; z_(2.5%)≈-1.96。***

+   **𝜎：**每组观察值的标准差。我们假设两个组的标准差相同（*我们还将讨论当方差不相等时如何调整公式*）。

+   **𝑑𝑚𝑖𝑛：**最小可检测效应，即在给定样本量 𝜨 的情况下，可以检测到的统计显著差异水平。例如，如果对照组的转换率为 10%，且**我们预期**处理能够将转换率从 10% 实际提高到 15%（请注意这是我们的预期），则（绝对）**𝑑𝑚𝑖𝑛** 为 15%-10%=5%。直观地说，如果我们**预期的处理效应非常小**（即我们对处理策略没有信心），我们将需要更多的**样本**来将其与自然变异区分开，因为真实效应可能非常微弱。如果最小可检测效应**较大**，它应该相当显著，因此**少量样本**就足以告诉我们两组之间的差异是否实际具有统计学意义。

## 目标

给定 I 型错误**𝛼**、II 型错误**𝛽**、标准差**𝜎**和最小可检测效应**𝑑𝑚𝑖𝑛**，我们希望估计最小所需样本量 𝜨，以便我们有足够的统计功效来检测到至少与**𝑑𝑚𝑖𝑛**一样大的差异。

换句话说，样本量 𝜨（仅）保证我们能检测到至少**𝑑𝑚𝑖𝑛**的处理效应或组间差异。如果实际的处理效应实际上小于**𝑑𝑚𝑖𝑛**，我们可能无法将这种微小的改进与自然变异区分开。

# I. 推导最小样本量（天真的公式/不考虑**𝛽**）

虽然统计功效**1-𝛽**，或者当实际上存在差异时检测差异的概率，是估计样本量的关键因素，但当我开始学习 A/B 测试时，我发现很难理解。因此，在本文中，我们首先从这种*“天真的”*最小样本量估计版本开始，仅考虑显著性水平**𝛼**，然后在下一节中逐步进入“正式”的推导，其中引入统计功效的概念。

## 关键思想

计算最小所需样本量的关键思想就是**假设检验的逆过程**，或者换句话说，**询问样本量 *“就像 p 值已知为显著性水平* 𝛼*”***。

给定两个样本，我们可以基于**样本均值、标准差**和***N***计算 p 值。用*图2*的话来说，我们希望样本均值差异统计量***X̄d*** **落在红色区域内**，因为这是原假设 H0 的拒绝区域。

![](../Images/db7431cf1fd16c1599ac373fb5b0c925.png)

图2：假设检验中的拒绝区域和临界值（作者提供）

现在，由于显著性水平 𝛼 本质上是 p 值的 **阈值**，如果我们知道历史数据中的 **标准差 𝜎** 并指定 **𝛼** 的水平以及我们希望检测的两组之间的预期差异 **𝑑𝑚𝑖𝑛**，我们可以计算 ***N***。这种公式下所需的最小样本量 ***N*** 确保我们有足够的“显著性”来检测两组之间的 **𝑑𝑚𝑖𝑛** 量的差异。

## 公式推导

基于上述思想，我们可以概述以下高级公式，我将围绕这个逻辑逐步讨论 ***N*** 的推导：

![](../Images/3c0da9ee95bef36782e0ff7b17649699.png)

公式 1: 朴素最小样本量公式的高级概念（作者提供）

首先，我想明确我们的假设和测试统计量。零假设是组 1（对照组）和组 2（处理组）的均值统计量之间没有统计学差异。备择假设则表明我们的处理组‘优于’对照组，表明这是一个单侧检验。

![](../Images/a6c705b17e02b1bf34086f1a7a3912f1.png)

公式 2: 两样本单侧 T 检验/Z 检验中的 H0 和 H1（作者提供）

我们关注的是组 1 和组 2 的均值统计量的差异：

![](../Images/4554e1e17b2cf83aa7a26f01c1723e1e.png)

公式 3: 双样本 T 检验/Z 检验的测试统计量（作者提供）

在进一步探讨之前，让我们先探讨分布性质。我们不需要对两组 𝛸1、𝛸2 做任何分布假设，因为根据中心极限定理，它们的 **样本均值统计量** 以及推导出的 **样本均值差异统计量** 遵循正态分布。

![](../Images/e3055ca906961dab057fdb26469f05eb.png)

公式 4: 关键随机变量和测试统计量的分布性质（作者提供）

记住，p 值表示在零假设为真的情况下，随机变量获得一个值与当前样本统计量一样极端或更极端的概率。因此，p 值和 z 统计量可以通过以下公式计算：

![](../Images/10f93d853d31e7be3aa7b8a9b91edcce.png)

公式 5: 两样本单侧 Z 检验的 p 值公式（作者提供）

因此，如果我们进行假设检验，当我们的 p 值小于 **𝛼** 时，我们将以 **𝛼** 显著性水平拒绝零假设，或者样本 z 统计量大于临界 z 值：

![](../Images/6eb31af9bc882af659a92a3a077a6525.png)

公式 6: 当 H0 被拒绝时的两样本单侧 T 检验/Z 检验的假设检验标准（作者提供）

太棒了！现在我们已经得出了给定两个样本组的假设检验最终公式。你可能已经注意到分母中有𝜨。尽管很简单，计算所需的最小样本量的方法是（1）将***x̄d***视为预定的最小可检测效应（MDE 或 **𝑑𝑚𝑖𝑛**）；（2）假设原假设成立（μ2-μ1=0），以及（3）通过反转不等式来求𝜨。

+   要进行*假设检验*，我们通过计算组1和组2之间的样本均值差异来计算***x̄d***。

+   要计算*最小样本量*，我们用预期的最小可检测效应**𝑑𝑚𝑖𝑛**替换基于样本的***x̄d***，这代表了来自组1（对照组）和组2（处理组）的预期差异，或者在产品分析语言中，就是我们期望治疗策略带来的潜在增量效果。

因此，给定**𝑑𝑚𝑖𝑛**、**𝛼**和**𝜎**的𝜨的推导如下：

![](../Images/efd580935995a198445f65466a799075.png)

公式 7：给定**𝑑𝑚𝑖𝑛**、**𝛼**和**𝜎**的𝜨的推导（作者）

## 示例：分析芝加哥两个社区之间的下载速度差异

假设你是一个研究助理，与你的教授一起工作。团队当前的研究是调查互联网不平等，这通过**下载速度，在服务不足和富裕社区之间**来衡量，你的教授坚信/假设存在这种不平等，因为基础设施、服务提供商等方面存在差异。

两个关注的地理社区是*林肯公园（芝加哥北区，最富裕的社区之一）*和*南岸（芝加哥南区，通常被认为是服务不足的社区）*。团队已经对**每个社区的10个随机选择的家庭**进行了调查，教授让你进行数据分析以验证他的假设。

表 1：初步小样本（N=10）（合成数据，作者编造）

你意识到**t检验**可能是检查**林肯公园和南岸之间每个家庭平均下载速度是否存在统计显著差异**的一个好方法。然而，在整理数据后，你发现结果是**不具有统计显著性**，你认为这是因为**样本量太小**，实际差异被自然变异所掩盖。

接下来出现的问题是：**你建议团队收集多少更多的样本？** 我们需要知道**三个数字：** **𝛼**、**𝜎** 和 **𝑑𝑚𝑖𝑛**来根据*公式 7* 计算所需的最小样本量。

我们通常指定 5% 的显著性水平，并且在假设方差齐性的情况下，标准差可以用组 1 的样本标准差进行近似。对于**𝑑𝑚𝑖𝑛**，我们需要与教授沟通，借用领域知识并确定*组 1（南岸）*和*组 2（林肯公园）*之间的预期差异。目前，假设教授建议这两个社区之间家庭下载速度的预期差异或最小可检测提升（%）应为 1%。因此，我们得到：

![](../Images/b43bb9acf26fd5d5403a19f35e2a7138.png)

公式 8: **𝛼**、**𝜎** 和 **𝑑𝑚𝑖𝑛** 在下载速度示例中的规格（作者提供）

插入这些数字后，我们能够计算出所需的最低样本量，为 **77**。这个数字意味着我们应该调查 **67** 户家庭（我们已经有 10 户），而这个更大的样本（***N*=77**）将使我们能够检测到 **1%** 或更大的下载互联网速度差异，前提是这两个社区之间确实存在这样的差异。

![](../Images/4f20229e226cc2828d693c8c74fedaa2.png)

公式 9: 计算给定 **𝑑𝑚𝑖𝑛**、**𝛼** 和 **𝜎** 的 𝜨 的示例（作者提供）

完整的 Python 实现可以在我的 [GitHub Gist](https://gist.github.com/mintaow/30506b7c2ae54da5d13623a3e4595beb) 上找到，或嵌入的笔记本如下：

# II. 推导最低样本量（标准公式/与 **𝛽**）

## 关键思想

在科技公司设计和启动 A/B 测试时，我们通常不仅关心获得显著的 p 值以拒绝原假设，更重要的是在原假设确实错误时**拒绝原假设**，这表明我们的处理确实有效，而不是第一类错误。因此，我们所需的样本量需要有足够的**统计功效 (1-𝛽)** 来检测这种处理效应。**图形上，如*图 3*所示，我们最‘渴望’的是两件事：

1.  样本统计量（***X̄d***）**超出了临界值**，因为这是 H0 的拒绝区域。

1.  样本统计量（***X̄d***）**落在** **分布 Ha 中的蓝色阴影区域**，因为蓝色区域代表了替代分布，表示处理组和对照组之间的总体差异不为零。

这是计算所需最低样本量的关键思想。

![](../Images/a852c0f5f3fa4d0d514829dce67dc71a.png)

图 3: 假设检验中的拒绝区域、临界值、统计功效（作者提供）

从上述提到的**朴素版本**到**正式表示**的公式转换，反映了统计功效 **1-𝛽** 的考虑，如下所示。随着由 **1-𝛽** 指定的临界值添加到分子中，所需的样本量 **增加**，这很有意义，因为我们在推断中“购买”了更多的效率。

![](../Images/a39c7a36a33cf0b5983da1d333b70bf3.png)

公式 10：样本大小估计中的从简单公式到标准公式（作者）

另一种看法是，A/B测试所需的最小样本大小是上述简单版本的扩展，因为现在包含/控制了第二类错误**𝛽**。计算最小样本大小的逻辑仍然是**假设检验的反向**，只是我们需要考虑两种分布H0和H1，并纳入第一类错误/显著性水平**𝛼**和第二类错误**𝛽**。

## 公式推导

因此，我们通过设定拒绝错误H0的概率小于预设的**统计功效 (1-𝛽)** 来建立我们的高阶公式，如下所示。

> 请注意，我们现在是在以H1作为统计量来源的实际分布进行条件化，而不是H0，后者假设处理组和对照组之间没有差异。

![](../Images/2be251a26867188d4cc0fb7627f3deca.png)

公式 11：正式最小样本大小推导背后的高阶思路（作者）

计算最小所需样本大小需要**4个输入**：

1.  我们需要指定显著性水平**𝛼**

1.  我们需要指定的统计功效**1-𝛽**

1.  标准差**𝜎**，我们可以从历史数据中计算得出

1.  期望的处理效应大小，即我们想要检测的两个组之间的差异**𝑑𝑚𝑖𝑛 (**μ2-μ1**)**。

回顾一下，样本均值差异统计量遵循正态分布，其均值为**μ2-μ1**，标准差为**2*𝜎/N*的平方根**。

![](../Images/b6d981dd4a80bdacdbfcb3d609531f03.png)

公式 12：关键随机变量和检验统计量的分布特性（作者）

上述高阶公式的推导包括两个步骤。首先，我们使用**𝛼**表示***x_crit***，即当假设H0为真时拒绝原假设的临界值。其次，我们使用**𝑑𝑚𝑖𝑛**、**𝛼**和**𝛽**求解最小样本大小𝜨。

![](../Images/964eae2f8a0398eb08e6f897fbbb4d30.png)

公式 13：给定**𝑑𝑚𝑖𝑛**、**𝛼**、**𝛽**和**𝜎**的𝜨推导（作者）

## 示例：“揭示”埃文的神奇A/B样本大小计算器

这个“简单”但优雅的 [A/B样本量计算工具](https://www.evanmiller.org/ab-testing/sample-size.html)，如*图4*所示，是由 [Evan Miller](https://www.evanmiller.org/) 创建并发布的。它在Udacity和Google的优秀A/B测试入门课程系列中被提及，因此成为了许多数据科学学生，包括我在内的首选A/B测试工具。虽然这些样本量计算工具非常方便使用，但人们可能会担心，并不会完全信任它们，因为通常没有具体解释输出背后的逻辑。因此，我希望提供一个简要说明，以帮助揭开帷幕，展示这些计算器是如何工作的。

![](../Images/5963a4a04cb070ebc59fdb7b5b6e6396.png)

图4：Evan Miller的样本量计算器

首先，Evan的A/B测试样本量计算器专门针对**z-比例检验**，其中关键指标是比例（如果你对不同类型的统计测试感兴趣，我认为我写的另一篇文章 [*如何选择适合不同A/B指标的统计测试*](https://medium.com/towards-data-science/how-to-select-the-right-statistical-tests-for-different-a-b-metrics-c8a1865851e) 会对你有帮助）。

值得注意的是，**在估计比例指标的样本量时，我们不需要输入标准差。** 这是因为像转化率这样的比例指标可以被视为所有用户转化状态的聚合。而且因为**用户要么转化，要么未转化**，用统计学语言来说，这是一个**随机伯努利事件**，记作*Bernoulli(p)*。因此，转化率的分析方差估计为**𝑝∗(1-𝑝)**。这一良好性质意味着我们“不需要”输入标准差来计算最小样本量，因为我们总是可以使用样本平均转化率**𝑝**来估计真实的分析标准差，而**𝑝**就是**基线转化率**，如Evan的计算器输入框中所述。

牢记这一重要概念，让我们深入了解这个工具（*图4*）。该工具需要四个输入：

1.  基线转化率 **𝑝**：假设当前转化水平为20%。

1.  最小可检测效应（MDE）：这里的定义可能有些棘手，但概念很简单。有“**绝对**”MDE和“**相对**”MDE。5%的绝对MDE表示我们计算的样本量只能检测15%到25%之间的范围，而相对MDE定义了可检测的范围为20%*(1–5%)和20%*(1+5%)。例如，如果我们的产品经理认为推出这个新产品功能会将转化率从20%提高到25%，那么这意味着我们应该将**𝑑𝑚𝑖𝑛**设置为5%，或者将绝对MDE设置为5%，或者将相对MDE设置为25%，因为20%*1/4=5%。

1.  统计功效 **1-𝛽**

1.  显著性水平 **𝛼**

将其整理成我们目前建立的公式：

![](../Images/89d3a43a4d6283f7fb34b31e733895a1.png)

公式14：给定**𝑑𝑚𝑖𝑛**、**𝛼**、**𝛽**和**𝜎**（双侧）在A/B工具示例中的计算𝜨的说明（作者提供）。手动计算的样本量（1003）与A/B测试工具生成的结果（1030）略有不同，这可能是精度舍入差异造成的。

![](../Images/e9258cc1c903df2fac9dce58147a61af.png)

公式14：给定**𝑑𝑚𝑖𝑛**、**𝛼**、**𝛽**和**𝜎**（双侧）在A/B工具示例中的计算𝜨的说明（作者提供）

说话便宜：

作者

# 实际问题

我认为*公式13*是最小所需样本量的一般形式。以下**实际问题**部分讨论了对更具体情况的几个重要扩展。例如，当方差不等时，当指标是比例时，双侧测试使用时与经验法则公式的关系。

**如何从我们的通用公式推导出经验法则样本量？**

许多资源提到一个方便的公式，***N***等于**16*𝜎2/𝑑𝑚𝑖𝑛**。如果我们进行**双侧测试**并指定**𝛼 = 0.05**、**𝛽 = 0.2**，我们可以将两个z分数平方和乘以2的结果四舍五入到16。有关更多详细信息，请参见*《可信的在线对照实验》第17.6方程*或*Belle（2008）*。

![](../Images/1d69a05d4d667f33248db958a9b9724c.png)

公式15：从一般形式到经验法则形式（作者提供）

**如何确定𝑑𝑚𝑖𝑛？**

我个人认为，**𝑑𝑚𝑖𝑛**或最小可检测效应（MDE）应通过**PM和DS之间的密切讨论**来确定。这是一个需要仔细沟通和商业直觉的艰难决定：

+   DS可以提供与以下内容相关的见解：（1）类似历史实验的MDE；（2）关键指标的波动幅度；（3）A/B测试的可用流量/样本量。

+   PM可以提供与以下内容相关的见解：（1）潜在处理效应的预期大小；（2）我们所拥有的信心量；（3）此测试处理的重要性/范围；（4）此测试处理的紧迫性/时间表。

可能需要反复沟通，因为**更高统计功效**与**更长实验周期**之间存在**权衡**。假设处理效应很微弱（即𝑑𝑚𝑖𝑛应设定为较小），且需要更高的统计功效来检测。在这种情况下，我们必须积累更多样本，因此在日常流量通常不变的情况下，预计需要更长时间。

尽管确定**𝑑𝑚𝑖𝑛**是棘手的，我建议将不同**𝑑𝑚𝑖𝑛**及其对应的样本量组织成表格，如*表2（原始Google表格可以通过* [*这里*](https://docs.google.com/spreadsheets/d/1I8dhHtYu42AoD-BCbM1I2PaGfH2zAbvgQcwd6RDLnuE/edit?usp=sharing) *)*。我们数据科学家首先**选择几个可能的MDEs**并**计算相应的样本量**以及**所需天数**。MDEs可以随时轻松调整，表格为我们提供了一个直接的对比示例，使我们能够与产品经理就上述权衡进行沟通：

![](../Images/33a5ef4f4cbbc5000d636ecb8392a549.png)

表2：计算不同MDEs（**𝑑𝑚𝑖𝑛**）下所需最小样本量的示例表（作者提供）

**如果两组的方差和样本量不相等呢？**

在观察性研究中，两组之间有不同方差是非常常见的。当同质方差假设不成立时，只需做一些微不足道的调整，即在调整公式时**用处理组方差和对照组方差的总和替代2*𝜎2**。

![](../Images/638710eee635e80bca1211eaa93599b2.png)

公式16：在方差不等情况下调整样本量公式（作者提供）

更重要的是，我们可以进一步释放隐含的假设，即处理组和对照组之间的流量是**相等的**。

正如你可能已经注意到的，以上展示的正态分布样本均值差异统计量的尺度是我们在网上帖子中经常看到的所谓**汇总标准差**的人口版本：

![](../Images/3844fdd89e6e1bc8152da950971f75cb.png)

公式17：汇总标准差公式（作者提供）

**如何使用历史数据估计标准差𝜎？**

在A/B测试场景中，为了评估潜在的流量及所需时间，样本量计算通常在实验开始前进行。计算的（唯一）资源是历史数据。因此，问题是我们需要多少历史数据，如何准备这些数据？

**我们需要多少历史数据？**

建议使用过去数据的大致**相同时间长度**作为预期的A/B测试周期。此外，需要注意的是，我们必须确保**历史数据的范围**与处理策略一致。否则，外部有效性无法保证。例如，如果产品经理想测试扩大“下一步”按钮的效果，并希望在两周内收集有关转化率是否增加的实验结果，那么我们需要收集过去两周内曾（应当）接触过该按钮的合格用户的转化率数据。

**我们应如何准备这些数据？**

除了**选择正确的时间范围**和**应用适当的过滤器**到历史数据中，我们还要确保数据以正确的方式进行聚合，以便分析单元与随机化单元相匹配。换句话说，如果流量是在用户层面随机分配的，而用于度量的源数据通常是用户行为层面的，我们需要按每个用户进行分组，并聚合他们的行为以计算度量，然后计算历史样本均值和标准差，这将用于计算所需的样本大小。

# 摘要

在这篇文章中，我们探讨了最小样本大小公式的推导，并广泛讨论了使用该公式的实际问题。你已学到：

1.  如何**推导A/B测试中的最小样本大小公式**

1.  如何**理解许多在线样本大小计算器**以及**其他版本**的最小样本大小公式。

1.  如何**使用这个公式**来计算样本大小，通过将历史数据准备成正确的格式，与产品经理讨论以确定**𝑑𝑚𝑖𝑛**

这篇文章特别受到*<可信的在线受控实验>*（作者：Diane Tang, Ron Kohavi, 和 Ya Xu）、Emma Ding 的 YouTube 视频“*如何估算A/B测试中的样本大小*”以及我在 TikTok 工作中的经验的启发和基础。

# 参考文献

+   [Ding, E. (2021). 如何估算A/B测试中的样本大小。*YouTube*.](https://www.youtube.com/watch?v=JEAsoUrX6KQ)

+   [Miller, E. (2013). 样本大小计算器。](https://www.evanmiller.org/ab-testing/sample-size.html)

+   [Glen, S. 统计中的样本大小（如何找到）：Excel，Cochran公式，常见技巧。*StatisticsHowTo.com*](https://www.statisticshowto.com/probability-and-statistics/find-sample-size/)*.*

+   [Israel, G. D. (1992). 确定样本大小。](https://web.tarleton.edu/academicassessment/wp-content/uploads/sites/119/2022/05/Samplesize.pdf)

+   Kohavi, R., Tang, D., & Xu, Y. (2020). 可信的在线受控实验：A/B测试的实用指南。在*可信的在线受控实验：A/B测试的实用指南*（第I页）。剑桥：剑桥大学出版社。

+   Singh, A. S., & Masuku, M. B. (2014). 采样技术与应用统计研究中的样本量确定：概述。*国际经济、商业与管理期刊*, *2*(11), 1–22.

+   Van Belle, G. (2008). 样本量。*统计学经验法则*, 27–51.

+   [Yadav, M. (2012). 样本量确定|科赫伦公式|山根公式|样本量计算| — 杜教授。*Youtube.*](https://www.youtube.com/watch?v=-pwQJYjWWMc)

+   Yamane, T. (1973). 统计学：入门分析-3.
