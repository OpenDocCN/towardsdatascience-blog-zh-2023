- en: 'Unbox the Cox: A Hidden Dark Secret of Cox Regression'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è§£å¯†Coxå›å½’ï¼šCoxå›å½’çš„éšè—é»‘æš—ç§˜å¯†
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/unbox-the-cox-a-hidden-dark-secret-of-cox-regression-fb432137fd6?source=collection_archive---------9-----------------------#2023-06-27](https://towardsdatascience.com/unbox-the-cox-a-hidden-dark-secret-of-cox-regression-fb432137fd6?source=collection_archive---------9-----------------------#2023-06-27)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/unbox-the-cox-a-hidden-dark-secret-of-cox-regression-fb432137fd6?source=collection_archive---------9-----------------------#2023-06-27](https://towardsdatascience.com/unbox-the-cox-a-hidden-dark-secret-of-cox-regression-fb432137fd6?source=collection_archive---------9-----------------------#2023-06-27)
- en: Why do perfect predictors result in a p-value of 0.93?
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä¸ºä»€ä¹ˆå®Œç¾é¢„æµ‹å› å­çš„på€¼ä¼šä¸º0.93ï¼Ÿ
- en: '[](https://medium.com/@igor-s?source=post_page-----fb432137fd6--------------------------------)[![Igor
    Å egota](../Images/17c592b71fef9526a0679d47937837f6.png)](https://medium.com/@igor-s?source=post_page-----fb432137fd6--------------------------------)[](https://towardsdatascience.com/?source=post_page-----fb432137fd6--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----fb432137fd6--------------------------------)
    [Igor Å egota](https://medium.com/@igor-s?source=post_page-----fb432137fd6--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@igor-s?source=post_page-----fb432137fd6--------------------------------)[![Igor
    Å egota](../Images/17c592b71fef9526a0679d47937837f6.png)](https://medium.com/@igor-s?source=post_page-----fb432137fd6--------------------------------)[](https://towardsdatascience.com/?source=post_page-----fb432137fd6--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----fb432137fd6--------------------------------)
    [Igor Å egota](https://medium.com/@igor-s?source=post_page-----fb432137fd6--------------------------------)'
- en: Â·
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe5f8ebca4ad8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funbox-the-cox-a-hidden-dark-secret-of-cox-regression-fb432137fd6&user=Igor+%C5%A0egota&userId=e5f8ebca4ad8&source=post_page-e5f8ebca4ad8----fb432137fd6---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----fb432137fd6--------------------------------)
    Â·8 min readÂ·Jun 27, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffb432137fd6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funbox-the-cox-a-hidden-dark-secret-of-cox-regression-fb432137fd6&user=Igor+%C5%A0egota&userId=e5f8ebca4ad8&source=-----fb432137fd6---------------------clap_footer-----------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[å…³æ³¨](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe5f8ebca4ad8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funbox-the-cox-a-hidden-dark-secret-of-cox-regression-fb432137fd6&user=Igor+%C5%A0egota&userId=e5f8ebca4ad8&source=post_page-e5f8ebca4ad8----fb432137fd6---------------------post_header-----------)
    å‘è¡¨åœ¨ [Towards Data Science](https://towardsdatascience.com/?source=post_page-----fb432137fd6--------------------------------)
    Â· 8 min é˜…è¯» Â· 2023å¹´6æœˆ27æ—¥ [](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffb432137fd6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funbox-the-cox-a-hidden-dark-secret-of-cox-regression-fb432137fd6&user=Igor+%C5%A0egota&userId=e5f8ebca4ad8&source=-----fb432137fd6---------------------clap_footer-----------)'
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffb432137fd6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funbox-the-cox-a-hidden-dark-secret-of-cox-regression-fb432137fd6&source=-----fb432137fd6---------------------bookmark_footer-----------)![](../Images/5854f8dc3addbe438ea7037fcb639fe1.png)'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffb432137fd6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funbox-the-cox-a-hidden-dark-secret-of-cox-regression-fb432137fd6&source=-----fb432137fd6---------------------bookmark_footer-----------)![](../Images/5854f8dc3addbe438ea7037fcb639fe1.png)'
- en: Photo by [Dima Pechurin](https://unsplash.com/pt-br/@pechka?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”± [Dima Pechurin](https://unsplash.com/pt-br/@pechka?utm_source=medium&utm_medium=referral)
    æä¾›ï¼Œæ¥æºäº [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
- en: Diving into the perfect predictors
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ¢ç´¢å®Œç¾é¢„æµ‹å› å­
- en: If you have been following my previous blog posts, you might recall that logistic
    regression encounters a problem when trying to fit perfectly separated data, [leading
    to an infinite odds ratio](https://medium.com/towards-data-science/logistic-regression-faceoff-67560de4f492)*.*
    In Cox regression, where hazard replaces odds, you might wonder if a similar issue
    arises with perfect predictors. It does occur, but unlike logistic regression,
    it is much less apparent how this occurs here and even what constitutes â€œperfect
    predictorsâ€. As will become more clear later, perfect predictors are defined as
    predictors *x* whose ranks exactly match the ranks of event times (their Spearman
    correlation is one).
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ ä¸€ç›´å…³æ³¨æˆ‘çš„ä¹‹å‰çš„åšå®¢å¸–å­ï¼Œä½ å¯èƒ½ä¼šè®°å¾—é€»è¾‘å›å½’åœ¨å°è¯•å®Œç¾åˆ†ç¦»æ•°æ®æ—¶ä¼šé‡åˆ°é—®é¢˜ï¼Œ[å¯¼è‡´æ— é™çš„èµ”ç‡æ¯”](https://medium.com/towards-data-science/logistic-regression-faceoff-67560de4f492)*ã€‚åœ¨
    Cox å›å½’ä¸­ï¼Œé£é™©æ›¿ä»£äº†èµ”ç‡ï¼Œä½ å¯èƒ½ä¼šæƒ³çŸ¥é“å®Œç¾é¢„æµ‹å˜é‡æ˜¯å¦ä¼šå‡ºç°ç±»ä¼¼çš„é—®é¢˜ã€‚ç¡®å®ä¼šå‡ºç°ï¼Œä½†æ˜¯ä¸é€»è¾‘å›å½’ä¸åŒï¼Œè¿™é‡Œçš„é—®é¢˜ä¸é‚£ä¹ˆæ˜æ˜¾ï¼Œä¹Ÿä¸å®¹æ˜“ç•Œå®šä»€ä¹ˆæ˜¯â€œå®Œç¾é¢„æµ‹å˜é‡â€ã€‚å¦‚åé¢ä¼šæ›´åŠ æ˜ç¡®ï¼Œå®Œç¾é¢„æµ‹å˜é‡è¢«å®šä¹‰ä¸ºé¢„æµ‹å˜é‡*x*ï¼Œå…¶æ’åæ°å¥½ä¸äº‹ä»¶æ—¶é—´çš„æ’åä¸€è‡´ï¼ˆå®ƒä»¬çš„æ–¯çš®å°”æ›¼ç›¸å…³ç³»æ•°ä¸º
    1ï¼‰ã€‚
- en: 'Previously, on â€œUnbox the Coxâ€:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: ä¹‹å‰ï¼Œåœ¨â€œUnbox the Coxâ€ä¸­ï¼š
- en: '[](/unbox-the-cox-intuitive-guide-to-cox-regressions-c485408ae15d?source=post_page-----fb432137fd6--------------------------------)
    [## Unbox the Cox: Intuitive Guide to Cox Regressions'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '[](/unbox-the-cox-intuitive-guide-to-cox-regressions-c485408ae15d?source=post_page-----fb432137fd6--------------------------------)
    [## Unbox the Cox: ç›´è§‚æŒ‡å—åˆ° Cox å›å½’'
- en: How do hazards and maximum likelihood estimates predict event rankings?
  id: totrans-13
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: é£é™©å’Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡å¦‚ä½•é¢„æµ‹äº‹ä»¶æ’åï¼Ÿ
- en: towardsdatascience.com](/unbox-the-cox-intuitive-guide-to-cox-regressions-c485408ae15d?source=post_page-----fb432137fd6--------------------------------)
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '[towardsdatascience.com](/unbox-the-cox-intuitive-guide-to-cox-regressions-c485408ae15d?source=post_page-----fb432137fd6--------------------------------)'
- en: 'we explained maximum likelihood estimation and introduced a made-up dataset
    with five subjects, where a single predictor, *x*, represented the dosage of a
    life-extending drug. To make *x* a perfect predictor of event times, here we swapped
    the event times for subjects C and D:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è§£é‡Šäº†æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼Œå¹¶ä»‹ç»äº†ä¸€ä¸ªè™šæ„çš„æ•°æ®é›†ï¼Œå…¶ä¸­æœ‰äº”ä¸ªä¸»ä½“ï¼Œä¸€ä¸ªé¢„æµ‹å˜é‡*x*ï¼Œä»£è¡¨äº†ä¸€ç§å»¶é•¿ç”Ÿå‘½çš„è¯ç‰©çš„å‰‚é‡ã€‚ä¸ºäº†ä½¿*x*æˆä¸ºäº‹ä»¶æ—¶é—´çš„å®Œç¾é¢„æµ‹å˜é‡ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œäº¤æ¢äº†ä¸»ä½“
    C å’Œ D çš„äº‹ä»¶æ—¶é—´ï¼š
- en: '[PRE0]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![](../Images/15880abec14a17404267728d9a3afd82.png)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/15880abec14a17404267728d9a3afd82.png)'
- en: Image by the author.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: 'To understand why these â€œperfect predictorsâ€ can be problematic, letâ€™s pick
    up right where we left off and check the negative log-likelihood cost plotted
    against *Î²*:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆè¿™äº›â€œå®Œç¾é¢„æµ‹å˜é‡â€å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œè®©æˆ‘ä»¬ä»ä¸Šæ¬¡çš„å†…å®¹ç»§ç»­ï¼ŒæŸ¥çœ‹è´Ÿå¯¹æ•°ä¼¼ç„¶å›¾ä¸*Î²*çš„å…³ç³»ï¼š
- en: '[PRE1]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![](../Images/84e4aa14eea51ed69bc51e9c23ff5840.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/84e4aa14eea51ed69bc51e9c23ff5840.png)'
- en: Image by the author.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: 'You can see right away that there is no minimum value of *Î²* any longer: if
    we use very large negative values of *Î²*, we end up with log-likelihood fits that
    are near-perfect for all events.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥ç«‹å³çœ‹åˆ°*Î²*æ²¡æœ‰æœ€å°å€¼ï¼šå¦‚æœæˆ‘ä»¬ä½¿ç”¨éå¸¸å¤§çš„è´Ÿå€¼çš„*Î²*ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå¾—åˆ°å‡ ä¹å®Œç¾çš„å¯¹æ•°ä¼¼ç„¶æ‹Ÿåˆç»“æœã€‚
- en: 'Now, letâ€™s dive into the math behind this and take a look at the likelihood
    of event A. Weâ€™ll dig into how the numerator and denominator change as we tweak
    *Î²*:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥æ¢è®¨ä¸€ä¸‹èƒŒåçš„æ•°å­¦åŸç†ï¼Œçœ‹çœ‹äº‹ä»¶ A çš„å¯èƒ½æ€§ã€‚æˆ‘ä»¬å°†ç ”ç©¶åˆ†å­å’Œåˆ†æ¯åœ¨è°ƒæ•´*Î²*æ—¶çš„å˜åŒ–æƒ…å†µï¼š
- en: '![](../Images/f5509f0ba94030c965b8c45e143af6d3.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f5509f0ba94030c965b8c45e143af6d3.png)'
- en: 'When *Î²* is high or a large positive number, the last term in the denominator
    (with the largest *x* of 1.2), representing the hazard of subject E, dominates
    the entire denominator and becomes exceedingly large. So, the likelihood becomes
    small and approaches zero:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: å½“*Î²*å¾ˆé«˜æˆ–æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ­£æ•°æ—¶ï¼Œåˆ†æ¯ä¸­çš„æœ€åä¸€ä¸ªé¡¹ï¼ˆå…·æœ‰æœ€å¤§* x* ä¸º 1.2ï¼‰ï¼Œä»£è¡¨äº†ä¸»ä½“ E çš„é£é™©ï¼Œä¸»å¯¼äº†æ•´ä¸ªåˆ†æ¯ï¼Œå¹¶å˜å¾—æå…¶å·¨å¤§ã€‚å› æ­¤ï¼Œä¼¼ç„¶å˜å¾—å¾ˆå°ï¼Œæ¥è¿‘äºé›¶ï¼š
- en: '![](../Images/4a33d3c071776416288bc2bd87eed8bb.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/4a33d3c071776416288bc2bd87eed8bb.png)'
- en: This results in a big negative log-likelihood. The same thing happens for each
    individual likelihood because the last hazard of subject E, will always exceed
    any hazard in the numerator. As a result, the negative log-likelihood increases
    for subjects A to D. In this case, when we have high *Î²*, it brings down all the
    likelihoods, resulting in poor fits for all events.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¼šå¯¼è‡´å¾ˆå¤§çš„è´Ÿå¯¹æ•°ä¼¼ç„¶ã€‚æ¯ä¸ªå•ç‹¬çš„ä¼¼ç„¶æƒ…å†µä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºä¸»ä½“ E çš„æœ€åä¸€ä¸ªé£é™©æ€»æ˜¯ä¼šè¶…è¿‡åˆ†å­ä¸­çš„ä»»ä½•é£é™©ã€‚å› æ­¤ï¼Œä¸»ä½“ A åˆ° D çš„è´Ÿå¯¹æ•°ä¼¼ç„¶å¢åŠ ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬æœ‰è¾ƒé«˜çš„*Î²*æ—¶ï¼Œå®ƒä¼šé™ä½æ‰€æœ‰çš„ä¼¼ç„¶ï¼Œå¯¼è‡´æ‰€æœ‰äº‹ä»¶çš„æ‹Ÿåˆæ•ˆæœè¾ƒå·®ã€‚
- en: 'Now, when *Î²* is low or a big negative number, the first term in the denominator,
    representing the hazard of subject A, dominates since it has the lowest *x* value.
    As the same hazard of subject A also appears in the numerator, the likelihood
    L(A) can be arbitrarily close to 1 by making Î² increasingly negative, thereby
    creating an almost perfect fit:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œå½“*Î²*å€¼è¾ƒä½æˆ–ä¸ºä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ•°æ—¶ï¼Œåˆ†æ¯ä¸­çš„ç¬¬ä¸€ä¸ªé¡¹ï¼Œä»£è¡¨äº†å¯¹è±¡Açš„é£é™©ï¼Œå› ä¸ºå®ƒçš„*x*å€¼æœ€ä½ï¼Œä¸»å¯¼äº†åˆ†æ¯ã€‚ç”±äºå¯¹è±¡Açš„é£é™©ä¹Ÿå‡ºç°åœ¨åˆ†å­ä¸­ï¼Œé€šè¿‡ä½¿*Î²*è¶Šæ¥è¶Šè´Ÿï¼Œä¼¼ä¹èƒ½ä½¿L(A)æ¥è¿‘1ï¼Œä»è€Œåˆ›é€ å‡ºå‡ ä¹å®Œç¾çš„æ‹Ÿåˆï¼š
- en: '![](../Images/606a470b8a080c47cafdcf39a47ac2d8.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/606a470b8a080c47cafdcf39a47ac2d8.png)'
- en: 'The same deal goes for all the other individual likelihoods: negative *Î²s*
    now boost the likelihoods of all events at the same time. Basically, having a
    negativeÎ² doesnâ€™t come with any downsides. At the same time, certain individual
    hazards increase (subjects A and B with negativex), some stay the same (subject
    C with *x =* 0), and others decrease (subject D with positivex). But remember,
    what really matters here are ratios of hazards. We can verify this hand-waving
    math by plotting individual hazards:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹æ‰€æœ‰å…¶ä»–å•ä¸ªå¯èƒ½æ€§æ¥è¯´ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼šè´Ÿ*Î²*ç°åœ¨åŒæ—¶æå‡æ‰€æœ‰äº‹ä»¶çš„å¯èƒ½æ€§ã€‚åŸºæœ¬ä¸Šï¼Œè´Ÿ*Î²*ä¸ä¼šå¸¦æ¥ä»»ä½•ç¼ºç‚¹ã€‚åŒæ—¶ï¼ŒæŸäº›ä¸ªä½“é£é™©å¢åŠ ï¼ˆå¯¹è±¡Aå’ŒBçš„è´Ÿ*x*ï¼‰ï¼Œæœ‰äº›ä¿æŒä¸å˜ï¼ˆå¯¹è±¡Cçš„*x
    =* 0ï¼‰ï¼Œå…¶ä»–åˆ™å‡å°‘ï¼ˆå¯¹è±¡Dçš„æ­£*x*ï¼‰ã€‚ä½†è¯·è®°ä½ï¼ŒçœŸæ­£é‡è¦çš„æ˜¯é£é™©çš„æ¯”ç‡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»˜åˆ¶å•ä¸ªé£é™©æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼š
- en: '[PRE2]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![](../Images/e3607c24c61922b16d990450fa47d835.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/e3607c24c61922b16d990450fa47d835.png)'
- en: Image by the author.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: 'The way likelihoods are put together, as a ratio of a hazard to the sum of
    hazards of all subjects still at risk, means that negative *Î²* values make a **perfect
    fit for the likelihood of each subject whose event time rank is greater than or
    equal to the predictor rank**! As a side note, if *x* had a perfect *negative*
    Spearman correlation with event times, things would be flipped around: arbitrarily
    positive *Î²*s would give us arbitrarily good fits.'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: å¯èƒ½æ€§çš„ç»„åˆæ–¹å¼ï¼Œå³é£é™©ä¸æ‰€æœ‰ä»ç„¶å¤„äºé£é™©ä¸­çš„å¯¹è±¡çš„é£é™©æ€»å’Œçš„æ¯”ç‡ï¼Œæ„å‘³ç€è´Ÿ*Î²*å€¼ä¸ºæ¯ä¸ªäº‹ä»¶æ—¶é—´æ’åå¤§äºæˆ–ç­‰äºé¢„æµ‹å› å­æ’åçš„å¯¹è±¡çš„**å¯èƒ½æ€§æä¾›äº†ä¸€ä¸ªå®Œç¾çš„æ‹Ÿåˆ**ï¼ä½œä¸ºé™„å¸¦è¯´æ˜ï¼Œå¦‚æœ*x*ä¸äº‹ä»¶æ—¶é—´æœ‰å®Œç¾çš„*è´Ÿ*æ–¯çš®å°”æ›¼ç›¸å…³æ€§ï¼Œæƒ…å†µå°†ä¼šåè½¬ï¼šä»»æ„æ­£çš„*Î²*ä¼šç»™æˆ‘ä»¬å¸¦æ¥ä»»æ„å¥½çš„æ‹Ÿåˆã€‚
- en: Misaligned predictor and time ranks
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä¸åŒ¹é…çš„é¢„æµ‹å› å­å’Œæ—¶é—´æ’å
- en: 'We can actually see this and show you what goes down when event time ranks
    and predictor ranks do not line up using a another made-up example:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å®é™…ä¸Šå¯ä»¥çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œå¹¶å‘ä½ å±•ç¤ºå½“äº‹ä»¶æ—¶é—´æ’åå’Œé¢„æµ‹å› å­æ’åä¸åŒ¹é…æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä½¿ç”¨å¦ä¸€ä¸ªè™šæ„çš„ä¾‹å­ï¼š
- en: '[PRE3]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![](../Images/3c639010a4db2b20b224393ffed42ef7.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3c639010a4db2b20b224393ffed42ef7.png)'
- en: 'In this particular example, the `time` column ranges from 1 to 8, where each
    value represents its own rank. We also have an `x_rank` column, which ranks the
    predictors *x*. Now, here''s the key observation: for subjects D and G, their
    `x_rank` is actually higher than their corresponding `time` rank. As a result,
    the likelihoods of D and G won''t experience the cancellation effect between the
    numerator and denominator when we have large negative values of *Î²*:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œ`time`åˆ—çš„èŒƒå›´ä»1åˆ°8ï¼Œæ¯ä¸ªå€¼ä»£è¡¨å…¶è‡ªå·±çš„æ’åã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ª`x_rank`åˆ—ï¼Œç”¨äºæ’åé¢„æµ‹å› å­*x*ã€‚ç°åœ¨ï¼Œå…³é”®è§‚å¯Ÿç‚¹æ˜¯ï¼šå¯¹äºDå’ŒGå¯¹è±¡ï¼Œå®ƒä»¬çš„`x_rank`å®é™…ä¸Šé«˜äºå…¶å¯¹åº”çš„`time`æ’åã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æœ‰å¤§è´Ÿå€¼çš„*Î²*æ—¶ï¼ŒDå’ŒGçš„å¯èƒ½æ€§ä¸ä¼šåœ¨åˆ†å­å’Œåˆ†æ¯ä¹‹é—´ç»å†æŠµæ¶ˆæ•ˆåº”ï¼š
- en: '![](../Images/a59a9dda57fca6a1bf85aa40863c81c7.png)![](../Images/f6fb2510e40f11c7ed08408509ac2da5.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a59a9dda57fca6a1bf85aa40863c81c7.png)![](../Images/f6fb2510e40f11c7ed08408509ac2da5.png)'
- en: 'Their likelihoods are now maximal at some intermediate finite values of *Î²*.
    Letâ€™s take a look at a plot of individual likelihoods to see this:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: ä»–ä»¬çš„å¯èƒ½æ€§ç°åœ¨åœ¨æŸäº›ä¸­é—´æœ‰é™çš„*Î²*å€¼å¤„è¾¾åˆ°æœ€å¤§ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å•ä¸ªå¯èƒ½æ€§çš„å›¾è¡¨ï¼š
- en: '[PRE4]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](../Images/963e381927c49fa06858b34c9ac5f2dc.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/963e381927c49fa06858b34c9ac5f2dc.png)'
- en: Image by the author.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: 'These â€œmisalignedâ€ ranks between a time and a predictor play a crucial role:
    they stop all likelihoods from essentially collapsing into one when we have significantly
    negative *Î²*s.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: æ—¶é—´å’Œé¢„æµ‹å› å­ä¹‹é—´çš„è¿™äº›â€œé”™ä½â€æ’åèµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼šå®ƒä»¬é˜»æ­¢æ‰€æœ‰å¯èƒ½æ€§åœ¨æˆ‘ä»¬æœ‰æ˜¾è‘—è´Ÿ*Î²*å€¼æ—¶åŸºæœ¬ä¸Šåç¼©æˆä¸€ä¸ªã€‚
- en: In conclusion, in Cox regression, in order to obtain a finite coefficient *Î²*
    for a predictor *x*, we require at least one instance where the rank of the predictor
    *x* is lower than the rank of the event time.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: æ€»ç»“æ¥è¯´ï¼Œåœ¨Coxå›å½’ä¸­ï¼Œä¸ºäº†è·å¾—é¢„æµ‹å› å­*x*çš„æœ‰é™ç³»æ•°*Î²*ï¼Œæˆ‘ä»¬éœ€è¦è‡³å°‘æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå…¶ä¸­é¢„æµ‹å› å­*x*çš„æ’åä½äºäº‹ä»¶æ—¶é—´çš„æ’åã€‚
- en: Perfect is indeed the enemy of the good (p-value)
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å®Œç¾ç¡®å®æ˜¯è‰¯å¥½çš„æ•Œäººï¼ˆpå€¼ï¼‰
- en: 'So, how do these perfect predictors actually behave in real-life scenarios?
    Well, to find out, letâ€™s once again turn to the lifelines library for some investigation:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: é‚£ä¹ˆï¼Œè¿™äº›å®Œç¾çš„é¢„æµ‹å› å­åœ¨ç°å®åœºæ™¯ä¸­å®é™…ä¸Šè¡¨ç°å¦‚ä½•ï¼Ÿä¸ºäº†æ‰¾å‡ºç­”æ¡ˆï¼Œè®©æˆ‘ä»¬å†æ¬¡è½¬å‘lifelinesåº“è¿›è¡Œä¸€äº›è°ƒæŸ¥ï¼š
- en: '[PRE5]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[PRE6]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](../Images/f2e4431769f8c082ba5d63a695e27887.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f2e4431769f8c082ba5d63a695e27887.png)'
- en: Just like in logistic regression, weâ€™re encountering convergence warnings and
    getting extremely wide confidence intervals for our predictor coefficient *Î²*.
    **As a result, we end up with a p-value of 0.93**!
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: å°±åƒåœ¨é€»è¾‘å›å½’ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬é‡åˆ°äº†æ”¶æ•›è­¦å‘Šï¼Œå¹¶ä¸”å¾—åˆ°äº†æå®½çš„é¢„æµ‹å› å­ç³»æ•°*Î²*çš„ç½®ä¿¡åŒºé—´**å› æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°çš„på€¼ä¸º0.93**ï¼
- en: If we simply filter models based on p-values without taking this issue into
    account or conducting further investigation, we would overlook these perfect predictors.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬ä»…ä»…åŸºäºpå€¼è¿‡æ»¤æ¨¡å‹è€Œä¸è€ƒè™‘è¿™ä¸ªé—®é¢˜æˆ–è¿›è¡Œè¿›ä¸€æ­¥è°ƒæŸ¥ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¿½è§†è¿™äº›å®Œç¾çš„é¢„æµ‹å› å­ã€‚
- en: 'To tackle this convergence problem, the lifelines library documentation and
    some helpful StackOverflow threads suggest a potential solution: incorporating
    a regularization term into the cost function. This term effectively increases
    the cost for large coefficient values, and you can activate L2 regularization
    by setting the `penalizer` argument to a value greater than zero:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†åº”å¯¹è¿™ä¸ªæ”¶æ•›é—®é¢˜ï¼Œlifelinesåº“æ–‡æ¡£å’Œä¸€äº›æœ‰ç”¨çš„StackOverflowçº¿ç¨‹å»ºè®®äº†ä¸€ä¸ªæ½œåœ¨çš„è§£å†³æ–¹æ¡ˆï¼šå°†æ­£åˆ™åŒ–é¡¹çº³å…¥æˆæœ¬å‡½æ•°ã€‚è¿™ä¸ªé¡¹æœ‰æ•ˆåœ°å¢åŠ äº†å¤§ç³»æ•°å€¼çš„æˆæœ¬ï¼Œä½ å¯ä»¥é€šè¿‡å°†`penalizer`å‚æ•°è®¾ç½®ä¸ºå¤§äºé›¶çš„å€¼æ¥æ¿€æ´»L2æ­£åˆ™åŒ–ï¼š
- en: '[PRE7]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](../Images/6b85fb942524535ad537bab989e4d1a7.png)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/6b85fb942524535ad537bab989e4d1a7.png)'
- en: This approach fixes the convergence warning, but it doesnâ€™t really make a huge
    dent in shrinking that pesky p-value. Even with this regularization trick, the
    p-value for a perfect predictor still hangs around at a somewhat large value 0.11.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç§æ–¹æ³•ä¿®å¤äº†æ”¶æ•›è­¦å‘Šï¼Œä½†å¹¶æ²¡æœ‰åœ¨ç¼©å°é‚£ä¸ªè®¨åŒçš„på€¼ä¸Šå–å¾—å·¨å¤§è¿›å±•ã€‚å³ä½¿ä½¿ç”¨äº†è¿™ç§æ­£åˆ™åŒ–æŠ€å·§ï¼Œå®Œç¾é¢„æµ‹å› å­çš„på€¼ä»ç„¶ç»´æŒåœ¨ä¸€ä¸ªç›¸å¯¹è¾ƒå¤§çš„å€¼0.11ã€‚
- en: 'Time is relative: only ranks matter'
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ—¶é—´æ˜¯ç›¸å¯¹çš„ï¼šåªæœ‰æ’åæ‰é‡è¦
- en: 'Lastly, weâ€™ll verify that the absolute values of event times have no impact
    on a Cox regression fit, using our previous example. To do this, weâ€™ll introduce
    a new column called `time2`, which will contain random numbers in the same order
    as the `time` column:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œæˆ‘ä»¬å°†éªŒè¯äº‹ä»¶æ—¶é—´çš„ç»å¯¹å€¼å¯¹Coxå›å½’æ‹Ÿåˆæ²¡æœ‰å½±å“ï¼Œä½¿ç”¨æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†å¼•å…¥ä¸€ä¸ªåä¸º`time2`çš„æ–°åˆ—ï¼Œå…¶ä¸­åŒ…å«ä¸`time`åˆ—ç›¸åŒé¡ºåºçš„éšæœºæ•°å­—ï¼š
- en: '[PRE8]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](../Images/c640ed3ed5010c5ab0d8da500b31c714.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c640ed3ed5010c5ab0d8da500b31c714.png)'
- en: 'Their fits are indeed identical:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒä»¬çš„æ‹Ÿåˆç¡®å®æ˜¯ç›¸åŒçš„ï¼š
- en: '[PRE9]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](../Images/99c7b05224f1a308f298c14adcce3a87.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/99c7b05224f1a308f298c14adcce3a87.png)'
- en: '[PRE10]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](../Images/c49f79ac66e6621a31ffc051e8188e87.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c49f79ac66e6621a31ffc051e8188e87.png)'
- en: Conclusion
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: What did we learn from all of this?
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ä»ä¸­å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ
- en: Perfect predictors in survival models are those predictors whose ranks perfectly
    match the ranks of event times.
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç”Ÿå­˜æ¨¡å‹ä¸­çš„å®Œç¾é¢„æµ‹å› å­æ˜¯é‚£äº›æ’åä¸äº‹ä»¶æ—¶é—´çš„æ’åå®Œå…¨åŒ¹é…çš„é¢„æµ‹å› å­ã€‚
- en: Cox regression cannot fit these perfect predictors with a finite coefficient
    *Î²*, leading to wide confidence intervals and big p-values.
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Coxå›å½’æ— æ³•ç”¨æœ‰é™çš„ç³»æ•°*Î²*æ¥æ‹Ÿåˆè¿™äº›å®Œç¾é¢„æµ‹å› å­ï¼Œå¯¼è‡´äº†å®½ç½®ä¿¡åŒºé—´å’Œå¤§çš„på€¼ã€‚
- en: The actual values of event times donâ€™t really matter â€” itâ€™s all about their
    ranks.
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: äº‹ä»¶æ—¶é—´çš„å®é™…å€¼å¹¶ä¸é‡è¦â€”â€”å…³é”®åœ¨äºå®ƒä»¬çš„æ’åã€‚
- en: When the ranks of event times and predictors donâ€™t align, we donâ€™t get that
    handy cancellation effect for large *Î²* values in likelihoods. So, we need at
    least one case where the ranks donâ€™t match to have a fit with a finite coefficient.
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å½“äº‹ä»¶æ—¶é—´å’Œé¢„æµ‹å› å­çš„æ’åä¸ä¸€è‡´æ—¶ï¼Œæˆ‘ä»¬æ— æ³•åœ¨ä¼¼ç„¶ä¸­è·å¾—å¤§*Î²*å€¼çš„ä¾¿æ·å–æ¶ˆæ•ˆåº”ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦ä¸€ä¸ªæ’åä¸åŒ¹é…çš„æ¡ˆä¾‹ï¼Œä»¥è·å¾—ä¸€ä¸ªæœ‰é™ç³»æ•°çš„æ‹Ÿåˆã€‚
- en: Even if we try some fancy regularization techniques, perfect predictors can
    still give us those annoyingly wide confidence intervals and high p-values in
    real-life situations.
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å³ä½¿æˆ‘ä»¬å°è¯•ä¸€äº›é«˜çº§çš„æ­£åˆ™åŒ–æŠ€æœ¯ï¼Œå®Œç¾é¢„æµ‹å› å­åœ¨ç°å®æƒ…å†µä¸‹ä»ç„¶ä¼šç»™æˆ‘ä»¬é‚£äº›æ¼äººçš„å®½ç½®ä¿¡åŒºé—´å’Œé«˜på€¼ã€‚
- en: Just like in logistic regression, if we donâ€™t really care about those p-values,
    using a regularization method can still provide us with a handy model fit that
    gets the prediction right!
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å°±åƒåœ¨é€»è¾‘å›å½’ä¸­ä¸€æ ·ï¼Œå¦‚æœæˆ‘ä»¬ä¸å¤ªå…³å¿ƒè¿™äº›på€¼ï¼Œä½¿ç”¨æ­£åˆ™åŒ–æ–¹æ³•ä»ç„¶å¯ä»¥æä¾›ä¸€ä¸ªæ–¹ä¾¿çš„æ¨¡å‹æ‹Ÿåˆï¼Œå‡†ç¡®è¿›è¡Œé¢„æµ‹ï¼
- en: 'If you would like to run the code yourself, feel free to use IPython notebooks
    from my Github: [https://github.com/igor-sb/blog/blob/main/posts/cox_perfect.ipynb](https://github.com/igor-sb/blog/blob/main/posts/cox_perfect.ipynb)'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æƒ³è‡ªå·±è¿è¡Œä»£ç ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘Githubä¸Šçš„IPythonç¬”è®°æœ¬ï¼š[https://github.com/igor-sb/blog/blob/main/posts/cox_perfect.ipynb](https://github.com/igor-sb/blog/blob/main/posts/cox_perfect.ipynb)
- en: Farewell until the next post! ğŸ‘‹
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: å‘Šåˆ«ï¼Œç›´åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« ï¼ ğŸ‘‹
