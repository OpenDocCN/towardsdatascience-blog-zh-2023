- en: Cluster Analysis for Aspiring Data Scientists
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/cluster-analysis-for-aspiring-data-scientists-5ad88b700a1a?source=collection_archive---------8-----------------------#2023-02-23](https://towardsdatascience.com/cluster-analysis-for-aspiring-data-scientists-5ad88b700a1a?source=collection_archive---------8-----------------------#2023-02-23)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: A step-by-step case study of how data scientists approach and execute a cluster
    analysis
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@alex.vamvakaris.ds?source=post_page-----5ad88b700a1a--------------------------------)[![Alex
    Vamvakaris](../Images/bf8cf7c92a94d2b0d9242afcc03bf425.png)](https://medium.com/@alex.vamvakaris.ds?source=post_page-----5ad88b700a1a--------------------------------)[](https://towardsdatascience.com/?source=post_page-----5ad88b700a1a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----5ad88b700a1a--------------------------------)
    [Alex Vamvakaris](https://medium.com/@alex.vamvakaris.ds?source=post_page-----5ad88b700a1a--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8072260dd591&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcluster-analysis-for-aspiring-data-scientists-5ad88b700a1a&user=Alex+Vamvakaris&userId=8072260dd591&source=post_page-8072260dd591----5ad88b700a1a---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----5ad88b700a1a--------------------------------)
    ·11 min read·Feb 23, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5ad88b700a1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcluster-analysis-for-aspiring-data-scientists-5ad88b700a1a&user=Alex+Vamvakaris&userId=8072260dd591&source=-----5ad88b700a1a---------------------clap_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5ad88b700a1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcluster-analysis-for-aspiring-data-scientists-5ad88b700a1a&source=-----5ad88b700a1a---------------------bookmark_footer-----------)![](../Images/51486cbac4597e6f2474fa48835e4801.png)'
  prefs: []
  type: TYPE_NORMAL
- en: Photo by [israel palacio](https://unsplash.com/@othentikisra?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/ImcUkZ72oUs?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  prefs: []
  type: TYPE_NORMAL
- en: Going back to my time as an undergraduate student in statistics, there is a
    day that stands out. It was the first day of the multivariate analysis module.
    This class was new at the time, and to our surprise, the professor decided to
    do something different. Instead of going through the agenda for the semester,
    he closed the lights and announced that today we would learn about the module
    differently — by watching the pilot episode of the series “Numb3rs”.
  prefs: []
  type: TYPE_NORMAL
- en: The series focuses on FBI Special Agent Don Eppes and his brother, Charles Eppes,
    a brilliant mathematician who uses data science to ferret out the most tricky
    criminals. More specifically, in the pilot episode, Charles uses cluster analysis
    to find out the criminal’s point of origin. Needless to say, we were all hooked.
  prefs: []
  type: TYPE_NORMAL
- en: Fast forwarding to today, I have been through different industries, from eCommerce
    retail to consultancy and gaming, and the one constant desire from all business
    stakeholders was to segment (cluster) their customers or users. It seems that
    clustering piques the interest of both data scientists and business stakeholders
    (as well as movie audiences).
  prefs: []
  type: TYPE_NORMAL
- en: 'In this article, I have created a guide for aspiring data scientists that want
    to add cluster analysis to their arsenal and get one step closer to landing their
    first data science job. The guide will be structured in two parts:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Introduction to Clustering:** Understanding the three building blocks of
    cluster analysis'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**A Step-by-Step Case Study of Clustering in R:** Visualizing the data, data
    processing, computing similarity matrix (distances), selecting the number of clusters,
    and describing results'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 1\. Introduction to Clustering
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '![](../Images/bbf8869d6740330c324feba10a521c9b.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Hans-Peter Gauster](https://unsplash.com/@sloppyperfectionist?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/3y1zF4hIPCg?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  prefs: []
  type: TYPE_NORMAL
- en: '**1.1\. What is the Goal of Clustering?**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Clustering is used to group entities based on a defined set of characteristics.
    For example, we can use clustering to group customers (entities) based on their
    shopping behavior (characteristics).
  prefs: []
  type: TYPE_NORMAL
- en: 1.2\. How does Clustering Works?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In **supervised machine-learning techniques** (like linear regression), the
    algorithm is trained on a labeled dataset with the goal of maximizing prediction
    accuracy on new unlabeled data. For example, an algorithm can be trained on a
    labeled dataset that includes characteristics of houses (square footage, number
    of bedrooms, etc.) and their corresponding label (sales price) with the goal of
    creating a model that predicts with high accuracy the sales price of a new house,
    based on its respective characteristics.
  prefs: []
  type: TYPE_NORMAL
- en: 'Clustering, on the other hand, is an **unsupervised machine-learning technique**.
    The dataset has no label (hence the name unsupervised). Instead, the goal is to
    create a new label in the form of a cluster assignment. Every cluster analysis
    will be different, but in each case, there are three main building blocks or steps
    if you prefer:'
  prefs: []
  type: TYPE_NORMAL
- en: Create a dataset that is unique by row for the entity you want to cluster. So
    if you want to cluster customers, each row must represent a different customer.
    For each one of these rows, you will have attributes (columns) that describe specific
    characteristics, like revenue in the past year, favorite product, number of days
    since last purchase, etc.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Compute the similarity between each row and all others in your dataset (based
    on the available attributes). So we will have a similarity value between the first
    and the second row, the first and third row, the second and third row, and so
    on. The most frequently used similarity functions are distances. We will go through
    these in more detail in the case study of the next section as they are better
    explained using an example
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Input the similarity matrix into a clustering algorithm. There are many available
    in R and Python, like k-means, hierarchical, and PAM. Clustering algorithms have
    a simple purpose. Assign observations into clusters so that observations within
    a cluster are as similar as possible and observations between different clusters
    are as dissimilar as possible. In the end, you will have a cluster assignment
    for each row (observation)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 2\. **A Step-by-Step Case Study of Clustering in R**
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '![](../Images/4c48f930657764eb19f4cdc0c706d50c.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Chris Lawton](https://unsplash.com/@chrislawton?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/wallpapers/nature/forest?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  prefs: []
  type: TYPE_NORMAL
- en: Even though I couldn’t find the dataset used in the pilot episode of the series
    “Numb3rs”, I thought it would be fitting to use something similar for our case
    study, so I picked the [US Arrests dataset](https://r-data.pmagunia.com/dataset/r-dataset-package-datasets-usarrests),
    loaded from the [**datasets**](https://www.rdocumentation.org/packages/datasets/versions/3.6.2)package
    (part of the **base** library in R).
  prefs: []
  type: TYPE_NORMAL
- en: 'The dataset contains 50 rows and 4 attributes. Each row is a US state (entity).
    The four attributes describe the following characteristics of each state:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Murder:** Number of murder arrests per 100000 residents in 1975'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Assault:** Number of assault arrests per 100000 residents in 1975'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Rape:** Number of rape arrests per 100000 residents in 1975'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**UrbanPop:** Percent of the population living in urban areas in 1975'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We also have the state name as row names. This will not be used as input for
    the clustering algorithm
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/a192c79152cb8b36830af00e1c0f604c.png)'
  prefs: []
  type: TYPE_IMG
- en: Overview of USArrests dataset in R [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: 2.1\. Visualizing the Data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Looking at the box plots below, all four attributes seem approximately symmetric
    (UrbanPop is slightly right-skewed, and Rape is slightly left-skewed). If an attribute
    was heavily skewed or if there were outliers, we could consider applying different
    transformations (such as log transformation). This is not necessary with our dataset.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/921fe627f879b9192b2289bc05415d57.png)'
  prefs: []
  type: TYPE_IMG
- en: Box Plot for each attribute in the USArrests dataset [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: You can also see that the attribute **Assault** has much higher values than
    the other three. It is a good practice in clustering to standardize all attributes
    to the same scale before computing the similarities. This is done so that attributes
    on a larger scale do not overcontribute (**Assault** is in the hundreds, whereas
    the other three attributes are in the tens). Fortunately, the similarity function
    we will use takes care of that, so we do not need to do any rescaling at this
    stage.
  prefs: []
  type: TYPE_NORMAL
- en: 2.2\. Computing Similarity Matrix
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For our case study, we will use the Gower distancefrom the [**daisy**](https://www.rdocumentation.org/packages/cluster/versions/2.1.4/topics/daisy)function
    (**cluster** package) in R to compute the similarity matrix. To be more specific,
    Gower uses dissimilarities as a distance function, but the concept is the same
    (instead of maximizing similarity, we minimize dissimilarity).
  prefs: []
  type: TYPE_NORMAL
- en: Gower is one of the few distance functions that can work with mixed-type data
    (numerical and categorical attributes). Another advantage is that Gower scales
    all distances to be between 0 and 1 (attributes on high scales do not overcontribute).
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: So for our dataset with n = 50 rows (states), we will have a 50x50 matrix with
    1225 unique values (*n*(n-1)/2*). The diagonal is not needed (distance of a state
    with itself), and the upper triangle is the same as the lower (the matrix is symmetrical).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/5c7aefb9ba8a15cc64ff3f09363ead40.png)'
  prefs: []
  type: TYPE_IMG
- en: Snapshot of Gower distance matrix [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: 2.3\. Selecting the Number of Clusters
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For our case study, we will use the PAM (Partitioning Around Medoids) clustering
    algorithm and, more specifically, the [**pam**](https://www.rdocumentation.org/packages/cluster/versions/2.1.4/topics/pam)function
    (**cluster** package).
  prefs: []
  type: TYPE_NORMAL
- en: PAM (and all other K-medoid algorithms) is a robust alternative to k-means because
    it uses medoids as cluster centers instead of means. As a result, the algorithm
    is less sensitive to noise and outliers compared to k-means (but not immune!).
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: First, we need to select the number of clusters. The approach for determining
    the number of clusters is pretty straightforward. We will run the PAM algorithm
    using the Gower similarity matrix we computed in the previous step, and in each
    run, we will select a different number of clusters (from 2 to 10). Then, we will
    compute the Average Silhouette Width (ASW) for each run. We will do that using
    the function below.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: The ASW represents how well each observation fits in its present cluster compared
    to the closest neighboring cluster. It ranges from -1 to 1, with higher values
    (closer to 1) indicating better clustering results. We will use the Silhouette
    Plot (ASW on the y-axis and number of clusters on the x-axis) to visually examine
    the promising candidates for our clustering.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/60abd1cebaff284b93b8aa8d1f42d5f6.png)'
  prefs: []
  type: TYPE_IMG
- en: Silhouette Plot using PAM and Gower distance [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: The solution with the highest ASW is 2 clusters, and after a steep decrease,
    we have 3 and 4 clusters, and then ASW decreases abruptly again. Our possible
    candidates are these three options (2, 3, and 4 clusters). Let’s save the clustering
    assignment from each run as three new attributes (cluster_2, cluster_3, and cluster_4)
    in the USArrests dataset.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 2.4\. Describing Cluster Solutions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Because clustering is an unsupervised technique, it is important to remember
    that, in essence, it is exploratory analysis (EDA) on steroids. So unlike supervised
    techniques, we cannot evaluate the accuracy of our clustering solution (there
    is no label in the dataset to use for comparison). Instead, the “goodness” of
    your cluster analysis will be evaluated based on a different criterion:'
  prefs: []
  type: TYPE_NORMAL
- en: Are the resulting clusters separated in a way that reflects the aspects that
    the business stakeholders had in mind?
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: So the final decision is based on something other than the solution with the
    highest ASW. It is instead made by examining the characteristics of each clustering
    solution. You should always pick the clustering that is more actionable to the
    business than the one with the highest ASW.
  prefs: []
  type: TYPE_NORMAL
- en: First, we want to examine how the different clustering solutions are related.
    We will use the alluvial plot to visualize the flow of observations (states) between
    the three runs.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/b0e25d6bf3a5809afb09eac65aa24e42.png)'
  prefs: []
  type: TYPE_IMG
- en: Alluvial Plot of cluster assignment for different runs of PAM [Image by the
    author]
  prefs: []
  type: TYPE_NORMAL
- en: In the alluvial plot above, each column represents a different run, and the
    different colored ribbons represent fixed blocks of states as they split or get
    reassigned between the three cluster runs.
  prefs: []
  type: TYPE_NORMAL
- en: For example, the red ribbon represents the states of Alabama, Georgia, Louisiana,
    Mississippi, North Carolina, South Carolina, and Tennessee (see code below). These
    states were assigned to the same cluster (“1”) as the states from the blue ribbon
    in the run with two and three clusters (cluster_2 and cluster_3) but were separated
    in the run with four clusters (cluster_4).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/c32d4ba1de826372746eba7b15d4c5a4.png)'
  prefs: []
  type: TYPE_IMG
- en: States in the red ribbon in the alluvial plot [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: Next, we want to understand better the characteristics of each cluster and how
    they are different between the three solutions.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/7ccac6397ba79535347fc9351ca193a6.png)'
  prefs: []
  type: TYPE_IMG
- en: Descriptive statistics by cluster run [Image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: '**Run with two clusters:**'
  prefs: []
  type: TYPE_NORMAL
- en: Cluster “1” has higher average arrests across all crimes
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: No observable difference in average urban population %
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Run with three clusters:**'
  prefs: []
  type: TYPE_NORMAL
- en: The three clusters seem to be well separated
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Compared to the high (cluster “1”) and low (cluster “2”) arrests from the run
    with two clusters, we now have high (cluster “1”), medium (cluster “2”), and low
    arrests (cluster “3”)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Cluster “3” also has a considerably lower average urban population %
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Run with four clusters:**'
  prefs: []
  type: TYPE_NORMAL
- en: The separation is not as clear
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The medium (cluster “2”) and low (cluster “3”) clusters from the run with three
    clusters remained unchanged (only renamed to “3” and “4” respectively)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The high (cluster “1”) from the run with three clusters was split into two clusters.
    Cluster “1” has a considerably lower average urban population %, with lower arrests
    for rape and assault
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Depending on the need behind the cluster analysis, we would choose the appropriate
    clustering solution. Remember, not the one with the highest ASW but the one that
    can be more impactful to the business stakeholders (probably a choice between
    3 and 4 clusters).
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '🚀🚀 And with that last step, we have reached the end of the guide. Below, you
    can also find a quick summary of the steps:'
  prefs: []
  type: TYPE_NORMAL
- en: ✅ Create a dataset for which each row represents an entity, and the attributes
    reflect the aspects of interest for your clustering
  prefs: []
  type: TYPE_NORMAL
- en: ✅ Visualise the data to examine skewness, outliers, and scaling issues
  prefs: []
  type: TYPE_NORMAL
- en: ✅ Use the Silhouette Plot to select the number of clusters
  prefs: []
  type: TYPE_NORMAL
- en: ✅ Examine the characteristics of each clustering solution and pick the one that
    is more actionable to the business (more aligned with the business objectives)
  prefs: []
  type: TYPE_NORMAL
- en: On the link below, you can also find a more in-depth free PDF Walkthrough on
    completing a Customer Cluster Analysis in a real-life business scenario using
    data science techniques and best practices. 👇
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://www.aspiringdatascientist.net/community?source=post_page-----5ad88b700a1a--------------------------------)
    [## Data Science Project Checklist — Aspiring Data Scientist'
  prefs: []
  type: TYPE_NORMAL
- en: I am a Data Scientist with 7+ years of analytics experience, currently working
    in a gaming company in London, UK. My…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: www.aspiringdatascientist.net](https://www.aspiringdatascientist.net/community?source=post_page-----5ad88b700a1a--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: '**Stay in Touch!**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you enjoyed reading this article and want to learn more, don’t forget to
    [subscribe](https://medium.com/@alex.vamvakaris.ds/subscribe) to get my stories
    sent directly to your inbox.
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: R documentation and datasets were obtained from the R Project and are GPL-licensed.
    OpenIntro documentation is Creative Commons BY-SA 3.0 licensed.
  prefs: []
  type: TYPE_NORMAL
