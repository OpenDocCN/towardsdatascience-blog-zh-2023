# ã€Šè¢«ä½ä¼°çš„çå® ç¬¬ä¸€éƒ¨åˆ†ï¼š8 ä¸ªè®©ä½ æˆä¸ºé«˜æ‰‹çš„ Pandas æ–¹æ³•ã€‹

> åŸæ–‡ï¼š[`towardsdatascience.com/the-underrated-gems-pt-1-8-pandas-methods-that-will-make-you-a-pro-b1437a19ca3c?source=collection_archive---------0-----------------------#2023-07-17`](https://towardsdatascience.com/the-underrated-gems-pt-1-8-pandas-methods-that-will-make-you-a-pro-b1437a19ca3c?source=collection_archive---------0-----------------------#2023-07-17)

## è¢«ä½ä¼°çš„ã€æœªè¢«é‡è§†çš„å’Œæœªè¢«æ·±å…¥æ¢ç´¢çš„

[](https://medium.com/@andreas030503?source=post_page-----b1437a19ca3c--------------------------------)![Andreas Lukita](https://medium.com/@andreas030503?source=post_page-----b1437a19ca3c--------------------------------)[](https://towardsdatascience.com/?source=post_page-----b1437a19ca3c--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----b1437a19ca3c--------------------------------) [Andreas Lukita](https://medium.com/@andreas030503?source=post_page-----b1437a19ca3c--------------------------------)

Â·

[å…³æ³¨](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F955ef38ea7b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-underrated-gems-pt-1-8-pandas-methods-that-will-make-you-a-pro-b1437a19ca3c&user=Andreas+Lukita&userId=955ef38ea7b&source=post_page-955ef38ea7b----b1437a19ca3c---------------------post_header-----------) å‘è¡¨åœ¨ [Towards Data Science](https://towardsdatascience.com/?source=post_page-----b1437a19ca3c--------------------------------) Â·10 åˆ†é’Ÿé˜…è¯»Â·2023 å¹´ 7 æœˆ 17 æ—¥[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb1437a19ca3c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-underrated-gems-pt-1-8-pandas-methods-that-will-make-you-a-pro-b1437a19ca3c&user=Andreas+Lukita&userId=955ef38ea7b&source=-----b1437a19ca3c---------------------clap_footer-----------)

--

[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb1437a19ca3c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-underrated-gems-pt-1-8-pandas-methods-that-will-make-you-a-pro-b1437a19ca3c&source=-----b1437a19ca3c---------------------bookmark_footer-----------)![](img/dfa5d2a3776475bd5e3957104b82b7ae.png)

å›¾ç‰‡ç”± [Roman Kraft](https://unsplash.com/@iamromankraft?utm_source=medium&utm_medium=referral) æä¾›ï¼Œæ¥æºäº [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

> â€œåœ¨å–§åš£çš„ç¯å¢ƒä¸­ï¼Œæ­£æ˜¯é‚£äº›ä½å£°ç»†è¯­çš„è¯è¯­æ‰è•´è—ç€éšè—çš„æ™ºæ…§ ğŸ’â€

æš‚æ—¶å¿˜è®° ChatGPTã€‚å¯¹æˆ‘ä»¬ä¸­çš„ä¸€äº›äººæ¥è¯´ï¼Œæˆ‘ä»¬ä¼šå› ä¸ºæ¯æ¬¡æƒ³æ‰§è¡Œç®€å•çš„ Pandas æ“ä½œæ—¶éƒ½è¦ä¸æ–­åœ°è°·æ­Œæœç´¢è§£å†³æ–¹æ¡ˆè€Œæ„Ÿåˆ°ç–²æƒ«ã€‚ä¼¼ä¹æœ‰æ— æ•°ç§æ–¹æ³•æ¥åšåŒä¸€ä»¶äº‹ï¼Œé‚£ä¹ˆç©¶ç«Ÿå“ªä¸€ç§æ‰æ˜¯æœ€ä½³é€‰æ‹©ï¼Ÿè™½ç„¶æœ‰å¾ˆå¤šå¯èƒ½çš„è§£å†³æ–¹æ¡ˆç¡®å®å¾ˆå¥½ï¼Œä½†ä¹Ÿå¸¦æ¥äº†ä¸ä¸€è‡´å’Œå¯¹ä»£ç åŠŸèƒ½çš„å›°æƒ‘ã€‚

åˆ°è¾¾ç½—é©¬æœ‰ 1000 æ¡å¯èƒ½çš„è·¯çº¿ï¼Œå¯èƒ½ç”šè‡³æ›´å¤šã€‚é—®é¢˜æ˜¯ï¼Œä½ é€‰æ‹©éšè—çš„å°è·¯è¿˜æ˜¯å¤æ‚çš„è·¯çº¿ï¼Ÿ

![](img/fae6c5a44fa88fad591aaa9d53e554e8.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›

è¿™é‡Œæ˜¯æœ¬æ–‡çš„è¦ç‚¹ã€‚æˆ‘å°†å¸¦ä½ äº†è§£å¦‚ä½•é€šè¿‡å¤„ç†æ¥è‡ª[UCI æœºå™¨å­¦ä¹ çš„è‡ªè¡Œè½¦å…±äº«æ•°æ®é›†](https://doi.org/10.24432/C5W894)Â¹æ¥å°†è¿™äº›æ–¹æ³•ä»˜è¯¸å®è·µã€‚é€šè¿‡é‡‡ç”¨è¿™äº›æ–¹æ³•ï¼Œä½ ä¸ä»…å¯ä»¥ç®€åŒ–æ•°æ®å¤„ç†ä»£ç ï¼Œè¿˜èƒ½æ›´æ·±å…¥åœ°ç†è§£ä½ ç¼–å†™çš„ä»£ç ã€‚è®©æˆ‘ä»¬å¼€å§‹å¯¼å…¥æ•°æ®é›†ï¼Œå¹¶å¿«é€ŸæŸ¥çœ‹ DataFrameï¼

```py
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

bike = (pd
        .read_csv("../../dataset/bike_sharing/day.csv")
       )
bike
```

![](img/eb8d9b78b58f0bee83d63227051d66d8.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›

**ç›®å½•**

+   æ–¹æ³• #1: `**.assign()**`

+   æ–¹æ³• #2: `**.groupby()**`

+   æ–¹æ³• #3: `**.agg()**`

+   æ–¹æ³• #4: `**.transform()**`

+   æ–¹æ³• #5: `**.pivot_table()**`

+   æ–¹æ³• #6: `**.resample()**`

+   æ–¹æ³• #7: `**.unstack()**`

+   æ–¹æ³• #8: `**.pipe()**`

# â˜•ï¸ æ–¹æ³• #1: .assign()

å¿˜æ‰ä½¿ç”¨`**df["new_col"] =**`å’Œ`**df.new_col =**`è¿™ç§æ“ä½œæ¥åˆ›å»ºæ–°åˆ—ã€‚è¿™é‡Œæ˜¯ä½ åº”è¯¥ä½¿ç”¨`**.assign()**`æ–¹æ³•çš„åŸå› â€”â€”å®ƒè¿”å›ä¸€ä¸ª DataFrame å¯¹è±¡ï¼Œå…è®¸ä½ ç»§ç»­é“¾å¼æ“ä½œä»¥è¿›ä¸€æ­¥å¤„ç† DataFrameã€‚ä¸`**.assign()**`æ–¹æ³•ä¸åŒï¼Œä¸Šè¿°ä¸¤ç§è‡­åæ˜­è‘—çš„æ“ä½œä¼šè¿”å›`None`ï¼Œè¿™æ„å‘³ç€ä½ æ— æ³•è¿›ä¸€æ­¥é“¾å¼æ“ä½œã€‚

å¦‚æœä½ ä¸ä¿¡ï¼Œé‚£ä¹ˆè®©æˆ‘é‡æ–°æèµ·æ—§çš„æ•Œäººâ€”â€”`**SettingWithCopyWarning**`ã€‚ç›¸ä¿¡æˆ‘ä»¬æ¯ä¸ªäººåœ¨æŸä¸ªæ—¶åˆ»éƒ½é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ã€‚

![](img/f972812fa73304ae581315e1660cd13a.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›

> è­¦å‘Šå¤Ÿäº†ï¼Œæˆ‘ä¸æƒ³åœ¨æˆ‘çš„ç¬”è®°æœ¬ä¸­å†çœ‹åˆ°ä¸‘é™‹çš„çº¢è‰²æ¡†æ¡†ï¼

ä½¿ç”¨`**.assign()**`ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€äº›æ–°åˆ—ï¼Œå¦‚`**ratio_casual_registered**`ã€`**avg_temp**`å’Œ`**ratio_squared**`

```py
(bike
 .assign(ratio_casual_registered = bike.casual.div(bike.registered),
         avg_temp = bike.temp.add(bike.atemp).div(2),
         ratio_squared = lambda df_: df_.ratio_casual_registered.pow(2))
)
```

ç®€è€Œè¨€ä¹‹ï¼Œä¸Šè¿°æ–¹æ³•çš„ä½œç”¨å¦‚ä¸‹ï¼š

1.  æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`**.assign()**`æ–¹æ³•åˆ›å»ºä»»æ„æ•°é‡çš„æ–°åˆ—ï¼Œç”¨é€—å·åˆ†éš”ã€‚

1.  åœ¨åˆ›å»ºåˆ—`**ratio_squared**`æ—¶ä½¿ç”¨çš„ lambda å‡½æ•°æ˜¯ä¸ºäº†è®¿é—®æˆ‘ä»¬åœ¨æ·»åŠ åˆ—`**ratio_casual_registered**`åæœ€æ¥è¿‘çš„ DataFrameã€‚å‡è®¾æˆ‘ä»¬ä¸ä½¿ç”¨ lambda å‡½æ•°æ¥è®¿é—®æœ€æ–°çš„ DataFrame `**df_**`ï¼Œè€Œæ˜¯ç»§ç»­ä½¿ç”¨`**bike.ratio_casual_registered.pow(2)**`ï¼Œæˆ‘ä»¬å°†ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºåŸå§‹ DataFrame åœ¨åˆ›å»º`**ratio_squared**`ä¹‹å‰ï¼Œå³ä½¿åœ¨`**.assign()**`æ–¹æ³•ä¸­æ·»åŠ äº†è¯¥åˆ—ï¼Œä¹Ÿæ²¡æœ‰`**ratio_casual_registered**`åˆ—ã€‚å¦‚æœä½ å¯¹è¿™ä¸ªæ¦‚å¿µæ— æ³•ç†è§£ä»¥å†³å®šæ˜¯å¦ä½¿ç”¨ lambda å‡½æ•°ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä½¿ç”¨å®ƒï¼

1.  é¢å¤–çš„ï¼æˆ‘ç•™ä¸‹äº†ä¸€äº›ä¸é‚£ä¹ˆå¸¸è§çš„ä½¿ç”¨æ–¹æ³•è¿›è¡Œç®—æœ¯è¿ç®—ã€‚

# â˜•ï¸ æ–¹æ³• #2: .groupby()

å¥½å§ï¼Œ`**.groupby()**`æ–¹æ³•è™½ç„¶ä¸ç½•è§ï¼Œä½†åœ¨æˆ‘ä»¬æ·±å…¥æ¢è®¨ä¸‹ä¸€ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œå®ƒä»¬æ˜¯å¿…è¦çš„ã€‚ä¸€ä¸ªå¸¸è¢«å¿½è§†ä¸”æœªè¢«æåŠçš„äº‹æƒ…æ˜¯ï¼Œ`**.groupby()**`æ–¹æ³•å…·æœ‰æ‡’æƒ°ç‰¹æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥æ–¹æ³•æ˜¯å»¶è¿Ÿè¯„ä¼°çš„ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä¸ä¼šç«‹å³è¯„ä¼°ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ åœ¨è°ƒç”¨`**.groupby()**`æ–¹æ³•åå¸¸å¸¸ä¼šçœ‹åˆ°`**<pandas.core.groupby.generic.DataFrameGroupBy object at 0x14fdc3610>**`ã€‚

ä» Pandas DataFrame [æ–‡æ¡£](https://pandas.pydata.org/docs/reference/frame.html)Â² ä¸­ï¼Œä¼ é€’ç»™å‚æ•°`**by**`çš„å€¼å¯ä»¥æ˜¯***æ˜ å°„ã€å‡½æ•°ã€æ ‡ç­¾ã€pd.Grouper æˆ–æ­¤ç±»çš„åˆ—è¡¨ã€‚*** ç„¶è€Œï¼Œä½ æœ€å¸¸é‡åˆ°çš„æƒ…å†µå¯èƒ½æ˜¯æŒ‰åˆ—ååˆ†ç»„ï¼ˆç”¨é€—å·åˆ†éš”çš„ Series åç§°åˆ—è¡¨ï¼‰ã€‚åœ¨`**.groupby()**`æ“ä½œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œè¯¸å¦‚`**.mean()**`ã€`**.median()**`ï¼Œæˆ–ä½¿ç”¨`**.apply()**`åº”ç”¨è‡ªå®šä¹‰å‡½æ•°ç­‰æ“ä½œã€‚

> æˆ‘ä»¬ä¼ é€’ç»™`**.groupby()**`æ–¹æ³•çš„`**by**`å‚æ•°ä¸­çš„æŒ‡å®šåˆ—çš„å€¼å°†æˆä¸ºç»“æœçš„ç´¢å¼•ã€‚å¦‚æœæˆ‘ä»¬æŒ‡å®šäº†å¤šä¸ªåˆ—è¿›è¡Œåˆ†ç»„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†è·å¾—ä¸€ä¸ª MultiIndexã€‚

```py
(bike
 .groupby(['season', 'weathersit'])
 .mean(numeric_only=True) #alternative version: apply(lambda df_: df_.mean(numeric_only=True)) 
 .atemp
)
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‰ç…§åˆ—`**season**`å’Œ`**weathersit**`å¯¹ DataFrame è¿›è¡Œäº†åˆ†ç»„ã€‚ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—äº†å‡å€¼ï¼Œå¹¶ä»…é€‰æ‹©äº†åˆ—`**atemp**`ã€‚

![](img/b9321d008606497cf39b9bdcda719e00.png)

å›¾ç‰‡æ¥æºäºä½œè€…

# â˜•ï¸ æ–¹æ³• #3: .agg()

å¦‚æœä½ è¶³å¤Ÿç»†å¿ƒå»æ·±å…¥ç ”ç©¶ Pandas [æ–‡æ¡£](https://pandas.pydata.org/docs/reference/frame.html)Â²ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°`**.agg()**`å’Œ`**.aggregate()**`è¿™ä¸¤ç§æ–¹æ³•ã€‚ä½ å¯èƒ½ä¼šæƒ³çŸ¥é“å®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™ä½¿ç”¨å“ªä¸ªï¼ŸèŠ‚çœä½ çš„æ—¶é—´å§ï¼å®ƒä»¬æ˜¯ç›¸åŒçš„ï¼Œ`**.agg()**`åªæ˜¯`**.aggregate()**`çš„åˆ«åã€‚

`**.agg()**`æœ‰ä¸€ä¸ªå‚æ•°`**func**`ï¼Œå®ƒå¯ä»¥æ¥å—å‡½æ•°ã€å­—ç¬¦ä¸²å‡½æ•°åæˆ–å‡½æ•°åˆ—è¡¨ã€‚é¡ºä¾¿æä¸€ä¸‹ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨åˆ—ä¸Šèšåˆä¸åŒçš„å‡½æ•°ï¼è®©æˆ‘ä»¬ç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼

```py
#Example 1: Aggregating using more than 1 function
(bike
 .groupby(['season'])
 .agg(['mean', 'median'])
 .atemp
)

#Example 2: Aggregating using different function for different columns
(bike
 .groupby(['season'])
 .agg(Meann=('temp', 'mean'), Mediann=('atemp', np.median))
)
```

![](img/3a7641b468ffb53f978a9bd105544194.png)

å›¾ç‰‡æ¥æºäºä½œè€…

# â˜•ï¸ æ–¹æ³• #4: .transform()

ä½¿ç”¨ `**.agg()**`ï¼Œæˆ‘ä»¬å¾—åˆ°çš„ç»“æœåœ¨ç»´åº¦ä¸Šç›¸è¾ƒäºåˆå§‹æ•°æ®é›†æ˜¯ç¼©å‡çš„ã€‚ç®€å•æ¥è¯´ï¼Œä½ çš„æ•°æ®ç»´åº¦ä¼šå‡å°‘ï¼ŒåŒ…å«æ›´å°‘çš„è¡Œå’Œåˆ—ï¼ŒåŒ…å«æ±‡æ€»ä¿¡æ¯ã€‚å¦‚æœä½ æƒ³å¯¹åˆ†ç»„æ•°æ®è¿›è¡Œæ€»ç»“å¹¶è·å¾—èšåˆå€¼ï¼Œé‚£ä¹ˆ `**.groupby()**` æ˜¯è§£å†³æ–¹æ¡ˆã€‚

ä½¿ç”¨ `**.transform()**`ï¼Œæˆ‘ä»¬ä¹Ÿå¼€å§‹æ—¶æ„å›¾è¿›è¡Œä¿¡æ¯çš„æ±‡æ€»ã€‚ç„¶è€Œï¼Œä¸åˆ›å»ºä¿¡æ¯æ±‡æ€»ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›è¾“å‡ºçš„å½¢çŠ¶ä¸åŸå§‹ DataFrame ç›¸åŒï¼Œè€Œä¸ç¼©å°åŸå§‹ DataFrame çš„å¤§å°ã€‚

å¯¹äºé‚£äº›æ¥è§¦è¿‡ç±»ä¼¼ SQL çš„æ•°æ®åº“ç³»ç»Ÿçš„äººæ¥è¯´ï¼Œ`**.transform()**` çš„æ¦‚å¿µå¯èƒ½ä¸çª—å£å‡½æ•°ç±»ä¼¼ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ `**.transform()**` åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼

```py
(bike
 .assign(mean_atemp_season = lambda df_: df_
                                          .groupby(['season'])
                                          .atemp
                                          .transform(np.mean, numeric_only=True))
)
```

![](img/57cfdf8e60580a2e42ea2ac46196f4d4.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›

å¦‚ä¸Šæ‰€è§ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º `**mean_atemp_season**` çš„æ–°åˆ—ï¼Œå¹¶å°†è¯¥åˆ—å¡«å……ä¸º `**atemp**` åˆ—çš„æ±‡æ€»ï¼ˆå‡å€¼ï¼‰ã€‚å› æ­¤ï¼Œæ¯å½“ `**season**` ä¸º 1 æ—¶ï¼Œ`**mean_atemp_season**` çš„å€¼å°±ç›¸åŒã€‚è¯·æ³¨æ„è¿™é‡Œçš„é‡è¦è§‚å¯Ÿç‚¹æ˜¯æˆ‘ä»¬ä¿ç•™äº†åŸå§‹æ•°æ®é›†çš„ç»´åº¦ï¼Œå¹¶å¢åŠ äº†ä¸€åˆ—ï¼

# â˜•ï¸ æ–¹æ³• #5: .pivot_table()

è¿™æ˜¯ç»™é‚£äº›å¯¹ Microsoft Excel è¿·æ‹çš„äººçš„é¢å¤–æç¤ºã€‚ä½ å¯èƒ½ä¼šè¢«è¯±æƒ‘ä½¿ç”¨ `**.pivot_table()**` æ¥åˆ›å»ºæ±‡æ€»è¡¨ã€‚è¿™ä¸ªæ–¹æ³•å½“ç„¶ä¹Ÿæœ‰æ•ˆï¼ä½†è¿™é‡Œæœ‰ä¸€ç‚¹å»ºè®®ï¼Œ`**.groupby()**` æ›´åŠ çµæ´»ï¼Œé€‚ç”¨äºæ›´å¹¿æ³›çš„æ“ä½œï¼Œä¸ä»…é™äºé‡æ–°æ’åˆ—ï¼Œè¿˜åŒ…æ‹¬è¿‡æ»¤ã€è½¬æ¢æˆ–åº”ç”¨ç»„ç‰¹å®šçš„è®¡ç®—ã€‚

ç®€è¦è¯´æ˜ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ `**.pivot_table()**`ã€‚ä½ åœ¨ `**values**` å‚æ•°ä¸­æŒ‡å®šä½ è¦æ±‡æ€»çš„åˆ—ã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨åŸå§‹ DataFrame çš„å­é›†æŒ‡å®šä½ æƒ³è¦åˆ›å»ºçš„æ±‡æ€»è¡¨çš„ **index**ã€‚è¿™å¯ä»¥æ˜¯å¤šåˆ—ï¼Œæ±‡æ€»è¡¨å°†æ˜¯ MultiIndex çš„ DataFrameã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨æœªé€‰æ‹©ä¸ºç´¢å¼•çš„åŸå§‹ DataFrame çš„å­é›†æ¥æŒ‡å®šä½ æƒ³è¦åˆ›å»ºçš„æ±‡æ€»è¡¨çš„ **columns**ã€‚æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œä¸è¦å¿˜è®°æŒ‡å®š `**aggfunc**`ï¼æˆ‘ä»¬æ¥å¿«é€Ÿçœ‹ä¸€ä¸‹ï¼

```py
(bike
 .pivot_table(values=['temp', 'atemp'],
              index=['season'],
              columns=['workingday'],
              aggfunc=np.mean)
)
```

![](img/b2cc556fc524085340ac327e66b94545.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›

# â˜•ï¸ æ–¹æ³• #6: .resample()

ç²—ç•¥åœ°è¯´ï¼Œ`**.resample()**` æ–¹æ³•å¯ä»¥è¢«è§†ä¸ºä¸“é—¨ç”¨äºæ—¶é—´åºåˆ—æ•°æ®çš„åˆ†ç»„å’Œæ±‡æ€»ï¼Œå…¶ä¸­

> DataFrame æˆ– Series çš„ç´¢å¼•æ˜¯ç±»ä¼¼æ—¥æœŸæ—¶é—´çš„å¯¹è±¡ã€‚

è¿™ä½¿ä½ å¯ä»¥æ ¹æ®ä¸åŒçš„æ—¶é—´é¢‘ç‡å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„å’Œæ±‡æ€»ï¼Œä¾‹å¦‚æ¯å°æ—¶ã€æ¯å¤©ã€æ¯å‘¨ã€æ¯æœˆç­‰ã€‚æ›´ä¸€èˆ¬åœ°è¯´ï¼Œ`**.resample()**` å¯ä»¥æ¥å— **DateOffsetã€Timedelta æˆ– str** ä½œä¸ºè§„åˆ™æ¥æ‰§è¡Œé‡é‡‡æ ·ã€‚è®©æˆ‘ä»¬å°†å…¶åº”ç”¨äºä¹‹å‰çš„ç¤ºä¾‹ã€‚

```py
def tweak_bike(bike: pd.DataFrame) -> pd.DataFrame:
    return (bike
            .drop(columns=['instant'])
            .assign(dteday=lambda df_: pd.to_datetime(df_.dteday))
            .set_index('dteday')
           )
bike = tweak_bike(bike)
(bike
 .resample('M')
 .temp
 .mean()
)
```

ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢æ‰€åšçš„æ“ä½œæ˜¯åˆ é™¤`**instant**`åˆ—ï¼Œç”¨`**dteday**`åˆ—è¦†ç›–`**dteday**`åˆ—ï¼Œå°†`**dteday**`åˆ—çš„ç±»å‹ä»`object`è½¬æ¢ä¸º`**datetime64[ns]**`ç±»å‹ï¼Œæœ€åå°†è¿™ä¸ª`**datetime64[ns]**`åˆ—è®¾ä¸º DataFrame çš„ç´¢å¼•ã€‚

![](img/5a33370ebfd03d27d90be81dedbadff8.png)

ä½œè€…æä¾›çš„å›¾ç‰‡

```py
(bike
 .resample('M')
 .temp
 .mean()
)
```

![](img/1a857d820fb1f9834a0da75717f63f95.png)

ä½œè€…æä¾›çš„å›¾ç‰‡

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è·å¾—äº†ç‰¹å¾`**temp**`çš„æè¿°æ€§ç»Ÿè®¡æ±‡æ€»ï¼ˆå‡å€¼ï¼‰ï¼Œä»¥æœˆé¢‘ç‡å‘ˆç°ã€‚å°è¯•ä½¿ç”¨ä¸åŒçš„é¢‘ç‡ï¼Œå¦‚`**Q**`ã€`**2M**`ã€`**A**`ç­‰ï¼Œæ¥ç©è½¬`**.resample()**`æ–¹æ³•ã€‚

# â˜•ï¸ æ–¹æ³• #7: .unstack()

æˆ‘ä»¬å¿«è¦ç»“æŸäº†ï¼è®©æˆ‘ç»™ä½ å±•ç¤ºä¸€ä¸‹`**.unstack()**`ä¸ºä½•æ—¢å¼ºå¤§åˆæœ‰ç”¨ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å›åˆ°ä¸Šè¿°ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æƒ³é€šè¿‡ä½¿ç”¨`**.groupby()**`å’Œ`**.agg()**`æ¥æ‰¾åˆ°ä¸åŒå­£èŠ‚å’Œå¤©æ°”æƒ…å†µçš„å¹³å‡æ¸©åº¦ã€‚

```py
(bike
 .groupby(['season', 'weathersit'])
 .agg('mean')
 .temp
)
```

![](img/6be4039549c302e00b1da416acef33cb.png)

ä½œè€…æä¾›çš„å›¾ç‰‡

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªçº¿å›¾æ¥å¯è§†åŒ–è¿™ä¸€ç‚¹ï¼Œé€šè¿‡å°†`**.plot**`å’Œ`**.line()**`æ–¹æ³•æœ€å°åŒ–åœ°é“¾æ¥åˆ°ä¸Šè¿°ä»£ç ä¸­ã€‚åœ¨åå°ï¼ŒPandas åˆ©ç”¨ Matplotlib ç»˜å›¾åç«¯æ¥å®Œæˆç»˜å›¾ä»»åŠ¡ã€‚è¿™ç»™å‡ºäº†ä»¥ä¸‹ç»“æœï¼Œæˆ‘ä»¬éƒ½ä¸æƒ³è¦ï¼Œå› ä¸ºå›¾çš„ x è½´æ˜¯æŒ‰ MultiIndex åˆ†ç»„çš„ï¼Œä½¿å…¶æ›´éš¾ä»¥è§£é‡Šï¼Œä¸”æ„ä¹‰ä¸å¤§ã€‚

![](img/3654c1d2def7e557a794dec007f3016b.png)

ä½œè€…æä¾›çš„å›¾ç‰‡

æ¯”è¾ƒå¼•å…¥`**.unstack()**`æ–¹æ³•åçš„å›¾ä¸ä¸Šå›¾ã€‚

```py
(bike
 .groupby(['season', 'weathersit'])
 .agg('mean')
 .temp
 .unstack()
 .plot
 .line()
)
```

![](img/de2067fddba9d0e6526b58bb11ac7515.png)

ä½œè€…æä¾›çš„å›¾ç‰‡

ç®€è€Œè¨€ä¹‹ï¼Œ`**.unstack()**`æ–¹æ³•çš„ä½œç”¨æ˜¯è§£å¼€ MultiIndex DataFrame ä¸­æœ€å†…å±‚çš„ç´¢å¼•ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯`**weathersit**`ã€‚è¿™ä¸ªæ‰€è°“çš„è§£å¼€ç´¢å¼•å˜æˆäº†æ–° DataFrame çš„åˆ—ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬çš„çº¿å›¾ç»˜åˆ¶ç»“æœæ›´åŠ æœ‰æ„ä¹‰ï¼Œæ–¹ä¾¿æ¯”è¾ƒã€‚

![](img/6892843a34315addb39ca843d2dbd08c.png)

ä½œè€…æä¾›çš„å›¾ç‰‡

ä½ è¿˜å¯ä»¥é€šè¿‡æŒ‡å®šå‚æ•°`**level=0**`ä½œä¸º`**.unstack()**`æ–¹æ³•çš„ä¸€éƒ¨åˆ†ï¼Œæ¥è§£å¼€ DataFrame ä¸­æœ€å¤–å±‚çš„ç´¢å¼•ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®ç°è¿™ä¸€ç‚¹ã€‚

```py
(bike
 .groupby(['season', 'weathersit'])
 .agg('mean')
 .temp
 .unstack(level=0)
 .plot
 .line()
)
```

![](img/fcaeb87f0b7cd880bda70f0a457b75a0.png)

ä½œè€…æä¾›çš„å›¾ç‰‡

![](img/3c938f38c42c3371f16f5bb6040b6f3b.png)

ä½œè€…æä¾›çš„å›¾ç‰‡

# â˜•ï¸ æ–¹æ³• #8: .pipe()

ä»æˆ‘çš„è§‚å¯Ÿæ¥çœ‹ï¼Œå½“ä½ åœ¨çº¿æœç´¢æ—¶ï¼Œä½ å‡ ä¹çœ‹ä¸åˆ°æ™®é€šäººåœ¨ä»–ä»¬çš„ Pandas ä»£ç ä¸­å®ç°è¿™ä¸ªæ–¹æ³•ã€‚ä¸€ä¸ªåŸå› æ˜¯ï¼Œ`**.pipe()**`æœ‰ä¸€ç§ç¥ç§˜çš„æ— æ³•è§£é‡Šçš„æ°”è´¨ï¼Œä½¿å¾—å®ƒå¯¹åˆå­¦è€…å’Œä¸­çº§ç”¨æˆ·éƒ½ä¸å‹å¥½ã€‚å½“ä½ å» Pandas [æ–‡æ¡£](https://pandas.pydata.org/docs/reference/frame.html)Â²æ—¶ï¼Œä½ ä¼šå‘ç°çš„ç®€çŸ­è§£é‡Šæ˜¯***â€œåº”ç”¨æœŸæœ› Series æˆ– DataFrame çš„å¯é“¾å¼å‡½æ•°â€***ã€‚æˆ‘è®¤ä¸ºè¿™ä¸ªè§£é‡Šæœ‰äº›æ··æ·†ï¼Œå¹¶ä¸”å¯¹é‚£äº›ä»æœªä½¿ç”¨é“¾å¼æ“ä½œçš„äººå¹¶ä¸ååˆ†æœ‰å¸®åŠ©ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œ`**.pipe()**`ä¸ºæ‚¨æä¾›çš„æ˜¯ä½¿ç”¨å‡½æ•°ç»§ç»­æ–¹æ³•é“¾æŠ€æœ¯çš„èƒ½åŠ›ï¼Œåœ¨æ‚¨æ— æ³•æ‰¾åˆ°ç›´æ¥è§£å†³æ–¹æ¡ˆæ‰§è¡Œæ“ä½œè¿”å› DataFrame çš„æƒ…å†µä¸‹ã€‚

æ–¹æ³•`**.pipe()**`æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œé€šè¿‡è¿™ä¸ªå‡½æ•°å¯ä»¥å®šä¹‰ä¸€ä¸ªé“¾å¤–æ–¹æ³•ï¼Œç„¶åå°†è¯¥æ–¹æ³•ä½œä¸º`**.pipe()**`æ–¹æ³•çš„å‚æ•°å¼•ç”¨ã€‚

> ä½¿ç”¨`.pipe()`ï¼Œæ‚¨å¯ä»¥å°† DataFrame æˆ– Series ä½œä¸ºè‡ªå®šä¹‰å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ï¼Œå¹¶ä¸”è¯¥å‡½æ•°å°†åº”ç”¨äºä¼ é€’çš„å¯¹è±¡ï¼Œéšåæ˜¯æŒ‡å®šçš„ä»»ä½•å…¶ä»–å‚æ•°ã€‚

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨ä¼šçœ‹åˆ°`**.pipe()**`æ–¹æ³•ä¸­çš„ä¸€è¡Œ lambda å‡½æ•°ï¼Œä»¥æ–¹ä¾¿ä½¿ç”¨ï¼ˆä¾‹å¦‚ï¼Œåœ¨é“¾å¤„ç†è¿‡ç¨‹ä¸­çš„æŸäº›ä¿®æ”¹æ­¥éª¤åè·å–æœ€æ–° DataFrameï¼‰ã€‚

è®©æˆ‘ç”¨ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­æ¥è¯´æ˜ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦äº†è§£ä»¥ä¸‹é—®é¢˜ï¼š***â€œå¯¹äº 2012 å¹´ï¼Œæ¯ä¸ªå­£èŠ‚ç›¸å¯¹äºè¯¥å¹´æ€»å·¥ä½œæ—¥çš„å·¥ä½œæ—¥æ¯”ä¾‹æ˜¯å¤šå°‘ï¼Ÿâ€***

```py
(bike
 .loc[bike.index.year == 2012]
 .groupby(['season'])
 .workingday
 .agg(sum)
 .pipe(lambda x: x.div(x.sum()))
)
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨`**.pipe()**`å°†å‡½æ•°æ³¨å…¥åˆ°æˆ‘ä»¬çš„é“¾å¼æ–¹æ³•ä¸­ã€‚ç”±äºæ‰§è¡Œäº†`**.agg(sum)**`ä¹‹åï¼Œæˆ‘ä»¬æ— æ³•ç»§ç»­ä½¿ç”¨`**.div()**`è¿›è¡Œé“¾å¼å¤„ç†ï¼Œå› æ­¤ä»¥ä¸‹ä»£ç å°†æ— æ³•å·¥ä½œï¼Œå› ä¸ºæˆ‘ä»¬åœ¨é“¾å¼å¤„ç†è¿‡ç¨‹ä¸­å¤±å»äº†å¯¹ DataFrame çš„æœ€æ–°çŠ¶æ€çš„è®¿é—®ã€‚

```py
#Doesn't work out well!
(bike
 .loc[bike.index.year == 2012]
 .groupby(['season'])
 .workingday
 .agg(sum)
 .div(...)
)
```

> æç¤ºï¼šå¦‚æœæ‰¾ä¸åˆ°ç»§ç»­é“¾æ¥æ–¹æ³•çš„æ–¹å¼ï¼Œè¯·è€ƒè™‘å¦‚ä½•ä½¿ç”¨`.pipe()`ï¼å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒä¼šæœ‰æ‰€å¸®åŠ©ï¼

# ç»“è¯­

è¿™å°±æ˜¯ä½ä¼°çš„å®çŸ³ğŸ’ç¬¬ä¸€éƒ¨åˆ†çš„å…¨éƒ¨å†…å®¹ï¼è¿™äº›éƒ½æ˜¯æˆ‘ä»¥å‰æ²¡æœ‰ç»å¸¸ä½¿ç”¨çš„æ–¹æ³•ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºæˆ‘çš„åä¹ æƒ¯â€”â€”ç”¨â€œåªè¦èƒ½ç”¨ï¼Œå°±å¤Ÿå¥½ï¼â€çš„æ€ç»´å¼ºè¡Œè§£å†³ä»£ç é—®é¢˜ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ ·åšæ˜¯ä¸å¤Ÿå¥½çš„ï¼

åªæœ‰åœ¨æˆ‘èŠ±æ—¶é—´å­¦ä¹ å¦‚ä½•æ­£ç¡®ä½¿ç”¨å®ƒä»¬ä¹‹åï¼Œå®ƒä»¬æ‰è¢«è¯æ˜æ˜¯æ•‘å‘½ç¨»è‰ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼æˆ‘è¿˜è¦æ„Ÿè°¢ Matt Harrison å’Œä»–çš„ä¹¦[ã€Šé«˜æ•ˆ Pandasã€‹](https://store.metasnake.com/effective-pandas-book)Â³ï¼Œè¿™æœ¬ä¹¦å½»åº•æ”¹å˜äº†æˆ‘ç¼–å†™ Pandas ä»£ç çš„æ–¹å¼ã€‚ç°åœ¨ï¼Œæˆ‘å¯ä»¥è¯´æˆ‘çš„ä»£ç æ›´ç®€æ´ã€æ›´å¯è¯»ï¼Œè€Œä¸”æ›´æœ‰æ„ä¹‰ã€‚

åœ¨ä½ä¼°çš„å®çŸ³ç¬¬äºŒéƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å…¶ä»–å…«ä¸ªè¾ƒå°‘ä¸ºäººçŸ¥çš„ Pandas æ–¹æ³•ï¼Œä¾‹å¦‚`**.explode()**`ã€`**.melt()**`å’Œ`**.expanding()**`ï¼æ‚¨å¯èƒ½ä¸ä¼šç»å¸¸ä½¿ç”¨å®ƒä»¬ï¼Œä½†åœ¨éœ€è¦å®ƒä»¬çš„æ—¶å€™å®ƒä»¬è‚¯å®šå¾ˆæ–¹ä¾¿ã€‚

å¦‚æœä½ ä»æœ¬æ–‡ä¸­è·å¾—äº†ä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿ï¼Œè¯·è€ƒè™‘åœ¨ Medium ä¸Šç»™æˆ‘[***å…³æ³¨***](https://medium.com/@andreas030503)ã€‚æ¯å‘¨ä¸€ç¯‡æ–‡ç« ï¼Œè½»æ¾è·Ÿä¸Šæ—¶ä»£æ½®æµï¼

# è”ç³»æˆ‘ï¼

+   [*LinkedIn*](https://www.linkedin.com/in/andreaslukita7/)ğŸ‘”

+   [*Twitter*](https://twitter.com/andreaslukita7)ğŸ–Š

# å‚è€ƒèµ„æ–™

1.  Fanaee-Tï¼ŒHadiã€‚ (2013)ã€‚è‡ªè¡Œè½¦å…±äº«æ•°æ®é›†ã€‚UCI æœºå™¨å­¦ä¹ åº“ã€‚[`doi.org/10.24432/C5W894`](https://doi.org/10.24432/C5W894)ã€‚

1.  Pandas æ–‡æ¡£: [`pandas.pydata.org/docs/reference/frame.html`](https://pandas.pydata.org/docs/reference/frame.html)

1.  Matt Harrison çš„ã€ŠEffective Pandasã€‹: [`store.metasnake.com/effective-pandas-book`](https://store.metasnake.com/effective-pandas-book)
