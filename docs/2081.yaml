- en: Monitoring unstructured data for LLM and NLP
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/monitoring-unstructured-data-for-llm-and-nlp-efff42704e5b?source=collection_archive---------10-----------------------#2023-06-27](https://towardsdatascience.com/monitoring-unstructured-data-for-llm-and-nlp-efff42704e5b?source=collection_archive---------10-----------------------#2023-06-27)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: A code tutorial on using text descriptors
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@elena.samuylova?source=post_page-----efff42704e5b--------------------------------)[![Elena
    Samuylova](../Images/bc3024500f8b90a97f13d82ecaa1c9e7.png)](https://medium.com/@elena.samuylova?source=post_page-----efff42704e5b--------------------------------)[](https://towardsdatascience.com/?source=post_page-----efff42704e5b--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----efff42704e5b--------------------------------)
    [Elena Samuylova](https://medium.com/@elena.samuylova?source=post_page-----efff42704e5b--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: ·
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9621354b583a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmonitoring-unstructured-data-for-llm-and-nlp-efff42704e5b&user=Elena+Samuylova&userId=9621354b583a&source=post_page-9621354b583a----efff42704e5b---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----efff42704e5b--------------------------------)
    ·14 min read·Jun 27, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fefff42704e5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmonitoring-unstructured-data-for-llm-and-nlp-efff42704e5b&user=Elena+Samuylova&userId=9621354b583a&source=-----efff42704e5b---------------------clap_footer-----------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fefff42704e5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmonitoring-unstructured-data-for-llm-and-nlp-efff42704e5b&source=-----efff42704e5b---------------------bookmark_footer-----------)![](../Images/9449b853160c4015be247a0c901aee69.png)'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: Image by Author.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: Once you deploy an NLP or LLM-based solution, you need a way to keep tabs on
    it. But how do you monitor unstructured data to make sense of the pile of texts?
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: There are a few approaches here, from [detecting drift in raw text data](https://www.evidentlyai.com/blog/tutorial-detecting-drift-in-text-data)
    and [embedding drift](https://www.evidentlyai.com/blog/embedding-drift-detection)
    to using regular expressions to run rule-based checks.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: In this tutorial, we’ll dive into one particular approach — tracking interpretable
    text descriptors that help assign specific properties to every text.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: '**First, we’ll cover some theory:**'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: What is a text descriptor, and when to use them.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Examples of text descriptors.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to select custom descriptors.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Next, get to code!** You will work with e-commerce review data and go through
    the following steps:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: Get an overview of the text data.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Evaluate text data drift using standard descriptors.
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Add a custom text descriptor using an external pre-trained model.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Implement pipeline tests to monitor data changes.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We will use the [Evidently open-source Python library](https://github.com/evidentlyai/evidently)
    to generate text descriptors and evaluate changes in the data.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: '***Code example:*** *If you prefer to go straight to the code, here is the*
    [*example notebook*](https://github.com/evidentlyai/community-examples/blob/main/tutorials/How_to_add_a_custom_text_descriptor.ipynb)*.*'
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: What is a text descriptor?
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A text descriptor is any feature or property that describes objects in the text
    dataset. For example, the length of texts or the number of symbols in them.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: You might already have helpful metadata to accompany your texts that will serve
    as descriptors. For example, e-commerce user reviews might come with user-assigned
    ratings or topic labels.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: Otherwise, you can generate your own descriptors! You do this by adding “virtual
    features” to your text data. Each helps describe or classify your texts using
    some meaningful criteria.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4d3ad2d6d7d7d91249e42b8d12b13dec.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
- en: Image by Author.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: By creating these descriptors, you basically come up with your own simple “embedding”
    and map each text to several interpretable dimensions. This helps make sense of
    the otherwise unstructured data.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: 'You can then use these text descriptors:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: '**To monitor production NLP models.** You can track the properties of your
    data in time and detect when they change. For example, descriptors help detect
    text length spikes or drift in sentiment.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**To test models during updates.** When you iterate on models, you can compare
    the properties of the evaluation datasets and model responses. For example, you
    can check that the lengths of the LLM-generated answers remain similar, and they
    consistently include words you expect to see.'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**To debug data drift or model decay.** If you detect [embedding drift](https://www.evidentlyai.com/blog/embedding-drift-detection)
    or directly observe a drop in the model quality, you can use text descriptors
    to explore where it comes from.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Examples of text descriptors
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Here are a few text descriptors we consider good defaults:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: Text length
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](../Images/184e6533f48040200fe1378cad612a11.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
- en: '*Image by Author. Text overview metric visualization using the* [*Evidently
    Python library*](https://github.com/evidentlyai/evidently)*.*'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: An excellent place to start is simple text statistics. For example, you can
    look at the **length of texts** measured in words, symbols, or sentences. You
    can evaluate average and min-max length and look at distributions.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: You can set expectations based on your use case. Say, product reviews tend to
    be between 5 and 100 words. If they are shorter or longer, this might signal a
    change in context. If there is a spike in fixed-length reviews, this might signal
    a spam attack. If you know that negative reviews are often longer, you can track
    the share of reviews above a certain length.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: 'There are also quick sanity checks: if you run a chatbot, you might expect
    non-zero responses or that there is some minimum length for the meaningful output.'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: Out-of-vocabulary words
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](../Images/a65c56974f1b1f3ae2d41514a07315b3.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
- en: Image by Author. *The mean OOV share in the example reference dataset is 5.378%.*
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: Evaluating the share of words outside the defined vocabulary is a good “crude”
    measure of data quality. Did your users start writing reviews in a new language?
    Are users talking to your chatbot in Python, not English? Are users filling the
    responses with “ggg” instead of actual words?
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
- en: This is a single practical measure to detect all sorts of changes. Once you
    catch a shift, you can then debug deeper.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: You can shape expectations about the share of OOV words based on the examples
    from “good” production data accumulated over time. For example, if you look at
    the corpus of previous product reviews, you might expect OOV to be under 10% and
    monitor if the value goes above this threshold.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: Non-letter characters
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Related, but with a twist: this descriptor will count all sorts of special
    symbols that are not letters or numbers, including commas, brackets, hashes, etc.'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: 'Sometimes you expect a fair share of special symbols: your texts might contain
    code or be structured as a JSON. Sometimes, you only expect punctuation marks
    in human-readable text.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: Detecting a shift in non-letter characters can expose data quality issues, like
    HTML codes leaking into the texts of the reviews, spam attacks, unexpected use
    cases, etc.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: Sentiment
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](../Images/0b6feb7078990f2fd42ebf4054b2cb2b.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
- en: Image by Author. *Baseline “sentiment” distribution in the example e-commerce
    reviews dataset.*
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: 'Text sentiment is another indicator. It is helpful in various scenarios: from
    chatbot conversations to user reviews and writing marketing copy. You can typically
    set an expectation about the sentiment of the texts you deal with.'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: 'Even if the sentiment “does not apply,” this might translate to the expectation
    of a primarily neutral tone. The potential appearance of either a negative or
    positive tone is worth tracking and looking into. It might indicate unexpected
    usage scenarios: is the user using your virtual mortgage advisor as a complaint
    channel?'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: 'You might also expect a certain balance: for example, there is always a share
    of conversations or reviews with a negative tone, but you’d expect it not to exceed
    a certain threshold or the overall distribution of review sentiment to remain
    stable.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: Trigger words
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](../Images/b8cb44f8a4202672b43ca925422086b8.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
- en: 'Image by Author. *Reviews consistently mention dresses: no distribution drift
    is detected.*'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 作者提供的图片。*评论一致提到连衣裙：未检测到分布漂移。*
- en: You can also check whether the texts contain words from a specific list or lists
    and treat this as a binary feature.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以检查文本是否包含特定列表中的单词，并将其视为二进制特征。
- en: 'This is a powerful way to encode multiple expectations about your texts. You
    need some effort to curate lists manually, but you can design many handy checks
    this way. For example, you can create lists of trigger words like:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一种强大的方式来编码对你文本的多个期望。你需要一些努力来手动策划列表，但你可以通过这种方式设计许多有用的检查。例如，你可以创建触发词列表，如：
- en: Mentions of products or brands.
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提及产品或品牌。
- en: Mentions of competitors.
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提及竞争对手。
- en: Mentions of locations, cities, places, etc.
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提及地点、城市、地方等。
- en: Mentions of words that represent particular topics.
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提及代表特定主题的单词。
- en: You can curate (and continuously extend) lists like this that are specific to
    your use case.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以策划（并不断扩展）类似的列表，这些列表是特定于你的用例的。
- en: For example, if an advisor chatbot helps choose between products offered by
    the company, you might expect most of the responses to contain the names of one
    of the products from the list.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果一个顾问聊天机器人帮助选择公司提供的产品之一，你可能会期望大多数响应中包含该列表中某个产品的名称。
- en: RegExp matches
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: RegExp 匹配
- en: 'The inclusion of specific words from the list is one example of a pattern you
    can formulate as a regular expression. You can come up with others: do you expect
    your texts to start with “hello” and end with “thank you”? Include emails? Contain
    known named elements?'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 包含特定单词的例子是你可以制定的正则表达式模式之一。你可以想出其他模式：你是否期望你的文本以“hello”开头并以“thank you”结尾？包含电子邮件？包含已知的命名元素？
- en: If you expect the model inputs or outputs to match a specific format, you can
    use regular expression match as another descriptor.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你期望模型输入或输出符合特定格式，你可以使用正则表达式匹配作为另一种描述符。
- en: Custom descriptors
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自定义描述符
- en: 'You can extend this idea further. For example:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以进一步扩展这个想法。例如：
- en: '**Evaluate other text properties**: toxicity, subjectivity, the formality of
    the tone, readability score, etc. You can often find open pre-trained models to
    do the trick.'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**评估其他文本属性**：毒性、主观性、语气的正式程度、可读性评分等。你通常可以找到开放的预训练模型来完成这项任务。'
- en: '**Count specific components:** emails, URLs, emojis, dates, and parts of speech.
    You can use external models or even simple regular expressions.'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**计数特定组件：** 电子邮件、URL、表情符号、日期和词性。你可以使用外部模型或甚至简单的正则表达式。'
- en: '**Get granular with stats:** you can track very detailed text statistics if
    they are meaningful to your use case, e.g., track average lengths of words, whether
    they are upper or lower case, the ratio of unique words, etc.'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**深入统计数据：** 如果这些数据对你的用例有意义，你可以追踪非常详细的文本统计数据，例如，追踪单词的平均长度，它们是大写还是小写，唯一单词的比例等。'
- en: '**Monitor personally identifiable information**: for example, when you do not
    expect it to come up in chatbot conversations.'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**监控个人可识别信息**：例如，当你不期望它出现在聊天机器人对话中时。'
- en: '**Use named entity recognition:** to extract specific entities and treat them
    as tags. **‍**'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用命名实体识别：** 提取特定实体并将其视为标签。**‍**'
- en: '**Use topic modeling** to build a topic monitoring system. This is the most
    laborious approach but powerful when done right. It is useful when you expect
    the texts to stay mostly on-topic and have the corpus of previous examples to
    train the model. You can use unsupervised topic clustering and create a model
    to assign new texts to known clusters. You can then treat assigned classes as
    descriptors to monitor the changes in the distribution of topics in the new data.'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用主题建模** 来建立主题监控系统。这是最繁琐的方法，但做得好时非常强大。当你期望文本保持在主要话题上并且拥有之前的示例语料库来训练模型时，它非常有用。你可以使用无监督主题聚类并创建一个模型来将新文本分配到已知的簇中。然后，你可以将分配的类别作为描述符来监控新数据中主题分布的变化。'
- en: '![](../Images/56ae75356635ea5aebe10c8b079438e6.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/56ae75356635ea5aebe10c8b079438e6.png)'
- en: Image by Author. *Example of a summary drift report for multiple descriptors.*
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 作者提供的图片。*多个描述符的总结漂移报告示例。*
- en: 'Here are a few things to keep in mind when designing descriptors to monitor:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 设计描述符时要记住的几点：
- en: '**It is best to stay focused** and try to find a small number of suitable quality
    indicators that match the use case rather than monitor all possible dimensions.
    Think of descriptors as model features. You want to find a few strong ones rather
    than generate a lot of weak or unhelpful features. Many of them are bound to be
    correlated: language and share of OOV words, length in sentences and symbols,
    etc. Pick your favorite!'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**最好保持专注**，尽量找出少量适合的质量指标，这些指标与用例匹配，而不是监控所有可能的维度。将描述符视为模型特征。你希望找到一些强大的特征，而不是生成大量弱的或无用的特征。许多特征往往是相关的：语言和
    OOV 单词的比例、句子和符号的长度等。选择你最喜欢的！'
- en: '**Use exploratory data analysis** to evaluate text properties in existing data
    (for example, logs of previous conversations) to test your assumptions before
    adding them to model monitoring.'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用探索性数据分析** 评估现有数据中的文本属性（例如，以前对话的日志），以测试你的假设，然后再将它们添加到模型监控中。'
- en: '**Learn from model failures**. Whenever you face an issue with production model
    quality that you expect to reappear (e.g., texts in a foreign language), consider
    how to develop a test case or a descriptor to add to detect it in the future.'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**从模型失败中学习**。每当你遇到一个你期望再次出现的生产模型质量问题（例如，外语文本），考虑如何开发一个测试用例或描述符，以便在未来检测到它。'
- en: '**Mind the computation cost.** Using external models to score your texts by
    every possible dimension is tempting, but this comes at a cost. Consider it when
    working with larger datasets: every external classifier is an extra model to run.
    You can often get away with fewer or simpler checks.'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**注意计算成本。** 使用外部模型按每个可能的维度评分文本是很诱人的，但这会带来额外的成本。考虑一下在处理较大的数据集时：每个外部分类器都是一个额外的模型。通常可以通过更少或更简单的检查来解决问题。'
- en: Step-by-step tutorial
  id: totrans-87
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 分步教程
- en: 'To illustrate the idea, let’s walk through the following scenario: you are
    building a classifier model to score reviews that users leave on an e-commerce
    website and tag them by topic. Once it is in production, you want to detect changes
    in the data and model environment, but you do not have the true labels. You need
    to run a separate labeling process to get them.'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明这个想法，让我们通过以下场景来演示：你正在构建一个分类器模型，以对用户在电子商务网站上留下的评论进行评分并按主题标记。一旦模型投入生产，你希望检测数据和模型环境的变化，但你没有真实标签。你需要运行一个单独的标记过程来获取它们。
- en: How can you keep tabs on the changes without the labels?
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 没有标签的情况下你如何跟踪变化？
- en: 'Let’s take an example dataset and go through the following steps:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们以一个示例数据集为例，按照以下步骤进行操作：
- en: '***Code example:*** *head to the* [*example notebook*](https://github.com/evidentlyai/community-examples/blob/main/tutorials/How_to_add_a_custom_text_descriptor.ipynb)
    *to follow all the steps.*'
  id: totrans-91
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***代码示例：*** *请前往* [*示例笔记本*](https://github.com/evidentlyai/community-examples/blob/main/tutorials/How_to_add_a_custom_text_descriptor.ipynb)
    *以查看所有步骤。*'
- en: 💻 1\. Install Evidently
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 💻 1\. 安装 Evidently
- en: First, install Evidently. Use the Python package manager to install it in your
    environment. If you are working in Colab, run *!pip install*. In the Jupyter Notebook,
    you should also install nbextension. Check out the [instructions](https://docs.evidentlyai.com/user-guide/install-evidently/?utm_source=website&utm_medium=referral&utm_campaign=blog_text&utm_content=unstructured-data-monitoring)
    for your environment.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，安装 Evidently。使用 Python 包管理器在你的环境中安装它。如果你在 Colab 中工作，运行 *!pip install*。在 Jupyter
    Notebook 中，你还需要安装 nbextension。查看 [安装说明](https://docs.evidentlyai.com/user-guide/install-evidently/?utm_source=website&utm_medium=referral&utm_campaign=blog_text&utm_content=unstructured-data-monitoring)
    以获取你的环境信息。
- en: You will also need to import a few other libraries like *pandas* and specific
    Evidently components. Follow the instructions in the notebook.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 你还需要导入一些其他库，如 *pandas* 和特定的 Evidently 组件。按照笔记本中的说明进行操作。
- en: 🔡 2\. Prepare the data
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 🔡 2\. 准备数据
- en: Once you have it all set, let’s look at the data! You will work with an open
    dataset from e-commerce reviews.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你设置好了所有内容，让我们来看看数据吧！你将使用一个来自电子商务评论的开放数据集。
- en: 'Here is how the dataset looks:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是数据集的样子：
- en: '![](../Images/61dc47d6fb8c0c43b9c82d3180b95766.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/61dc47d6fb8c0c43b9c82d3180b95766.png)'
- en: Image by Author.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 图片由作者提供。
- en: We’ll focus on the “Review_Text” column for demo purposes. In production, we
    want to monitor changes in the texts of the reviews.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将重点关注“Review_Text”列进行演示。在生产中，我们想要监控评论文本的变化。
- en: 'You will need to specify the column that contains texts using column mapping:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要使用列映射指定包含文本的列：
- en: '[PRE0]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'You should also split the data into two: reference and current. Imagine that
    “reference” data is the data for some representative past period (e.g., previous
    month) and “current” is the current production data (e.g., this month). These
    are the two datasets that you will compare using descriptors.'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 你还应该将数据分成两部分：参考数据和当前数据。假设“参考”数据是某个代表性过去时期的数据（例如，上个月），而“当前”是当前生产数据（例如，本月）。这两个数据集是你将使用描述符进行比较的数据集。
- en: '***Note:*** *it’s important to establish a suitable historical baseline. Pick
    the period that reflects your expectations about how the data should look in the
    future.*'
  id: totrans-104
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***注意：*** *建立合适的历史基线很重要。选择一个反映你对未来数据预期的时期。*'
- en: We selected 5000 examples for each sample. To make things interesting, we introduced
    an artificial shift by selecting the negative reviews for our current dataset.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 我们为每个样本选择了5000个例子。为了增加趣味性，我们通过选择负面评论来人为地引入了一些偏差。
- en: '[PRE1]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 📊 3\. Exploratory data analysis
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 📊 3\. 探索性数据分析
- en: To better understand the data, you can generate a visual report using Evidently.
    There is a pre-built **Text Overview Preset** that helps quickly compare two text
    datasets. It combines various descriptive checks and evaluates overall data drift
    (in this case, using a [model-based drift detection method](https://www.evidentlyai.com/blog/evidently-data-quality-monitoring-and-drift-detection-for-text-data)).
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地理解数据，你可以使用 Evidently 生成可视化报告。这里有一个预设的**文本概览预设**，帮助快速比较两个文本数据集。它结合了各种描述性检查，并评估整体数据漂移（在这种情况下，使用[基于模型的漂移检测方法](https://www.evidentlyai.com/blog/evidently-data-quality-monitoring-and-drift-detection-for-text-data)）。
- en: 'This report also includes a few standard descriptors and allows you to add
    descriptors using lists of Trigger Words. We’ll look at the following descriptors
    as part of the report:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 此报告还包括一些标准描述符，并允许你使用触发词列表添加描述符。我们将在报告中查看以下描述符：
- en: Length of texts
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文本长度
- en: Share of OOV words
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OOV词汇的比例
- en: Share of Non-letter symbols
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 非字母符号的比例
- en: The sentiment of the reviews
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评论的情感
- en: Reviews that include either words “dress” or “gown”
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含“dress”或“gown”这两个词的评论
- en: Reviews that include either words “blouse” or “shirt”
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含“blouse”或“shirt”这两个词的评论
- en: '*Check out the Evidently* [*docs on Descriptors for details*](https://docs.evidentlyai.com/user-guide/customization/text-descriptors-parameters/?utm_source=website&utm_medium=referral&utm_campaign=blog_text&utm_content=unstructured-data-monitoring)*.*'
  id: totrans-116
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*查看 Evidently* [*有关描述符的文档以获取详细信息*](https://docs.evidentlyai.com/user-guide/customization/text-descriptors-parameters/?utm_source=website&utm_medium=referral&utm_campaign=blog_text&utm_content=unstructured-data-monitoring)*。*'
- en: Here is the code you need to run this report. You can assign custom names to
    each descriptor.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 这是运行此报告所需的代码。你可以为每个描述符分配自定义名称。
- en: '[PRE2]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Running a report like this helps explore patterns and shape your expectations
    about particular properties, such as text length distribution.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 运行这样的报告有助于探索模式，并形成对特定属性的期望，例如文本长度分布。
- en: 'The distribution of the “sentiment” descriptor quickly exposes the trick we
    did when splitting the data. We put reviews with a ranking above 3 in “reference”
    and more negative reviews in “current” datasets. The results are visible:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: “情感”描述符的分布迅速揭示了我们在拆分数据时所做的操作。我们将排名高于3的评论放入“参考”数据集中，而将更多负面评论放入“当前”数据集中。结果一目了然：
- en: '![](../Images/f6f0128ec9976fe67cdfb3d79e3cd4b2.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f6f0128ec9976fe67cdfb3d79e3cd4b2.png)'
- en: Image by Author.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 作者提供的图片。
- en: The default report is very comprehensive and helps look at many text properties
    at once. Up to exploring correlations between descriptors and other columns in
    the dataset!
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 默认报告非常全面，可以一次查看多个文本属性。可以探索描述符与数据集中其他列之间的相关性！
- en: You can use it during the exploratory phase, but this is probably not something
    you’d need to go through all the time.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在探索阶段使用它，但这可能不是你需要一直使用的工具。
- en: Luckily, it’s easy to customize.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，它很容易自定义。
- en: '***Evidently Presets and Metrics****. Evidently has report presets that quickly
    generate the reports out of the box. However, there are a lot of individual metrics
    to choose from! You can combine them to create a custom report. Browse the* [*presets*](https://docs.evidentlyai.com/presets/all-presets/?utm_source=website&utm_medium=referral&utm_campaign=blog_text&utm_content=unstructured-data-monitoring)
    *and metrics to understand what’s there.*'
  id: totrans-126
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 📈 4\. Monitor descriptors drift
  id: totrans-127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Let’s say that based on exploratory analysis and your understanding of the
    business problem, you decide only to track a small number of properties:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
- en: 'You want to notice when there is a statistical change: the distributions of
    these properties differ from the reference period. To detect it, you can use drift
    detection methods implemented in Evidently. For example, for numerical features
    like “sentiment,” it will, by default, monitor the shift using Wasserstein distance.
    You can also choose a different method.'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
- en: Here is how you can create a simple drift report to track changes in the three
    descriptors.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Once you run the report, you will get combined visualizations for all chosen
    descriptors. Here is one:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/167750d2843c66fe380500152b7584da.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
- en: Image by Author.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: The dark green line is the mean sentiment in the reference dataset. The green
    area covers one standard deviation from the mean. You can notice that the current
    distribution (in red) is visibly more negative.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
- en: '***Note:*** *In this scenario, it also makes sense to monitor the output drift:
    by tracking shifts in the predicted classes. You can use categorical* [*data drift
    detection methods*](https://docs.evidentlyai.com/reference/data-drift-algorithm/?utm_source=website&utm_medium=referral&utm_campaign=blog_text&utm_content=unstructured-data-monitoring)*,
    like JS divergence. We do not cover this in the tutorial, as we focus only on
    inputs and do not generate predictions. In practice, prediction drift is often
    the first signal to react to.*'
  id: totrans-136
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 😍 5\. Add an “emotion” descriptor
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Let’s say you decided to track one more meaningful property: the emotion expressed
    in the review. The overall sentiment is one thing, but it also helps distinguish
    between “sad” and “angry” reviews, for example.'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
- en: Let’s add this custom descriptor! You can find an appropriate external open-source
    model to score your dataset. Then, you will work with this property as an additional
    column.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
- en: We will take the [Distilbert model](https://huggingface.co/bhadresh-savani/distilbert-base-uncased-emotion)
    from Huggingface, which classifies the text by five emotions.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
- en: You can consider using any other model for your use case, such as named entity
    recognition, language detection, toxicity detection, etc.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: 'You must install transformers to be able to run the model. Check [the instructions](https://huggingface.co/docs/transformers/installation)
    for more details. Then, apply it to the review dataset:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '***Note:*** *this step will score the dataset using the external model. It
    will take some time to execute, depending on your environment. To understand the
    principle without waiting, refer to the “Simple Example” section in the example
    notebook.*'
  id: totrans-144
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: After you add the new column “emotion” to the dataset, you must reflect this
    in Column Mapping. You should specify that it is a new categorical variable in
    the dataset.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Now, you can add the “emotion” distribution drift monitoring to the Report.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Here is what you get!
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8ca2d594a2f48d88dec8b624c5ca703b.png)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
- en: Image by Author.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
- en: You can see a significant increase in “sad” reviews and a decrease in “joy.”
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
- en: Does it appear helpful to track over time? You can continue running this check
    by scoring new data as it comes.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: 🏗️ 6\. Run pipeline tests
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To perform regular analysis of your data inputs, it makes sense to package the
    evaluations as tests. You get a clear “pass” or “fail” result in this scenario.
    You probably do not need to look at the plots if all tests pass. You’re only interested
    when things change!
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: Evidently has an alternative interface called Test Suite that works this way.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is how you create a Test Suite to check for statistical distribution in
    the same four descriptors:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '***Note:*** *we go with defaults, but you can also set* [*custom drift methods
    and conditions*](https://docs.evidentlyai.com/user-guide/customization/options-for-statistical-tests/?utm_source=website&utm_medium=referral&utm_campaign=blog_text&utm_content=unstructured-data-monitoring)*.*'
  id: totrans-159
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Here is the result. The output is neatly structured so you can see which descriptors
    have drifted.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/77d27b490b8c0aa4b642b8509c854d7e.png)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
- en: Image by Author.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
- en: Detecting statistical distribution drift is one of the ways to monitor changes
    in the text property. There are others! Sometimes, it is convenient to run rule-based
    expectations on the descriptor’s min, max, or mean values.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: Let’s say you want to check that all review texts are longer than two words.
    If at least one review is shorter than two words, you want the test to fail and
    see the number of short texts in the response.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is how you do that! You can pick a **TestNumberOfOutRangeValues()** check.
    This time, you should set a custom boundary: the “left” side of the expected range
    is two words. You must also set a test condition: **eq=0**. This means you expect
    the number of objects outside this range to be 0\. If it is higher, you want the
    test to return a fail.'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Here is the result. You can also see the test details that show the defined
    expectation.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c7522aa55016dfa55e61e8499366d7d2.png)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
- en: Image by Author.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: You can follow this principle to design other checks.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
- en: Support Evidently
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '*Enjoyed the tutorial? Star* [*Evidently on GitHub*](https://github.com/evidentlyai/evidently)
    *to contribute back! This helps us continue creating free, open-source tools and
    content for the community.* [*⭐️ Star on GitHub ⟶*](https://github.com/evidentlyai/evidently)'
  id: totrans-172
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Summing up
  id: totrans-173
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Text descriptors map text data to interpretable dimensions you can express as
    a numerical or a categorical attribute. They help describe, evaluate, and monitor
    unstructured data.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
- en: In this tutorial, you learned how to monitor text data using descriptors.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: You can use this approach to monitor the behavior of NLP and LLM-powered models
    production. You can customize and combine your descriptors with other methods,
    such as [monitoring embedding drift](https://www.evidentlyai.com/blog/embedding-drift-detection).
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: Are there other descriptors you consider universally useful? Let us know! Join
    our [Discord community](https://discord.com/invite/xZjKRaNp8b) to share your thoughts.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: '*Originally published at* [*https://www.evidentlyai.com*](https://www.evidentlyai.com/blog/unstructured-data-monitoring)
    *on June 27, 2023\. Thanks to* [*Olga Filippova*](https://www.evidentlyai.com/author/olga-fillipova)
    *for co-authoring the article.*'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
