# è®¾ç½® Python é¡¹ç›®ï¼šç¬¬ V éƒ¨åˆ†

> åŸæ–‡ï¼š[`towardsdatascience.com/setting-up-python-projects-part-v-206df3c1e3d3`](https://towardsdatascience.com/setting-up-python-projects-part-v-206df3c1e3d3)

## æŒæ¡ Python é¡¹ç›®è®¾ç½®çš„è‰ºæœ¯ï¼šé€æ­¥æŒ‡å—

[](https://johschmidt42.medium.com/?source=post_page-----206df3c1e3d3--------------------------------)![Johannes Schmidt](https://johschmidt42.medium.com/?source=post_page-----206df3c1e3d3--------------------------------)[](https://towardsdatascience.com/?source=post_page-----206df3c1e3d3--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----206df3c1e3d3--------------------------------) [Johannes Schmidt](https://johschmidt42.medium.com/?source=post_page-----206df3c1e3d3--------------------------------)

Â·å‘è¡¨äº[Towards Data Science](https://towardsdatascience.com/?source=post_page-----206df3c1e3d3--------------------------------) Â·é˜…è¯»æ—¶é—´ 20 åˆ†é’ŸÂ·2023 å¹´ 1 æœˆ 14 æ—¥

--

![](img/c80bbfc10240ac4b4126a69759a6a36e.png)

ç…§ç‰‡ç”±[Zoya Loonohod](https://unsplash.com/@loonohod?utm_source=medium&utm_medium=referral)æ‹æ‘„ï¼Œæ¥è‡ª[Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

æ— è®ºä½ æ˜¯ç»éªŒä¸°å¯Œçš„å¼€å‘è€…è¿˜æ˜¯åˆšåˆšå¼€å§‹æ¥è§¦ğŸ **Python**ï¼Œäº†è§£å¦‚ä½•æ„å»ºç¨³å¥ä¸”æ˜“äºç»´æŠ¤çš„é¡¹ç›®éƒ½å¾ˆé‡è¦ã€‚æœ¬æ•™ç¨‹å°†æŒ‡å¯¼ä½ ä½¿ç”¨ä¸€äº›è¡Œä¸šå†…æœ€æµè¡Œä¸”æœ‰æ•ˆçš„å·¥å…·æ¥è®¾ç½® Python é¡¹ç›®ã€‚ä½ å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨[GitHub](https://github.com/)å’Œ[GitHub Actions](https://github.com/features/actions)è¿›è¡Œç‰ˆæœ¬æ§åˆ¶å’ŒæŒç»­é›†æˆï¼Œä»¥åŠå…¶ä»–å·¥å…·è¿›è¡Œæµ‹è¯•ã€æ–‡æ¡£ç¼–å†™ã€æ‰“åŒ…å’Œåˆ†å‘ã€‚æœ¬æ•™ç¨‹çš„çµæ„Ÿæ¥æºäº[Hypermodern Python](https://medium.com/@cjolowicz/hypermodern-python-d44485d9d769)å’Œ[æ–° Python é¡¹ç›®çš„æœ€ä½³å®è·µ](https://mitelman.engineering/blog/python-best-practice/automating-python-best-practices-for-a-new-project/)ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯å”¯ä¸€çš„æ–¹æ³•ï¼Œä½ å¯èƒ½æœ‰ä¸åŒçš„åå¥½æˆ–è§‚ç‚¹ã€‚æ•™ç¨‹æ—¨åœ¨å¯¹åˆå­¦è€…å‹å¥½ï¼ŒåŒæ—¶æ¶µç›–ä¸€äº›é«˜çº§ä¸»é¢˜ã€‚åœ¨æ¯ä¸ªéƒ¨åˆ†ï¼Œä½ å°†è‡ªåŠ¨åŒ–ä¸€äº›ä»»åŠ¡ï¼Œå¹¶ä¸ºä½ çš„é¡¹ç›®æ·»åŠ å¾½ç« ï¼Œä»¥å±•ç¤ºä½ çš„è¿›å±•å’Œæˆå°±ã€‚

è¯¥ç³»åˆ—çš„ä»£ç åº“å¯ä»¥åœ¨[github.com/johschmidt42/python-project-johannes](https://github.com/johschmidt42/python-project-johannes)æ‰¾åˆ°

è¿™ä¸€éƒ¨åˆ†çš„çµæ„Ÿæ¥è‡ªäºè¿™ç¯‡åšå®¢æ–‡ç« ï¼š

[**Pythonã€Poetry ä¸ GitHub Actions çš„è¯­ä¹‰åŒ–å‘å¸ƒ ğŸš€**

*ç”±äºæˆ‘çš„åŒäº‹ä»¬çš„å…´è¶£ï¼Œæˆ‘è®¡åˆ’å‘ Dr. Sven æ·»åŠ ä¸€äº›åŠŸèƒ½ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘éœ€è¦â€¦*](https://mestrak.com/blog/semantic-release-with-python-poetry-github-actions-20nn)

# è¦æ±‚

+   **æ“ä½œç³»ç»Ÿ**: Linuxã€Unixã€macOSã€Windowsï¼ˆWSL2ï¼Œä¾‹å¦‚ Ubuntu 20.04 LTSï¼‰

+   **å·¥å…·**ï¼špython3.10, bash, git, tree

+   **ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆVCSï¼‰ä¸»æœº**ï¼š [GitHub](https://github.com/)

+   **æŒç»­é›†æˆï¼ˆCIï¼‰å·¥å…·**ï¼š [GitHub Actions](https://github.com/features/actions)

é¢„è®¡ä½ å¯¹ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆVCSï¼‰[git](https://git-scm.com/)æœ‰æ‰€äº†è§£ã€‚å¦‚æœä¸äº†è§£ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå¤ä¹ ï¼š [Git ä»‹ç»](https://realpython.com/python-git-github-intro/)

æäº¤å°†åŸºäº [æœ€ä½³ git æäº¤å®è·µ](https://deepsource.io/blog/git-best-practices/) å’Œ [ä¼ ç»Ÿæäº¤](https://www.conventionalcommits.org/en/v1.0.0/)ã€‚ä½ å¯ä»¥ä½¿ç”¨ [PyCharm çš„ä¼ ç»Ÿæäº¤æ’ä»¶](https://plugins.jetbrains.com/plugin/13389-conventional-commit) æˆ– [VSCode æ‰©å±•](https://github.com/vivaxy/vscode-conventional-commits) æ¥å¸®åŠ©ä½ ä»¥è¿™ç§æ ¼å¼ç¼–å†™æäº¤ã€‚

## æ¦‚è¿°

+   [ç¬¬ä¸€éƒ¨åˆ†ï¼ˆGitHubï¼ŒIDEï¼‰](https://johschmidt42.medium.com/setting-up-python-projects-part-i-408603868c08)

+   ç¬¬äºŒéƒ¨åˆ†ï¼ˆæ ¼å¼åŒ–ï¼ŒLintingï¼ŒCIï¼‰

+   ç¬¬ä¸‰éƒ¨åˆ†ï¼ˆæµ‹è¯•ï¼ŒCIï¼‰

+   [ç¬¬å››éƒ¨åˆ†ï¼ˆæ–‡æ¡£ï¼ŒCI/CDï¼‰](https://johschmidt42.medium.com/setting-up-python-projects-part-iv-82059eba4ca4)

+   **ç¬¬äº”éƒ¨åˆ†ï¼ˆç‰ˆæœ¬æ§åˆ¶ä¸å‘å¸ƒï¼ŒCI/CDï¼‰**

+   [ç¬¬å…­éƒ¨åˆ†ï¼ˆå®¹å™¨åŒ–ï¼ŒDockerï¼ŒCI/CDï¼‰](https://johschmidt42.medium.com/setting-up-python-projects-part-vi-cbdbf28eff53)

## ç»“æ„

+   Git åˆ†æ”¯ç­–ç•¥ (*GitHub æµç¨‹*)

+   ä»€ä¹ˆæ˜¯å‘å¸ƒï¼Ÿ (*zip, tar.gz*)

+   è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ (*v0.1.0*)

+   æ‰‹åŠ¨åˆ›å»ºå‘å¸ƒ (*git tag, GitHub*)

+   è‡ªåŠ¨åˆ›å»ºå‘å¸ƒ (*ä¼ ç»Ÿæäº¤ï¼Œè¯­ä¹‰å‘å¸ƒ*)

+   CI/CD (*release.yml*)

+   åˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆPATï¼‰

+   GitHub Actions æµç¨‹ (*ç¼–æ’å·¥ä½œæµ*)

+   å¾½ç«  (*å‘å¸ƒ*)

+   å¥–åŠ± (*å¼ºåˆ¶æ‰§è¡Œä¼ ç»Ÿæäº¤*)

å‘å¸ƒè½¯ä»¶æ˜¯è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­çš„é‡è¦æ­¥éª¤ï¼Œå› ä¸ºå®ƒä½¿æ–°åŠŸèƒ½å’Œä¿®å¤ç¨‹åºå¯ä¾›ç”¨æˆ·ä½¿ç”¨ã€‚å‘å¸ƒè½¯ä»¶çš„ä¸€ä¸ªå…³é”®æ–¹é¢æ˜¯ç‰ˆæœ¬æ§åˆ¶ï¼Œå®ƒæœ‰åŠ©äºè·Ÿè¸ªå’Œä¼ è¾¾æ¯ä¸ªå‘å¸ƒä¸­çš„å˜åŒ–ã€‚è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è½¯ä»¶ç‰ˆæœ¬æ§åˆ¶æ ‡å‡†ï¼Œå®ƒä½¿ç”¨æ ¼å¼ä¸º Major.Minor.Patchï¼ˆä¾‹å¦‚ 1.2.3ï¼‰çš„ç‰ˆæœ¬å·æ¥æŒ‡ç¤ºå‘å¸ƒä¸­æ‰€åšæ›´æ”¹çš„çº§åˆ«ã€‚

ä¼ ç»Ÿæäº¤æ˜¯ä¸€ç§ä¸ºæäº¤æ¶ˆæ¯æ·»åŠ äººç±»å’Œæœºå™¨å¯è¯»æ„ä¹‰çš„è§„èŒƒã€‚å®ƒæ˜¯ä¸€ç§ä»¥ä¸€è‡´çš„æ–¹å¼æ ¼å¼åŒ–æäº¤æ¶ˆæ¯çš„æ–¹æ³•ï¼Œè¿™ä½¿å¾—ç¡®å®šæ‰€åšæ›´æ”¹çš„ç±»å‹å˜å¾—ç®€å•ã€‚ä¼ ç»Ÿæäº¤é€šå¸¸ä¸è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ç»“åˆä½¿ç”¨ï¼Œå› ä¸ºæäº¤æ¶ˆæ¯å¯ä»¥ç”¨æ¥è‡ªåŠ¨ç¡®å®šå‘å¸ƒçš„ç‰ˆæœ¬å·ã€‚è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶å’Œä¼ ç»Ÿæäº¤ä¸€èµ·æä¾›äº†ä¸€ç§æ¸…æ™°ä¸”ä¸€è‡´çš„æ–¹æ³•æ¥è·Ÿè¸ªå’Œä¼ è¾¾æ¯ä¸ªè½¯ä»¶é¡¹ç›®å‘å¸ƒä¸­çš„æ›´æ”¹ã€‚

# Git åˆ†æ”¯ç­–ç•¥

git æœ‰è®¸å¤šä¸åŒçš„åˆ†æ”¯ç­–ç•¥ã€‚å¾ˆå¤šäººå€¾å‘äºä½¿ç”¨[GitFlow](http://datasift.github.io/gitflow/IntroducingGitFlow.html)ï¼ˆæˆ–å˜ç§ï¼‰ã€[Three Flow](https://www.nomachetejuggling.com/2017/04/09/a-different-branching-strategy/)æˆ–[Trunk based Flows](https://trunkbaseddevelopment.com/)ã€‚ä¸€äº›äººä½¿ç”¨è¿™äº›ç­–ç•¥ä¸­çš„æ··åˆç­–ç•¥ï¼Œä¾‹å¦‚è¿™ä¸ª[ç­–ç•¥](https://brightinventions.pl/blog/how-do-we-use-git/)ã€‚æˆ‘ä½¿ç”¨éå¸¸ç®€å•çš„[GitHub flow](https://guides.github.com/introduction/flow/)åˆ†æ”¯ç­–ç•¥ï¼Œå…¶ä¸­æ‰€æœ‰çš„ bug ä¿®å¤å’ŒåŠŸèƒ½éƒ½æœ‰å„è‡ªçš„ç‹¬ç«‹åˆ†æ”¯ï¼Œå®Œæˆåï¼Œæ¯ä¸ªåˆ†æ”¯éƒ½ä¼šåˆå¹¶åˆ°ä¸»åˆ†æ”¯å¹¶è¿›è¡Œéƒ¨ç½²ã€‚ç®€å•ã€å¥½ç”¨ä¸”æ˜“äºæ“ä½œã€‚

![](img/9ac6ed499d8cab343bc75482579e1bed.png)

GitHub Flow åˆ†æ”¯ç­–ç•¥

æ— è®ºä½ çš„ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Œæœ€ç»ˆä½ éƒ½ä¼šåˆå¹¶ä¸€ä¸ªæ‹‰å–è¯·æ±‚ï¼Œå¹¶ï¼ˆå¯èƒ½ï¼‰åˆ›å»ºä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒã€‚

# ä»€ä¹ˆæ˜¯ç‰ˆæœ¬å‘å¸ƒï¼Ÿ

ç®€è€Œè¨€ä¹‹ï¼Œå‘å¸ƒå°±æ˜¯å°†ä¸€ä¸ªç‰ˆæœ¬çš„ä»£ç æ‰“åŒ…ï¼ˆä¾‹å¦‚å‹ç¼©æ–‡ä»¶ï¼‰ï¼Œå¹¶æ¨é€åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆè¿™å¯¹ä½ æ¥è¯´å¯èƒ½æ˜¯ä»»ä½•ä¸œè¥¿ï¼‰ã€‚

ç‰ˆæœ¬ç®¡ç†å¯èƒ½ä¼šå¾ˆæ··ä¹±ã€‚å› æ­¤ï¼Œéœ€è¦æœ‰ä¸€ä¸ªç®€æ˜çš„æ–¹æ³•ï¼ˆä»¥åŠå…¶ä»–äººä¹Ÿè·Ÿéšçš„æ–¹æ³•ï¼‰ï¼Œå®šä¹‰ä»€ä¹ˆæ˜¯ç‰ˆæœ¬å‘å¸ƒï¼Œä»¥åŠä¸€ä¸ªç‰ˆæœ¬ä¸ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å˜åŒ–ã€‚å¦‚æœä½ ä¸è·Ÿè¸ªç‰ˆæœ¬ä¹‹é—´çš„å˜åŒ–ï¼Œä½ å¯èƒ½ä¸ä¼šç†è§£æ¯ä¸ªç‰ˆæœ¬ä¸­å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼Œä¹Ÿæ— æ³•è¯†åˆ«æ–°ä»£ç ä¸­å¯èƒ½å¼•å…¥çš„ä»»ä½•é—®é¢˜ã€‚æ²¡æœ‰å˜æ›´æ—¥å¿—ï¼Œå¾ˆéš¾ç†è§£è½¯ä»¶å¦‚ä½•éšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•ã€‚å®ƒä¹Ÿå¯èƒ½ä½¿å›æ»šæ›´æ”¹å˜å¾—å›°éš¾ï¼ˆå¦‚æœå¿…è¦çš„è¯ï¼‰ã€‚

# è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶

[è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶](https://semver.org/)åªæ˜¯ä¸€ä¸ªç¼–å·æ–¹æ¡ˆå’Œä¸šç•Œçš„æ ‡å‡†å®è·µã€‚å®ƒæŒ‡ç¤ºäº†è¯¥ç‰ˆæœ¬ä¸å‰ä¸€ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å˜æ›´ç¨‹åº¦ã€‚ä¸€ä¸ªè¯­ä¹‰ç‰ˆæœ¬å·æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼Œä¾‹å¦‚**1.8.42**ï¼Œéµå¾ªä»¥ä¸‹æ¨¡å¼ï¼š

+   *MAJOR.MINOR.PATCH*

æ¯ä¸ªéƒ¨åˆ†ä»£è¡¨äº†ä¸åŒç¨‹åº¦çš„å˜åŒ–ã€‚PATCH ç‰ˆæœ¬å‘å¸ƒè¡¨ç¤ºé”™è¯¯ä¿®å¤æˆ–å¾®å°æ›´æ”¹ï¼ˆä¾‹å¦‚ä» 1.0.0 åˆ° 1.0.1ï¼‰ã€‚MINOR ç‰ˆæœ¬å‘å¸ƒè¡¨ç¤ºæ·»åŠ /åˆ é™¤åŠŸèƒ½æˆ–å‘åå…¼å®¹çš„åŠŸèƒ½æ›´æ”¹ï¼ˆä¾‹å¦‚ä» 1.0.0 åˆ° 1.1.0ï¼‰ã€‚MAJOR ç‰ˆæœ¬å‘å¸ƒè¡¨ç¤ºæ·»åŠ /åˆ é™¤åŠŸèƒ½ä»¥åŠå¯èƒ½çš„å‘åä¸å…¼å®¹çš„æ›´æ”¹ï¼Œä¾‹å¦‚ç ´åæ€§æ›´æ”¹ï¼ˆä¾‹å¦‚ä» 1.0.0 åˆ° 2.0.0ï¼‰ã€‚

æˆ‘æ¨è[è¿ˆå…‹Â·è¿ˆå°”æ–¯](https://www.youtube.com/watch?v=4wPjo5C-v8Y)çš„ä¸€ä¸ªè®²åº§ï¼Œå¦‚æœä½ æƒ³è¦ä¸€ä¸ªå…³äºè¯­ä¹‰ç‰ˆæœ¬å‘å¸ƒçš„è§†è§‰ä»‹ç»ã€‚å®ƒæ€»ç»“äº†ä»€ä¹ˆæ˜¯å‘å¸ƒï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨[git æ ‡ç­¾](https://git-scm.com/book/en/v2/Git-Basics-Tagging)æ¥åˆ›å»ºç‰ˆæœ¬å‘å¸ƒã€‚

å…³äº**git æ ‡ç­¾**ï¼šgit ä¸­æœ‰è½»é‡çº§æ ‡ç­¾å’Œæ³¨é‡Šæ ‡ç­¾ã€‚ä¸€ä¸ª*è½»é‡çº§*æ ‡ç­¾åªæ˜¯æŒ‡å‘ç‰¹å®šæäº¤çš„æŒ‡é’ˆï¼Œè€Œ*æ³¨é‡Š*æ ‡ç­¾åˆ™æ˜¯ git ä¸­çš„ä¸€ä¸ªå®Œæ•´å¯¹è±¡ã€‚

# æ‰‹åŠ¨åˆ›å»ºç‰ˆæœ¬å‘å¸ƒ

è®©æˆ‘ä»¬å…ˆæ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒï¼Œç„¶åå†è¿›è¡Œè‡ªåŠ¨åŒ–å¤„ç†ã€‚

å¦‚æœä½ è®°å¾—ï¼Œæˆ‘ä»¬çš„ example_app çš„ `__init__.py` æ–‡ä»¶åŒ…å«äº†ç‰ˆæœ¬ä¿¡æ¯ã€‚

```py
# src/example_app/__init__.py

__version__ = "0.1.0"
```

ä»¥åŠ `pyproject.toml` æ–‡ä»¶

```py
# pyproject.toml

[tool.poetry]
name = "example_app"
version = "0.1.0"
...
```

æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆå¿…é¡»åšçš„æ˜¯åˆ›å»ºä¸€ä¸ªæ³¨é‡Šçš„ git æ ‡ç­¾ `v0.1.0` å¹¶å°†å…¶æ·»åŠ åˆ°ä¸»åˆ†æ”¯çš„æœ€æ–°æäº¤ä¸­ï¼š

```py
> git tag -a v0.1.0 -m "version v0.1.0"
```

è¯·æ³¨æ„ï¼Œå¦‚æœåœ¨å‘½ä»¤æœ«å°¾æ²¡æœ‰æŒ‡å®šæäº¤å“ˆå¸Œï¼Œåˆ™ git ä¼šä½¿ç”¨ä½ å½“å‰æ‰€åœ¨çš„æäº¤ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è·å–æ ‡ç­¾åˆ—è¡¨ï¼š

```py
> git tag

v0.1.0
```

å¦‚æœæˆ‘ä»¬æƒ³è¦å†æ¬¡åˆ é™¤å®ƒï¼š

```py
> git tag -d v0.1.0

Deleted tag 'v0.1.0'
```

å¹¶é€šè¿‡ä»¥ä¸‹å‘½ä»¤è·å–æœ‰å…³è¯¥æ ‡ç­¾çš„æ›´å¤šä¿¡æ¯ï¼š

```py
> git show v0.1.0

tag v0.1.0

Tagger: Johannes Schmidt <johannes.schmidt.vik@gmail.com>
Date:   Sat Jan 7 12:55:15 2023 +0100
version v0.1.0
commit efc9a445cd42ce2f7ddfbe75ffaed1a5bc8e0f11 (HEAD -> main, tag: v0.1.0, origin/main, origin/HEAD)
Author: Johannes Schmidt <74831750+johschmidt42@users.noreply.github.com>
Date:   Mon Jan 2 11:20:25 2023 +0100
...
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°†æ–°åˆ›å»ºçš„æ ‡ç­¾æ¨é€åˆ° originï¼š

```py
> git push origin v0.1.0

Enumerating objects: 1, done.
Counting objects: 100% (1/1), done.
Writing objects: 100% (1/1), 171 bytes | 171.00 KiB/s, done.
Total 1 (delta 0), reused 0 (delta 0), pack-reused 0
To github.com:johschmidt42/python-project-johannes.git
 * [new tag]         v0.1.0 -> v0.1.0
```

ä½¿å¾—è¿™ä¸ª git æ ‡ç­¾ç°åœ¨å¯ä»¥åœ¨ GitHub ä¸Šä½¿ç”¨ï¼š

![](img/b8daad7af39ff3448a87465c2b3a98b9.png)

è®©æˆ‘ä»¬æ‰‹åŠ¨åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬å‘å¸ƒï¼Œå¹¶ä½¿ç”¨è¿™ä¸ª git æ ‡ç­¾ï¼š

![](img/a3bb26a8179a416567385bbe324da5f9.png)

æˆ‘ä»¬ç‚¹å‡» `Create a new release`ï¼Œé€‰æ‹©æˆ‘ä»¬ç°æœ‰çš„æ ‡ç­¾ï¼ˆå·²ç»ç»‘å®šåˆ°æäº¤ï¼‰ï¼Œç„¶åé€šè¿‡ç‚¹å‡» `Generate release notes` æŒ‰é’®è‡ªåŠ¨ç”Ÿæˆå‘å¸ƒè¯´æ˜ï¼Œæœ€åç”¨ `Publish release` æŒ‰é’®å‘å¸ƒè¯¥ç‰ˆæœ¬ã€‚

![](img/b49c9e26d316c7dab46743f61fb54f6c.png)

GitHub å°†è‡ªåŠ¨ä¸ºæºä»£ç åˆ›å»º `tar` å’Œ `zip`ï¼ˆèµ„äº§ï¼‰ï¼Œä½†ä¸ä¼šæ„å»ºåº”ç”¨ç¨‹åºï¼ç»“æœå°†å¦‚ä¸‹æ‰€ç¤ºï¼š

![](img/cdb1cd2658a5eac059aefc07ca7c1579.png)

æ€»ç»“ä¸€ä¸‹ï¼Œå‘å¸ƒçš„æ­¥éª¤æ˜¯ï¼š

+   ä»ä½ çš„é»˜è®¤åˆ†æ”¯åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼ˆä¾‹å¦‚åŠŸèƒ½æˆ–ä¿®å¤åˆ†æ”¯ï¼‰

+   è¿›è¡Œæ›´æ”¹å¹¶å¢åŠ ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ *pyproject.toml* å’Œ *__init__.py*ï¼‰

+   å°†åŠŸèƒ½/é”™è¯¯ä¿®å¤æäº¤åˆ°é»˜è®¤åˆ†æ”¯ï¼ˆå¯èƒ½é€šè¿‡ Pull Requestï¼‰

+   æ·»åŠ ä¸€ä¸ª *æ³¨é‡Šçš„* git æ ‡ç­¾ï¼ˆè¯­ä¹‰ç‰ˆæœ¬ï¼‰åˆ°æäº¤ä¸­

+   åœ¨ GitHub ä¸Šå‘å¸ƒç‰ˆæœ¬ï¼Œå¹¶é™„åŠ ä¸€äº›é¢å¤–ä¿¡æ¯

# è‡ªåŠ¨åˆ›å»ºå‘å¸ƒ

ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»¬ä¸å–œæ¬¢é‡å¤è‡ªå·±ã€‚å› æ­¤ï¼Œæœ‰å¾ˆå¤šå·¥å…·å¯ä»¥è®©è¿™äº›æ­¥éª¤å˜å¾—éå¸¸ç®€å•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†ä»‹ç»[Semantic Releases](https://python-semantic-release.readthedocs.io/en/latest/)ï¼Œä¸€ä¸ªä¸“é—¨ä¸º Python é¡¹ç›®è®¾è®¡çš„å·¥å…·ã€‚

è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨åœ¨ä½ çš„ä»“åº“ä¸­è®¾ç½®ç‰ˆæœ¬å·ã€ç”¨ç‰ˆæœ¬å·æ ‡è®°ä»£ç å¹¶åˆ›å»ºå‘å¸ƒçš„å·¥å…·ï¼è¿™ä¸€åˆ‡éƒ½æ˜¯åŸºäº **çº¦å®šå¼æäº¤** é£æ ¼æ¶ˆæ¯çš„å†…å®¹å®Œæˆçš„ã€‚

## çº¦å®šå¼æäº¤

è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶å’Œ [conventional-commits](https://www.conventionalcommits.org/en/v1.0.0/) ä¹‹é—´æœ‰ä»€ä¹ˆè”ç³»ï¼Ÿ

æŸäº›æäº¤ç±»å‹å¯ä»¥ç”¨äºè‡ªåŠ¨ç¡®å®šè¯­ä¹‰ç‰ˆæœ¬çš„æå‡ï¼

+   ä¸€ä¸ª `fix` æäº¤æ˜¯ PATCHã€‚

+   ä¸€ä¸ª `feat` æäº¤æ˜¯ MINORã€‚

+   ä¸€ä¸ªå¸¦æœ‰ `BREAKING CHANGE` æˆ– `!` çš„æäº¤æ˜¯ MAJORã€‚

å…¶ä»–ç±»å‹çš„æäº¤ï¼Œä¾‹å¦‚ `build`ã€`chore`ã€`ci`ã€`docs`ã€`style`ã€`refactor`ã€`perf`ã€`test` é€šå¸¸ä¸ä¼šå¢åŠ ç‰ˆæœ¬ã€‚

æŸ¥çœ‹æœ€åçš„é™„åŠ éƒ¨åˆ†ï¼Œäº†è§£å¦‚ä½•åœ¨ä½ çš„é¡¹ç›®ä¸­å¼ºåˆ¶æ‰§è¡Œçº¦å®šå¼æäº¤ï¼

## è‡ªåŠ¨è¯­ä¹‰ç‰ˆæœ¬å‘å¸ƒï¼ˆæœ¬åœ°ï¼‰

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ·»åŠ åº“ï¼š

```py
> poetry add --group semver python-semantic-release
```

è®©æˆ‘ä»¬æ·±å…¥é…ç½®è®¾ç½®ï¼Œä»¥ä¾¿è‡ªåŠ¨ç”Ÿæˆå˜æ›´æ—¥å¿—å’Œå‘å¸ƒã€‚åœ¨ `pyproject.toml` ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°† *semantic_release* ä½œä¸ºå·¥å…·æ·»åŠ ï¼š

```py
# pyproject.toml

...
[tool.semantic_release]
branch = "main"
version_variable = "src/example_app/__init__.py:__version__"
version_toml = "pyproject.toml:tool.poetry.version"
version_source = "tag"
commit_version_number = true # required for version_source = "tag"
tag_commit = true
upload_to_pypi = false
upload_to_release = false
hvcs = "github" # gitlab is also supported
```

+   `branch`ï¼šæŒ‡å®šå‘å¸ƒåº”åŸºäºçš„åˆ†æ”¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯ "main" åˆ†æ”¯ã€‚

+   `version_variable`ï¼šæŒ‡å®šæºä»£ç ä¸­ç‰ˆæœ¬å·çš„æ–‡ä»¶è·¯å¾„å’Œå˜é‡åç§°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç‰ˆæœ¬å·å­˜å‚¨åœ¨æ–‡ä»¶ `src/example_app/__init__.py` ä¸­çš„ `__version__` å˜é‡ä¸­ã€‚

+   `version_toml`ï¼šæŒ‡å®š`pyproject.toml`æ–‡ä»¶ä¸­ç‰ˆæœ¬å·çš„æ–‡ä»¶è·¯å¾„å’Œå˜é‡åç§°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç‰ˆæœ¬å·å­˜å‚¨åœ¨ `pyproject.toml` æ–‡ä»¶çš„ `tool.poetry.version` å˜é‡ä¸­ã€‚

+   `version_source`ï¼šæŒ‡å®šç‰ˆæœ¬å·çš„æ¥æºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç‰ˆæœ¬å·æ¥è‡ªæ ‡ç­¾ï¼ˆè€Œä¸æ˜¯æäº¤ï¼‰ã€‚

+   `commit_version_number`ï¼šå½“`version_source = "tag"`æ—¶ï¼Œæ­¤å‚æ•°æ˜¯å¿…éœ€çš„ã€‚å®ƒæŒ‡å®šæ˜¯å¦å°†ç‰ˆæœ¬å·æäº¤åˆ°ä»“åº“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒè®¾ç½®ä¸º trueï¼Œè¿™æ„å‘³ç€ç‰ˆæœ¬å·å°†è¢«æäº¤ã€‚

+   `tag_commit`ï¼šæŒ‡å®šæ˜¯å¦ä¸ºå‘å¸ƒæäº¤åˆ›å»ºæ–°çš„æ ‡ç­¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒè®¾ç½®ä¸º trueï¼Œè¿™æ„å‘³ç€å°†åˆ›å»ºä¸€ä¸ªæ–°çš„æ ‡ç­¾ã€‚

+   `upload_to_pypi`ï¼šæŒ‡å®šæ˜¯å¦å°†è½¯ä»¶åŒ…ä¸Šä¼ åˆ° PyPI åŒ…ä»“åº“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒè®¾ç½®ä¸º falseï¼Œè¿™æ„å‘³ç€è½¯ä»¶åŒ…ä¸ä¼šä¸Šä¼ åˆ° PyPIã€‚

+   `upload_to_release`ï¼šæŒ‡å®šæ˜¯å¦å°†è½¯ä»¶åŒ…ä¸Šä¼ åˆ° GitHub å‘å¸ƒé¡µé¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒè®¾ç½®ä¸º falseï¼Œè¿™æ„å‘³ç€è½¯ä»¶åŒ…ä¸ä¼šä¸Šä¼ åˆ° GitHub å‘å¸ƒé¡µé¢ã€‚

+   `hvcs`ï¼šæŒ‡å®šé¡¹ç›®çš„æ‰˜ç®¡ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒè®¾ç½®ä¸º "github"ï¼Œè¿™æ„å‘³ç€é¡¹ç›®æ‰˜ç®¡åœ¨ GitHub ä¸Šã€‚"gitlab" ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚

æˆ‘ä»¬å¯ä»¥æ›´æ–°å®šä¹‰é¡¹ç›®/æ¨¡å—ç‰ˆæœ¬çš„æ–‡ä»¶ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨å˜é‡`version_variable`ç”¨äºæ™®é€šæ–‡ä»¶ï¼Œ`version_toml`ç”¨äº*.toml* æ–‡ä»¶ã€‚`version_source`å®šä¹‰äº†ç‰ˆæœ¬çš„çœŸå®æ€§æ¥æºã€‚ç”±äºè¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„ç‰ˆæœ¬ä¸ git æ³¨é‡Šæ ‡ç­¾ç´§å¯†è€¦åˆï¼Œä¾‹å¦‚æˆ‘ä»¬æ¯æ¬¡å‘å¸ƒæ—¶è‡ªåŠ¨åˆ›å»º git æ ‡ç­¾ï¼ˆæ ‡å¿—`tag_commit`è®¾ç½®ä¸º trueï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æº`tag`ï¼Œè€Œä¸æ˜¯é»˜è®¤å€¼`commit`ï¼Œåè€…åœ¨æäº¤ä¿¡æ¯ä¸­æŸ¥æ‰¾æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸ºäº†èƒ½å¤Ÿæ›´æ–°æ–‡ä»¶å¹¶æäº¤æ›´æ”¹ï¼Œæˆ‘ä»¬[éœ€è¦è®¾ç½®](https://github.com/relekang/python-semantic-release/issues/104) `[commit_version_number](https://github.com/relekang/python-semantic-release/issues/104)` [æ ‡å¿—ä¸º true](https://github.com/relekang/python-semantic-release/issues/104)ã€‚å› ä¸ºæˆ‘ä»¬ä¸æƒ³å°†ä»»ä½•ä¸œè¥¿ä¸Šä¼ åˆ° Python ç´¢å¼• [PyPi](https://pypi.org/)ï¼Œæ‰€ä»¥æ ‡å¿—`upload_to_pypi`è®¾ç½®ä¸º falseã€‚ç°åœ¨æˆ‘ä»¬ä¹Ÿä¸æƒ³å°†ä»»ä½•ä¸œè¥¿ä¸Šä¼ åˆ°æˆ‘ä»¬çš„å‘å¸ƒé¡µé¢ã€‚`hvcs`è®¾ç½®ä¸º`github`ï¼ˆé»˜è®¤ï¼‰ï¼Œå…¶ä»–å€¼å¯ä»¥æ˜¯ï¼š`gitlab`ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œå‡ ä¸ªå‘½ä»¤åœ¨æœ¬åœ°æµ‹è¯•è¿™ä¸€ç‚¹ï¼Œæˆ‘å°†ç›´æ¥å°†è¿™äº›å‘½ä»¤æ·»åŠ åˆ°æˆ‘ä»¬çš„ Makefile ä¸­ï¼š

```py
# Makefile

...

##@ Releases

current-version: ## returns the current version
 @semantic-release print-version --current

next-version: ## returns the next version
 @semantic-release print-version --next

current-changelog: ## returns the current changelog
 @semantic-release changelog --released

next-changelog: ## returns the next changelog
 @semantic-release changelog --unreleased

publish-noop: ## publish command (no-operation mode)
 @semantic-release publish --noop
```

ä½¿ç”¨å‘½ä»¤*current-version*æˆ‘ä»¬å¯ä»¥ä» git æ ‘ä¸­çš„æœ€åä¸€ä¸ª git æ ‡ç­¾è·å–ç‰ˆæœ¬ï¼š

```py
> make current-version

0.1.0
```

å¦‚æœæˆ‘ä»¬ä»¥ä¼ ç»Ÿæäº¤é£æ ¼æ·»åŠ ä¸€äº›æäº¤ï¼Œä¾‹å¦‚ `feat: new cool feature` æˆ– `fix: nasty bug`ï¼Œé‚£ä¹ˆå‘½ä»¤ **next-version** å°†è®¡ç®—ç‰ˆæœ¬å·çš„å¢é‡ï¼š

```py
> make next-version

0.2.0
```

ç›®å‰ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸­æ²¡æœ‰ CHANGELOG æ–‡ä»¶ï¼Œå› æ­¤å½“æˆ‘ä»¬è¿è¡Œï¼š

```py
> make current-changelog 
```

è¾“å‡ºå°†æ˜¯ç©ºçš„ã€‚ä½†æ ¹æ®æäº¤è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åˆ›å»ºå³å°†å‘å¸ƒçš„å˜æ›´æ—¥å¿—ï¼š

```py
> make next-changelog### Feature
* Add releases (#8)) (`5343f46`))
* Docstrings (#5)) (`fb2fa04`))
* Add application in app.py (`3f07683`))### Documentation
* Add search bar & github url (#6)) (`3df7c48`))
* Add badge pages.yml to README.py (`b76651c`))
* Add documentation to Makefile (#3)) (`2294ee1`))
```

å¦‚æœæˆ‘ä»¬æ¨é€æ–°çš„æäº¤ï¼ˆç›´æ¥åˆ°ä¸»åˆ†æ”¯æˆ–é€šè¿‡ PRï¼‰ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼š

```py
> semantic-release publish
```

å‘å¸ƒå‘½ä»¤å°†æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œï¼š

1.  æ›´æ–°æˆ–åˆ›å»ºå˜æ›´æ—¥å¿—æ–‡ä»¶ã€‚

1.  è¿è¡Œ [semantic-release version](https://python-semantic-release.readthedocs.io/en/latest/index.html#cmd-version)ã€‚

1.  å°†æ›´æ”¹æ¨é€åˆ° gitã€‚

1.  è¿è¡Œ [build_command](https://python-semantic-release.readthedocs.io/en/latest/configuration.html#config-build-command) å¹¶å°†åˆ†å‘æ–‡ä»¶ä¸Šä¼ åˆ°ä½ çš„ä»“åº“ã€‚

1.  è¿è¡Œ [semantic-release changelog](https://python-semantic-release.readthedocs.io/en/latest/index.html#cmd-changelog) å¹¶å‘å¸ƒåˆ°ä½ çš„ VCS æä¾›è€…ã€‚

1.  å°†ç”± [build_command](https://python-semantic-release.readthedocs.io/en/latest/configuration.html#config-build-command) åˆ›å»ºçš„æ–‡ä»¶é™„åŠ åˆ° GitHub å‘å¸ƒä¸­ã€‚

æ¯ä¸€æ­¥å½“ç„¶éƒ½å¯ä»¥é…ç½®æˆ–ç¦ç”¨ï¼

# CI/CD

è®©æˆ‘ä»¬ä½¿ç”¨ GitHub Actions æ„å»ºä¸€ä¸ª CI æµæ°´çº¿ï¼Œæ¯æ¬¡æäº¤åˆ°ä¸»åˆ†æ”¯æ—¶è¿è¡Œ semantic-release çš„å‘å¸ƒå‘½ä»¤ã€‚

è™½ç„¶æ•´ä½“ç»“æ„ä¸ *lint.yml*ã€*test.yml* æˆ– *pages.yml* ç›¸åŒï¼Œä½†æœ‰ä¸€äº›å˜åŒ–éœ€è¦è¯´æ˜ã€‚åœ¨æ­¥éª¤ `Checkout repository` ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ tokenï¼Œç”¨äºæ£€å‡ºåˆ†æ”¯ã€‚è¿™æ˜¯å› ä¸ºé»˜è®¤å€¼ `GITHUB_TOKEN` æ²¡æœ‰æ“ä½œå—ä¿æŠ¤åˆ†æ”¯æ‰€éœ€çš„æƒé™ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä¸€ä¸ªåŒ…å« [ä¸ªäººè®¿é—®ä»¤ç‰Œ](https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line) æƒé™çš„ç§˜å¯† (**GH_TOKEN**) ã€‚ç¨åæˆ‘ä¼šå±•ç¤ºå¦‚ä½•ç”Ÿæˆä¸ªäººè®¿é—®ä»¤ç‰Œã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº† `fetch-depth: 0` ä»¥æå–æ‰€æœ‰åˆ†æ”¯å’Œæ ‡ç­¾çš„å…¨éƒ¨å†å²è®°å½•ã€‚

```py
with:
  ref: ${{ github.head_ref }}
  token: ${{ secrets.GH_TOKEN }}
  fetch-depth: 0
```

æˆ‘ä»¬ä»…å®‰è£… semantic-release å·¥å…·æ‰€éœ€çš„ä¾èµ–é¡¹ï¼š

```py
- name: Install requirements
  run: poetry install --only semver
```

åœ¨æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬æ›´æ”¹ä¸€äº› git é…ç½®å¹¶è¿è¡Œ semantic-release çš„å‘å¸ƒå‘½ä»¤ï¼š

```py
- name: Python Semantic Release
  env:
    GH_TOKEN: ${{ secrets.GH_TOKEN }}
  run: |
    set -o pipefail
    # Set git details
    git config --global user.name "github-actions"
    git config --global user.email "github-actions@github.com"
    # run semantic-release
    poetry run semantic-release publish -v DEBUG -D commit_author="github-actions <action@github.com>"
```

é€šè¿‡æ›´æ”¹ git é…ç½®ï¼Œæäº¤çš„ç”¨æˆ·å°†ä¼šæ˜¯â€œgithub-actionsâ€ã€‚æˆ‘ä»¬ä»¥ DEBUG æ—¥å¿—ï¼ˆstdoutï¼‰è¿è¡Œå‘å¸ƒå‘½ä»¤ï¼Œå¹¶æ˜¾å¼å°† `commit_author` è®¾ç½®ä¸ºâ€œgithub-actionsâ€ã€‚é™¤äº†è¿™ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ semantic-release çš„ GitHub actionï¼Œä½†è®¾ç½®æ­¥éª¤ [éå¸¸å°‘](https://github.com/relekang/python-semantic-release/blob/master/action.sh)ï¼Œä¸”è¯¥ action æ¯æ¬¡éƒ½éœ€è¦æ‹‰å– docker å®¹å™¨ã€‚å› æ­¤ï¼Œæˆ‘æ›´å€¾å‘äºé‡‡ç”¨ç®€å•çš„è¿è¡Œæ­¥éª¤ã€‚

å› ä¸ºå‘å¸ƒå‘½ä»¤ä¼šç”Ÿæˆæäº¤ï¼Œæ‚¨å¯èƒ½ä¼šæ‹…å¿ƒæˆ‘ä»¬ä¼šé™·å…¥è§¦å‘å·¥ä½œæµçš„æ— é™å¾ªç¯ã€‚ä½†è¯·æ”¾å¿ƒï¼Œç”Ÿæˆçš„æäº¤ä¸ä¼šè§¦å‘å¦ä¸€ä¸ª GitHub Actions å·¥ä½œæµè¿è¡Œã€‚è¿™æ˜¯ç”±äº [GitHub è®¾å®šçš„é™åˆ¶](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#using-the-github_token-in-a-workflow)ã€‚

# åˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆPATï¼‰

> ä¸ªäººè®¿é—®ä»¤ç‰Œæ˜¯ä½¿ç”¨å¯†ç è¿›è¡Œ GitHub Enterprise Server èº«ä»½éªŒè¯çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå½“ä½¿ç”¨ [GitHub API](https://docs.github.com/en/enterprise-server@3.4/rest/overview/other-authentication-methods#via-oauth-and-personal-access-tokens) æˆ– [å‘½ä»¤è¡Œ](https://docs.github.com/en/enterprise-server@3.4/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token#using-a-token-on-the-command-line) æ—¶ã€‚ä¸ªäººè®¿é—®ä»¤ç‰Œæ—¨åœ¨ä»£è¡¨æ‚¨è®¿é—® GitHub èµ„æºã€‚è¦ä»£è¡¨ç»„ç»‡è®¿é—®èµ„æºæˆ–ç”¨äºé•¿æœŸé›†æˆï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ GitHub åº”ç”¨ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§â€œ[å…³äºåº”ç”¨](https://docs.github.com/en/enterprise-server@3.4/developers/apps/getting-started-with-apps/about-apps)â€ã€‚

æ¢å¥è¯è¯´ï¼šæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª **P**ersonal **A**ccess **T**okenï¼Œå¹¶è®© GitHub Actions å­˜å‚¨å¹¶ä½¿ç”¨è¯¥ **secret** ä»£è¡¨æˆ‘ä»¬æ‰§è¡ŒæŸäº›æ“ä½œã€‚è¯·è®°ä½ï¼Œå¦‚æœ PAT è¢«æ³„éœ²ï¼Œå¯èƒ½ä¼šè¢«ç”¨äºå¯¹æ‚¨çš„ GitHub ä»“åº“æ‰§è¡Œæ¶æ„æ“ä½œã€‚å› æ­¤ï¼Œå»ºè®®åœ¨ç»„ç»‡ä¸­ä½¿ç”¨ GitHub OAuth åº”ç”¨å’Œ GitHub åº”ç”¨ã€‚ä¸ºäº†æœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ PAT å…è®¸ GitHub Actions æµæ°´çº¿ä»£è¡¨æˆ‘ä»¬æ“ä½œã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¼èˆªåˆ° GitHub ç”¨æˆ·çš„ `Settings` éƒ¨åˆ†å¹¶æŒ‰ç…§ [åˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œ](https://docs.github.com/en/enterprise-server@3.4/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token) ä¸­æ€»ç»“çš„è¯´æ˜æ¥åˆ›å»ºæ–°çš„è®¿é—®ä»¤ç‰Œã€‚è¿™å°†ç»™æˆ‘ä»¬ä¸€ä¸ªçœ‹èµ·æ¥åƒè¿™æ ·çš„çª—å£ï¼š

![](img/ebb37e91c7cf7a89d51bca5eedaadd3a.png)

å…·æœ‰æ¨é€è®¿é—®æƒé™çš„ç®¡ç†å‘˜å¸æˆ·çš„ä¸ªäººè®¿é—®ä»¤ç‰Œã€‚

é€šè¿‡é€‰æ‹©ä½œç”¨åŸŸï¼Œæˆ‘ä»¬å®šä¹‰ä»¤ç‰Œå°†å…·æœ‰çš„æƒé™ã€‚å¯¹äºæˆ‘ä»¬çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦ **push access** æƒé™ï¼Œå› æ­¤æ–°çš„ PAT `GH_TOKEN` åº”è¯¥å…·æœ‰ `repo` æƒé™ä½œç”¨åŸŸã€‚è¯¥ä½œç”¨åŸŸå°†æˆæƒå¯¹å—ä¿æŠ¤åˆ†æ”¯çš„æ¨é€ï¼Œå‰ææ˜¯æ‚¨æ²¡æœ‰åœ¨å—ä¿æŠ¤åˆ†æ”¯çš„è®¾ç½®ä¸­å¯ç”¨ *åŒ…æ‹¬ç®¡ç†å‘˜*ã€‚

å›åˆ°ä»£ç åº“æ¦‚è§ˆï¼Œåœ¨ **è®¾ç½®** èœå•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ **å¯†é’¥** éƒ¨åˆ†æ·»åŠ ç¯å¢ƒè®¾ç½®æˆ–åº“è®¾ç½®ï¼š

![](img/456cd350112cf1c5a3e7c5a198412418.png)

ä»“åº“å¯†é’¥ç‰¹å®šäºå•ä¸ªä»“åº“ï¼ˆåŠå…¶ä¸­ä½¿ç”¨çš„æ‰€æœ‰ç¯å¢ƒï¼‰ï¼Œè€Œç¯å¢ƒå¯†é’¥ç‰¹å®šäºç¯å¢ƒã€‚GitHub è¿è¡Œå™¨å¯ä»¥é…ç½®ä¸ºåœ¨ç‰¹å®šç¯å¢ƒä¸­è¿è¡Œï¼Œè¿™å…è®¸å®ƒè®¿é—®è¯¥ç¯å¢ƒçš„å¯†é’¥ã€‚è¿™åœ¨è€ƒè™‘ä¸åŒé˜¶æ®µï¼ˆä¾‹å¦‚ DEV ä¸ PRODï¼‰æ—¶æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘å¯¹**ä»“åº“å¯†é’¥**æ„Ÿåˆ°æ»¡æ„ã€‚

# GitHub Actions æµç¨‹

ç°åœ¨æˆ‘ä»¬æœ‰äº†å‡ ä¸ªç®¡é“ï¼ˆlintingã€testingã€releasingã€documentationï¼‰ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘ä¸»åˆ†æ”¯æäº¤çš„åŠ¨ä½œæµç¨‹ï¼æœ‰ä¸€äº›æˆ‘ä»¬éœ€è¦æ³¨æ„çš„äº‹é¡¹ï¼Œå…¶ä¸­ä¸€äº›æ˜¯ç‰¹å®šäº GitHub çš„ã€‚

ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸»åˆ†æ”¯çš„æäº¤åˆ›å»ºä¸€ä¸ªæ¨é€äº‹ä»¶ï¼Œä»è€Œè§¦å‘æµ‹è¯•å’Œ linting å·¥ä½œæµã€‚å¦‚æœè¿™äº›å·¥ä½œæµæˆåŠŸï¼Œæˆ‘ä»¬å°†è¿è¡Œå‘å¸ƒå·¥ä½œæµï¼Œè¯¥å·¥ä½œæµè´Ÿè´£åŸºäºä¼ ç»Ÿæäº¤æ£€æµ‹æ˜¯å¦éœ€è¦ç‰ˆæœ¬æå‡ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œå‘å¸ƒå·¥ä½œæµå°†ç›´æ¥æ¨é€åˆ°ä¸»åˆ†æ”¯ï¼Œæå‡ç‰ˆæœ¬ï¼Œæ·»åŠ  git æ ‡ç­¾å¹¶åˆ›å»ºå‘å¸ƒã€‚å‘å¸ƒçš„ç‰ˆæœ¬åº”å½“ä¾‹å¦‚é€šè¿‡è¿è¡Œæ–‡æ¡£å·¥ä½œæµæ¥æ›´æ–°æ–‡æ¡£ã€‚

![](img/d4523a1b24aa2afa5655c7adc014ffbf.png)

é¢„æœŸçš„åŠ¨ä½œæµç¨‹

## é—®é¢˜ä¸è€ƒè™‘

1.  å¦‚æœä½ ä»”ç»†é˜…è¯»ä¸Šä¸€æ®µæˆ–æŸ¥çœ‹ä¸Šé¢çš„æµç¨‹å›¾ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æœ‰ä¸¤ä¸ªä¸»åˆ†æ”¯çš„æäº¤ã€‚ä¸€ä¸ªæ˜¯åˆå§‹çš„ï¼ˆå³æ¥è‡ª PRï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ç”¨äºå‘å¸ƒçš„ã€‚ç”±äºæˆ‘ä»¬çš„*lint.yml*å’Œ*test.yml*åœ¨ä¸»åˆ†æ”¯çš„æ¨é€äº‹ä»¶ä¸‹ä¼šè§¦å‘ï¼Œå› æ­¤å®ƒä»¬ä¼šè¿è¡Œä¸¤æ¬¡ï¼ä¸ºäº†èŠ‚çœèµ„æºï¼Œæˆ‘ä»¬åº”è¯¥é¿å…ä¸¤æ¬¡è¿è¡Œã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç‰ˆæœ¬æäº¤æ¶ˆæ¯ä¸­æ·»åŠ `[skip ci]`å­—ç¬¦ä¸²ã€‚å¯ä»¥åœ¨*pyproject.toml*æ–‡ä»¶ä¸­ä¸ºå·¥å…·*semantic_release*å®šä¹‰è‡ªå®šä¹‰æäº¤æ¶ˆæ¯ã€‚

```py
# pyproject.toml

...

[tool.semantic_release]
...
commit_message = "{version} [skip ci]" # skip triggering ci pipelines for version commits
...
```

2\. å·¥ä½œæµ*pages.yml*å½“å‰åœ¨æ¨é€åˆ°ä¸»åˆ†æ”¯æ—¶è¿è¡Œã€‚æ›´æ–°æ–‡æ¡£å¯èƒ½åªæ˜¯æˆ‘ä»¬å¸Œæœ›åœ¨æœ‰æ–°ç‰ˆæœ¬å‘å¸ƒæ—¶åšçš„äº‹æƒ…ï¼ˆæˆ‘ä»¬å¯èƒ½ä¼šåœ¨æ–‡æ¡£ä¸­å¼•ç”¨ç‰ˆæœ¬ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ç›¸åº”åœ°æ›´æ”¹*pages.yml*æ–‡ä»¶ä¸­çš„è§¦å‘å™¨ï¼š

```py
# pages.yml

name: Documentation

on:
  release:
    types: [published]
```

ç°åœ¨ï¼Œæ„å»ºæ–‡æ¡£å°†éœ€è¦**å·²å‘å¸ƒçš„ç‰ˆæœ¬**ã€‚

3\. å‘å¸ƒå·¥ä½œæµåº”è¯¥ä¾èµ–äº linting å’Œ testing å·¥ä½œæµçš„æˆåŠŸã€‚ç›®å‰ï¼Œæˆ‘ä»¬åœ¨å·¥ä½œæµæ–‡ä»¶ä¸­æ²¡æœ‰å®šä¹‰ä¾èµ–å…³ç³»ã€‚æˆ‘ä»¬å¯ä»¥è®©è¿™äº›å·¥ä½œæµä¾èµ–äºç‰¹å®šåˆ†æ”¯ä¸Šå®šä¹‰çš„å·¥ä½œæµè¿è¡Œçš„å®Œæˆï¼Œä½¿ç”¨`[workflow_run](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow_run)`äº‹ä»¶ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬ä¸º`workflow_run`äº‹ä»¶æŒ‡å®šå¤šä¸ª`workflows`ï¼š

```py
on:
  workflow_run:
    workflows: [Testing, Linting]
    types:
    - completed
    branches:
    - main
```

ä»…ä¸€ä¸ªå·¥ä½œæµéœ€è¦å®Œæˆï¼è¿™ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚æˆ‘ä»¬æœŸæœ›æ‰€æœ‰**å·¥ä½œæµ**éƒ½å¿…é¡»å®Œæˆï¼ˆå¹¶æˆåŠŸï¼‰ã€‚åªæœ‰åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‘å¸ƒå·¥ä½œæµæ‰åº”è¿è¡Œã€‚è¿™ä¸åœ¨å•ä¸ªå·¥ä½œæµä¸­å®šä¹‰**ä½œä¸š**ä¹‹é—´çš„ä¾èµ–å…³ç³»æ—¶å¾—åˆ°çš„ç»“æœç›¸åã€‚æ›´å¤šå…³äºè¿™ç§ä¸ä¸€è‡´å’Œä¸è¶³çš„å†…å®¹ï¼Œè¯·é˜…è¯»[è¿™é‡Œ](https://github.com/community/community/discussions/16059)ã€‚

ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµæ°´çº¿çš„é¡ºåºæ‰§è¡Œï¼š

![](img/88bfe140d76fef3bfe6c8622c2cd4e07.png)

è¿™ç§æƒ³æ³•çš„ä¸€ä¸ªå¤§ç¼ºç‚¹æ˜¯å®ƒ **a)** ä¸å…è®¸å¹¶è¡Œæ‰§è¡Œå’Œ **b)** æˆ‘ä»¬å°†æ— æ³•åœ¨ GitHub ä¸­æŸ¥çœ‹ä¾èµ–å›¾ã€‚

## è§£å†³æ–¹æ¡ˆ

ç›®å‰ï¼Œæˆ‘è®¤ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜çš„å”¯ä¸€æ–¹æ³•æ˜¯å°†å·¥ä½œæµåœ¨ä¸€ä¸ªåè°ƒå™¨å·¥ä½œæµä¸­è¿›è¡Œåè°ƒã€‚

![](img/591405e03e0593cd5fde44296b4d6f2b.png)

è®©æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªå·¥ä½œæµæ–‡ä»¶ï¼š

å½“æˆ‘ä»¬æ¨é€åˆ° `main` åˆ†æ”¯æ—¶ï¼Œåè°ƒå™¨è¢«è§¦å‘ã€‚

![](img/958201b9b29998674fbb7a9c2a87526c.png)

åªæœ‰åœ¨ä¸¤ä¸ªå·¥ä½œæµï¼šTesting å’Œ Linting éƒ½æˆåŠŸæ—¶ï¼Œæ‰ä¼šè°ƒç”¨å‘å¸ƒå·¥ä½œæµã€‚è¿™åœ¨ `needs` å…³é”®å­—ä¸­å®šä¹‰ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›å¯¹ä½œä¸šæ‰§è¡Œï¼ˆå·¥ä½œæµï¼‰æœ‰æ›´ç»†è‡´çš„æ§åˆ¶ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ `if` å…³é”®å­—ã€‚ä½†è¦æ³¨æ„ï¼Œå¦‚ [è¿™ç¯‡æ–‡ç« ](https://samanpavel.medium.com/github-actions-conditional-job-execution-e6aa363d2867) æ‰€è¿°çš„*ä»¤äººå›°æƒ‘*è¡Œä¸ºã€‚

ä¸ºäº†ä½¿æˆ‘ä»¬çš„å·¥ä½œæµ `lint.yml`ã€`test.yml` å’Œ `release.yml` å¯ä»¥è¢«å¦ä¸€ä¸ªå·¥ä½œæµè°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°è§¦å‘å™¨ï¼š

```py
# lint.yml

---
name: Linting

on:
  pull_request:
    branches:
      - main
  workflow_call:

jobs:
...
```

```py
# test.yml

---
name: Testing

on:
  pull_request:
    branches:
      - main
  workflow_call:

jobs:
...
```

```py
# release.yml

---
name: Release

on:
  workflow_call:

jobs:
...
```

ç°åœ¨ï¼Œæ–°å·¥ä½œæµï¼ˆReleaseï¼‰åº”è¯¥ä»…åœ¨è´¨é‡æ£€æŸ¥å·¥ä½œæµæˆåŠŸçš„æƒ…å†µä¸‹è¿è¡Œï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯ linting å’Œ testingã€‚

# å¾½ç« 

è¦åˆ›å»ºå¾½ç« ï¼Œè¿™æ¬¡æˆ‘å°†ä½¿ç”¨å¹³å° [shields.io](https://shields.io/)ã€‚

è¿™æ˜¯ä¸€ä¸ªä¸ºé¡¹ç›®ç”Ÿæˆå¾½ç« çš„ç½‘ç«™ï¼Œå¾½ç« æ˜¾ç¤ºè¯¸å¦‚ç‰ˆæœ¬ã€æ„å»ºçŠ¶æ€å’Œä»£ç è¦†ç›–ç‡ç­‰ä¿¡æ¯ã€‚å®ƒæä¾›äº†å¹¿æ³›çš„æ¨¡æ¿ï¼Œå¹¶å…è®¸å®šåˆ¶å¤–è§‚å’Œåˆ›å»ºè‡ªå®šä¹‰å¾½ç« ã€‚å¾½ç« ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œæä¾›é¡¹ç›®çš„å®æ—¶ä¿¡æ¯ã€‚

å¯¹äºå‘å¸ƒå¾½ç« ï¼Œæˆ‘é€‰æ‹©äº† `GitHub release (latest SemVer)`ï¼š

![](img/530966bfab9ec5c4435c88aaebcce731.png)

å¾½ç« çš„ Markdown å¯ä»¥å¤åˆ¶å¹¶æ·»åŠ åˆ° *README.md* ä¸­ï¼š

æˆ‘ä»¬çš„ GitHub ç™»å½•é¡µé¢ç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ â¤ï¼ˆæˆ‘ç¨å¾®æ•´ç†äº†ä¸€ä¸‹ï¼Œå¹¶æä¾›äº†æè¿°ï¼‰ï¼š

![](img/03ce33d4b73c88fa3a45a80fa85f104d.png)

æ­å–œï¼ä½ å·²ç»å®Œæˆäº†æœ¬æ•™ç¨‹çš„ä¸»è¦éƒ¨åˆ†ï¼ä½ å·²ç»å­¦ä¹ äº†ç®¡ç† **è½¯ä»¶å‘å¸ƒ** çš„åŸºæœ¬æ­¥éª¤ã€‚æˆ‘ä»¬é¦–å…ˆæ‰‹åŠ¨åˆ›å»ºäº†ä¸€ä¸ªå‘å¸ƒï¼Œç„¶ååˆ©ç”¨ **Conventional Commits** çš„åŠ›é‡ï¼Œé€šè¿‡ **CI pipeline** è‡ªåŠ¨åŒ–æˆ‘ä»¬çš„å‘å¸ƒè¿‡ç¨‹ï¼Œå¤„ç†ç‰ˆæœ¬æ§åˆ¶ã€‚æœ€åï¼Œæˆ‘ä»¬åœ¨ README.md æ–‡ä»¶ä¸­æ·»åŠ äº† **å¾½ç« **ï¼Œä¸ºç”¨æˆ·æä¾›äº†é¡¹ç›®æœ€æ–°ç‰ˆæœ¬çš„æ¸…æ™°è€Œç®€æ´çš„æ˜¾ç¤ºã€‚æŒæ¡äº†è¿™äº›æŠ€å·§ï¼Œä½ å°†èƒ½å¤Ÿé«˜æ•ˆè€Œæœ‰æ•ˆåœ°ç®¡ç†ä½ çš„è½¯ä»¶å‘å¸ƒã€‚

ä¸‹ä¸€éƒ¨åˆ†å°†æ˜¯æœ€åä¸€éƒ¨åˆ†ï¼Œæ¶µç›–ï¼š**å®¹å™¨åŒ–**ï¼

[](https://johschmidt42.medium.com/membership?source=post_page-----206df3c1e3d3--------------------------------) [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Medium - Johannes Schmidt

### é˜…è¯» Johannes Schmidt çš„æ¯ä¸€ç¯‡æ•…äº‹ï¼ˆä»¥åŠ Medium ä¸Šå…¶ä»–æ•°åƒåä½œè€…çš„æ•…äº‹ï¼‰ã€‚æ‚¨çš„ä¼šå‘˜è´¹ç›´æ¥â€¦

[johschmidt42.medium.com](https://johschmidt42.medium.com/membership?source=post_page-----206df3c1e3d3--------------------------------)

# å¥–åŠ±

## ç¡®ä¿ä½¿ç”¨è§„èŒƒæäº¤

æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼ŒæŒ‰ç…§å®šä¹‰æ ¼å¼çš„æäº¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚åœ¨ä¸€ä¸ªåä½œé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›å¯¹æ‰€æœ‰æäº¤åˆ°é»˜è®¤åˆ†æ”¯çš„æäº¤å¼ºåˆ¶æ‰§è¡Œè¿™ç§æ ¼å¼ã€‚ä¸¤ä¸ªæµè¡Œçš„å·¥å…·å¯ä»¥å¸®åŠ©å¼€å‘è€…éµå¾ªè§„èŒƒæäº¤æ ¼å¼ï¼š

+   [commitizen](https://github.com/commitizen/cz-cli)

+   [commitlint](https://github.com/conventional-changelog/commitlint)

ç„¶è€Œï¼Œä¸€äº›å¼€å‘è€…è§‰å¾—è¿™äº›å·¥å…·æœ‰ç‚¹é™åˆ¶æ€§ï¼Œå› æ­¤é¿å…ä½¿ç”¨å®ƒä»¬*ã€‚æ‰€ä»¥ä»…ä»…å¸Œæœ›æ€»æ˜¯æœ‰è§„èŒƒæäº¤å¯èƒ½ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å› æ­¤ï¼Œåœ¨æœåŠ¡å™¨ç«¯å¼ºåˆ¶æ‰§è¡Œè§„åˆ™ï¼Œå¦‚è§„èŒƒæäº¤æ ¼å¼ï¼Œæ‰æ˜¯æ˜æ™ºçš„ï¼

**åŒæ ·é€‚ç”¨äº* [*pre-commit*](https://pre-commit.com/) *é’©å­ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘åœ¨è¿™ä¸€ç³»åˆ—ä¸­æ’é™¤å®ƒä»¬çš„åŸå› ã€‚*

ä¸å¹¸çš„æ˜¯ï¼Œç›®å‰ï¼ˆ2023 å¹´ 5 æœˆï¼‰åœ¨ GitHub ä¸ŠåŸºäºè§„åˆ™é˜»æ­¢æäº¤ä»ç„¶ä¸å¯è¡Œï¼Œå› ä¸º [è¯¥åŠŸèƒ½ä»åœ¨å¼€å‘ä¸­](https://github.com/github/roadmap/issues/476)ã€‚ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡**åˆ†æ”¯ä¿æŠ¤è§„åˆ™**å’Œ**CI å·¥ä½œæµ**å°½å¯èƒ½æ¥è¿‘è¿™ä¸ªç›®æ ‡ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨ä»“åº“ä¸­éœ€è¦çš„ç­–ç•¥ï¼š

+   å¯¹å—ä¿æŠ¤çš„é»˜è®¤åˆ†æ”¯ï¼ˆä¾‹å¦‚ mainï¼‰çš„æäº¤åº”è¯¥é™åˆ¶ä¸º**æ‹‰å–è¯·æ±‚**ï¼ˆPRï¼‰æäº¤ã€‚

+   åªæœ‰ [å‹ç¼©æäº¤](https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges/configuring-commit-squashing-for-pull-requests) åº”è¯¥è¢«å…è®¸*ã€‚

+   åˆå¹¶æ‹‰å–è¯·æ±‚æ—¶å±•ç¤ºçš„**é»˜è®¤æäº¤ä¿¡æ¯**åº”è¯¥æ˜¯**æ‹‰å–è¯·æ±‚** **æ ‡é¢˜**ã€‚

å¦‚æœå¯¹**å—ä¿æŠ¤**çš„é»˜è®¤åˆ†æ”¯ï¼ˆä¾‹å¦‚ mainï¼‰çš„å”¯ä¸€æäº¤æ–¹å¼æ˜¯é€šè¿‡æ‹‰å–è¯·æ±‚ï¼ˆ[å‹ç¼©æäº¤](https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges/configuring-commit-squashing-for-pull-requests) ä»…é™ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ GitHub Actionï¼Œå¦‚ [amannn/action-semantic-pull-request](https://github.com/amannn/action-semantic-pull-request)ï¼Œç¡®ä¿æ‹‰å–è¯·æ±‚çš„æ ‡é¢˜ç¬¦åˆ [è§„èŒƒæäº¤è§„èŒƒ](https://www.conventionalcommits.org/)ã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬ `squash and merge` PR åˆ†æ”¯ï¼ˆå‡è®¾æ‰€æœ‰å¿…éœ€çš„æµæ°´çº¿æˆåŠŸï¼‰æ—¶ï¼Œå»ºè®®çš„æäº¤ä¿¡æ¯å°±æ˜¯ PR æ ‡é¢˜ï¼Œè¯¥æ ‡é¢˜ä¹‹å‰ç”± GitHub action è¿è¡Œæ£€æŸ¥è¿‡ã€‚

**Squash and merge ç­–ç•¥æ˜¯ä¸€ç§æµè¡Œçš„ä»£ç åˆå¹¶æ–¹æ³•ï¼Œå®ƒå°†åŠŸèƒ½åˆ†æ”¯ä¸­çš„å¤šä¸ªæäº¤åˆå¹¶ä¸ºä¸€ä¸ªæäº¤ã€‚è¿™ç§æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªçº¿æ€§çš„ã€ä¸€è‡´çš„ git å†å²è®°å½•ï¼Œå…¶ä¸­æ¯ä¸ªæäº¤ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„æ›´æ”¹ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•ä¹Ÿæœ‰å…¶ç¼ºç‚¹ï¼Œå› ä¸ºå®ƒä¸¢å¼ƒäº†è¯¦ç»†çš„æäº¤å†å²è®°å½•ï¼Œè¿™å¯¹äºç†è§£å¼€å‘è¿‡ç¨‹æ˜¯æœ‰ä»·å€¼çš„ã€‚è™½ç„¶å¯ä»¥ä½¿ç”¨ rebase åˆå¹¶æ¥ä¿ç•™è¿™äº›ä¿¡æ¯ï¼Œä½†è¿™å¯èƒ½ä¼šç»™å·¥ä½œæµå¸¦æ¥å¤æ‚æ€§ã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œsquash and merge ç­–ç•¥å› å…¶ç®€å•æ€§è€Œå—åˆ°é’çã€‚*

## å·¥ä½œæµ

è®©æˆ‘ä»¬ä¸ºè¿™ä¸ªç­–ç•¥åˆ›å»º GitHub Actions å·¥ä½œæµï¼š

**è§¦å‘äº‹ä»¶** `pull_request_target` çš„è§£é‡Šè§ [è¿™é‡Œ](https://github.com/amannn/action-semantic-pull-request#event-triggers)ã€‚æˆ‘ä½¿ç”¨äº†å»ºè®®çš„ç±»å‹ `opened` ã€`edited` ã€`synchronize` ã€‚`GITHUB_TOKEN` è¢«ä½œä¸º `env` ä¼ é€’ç»™ actionã€‚å› æ­¤ï¼Œæ¯å½“ PR çš„æ ‡é¢˜å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç®¡é“å°±ä¼šè§¦å‘ã€‚åªæœ‰å½“ PR çš„æ ‡é¢˜ç¬¦åˆçº¦å®šçš„æäº¤æ ¼å¼æ—¶ï¼Œç®¡é“æ‰ä¼šæˆåŠŸã€‚

è¯·æ³¨æ„

> ä½ éœ€è¦åœ¨ä¸»åˆ†æ”¯ä¸­æ‹¥æœ‰æ­¤é…ç½®ï¼Œä»¥ä¾¿ action èƒ½å¤Ÿè¿è¡Œï¼ˆä¾‹å¦‚ï¼Œå®ƒä¸ä¼šåœ¨åˆæ¬¡æ·»åŠ  action çš„ PR ä¸­è¿è¡Œï¼‰ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ åœ¨ PR ä¸­æ›´æ”¹é…ç½®ï¼Œå½“å‰ PR ä¸­çš„æ›´æ”¹å°†ä¸ä¼šè¢«åæ˜  â€”â€” åªæœ‰åœ¨æ›´æ”¹è¢«åˆå¹¶åˆ°ä¸»åˆ†æ”¯åï¼Œéšåçš„ PR æ‰ä¼šåæ˜ è¿™äº›æ›´æ”¹ã€‚

æ‰€ä»¥æˆ‘ä»¬å¿…é¡»é¦–å…ˆåœ¨é»˜è®¤åˆ†æ”¯ `main` ä¸­æ‹¥æœ‰è¿™ä¸ªå·¥ä½œæµï¼Œåªæœ‰è¿™æ ·æˆ‘ä»¬æ‰èƒ½çœ‹åˆ°å®ƒçš„å®é™…æ•ˆæœã€‚

## åˆ†æ”¯ä¿æŠ¤è§„åˆ™

æ¥ä¸‹æ¥ï¼Œåœ¨ GitHub ä»“åº“çš„ *è®¾ç½®* éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º *main* åˆ†æ”¯åˆ›å»ºä¸€ä¸ª **åˆ†æ”¯ä¿æŠ¤è§„åˆ™**ï¼š

![](img/e0aa5515ece7b094d0198da1bbe2a40d.png)

ä¸»è¦åˆ†æ”¯çš„åˆ†æ”¯ä¿æŠ¤è§„åˆ™ â€” ä½œè€…æä¾›çš„å›¾ç‰‡

ç°åœ¨ä¸€ä¸ªæäº¤éœ€è¦ä¸€ä¸ªé€šè¿‡çŠ¶æ€æ£€æŸ¥ï¼ˆå¿…éœ€å·¥ä½œæµï¼‰çš„ PR æ‰èƒ½åˆå¹¶*ã€‚

> ä¸€ä¸ª [å¿…éœ€çš„å·¥ä½œæµ](https://docs.github.com/en/actions/using-workflows/required-workflows) ç”±æ‹‰å–è¯·æ±‚äº‹ä»¶è§¦å‘ï¼Œå¹¶ä½œä¸ºå¿…éœ€çš„çŠ¶æ€æ£€æŸ¥å‡ºç°ï¼Œè¿™ä¼šé˜»æ­¢åˆå¹¶æ‹‰å–è¯·æ±‚ï¼Œç›´åˆ°å¿…éœ€çš„å·¥ä½œæµæˆåŠŸã€‚

![](img/5ca948e901b844e9bae4e91b52018506.png)

æ‰€éœ€å·¥ä½œæµ â€” ä½œè€…æä¾›çš„å›¾ç‰‡

ç»„ç»‡æ‰€æœ‰è€…æœ‰èƒ½åŠ›åœ¨å…¶ç»„ç»‡å†…å¼ºåˆ¶æ‰§è¡Œç‰¹å®šçš„å·¥ä½œæµï¼Œä¾‹å¦‚è¦æ±‚å¯¹æ‹‰å–è¯·æ±‚è¿›è¡ŒçŠ¶æ€æ£€æŸ¥ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªåŠŸèƒ½ä»…å¯¹ç»„ç»‡å¯ç”¨ï¼Œä¸ªäººè´¦æˆ·æ— æ³•æ¿€æ´»ï¼Œå› æ­¤æ— æ³•é˜»æ­¢åˆå¹¶ã€‚

**è¯·æ³¨æ„ï¼Œè§„åˆ™ä¸ä¼šåœ¨ç§æœ‰ä»“åº“ä¸­ç”Ÿæ•ˆï¼Œç›´åˆ°å®ƒè¢«* [*è¿ç§»åˆ° GitHub Team æˆ– Enterprise ç»„ç»‡è´¦æˆ·*](https://github.com/move_work/new)*ï¼*

## Squash & merge ç­–ç•¥

æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é…ç½® PR é€‰é¡¹ï¼Œä»¥ä¾¿åœ¨é€‰æ‹© squash and merge æŒ‰é’®æ—¶ä½¿ç”¨ PR çš„æ ‡é¢˜ä½œä¸ºé»˜è®¤æäº¤æ¶ˆæ¯ï¼š

![](img/3017b59691e8c5f4d4327784972535c0.png)

é»˜è®¤çš„æäº¤æ¶ˆæ¯åœ¨â€œå‹ç¼©å’Œåˆå¹¶â€æ—¶ â€” å›¾ç‰‡ç”±ä½œè€…æä¾›

è¿™æ ·ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„çª—å£ï¼š

![](img/fe2a3f501d7814b92691932795f1f9a9.png)

åœ¨ PR ä¸­çš„â€œå‹ç¼©å’Œåˆå¹¶â€å¯¹è¯æ¡† â€” å›¾ç‰‡ç”±ä½œè€…æä¾›

*è¯·æ³¨æ„ï¼Œå¼€å‘è€…å¯èƒ½ä¼šåœ¨åˆå¹¶è¿‡ç¨‹ä¸­æ›´æ”¹æ ‡é¢˜åç§°ï¼Œè¿™å°†ç»•è¿‡ç­–ç•¥ï¼*

å°½ç®¡æˆ‘ä»¬è¿˜ä¸èƒ½å®Œå…¨ç¡®ä¿åœ¨ GitHub ä¸Šä½¿ç”¨ä¼ ç»Ÿçš„æäº¤æ–¹å¼ï¼Œä½†æˆ‘ä»¬åº”å°½é‡åšåˆ°å°½å¯èƒ½æ¥è¿‘ã€‚
