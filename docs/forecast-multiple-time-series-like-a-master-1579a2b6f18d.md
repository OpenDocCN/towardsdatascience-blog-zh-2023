# åƒå¤§å¸ˆä¸€æ ·é¢„æµ‹å¤šä¸ªæ—¶é—´åºåˆ—

> åŸæ–‡ï¼š[`towardsdatascience.com/forecast-multiple-time-series-like-a-master-1579a2b6f18d`](https://towardsdatascience.com/forecast-multiple-time-series-like-a-master-1579a2b6f18d)

## ä»å±€éƒ¨åˆ°å…¨å±€ç®—æ³•

[](https://medium.com/@zukaschikume?source=post_page-----1579a2b6f18d--------------------------------)![Bartosz SzabÅ‚owski](https://medium.com/@zukaschikume?source=post_page-----1579a2b6f18d--------------------------------)[](https://towardsdatascience.com/?source=post_page-----1579a2b6f18d--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----1579a2b6f18d--------------------------------) [Bartosz SzabÅ‚owski](https://medium.com/@zukaschikume?source=post_page-----1579a2b6f18d--------------------------------)

Â·å‘è¡¨äº[Towards Data Science](https://towardsdatascience.com/?source=post_page-----1579a2b6f18d--------------------------------) Â·é˜…è¯»æ—¶é—´ 30 åˆ†é’ŸÂ·2023 å¹´ 4 æœˆ 26 æ—¥

--

![](img/3393fc3c8c56dbacebe783c486b2d2e7.png)

å›¾ç‰‡æ¥æºï¼š[JesÃºs Rocha](https://unsplash.com/@jjrocha?utm_source=medium&utm_medium=referral) äº[Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

æˆ‘åœ¨å•†ä¸šä¸­å¤„ç†å¤šä¸ªæ—¶é—´åºåˆ—çš„é¢„æµ‹ï¼ˆå‡†ç¡®æ¥è¯´ï¼Œæ˜¯éœ€æ±‚é¢„æµ‹ï¼‰ã€‚åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç« ä¸­[*Sell Out Sell In Forecasting*](https://medium.com/towards-data-science/sell-out-sell-in-forecasting-45637005d6ee)ï¼Œæˆ‘ä»‹ç»äº†æˆ‘åœ¨é›€å·¢å®æ–½çš„éœ€æ±‚é¢„æµ‹æ–¹æ³•ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³å‘ä½ ä»‹ç»ç›®å‰ç”¨äºé¢„æµ‹å¤šä¸ªæ—¶é—´åºåˆ—çš„é€šç”¨ï¼ˆè¿™å¹¶ä¸æ„å‘³ç€ç†æƒ³ï¼‰ç®—æ³•â€”â€”ä¾‹å¦‚**æœ€å…ˆè¿›**çš„æ—¶é—´åºåˆ—ç®—æ³•ã€‚å¯¹äºé›¶å”®å•†æˆ–åˆ¶é€ å•†æ¥è¯´ï¼Œé¢„æµ‹éœ€æ±‚å¯¹ä¸šåŠ¡è‡³å…³é‡è¦ã€‚å®ƒå…è®¸ä»–ä»¬åˆ¶å®šæ›´å‡†ç¡®çš„ç”Ÿäº§è®¡åˆ’å¹¶ä¼˜åŒ–åº“å­˜ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè®¸å¤šå…¬å¸ï¼ˆå¹¶éé›€å·¢ :) ï¼‰å¹¶æœªæ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ï¼Œä»–ä»¬ä»ç„¶ä½¿ç”¨ç®€å•ç»Ÿè®¡çš„ç”µå­è¡¨æ ¼ã€‚å¦‚æœä»–ä»¬èƒ½æ”¹å˜è¿™ç§æƒ…å†µï¼Œä»–ä»¬å¯ä»¥æ˜¾è‘—é™ä½æˆæœ¬ã€‚æ¯•ç«Ÿï¼Œä»“å‚¨å’Œè¿‡æ—¶äº§å“â€”â€”è¿™ä¹Ÿæ˜¯é¢å¤–çš„æˆæœ¬ã€‚

![](img/6b8f08996d06912402198087dc3b5e19.png)

å¦‚ä½•é¢„æµ‹å¤šä¸ªæ—¶é—´åºåˆ—ï¼Œä½œè€…æä¾›çš„å›¾ç‰‡

å¾ˆéš¾æ‰¾åˆ°ä¸€ä¸ªæ•°æ®ç§‘å­¦é¢†åŸŸçš„äººä¸ç†Ÿæ‚‰[**Scikit-learn**](https://scikit-learn.org/)ã€‚å¯¹äºæ•°æ®æ¡†æ¶ï¼Œä½ å¯ä»¥ä½¿ç”¨**Scikit-learn**æ¥å®Œæˆæœºå™¨å­¦ä¹ ä¸­æ¶‰åŠçš„å¤§éƒ¨åˆ†å…ƒç´ â€”â€”ä»é¢„å¤„ç†åˆ°è¶…å‚æ•°é€‰æ‹©ã€è¯„ä¼°å’Œæ¨¡å‹é¢„æµ‹ã€‚æˆ‘ä»¬å¯ä»¥å°†çº¿æ€§å›å½’ã€å†³ç­–æ ‘æˆ–æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰åˆ†é…ç»™å˜é‡*model*ï¼Œå¹¶æ¯æ¬¡ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œå¦‚*fit*å’Œ*predict*ã€‚æˆ‘ä»¬æœ‰å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿæœ‰ä¸€ç§ç®€å•çš„æ–¹å¼æ¥å®ç°è§£å†³æ–¹æ¡ˆã€‚

å¯¹äºæ—¶é—´åºåˆ—æ¥è¯´ï¼Œæƒ…å†µæ˜¯ä¸åŒçš„ã€‚å¦‚æœä½ åœ¨å®éªŒå¹¶æƒ³æ¯”è¾ƒä¸åŒçš„ç®—æ³•ï¼Œç®—æ³•æœ¬èº«ä¸ä»…ä»…æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚

å¦‚æœä½ å¼€å§‹å¤„ç†æ—¶é—´åºåˆ—ï¼Œä½ éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚é‡æ–°é‡‡æ ·æˆ–å¡«è¡¥ç¼ºå¤±å€¼â€”â€”[**Pandas**](https://pandas.pydata.org/)å¯¹æ­¤éå¸¸æœ‰ç”¨ã€‚

å¦‚æœä½ æƒ³è¿›è¡Œåˆ†è§£ã€å¯è§†åŒ– ACF/PACFï¼Œæˆ–æ£€æŸ¥å¹³ç¨³æ€§æµ‹è¯•ï¼Œé‚£ä¹ˆ[**Statsmodels**](https://www.statsmodels.org/)åº“å°†éå¸¸æœ‰ç”¨ã€‚

å¯¹äºå¯è§†åŒ–ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨[**Matplotlib**](https://matplotlib.org/)ï¼Œå³ä½¿ä¸æ˜¯è¿™ä¸ªåº“ï¼Œä¹Ÿæœ‰è®¸å¤šå»ºç«‹åœ¨å®ƒä¹‹ä¸Šçš„åº“ã€‚

å½“ä½ æƒ³ä½¿ç”¨ä¸åŒçš„ç®—æ³•æ—¶ï¼Œä¹è¶£æ‰å¼€å§‹ã€‚å½“ä½ æƒ³ä½¿ç”¨**ARIMA**æ—¶ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨[**pmdarima**](https://alkaline-ml.com/pmdarima)ï¼Œ[**Prophet**](https://facebook.github.io/prophet/)æ˜¯å¦ä¸€ä¸ªåº“ã€‚å…¸å‹çš„**M**achine **L**earning ç®—æ³•å¯ä»¥åœ¨ä¹‹å‰æåˆ°çš„**Scikit-learn**ä¸­æ‰¾åˆ°ï¼Œä½†ä½ ä¹Ÿå¯èƒ½æƒ³ä½¿ç”¨åƒ[**LightGBM**](https://lightgbm.readthedocs.io/)æˆ–[**CatBoost**](https://catboost.ai/)è¿™æ ·çš„æå‡æ¨¡å‹ã€‚å¯¹äº**D**eep **N**eural **N**etworks å’Œæœ€æ–°è®ºæ–‡ä¸­çš„æ¶æ„ï¼Œ[**PyTorch Forecasting**](https://pytorch-forecasting.readthedocs.io/)å€¼å¾—ä½¿ç”¨ã€‚

WOWğŸ¤¯ ä½ å¯èƒ½éœ€è¦çš„åº“éå¸¸å¤šã€‚å¦‚æœä½ æƒ³èƒ½å¤Ÿä½¿ç”¨ä¸Šè¿°æåˆ°çš„åº“ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå¤§é‡çš„å·¥ä½œï¼Œå› ä¸ºå¤§å¤šæ•°åº“ä½¿ç”¨ä¸åŒçš„ APIã€æ•°æ®ç±»å‹ï¼Œå¹¶ä¸”å¯¹äºæ¯ä¸ªåº“ä¸­çš„æ¨¡å‹ï¼Œä½ éƒ½å¿…é¡»å‡†å¤‡è‡ªå·±çš„å›æµ‹å’Œè¶…å‚æ•°é€‰æ‹©å‡½æ•°ã€‚

![](img/bd03ac32b8e2a4f05d9177ceaf14df14.png)

Library Dartsï¼Œç”±ä½œè€…æä¾›çš„å›¾ç‰‡ï¼Œçµæ„Ÿæ¥è‡ªäºå›¾ä¹¦é¦†æ–‡æ¡£

è¿™é‡Œæˆ‘ä»¬å¾—åˆ°å¸®åŠ©çš„æ˜¯[**Darts**](https://unit8co.github.io/darts/)ï¼Œå®ƒè¯•å›¾æˆä¸ºæ—¶é—´åºåˆ—çš„**Scikit-learn**ï¼Œå…¶ç›®çš„æ˜¯ç®€åŒ–æ—¶é—´åºåˆ—çš„å·¥ä½œã€‚å®ƒçš„åŠŸèƒ½é€šå¸¸åŸºäºå…¶ä»–åº“ï¼Œä¾‹å¦‚ï¼Œå®ƒä½¿ç”¨**Statsmodels**è¿›è¡Œåˆ†è§£ã€‚å¦‚æœæŸäº›åŠŸèƒ½åœ¨å…¶ä»–åº“ä¸­æ²¡æœ‰å®ç°ï¼Œ**Darts**ä¹Ÿèƒ½å¾ˆå¥½åœ°ä¸å…¶ä»–åº“åä½œï¼Œä½ å¯ä»¥å°†å…¶ä¸**Matplotlib**å’Œ**Seaborn**äº’ç›¸é…åˆä½¿ç”¨è¿›è¡Œæ¯”è¾ƒã€‚

åœ¨å¿…è¦çš„åœ°æ–¹ï¼Œå®ƒä»¬æœ‰è‡ªå·±çš„å®ç°ï¼Œä½†å®ƒä»¬ä¸æƒ³é‡æ–°å‘æ˜è½®å­ï¼Œè€Œæ˜¯ä½¿ç”¨å…¶ä»–æµè¡Œæ—¶é—´åºåˆ—åº“ä¸­å·²ç»å­˜åœ¨çš„ä¸œè¥¿ã€‚

è¿™ä¸€æ¦‚å¿µåœ¨æ—¶é—´åºåˆ—é¢†åŸŸå¹¶ä¸æ–°é²œï¼Œè¿˜æœ‰å…¶ä»–å¾ˆå¥½çš„åº“ï¼Œä¾‹å¦‚[**sktime**](https://www.sktime.org/)ã€[**GluonTS**](https://ts.gluon.ai/)æˆ–[**nixtla**](https://www.nixtla.io/)ï¼Œä½†åœ¨æˆ‘çœ‹æ¥ï¼Œ**Darts**çš„å…¥é—¨é—¨æ§›æœ€ä½ï¼ŒåŠŸèƒ½ä¹Ÿæ›´ä¸ºå®Œå–„ã€‚è¿™ä¸æ˜¯å¯¹è¿™ä¸ªåº“çš„å¹¿å‘Šï¼Œå½’æ ¹ç»“åº•ï¼Œä½ çš„é¢„æµ‹åº”è¯¥ä¸ºä½ å·¥ä½œçš„ä¼ä¸šå¸¦æ¥ä»·å€¼ã€‚ä½ ä¹Ÿå¯ä»¥ä»å¤´å¼€å§‹ç”¨ä»£ç ç¼–å†™è¿™äº›æ¨¡å‹ã€‚æˆ‘å°†ä½¿ç”¨ Darts è¿›è¡Œä»¥ä¸‹ç¤ºä¾‹ï¼Œä½†ä½ ä¹Ÿå¯ä»¥åœ¨ä¸Šè¿°æåˆ°çš„åº“ä¸­æ‰¾åˆ°è¿™äº›æ¨¡å‹ï¼ˆå…¨éƒ¨æˆ–éƒ¨åˆ†ï¼‰ã€‚å¦‚æœæˆ‘ä»¬æƒ³è®­ç»ƒå¤šä¸ªæœ¬åœ°æ¨¡å‹ï¼Œæˆ‘è®¤ä¸º Darts åº“åœ¨**ä¼˜åŒ–è®¡ç®—**æ–¹é¢è¿˜æœ‰æ”¹è¿›çš„ç©ºé—´â€”â€”å¯ä»¥å°è¯•**nixtla**åº“ï¼Œå®ƒæä¾›ä¸ Sparkã€Dask å’Œ Ray çš„å…¼å®¹æ€§ã€‚

ä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼ŒDarts å·²ç»æ˜¯ä¸€ä¸ªæˆç†Ÿçš„åº“ï¼Œå¹¶ä¸”ä»åœ¨ä¸æ–­å¼€å‘ä¸­ï¼Œåªéœ€æŸ¥çœ‹[**å˜æ›´æ—¥å¿—**](https://github.com/unit8co/darts/blob/master/CHANGELOG.md)å³å¯ã€‚ç°åœ¨ä½ å¯ä»¥æŒ‰ç…§æ ‡å‡†æ–¹å¼è¿›è¡Œå®‰è£…ï¼š

```py
pip install darts
```

ä¸€æ—¦æˆ‘ä»¬åœ¨ç¯å¢ƒä¸­å®‰è£…äº†åº“ï¼Œå°±å¯ä»¥å¯¼å…¥å¹¶åœ¨å®è·µä¸­ä½¿ç”¨å®ƒã€‚

```py
import darts
```

# å•å˜é‡ä¸å¤šå˜é‡æ—¶é—´åºåˆ—

![](img/83b03160c0fff2b64f2e1b076f5efd04.png)

å•å˜é‡ä¸å¤šå˜é‡æ—¶é—´åºåˆ—ï¼Œä½œè€…æä¾›çš„å›¾åƒ

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒåŸºäº[**Walmart æ•°æ®é›†**](https://www.kaggle.com/datasets/yasserh/walmart-dataset)ï¼Œä½ å¯ä»¥çœ‹åˆ°**å•å˜é‡**å’Œ**å¤šå˜é‡**æ—¶é—´åºåˆ—ã€‚ç°åœ¨ï¼Œè®¸å¤šé—®é¢˜æ¶‰åŠåŒæ—¶å¤„ç†å¤šä¸ªç‚¹ã€‚è¿™äº›æ•°æ®å¯ä»¥æ¥è‡ªå„ç§è¿‡ç¨‹ï¼Œå¯ä»¥æ˜¯è¿™ä¸ªä¾‹å­å’Œæˆ‘æ—¥å¸¸å·¥ä½œçš„éœ€æ±‚é¢„æµ‹ï¼Œä¹Ÿå¯ä»¥æ˜¯èƒ½æºæ¶ˆè€—é¢„æµ‹ã€å…¬å¸è‚¡å¸‚æ”¶ç›˜ä»·ã€ä»è½¦ç«™ç§Ÿç”¨çš„è‡ªè¡Œè½¦æ•°é‡ç­‰ç­‰è®¸å¤šå…¶ä»–é—®é¢˜ã€‚

é™¤äº†æ—¶é—´åºåˆ—æœ¬èº«ï¼Œæˆ‘ä»¬è¿˜å¯èƒ½æœ‰å…¶ä»–*å˜é‡*ï¼Œå…¶ä¸­ä¸€äº›å¯èƒ½å·²çŸ¥æœªæ¥å€¼ï¼Œè€Œå…¶ä»–ä»…åœ¨è¿‡å»å¯ç”¨â€”â€”ç¨åä¼šè¯¦ç»†è®²è§£ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³å‘ä½ å±•ç¤ºé¢„æµ‹å¤šä¸ªæ—¶é—´åºåˆ—çš„ä¸åŒæ–¹æ³•ï¼Œä½†æˆ‘å¸Œæœ›å®ƒæ˜¯å®ç”¨çš„â€”â€”ä»¥ä¾¿ä½ ä¸ä»…ä»…åœç•™åœ¨ç†è®ºå±‚é¢ã€‚æ‰€ä»¥è®©æˆ‘ä»¬å¯¼å…¥æ‰€æœ‰åç»­ä½¿ç”¨çš„åº“â€”â€”åŒ…æ‹¬ Darts å’Œå…¶ä»–æ•°æ®ç§‘å­¦å®¶ç†ŸçŸ¥çš„åº“ã€‚

```py
# multiprocessing
from joblib import Parallel, delayed

# data manipulation
import numpy as np
import pandas as pd
from darts import TimeSeries
from darts.utils.timeseries_generation import datetime_attribute_timeseries

# data visualization
import matplotlib.pyplot as plt
import seaborn as sns
from tqdm import tqdm

# transformers and preprocessing
from darts.dataprocessing.transformers import Scaler

# models
from darts.models import NaiveSeasonal, StatsForecastAutoARIMA, ExponentialSmoothing, Prophet #local
from darts.models import LightGBMModel, RNNModel, NBEATSModel, TFTModel #global

# likelihood
from darts.utils.likelihood_models import GaussianLikelihood

# evaluation
from darts.metrics import mape

# settings
import warnings
warnings.filterwarnings("ignore")
import logging
logging.disable(logging.CRITICAL)
```

ç°åœ¨è®©æˆ‘ä»¬åŠ è½½æ•°æ®é›†ï¼Œè¿™ä¸ªæ•°æ®é›†æ¶‰åŠ**éœ€æ±‚é¢„æµ‹**ï¼Œå¹¶æ¥è‡ª[**Kaggle**](https://www.kaggle.com/competitions/demand-forecasting-kernels-only)ã€‚å¦‚æœä½ åŒæ„ Kaggle ä¸Šçš„æ¯”èµ›æ¡æ¬¾ï¼Œé‚£ä¹ˆä½ ä¹Ÿå¯ä»¥ä¸‹è½½è¿™ä¸ªæ•°æ®é›†ã€‚

```py
dataset = pd.read_csv('store_item_demand.csv')

# set the column type for column with date
dataset['date'] = pd.to_datetime(dataset['date'], format='%Y-%m-%d')
# sort values and reset index
dataset.sort_values(by=['date', 'store', 'item'], inplace=True)
dataset.reset_index(drop=True, inplace=True)
# creation of an auxiliary table with hierarchy and aggregated sales totals
hierarchy_df = dataset.groupby(['store', 'item'])[['sales']].sum()
hierarchy_df = hierarchy_df.reset_index(drop=False).sort_values(by=['sales'],
  ascending=False).reset_index(drop=True)
```

å…±æœ‰ 10 å®¶å•†åº—ï¼Œæ¯å®¶å•†åº—æœ‰ 50 ç§å•†å“ï¼Œæ€»è®¡ 500 ä¸ªæ—¶é—´åºåˆ—ã€‚

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨æ‰€æœ‰å•†åº—å•†å“ç»„åˆä¸­é”€å”®æœ€å°‘ã€ä¸­ç­‰å’Œæœ€å¤šçš„ 10 ç§å•†å“ã€‚è¦æ‰¾å‡ºæ—¶é—´åºåˆ—ä¸­çš„å…³ç³»ï¼Œé€šå¸¸åªéœ€è§‚å¯Ÿå®ƒï¼Œå› ä¸ºè¿™å·²ç»èƒ½å‘Šè¯‰æˆ‘ä»¬å¾ˆå¤šä¿¡æ¯ï¼Œæ¯”å¦‚è¶‹åŠ¿æˆ–å­£èŠ‚æ€§ï¼Œä½†å¾€å¾€è¿˜æœ‰æ›´å¤šã€‚

```py
fig, ax = plt.subplots(figsize=(30, 10))

for single_ts in list(np.arange(0, 10)) + list(np.arange(245, 255)) + list(np.arange(490, 500)):
    single_ts_df = pd.merge(dataset, hierarchy_df.loc[[single_ts], ['store', 'item']], how='inner', on=['store', 'item'])
    ax.plot(single_ts_df['date'], single_ts_df['sales'], color='black', alpha=0.25)
ax.set_xlim([dataset['date'].min(), dataset['date'].max()])
ax.set_ylim([0, dataset['sales'].max()])
plt.show()
```

![](img/0c022ede1dbd871b535d8233bd4c8be8.png)

è¿™äº›æ—¶é—´åºåˆ—ä¹‹é—´æœ‰å¾ˆå¤šç›¸ä¼¼æ€§ã€‚æˆ‘ä»¬å°†ç¨åæ£€æŸ¥æ˜¯å¦å­˜åœ¨å­£èŠ‚æ€§ï¼ˆå‘¨å‡ æˆ–ä¸€å¹´ä¸­çš„å‘¨/æœˆï¼‰æˆ–è¶‹åŠ¿ï¼Œä½†ä½ å¯ä»¥ç›´è§‚åœ°æƒ³è±¡ï¼Œä»æ‰€æœ‰æ—¶é—´åºåˆ—ä¸­å­¦ä¹ çš„æ¨¡å‹å°†æ¯”ä»…ä»å…¶å†å²ä¸­å­¦ä¹ çš„æ¨¡å‹æ›´å¥½åœ°é¢„æµ‹å•ä¸ªæ—¶é—´åºåˆ—ã€‚

æˆ‘ä¸º**EDA**ï¼ˆæ¢ç´¢æ€§æ•°æ®åˆ†æï¼‰åˆ›å»ºäº†æ•°æ®é›†çš„å‰¯æœ¬ã€‚ç„¶åï¼Œæˆ‘ä½¿ç”¨**MinMAXScaler**å¯¹æ—¶é—´åºåˆ—è¿›è¡Œç¼©æ”¾ï¼Œä½¿æ‰€æœ‰æ—¶é—´åºåˆ—å¯ä»¥äº’ç›¸æ¯”è¾ƒã€‚æœ€åï¼Œæˆ‘åˆ›å»ºç®±å‹å›¾ï¼Œä»¥æ£€æŸ¥æ˜¯å¦å­˜åœ¨è¶‹åŠ¿å’Œå­£èŠ‚æ€§ã€‚

```py
# make copy of df
dataset_scaled_EDA = dataset.copy()

# min max value calculation
dataset_scaled_EDA['min_sales'] = dataset_scaled_EDA.groupby(['store', 'item'])['sales'].transform(lambda x: x.min())
dataset_scaled_EDA['max_sales'] = dataset_scaled_EDA.groupby(['store', 'item'])['sales'].transform(lambda x: x.max())
# scale
dataset_scaled_EDA['sales_scaled'] = (dataset_scaled_EDA['sales'] - dataset_scaled_EDA['min_sales'])/(dataset_scaled_EDA['max_sales'] - dataset_scaled_EDA['min_sales'])
# add info about year, week of year and day of week
dataset_scaled_EDA['year'] = dataset_scaled_EDA['date'].dt.year
dataset_scaled_EDA['month'] = dataset_scaled_EDA['date'].dt.month
dataset_scaled_EDA['day_of_week'] = [d.strftime('%A') for d in dataset_scaled_EDA['date']]
dataset_scaled_EDA['day_of_week'] = pd.Categorical(dataset_scaled_EDA['day_of_week'], 
  categories=['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'], 
  ordered=True)

# visualize
fig, ax = plt.subplots(1, 3, figsize=(30, 10))
sns.boxplot(x='year', y='sales_scaled', data=dataset_scaled_EDA, ax=ax[0]).set(
    xlabel='Year', 
    ylabel='Scaled Sales'
)
ax[0].set_title('Box plot for years (trend)')
sns.boxplot(x='month', y='sales_scaled', data=dataset_scaled_EDA, ax=ax[1]).set(
    xlabel='Month', 
    ylabel='Scaled Sales'
)
ax[1].set_title('Box plot for months (seasonality)')
sns.boxplot(x='day_of_week', y='sales_scaled', data=dataset_scaled_EDA, ax=ax[2]).set(
    xlabel='Day of week', 
    ylabel='Scaled Sales'
)
ax[2].set_title('Box plot for day of week (seasonality)')
ax[2].set_xticklabels(ax[2].get_xticklabels(), rotation=30)
plt.show()
```

![](img/389fc7b02f361ab79d5cac60527593cc.png)

æ˜¯çš„ï¼Œæœ‰è¶‹åŠ¿å’Œä¸¤ç§å­£èŠ‚æ€§ã€‚å¦‚æœä½ è®¤ä¸ºè¿™äº›æ—¶é—´åºåˆ—å¾ˆå®¹æ˜“é¢„æµ‹â€”â€”ä½ æ˜¯å¯¹çš„ã€‚æœ¬æ–‡çš„ç›®çš„æ˜¯å‘ä½ å±•ç¤ºé¢„æµ‹å¤šä¸ªæ—¶é—´åºåˆ—çš„æœ€æµè¡Œçš„æ–¹æ³•ã€‚æ•°æ®å¹¶ä¸æ€»æ˜¯åƒè‚¡ç¥¨å¸‚åœºæŒ‡æ•°é‚£æ ·ç®€å•ï¼Œä½†é‚£æ˜¯å¦ä¸€ä¸ªè¯é¢˜ã€‚

æˆ‘è®¤ä¸ºè¿™ç§æ¢ç´¢è¶³ä»¥ç†è§£æ¨¡å‹åº”è¯¥å­¦ä¹ å“ªäº›å…³ç³»ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰**å¤šä¸ªæ—¶é—´åºåˆ—**ï¼ˆå¤šä¸ªå•†åº—ä¸­çš„å¤šä¸ªå•†å“é”€å”®ï¼‰ã€‚å¯¹äºæ¯ä¸€ä¸ª**æ—¶é—´åºåˆ—**ï¼Œæˆ‘ä»¬ä» Pandas DataFrame ä¸­åˆ›å»ºä¸€ä¸ª**TimeSeries**å¯¹è±¡ã€‚è¿™ç§ç±»å‹æ˜¯ Darts åº“ä¸­çš„æ¨¡å‹æ‰€éœ€çš„ã€‚ç„¶åå°†è¿™äº›æ—¶é—´åºåˆ—ä¿å­˜åˆ°**åˆ—è¡¨**ä¸­ã€‚

```py
dataset_ts = dataset.copy()
dataset_ts = TimeSeries.from_group_dataframe(df=dataset_ts, 
                                             group_cols=['store', 'item'],
                                             time_col='date', 
                                             value_cols='sales')
dataset_ts
```

å¤„ç†å¤šä¸ªæ—¶é—´åºåˆ—å¯èƒ½å¾ˆæœ‰å¸®åŠ©ï¼Œä½†é€šå¸¸ä¹Ÿä¼šå¸¦æ¥é—®é¢˜ã€‚å½“æˆ‘ä»¬åªæœ‰ä¸€ä¸ªæ—¶é—´åºåˆ—æ—¶ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šæ—¶é—´æ¥å¤„ç†å®ƒã€‚æŸ¥çœ‹å®ƒï¼ŒéªŒè¯è¶‹åŠ¿å’Œå­£èŠ‚æ€§ï¼Œå¹¶å¤„ç†å¼‚å¸¸ã€‚æˆ‘ä»¬å¯ä»¥ä¼˜åŒ–æˆ‘ä»¬çš„é¢„æµ‹ã€‚å¯¹äºå¤šä¸ªåºåˆ—ï¼Œè¿™ç§æ–¹æ³•å˜å¾—ä¸å¯è¡Œã€‚æˆ‘ä»¬å¸Œæœ›æ–¹æ³•å°½å¯èƒ½è‡ªåŠ¨åŒ–ï¼Œä½†è¿™æ ·å¯èƒ½ä¼šé”™è¿‡ç»†èŠ‚ï¼Œæ¯”å¦‚å¼‚å¸¸ï¼Œæˆ–è€…æˆ‘ä»¬ä¸åº”è¯¥ä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†æ¯ä¸ªæ—¶é—´åºåˆ—ã€‚å¯èƒ½è¿˜æœ‰æ›´å¤šå…¸å‹çš„é—®é¢˜ï¼šç¼ºå¤±æ•°æ®ã€æ•°æ®æ¼‚ç§»å’Œç¨€æœ‰äº‹ä»¶ï¼ˆé»‘å¤©é¹…äº‹ä»¶ï¼‰ã€‚æ›´å¤šçš„åºåˆ—å¯èƒ½å¯¹æˆ‘ä»¬æœ‰å¸®åŠ©ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ¨¡å‹å¯ä»¥ä½¿ç”¨æ›´å¤šçš„æ•°æ®ï¼Œå› æ­¤ä¼šæœ‰æ›´å¤šçš„ä»£è¡¨æ€§è§‚å¯Ÿæ•°æ®æ¥è¯†åˆ«ç‰¹å®šæ¨¡å¼ã€‚ä»¥æˆ‘çš„å·¥ä½œä¸ºä¾‹â€”â€”ä¸ºäº†é¢„æµ‹äº§å“ X åœ¨ä¸‹å‘¨å› ä¿ƒé”€é€ æˆçš„éœ€æ±‚ï¼Œæˆ‘ä»¬çš„æ¨¡å‹è¿˜å¯ä»¥åˆ©ç”¨å…¶ä»–ä¿ƒé”€çš„å†å²æ•ˆæœã€‚

> æ‰€ä»¥é—®é¢˜æ¥äº†â€”â€”å¦‚ä½•é¢„æµ‹å¤šä¸ªæ—¶é—´åºåˆ—ï¼Ÿ

ä½ å¯èƒ½ç»å¸¸ä¼šé—®è‡ªå·±*æˆ‘æ˜¯å¦æœ‰ä¸€ä¸ª* ***å¤šå˜é‡*** *æˆ–* ***å¤šå…ƒ*** *æ—¶é—´åºåˆ—ï¼Ÿ* è¿™äº›é—®é¢˜æ˜¯åˆç†çš„ï¼Œä½†ç­”æ¡ˆå¹¶ä¸æ€»æ˜¯æ˜ç¡®çš„ã€‚å½“ä½ çš„æ—¶é—´åºåˆ—æ¥è‡ª**å•ä¸€è¿‡ç¨‹**ï¼Œ**ç›¸äº’å…³è”**ã€**ç›¸å…³**ï¼Œå¹¶ä¸”**ç›¸äº’ä½œç”¨**æ—¶ï¼Œç­”æ¡ˆå°†æ˜¯*æˆ‘çš„æ—¶é—´åºåˆ—æ˜¯* ***å¤šå…ƒ***ã€‚

å½“ä½ åœ¨**å¤šä¸ªå•†åº—**é¢„æµ‹äº§å“ X çš„é”€å”®æ—¶ï¼Œä½ æœ‰ä¸€ä¸ª**å¤šæ—¶é—´åºåˆ—**ï¼Œä½†å½“ä½ æœ‰ä¸€ä¸ªé¢å¤–çš„äº§å“ Y æ—¶ï¼Œå¯¹äºå•ä¸ªå•†åº—æ¥è¯´ï¼Œä½ æœ‰ä¸€ä¸ª**å¤šå˜é‡æ—¶é—´åºåˆ—**ï¼Œå› ä¸ºä¸€ä¸ªäº§å“åœ¨å•†åº—ä¸­çš„é”€å”®å¯èƒ½**å½±å“**å¦ä¸€ä¸ªäº§å“çš„é”€å”®ï¼Œæˆ–è€…è¿™åªæ˜¯ä¸€ä¸ªå‡è®¾ã€‚

# å¦‚ä½•è¯„ä¼°é¢„æµ‹ç»“æœï¼Ÿ

åœ¨æˆ‘ä»¬æ·±å…¥è®¨è®ºä¸åŒçš„æ–¹æ³•å’Œæ¨¡å‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆè®¨è®ºå¦‚ä½•è¡¡é‡é¢„æµ‹çš„è´¨é‡ã€‚è¿™æ˜¯ä¸€ä¸ªå›å½’é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬ä»ç„¶ä¼šå°†é¢„æµ‹ç»“æœä¸çœŸå®å€¼è¿›è¡Œæ¯”è¾ƒï¼Œè¿™ä¸€ç‚¹æ¯«æ— ç–‘é—®ã€‚ä½ å¯ä»¥ä½¿ç”¨å›å½’é—®é¢˜ä¸­ç†Ÿæ‚‰çš„æŒ‡æ ‡ï¼Œå¦‚**RMSE**(*å‡æ–¹æ ¹è¯¯å·®*), **MSE**(*å‡æ–¹è¯¯å·®*), **MAE**(*å¹³å‡ç»å¯¹è¯¯å·®*)ï¼Œæˆ–è€…æ›´å…¸å‹çš„æ—¶é—´åºåˆ—æŒ‡æ ‡ï¼Œå¦‚**MAPE**(*å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®*), **MARRE**(*å¹³å‡ç»å¯¹èŒƒå›´ç›¸å¯¹è¯¯å·®*), æˆ–**MASE**(*å¹³å‡ç»å¯¹ç¼©æ”¾è¯¯å·®*)ã€‚è¿›ä¸€æ­¥çš„è®¨è®ºå°†ä½¿ç”¨**MAPE**ä½œä¸ºè¯„ä¼°æŒ‡æ ‡ã€‚æœ¬æ–‡ä¸æ˜¯å…³äºéœ€æ±‚é¢„æµ‹çš„ï¼Œä½†ç”±äºæ•°æ®å’Œæˆ‘çš„ç»éªŒï¼Œæœ‰å¾ˆå¤šç›¸å…³å‚è€ƒã€‚å› æ­¤ï¼Œä½ å¯ä»¥è€ƒè™‘ä¸ºè¯¥é—®é¢˜é€‰æ‹©ä»€ä¹ˆæŒ‡æ ‡ã€‚å§‹ç»ˆé€‰æ‹©èƒ½å¤Ÿåæ˜ ä¸šåŠ¡ç›®æ ‡çš„æŒ‡æ ‡ã€‚åœ¨è¿™ç¯‡*æ–‡ç« *ä¸­ï¼Œ[Nicolas Vandeput](https://www.linkedin.com/in/vandeputnicolas/) æè¿°äº†éœ€æ±‚é¢„æµ‹ä¸­ä½¿ç”¨çš„ KPI æŒ‡æ ‡ã€‚

æˆ‘ä»¬å¯ä»¥å°†è¿™ç§æ–¹æ³•æ‰©å±•åˆ°å¤šä¸ªåºåˆ—ï¼Œç„¶åä¸€æ¬¡æ€§è®¡ç®—æ‰€æœ‰åºåˆ—çš„æŒ‡æ ‡ï¼Œæˆ–è€…åˆ†åˆ«å¯¹æ¯ä¸ªåºåˆ—è®¡ç®—æŒ‡æ ‡åå†è¿›è¡Œæ±‡æ€»ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ç»§ç»­æ¢è®¨å¦‚ä½•è¯„ä¼°å•ä¸ªåºåˆ—ï¼Œç„¶åå†å°†å…¶æ‰©å±•åˆ°å¤šä¸ªåºåˆ—ã€‚

æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå›å½’é—®é¢˜ï¼Œä½ å¯èƒ½ä¼šæƒ³ä¸ºä»€ä¹ˆæˆ‘è§£é‡Šè¿™ä¸€ç‚¹ã€‚åœ¨æ—¶é—´åºåˆ—ä¸­ï¼Œæ—¶é—´æ‰®æ¼”äº†å…³é”®è§’è‰²ã€‚æ•°æ®æ˜¯ç›¸å¯¹äºæ—¶é—´æ’åºçš„ï¼Œè§‚æµ‹å€¼æ˜¯ç›¸äº’å…³è”çš„ã€‚å› æ­¤ï¼Œåˆ†å‰²è®­ç»ƒ/æµ‹è¯•é›†å¹¶ä½¿ç”¨äº¤å‰éªŒè¯æ—¶æ— æ³•ä½¿ç”¨éšæœºåŒ–ï¼Œå› ä¸ºè¿™æ ·ä¼šå¯¼è‡´æ•°æ®æ³„æ¼ã€‚

![](img/d6eb56fa82acdc8a681e06625ce075fb.png)

é¢„æµ‹æ¨¡å‹çš„è¯„ä¼°ï¼Œå›¾åƒç”±ä½œè€…æä¾›

é¦–å…ˆï¼Œå°†æ•°æ®åˆ†ä¸º**è®­ç»ƒ**é›†å’Œ**æµ‹è¯•**é›†ï¼Œå¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿæ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šè¿›è¡Œæ‹Ÿåˆï¼Œåœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œæµ‹è¯•ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰æ¯”ä¾‹åˆ’åˆ†ï¼Œä¾‹å¦‚ï¼Œæµ‹è¯•é›†åŒ…æ‹¬æœ€å 20% çš„æ•°æ®ï¼Œæˆ–è€…æŒ‡å®šæµ‹è¯•é›†çš„èµ·å§‹æ—¥æœŸâ€”â€”å¯èƒ½ç”±äºä¸šåŠ¡è€ƒè™‘ï¼Œæµ‹è¯•é›†ä¸ºè¿‡å»ä¸€å¹´æ•°æ®ä¼šæ›´é‡è¦ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæµ‹è¯•é›†å°†æ˜¯æœ€åä¸€å¹´ã€‚

```py
first_test_date = pd.Timestamp('2017-01-01')
train_dataset_ts, test_dataset_ts = [], []

for single_ts in tqdm(dataset_ts):
    # split into train and test tests
    single_train_ts, single_test_ts = single_ts.split_before(first_test_date)
    train_dataset_ts.append(single_train_ts)
    test_dataset_ts.append(single_test_ts)
```

ä»**è®­ç»ƒ**é›†åˆ†ç¦»**éªŒè¯**å­é›†ï¼Œç”¨äºé€‰æ‹©**è¶…å‚æ•°**ã€‚å¯¹äºåœ¨ Darts ä¸­å®ç°çš„æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨*gridsearch*æ–¹æ³•ï¼Œä½†å¯¹äºåŸºäºç¥ç»ç½‘ç»œçš„æ¨¡å‹ï¼Œæ¨èä½¿ç”¨[**Optuna**](https://optuna.org/)ã€‚gridsearch æ–¹æ³•å®é™…ä¸Šå…·å¤‡äº†æˆ‘ä»¬æ‰€éœ€çš„ä¸€åˆ‡ï¼Œæ— è®ºé€‰æ‹©å“ªä¸ªæ¨¡å‹éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚

é‡è¦çš„æ˜¯ï¼š

+   parameters âœ ä¸€ä¸ªåŒ…å«å¾…æ£€æŸ¥è¶…å‚æ•°çš„å­—å…¸

+   series âœ TimeSeries å¯¹è±¡æˆ–åŒ…å« TimeSeries å¯¹è±¡çš„åˆ—è¡¨ï¼ˆå¦‚æœç®—æ³•æ˜¯å…¨å±€çš„ï¼‰

+   start âœ *Pandas Timestamp* å®šä¹‰ç¬¬ä¸€æ¬¡é¢„æµ‹å‘ç”Ÿçš„æ—¶é—´ï¼Œæˆ–è€… *float* ä½œä¸ºç¬¬ä¸€æ¬¡é¢„æµ‹ä¹‹å‰è§‚å¯Ÿå€¼çš„æ¯”ä¾‹ã€‚

+   forecast_horizon âœ æ¨¡å‹é¢„æµ‹çš„æ—¶é—´èŒƒå›´æ•°é‡ï¼ˆ*int*ï¼‰

+   stride âœ ä¸‹ä¸€æ¬¡é¢„æµ‹ä¹‹é—´çš„åç§»é‡ã€‚ä¸ºäº†ä½¿ä¸€åˆ‡ç¬¦åˆæ•°æ®ç§‘å­¦çš„è‰ºæœ¯ï¼Œå¹¶æœ€èƒ½åæ˜ ç®—æ³•çš„å®é™…æ“ä½œï¼Œstride åº”è¯¥ç­‰äº 1ã€‚ä½†è¯·è®°ä½ï¼Œåœ¨æ¯ä¸€æ­¥ä¹‹åä½ çš„ç®—æ³•éƒ½ä¼šé‡æ–°è®­ç»ƒï¼Œè€Œä¸”ä½ çš„è¶…å‚æ•°ç½‘æ ¼å¯èƒ½æœ‰å¾ˆå¤šç»„åˆï¼Œè¿™é€šå¸¸éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚å› æ­¤ï¼Œå‡ºäºå¸¸è¯†è€ƒè™‘ï¼Œstride å¯ä»¥å¤§äº 1ï¼Œå°¤å…¶æ˜¯å› ä¸ºæ­¤ç›®çš„åœ¨äºé€‰æ‹©æœ€ä½³è¶…å‚æ•°ï¼Œç»“æœå¯èƒ½ï¼ˆä½†ä¸ä¸€å®šï¼‰åœ¨ stride ç­‰äº 1 æ—¶ä¸ stride ç­‰äº 5 æ—¶ç›¸åŒã€‚

+   metric âœ å‡½æ•°ï¼Œç”¨äºæ¯”è¾ƒçœŸå®å€¼å’Œé¢„æµ‹å€¼ã€‚ç„¶åæ ¹æ®è¿™ä¸ªæŒ‡æ ‡é€‰æ‹©æœ€ä½³è¶…å‚æ•°ã€‚

```py
model.gridsearch(
  parameters={}, 
  series= ,
  start= , 
  forecast_horizon= ,
  stride= ,
  metric= 
)
```

é‚£ä¹ˆå¦‚ä½•åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æ¨¡å‹å‘¢ï¼Ÿæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ã€‚

**ç¬¬ä¸€ç§**æ–¹æ³•æ˜¯æˆ‘ä»¬åœ¨è®­ç»ƒé›†ä¸Šæ‹Ÿåˆæ¨¡å‹ï¼Œå¹¶åšä¸€ä¸ªè¦†ç›–æµ‹è¯•é›†çš„é¢„æµ‹ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªé€‰é¡¹â€”â€”è®¡ç®—é€Ÿåº¦æ›´å¿«ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ºæ¯ä¸ªæ—¶é—´åºåˆ—ç”Ÿæˆä¸€ä¸ªé¢„æµ‹ã€‚

**ç¬¬äºŒç§**æ–¹æ³•æ˜¯æˆ‘ä»¬æµ‹è¯•ä¸åŒçš„é¢„æµ‹æ—¶é—´èŒƒå›´ã€‚æˆ‘ä»¬æ‹Ÿåˆæ¨¡å‹ï¼Œåšä¸€ä¸ªé¢„æµ‹ï¼Œé‡æ–°è®­ç»ƒï¼Œå†åšä¸€ä¸ªé¢„æµ‹ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä½†æˆ‘ä»¬å¿…é¡»åœ¨è®­ç»ƒé›†ç»“æŸä¹‹å‰å¼€å§‹è®­ç»ƒç®—æ³•ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½åœ¨ç›¸åŒçš„æ•°æ®ä¸Šæ¯”è¾ƒæ—¶é—´èŒƒå›´â€”â€”æˆ‘ä»¬åœ¨æ¯”è¾ƒç›¸åŒçš„è‹¹æœã€‚å¦‚æœä½ ä»æ•´ä¸ªè®­ç»ƒé›†å¼€å§‹è®­ç»ƒï¼Œé‚£ä¹ˆè¾ƒè¿œçš„æ—¶é—´èŒƒå›´æœ‰è¾ƒå°‘çš„è§‚å¯Ÿå€¼ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥é‡æ–°è®­ç»ƒï¼ˆç‰¹åˆ«æ˜¯åœ¨å±€éƒ¨æ¨¡å‹ä¸­ï¼‰ï¼Œå› æ­¤è¿™ç§æ–¹æ³•ä¸­æˆ‘ä»¬è‚¯å®šä¼šæœ‰æ›´å¤šçš„è®¡ç®—ã€‚

è¿™ä¹Ÿå¾ˆç®€å•ï¼Œå› ä¸º darts ä¸­çš„æ¨¡å‹å…·æœ‰æ ¹æ®ä¸Šè¿°å¯è§†åŒ–è¿”å›å†å²é¢„æµ‹çš„èƒ½åŠ›ã€‚ä½ å·²ç»å­¦ä¹ äº†ä¸€äº›åœ¨ gridsearch æ–¹æ³•ä¸­ä½¿ç”¨çš„å˜é‡ï¼Œè¿™äº›å˜é‡åœ¨è¿™é‡Œä¹Ÿé€‚ç”¨ã€‚ç„¶è€Œï¼Œè¿™é‡Œä¼šæœ‰æ–°çš„å˜é‡ï¼š

+   retrain âœ å¦‚æœç­‰äº *True*ï¼Œåˆ™åœ¨æ¯ä¸€æ­¥ä¹‹åæ¨¡å‹ä¼šé‡æ–°è®­ç»ƒï¼Œè¿™æœ€èƒ½åæ˜ ç°å®æƒ…å†µã€‚

+   overlap_end âœ å¦‚æœç­‰äº *True*ï¼Œåˆ™é¢„æµ‹å¯èƒ½è¶…å‡ºæµ‹è¯•é›†ä¸­çš„æ—¥æœŸã€‚å¦‚æœæˆ‘ä»¬å¯¹å¤šä¸ªæ—¶é—´èŒƒå›´è¿›è¡Œé¢„æµ‹ï¼Œè€Œè¾ƒè¿œçš„æ—¶é—´èŒƒå›´è¶…å‡ºæµ‹è¯•é›†ï¼Œè€Œè¾ƒè¿‘çš„æ—¶é—´èŒƒå›´ä¸è¶…å‡ºï¼Œè¿™æ ·çš„è®¾ç½®å¾ˆæœ‰ç”¨ã€‚

+   last_points_only âœ å¦‚æœç­‰äº *False*ï¼Œåˆ™è¿”å›æ‰€æœ‰æ—¶é—´èŒƒå›´çš„é¢„æµ‹ã€‚

```py
backtests_results = model.historical_forecasts(
  series= , 
  start= ,
  forecast_horizon= ,
  retrain=True,
  overlap_end=True,
  last_points_only=False,
)
```

ç„¶è€Œï¼Œæˆ‘ä»¬å¸Œæœ›ä»æ„Ÿå…´è¶£çš„æ—¶é—´èŒƒå›´ä¸­è·å–é¢„æµ‹ï¼Œå¹¶ä¸”åœ¨å˜é‡ backtests_results ä¸­ï¼Œæœ‰æ¥è‡ªä¸åŒæ—¶é—´ç‚¹çš„é¢„æµ‹ã€‚è¦ä»ç‰¹å®šçš„æ—¶é—´èŒƒå›´ä¸­è·å–é¢„æµ‹ï¼Œä½ å¯ä»¥ä½¿ç”¨æˆ‘çš„å‡½æ•° *take_backtest_horizon*ã€‚

backtests_5W âœ æœ‰é’ˆå¯¹æµ‹è¯•é›†æ¯ä¸ªç‚¹çš„é¢„æµ‹ï¼Œè¿™äº›é¢„æµ‹æ˜¯åœ¨ 5 å‘¨å‰åšå‡ºçš„ã€‚

```py
def take_backtest_horizon(backtests, horizon, last_horizon, observations):
    backtests_horizon_dates = [i.time_index[-1+horizon] for i in backtests[last_horizon-horizon:][:observations]]
    backtests_horizon_values = [i.values()[-1+horizon] for i in backtests[last_horizon-horizon:][:observations]]

    backtests_horizon = TimeSeries.from_times_and_values(times=pd.DatetimeIndex(backtests_horizon_dates), values=np.array(backtests_horizon_values))
    return backtests_horizon

backtests_5W = take_backtest_horizon(
  backtests=backtests_results, 
  horizon=5, # for which horizon we want a forecast, the number must be less than forecast_horizon
  last_horizon=forecast_horizon, # forecast_horizon from historical_forecasts method
  observations=len(test_series))
```

# ä½¿ç”¨çš„å˜é‡

å®é™…ä¸Šï¼Œæ—¶é—´åºåˆ—æœ¬èº«å¹¶ä¸èƒ½å®Œå…¨è‡ªæˆ‘è§£é‡Šã€‚æ—¶é—´åºåˆ—é€šå¸¸ä¾èµ–äºå…¶ä»–å˜é‡ã€‚è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰è¿™äº›å˜é‡ï¼Œä½†äº†è§£å¦‚ä½•åœ¨é¡¹ç›®ä¸­é‡åˆ°è¿™äº›å˜é‡æ—¶è¿›è¡ŒåŒºåˆ†æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰é€šçŸ¥æ¨¡å‹å³å°†åˆ°æ¥çš„ä¿ƒé”€/é™ä»·ï¼Œé‚£ä¹ˆå®ƒå°†æ— æ³•é¢„æµ‹é”€å”®é¢çš„å¢åŠ ã€‚å¦‚æœä½ æƒ³é¢„æµ‹è‚¡ç¥¨å…¬å¸çš„ä»·æ ¼å˜åŒ–ï¼Œæ·»åŠ æ¥è‡ªæŠ€æœ¯åˆ†ææˆ–åŸºæœ¬é¢åˆ†æçš„å˜é‡å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚è¿™äº›å˜é‡ä¾èµ–äºä»·æ ¼ï¼Œå³ä½ åªèƒ½çŸ¥é“è¿™äº›æŒ‡æ ‡çš„è¿‡å»å€¼ï¼Œæ¯•ç«Ÿï¼Œæˆ‘ä»¬æ— æ³•çŸ¥é“æœªæ¥çš„å…¬å¸è´¢åŠ¡æŠ¥å‘Šæˆ–ä»·æ ¼â€”â€”æˆ‘ä»¬å¸Œæœ›è¿›è¡Œé¢„æµ‹ :)

![](img/fdfdefebca39dab3d6d4fc34c837df1a.png)

æ—¶é—´åºåˆ—ç®—æ³•ä½¿ç”¨çš„å˜é‡ï¼Œå›¾æºä½œè€…

æˆ‘ä»¬å¯ä»¥æœ‰ä¹Ÿæ˜¯æ—¶é—´åºåˆ—çš„å˜é‡ï¼Œå³åœ¨ä¸åŒæ—¶é—´ç‚¹æœ‰ä¸åŒçš„å€¼ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æœ‰**é™æ€åå˜é‡**ï¼ˆéšæ—¶é—´ä¿æŒä¸å˜ï¼‰ï¼Œé€šå¸¸æ˜¯åˆ†ç±»å˜é‡ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™å°†æ˜¯å•†åº— ID å’Œå•†å“ IDã€‚å®ƒä»¬å¯¹å…¨å±€æ¨¡å‹éå¸¸é‡è¦ã€‚å› ä¸ºåœ¨æ¯ 100 ä¸ªæ—¶é—´åºåˆ—ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„å…³ç³»ï¼Œå€ŸåŠ©è¿™äº›å˜é‡ï¼Œä½ çš„æ¨¡å‹å¯ä»¥åŒºåˆ†ä¸åŒçš„æ—¶é—´åºåˆ—ã€‚

è‡³äºæ—¶é—´åºåˆ—å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åŒºåˆ†**åå˜é‡**ï¼Œå…¶ä¸­æœ‰äº›**å·²çŸ¥æœªæ¥**ï¼ˆä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æœªæ¥çš„ä¿ƒé”€æœºåˆ¶ï¼Œä¹ŸçŸ¥é“è¿‡å»çš„ä¿ƒé”€æœºåˆ¶ï¼‰å’Œ**ä»…å·²çŸ¥è¿‡å»çš„åå˜é‡**ï¼ˆæˆ‘ä»¬å¯ä»¥çŸ¥é“ç«äº‰äº§å“çš„ä»·æ ¼ï¼Œä½†ä¸çŸ¥é“å®ƒä»¬æœªæ¥çš„ä»·æ ¼ï¼‰ã€‚

# ä½¿ç”¨çš„æ¨¡å‹

![](img/dd185e633c9b5ffbdd0e2c15162d7077.png)

å±€éƒ¨ç®—æ³•ä¸å…¨å±€ç®—æ³•å¯¹æ¯”ï¼Œå›¾æºä½œè€…

æˆ‘ä»¬å¯ä»¥å°†æœºå™¨å­¦ä¹ åˆ†ä¸ºç›‘ç£å­¦ä¹ ã€æ— ç›‘ç£å­¦ä¹ å’Œå¼ºåŒ–å­¦ä¹ ã€‚è¿›å…¥è¯¦ç»†å†…å®¹åï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›‘ç£å­¦ä¹ åˆ†ä¸ºå›å½’å’Œåˆ†ç±»ã€‚æˆ‘ä»¬å¯ä»¥å¯¹æ—¶é—´åºåˆ—é¢„æµ‹è¿›è¡Œç±»ä¼¼çš„åˆ’åˆ†ï¼Œå³ä½¿ç”¨**å±€éƒ¨**æˆ–**å…¨å±€**ç®—æ³•æ¥é¢„æµ‹è¿™äº›æ—¶é—´åºåˆ—ã€‚

**å±€éƒ¨ç®—æ³•**æ˜¯é’ˆå¯¹**å•ä¸€æ—¶é—´åºåˆ—**è¿›è¡Œæ‹Ÿåˆçš„ï¼Œæ¨¡å‹ä»…èƒ½é¢„æµ‹è¿™ä¸€æ—¶é—´åºåˆ—ã€‚æ›´å¤šçš„æ—¶é—´åºåˆ—æ„å‘³ç€æ›´å¤šçš„æ¨¡å‹ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ä¼˜ç¼ºç‚¹ï¼Œæ¨¡å‹ç®€å•ï¼Œä½†å¯¹äºè®¸å¤šæ—¶é—´åºåˆ—æ¥è¯´ï¼Œè¿™ç§æ–¹æ³•å˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚

**å…¨å±€ç®—æ³•**åˆ™æ˜¯**ä¸€ä¸ªæ¨¡å‹**å¯ä»¥æ‹Ÿåˆ**å¤šä¸ªæ—¶é—´åºåˆ—**ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬æœ‰**å¤šä¸ªæ—¶é—´åºåˆ—**ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰**ä¸€ä¸ª**æ¨¡å‹æ¥é¢„æµ‹æ‰€æœ‰è¿™äº›åºåˆ—ã€‚è¿™ç§æ–¹æ³•æ˜¾ç„¶æ›´çµæ´»ï¼Œä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿ç§»å­¦ä¹ ã€‚å¯¹äºæ—¶é—´åºåˆ—ï¼Œè¿™æ„å‘³ç€ä½ åœ¨ä¸€ä¸ªä¸åŒçš„æ—¶é—´åºåˆ—ä¸Šæ‹Ÿåˆæ¨¡å‹ï¼Œè€Œä¸æ˜¯è¿›è¡Œé¢„æµ‹ã€‚[è¿™é‡Œ](https://unit8co.github.io/darts/examples/14-transfer-learning.html)æœ‰ä¸€ä¸ªä½¿ç”¨ç¤ºä¾‹ã€‚å¦ä¸€ä¸ªä¸å…¨å±€æ¨¡å‹ç›¸å…³çš„é‡è¦ç‚¹ï¼Œå› ä¸ºæˆ‘å¯èƒ½ä¼šå¿˜è®°ï¼Œå¹¶ä¸”è¿™éå¸¸é‡è¦â€”â€”é‚£å°±æ˜¯**æ—¶é—´åºåˆ—ç¼©æ”¾**ã€‚æœ€å¸¸è§çš„æ–¹æ³•æ˜¯*MinMaxScaler*ï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨æ›´é€‚åˆä½ æ•°æ®çš„ä¸œè¥¿ã€‚ç„¶è€Œï¼Œæˆ‘ä¸ä¼šåœ¨è¿™é‡Œè¯¦ç»†è¯´æ˜å¦‚ä½•ç¼©æ”¾æ—¶é—´åºåˆ—ï¼Œè¿™è‚¯å®šæ˜¯å¦ä¸€ä¸ªæ–‡ç« çš„è¯é¢˜ã€‚æˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸‹ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥ç¼©æ”¾æ—¶é—´åºåˆ—ã€‚ç­”æ¡ˆå¯èƒ½å¾ˆç®€å•ï¼Œè®¸å¤šå…¨å±€ç®—æ³•æ˜¯ç¥ç»ç½‘ç»œï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç¼©æ”¾æ•°æ®çš„åŸå› ï¼Œå°±åƒæˆ‘ä»¬å¯¹å·ç§¯ç¥ç»ç½‘ç»œçš„åƒç´ è¿›è¡Œå¤„ç†ä¸€æ ·ã€‚ç„¶è€Œï¼Œè¿™è¿˜ä¸æ˜¯å…¨éƒ¨ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åƒéšæœºæ£®æ—è¿™æ ·çš„æ¨¡å‹ï¼ˆéå‚æ•°æ¨¡å‹ï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶åº”è¯¥ç¼©æ”¾å®ƒä»¬ã€‚ä½†åœä¸‹æ¥ï¼Œä¸ºä»€ä¹ˆï¼Ÿæ¯•ç«Ÿï¼Œå¯¹äºè¿™äº›ç±»å‹çš„æ¨¡å‹ï¼Œä½ ä¸éœ€è¦ç¼©æ”¾å˜é‡ã€‚æˆ‘ä»¬åº”è¯¥ç¼©æ”¾æ—¶é—´åºåˆ—çš„åŸå› æ˜¯ä¸ºäº†è®©æ¨¡å‹å­¦ä¹ å…³ç³»ï¼Œè€Œä¸æ˜¯å°ºåº¦ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå­£èŠ‚æ€§å…³ç³»ï¼Œå¯èƒ½æ˜¯åœ¨å¤å­£æœˆä»½ï¼Œå€¼æ¯”å†¬å­£æœˆä»½å¹³å‡é«˜ 150%ã€‚å¦ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œ3 æ¬¡æ˜¾è‘—å¢åŠ åè·Ÿéšä¸€æ¬¡ä¸‹é™ã€‚å¦‚æœæˆ‘ä»¬ä¸ç¼©æ”¾æ—¶é—´åºåˆ—ï¼Œæ¨¡å‹å¾ˆéš¾å­¦ä¹ è¿™äº›å…³ç³»ã€‚è¿™æ˜¯ä¸€ç§ä¸è¡¨æ ¼æ•°æ®ä¸­å˜é‡ç¼©æ”¾ç•¥æœ‰ä¸åŒçš„æ–¹æ³•ï¼Œå› ä¸ºåœ¨è¿™é‡Œæˆ‘ä»¬å•ç‹¬ç¼©æ”¾æ¯ä¸ªæ—¶é—´åºåˆ—ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨å‰é¢æåˆ°çš„*MinMaxScaler*ï¼Œé‚£ä¹ˆå¯¹äºè®­ç»ƒé›†ä¸­çš„æ¯ä¸ªæ—¶é—´åºåˆ—ï¼Œæœ€å¤§å€¼æ˜¯ 1ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ç¼©æ”¾æˆ‘ä»¬çš„æ•°æ®ï¼Œè¿™å°†è¢«å…¨å±€æ¨¡å‹ä½¿ç”¨ã€‚

```py
scaler = Scaler() # MinMaxScaler
train_dataset_ts_prepared = scaler.fit_transform(train_dataset_ts)
test_dataset_ts_prepared = scaler.transform(test_dataset_ts)
dataset_ts_prepared = scaler.transform(dataset_ts)
```

ä¸€ä¼šå„¿ä½ å°†é˜…è¯»åˆ°æœ€å—æ¬¢è¿çš„**å±€éƒ¨**å’Œ**å…¨å±€**ç®—æ³•ã€‚è™½ç„¶ä¸å¯èƒ½æè¿°æ‰€æœ‰å¯èƒ½çš„ç®—æ³•ï¼Œä½†æœ‰ä¸€äº›ç®—æ³•å¸¸è¢«ä¸“å®¶ä½¿ç”¨ï¼Œå¹¶ä¸”é€šå¸¸èƒ½æ»¡è¶³é¢„æœŸã€‚

> æ²¡æœ‰å…è´¹çš„åˆé¤å®šç†

æ²¡æœ‰ä¸€ä¸ªç­”æ¡ˆâ€”â€”è¿™ä¸ªæ¨¡å‹æ˜¯æœ€å¥½çš„ï¼Œä¸è¦ä½¿ç”¨å…¶ä»–æ¨¡å‹ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª MVPâ€”â€”æœ€å¥½ä»ç®€å•çš„ä¸œè¥¿å¼€å§‹ã€‚

åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘æ²¡æœ‰åœ¨éªŒè¯é›†ä¸Šé€‰æ‹©æœ€ä½³è¶…å‚æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨äº†é»˜è®¤æ¨¡å‹ã€‚æ‰€ä»¥å¦‚æœä½ å‘Šè¯‰æˆ‘æ¨¡å‹å¯èƒ½æœ‰æ›´å¥½çš„ç»“æœâ€”â€”**æˆ‘å·²ç»åŒæ„ä½ çš„è§‚ç‚¹**ã€‚

# å±€éƒ¨æ¨¡å‹

åœ¨æˆ‘ä»¬æ·±å…¥å…·ä½“çš„å±€éƒ¨æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä¸ºä½ å‡†å¤‡äº†å‡½æ•°ï¼Œä»¥ä¾¿ä½¿ç”¨å¤šå¤„ç†æ¥åŠ å¿«æ‰€æœ‰æ ¸å¿ƒçš„è®¡ç®—é€Ÿåº¦ã€‚

```py
forecast_horizons = len(test_dataset_ts[0])

def _backtests_local_estimator(_estimator, _ts_set, _split_date, _horizons, _single_forecast):
    model = _estimator
    if _single_forecast:
        model.fit(_ts_set.split_before(_split_date)[0])
        backtests_single_ts = model.predict(_horizons)

    else:
        backtests_single_ts = model.historical_forecasts(series=_ts_set, 
                                                         start=_split_date - np.timedelta64(_horizons-1, 'D'), 
                                                         verbose=False, 
                                                         overlap_end=False,
                                                         last_points_only=True, 
                                                         forecast_horizon=_horizons,
                                                         retrain=True)

    return backtests_single_ts

def backtests_multiple_local_estimators(estimator, multiple_ts_sets=dataset_ts, split_date=first_test_date, horizons=forecast_horizons, single_forecast=True):
    backtests_multiple_ts = Parallel(n_jobs=-1,
                                     verbose=5, 
                                     backend = 'multiprocessing',
                                     pre_dispatch='1.5*n_jobs')(
            delayed(_backtests_local_estimator)(
                _estimator=estimator,
                _ts_set=single_ts_set,
                _split_date=split_date,
                _horizons=horizons,
                _single_forecast=single_forecast
            )
        for single_ts_set in multiple_ts_sets
    )

    return backtests_multiple_ts
```

æˆ‘å°†ä½¿ç”¨è¿™ä¸ªå‡½æ•°ä¸ºæœ¬åœ°æ¨¡å‹ç”Ÿæˆæµ‹è¯•é›†çš„å•ä¸ªé¢„æµ‹ã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥ç”¨å®ƒç”Ÿæˆå¤šä¸ªå†å²é¢„æµ‹ï¼ˆç¬¬äºŒç§æ–¹æ³•ï¼Œå˜é‡***single_forecast***åº”è®¾ç½®ä¸º***False***ï¼‰ã€‚ä¸è¿‡ï¼Œæˆ‘åœ¨è¿™é‡Œä¸è¿™æ ·åšï¼Œå› ä¸ºè¿™ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚

å¦‚æœä½ ä½¿ç”¨ Cluster å’Œ Sparkï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ Spark UDF æ¥æ˜¾è‘—åŠ å¿«è®¡ç®—é€Ÿåº¦ã€‚

æˆ‘çŸ¥é“ï¼Œä½ å¯èƒ½æƒ³è·³åˆ°æ¨¡å‹éƒ¨åˆ†ã€‚æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯â€”â€”ä¸€ä¸ªè¯„ä¼°æˆ‘ä»¬é¢„æµ‹ç»“æœçš„å‡½æ•°ã€‚æˆ‘å°†ä½¿ç”¨**MAPE**ä½œä¸ºè¯„ä¼°æŒ‡æ ‡ï¼Œç„¶è€Œï¼Œå¦‚æœä½ åœ¨åšéœ€æ±‚é¢„æµ‹é¡¹ç›®ï¼Œ**WMAPE**æˆ–**MAE**æ— ç–‘æ›´æ¥è¿‘ä¸šåŠ¡é¢„æœŸã€‚

```py
def get_overall_MAPE(prediction_series, test_series=test_dataset_ts):
    return np.round(np.mean(mape(actual_series=test_series, 
                                 pred_series=prediction_series, n_jobs=-1)),
                    2)
```

## åŸºå‡†çº¿

å¥½å§ï¼Œä½†ä¸ºä»€ä¹ˆè¦åšç¥ç»ç½‘ç»œï¼Œå¦‚æœä¸€ä¸ªæ›´å¥½çš„ä¸»æ„æ˜¯ä»ä¸€å¹´å‰é¢„æµ‹å€¼å‘¢ï¼Ÿè¿™æ­£æ˜¯æˆ‘ä»¬é¦–å…ˆåˆ›å»ºè¿™æ ·ä¸€ä¸ªæ¨¡å‹çš„åŸå› ã€‚å½“ä½ å¤„ç†å®é™…æ•°æ®æ—¶ï¼Œä½ æœ€å¥½ä¹Ÿä»è¿™æ ·çš„æ–¹å¼å¼€å§‹ï¼ˆå®ƒä¹Ÿå¯ä»¥æ˜¯è®­ç»ƒé›†ä¸­çš„æœ€åä¸€ä¸ªå€¼ï¼ŒNaiveDrift å¦‚æœæœ‰è¶‹åŠ¿ï¼Œæˆ–å‡ ç§ç®€å•æ–¹æ³•çš„ç»„åˆï¼‰ã€‚ç„¶åå¦‚æœä½ è½¬å‘æ›´é«˜çº§çš„æ–¹æ³•ï¼Œä½ å¯ä»¥è¯„ä¼°å®ƒæ¯”ç®€å•æ–¹æ³•å¥½å¤šå°‘ï¼Œå› ä¸ºä¾‹å¦‚ï¼Œå¦‚æœä½ ä»ç¥ç»ç½‘ç»œå¼€å§‹ï¼Œå…¶ MAPE ä¸º 10%ï¼Œé‚£ä¹ˆæˆ‘çš„é—®é¢˜ï¼ˆå¯èƒ½ä¹Ÿæ˜¯åˆ©ç›Šç›¸å…³è€…çš„é—®é¢˜ï¼‰æ˜¯â€”â€”*è¿™å¥½å—ï¼Ÿ*

æˆ‘ä»¬çš„æ¨¡å‹ï¼ˆä¸€ä¸ªæ—¶é—´åºåˆ—=ä¸€ä¸ªæ¨¡å‹ï¼‰å°†é‡å¤ä¸€å¹´å‰çš„å€¼ã€‚

```py
backtests_baseline_model = backtests_multiple_local_estimators(estimator=NaiveSeasonal(K=365))
print(f'overall MAPE: {get_overall_MAPE(backtests_baseline_model)}%')
```

**æ•´ä½“ MAPE: 22.42%**

ç°åœ¨è®©æˆ‘ä»¬åœ¨æµ‹è¯•é›†ä¸­å¯è§†åŒ–æ—¶é—´åºåˆ—çš„é¢„æµ‹å€¼å’Œå®é™…å€¼ï¼Œè¿™äº›æ—¶é—´åºåˆ—å…·æœ‰æœ€é«˜çš„æ€»é”€å”®é¢ã€‚

![](img/7c37de66f2d835d976d5c5f681f16803.png)

è¿™çœ‹èµ·æ¥è¿˜ä¸é”™ã€‚

## ARIMA

![](img/3c037dbaa86cd65df7dd14078eb1c315.png)

è§†è§‰åŒ– ARIMA ç®—æ³•çš„å·¥ä½œåŸç†ï¼Œå›¾åƒæ¥æºäºä½œè€…

**ARIMA** æ˜¯ä¸€ä¸ªç»Ÿè®¡æ¨¡å‹ï¼Œä»¥å…¶ç®€å•æ€§è€Œå¹¿å—æ¬¢è¿ä¸”å¼ºå¤§ã€‚å½“ä½ å¬åˆ°**ARIMA**æ—¶ï¼Œå®ƒå¯èƒ½æŒ‡çš„æ˜¯è¿™ä¸ªæ¨¡å‹ï¼Œä½†ä¹Ÿå¯èƒ½æ˜¯**ARIMA**çš„æ‰©å±•é›†åˆã€‚è¿™ä¸ªé›†åˆåŒ…æ‹¬**ARIMAX**ï¼ˆè€ƒè™‘é¢å¤–å˜é‡ï¼‰ã€**SARIMA**ï¼ˆè€ƒè™‘å­£èŠ‚æ€§ï¼‰æˆ–**VARIMA**ï¼ˆç”¨äºå¤šå˜é‡æ—¶é—´åºåˆ—ï¼‰ã€‚ä½†è®©æˆ‘ä»¬å›åˆ°**ARIMA**ï¼ˆ**A**uto**R**egressive **I**ntegrated **M**oving **A**verageï¼‰ï¼Œè¿™å°±æ˜¯ä¸€åˆ‡çš„èµ·ç‚¹ã€‚å¦‚æœä½ ç†è§£å¾—å¾ˆå¥½ï¼Œé‚£ä¹ˆä½¿ç”¨ä¹‹å‰æåˆ°çš„æ¨¡å‹åº”è¯¥ä¸ä¼šæœ‰é—®é¢˜ã€‚

è®¸å¤šæ–‡ç« å·²ç»å¯¹æ­¤ç®—æ³•è¿›è¡Œäº†é˜è¿°ã€‚æˆ‘æƒ³ç»™ä½ è¿™ä¸ªæ¨¡å‹èƒŒåçš„ç›´è§‚ç†è§£ã€‚æˆ‘å¸Œæœ›æœ€ç»ˆä½ èƒ½è½»æ¾åœ°åœ¨ä»£ç ä¸­å®ç°å®ƒï¼Œå¹¶ç†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘æ‰“ç®—ä»æœ€åå¼€å§‹ã€‚æˆ‘è‡ªå·±è®°å¾—åœ¨æ‹›è˜è¿‡ç¨‹ä¸­æœ‰è¿‡ä¸€ä¸ªå…³äºè¿™ä¸ªé—®é¢˜çš„ç–‘é—®ï¼Œå½“æ—¶æˆ‘è¿˜æ²¡æœ‰ç†è§£å®ƒã€‚**ARMA æ¨¡å‹åªèƒ½ä¸å¹³ç¨³æ—¶é—´åºåˆ—ä¸€èµ·ä½¿ç”¨**ï¼Œå› æ­¤æˆ‘ä»¬æœ‰ä¸€ä¸ªç»„ä»¶â€”â€”**ç§¯åˆ†**ï¼ˆ**I**ï¼‰ï¼Œå®ƒé€šå¸¸ï¼ˆä½†ä¸æ€»æ˜¯ï¼‰**å°†éå¹³ç¨³æ—¶é—´åºåˆ—è½¬æ¢ä¸ºå¹³ç¨³æ—¶é—´åºåˆ—**ã€‚**ARMA**æ˜¯æ¨¡å‹ï¼Œè€Œ**I**éƒ¨åˆ†è´Ÿè´£ä¸ºå»ºæ¨¡å‡†å¤‡æ•°æ®ï¼ˆå½“ç„¶ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼‰ã€‚ä½ åº”è¯¥çŸ¥é“å‡ ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œé‚£å°±æ˜¯æ—¶é—´åºåˆ—å¹³ç¨³æˆ–éå¹³ç¨³çš„å«ä¹‰ï¼Œä»¥åŠ**ç§¯åˆ†**ï¼ˆ**I**ï¼‰ç»„ä»¶è¿›è¡Œçš„è½¬æ¢ç±»å‹ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ä»å¹³ç¨³æ€§å¼€å§‹ã€‚

> å¦‚æœå€¼çš„åˆ†å¸ƒï¼ˆå‡å€¼å’Œæ–¹å·®ï¼‰åœ¨æ—¶é—´ä¸Šæ˜¯ä¸å˜çš„ï¼Œé‚£ä¹ˆæ—¶é—´åºåˆ—å°±æ˜¯å¹³ç¨³çš„ã€‚

å› æ­¤ï¼Œå¦‚æœå­˜åœ¨è¶‹åŠ¿å’Œ/æˆ–å­£èŠ‚æ€§ï¼Œé‚£ä¹ˆæ—¶é—´åºåˆ—å°±æ˜¯éå¹³ç¨³çš„ã€‚è¦æ£€æŸ¥æ—¶é—´åºåˆ—æ˜¯å¦å¹³ç¨³ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†å…¶å¯è§†åŒ–ï¼Œå¹¶åœ¨å›¾ä¸Šæ·»åŠ ç§»åŠ¨å¹³å‡å’Œç§»åŠ¨æ ‡å‡†å·®ã€‚å¦‚æœå®ƒä»¬éšæ—¶é—´ä¿æŒä¸å˜ï¼ˆæˆ–æ¥è¿‘ä¸å˜ï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥å¾—å‡ºä½ çš„æ—¶é—´åºåˆ—æ˜¯å¹³ç¨³çš„ç»“è®ºã€‚è¿™ç§æ–¹æ³•å¯èƒ½æ˜¾å¾—å¤©çœŸï¼Œå¹¶ä¸”å¹¶ä¸æ€»æ˜¯æœ‰æ•ˆï¼Œå› ä¸ºå¦‚æœå¯¹æ»šåŠ¨ç»Ÿè®¡æ•°æ®ä½¿ç”¨è¿‡å¤§çš„çª—å£ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºæ—¶é—´åºåˆ—æ˜¯å¹³ç¨³çš„ï¼Œè€Œå®é™…ä¸Šå¹¶éå¦‚æ­¤ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯å°†æ—¶é—´åºåˆ—æ‹†åˆ†æˆéšæœºåˆ†åŒºï¼Œå¯¹æ¯ä¸ªåˆ†åŒºè®¡ç®—ä¸Šè¿°ç»Ÿè®¡æ•°æ®ã€‚æœ€åä¸€ç§æ–¹æ³•æ˜¯è®¡ç®—**æ‰©å±•çš„è¿ªåŸº-ç¦å‹’**ï¼ˆ**ADF**ï¼‰æ£€éªŒã€‚å¦‚æœæˆ‘ä»¬çš„æ—¶é—´åºåˆ—ä»ç„¶ä¸æ˜¯å¹³ç¨³çš„ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨**ç§¯åˆ†**ï¼ˆ**I**ï¼‰ç»„ä»¶æ€ä¹ˆåŠï¼Ÿå®ƒé€šè¿‡**å·®åˆ†**æ¥ä½¿æ—¶é—´åºåˆ—å¹³ç¨³ï¼Œå³è®¡ç®—è§‚å¯Ÿå€¼ä¹‹é—´çš„å·®å¼‚ã€‚å¦‚æœæˆ‘ä»¬çš„æ—¶é—´åºåˆ—ä»ç„¶ä¸æ˜¯å¹³ç¨³çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€‰æ‹©**d**çš„é˜¶æ•°ï¼Œè¿™è¡¨ç¤ºæˆ‘ä»¬å¯¹æ—¶é—´åºåˆ—è¿›è¡Œå·®åˆ†çš„æ¬¡æ•°ã€‚

è¿™ä¸ªé•¿æ®µè½æ˜¯å…³äº**ç§¯åˆ†**ï¼ˆ**I**ï¼‰ï¼Œå®ƒå‡†å¤‡æ•°æ®ä»¥ä¾›**è‡ªå›å½’**ï¼ˆ**AR**ï¼‰å’Œ**ç§»åŠ¨å¹³å‡**ï¼ˆ**MA**ï¼‰ç»„ä»¶ä½¿ç”¨ã€‚**AR**æ˜¯å¯¹æœ€å**p**ä¸ªå€¼çš„çº¿æ€§å›å½’ï¼Œè¿™äº›å€¼è¢«ç§°ä¸ºæ»åã€‚å½“å‰å€¼ä¸æœ€åçš„å€¼ç›¸å…³è”ï¼Œå¹¶ä¸”ä¾èµ–äºè¿™äº›å€¼ã€‚**MA**æ˜¯è¡¥å……æ€§çš„ï¼Œè€ƒè™‘äº†é¢„æµ‹ä¸­**q**ä¸ªæœ€åçš„è¯¯å·®ï¼ˆå‡è®¾ä¸ºç™½å™ªå£°ï¼‰ï¼Œä»¥æ›´å¥½åœ°é¢„æµ‹å½“å‰çš„æ—¶é—´ç‚¹ã€‚

é€‰æ‹©**AR**çš„é˜¶æ•°**p**æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨[**PACF**](https://en.wikipedia.org/wiki/Partial_autocorrelation_function)ï¼ˆ**P**artial **A**uto**C**orrelation **F**unctionï¼‰ï¼Œè€Œé€‰æ‹©**MA**çš„é˜¶æ•°**q**æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨[**ACF**](https://en.wikipedia.org/wiki/Autocorrelation)ï¼ˆ**A**uto**C**orrelation **F**unctionï¼‰ã€‚åœ¨å¤§å­¦è¯¾ç¨‹ä¹‹å¤–ï¼Œæˆ‘ä»¬åœ¨å®é™…æ“ä½œä¸­ä¸å¤ªå¯èƒ½è¿™æ ·åšï¼Œå› ä¸ºæˆ‘ä»¬æœ‰[**AutoARIMA**](https://unit8co.github.io/darts/generated_api/darts.models.forecasting.auto_arima.html)å¯ä»¥ä¸ºæˆ‘ä»¬é€‰æ‹©**p**ã€**d**å’Œ**q**ã€‚

è®©æˆ‘ä»¬å›åˆ°å®è·µä¸­ï¼ŒæŒ‰ç…§ä¸åŸºçº¿æ¨¡å‹ç›¸ä¼¼çš„æ–¹å¼æ¥å®ç°ã€‚æ­£å¦‚ä½ å¯èƒ½å·²ç»äº†è§£åˆ°çš„ï¼Œç”±äº Darts åº“ï¼Œè¿™ä¸ªè¿‡ç¨‹éå¸¸ç®€å•ã€‚

```py
backtests_arima = backtests_multiple_local_estimators(estimator=StatsForecastAutoARIMA())
print(f'overall MAPE: {get_overall_MAPE(backtests_arima)}%')
```

**æ€»ä½“ MAPE: 28.18%**

```py
fig, ax = plt.subplots(figsize=(30, 10))
test_dataset_ts[0].plot(label='True value', color='black')
backtests_arima[0].plot(label='Forecast', color='green')
plt.show()
```

![](img/31546af743b6b1fa56efe95d9cdccb78.png)

å¦‚æœæˆ‘é€‰æ‹©å‚æ•°*m*ï¼ˆå­£èŠ‚æ€§å·®åˆ†çš„å‘¨æœŸï¼‰ï¼Œç»“æœå¯èƒ½ä¼šæ›´å¥½ã€‚ä½ å¯ä»¥å°è¯•ä¸€ä¸‹ï¼Œå¹¶å‘Šè¯‰æˆ‘ç»“æœçš„å˜åŒ–æƒ…å†µã€‚

## æŒ‡æ•°å¹³æ»‘

![](img/8cd796b93178f570b18ddeb944b0474a.png)

å¯è§†åŒ–æŒ‡æ•°å¹³æ»‘ï¼ˆETSï¼‰ç®—æ³•çš„å·¥ä½œåŸç†ï¼Œå›¾ç‰‡ç”±ä½œè€…æä¾›

**æŒ‡æ•°å¹³æ»‘**æ˜¯å¦ä¸€ç§ç”¨äºå•å˜é‡æ—¶é—´åºåˆ—çš„**æ¨¡å‹å®¶æ—**ã€‚ä½ å¯ä»¥åœ¨æœ¯è¯­**ETS**ï¼ˆ**E**-è¯¯å·®ï¼Œ**T**-è¶‹åŠ¿ï¼Œ**S**-å­£èŠ‚æ€§ï¼‰ä¸‹æ‰¾åˆ°â€œè¿™ä¸ªå®¶æ—â€ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œè§‚å¯Ÿå€¼è¢«èµ‹äºˆæƒé‡ï¼Œè¾ƒæ—§çš„è§‚å¯Ÿå€¼æƒé‡è¾ƒä½ï¼Œå› ä¸ºå®ƒä»¬æŒ‰æŒ‡æ•°è¡°å‡ã€‚æˆ‘ä»¬å¯ä»¥åŒºåˆ†ä¸‰ç§ç±»å‹ï¼šä¸€ç§ç®€å•çš„ç±»å‹å‡è®¾æœªæ¥å°†ç±»ä¼¼äºè¿‘æœŸå€¼ï¼Œä¸€ç§æ‰©å±•ç±»å‹å¤„ç†è¶‹åŠ¿ï¼Œæœ€åä¸€ç§è¿˜å¤„ç†å­£èŠ‚æ€§ã€‚æˆ‘å°†ä¼šåœ¨ç¨åæè¿°è¿™ä¸‰ç§ç±»å‹ï¼Œä¸è¿‡ç°åœ¨å…ˆæ’ä¸€ä¸ªå°æ’æ›²ã€‚åœ¨**M**-4 **æ¯”èµ›**ï¼ˆ[Makridakis æ¯”èµ›](https://en.wikipedia.org/wiki/Makridakis_Competitions)ï¼Œè¿™æ˜¯æœ€è‘—åçš„æ—¶é—´åºåˆ—é¢„æµ‹æ¯”èµ›ï¼‰ä¸­ï¼ŒSlawek Smyl è·èƒœï¼Œä»–æå‡ºäº†[**ES-RNN**](https://www.sciencedirect.com/science/article/abs/pii/S0169207019301153)ï¼Œè¿™æ˜¯**æŒ‡æ•°å¹³æ»‘**ä¸**é€’å½’ç¥ç»ç½‘ç»œ**çš„æ··åˆä½“ã€‚

ç°åœ¨æˆ‘ä»¬å›åˆ°è¯é¢˜çš„ç¬¬ä¸€ä¸ªç±»å‹ï¼Œå³**ç®€å•æŒ‡æ•°å¹³æ»‘**ã€‚ä½œä¸ºåŸºçº¿æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€ä¸ªæ€»æ˜¯é¢„æµ‹è®­ç»ƒé›†ä¸­çš„æœ€åä¸€ä¸ªå€¼çš„æ¨¡å‹ï¼Œè¿™æ˜¯ä¸€ç§ç¨æ˜¾å¤©çœŸçš„æ–¹æ³•ï¼Œä½†å¯ä»¥ç»™æˆ‘ä»¬å¸¦æ¥ä¸é”™çš„ç»“æœã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯è®¡ç®—æ•´ä¸ªè®­ç»ƒé›†çš„å¹³å‡å€¼ï¼Œä½†è¿™æ ·çš„è¯ï¼Œæœ€è¿‘çš„è§‚å¯Ÿå€¼å’Œæœ€å¤è€çš„è§‚å¯Ÿå€¼ä¼šè¢«èµ‹äºˆåŒç­‰çš„é‡è¦æ€§ã€‚æŒ‡æ•°å¹³æ»‘ç»“åˆäº†è¿™ä¸¤ç§æ–¹æ³•ï¼Œèµ‹äºˆæœ€è¿‘çš„è§‚å¯Ÿå€¼æ›´å¤§çš„æƒé‡ï¼Œæƒé‡ä¼šéšç€è§‚å¯Ÿå€¼çš„å¤è€ç¨‹åº¦å‘ˆæŒ‡æ•°ä¸‹é™ï¼Œè¿™æ„å‘³ç€æœ€å¤è€çš„è§‚å¯Ÿå€¼å°†æ‹¥æœ‰æœ€å°çš„æƒé‡ã€‚å®ƒä½¿ç”¨**Î±**å‚æ•°ï¼Œå…¶èŒƒå›´åœ¨ 0 åˆ° 1 ä¹‹é—´ã€‚å€¼è¶Šé«˜ï¼Œæœ€æ–°å€¼å¯¹é¢„æµ‹çš„å½±å“è¶Šå¤§ã€‚è¯·æŸ¥çœ‹ä¸Šé¢çš„å›¾å½¢ï¼Œé‚£é‡Œä¹Ÿæœ‰å…¬å¼ã€‚è¿™äº›å…¬å¼éå¸¸å®¹æ˜“ç†è§£ï¼Œé€šå¸¸è¿™äº›æ¨¡å‹èƒ½ç»™å‡ºä¸é”™çš„ç»“æœã€‚åœ¨æˆ‘ä»¬è¿›å…¥æ›´é«˜çº§çš„æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨è¿™é‡Œç¨ä½œåœç•™ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªç®€å•çš„æ¨¡å‹ç»™å‡ºçš„ç»“æœä¸éå¸¸å…ˆè¿›çš„æ¨¡å‹ï¼ˆä¾‹å¦‚æ·±åº¦ç¥ç»ç½‘ç»œï¼‰ç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥ä¿æŒä½¿ç”¨æ›´ç®€å•çš„æ¨¡å‹ï¼Œå› ä¸ºå®ƒä»¬çš„æ“ä½œå¯¹æˆ‘ä»¬æ¥è¯´æ›´å¯é¢„æµ‹ï¼Œå¹¶ä¸”æ›´å¤šçš„äººèƒ½å¤Ÿç†è§£å®ƒä»¬çš„è¿ä½œã€‚

SES æœ¬è´¨ä¸Šæ— æ³•å¤„ç†æ•°æ®ä¸­çš„è¶‹åŠ¿ã€‚å¦‚æœå­˜åœ¨ä¸Šå‡è¶‹åŠ¿ï¼Œåˆ™é¢„æµ‹ä¼šä½ä¼°ï¼Œå› ä¸ºå®ƒæ²¡æœ‰åŒ…å«è¿™ç§å¢åŠ ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœ‰å¦ä¸€ç§æ¨¡å‹ï¼Œå³**åŒé‡æŒ‡æ•°å¹³æ»‘**ã€‚å®ƒæœ‰ä¸€ä¸ªé¢å¤–çš„å› ç´ ï¼Œç”¨äºè€ƒè™‘è¶‹åŠ¿çš„å½±å“ã€‚æˆ‘ä»¬ä½¿ç”¨**Î²**å‚æ•°ï¼Œå®ƒæ§åˆ¶è¶‹åŠ¿å˜åŒ–çš„å½±å“ã€‚å› æ­¤æˆ‘ä»¬æœ‰ä¸¤ä¸ªå…¬å¼ï¼Œä¸€ä¸ªç”¨äº**æ°´å¹³**ï¼ˆæ°´å¹³æ–¹ç¨‹ï¼‰ï¼Œå¦ä¸€ä¸ªç”¨äº**è¶‹åŠ¿**ï¼ˆè¶‹åŠ¿æ–¹ç¨‹ï¼‰ã€‚

**ä¸‰é‡æŒ‡æ•°å¹³æ»‘**ä¹Ÿè€ƒè™‘äº†å­£èŠ‚æ€§ã€‚ä½ å¯ä»¥å°†å®ƒç§°ä¸º Holt-Winters çš„å­£èŠ‚æ€§æ–¹æ³•ã€‚è¿™é‡Œå¦ä¸€ä¸ªå‚æ•°**Î³**è¿›å…¥äº†å…¬å¼ã€‚è¿™ç§æ–¹æ³•å…è®¸**æ°´å¹³**ã€**è¶‹åŠ¿**å’Œ**å­£èŠ‚æ€§**çš„æ¨¡å¼éšæ—¶é—´å˜åŒ–ã€‚åƒè¶‹åŠ¿ä¸€æ ·ï¼Œå­£èŠ‚æ€§å¯ä»¥æ˜¯åŠ æ³•çš„æˆ–ä¹˜æ³•çš„ï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä¸ä¼šæè¿°è¯¦ç»†ä¿¡æ¯ï¼Œå‡è®¾ä½ çŸ¥é“åŒºåˆ«æˆ–å¯ä»¥è½»æ¾æ‰¾åˆ°å®ƒä»¬ã€‚æˆ‘åªæ˜¯ä¸æƒ³æŠŠè¿™ç¯‡æ–‡ç« å†™æˆä¸€æœ¬ä¹¦ï¼Œç°åœ¨æˆ‘å¸Œæœ›ä½ èƒ½é¡ºåˆ©é˜…è¯»æ•´ä¸ªæ–‡ç« ã€‚ğŸ˜‰

```py
backtests_exponential_smoothing  = backtests_multiple_local_estimators(estimator=ExponentialSmoothing())
print(f'overall MAPE: {get_overall_MAPE(backtests_exponential_smoothing)}%')
```

**æ€»ä½“ MAPE: 31.88%**

```py
fig, ax = plt.subplots(figsize=(30, 10))
test_dataset_ts[0].plot(label='True value', color='black')
backtests_exponential_smoothing[0].plot(label='Forecast', color='green')
plt.show()
```

![](img/caee69055bc0f0fa97677781373db3dd.png)

è‡³äº ARIMAï¼Œæˆ‘æ²¡æœ‰æ·»åŠ å­£èŠ‚æ€§ä¿¡æ¯ã€‚ç°åœ¨è½®åˆ°ä½ äº†ï¼Œä½¿ç”¨*seasonal_periods*å‚æ•°ä¸º[**æŒ‡æ•°å¹³æ»‘**](https://unit8co.github.io/darts/generated_api/darts.models.forecasting.exponential_smoothing.html)æ·»åŠ è¿™äº›ä¿¡æ¯ã€‚

## Prophet

![](img/b90f59872f2815910c9764bd0a782d1e.png)

å¯è§†åŒ– Prophet ç®—æ³•çš„å·¥ä½œåŸç†ï¼Œä½œè€…æä¾›çš„å›¾ç‰‡

[**Prophet**](https://facebook.github.io/prophet/) æ˜¯ Facebook åœ¨ 2017 å¹´çš„ [*å¤§è§„æ¨¡é¢„æµ‹*](https://peerj.com/preprints/3190.pdf) è®ºæ–‡ä¸­æå‡ºçš„ã€‚å®ƒæ—¢æ˜¯ä¸€ä¸ªæ¨¡å‹ï¼Œåˆæ˜¯ä¸€ä¸ªåŒååº“ã€‚ä¸ä¹‹å‰çš„æ¨¡å‹ä¸€æ ·ï¼Œä½ å¯ä»¥åœ¨ Darts ä¸­æ‰¾åˆ°å®ƒã€‚è¯¥ç®—æ³•æ˜¯**G**eneralized **A**dditive **M**odelï¼Œå› æ­¤é¢„æµ‹æ˜¯å„ä¸ªç»„ä»¶çš„æ€»å’Œã€‚è¿™äº›ç»„ä»¶æ˜¯**g(*t*)** â€” è¶‹åŠ¿ï¼Œ**s(*t*)** â€” å­£èŠ‚æ€§ï¼ˆæ¯å¹´ã€æ¯å‘¨å’Œæ¯æ—¥ï¼‰ï¼Œä»¥åŠ**h(*t*)** â€” å‡æœŸæ•ˆåº”ã€‚

> y(t) = g(t) + s(t) + h(t) + error(t)

ç¬¬ä¸€ä¸ªæ˜¯**è¶‹åŠ¿**ï¼Œå®ƒå¯ä»¥éšç€æ—¶é—´çš„å˜åŒ–è€Œå˜åŒ–ï¼Œå¹¶ä¸”ä¸å¿…å§‹ç»ˆä¿æŒä¸å˜ã€‚å½“å­¦ç”Ÿå¼€å§‹å­¦ä¹ æ—¶é—´åºåˆ—åˆ†æè¯¾ç¨‹æ—¶ï¼Œä»–ä»¬é€šå¸¸å¤„ç†çš„æ˜¯ç®€å•çš„æ—¶é—´åºåˆ—ã€‚åœ¨æ—¶é—´åºåˆ—ä¸­ï¼Œä»–ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªè¿ç»­å¢é•¿çš„è¶‹åŠ¿ã€‚ç„¶è€Œï¼Œåœ¨å®é™…æ•°æ®ä¸­ï¼Œè¶‹åŠ¿å¯èƒ½ä¼šå‘ç”Ÿå¤šæ¬¡å˜åŒ–ã€‚Prophet å®ç°äº†**æ‹ç‚¹**ï¼ˆå¯ä»¥å°†å…¶è§†ä¸ºè¶…å‚æ•°ï¼Œä¾‹å¦‚å®ƒä»¬çš„æ•°é‡ã€èŒƒå›´å’Œå…ˆéªŒå°ºåº¦ï¼‰ã€‚è¿™äº›ç‚¹æ˜¯è¶‹åŠ¿çš„å˜åŒ–ï¼Œä¾‹å¦‚ï¼Œå¢åŠ è¶‹åŠ¿ -> æ‹ç‚¹ -> å‡å°‘è¶‹åŠ¿ -> æ‹ç‚¹ -> æ›´å¼ºçš„å‡å°‘è¶‹åŠ¿ï¼Œç­‰ç­‰ã€‚è¿™ç§æ–¹æ³•æ›´æ¥è¿‘æˆ‘ä»¬é€šå¸¸åœ¨æ•°æ®ä¸­çœ‹åˆ°çš„æƒ…å†µã€‚è¿™äº›æ‹ç‚¹çš„ä½ç½®æ˜¯ Prophet åœ¨ä½ ä¹‹å‰è®¾ç½®çš„ã€‚æ‹ç‚¹ä¹‹é—´çš„è¶‹åŠ¿å‡½æ•°å¯ä»¥æ˜¯ç®€å•çš„å›å½’ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æœ‰**å­£èŠ‚æ€§**å‡½æ•°ï¼Œå®ƒæ˜¯**å‚…é‡Œå¶çº§æ•°**ã€‚

å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯**å‡æœŸ**æ•ˆåº”ï¼Œå®ƒä¼šå¯¹æˆ‘ä»¬çš„é¢„æµ‹å€¼è¿›è¡ŒåŠ å‡è°ƒæ•´ã€‚ä½ å¯ä»¥ä½¿ç”¨ Prophet åº“æä¾›çš„æ—¥æœŸï¼Œæˆ–è€…å®šä¹‰ä½ è‡ªå·±çš„äº‹ä»¶ã€‚ä½ å¯ä»¥æƒ³è±¡ï¼Œé»‘è‰²æ˜ŸæœŸäº”æ•ˆåº”ä¼šæ˜¾è‘—å½±å“é”€å”®é¢ã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥è€ƒè™‘å‡æœŸå½±å“é¢„æµ‹çš„æ—¥æœŸèŒƒå›´ï¼Œä¾‹å¦‚ï¼Œåœ£è¯èŠ‚ä¸ä¼šå½±å“å‡æœŸå½“å¤©çš„é”€å”®ï¼Œä½†ä¼šå½±å“ä¹‹å‰çš„å‡ å¤©ï¼ˆå¾ˆå¤šå¤©ï¼‰ã€‚

```py
backtests_prophet = backtests_multiple_local_estimators(estimator=Prophet())
print(f'overall MAPE: {get_overall_MAPE(backtests_prophet)}%')
```

**æ€»ä½“ MAPEï¼š14.38%**

```py
fig, ax = plt.subplots(figsize=(30, 10))
test_dataset_ts[0].plot(label='True value', color='black')
backtests_prophet[0].plot(label='Forecast', color='green')
plt.show()
```

![](img/ca2b1293788c97c73332b2ec77cf20ed.png)

# å…¨çƒæ¨¡å‹

ç°åœ¨æˆ‘ä»¬è½¬å‘ä¸€ä¸ªæ¨¡å‹ç”¨äºæ‰€æœ‰æ—¶é—´åºåˆ—çš„æ–¹æ³•ã€‚è¿™ä¹Ÿè¢«ç§°ä¸º**è·¨å­¦ä¹ **ï¼Œå› ä¸ºè¯¥æ¨¡å‹ä¸ºäº†å¯¹æ—¶é—´åºåˆ— A åšå‡ºè‰¯å¥½çš„é¢„æµ‹ï¼Œä»æ—¶é—´åºåˆ— A ä»¥åŠ Bã€Cã€D ç­‰ä¸­å­¦ä¹ äº†å…³ç³»ã€‚

## ç›‘ç£æ¨¡å‹ ~ æ—¶é—´åºåˆ—ä½œä¸ºå›å½’é—®é¢˜

![](img/1044de425c3f4a039c506ed1ec58736c.png)

å¯è§†åŒ–å¦‚ä½•ä¸ºç›‘ç£å­¦ä¹ æ¨¡å‹åˆ›å»ºç‰¹å¾ï¼Œå›¾åƒæ¥æºäºä½œè€…

ç°åœ¨è®©æˆ‘ä»¬å°è¯•å°†ç›‘ç£å­¦ä¹ æ¨¡å‹åº”ç”¨äºæ—¶é—´åºåˆ—é¢„æµ‹ã€‚è¿™å¹¶ä¸æ–°é²œï¼Œä½†å®ƒä»¬å¾€å¾€èƒ½ç»™å‡ºå¾ˆå¥½çš„ç»“æœï¼Œä¸”æ¯”ç¥ç»ç½‘ç»œæ•ˆæœæ›´ä½³ï¼ˆå‚è§ M-5 ç«èµ›ä¸­çš„æœ€ä½³è§£å†³æ–¹æ¡ˆï¼‰ã€‚ç„¶è€Œï¼Œå›å½’æ¨¡å‹å¹¶éä¸“é—¨é’ˆå¯¹æ—¶é—´åºåˆ—ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨å®ƒä»¬ï¼Œå°±éœ€è¦**å°†æ—¶é—´åºåˆ—é—®é¢˜è½¬æ¢ä¸ºæœºå™¨å­¦ä¹ é—®é¢˜**ã€‚æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»è¯¦ç»†ä»‹ç»äº†è¿™ä¸€ç‚¹ï¼Œ**å–å‡ºä¸ä¹°å…¥é¢„æµ‹**ä¸­æœ‰æ›´å¤šå†…å®¹ï¼Œä½†æˆ‘ä¹Ÿå°†æè¿°å¦‚ä½•ä½¿ç”¨ä¼—æ‰€å‘¨çŸ¥çš„å›å½’ç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

åœ¨æˆ‘å¼€å§‹ä¹‹å‰æåˆ°çš„è½¬æ¢ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦**ç¼©æ”¾**æ•°æ®ã€‚ä¹‹å‰æˆ‘æè¿°äº†è¿™ç§è½¬æ¢å¯¹äºå…¨å±€æ¨¡å‹çš„å¿…è¦æ€§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä½¿ç”¨äº†*MinMaxScaler*ã€‚

ä¸‹ä¸€æ­¥æ˜¯**ç‰¹å¾å·¥ç¨‹**ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡å¤äº†å‡ æ¬¡çš„è½¬æ¢è¿‡ç¨‹ã€‚åŸºäºæ—¶é—´åºåˆ—çš„å†å²ï¼Œæˆ‘ä»¬åˆ›å»ºæœ‰åŠ©äºæ¨¡å‹æ›´å¥½åœ°é¢„æµ‹æœªæ¥çš„ç‰¹å¾ã€‚è¿™äº›å˜é‡å¯ä»¥æŒ‡ä»£æ‰€é€‰æ—¶é—´åºåˆ—çš„è¿‘æœŸå†å²ï¼Œä¾‹å¦‚**æ»å**å€¼ï¼ˆå¯¹äºæ¯å‘¨æ•°æ®ï¼Œt-1Wï¼Œt-2Wï¼Œt-3Wï¼Œç­‰ç­‰ï¼‰ã€‚å¦ä¸€ä¸ªä¾‹å­æ˜¯**æ»šåŠ¨ç»Ÿè®¡**çš„è®¡ç®—ï¼Œå¦‚ä¸­ä½æ•°ï¼ˆå¯ä»¥æ˜¯æœ€è¿‘ 4 å‘¨çš„ä¸­ä½æ•°ï¼‰ã€å‡å€¼ã€æœ€å°å€¼ã€æœ€å¤§å€¼ã€æ ‡å‡†å·®ä»¥åŠä½ å°†åœ¨çª—å£ä¸Šè®¡ç®—çš„å…¶ä»–å†…å®¹ã€‚å¦‚æœæ•°æ®ä¸­å­˜åœ¨**å­£èŠ‚æ€§**ï¼Œé‚£ä¹ˆæœ€å¥½ç»™æ¨¡å‹ä¸€ä¸ªå…³äºæ—¶é—´ç‚¹ t çš„æç¤ºã€‚æˆ‘ç»å¸¸ä½¿ç”¨**å‘¨æœŸå˜é‡çš„æ­£å¼¦å’Œä½™å¼¦**ï¼ˆåœ¨ä¸Šé¢çš„å¯è§†åŒ–ä¸­æ˜¯å¹´ä»½ä¸­çš„ä¸€å¤©å’Œä¸€å‘¨ä¸­çš„ä¸€å¤©ï¼‰ã€‚

æœ€åä¸€æ­¥æ˜¯é€‰æ‹©ä¸€ä¸ª**æ¨¡å‹**ï¼Œä½ æœ‰å¾ˆå¤šé€‰æ‹©ï¼ŒåŒ…æ‹¬çº¿æ€§å›å½’ã€çº¿æ€§æ··åˆæ•ˆåº”æ¨¡å‹ã€éšæœºæ£®æ—ã€LightGBM ç­‰ã€‚æ¨¡å‹çš„é€‰æ‹©å–å†³äºæ—¶é—´åºåˆ—çš„æ€§è´¨å’Œé—®é¢˜çš„å¤æ‚æ€§ã€‚å¦ä¸€ä¸ªé—®é¢˜å¯èƒ½æ˜¯ä½ æƒ³è¦ä¸€ä¸ªæ¨¡å‹è¿˜æ˜¯å’Œé¢„æµ‹æœŸæ•°ä¸€æ ·å¤šçš„æ¨¡å‹ã€‚å½“ä½ é€‰æ‹©ä¸€ä¸ªæ¨¡å‹æ—¶ï¼Œéœ€è¦è€ƒè™‘å…¶å¼±ç‚¹ã€‚ä¾‹å¦‚ï¼Œå½“ä½ é€‰æ‹©éšæœºæ£®æ—æ—¶ï¼Œè®°ä½å¶å­èŠ‚ç‚¹è®¡ç®—çš„æ˜¯å‡å€¼ï¼Œå› æ­¤å®ƒä¸èƒ½è¶…å‡ºè®­ç»ƒèŒƒå›´ã€‚LightGBM æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒä¸è®¡ç®—æœ´ç´ å‡å€¼ï¼Œè€Œæ˜¯åœ¨åå°è¿›è¡Œå›å½’è®¡ç®—ã€‚

ç°åœ¨æ˜¯æ—¶å€™å›åˆ°å®é™…æ“ä½œéƒ¨åˆ†å¹¶åœ¨ä»£ç ä¸­å®ç°æ¨¡å‹äº†ã€‚æˆ‘é€‰æ‹©äº†[**LightGBM**](https://lightgbm.readthedocs.io/en/v3.3.2/)ä½œä¸ºæ¨¡å‹ã€‚ä½¿ç”¨å®ƒåœ¨ Darts ä¸­æ¯”æˆ‘å¸Œæœ›åœ¨æ²¡æœ‰è¿™ä¸ªåº“çš„æƒ…å†µä¸‹ä½¿ç”¨è¦ç®€å•å¾—å¤šã€‚æ­£å¦‚ä½ åœ¨ä»£ç ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è¿‡å» 14 å¤©çš„æ»åæ•°æ®ã€‚æˆ‘è¿˜æ·»åŠ äº†ç¼–ç å™¨ï¼Œæ·»åŠ äº†æ¨¡å‹ä½¿ç”¨çš„åå˜é‡ï¼Œè¿™äº›å˜é‡ä¼šè‡ªåŠ¨æ·»åŠ ï¼Œå¹¶ä¸”æ‰€æœ‰è®¡ç®—éƒ½åœ¨å†…éƒ¨å®Œæˆã€‚

+   *å‘¨æœŸæ€§* â€” æ·»åŠ  2 åˆ—ï¼ŒåŸºäºå‘¨æœŸå˜é‡ï¼ˆå¦‚æœˆä»½ï¼‰çš„æ­£å¼¦ä½™å¼¦ç¼–ç 

+   *æ—¥æœŸæ—¶é—´å±æ€§* â€” åŸºäºæ—¥æœŸæ—¶é—´å˜é‡æ·»åŠ æ ‡é‡

+   *position* â€” åŸºäºæ—¶é—´åºåˆ—ç´¢å¼•ï¼Œå°†ç›¸å¯¹ç´¢å¼•ä½ç½®æ·»åŠ ä¸ºæ•´æ•°å€¼ï¼Œå…¶ä¸­ 0 è®¾ç½®åœ¨é¢„æµ‹ç‚¹ã€‚

```py
model_lightGBM = LightGBMModel(lags=14, 
                               output_chunk_length=365, 
                               random_state=0,
                               multi_models=False, 
                               add_encoders={"cyclic": {"future": ["month"]}, 
                                             'datetime_attribute': {'future': ['dayofweek']},
                                             'position': {'past': ['relative'], 'future': ['relative']}, 
                                             'transformer': Scaler()
                 })

model_lightGBM.fit(series=train_dataset_ts_prepared)
backtests_lightGBM = model_lightGBM.predict(n=forecast_horizons, series=train_dataset_ts_prepared)
# The model predicts scaled values, but then we have to reverse the transformation
backtests_lightGBM = scaler.inverse_transform(backtests_lightGBM) # 
print(f'overall MAPE: {get_overall_MAPE(backtests_lightGBM)}%')
```

**æ€»ä½“ MAPE: 15.01%**

```py
fig, ax = plt.subplots(figsize=(30, 10))
test_dataset_ts[0].plot(label='True value', color='black')
backtests_lightGBM[0].plot(label='Forecast', color='green')
plt.show()
```

![](img/45a39d49094bcdf9d257b90ae08828b8.png)

ç»“æœéå¸¸æœ‰å‰æ™¯ï¼Œå°¤å…¶æ˜¯å› ä¸ºè¿™æ˜¯ä¸€ä¸ªé€‚ç”¨äºæ‰€æœ‰æ—¶é—´åºåˆ—çš„æ¨¡å‹ã€‚ç„¶è€Œï¼ŒåŸºäºæˆ‘çš„ç»éªŒï¼Œæˆ‘æƒ³æé†’ä½ ã€‚è¿™äº›ç±»å‹çš„æ¨¡å‹åœ¨ç‰¹å¾å·¥ç¨‹ä¸Šè¡¨ç°è‰¯å¥½ï¼Œè¿™æ—¢æ˜¯ä¼˜åŠ¿ä¹Ÿæ˜¯å¤§ç¼ºé™·ã€‚å‡è®¾ä½ ä½¿ç”¨äº†æ»åå’Œç§»åŠ¨å¹³å‡ã€‚ç°åœ¨ä½ å°†é¢„æµ‹ä¸€ä¸ªæ—¶é—´åºåˆ—çš„å€¼ï¼Œä½†å®ƒä¸­æœ‰å¼‚å¸¸å€¼â€”â€”åœ¨é¢„æµ‹ç‚¹ä¹‹å‰æœ‰å‡ ä¸ªå¤§å€¼ã€‚ä½ çš„æ¨¡å‹è‚¯å®šä¼šé«˜ä¼°ã€‚å½“ä½ åˆ›å»ºå˜é‡æ—¶ï¼Œå°½é‡æƒ³è±¡å®ƒä»¬å¯¹æ¨¡å‹çš„å½±å“ã€‚

## DeepAR

![](img/ed577969a790507e6cbac998587cca53.png)

åŸºäºè®ºæ–‡çš„ arxiv å’Œæ¨¡å‹æ¶æ„çš„æˆªå›¾

[**DeepAR**](https://arxiv.org/abs/1704.04110) æ˜¯ç”± Amazon å›¢é˜Ÿå¼€å‘çš„ä¸€ç§æ·±åº¦å­¦ä¹ ç®—æ³•ã€‚å®ƒæ—¨åœ¨ä½¿ç”¨é€’å½’ç¥ç»ç½‘ç»œï¼ˆRNNsï¼‰å¯¹æ—¶é—´åºåˆ—æ•°æ®ä¸­çš„å¤æ‚ä¾èµ–å…³ç³»è¿›è¡Œå»ºæ¨¡ã€‚

æ­£å¦‚æˆ‘ä»¬åœ¨æ‘˜è¦ä¸­é˜…è¯»åˆ°çš„ï¼ˆè¿™ä¸æˆ‘éå¸¸æ¥è¿‘ï¼‰ï¼š

> ä¾‹å¦‚ï¼Œåœ¨é›¶å”®ä¸šåŠ¡ä¸­ï¼Œé¢„æµ‹éœ€æ±‚å¯¹äºåœ¨æ­£ç¡®çš„æ—¶é—´å’Œåœ°ç‚¹æä¾›åˆé€‚çš„åº“å­˜è‡³å…³é‡è¦ã€‚

è¯¥æ¨¡å‹æ˜¯è‡ªå›å½’çš„ï¼Œå¹¶ä½¿ç”¨è’™ç‰¹å¡æ´›æ ·æœ¬ç”Ÿæˆæ¦‚ç‡é¢„æµ‹ã€‚ç¥ç»ç½‘ç»œæ¶æ„åŸºäº LSTM å±‚ã€‚é€šè¿‡æ¦‚ç‡æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå•ä¸€çš„è‰¯å¥½é¢„æµ‹ï¼Œè€Œæ˜¯æ•´ä¸ªé¢„æµ‹åˆ†å¸ƒï¼Œæ¥ç¡®å®šçœŸå®å€¼å¯èƒ½å‡ºç°çš„ä½ç½®ã€‚DeepAR ä¸æ˜¯ç›´æ¥ä½¿ç”¨ LSTMs è¿›è¡Œé¢„æµ‹ï¼Œè€Œæ˜¯åˆ©ç”¨ LSTMs æ¥å‚æ•°åŒ–é«˜æ–¯ä¼¼ç„¶å‡½æ•°ã€‚å³ï¼Œä¼°è®¡é«˜æ–¯å‡½æ•°çš„å‡å€¼å’Œæ ‡å‡†å·®ï¼ˆÎ¸ = (Î¼, Ïƒ) å‚æ•°ï¼‰ã€‚

DeepAR æ”¯æŒæœªæ¥å·²çŸ¥åå˜é‡ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿™æ ·çš„æ•°æ®ï¼Œä½†å¯ä»¥åˆ›å»ºå®ƒä»¬ã€‚ä½œä¸ºè¿™äº›ç‰¹å¾ï¼Œæˆ‘åˆ›å»ºäº†å¸¦æœ‰æ˜ŸæœŸå‡ å’Œæœˆä»½çš„ç‹¬çƒ­ç¼–ç ï¼ˆOHEï¼‰ã€‚å¯èƒ½æ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ­£å¼¦å’Œä½™å¼¦å‡½æ•°ï¼Œæˆ‘é¼“åŠ±ä½ è¿›è¡Œå®éªŒï¼Œå¹¶å°†åé¦ˆæ„è§å‘Šè¯‰æˆ‘ã€‚

```py
day_series = datetime_attribute_timeseries(
    dataset_ts[0], attribute="weekday", one_hot=True, dtype=np.float32
)
month_series = datetime_attribute_timeseries(
    dataset_ts[0], attribute="month", one_hot=True, dtype=np.float32
)

day_month_series = day_series.concatenate(month_series, axis=1, ignore_static_covariates=True)

model_deepar = RNNModel(
    model="LSTM",
    hidden_dim=10,
    n_rnn_layers=2,
    dropout=0.2,
    batch_size=32,
    n_epochs=5,
    optimizer_kwargs={"lr": 1e-3},
    random_state=0,
    training_length=21,
    input_chunk_length=14,
    likelihood=GaussianLikelihood(),
    pl_trainer_kwargs={
        "accelerator": "gpu",
        "devices": [0]
    }
)

model_deepar.fit(series=train_dataset_ts_prepared, future_covariates=[train_day_month]*len(train_dataset_ts_prepared), verbose=True)

backtests_deepar = model_deepar.predict(n=forecast_horizons, series=train_dataset_ts_prepared, 
                                        future_covariates=[day_month_series]*len(train_dataset_ts_prepared), 
                                        num_samples=1000, verbose=True)
backtests_deepar = scaler.inverse_transform(backtests_deepar)
print(f'overall MAPE: {get_overall_MAPE(backtests_deepar)}%')
```

**æ€»ä½“ MAPE: 19.35%**

```py
fig, ax = plt.subplots(figsize=(30, 10))
test_dataset_ts[0].plot(label='True value', color='black')
backtests_deepar[0].plot(label='Forecast', color='green')
plt.show()
```

![](img/5e2d94c8d9ccdbe19449ff4fab8ce6c4.png)

## N-BEATS

![](img/86f2949104c8355bd78ad466b50eea5f.png)

åŸºäºè®ºæ–‡çš„ arxiv å’Œæ¨¡å‹æ¶æ„çš„æˆªå›¾

[**N-BEATS**](https://arxiv.org/abs/1905.10437)ï¼ˆç”¨äºå¯è§£é‡Šæ—¶é—´åºåˆ—é¢„æµ‹çš„ç¥ç»åŸºç¡€æ‰©å±•åˆ†æï¼‰æ˜¯ä¸€ç§æ·±åº¦å­¦ä¹ ç®—æ³•ï¼Œä½†å®ƒä¸åŒ…å«é€’å½’å±‚ï¼Œå¦‚ LSTM æˆ– GRUã€‚

æ¶æ„å¯èƒ½çœ‹èµ·æ¥å¤æ‚ï¼Œä½†ä¸€æ—¦ä½ æ·±å…¥äº†è§£ç»†èŠ‚ï¼Œå®ƒå®é™…ä¸Šéå¸¸ç®€å•ï¼Œæ˜¯ç”±å—ç»„åˆè€Œæˆï¼Œæ‰€æœ‰å±‚éƒ½æ˜¯å‰é¦ˆçš„ã€‚

æˆ‘ä»¬ä»æœ€å°çš„å…ƒç´ â€”â€”å—å¼€å§‹ï¼Œæ¯ä¸ªå—æœ‰ä¸€ä¸ªè¾“å…¥å¹¶ç”Ÿæˆä¸¤ä¸ªè¾“å‡ºã€‚è¾“å…¥æ˜¯å›é¡¾æœŸã€‚è¾“å‡ºæ˜¯é¢„æµ‹å’Œå›æº¯ã€‚æˆ‘æƒ³ä½ å¯¹é¢„æµ‹çš„æ¦‚å¿µå¾ˆå®¹æ˜“ç†è§£ã€‚å›æº¯æ˜¯é¢„æµ‹ï¼Œä½†å¯¹äºå›é¡¾æœŸï¼Œå®ƒæ˜¯æ‹Ÿåˆå€¼ï¼Œå¹¶å±•ç¤ºäº†å—åœ¨å›é¡¾æœŸçª—å£ä¸Šçš„å…³ç³»å¥½åã€‚

è®©æˆ‘ä»¬è½¬åˆ°å †æ ˆï¼Œæˆ–å¤šä¸ªå—çš„ç»„åˆã€‚å¦‚ä½ æ‰€è¯»ï¼Œæ¯ä¸ªå—æœ‰ä¸¤ä¸ªè¾“å‡ºå’Œä¸€ä¸ªè¾“å…¥ã€‚æ¥ä¸‹æ¥çš„å—è´Ÿè´£é¢„æµ‹æ®‹å·®â€”â€”ç±»ä¼¼äºæå‡æ£®æ—æ¨¡å‹ä¸­å‘ç”Ÿçš„æƒ…å†µï¼Œå¦‚ AdaBoostã€‚åœ¨æ¯ä¸€æ­¥ä¸­ï¼Œå—ç”Ÿæˆçš„å›æº¯ä»å‰ä¸€ä¸ªå—çš„è¾“å…¥ä¸­å‡å»ã€‚æœ€åï¼Œæ‰€æœ‰å—çš„é¢„æµ‹ç»“æœéƒ½ä¼šèšåˆã€‚æ­¤å¤–ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯è§£é‡Šçš„æ¨¡å‹ï¼Œä½ å¯ä»¥åˆ†è§£å¹¶æŸ¥çœ‹è¶‹åŠ¿å’Œå­£èŠ‚æ€§çš„å½±å“ã€‚

ç°åœ¨è®©æˆ‘ä»¬è½¬åˆ°ç»„åˆå †æ ˆã€‚è¿™éƒ¨åˆ†å¢åŠ äº†æ¨¡å‹çš„æ·±åº¦ï¼Œå¹¶æä¾›äº†æ›´å¤šäº†è§£å¤æ‚æ€§çš„æœºä¼šã€‚

```py
model_nbeats = NBEATSModel(
    input_chunk_length=178,
    output_chunk_length=356,
    generic_architecture=False,
    num_blocks=3,
    num_layers=4,
    layer_widths=512,
    n_epochs=10,
    nr_epochs_val_period=1,
    batch_size=800,
    model_name="nbeats_interpretable_run",
    random_state=0,
    pl_trainer_kwargs={
      "accelerator": "gpu",
      "devices": [0]
    }
)

model_nbeats.fit(series=train_dataset_ts_prepared, verbose=True)

backtests_nbeats = model_nbeats.predict(n=forecast_horizons, series=train_dataset_ts_prepared, verbose=True)
backtests_nbeats = scaler.inverse_transform(backtests_nbeats)
print(f'overall MAPE: {get_overall_MAPE(backtests_nbeats)}%')
```

**æ•´ä½“ MAPEï¼š13.18%**

```py
fig, ax = plt.subplots(figsize=(30, 10))
test_dataset_ts[0].plot(label='True value', color='black')
backtests_nbeats[0].plot(label='Forecast', color='green')
plt.show()
```

![](img/0a61c6e32b3eb36bc2e90b0ce40b9973.png)

## TFT

![](img/341ef264d69b65087f3d9ac99030c59b.png)

arxiv å’Œæ¨¡å‹æ¶æ„çš„æˆªå›¾ï¼ŒåŸºäºè®ºæ–‡

[**æ—¶é—´èåˆå˜æ¢å™¨**](https://arxiv.org/abs/1912.09363)ï¼ˆTFTï¼‰æ˜¯è°·æ­Œå¼€å‘çš„ç”¨äºæ—¶é—´åºåˆ—é¢„æµ‹çš„æ·±åº¦å­¦ä¹ ç®—æ³•ã€‚å®ƒæ—¨åœ¨é€šè¿‡ç»“åˆå˜æ¢å™¨ç½‘ç»œå’Œè‡ªå›å½’å»ºæ¨¡æ¥å»ºæ¨¡æ—¶é—´åºåˆ—æ•°æ®ä¸­çš„å¤æ‚ä¾èµ–å…³ç³»å’Œå…³ç³»ã€‚

TFT æ˜¯æœ€å¤æ‚çš„æ¶æ„ï¼Œä½¿ç”¨äº†å„ç§åº•å±‚æŠ€æœ¯ã€‚å®ƒåƒæ´‹è‘±ä¸€æ ·ï¼Œç”±å¤šå±‚ç»„æˆã€‚æ­¤å¤–ï¼Œæ ¹æ®æˆ‘çš„ç»éªŒï¼Œå®ƒç›¸æ¯”ä¸Šè¿°æ¨¡å‹å­¦ä¹ æ—¶é—´æœ€é•¿ã€‚TFT ä½¿ç”¨å¤šå¤´æ³¨æ„åŠ›å—æ¥å¯»æ‰¾é•¿æœŸæ¨¡å¼ï¼Œä½†ä½¿ç”¨ LSTM åºåˆ—åˆ°åºåˆ—ç¼–ç å™¨/è§£ç å™¨æ¥å¯»æ‰¾è¿™äº›è¾ƒçŸ­çš„æ¨¡å¼ã€‚

```py
model_tft = TFTModel(
    input_chunk_length=28,
    output_chunk_length=356,
    hidden_size=16,
    lstm_layers=1,
    num_attention_heads=3,
    dropout=0.1,
    batch_size=32,
    n_epochs=5,
    add_encoders={"cyclic": {"future": ["month"]}, 
                  'datetime_attribute': {'future': ['dayofweek']},
                  'position': {'past': ['relative'], 'future': ['relative']}, 
                  'transformer': Scaler()
                 },
    add_relative_index=False,
    optimizer_kwargs={"lr": 1e-3},
    random_state=0,
    pl_trainer_kwargs={
      "accelerator": "gpu",
      "devices": [0]
    }
)

model_tft.fit(series=train_dataset_ts_prepared, verbose=True)

backtests_tft = model_tft.predict(n=forecast_horizons, series=train_dataset_ts_prepared, 
                                  num_samples=1000, verbose=True)
backtests_tft = scaler.inverse_transform(backtests_tft)
print(f'overall MAPE: {get_overall_MAPE(backtests_tft)}%')
```

**æ•´ä½“ MAPEï¼š13.37%**

```py
fig, ax = plt.subplots(figsize=(30, 10))
test_dataset_ts[0].plot(label='True value', color='black')
backtests_tft[0].plot(label='Forecast', color='green')
plt.show()
```

![](img/d7ca8f7f8ffb0cd88937b1b5bc969e2d.png)

# æ€»ç»“

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³å‘ä½ å±•ç¤ºä½ å¯ä»¥é€‰æ‹©å“ªäº›æ–¹æ³•æ¥é¢„æµ‹å¤šä¸ªæ—¶é—´åºåˆ—ã€‚æˆ‘æä¾›äº†å®Œå…¨å®ç”¨çš„ä»£ç ï¼Œéšæ„ä½¿ç”¨å®ƒä»¬ï¼Œä¸è¦çŠ¹è±«ä¸æˆ‘è”ç³»ã€‚

è¿™åªæ˜¯å¯¹ä¸»é¢˜çš„ä»‹ç»ã€‚æˆ‘è®¤ä¸ºæ•°æ®ç§‘å­¦å®¶åœ¨ä¾›åº”é“¾å…¬å¸å·¥ä½œçš„ç›¸å…³ä¸»é¢˜è¿˜åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

- **å±‚çº§é¢„æµ‹**åŠéšååˆå¹¶æ¥è‡ªä¸åŒå±‚çº§çš„é¢„æµ‹ï¼Œå³å±‚çº§è°ƒæ•´ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å•†åº—çº§åˆ«è¿›è¡Œé¢„æµ‹ï¼Œä¹Ÿå¯ä»¥åœ¨å›½å®¶çº§åˆ«è¿›è¡Œé¢„æµ‹ï¼Œä½†å½“æˆ‘ä»¬å°†å•†åº—çº§åˆ«çš„é¢„æµ‹èšåˆæ—¶ï¼Œä½œä¸ºæ€»å’Œï¼Œæˆ‘ä»¬å¸Œæœ›å¾—åˆ°ä¸å›½å®¶çº§åˆ«é¢„æµ‹æ˜¾ç¤ºçš„ç›¸åŒç»“æœã€‚è¿™å°±æ˜¯å±‚çº§è°ƒæ•´é‡è¦çš„åŸå› ã€‚

- å¦ä¸€ä¸ªè¯é¢˜æ˜¯ **åº“å­˜ä¼˜åŒ–**ï¼Œå³æˆ‘ä»¬åº”è¯¥åœ¨åº“å­˜ä¸­æ‹¥æœ‰å¤šå°‘äº§å“ï¼Œä»¥é¿å…æ²¡æœ‰äº§å“åº“å­˜çš„æƒ…å†µï¼Œä½†å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›æŸä¸€äº§å“åº“å­˜æ•°æœˆã€‚

# æœ‰é—®é¢˜å—ï¼Ÿ

![](img/21d1e065cb242a0fd6cb114ae9823fec.png)

é—®é¢˜ï¼Œå›¾ç‰‡ç”±ä½œè€…æä¾›

æˆ‘æ„è¯†åˆ°åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘è§¦åŠäº†è®¸å¤šä¸»é¢˜ã€‚æˆ‘æƒ³ç»™ä½ ä¸€ä¸ªå¯ä»¥é‡‡å–çš„æ–¹å‘çš„æŒ‡ç¤ºã€‚ä¹Ÿè®¸å…¶ä¸­ä¸€äº›åº”è¯¥åœ¨è¿™é‡Œæ›´è¯¦ç»†åœ°æè¿°ï¼Œè€Œå…¶ä»–çš„åˆ™åœ¨æ–°æ–‡ç« ä¸­è¯¦ç»†æè¿°ã€‚è¯·ä¸è¦çŠ¹è±«ï¼Œ**ä½ å¯ä»¥åœ¨** [**Linkedin**](https://www.linkedin.com/in/bartosz-szablowski/) **æ‰¾åˆ°æˆ‘**ã€‚åœ¨æœªæ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘å¸Œæœ›å®ƒä»¬èƒ½å¤Ÿæ¶µç›–è¯¦ç»†çš„ä¸»é¢˜ï¼Œå¹¶å±•ç¤ºå¦‚ä½•ä½¿ç”¨ PyTorch åº“ä»å¤´å¼€å§‹å®ç°æ—¶é—´åºåˆ—æ¨¡å‹ã€‚

æ„Ÿè°¢ä½ çš„æ—¶é—´ï¼

æ•°æ®é›†æ¥æºï¼š

> æ‚é¡¹{ä»…é™éœ€æ±‚é¢„æµ‹å†…æ ¸ï¼Œ
> 
> ä½œè€… = {inversion},
> 
> æ ‡é¢˜ = {å•†åº—å•†å“éœ€æ±‚é¢„æµ‹æŒ‘æˆ˜},
> 
> å‡ºç‰ˆå•† = {Kaggle},
> 
> å¹´ä»½ = {2018},
> 
> ç½‘å€ = {https://kaggle.com/competitions/demand-forecasting-kernels-only},
> 
> è®¸å¯è¯ = CC
> 
> }
