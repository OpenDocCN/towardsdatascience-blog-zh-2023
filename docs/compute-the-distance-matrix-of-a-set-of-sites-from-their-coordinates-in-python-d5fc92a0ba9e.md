# è®¡ç®—ä¸€ç»„åœ°ç‚¹åæ ‡çš„è·ç¦»çŸ©é˜µï¼ˆPython å®ç°ï¼‰

> åŸæ–‡ï¼š[`towardsdatascience.com/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e?source=collection_archive---------0-----------------------#2023-07-16`](https://towardsdatascience.com/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e?source=collection_archive---------0-----------------------#2023-07-16)

## è½»æ¾ä¼°ç®—ä»»æ„ä¸€å¯¹åœ°ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œä½œä¸ºè§£å†³ä¸€èˆ¬è·¯ç”±é—®é¢˜çš„èµ·ç‚¹

[](https://medium.com/@carlosjuribe?source=post_page-----d5fc92a0ba9e--------------------------------)![Carlos J. Uribe](https://medium.com/@carlosjuribe?source=post_page-----d5fc92a0ba9e--------------------------------)[](https://towardsdatascience.com/?source=post_page-----d5fc92a0ba9e--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----d5fc92a0ba9e--------------------------------) [Carlos J. Uribe](https://medium.com/@carlosjuribe?source=post_page-----d5fc92a0ba9e--------------------------------)

Â·

[å…³æ³¨](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4337eddb94ed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e&user=Carlos+J.+Uribe&userId=4337eddb94ed&source=post_page-4337eddb94ed----d5fc92a0ba9e---------------------post_header-----------) å‘è¡¨åœ¨ [Towards Data Science](https://towardsdatascience.com/?source=post_page-----d5fc92a0ba9e--------------------------------) Â·13 åˆ†é’Ÿé˜…è¯»Â·2023 å¹´ 7 æœˆ 16 æ—¥[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd5fc92a0ba9e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e&user=Carlos+J.+Uribe&userId=4337eddb94ed&source=-----d5fc92a0ba9e---------------------clap_footer-----------)

--

[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd5fc92a0ba9e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e&source=-----d5fc92a0ba9e---------------------bookmark_footer-----------)![](img/871f751c51440a309a64ceac1dc53e26.png)

ç”± DALLÂ·E 3 ç”Ÿæˆçš„å›¾åƒï¼Œä½œè€…çš„æç¤ºï¼šâ€œä¸€å¼ åŸå¸‚ç½‘ç»œçš„åœ°å›¾ï¼Œæ¯ä¸ªåŸå¸‚éƒ½è¿æ¥åˆ°å…¶ä»–æ‰€æœ‰åŸå¸‚â€

> *ğŸ‘ï¸* **è¿™æ˜¯å…³äºâ€œ**[**Python ä¸­çš„æ™ºèƒ½å†³ç­–æ”¯æŒç³»ç»Ÿ**](https://medium.com/@carlosjuribe/list/an-intelligent-decision-support-system-for-tourism-in-python-b6ba165b4236)**â€é¡¹ç›®çš„ç¬¬ 4 ç¯‡æ–‡ç« ï¼Œ** æˆ‘é¼“åŠ±ä½ æŸ¥çœ‹ä¸€ä¸‹ï¼Œä»¥è·å–æ•´ä¸ªé¡¹ç›®çš„ä¸€èˆ¬æ¦‚è¿°ã€‚å¦‚æœä½ åªå¯¹åˆ›å»ºè·ç¦»çŸ©é˜µæ„Ÿå…´è¶£ï¼Œè¿™ç¯‡æ–‡ç« å·²ç»è¶³å¤Ÿï¼Œå®ƒæ˜¯è‡ªåŒ…å«çš„ã€‚å¦‚æœä½ è¿˜æƒ³å°†è·ç¦»çŸ©é˜µåº”ç”¨äºå®é™…é—®é¢˜ï¼Œè¿™ä¸ªç³»åˆ—å°†å¯¹ä½ æœ‰å…´è¶£ã€‚

æœ¬æ–‡å°†ç»§ç»­ä»[sprint 3](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c)çš„æœ€åä¸€ä¸ªåœ°æ–¹å¼€å§‹ï¼šä¸ºæ—…è¡Œå•†é—®é¢˜æ„å»ºä¼˜åŒ–æ¨¡å‹ï¼Œ*åœ¨ç»™å®šå›ºå®šè®¿é—®åœ°ç‚¹*åŠå…¶å¯¹ä¹‹é—´çš„è·ç¦»çš„æƒ…å†µä¸‹ã€‚åœ¨ç¬¬ 4 è½®ä¸­ï¼Œæˆ‘ä»¬å°†æš‚æ—¶ä»å»ºæ¨¡ä¸­ç»•å¼€ï¼Œ**å¼€å‘ä¸€ä¸ªå…·æœ‰åœ°ç†ç©ºé—´åŠŸèƒ½çš„ç±»**ï¼Œè¿™å°†åœ¨æˆ‘ä»¬å°è¯•è§£å†³**ä¸€èˆ¬æ€§**æ—…è¡Œå•†é—®é¢˜æ—¶éå¸¸æœ‰ç”¨ï¼Œå³å¯¹äºä»»æ„ä½ç½®æˆ‘ä»¬å¯èƒ½æ²¡æœ‰ç°æˆçš„è·ç¦»æ•°æ®çš„é—®é¢˜ã€‚æˆ‘ä»¬åœ¨ä¸Šä¸€è½®ä¸­æå‡ºäº†è¿™ä¸ªâ€œéœ€æ±‚â€ï¼Œå°†åœ¨è¿™ä¸€è½®ä¸­æ„å»ºä¸€ä¸ªå­ç³»ç»Ÿæ¥æ»¡è¶³å®ƒã€‚

# ç›®å½•

## 1. ä¸Šä¸€è½®è¿­ä»£å›é¡¾

## 2. è¯»å–è¾“å…¥æ•°æ®

## 3. ä»ä½ç½®æ•°æ®åˆ›å»ºè·ç¦»çŸ©é˜µ

+   3.1. æˆ‘æ˜¯å¦éœ€è¦ä»˜å‡ºé¢å¤–çš„åŠªåŠ›æ¥è·å¾—é¢å¤–çš„è¿›å±•ï¼Ÿ

+   3.2. å¸¦æœ‰çš„åœ°ç†å®šä½å·¥å…· `geopy`

+   3.3. åˆ°è¾¾è¦ç‚¹

+   3.4. ä»åæ ‡åˆ°è·ç¦»çŸ©é˜µ

## 4. å®Œæˆï¼ï¼ˆç±»å†…éƒ¨ï¼‰

+   4.1. `GeoAnalyzer` ç±»è®¾è®¡

+   4.2. ç±»ä½¿ç”¨æ¼”ç¤º

## 5. ç»“è®ºï¼ˆæˆ–è§„åˆ’ä¸‹ä¸€è½®è¿­ä»£ï¼‰

# 1. ä¸Šä¸€è½®è¿­ä»£å›é¡¾

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå³[sprint 3](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c)ï¼Œæˆ‘ä»¬è¿›è¡Œäº†æ¦‚å¿µéªŒè¯ï¼Œå±•ç¤ºäº†æˆ‘ä»¬å¯ä»¥è§£å†³[æ—…è¡Œå•†é—®é¢˜](https://en.wikipedia.org/wiki/Travelling_salesman_problem)ï¼ˆTSPï¼‰å¯¹äºä¸€ç»„ç«™ç‚¹ï¼Œ*å‰ææ˜¯æˆ‘ä»¬æ‹¥æœ‰æ¯ä¸€å¯¹ç«™ç‚¹ä¹‹é—´çš„è·ç¦»*ï¼Œä½œä¸ºè·ç¦»çŸ©é˜µï¼š

[](/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c?source=post_page-----d5fc92a0ba9e--------------------------------) ## ç”¨ Python å®ç°ã€è§£å†³å’Œå¯è§†åŒ–æ—…è¡Œå•†é—®é¢˜

### å­¦ä¹ å¦‚ä½•å°†ä¼˜åŒ–æ¨¡å‹ä»æ•°å­¦ç¿»è¯‘åˆ° Pythonï¼Œä¼˜åŒ–å®ƒï¼Œå¹¶å¯è§†åŒ–è§£å†³æ–¹æ¡ˆä»¥å¿«é€Ÿè·å¾—ç»“æœâ€¦

towardsdatascience.com

æˆ‘ä»¬å°†è·ç¦»çŸ©é˜µè§†ä¸ºå·²ç»™å®šï¼Œå› ä¸ºåœ¨é‚£ä¸ªå¼€å‘é˜¶æ®µï¼Œé‡ç‚¹æ˜¯*æ¨¡å‹æ„å»º*ï¼Œè€Œä¸æ˜¯*æ•°æ®è·å–*ã€‚ä½†æ˜¯ä¸€æ—¦æ¨¡å‹å‡†å¤‡å¥½å¹¶ä¸”åœ¨æˆ‘ä»¬çš„å›ºå®šåœ°ç‚¹é›†ä¸Šè¿è¡Œè‰¯å¥½ï¼Œæˆ‘ä»¬å¾ˆå¿«æ„è¯†åˆ°**æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥** **è§£å†³ä¸€èˆ¬çš„ TSP é—®é¢˜**ï¼ˆä»»æ„åœ°ç‚¹é›†çš„é—®é¢˜ï¼‰ã€‚è¿™ç§æ³›åŒ–æ˜¯åˆ›å»ºçœŸæ­£æœ‰ç”¨çš„ MVP æ‰€å¿…éœ€çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¾—å‡ºçš„è‡ªç„¶ä¸‹ä¸€æ­¥æ˜¯æ‰¾åˆ°ä¸€ç§**è‡ªåŠ¨ä»æˆ‘ä»¬å…´è¶£ç‚¹çš„åæ ‡ä¸­è·å–è·ç¦»çŸ©é˜µ**çš„æ–¹æ³•ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬å°†åœ¨æœ¬æ–‡ä¸­è®¨è®ºã€‚

è¿™æ ·åšï¼Œæˆ‘ä»¬çš„**æ–°åŸºæœ¬è¾“å…¥**å°†ä¼šç®€å•è‡ªç„¶å¾—å¤šï¼Œåªéœ€æä¾›æˆ‘ä»¬æƒ³è¦è®¿é—®åœ°ç‚¹çš„åœ°ç†åæ ‡ï¼š

![](img/59ec3de04074a9813170b50ccf7fed83.png)

**å›¾ 1.** å…´è¶£ç‚¹çš„åæ ‡ã€‚ ï¼ˆå›¾åƒç”±ä½œè€…æä¾›ï¼‰

è¾“å‡ºå°†æ˜¯æˆ‘ä»¬ç”¨ä½œ TSP æ¨¡å‹è¾“å…¥çš„æ•°æ®æ¡†ï¼Œå³è¾“å…¥åœ°ç‚¹çš„è·ç¦»çŸ©é˜µï¼š

![](img/18f610b518e1fed4161c761c29896bb7.png)

**å›¾ 2.** ç»™å®šä¸€ç»„åœ°ç‚¹çš„æœŸæœ›è·ç¦»çŸ©é˜µã€‚ ï¼ˆå›¾åƒç”±ä½œè€…æä¾›ï¼‰

ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åˆ°ç›®å‰ä¸ºæ­¢è€ƒè™‘çš„ç›¸åŒå·´é»åœ°ç‚¹ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠè¿™ä¸ªåŠŸèƒ½ä¸æ—…è¡Œé”€å”®å‘˜é—®é¢˜çš„ä¼˜åŒ–æ¨¡å‹é›†æˆï¼Œå¾—åˆ°ä¸€ä¸ªæ›´å…·å¤šåŠŸèƒ½æ€§çš„ MVPã€‚

> ***ğŸ¯******ç‰¢è®°æœ€ç»ˆç›®æ ‡***
> 
> *è®©æˆ‘ä»¬ç¨å¾®å›é¡¾ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªã€‚æˆ‘ä»¬æœŸæœ›è§£å†³çš„åŸå§‹å®é™…é—®é¢˜æ˜¯æˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºçš„* ***æ—…è¡Œæ¸¸å®¢é—®é¢˜*** *(TTP)ï¼Œå³ä¸ºä¸€èˆ¬æ¸¸å®¢åˆ¶å®š* ***æœ€ä½³æ—…è¡Œè®¡åˆ’*** *çš„é—®é¢˜ï¼Œ* ***ç»™å®šå¥¹çš„â€œä¸ªäººâ€æ•°æ®*** *(å¦‚åå¥½ã€é¢„ç®—ç­‰)* ***ä»¥åŠæ—…è¡Œâ€œç¯å¢ƒâ€æ•°æ®*** *(å¦‚è·ç¦»ã€ä»·æ ¼ã€äº¤é€šæ–¹å¼ç­‰)ã€‚*
> 
> *ç”±äºè¿™ä¸ªå®é™…é—®é¢˜è¢«è®¤ä¸ºè¿‡äºå¤æ‚ï¼Œæˆ‘ä»¬åœ¨* [*ç¬¬ä¸€ä¸ªå†²åˆº*](https://medium.com/@carlosjuribe/plan-an-optimal-trip-for-your-next-holidays-with-the-help-of-operations-research-and-python-481b1ea38fef)*ä¸­å°†å…¶ç®€åŒ–ä¸ºå…¶æœ¬è´¨ç‰ˆï¼Œä»¥å¯åŠ¨è§£å†³æ–¹æ¡ˆçš„è®¾è®¡ã€‚è¿™ä¸ªâ€œæœ¬è´¨é—®é¢˜â€è¢«è¯æ˜æ˜¯* *æ—…è¡Œé”€å”®å‘˜é—®é¢˜* *(TSP)ï¼Œåœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†è¦è®¿é—®çš„ç‚¹è§†ä¸ºåŸå¸‚ä¸­æ¸¸å®¢çš„â€œå…´è¶£ç‚¹â€ã€‚é€šè¿‡æœ¬æ–‡å¼€å‘çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æ›´æ¥è¿‘äº TTP çš„é€šç”¨è§£å†³æ–¹æ¡ˆï¼Œä»¥ TSP ä½œä¸ºè§£å†³æ–¹æ¡ˆçš„æ ¸å¿ƒã€‚*

# 2\. è¯»å–è¾“å…¥æ•°æ®

æˆ‘ä»¬çš„åŸºæœ¬è¾“å…¥ç°åœ¨æ˜¯æˆ‘ä»¬æ—…è¡Œä¸­æƒ³è¦è®¿é—®çš„åœ°ç‚¹çš„åœ°ç†åæ ‡ã€‚æˆ‘ä»¬å°†â€œé…’åº—â€è§†ä¸ºä¸€ç§ä¸åŒçš„åœ°ç‚¹ï¼Œå› ä¸ºé…’åº—æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªâ€œæ„Ÿå…´è¶£çš„åœ°ç‚¹â€ï¼Œè€Œæ˜¯æˆ‘ä»¬å¿…é¡»åœ¨å¤šæ—¥æ—…è¡Œä¸­åœç•™çš„åœ°æ–¹ã€‚æˆ‘ä»¬çš„é…’åº—é€‰æ‹©å¯èƒ½ä¼šå› ä¸åŒçš„æ—…è¡Œæˆ–ä¸åŒçš„æƒ…å†µè€Œæœ‰æ‰€ä¸åŒï¼Œè€Œä¸€ä¸ªåŸå¸‚ä¸­çš„æ„Ÿå…´è¶£çš„åœ°ç‚¹åˆ™æ˜¯ç›¸å¯¹â€œå›ºå®šâ€çš„åœ°æ–¹ï¼Œè®¸å¤šæ—…è¡ŒæŒ‡å—å¯¹æ­¤æ„è§ä¸€è‡´ã€‚å½“æˆ‘ä»¬å‡†å¤‡æ¢ç´¢æ›´é«˜çº§çš„åº”ç”¨æ—¶ï¼Œè¿™ç§åŒºåˆ†çš„æœ‰ç”¨æ€§å°†å˜å¾—æ›´åŠ æ˜æ˜¾ã€‚

å› æ­¤ï¼Œæˆ‘å°†æˆ‘ä»¬é…’åº—çš„åæ ‡å­˜å‚¨åœ¨ä¸€ä¸ª CSV æ–‡ä»¶ `location_hotel.csv` ä¸­ï¼Œå°†â€œæ„Ÿå…´è¶£åœ°ç‚¹â€çš„åæ ‡å­˜å‚¨åœ¨å¦ä¸€ä¸ª CSV æ–‡ä»¶ `sites_coordinates.csv` ä¸­ã€‚è¿™ä¸¤ä¸ª CSV æ–‡ä»¶å…·æœ‰ç›¸åŒçš„ç»“æ„ï¼Œå› æ­¤æˆ‘ä»¬å°†å®ƒä»¬è¯»å–å¹¶åˆå¹¶æˆä¸€ä¸ªåŒ…å«æ‰€æœ‰åœ°ç‚¹çš„æ•°æ®æ¡†ï¼š

```py
import pandas as pd

print(f"version pandas: {pd.__version__}")

DATA_FOLDER = ("https://raw.githubusercontent.com/carlosjuribe/"
               "traveling-tourist-problem/main/data")
FILE_LOCATION_HOTEL = "location_hotel.csv"
FILE_LOCATION_SITES = "sites_coordinates.csv"

df_sites = pd.concat([
    pd.read_csv(f"{DATA_FOLDER}/{FILE_LOCATION_SITES}", index_col='site'),
    pd.read_csv(f"{DATA_FOLDER}/{FILE_LOCATION_HOTEL}", index_col='site')
])

display(df_sites)
```

![](img/b01c96cdeebff5b18e72e0b390391c18.png)

> ***â„¹ï¸ å¦‚ä½•å¿«é€Ÿå‡†å¤‡è‡ªå·±çš„ä½ç½®æ•°æ®***
> 
> å¦‚æœä½ æƒ³ä½¿ç”¨è‡ªå·±çš„ç½‘ç«™åˆ—è¡¨æ¥è·Ÿéšæœ¬æ–‡ï¼Œä½ éœ€è¦å¤åˆ¶æˆ‘è·å–åæ ‡çš„æ­¥éª¤ï¼š
> 
> 1\. å‰å¾€ [Google Maps](https://www.google.com/maps/) å¹¶æœç´¢ä½ åˆ—è¡¨ä¸­çš„æ¯ä¸ªåœ°ç‚¹ã€‚
> 
> 2\. æ¯ä¸ªåœ°ç‚¹å°†åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºä¸ºä¸€ä¸ªç‚¹ã€‚å³å‡»æ¯ä¸ªç‚¹ã€‚å‡ºç°çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€å¯¹æ•°å­—ï¼šä½ ç‚¹å‡»çš„ç‚¹çš„çº¬åº¦å’Œç»åº¦ã€‚
> 
> 3\. ç‚¹å‡»è¿™äº›æ•°å­—ï¼Œå®ƒä»¬å°†è¢«ä¿å­˜åˆ°ä½ çš„å‰ªè´´æ¿ä¸­ï¼Œå‡†å¤‡ç²˜è´´åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿åŒä½ ä¸ºè¯¥ç‚¹é€‰æ‹©çš„åç§°ä¸€èµ·ã€‚
> 
> 4\. å¯¹æ‰€æœ‰åœ°ç‚¹é‡å¤æ­¥éª¤ 1 åˆ° 3ï¼Œä½ å°†å¾—åˆ°ä¸€ä¸ªç­‰æ•ˆäº `sites_coordinates.csv` çš„æ–‡ä»¶ã€‚
> 
> è¿™ä¸ªè¿‡ç¨‹å¯¹äºå°è§„æ¨¡çš„ç½‘ç«™é›†éå¸¸æœ‰æ•ˆï¼Œä½†å¦‚æœä½ æœ‰æ•°ç™¾ä¸ªï¼Œç”šè‡³å‡ åä¸ªåœ°ç‚¹ï¼Œå®ƒä¼šå˜å¾—éå¸¸ç¹çã€‚åœ¨ [æœªæ¥çš„ä¸€ç¯‡æ–‡ç« ](https://example.org) ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ç§è‡ªåŠ¨åŒ–è¿™ä¸ªæ‰‹åŠ¨å·¥ä½œçš„æ–¹å¼ï¼Œè¿™å«åš*åœ°ç†å®šä½*ã€‚

# 3\. ä»ä½ç½®æ•°æ®åˆ›å»ºè·ç¦»çŸ©é˜µ

è¦æ„å»ºè·ç¦»çŸ©é˜µï¼Œæˆ‘ä»¬éœ€è¦è·å¾—ä»»ä½•ä¸€å¯¹åœ°ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚è¿™å¬èµ·æ¥å¾ˆç®€å•ï¼Œä½†â€œè·ç¦»â€å®é™…ä¸Šå–å†³äºä¸Šä¸‹æ–‡ã€‚æˆ‘ä»¬æ˜¯å¦è€ƒè™‘ç”±å¦‚è°·æ­Œåœ°å›¾è¿™æ ·çš„åœ°å›¾åº”ç”¨ç¨‹åºæŠ¥å‘Šçš„æ•°å­—ï¼Œè¿™äº›åº”ç”¨ç¨‹åºè€ƒè™‘äº†è¡—é“ç½‘ç»œã€æ¡¥æ¢ã€å…¬å›­ï¼Œ*ç­‰ç­‰*ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬è€ƒè™‘æ­¥è¡Œè€…è¡Œèµ°çš„è·ç¦»ï¼Œè¿˜æ˜¯æ±½è½¦è¡Œé©¶çš„è·ç¦»ï¼Ÿæˆ–è€…åªæ˜¯è¿æ¥è¿™ä¸¤ä¸ªç‚¹çš„ç›´çº¿é•¿åº¦ï¼Ÿæ˜¾ç„¶ï¼Œæˆ‘ä»¬æœ‰è®¸å¤šå¯èƒ½çš„è·ç¦»é€‰æ‹©ï¼Œæ¯ç§é€‰æ‹©çš„å‡†ç¡®åº¦ä¸åŒã€‚*æˆ‘ä»¬å¿…é¡»å›ç­”çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯*ï¼š**åœ¨*æˆ‘ä»¬çš„å®é™…é—®é¢˜*çš„ç‰¹å®šèƒŒæ™¯ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®šä¹‰â€œè·ç¦»â€**ï¼Œä»¥åŠåœ¨*è¿™ä¸ªé˜¶æ®µ*ï¼Ÿ

## 3.1\. æˆ‘æ˜¯å¦åº”è¯¥å¤šèŠ±ç‚¹æ—¶é—´ä»¥è·å¾—æ›´å¤šçš„å¥½å¤„ï¼Ÿ

å¾ˆè‡ªç„¶åœ°ï¼Œæˆ‘ä»¬ä¼šè¢«è¯±æƒ‘ä½¿ç”¨å‡†ç¡®çš„æ•°æ®ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å‡†ç¡®æ€§æ˜¯å†…åœ¨æœ‰ä»·å€¼çš„ï¼Œå› æ­¤æˆ‘ä»¬å€¾å‘äºè¿½æ±‚æ›´å‡†ç¡®çš„æ•°æ®ï¼Œè¶Šå¤šè¶Šå¥½ã€‚ä½†æˆ‘ä»¬ä¹Ÿå¿…é¡»è®°ä½ï¼Œæ›´å‡†ç¡®çš„æ•°æ®æ„å‘³ç€æ›´å¤æ‚çš„ä»£ç å’Œä¾èµ–ï¼Œå› æ­¤éœ€è¦æ›´å¤šçš„å¼€å‘æ—¶é—´å’Œç»´æŠ¤ã€‚ç”±äºæˆ‘ä»¬éµå¾ª**æ•æ·çš„æ–¹æ³•**ï¼Œæˆ‘ä»¬ä¸è®©*æœ€ä½³*æˆä¸º*è‰¯å¥½*çš„æ•Œäººï¼Œå› æ­¤**æˆ‘ä»¬å°†å°½å¯èƒ½ç®€å•åœ°å¼€å§‹ï¼Œç„¶åé€æ­¥å¢åŠ å¤æ‚æ€§ï¼Œä»…åœ¨å¿…è¦æ—¶**ã€‚

åœ¨éœ€è¦æ‰¾åˆ°åœ°ç‚¹ä¹‹é—´çš„è·ç¦»æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åƒå¾ˆå¤šäººä¸€æ ·ï¼Œç›´æ¥è·³åˆ°åŸºäºç¬¬ä¸‰æ–¹ API çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™äº›æ–¹æ¡ˆéœ€è¦åº”ç”¨å¯†é’¥ã€å‡­æ®ï¼Œç”šè‡³äº‘æœåŠ¡æä¾›å•†çš„ä¿¡ç”¨å¡å·ç ã€‚è¿™ç§æ–¹æ³•æ˜¯å¯ä»¥çš„ï¼Œä½†å¾€å¾€æ•ˆç‡ä¸é«˜ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šå¿˜è®°**å‡†ç¡®çš„ä¿¡æ¯å¸¦æ¥é™„åŠ ä»·å€¼ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥é™„åŠ æˆæœ¬**ã€‚

> *ğŸ‘ï¸* ***æ²¡æœ‰â€œå…è´¹å‡†ç¡®æ€§â€è¿™ç§äº‹***
> 
> *è®°ä½é€šå¸¸æˆ‘ä»¬æ€»æ˜¯â€œä»˜å‡ºä»£ä»·â€æ¥è·å–å‡†ç¡®çš„æ•°æ®ï¼ˆè¿™ä¸* [***ä¿¡æ¯çš„ä»·å€¼***](https://en.wikipedia.org/wiki/Value_of_information)*) ç´§å¯†ç›¸å…³ï¼‰æ˜¯å¦ä¸€ä¸ªåŸå› ï¼Œä¸ºä»€ä¹ˆé‡‡å–æ•æ·çš„æ–¹æ³•æ¥è§£å†³é—®é¢˜æ˜¯æ›´ç²¾ç®€çš„åšæ³•ã€‚é€šè¿‡* ***ä»ç®€å•å‡è®¾å¼€å§‹*** *å…³äºâ€œ*æ‰€éœ€çš„å‡†ç¡®åº¦*â€ï¼Œå¹¶åœ¨æˆ‘ä»¬è‡ªå·±çš„é—®é¢˜æ•°æ®ä¸ŠéªŒè¯å…¶æœ‰æ•ˆæ€§* ***ï¼Œæˆ‘ä»¬ç¡®ä¿ï¼Œå¦‚æœæˆ‘ä»¬æœ€ç»ˆéœ€è¦æé«˜æ•°æ®çš„å‡†ç¡®æ€§ï¼Œæˆ‘ä»¬å°†â€œä»˜å‡ºä»£ä»·â€ï¼Œè¿™ç§ä»£ä»·æ˜¯* ***å€¼å¾—çš„*** *(é¢„æœŸçš„)* ***æ”¹è¿›ç»“æœ****ã€‚

æ‰€ä»¥æˆ‘ä»¬ä»éå¸¸ç®€å•çš„å¼€å§‹ã€‚æˆ‘ä»¬æœ‰åæ ‡ã€‚**ç¬¬ä¸€ä¸ªæƒ³æ³•**ï¼šè¿™äº›åæ ‡åˆ†å¸ƒåœ¨ç›¸å¯¹äºåœ°çƒåŠå¾„*éå¸¸å°*çš„åœ°çƒçš„åœ°å—ä¸Šï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†çº¬åº¦è§†ä¸º Y åæ ‡ï¼Œå°†ç»åº¦è§†ä¸º X åæ ‡ï¼Œåœ¨äºŒç»´å¹³é¢ä¸Šè¿›è¡Œè®¡ç®—ï¼Œç„¶åè®¡ç®—æ¬§å‡ é‡Œå¾—è·ç¦»ï¼ˆå³é€šå¸¸æ‰€è¯´çš„â€œç›´çº¿â€ï¼‰ã€‚

+   ä¼˜ç‚¹ï¼šç®€å•çš„è·ç¦»å…¬å¼ï¼Œæ²¡æœ‰æ–°çš„ä¾èµ–æˆ–æ•°æ®ï¼Œåœ°ç‚¹ä¹‹é—´çš„ç©ºé—´å…³ç³»è¢«ä¿ç•™ã€‚

+   ç¼ºç‚¹ï¼šçº¬åº¦å’Œç»åº¦æ˜¯æ— é‡çº²çš„æ•°å­—ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è§£å†³é—®é¢˜æ—¶å¾—åˆ°çš„æ•°å­—å°†ä¸æ˜¯å®é™…çš„è·ç¦»ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å…³å¿ƒçš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚æ€»æ—…è¡Œè·ç¦»ï¼Œå³ä½¿æˆ‘ä»¬å¯ä»¥è·å¾—æœ€ä½³è·¯çº¿ï¼Œä¹Ÿä¸ä¼šæä¾›ã€‚

ç¼ºç‚¹èƒœè¿‡ä¼˜ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§æ›´å¤æ‚çš„æ–¹æ³•ï¼ˆ**ä½†ä»ç„¶ç®€å•**ï¼‰ã€‚**ç¬¬äºŒä¸ªæƒ³æ³•**ï¼šå°†åæ ‡è§†ä¸ºå®ƒä»¬æœ¬èº«ï¼Œå³åœ°çƒä¸Šçš„ç‚¹ï¼Œä½†å°†åœ°çƒè¿‘ä¼¼ä¸ºä¸€ä¸ªçƒä½“ã€‚ä¸€ä¸ªçƒä½“æ²¡æœ‰æˆ‘ä»¬ç†Ÿæ‚‰çš„æ¬§å‡ é‡Œå¾—å‡ ä½•ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªéå¹³å‡¡çš„å…¬å¼ï¼Œåœ¨è®¡ç®—ä¸¤ä¸ªç‚¹ä¹‹é—´çš„â€œç›´çº¿â€è·ç¦»æ—¶è€ƒè™‘è¿™ç§çƒé¢å‡ ä½•ã€‚æ‰€ä»¥ç°åœ¨åªéœ€ä½¿ç”¨åœ°çƒçš„åŠå¾„æ¥å®ç°è¿™ä¸ªå…¬å¼ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼Œä½†æˆ‘ä»¬ä¼šä¾èµ–ä¸€ä¸ªå·²ç»åšäº†è¿™ä»¶äº‹çš„è‘—ååº“ï¼Œè€Œä¸”æ•ˆæœæ›´å¥½ã€‚

## 3.2. ä½¿ç”¨ `**geopy**` çš„åœ°ç†ä½ç½®å·¥å…·

å¦‚æœè¿™ç¯‡æ–‡ç« ç³»åˆ—ç‰¹åˆ«å…³æ³¨åœ°ç†ç©ºé—´æ•°æ®ç§‘å­¦ï¼Œé‚£ä¹ˆèŠ±æ—¶é—´è§£é‡Šå’Œå®ç°[å¤§åœ†è·ç¦»](https://en.wikipedia.org/wiki/Great-circle_distance)çš„å…¬å¼å°†æ˜¯æœ‰ä»·å€¼çš„ï¼Œè¿™æ˜¯ä¸€ç§è®¡ç®—çƒé¢ä¸Šä¸¤ç‚¹â€œç›´çº¿â€è·ç¦»çš„è‰¯å¥½åŸºå‡†é€‰é¡¹ã€‚ç„¶è€Œï¼Œè¿™ç¯‡æ–‡ç« ç³»åˆ—å…³äº**åŸºäºä¼˜åŒ–çš„æ—…æ¸¸è§„åˆ’ç³»ç»Ÿ**ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°†ä¾èµ–äº[Geopy](https://geopy.readthedocs.io/en/stable/)æ¥å®Œæˆç¹é‡çš„å·¥ä½œï¼Œè€Œä¸æ˜¯è‡ªåˆ¶åœ°ç†ç©ºé—´å·¥å…·çš„å…¬å¼ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä¸“æ³¨äºå¿«é€Ÿæ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚

é€šè¿‡åœ¨ Anaconda æç¤ºç¬¦ï¼ˆæˆ–åœ¨æˆ‘ä»¬åœ¨[ç¬¬ä¸€ç¯‡æ–‡ç« ](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=For%20organized%20people,in%20this%20series)ä¸­åˆ›å»ºçš„ conda ç¯å¢ƒå†…ï¼‰è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…å®ƒï¼š

```py
conda install -y -c conda-forge geopy=2.3.0
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨ `geopy` å¯¹ä¸¤ä¸ªä½ç½®è¿›è¡Œæ¼”ç¤ºã€‚

## 3.3\. åˆ°è¾¾è¦ç‚¹

ç»™å®šä¸¤ç‚¹çš„åæ ‡ï¼Œ`[geodesic](https://geopy.readthedocs.io/en/stable/#geopy.distance.geodesic)` å‡½æ•°å¯ä»¥è®¡ç®—å®ƒä»¬ä¹‹é—´çš„åœ°çƒè¡¨é¢æœ€çŸ­è·ç¦»ã€‚åœ¨å‡ ä½•å­¦ä¸­ï¼Œ[*æµ‹åœ°çº¿*](https://en.wikipedia.org/wiki/Geodesic) æ˜¯åœ¨ç»™å®š[åº¦é‡ç©ºé—´](https://en.wikipedia.org/wiki/Metric_space)ä¸Šä¸¤ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ã€‚åœ¨æˆ‘ä»¬ç†Ÿæ‚‰çš„æ¬§å‡ é‡Œå¾—ç©ºé—´ä¸­ï¼Œ**ç›´çº¿**å°±æ˜¯æµ‹åœ°çº¿ã€‚åœ¨çƒé¢ç©ºé—´ä¸­ï¼Œ**å¤§åœ†**æ˜¯æµ‹åœ°çº¿ã€‚Geopy çš„ `geodesic` å‡½æ•°æ‰€è€ƒè™‘çš„åŸºç¡€â€œç©ºé—´â€æ˜¯**åœ°çƒçš„ç²¾ç¡®æ¤­çƒæ¨¡å‹**ã€‚

> ***ğŸ‘ å¤§åœ†å¾ˆæ£’ï¼Œä½†æ¤­åœ†æ›´æ£’***
> 
> *ä¹‹å‰æˆ‘è¯´è¿‡ï¼Œæˆ‘ä»¬å°†åœ°çƒè§†ä¸ºä¸€ä¸ªçƒä½“ï¼Œå› ä¸ºè¿™æ˜¯æœ€ç®€å•çš„å¯è¡Œè¿‘ä¼¼ã€‚å®é™…ä¸Šï¼Œåœ°çƒå¹¶ä¸æ˜¯ä¸€ä¸ªçƒä½“ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¤­çƒä½“ï¼Œæ˜¯ä¸€ç§å…·æœ‰æ›´å¤æ‚å‡ ä½•å½¢çŠ¶çš„å›ºä½“ã€‚ç°åœ¨`*geopy*`*å°†å…äºæˆ‘ä»¬ä¸ºéæ¬§å‡ é‡Œå¾—å‡ ä½•ç¼–å†™è‡ªå·±çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å‡çº§å¯¹åœ°çƒçš„è¿‘ä¼¼ï¼Œå¹¶ä½¿ç”¨æ›´ç²¾ç¡®çš„* ***æ¤­çƒè·ç¦»*** *æ¥ä»£æ›¿å¤§åœ†è·ç¦»ã€‚å¯¹äºç›¸åŒçš„ä»£ç è¡Œï¼Œè¿™ç¡®å®æ˜¯å…è´¹çš„ç²¾ç¡®åº¦ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸ä½¿ç”¨å‘¢ï¼Ÿ*

è¿™æ˜¯ä¸€ä¸ªè®¡ç®—ç‚¹ 1 å’Œç‚¹ 2 ä¹‹é—´æ¤­çƒè·ç¦»çš„å‡½æ•°ï¼Œå•ä½ä¸ºç±³ï¼š

```py
from geopy.distance import geodesic

def ellipsoidal_distance(p1, p2) -> float:
    """ Calculate distance (in meters) between p1 and p2, where 
    each point is represented as a tuple (lat, lon) """
    return geodesic(p1, p2).meters
```

åŸƒè²å°”é“å¡”å’Œå¢æµ®å®«ä¹‹é—´çš„è·ç¦»æ˜¯å¤šå°‘ï¼Ÿ

```py
p1 = df_sites.loc['Tour Eiffel']
p2 = df_sites.loc['Louvre']

ellipsoidal_distance(p1, p2)  # output: 3173.119635531859
```

3173 ç±³ï¼Œå¤§çº¦ 3.2 å…¬é‡Œã€‚è°·æ­Œåœ°å›¾æ˜¾ç¤ºä¸º 3.5 å…¬é‡Œã€‚**è®¡ç®—**çš„è·ç¦»æ¯”â€œ**çœŸå®**â€è·ç¦»ä½ 8.6%ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬çš„è…¿åªå…³å¿ƒè·ç¦»çš„*ç»å¯¹è¯¯å·®*ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæ¯”ä¼°ç®—è·ç¦»å¤šèµ°äº† 330 ç±³ï¼Œå¯¹æœŸæœ›å…¨å¤©åœ¨å¤§åŸå¸‚æ­¥è¡Œçš„æ¸¸å®¢æ¥è¯´ï¼Œè¿™ä¼¼ä¹ä¸æ˜¯ä¸€ä¸ªæ˜¾è‘—çš„è¯¯å·®ã€‚

é‚£ä¹ˆåŸƒè²å°”é“å¡”å’Œè‹å¼—ä¼¦æ¸¯ä¹‹é—´å‘¢ï¼Ÿ

```py
ellipsoidal_distance(
    df_sites.loc['Tour Eiffel'],
    df_sites.loc['Port de Suffren']
)  # output: 328.3147101635456
```

328 ç±³ï¼Œè¿™æ¬¡æ¯” Google Maps æä¾›çš„ 350 ç±³ä½ 6%ï¼ˆä»… 22 ç±³çŸ­ï¼‰ã€‚å¯¹äºåº”ç”¨ä¸€ä¸ªå…¬å¼æ¥è¯´ï¼Œè¿™è¿˜ä¸é”™ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€é¢„æœŸçš„ï¼Œç‚¹è¶Šè¿‘ï¼Œè¡—é“å‡ºç°ä¹‹ç±»çš„æ›²æŠ˜è½¬å¼¯çš„æœºä¼šè¶Šå°ï¼Œå› æ­¤æ¤­çƒæ¨¡å‹äº§ç”Ÿçš„è¯¯å·®ä¹Ÿè¶Šå°ã€‚å¯¹äºæˆ‘ä»¬ç›®å‰çš„ç›®çš„æ¥çœ‹ï¼Œæ˜¾å¾—**è¶³å¤Ÿå¥½**ã€‚

ç°åœ¨æˆ‘ä»¬å¿…é¡»å°†è¿™ä¸ªå‡½æ•°åº”ç”¨äºæ‰€æœ‰ä½ç½®å¯¹ï¼Œä»è€Œå¾—åˆ° TSP æ¨¡å‹æ‰€éœ€çš„è·ç¦»çŸ©é˜µã€‚

## 3.4\. ä»åæ ‡åˆ°è·ç¦»çŸ©é˜µ

è¿™éƒ¨åˆ†å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€å¯¹æ‰€æœ‰ç«™ç‚¹è¿›è¡Œä¸¤æ¬¡å¾ªç¯ï¼Œè®¡ç®—å¹¶å­˜å‚¨æ¯å¯¹ä¹‹é—´çš„è·ç¦»ã€‚ä¸‹é¢çš„å‡½æ•°å°±æ˜¯è¿™æ ·åšçš„ã€‚æ³¨æ„ï¼Œè·ç¦»åº¦é‡ä½œä¸ºå¯é€‰å‚æ•°ä¼ é€’ï¼Œé»˜è®¤æ˜¯æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æ¤­çƒè·ç¦»ã€‚æˆ‘ä»¬ç•™ç€ä»¥åä¼ é€’æ›´å¥½çš„è·ç¦»åº¦é‡çš„å¯èƒ½æ€§ã€‚

```py
def compute_distance_matrix(df_sites, dist_metric=ellipsoidal_distance):
    """ Creates an N x N distance matrix from a dataframe of N locations 
    with a latitute column and a longitude column """
    df_dist_matrix = pd.DataFrame(index=df_sites.index, 
                                  columns=df_sites.index)

    for orig, orig_loc in df_sites.iterrows():  # for each origin
        for dest, dest_loc in df_sites.iterrows():  # for each destination
            df_dist_matrix.at[orig, dest] = dist_metric(orig_loc, dest_loc)
    return df_dist_matrix

df_distances = compute_distance_matrix(df_sites)

display(df_distances)
```

![](img/dc8c5a88bbc2fe418177b846e152407c.png)

**å›¾ 3.** ä½¿ç”¨åœ°çƒæ¤­çƒæ¨¡å‹å¾—åˆ°çš„è·ç¦»çŸ©é˜µã€‚ï¼ˆå›¾åƒæ¥æºï¼šä½œè€…ï¼‰

å°±è¿™æ ·ï¼æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼ŒçŸ©é˜µçš„å¯¹è§’çº¿ä¸ºé›¶ï¼ŒçŸ©é˜µæ˜¯å¯¹ç§°çš„ã€‚è¾“å‡ºæ•°æ®æ¡†çš„ç´¢å¼•å’Œåˆ—åŒ…å«è¾“å…¥ç«™ç‚¹çš„åç§°ã€‚

åŠŸèƒ½æ¼”ç¤ºå®Œæ¯•ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°æ–¹ä¾¿ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚è®©æˆ‘ä»¬ä»¥ä¸€ç§ä¾¿æ·çš„æ–¹å¼å°†è¿™ä¸ªåŠŸèƒ½å°è£…åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œ**ä»¥ä¾¿äºé‡å¤ä½¿ç”¨**ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œ**ä¸ºäº†æ›´å®¹æ˜“ä¸æˆ‘ä»¬åœ¨ä¸Šä¸€ä¸ªå†²åˆºä¸­æ„å»ºçš„ TSP ä¼˜åŒ–æ¨¡å‹é›†æˆ**ã€‚

# 4\. æ€»ç»“ï¼(åœ¨ç±»å†…éƒ¨)

## 4.1\. `GeoAnalyzer` ç±»è®¾è®¡

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œ`GeoAnalyzer`ï¼Œä¸“é—¨ç”¨äºå¤„ç†å¯èƒ½å‡ºç°åœ¨è·¯ç”±é—®é¢˜ä¸­çš„åœ°ç†ç©ºé—´å·¥å…·ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„å‡½æ•°`compute_distance_matrix`è‡ªç„¶åœ°ä½œä¸ºä¸€ä¸ªæ–¹æ³•åµŒå…¥å…¶ä¸­ã€‚è¿™ä¸ªç±»çš„ä¸»è¦éƒ¨åˆ†ç›®å‰å°†åŒ…æ‹¬ï¼š

+   åŒ…å«ç«™ç‚¹ä½ç½®çš„æ•°æ®æ¡†ï¼Œå±æ€§ä¸º`_df_locations`ã€‚

+   çº¯å‡½æ•°`ellipsoidal_distance`ã€‚

+   æ–¹æ³•`get_distance_matrix`ï¼Œç­‰åŒäºä¹‹å‰çš„å‡½æ•°`compute_distance_matrix`ï¼Œä½†ä½¿ç”¨å®ä¾‹å±æ€§`_df_locations`æ¥è®¡ç®—è·ç¦»ã€‚

ç”±äºç”¨æˆ·å¯èƒ½å¸Œæœ›åœ¨åˆ†æçš„ä»»ä½•æ—¶åˆ»æ·»åŠ æ–°ä½ç½®ï¼Œæˆ‘ä»¬åŒ…æ‹¬äº†ä¸€ä¸ªåä¸º`add_locations`çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªåœ°ç†åæ ‡çš„æ•°æ®æ¡†ï¼Œå¹¶å°†å…¶é™„åŠ åˆ°å…ˆå‰å­˜åœ¨çš„æ•°æ®æ¡†ä¸­ã€‚

ä¸‹é¢å¯ä»¥æ‰¾åˆ°`GeoAnalyzer`çš„å®šä¹‰ã€‚æ³¨æ„è¿™é‡Œè¿˜æœ‰å…¶ä»–ä¾¿åˆ©çš„æ–¹æ³•å’Œå±æ€§æœªæåŠã€‚

```py
from typing import Tuple

import pandas as pd
from geopy.distance import geodesic

class GeoAnalyzer:
    """ Utils for geolocation information and processing """  
    _GeoPoint = Tuple[float, float]

    def __init__(self):
        """ Use method `add_locations` to store some locations inside 
        and start using the geo-utilities """
        self._df_locations = pd.DataFrame(columns=['latitude', 'longitude'])

    #####################   distances   #####################
    @staticmethod
    def ellipsoidal_distance(point1: _GeoPoint, point2: _GeoPoint) -> float:
        """ Calculate ellipsoidal distance (in meters) between point1 
        and point2 where each point is represented as a tuple (lat, lon)
        """
        return geodesic(point1, point2).meters
    #########################################################

    @property
    def locations(self):
        return self._df_locations

    @property
    def num_locations(self):
        return len(self._df_locations)

    def add_locations(self, df_locations: pd.DataFrame):
        """ Geo-location data needed for analysis.
        Parameters
        ----------
        df_locations : pd.DataFrame
            Dataframe of geographical coordinates with the first column 
            named 'latitude' and the second column named 'longitude'
        """
        self._name_index = df_locations.index.name
        df_updated = pd.concat([self._df_locations, df_locations.copy()])
        # drop duplicates just in case the user adds repeated locations
        self._df_locations = df_updated.drop_duplicates()

    def get_distance_matrix(self, precision: int = 4) -> pd.DataFrame:
        """ Computes the distance matrix as a dataframe based on the 
        provided location data """
        df_locations = self._df_locations
        dist_metric = self.ellipsoidal_distance  # only distance available

        # initialize matrix df
        df_dist_matrix = pd.DataFrame(index=df_locations.index, 
                                      columns=df_locations.index)
        # for each origin and destination pair, compute distance
        for orig, orig_loc in df_locations.iterrows():
            for dest, dest_loc in df_locations.iterrows():
                distance = round(dist_metric(orig_loc, dest_loc), precision)
                df_dist_matrix.at[orig, dest] = distance

        # a bit of metadata doesn't hurt
        df_dist_matrix.distance_metric = dist_metric.__name__
        df_dist_matrix.index.name = self._name_index
        return df_dist_matrix    

    def __repr__(self):
        """ Display number of currently considered locations """
        return f"{self.__class__.__name__}(n_locs={self.num_locations})"
```

## 4.2\. ç±»ä½¿ç”¨æ¼”ç¤º

è®©æˆ‘ä»¬ç¨å¾®æ¢ç´¢ä¸€ä¸‹è¿™ä¸ªç±»çš„ä¸»è¦åŠŸèƒ½ã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®ä¾‹å¹¶ä»å·´é»æ·»åŠ æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç«™ç‚¹ï¼š

```py
geo_analyzer = GeoAnalyzer()
geo_analyzer.add_locations(df_sites)
```

æˆ‘ä»¬æ£€æŸ¥æ­¤æ—¶å®ä¾‹çš„è¡¨ç¤ºï¼Œå‘ŠçŸ¥æˆ‘ä»¬å·²ç»æä¾›äº† 9 ä¸ªä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å±æ€§`locations`æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š

```py
display(geo_analyzer)
display(geo_analyzer.locations)
```

![](img/eeb4a74be1a03f64e941620e2256c7c0.png)

å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»å¯¹è±¡ä¸­æå–è·ç¦»çŸ©é˜µï¼Œåˆ°ç›®å‰ä¸ºæ­¢è¿™å·²ç»ç›¸å½“ç†Ÿæ‚‰äº†ï¼š

```py
df_distances = geo_analyzer.get_distance_matrix()

display(df_distances)
```

![](img/dc8c5a88bbc2fe418177b846e152407c.png)

æœ€åï¼Œå¦‚æœæˆ‘ä»¬å¯¹è¿™äº›å€¼çš„æ¥æºæ„Ÿåˆ°å¥½å¥‡ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ•°æ®æ¡†æœ¬èº«è¿›è¡Œæ£€æŸ¥ï¼š

```py
print(f"Distance metric used: {df_distances.distance_metric}")
# [Out]: Distance metric used: ellipsoidal_distance
```

å¦‚æœæœ‰æ›´å¤šçš„è·ç¦»åº¦é‡å¯ç”¨ï¼Œè¿™å°†æ›´åŠ æœ‰ä»·å€¼ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨æœªæ¥å†²åˆºä¸­å°†çœ‹åˆ°çš„å†…å®¹ã€‚

## 5\. ç»“è®ºï¼ˆæˆ–ä¸ºä¸‹ä¸€ä¸ªå†²åˆºåšè®¡åˆ’ï¼‰

æˆ‘ä»¬å·¥ä½œçš„æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªåä¸º `GeoAnalyzer` çš„ç±»ï¼Œå…·æœ‰ä¾¿æ·çš„æ–¹æ³•ï¼Œå¸®åŠ©æˆ‘ä»¬å°†æ—…è¡Œæ¨é”€å‘˜é—®é¢˜æ¨å¹¿åˆ°ä»»æ„çš„ç«™ç‚¹é›†åˆã€‚è¿™ä¸ªæ¨å¹¿å°†æ˜¯æˆ‘ä»¬[ä¸‹ä¸€ä¸ªå†²åˆº](https://medium.com/@carlosjuribe/a-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9)çš„å…·ä½“ç›®æ ‡ï¼Œ**æˆ‘ä»¬å°†ä¸º TSP åˆ›å»ºä¸€ä¸ªç±»ä¼¼ä¼°ç®—å™¨çš„ç±»**ï¼Œå®ƒéšè—äº†åœ¨[sprint 2](https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c)ä¸­æ¶‰åŠçš„æ¨¡å‹æ„å»ºæ­¥éª¤ï¼Œå¹¶ä»¥å¾…è®¿é—®ç«™ç‚¹çš„åœ°ç†åæ ‡ä½œä¸ºè¾“å…¥ã€‚`GeoAnalyzer` ç±»å°†æ˜¯è¿™ä¸ªæ–°ä¼°ç®—å™¨ç±»çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œ**å®ç°æˆ‘ä»¬æ‰€æ„å»ºçš„ TSP ä¼˜åŒ–æ¨¡å‹çš„çœŸæ­£é€šç”¨åº”ç”¨**ã€‚è¿™ä¸ªæ–°çš„ç±»ä¼¼ä¼°ç®—å™¨çš„ç±»ï¼Œå°†ç»“åˆ `GeoAnalyzer` å’Œ TSP æ¨¡å‹çš„é€šç”¨æ€§ï¼Œå°†æˆä¸ºæˆ‘ä»¬è§£å†³æ›´ä¸€èˆ¬çš„**æ—…è¡Œæ¸¸å®¢é—®é¢˜**çš„æ ¸å¿ƒã€‚ç»§ç»­é˜…è¯»[ä¸‹ä¸€ä¸ªå†²åˆº](https://medium.com/@carlosjuribe/a-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9)ï¼Œäº†è§£çœŸæ­£çš„å†…å®¹ï¼š

[](/a-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9?source=post_page-----d5fc92a0ba9e--------------------------------) ## ä¸€ç§ä¼˜é›…çš„æ–¹æ³•æ¥æœ‰æ•ˆè§£å†³æ—…è¡Œæ¨é”€å‘˜é—®é¢˜ï¼Œä½¿ç”¨ Python

### ä»¥ç±»ä¼¼ scikit-learn çš„æ–¹å¼å®ç° TSP æ¨¡å‹ï¼Œä»¥ç®€åŒ–è·¯ç”±ä¼˜åŒ–çš„æ„å»ºå’Œè§£å†³è¿‡ç¨‹â€¦

towardsdatascience.com

éšæ—¶å…³æ³¨æˆ‘ï¼Œå‘æˆ‘æé—®ï¼Œ**ç»™æˆ‘åé¦ˆ**ï¼Œæˆ–é€šè¿‡[LinkedIn](https://www.linkedin.com/in/carlosjuribe/)ä¸æˆ‘è”ç³»ã€‚æ„Ÿè°¢é˜…è¯»ï¼ğŸ“ˆğŸ˜Š
