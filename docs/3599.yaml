- en: The Principled Approach to Early Ranking Stages
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¯¹æ—©æœŸæ’åºé˜¶æ®µçš„åŸåˆ™æ€§æ–¹æ³•
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/the-principled-approach-to-early-ranking-stages-05ce49692f7c?source=collection_archive---------7-----------------------#2023-12-06](https://towardsdatascience.com/the-principled-approach-to-early-ranking-stages-05ce49692f7c?source=collection_archive---------7-----------------------#2023-12-06)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/the-principled-approach-to-early-ranking-stages-05ce49692f7c?source=collection_archive---------7-----------------------#2023-12-06](https://towardsdatascience.com/the-principled-approach-to-early-ranking-stages-05ce49692f7c?source=collection_archive---------7-----------------------#2023-12-06)
- en: A systematic method for designing and evaluating candidate generation and early
    ranking stages in recommender systems, with an in-depth analysis of the core guiding
    principle.
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä¸€ç§ç³»ç»ŸåŒ–çš„æ–¹æ³•ç”¨äºè®¾è®¡å’Œè¯„ä¼°æ¨èç³»ç»Ÿä¸­çš„å€™é€‰ç”Ÿæˆå’Œæ—©æœŸæ’åºé˜¶æ®µï¼Œå¹¶å¯¹æ ¸å¿ƒæŒ‡å¯¼åŸåˆ™è¿›è¡Œæ·±å…¥åˆ†æã€‚
- en: '[](https://roizner.medium.com/?source=post_page-----05ce49692f7c--------------------------------)[![Michael
    Roizner](../Images/bcb68ee626ea57234b62e512ed4b383b.png)](https://roizner.medium.com/?source=post_page-----05ce49692f7c--------------------------------)[](https://towardsdatascience.com/?source=post_page-----05ce49692f7c--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----05ce49692f7c--------------------------------)
    [Michael Roizner](https://roizner.medium.com/?source=post_page-----05ce49692f7c--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://roizner.medium.com/?source=post_page-----05ce49692f7c--------------------------------)[![Michael
    Roizner](../Images/bcb68ee626ea57234b62e512ed4b383b.png)](https://roizner.medium.com/?source=post_page-----05ce49692f7c--------------------------------)[](https://towardsdatascience.com/?source=post_page-----05ce49692f7c--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----05ce49692f7c--------------------------------)
    [Michael Roizner](https://roizner.medium.com/?source=post_page-----05ce49692f7c--------------------------------)'
- en: Â·
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1bee5af37d8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-principled-approach-to-early-ranking-stages-05ce49692f7c&user=Michael+Roizner&userId=1bee5af37d8&source=post_page-1bee5af37d8----05ce49692f7c---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----05ce49692f7c--------------------------------)
    Â·9 min readÂ·Dec 6, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F05ce49692f7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-principled-approach-to-early-ranking-stages-05ce49692f7c&user=Michael+Roizner&userId=1bee5af37d8&source=-----05ce49692f7c---------------------clap_footer-----------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[å…³æ³¨](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1bee5af37d8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-principled-approach-to-early-ranking-stages-05ce49692f7c&user=Michael+Roizner&userId=1bee5af37d8&source=post_page-1bee5af37d8----05ce49692f7c---------------------post_header-----------)
    å‘è¡¨åœ¨ [Towards Data Science](https://towardsdatascience.com/?source=post_page-----05ce49692f7c--------------------------------)
    Â·9åˆ†é’Ÿé˜…è¯»Â·2023å¹´12æœˆ6æ—¥[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F05ce49692f7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-principled-approach-to-early-ranking-stages-05ce49692f7c&user=Michael+Roizner&userId=1bee5af37d8&source=-----05ce49692f7c---------------------clap_footer-----------)'
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F05ce49692f7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-principled-approach-to-early-ranking-stages-05ce49692f7c&source=-----05ce49692f7c---------------------bookmark_footer-----------)'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F05ce49692f7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-principled-approach-to-early-ranking-stages-05ce49692f7c&source=-----05ce49692f7c---------------------bookmark_footer-----------)'
- en: 'It is well known that in recommendation systems, there are several stages of
    building recommendations: first comes candidate generation, also often referred
    to as retrieval, followed by one or more stages of ranking. Academic papers do
    not pay much attention to the early stages. But in practice, they are quite important.
    And it is important how to measure their quality.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨æ¨èç³»ç»Ÿä¸­ï¼Œæ„å»ºæ¨èæœ‰å‡ ä¸ªé˜¶æ®µï¼šé¦–å…ˆæ˜¯å€™é€‰ç”Ÿæˆï¼Œä¹Ÿå¸¸è¢«ç§°ä¸ºæ£€ç´¢ï¼Œå…¶æ¬¡æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ’åºé˜¶æ®µã€‚å­¦æœ¯è®ºæ–‡å¯¹æ—©æœŸé˜¶æ®µå…³æ³¨ä¸å¤šï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™äº›é˜¶æ®µéå¸¸é‡è¦ã€‚å¦‚ä½•è¡¡é‡å®ƒä»¬çš„è´¨é‡ä¹ŸåŒæ ·é‡è¦ã€‚
- en: '![](../Images/ed86ca54d33ececba5f454e7890cc56a.png)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ed86ca54d33ececba5f454e7890cc56a.png)'
- en: Illustration by the author
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æ’å›¾
- en: 'Candidate generation is most often organized as a combination of different
    sources:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: å€™é€‰ç”Ÿæˆé€šå¸¸æ˜¯ç”±ä¸åŒæ¥æºçš„ç»„åˆæ¥ç»„ç»‡çš„ï¼š
- en: the most popular items,
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æœ€å—æ¬¢è¿çš„é¡¹ç›®ï¼Œ
- en: similar to the userâ€™s history,
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç±»ä¼¼äºç”¨æˆ·çš„å†å²è®°å½•ï¼Œ
- en: '[ANN](https://en.wikipedia.org/wiki/Nearest_neighbor_search) â€” similar by embeddings
    (for example, [HNSW](https://github.com/nmslib/hnswlib)),'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[ANN](https://en.wikipedia.org/wiki/Nearest_neighbor_search) â€” é€šè¿‡åµŒå…¥ç›¸ä¼¼ï¼ˆä¾‹å¦‚ï¼Œ[HNSW](https://github.com/nmslib/hnswlib)ï¼‰ï¼Œ'
- en: 'a combination of the previous methods at different levels: for instance, taking
    categories from the userâ€™s history (or from ANN, or popular ones), and then selecting
    popular items from them.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åœ¨ä¸åŒå±‚æ¬¡ä¸Šç»“åˆä¹‹å‰çš„æ–¹æ³•ï¼šä¾‹å¦‚ï¼Œä»ç”¨æˆ·çš„å†å²è®°å½•ï¼ˆæˆ–ANNï¼Œæˆ–çƒ­é—¨é¡¹ç›®ï¼‰ä¸­æå–ç±»åˆ«ï¼Œç„¶åä»ä¸­é€‰æ‹©æµè¡Œçš„é¡¹ç›®ã€‚
- en: 'Although each method here might not be complex on its own, the entire combination
    turns out to be quite non-trivial, prompting one to think: how can it be optimized?
    To do this, of course, itâ€™s necessary to define what exactly needs to be optimized,
    i.e., what metric should be used to measure the quality of candidate generation.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡æ¯ç§æ–¹æ³•æœ¬èº«å¯èƒ½ä¸å¤æ‚ï¼Œä½†æ•´ä½“ç»„åˆå´ç›¸å½“å¤æ‚ï¼Œä¿ƒä½¿äººä»¬æ€è€ƒï¼šå¦‚ä½•ä¼˜åŒ–å®ƒï¼Ÿè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå½“ç„¶éœ€è¦å®šä¹‰ç©¶ç«Ÿéœ€è¦ä¼˜åŒ–ä»€ä¹ˆï¼Œå³åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæŒ‡æ ‡æ¥è¡¡é‡å€™é€‰ç”Ÿæˆçš„è´¨é‡ã€‚
- en: Although our discussion focuses on the candidate generation phase, itâ€™s worth
    noting that these principles can equally apply to all early ranking stages, as
    they also provide candidates for subsequent stages.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡æˆ‘ä»¬çš„è®¨è®ºé›†ä¸­åœ¨å€™é€‰ç”Ÿæˆé˜¶æ®µï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›åŸåˆ™åŒæ ·é€‚ç”¨äºæ‰€æœ‰æ—©æœŸæ’åé˜¶æ®µï¼Œå› ä¸ºå®ƒä»¬ä¹Ÿä¸ºåç»­é˜¶æ®µæä¾›å€™é€‰é¡¹ã€‚
- en: There are various approaches. Sometimes the quality is simply not measured (or
    just â€˜eyeballedâ€™) and this stage is not systematically optimized. Sometimes, the
    overall relevance of the candidates is measured in some way. If the system recommends
    something odd, it is also considered indicative of a bug in candidate generation.
    Sometimes, this relevance is even contrasted with what is optimized in the final
    stage. That is, the candidates should already be sufficiently relevant, no matter
    how measured, and the final ranking will select the most engaging ones (attractive,
    clickable, etc.)
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰å¤šç§æ–¹æ³•ã€‚æœ‰æ—¶è´¨é‡æ ¹æœ¬æ²¡æœ‰è¢«è¡¡é‡ï¼ˆæˆ–ä»…å‡­ç›®æµ‹ï¼‰ï¼Œè¿™ä¸€é˜¶æ®µä¹Ÿæ²¡æœ‰ç³»ç»Ÿåœ°ä¼˜åŒ–ã€‚æœ‰æ—¶ï¼Œä¼šä»¥æŸç§æ–¹å¼è¡¡é‡å€™é€‰é¡¹çš„æ•´ä½“ç›¸å…³æ€§ã€‚å¦‚æœç³»ç»Ÿæ¨èä¸€äº›å¼‚å¸¸å†…å®¹ï¼Œè¿™ä¹Ÿè¢«è®¤ä¸ºæ˜¯å€™é€‰ç”Ÿæˆä¸­çš„ä¸€ä¸ªé—®é¢˜ã€‚æœ‰æ—¶ï¼Œè¿™ç§ç›¸å…³æ€§ç”šè‡³ä¸æœ€ç»ˆé˜¶æ®µä¼˜åŒ–çš„å†…å®¹è¿›è¡Œå¯¹æ¯”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå€™é€‰é¡¹åº”è¯¥å·²ç»è¶³å¤Ÿç›¸å…³ï¼Œæ— è®ºå¦‚ä½•è¡¡é‡ï¼Œæœ€ç»ˆæ’åå°†é€‰æ‹©æœ€å…·å¸å¼•åŠ›çš„ï¼ˆæœ‰å¸å¼•åŠ›çš„ã€å¯ç‚¹å‡»çš„ç­‰ï¼‰ã€‚
- en: 'Sometimes, especially in papers, metrics like *HitRate@k*, *Recall@k*, *Precision@k*,
    *MRR*, *NDCG*, etc., are used, focusing only on positive (relevant) documents.
    A document is considered relevant if the user subsequently interacted with it.
    I prefer this approach over the previous ones, although there is a significant
    issue with various biases: for example, users tend to interact more frequently
    with items that the system itself recommends.'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰æ—¶ï¼Œç‰¹åˆ«æ˜¯åœ¨è®ºæ–‡ä¸­ï¼Œä¼šä½¿ç”¨*HitRate@k*ã€*Recall@k*ã€*Precision@k*ã€*MRR*ã€*NDCG*ç­‰æŒ‡æ ‡ï¼Œä»…å…³æ³¨æ­£å‘ï¼ˆç›¸å…³ï¼‰æ–‡æ¡£ã€‚å¦‚æœç”¨æˆ·éšåä¸æŸä¸ªæ–‡æ¡£è¿›è¡Œäº’åŠ¨ï¼Œåˆ™è®¤ä¸ºè¯¥æ–‡æ¡£æ˜¯ç›¸å…³çš„ã€‚æˆ‘æ›´å€¾å‘äºè¿™ç§æ–¹æ³•ï¼Œä½†å®ƒå­˜åœ¨æ˜¾è‘—çš„åå·®é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·å¾€å¾€ä¼šä¸ç³»ç»Ÿæ¨èçš„é¡¹ç›®è¿›è¡Œæ›´å¤šäº’åŠ¨ã€‚
- en: At some point, I attempted to formulate a different approach to candidate generation
    and have since been an advocate of it. Fortunately, I am not the only one â€” this
    approach is already in use in various systems (for example, as detailed in [this
    article about scaling Instagramâ€™s Explore recommendations system](https://engineering.fb.com/2023/08/09/ml-applications/scaling-instagram-explore-recommendations-system/)).
    However, I am not sure it can be called an industry standard â€” there are definitely
    major systems where it is not used.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰ä¸€æ®µæ—¶é—´ï¼Œæˆ‘å°è¯•åˆ¶å®šä¸€ç§ä¸åŒçš„å€™é€‰ç”Ÿæˆæ–¹æ³•ï¼Œå¹¶ä¸€ç›´æ”¯æŒå®ƒã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä¸æ˜¯å”¯ä¸€çš„æ”¯æŒè€… â€” è¿™ç§æ–¹æ³•å·²åœ¨å„ç§ç³»ç»Ÿä¸­ä½¿ç”¨ï¼ˆä¾‹å¦‚ï¼Œ[è¿™ç¯‡å…³äºæ‰©å±•Instagram
    Exploreæ¨èç³»ç»Ÿçš„æ–‡ç« ](https://engineering.fb.com/2023/08/09/ml-applications/scaling-instagram-explore-recommendations-system/)ä¸­è¯¦ç»†ä»‹ç»ï¼‰ã€‚ç„¶è€Œï¼Œæˆ‘ä¸ç¡®å®šå®ƒæ˜¯å¦å¯ä»¥ç§°ä¸ºè¡Œä¸šæ ‡å‡†
    â€” ç¡®å®æœ‰ä¸€äº›ä¸»è¦ç³»ç»Ÿæ²¡æœ‰ä½¿ç”¨å®ƒã€‚
- en: 'The approach is based on the following principle:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: è¯¥æ–¹æ³•åŸºäºä»¥ä¸‹åŸåˆ™ï¼š
- en: '***The main goal of the early stages is to find the best documents from the
    perspective of the final ranking.***'
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***æ—©æœŸé˜¶æ®µçš„ä¸»è¦ç›®æ ‡æ˜¯ä»æœ€ç»ˆæ’åçš„è§’åº¦æ‰¾åˆ°æœ€ä½³æ–‡æ¡£ã€‚***'
- en: Or, in simple terms, the goal is to find the top. The top is defined not by
    any relevance, but simply by the current final ranker. The candidates that are
    ultimately selected by the final ranker are good, the others not so much. If the
    ranker changes (and it can change quite often), then the assessment of quality
    changes as well.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: ç®€è€Œè¨€ä¹‹ï¼Œç›®æ ‡æ˜¯æ‰¾åˆ°æœ€ä½³çš„æ–‡æ¡£ã€‚æœ€ä½³çš„å®šä¹‰ä¸æ˜¯åŸºäºä»»ä½•ç›¸å…³æ€§ï¼Œè€Œæ˜¯ç”±å½“å‰æœ€ç»ˆæ’åºå™¨æ¥å†³å®šã€‚æœ€ç»ˆç”±æ’åºå™¨é€‰æ‹©çš„å€™é€‰é¡¹æ˜¯å¥½çš„ï¼Œè€Œå…¶ä»–çš„åˆ™ä¸ç„¶ã€‚å¦‚æœæ’åºå™¨å‘ç”Ÿå˜åŒ–ï¼ˆä¸”è¿™ç§å˜åŒ–å¯èƒ½å¾ˆé¢‘ç¹ï¼‰ï¼Œåˆ™è´¨é‡è¯„ä¼°ä¹Ÿä¼šéšä¹‹å˜åŒ–ã€‚
- en: '(There can be a modification for multi-stage ranking: the quality of the early
    stage can be assessed either with the final ranker specifically, or with the ranker
    of the next stage. That is, candidates that pass the next stage but not the final
    one can be considered either negative or positive. I am not sure which approach
    is better.)'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: ï¼ˆå¯¹äºå¤šé˜¶æ®µæ’åå¯èƒ½ä¼šæœ‰ä¿®æ”¹ï¼šå¯ä»¥ä½¿ç”¨æœ€ç»ˆæ’åå™¨ä¸“é—¨è¯„ä¼°æ—©æœŸé˜¶æ®µçš„è´¨é‡ï¼Œæˆ–è€…ä½¿ç”¨ä¸‹ä¸€é˜¶æ®µçš„æ’åå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡ä¸‹ä¸€é˜¶æ®µä½†æœªé€šè¿‡æœ€ç»ˆé˜¶æ®µçš„å€™é€‰é¡¹å¯ä»¥è¢«è§†ä¸ºè´Ÿé¢æˆ–æ­£é¢ã€‚æˆ‘ä¸ç¡®å®šå“ªç§æ–¹æ³•æ›´å¥½ã€‚ï¼‰
- en: Although this approach is not perfect, I personally consider it the only viable
    one, meaning that only with it can one systematically improve the quality of all
    stages in the long term without running into a fundamental problem. At least,
    I do not understand how to achieve this with other approaches.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡è¿™ç§æ–¹æ³•å¹¶ä¸å®Œç¾ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºè¿™æ˜¯å”¯ä¸€å¯è¡Œçš„æ–¹æ³•ï¼Œæ„å‘³ç€åªæœ‰é€šè¿‡è¿™ç§æ–¹æ³•æ‰èƒ½é•¿æœŸç³»ç»Ÿåœ°æ”¹å–„æ‰€æœ‰é˜¶æ®µçš„è´¨é‡ï¼Œè€Œä¸ä¼šé‡åˆ°åŸºæœ¬é—®é¢˜ã€‚è‡³å°‘ï¼Œæˆ‘ä¸æ˜ç™½å¦‚ä½•ç”¨å…¶ä»–æ–¹æ³•å®ç°è¿™ä¸€ç‚¹ã€‚
- en: Having outlined the fundamental principle of this approach, letâ€™s now delve
    deeper into its advantages and disadvantages, beginning with an examination of
    its potential drawbacks.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: æ¦‚è¿°äº†è¿™ç§æ–¹æ³•çš„åŸºæœ¬åŸåˆ™ä¹‹åï¼Œç°åœ¨è®©æˆ‘ä»¬æ·±å…¥æ¢è®¨å…¶ä¼˜ç¼ºç‚¹ï¼Œé¦–å…ˆä»å…¶æ½œåœ¨çš„ç¼ºç‚¹å…¥æ‰‹ã€‚
- en: Cons of the Approach
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ–¹æ³•çš„ç¼ºç‚¹
- en: The entire candidate generation process, including the way its quality is measured,
    begins to significantly depend on the current ranking method. This increases complexity,
    and itâ€™s important to take this into account when making comparisons. And when
    the ranker changes, the early stages need to be retrained.
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ•´ä¸ªå€™é€‰ç”Ÿæˆè¿‡ç¨‹ï¼ŒåŒ…æ‹¬å…¶è´¨é‡å¦‚ä½•è¡¡é‡ï¼Œå¼€å§‹æ˜¾è‘—ä¾èµ–å½“å‰çš„æ’åæ–¹æ³•ã€‚è¿™å¢åŠ äº†å¤æ‚æ€§ï¼Œåœ¨è¿›è¡Œæ¯”è¾ƒæ—¶è€ƒè™‘è¿™ä¸€ç‚¹æ˜¯å¾ˆé‡è¦çš„ã€‚å½“æ’åå™¨å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ—©æœŸé˜¶æ®µéœ€è¦é‡æ–°è®­ç»ƒã€‚
- en: Most often, systems are initially built without following this principle. Transitioning
    a system to adhere to this principle from another state can be very challenging.
    Particularly, if a system has rather poor ranking (but acceptable recommendation
    results due to various hacks), adhering to this principle will not improve the
    system but, on the contrary, might significantly worsen the recommendations at
    the moment.
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç³»ç»Ÿæœ€åˆæ˜¯åœ¨ä¸éµå¾ªè¿™ä¸€åŸåˆ™çš„æƒ…å†µä¸‹æ„å»ºçš„ã€‚å°†ç³»ç»Ÿä»å¦ä¸€ç§çŠ¶æ€è½¬å˜ä¸ºéµå¾ªè¿™ä¸€åŸåˆ™å¯èƒ½éå¸¸å…·æœ‰æŒ‘æˆ˜æ€§ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœç³»ç»Ÿçš„æ’åç›¸å½“ä½ï¼ˆä½†ç”±äºå„ç§æŠ€å·§çš„å­˜åœ¨ï¼Œæ¨èç»“æœæ˜¯å¯æ¥å—çš„ï¼‰ï¼Œé‚£ä¹ˆéµå¾ªè¿™ä¸€åŸåˆ™å°†ä¸ä¼šæ”¹å–„ç³»ç»Ÿï¼Œåè€Œå¯èƒ½åœ¨å½“å‰æ˜¾è‘—æ¶åŒ–æ¨èç»“æœã€‚
- en: The principle assumes that the ranker should work well across the entire document
    base. Otherwise, if there are poor documents that the ranker would mistakenly
    recommend, then candidate generation, in trying to please the ranker, will eventually
    find them too. This complicates the training of the ranker compared to a scenario
    where it only operates on a set of already fairly good candidates.
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è¿™ä¸€åŸåˆ™å‡è®¾æ’åå™¨åº”åœ¨æ•´ä¸ªæ–‡æ¡£åº“ä¸­è¿è¡Œè‰¯å¥½ã€‚å¦åˆ™ï¼Œå¦‚æœæœ‰è´¨é‡ä½ä¸‹çš„æ–‡æ¡£è¢«é”™è¯¯åœ°æ¨èï¼Œé‚£ä¹ˆåœ¨è¯•å›¾å–æ‚¦æ’åå™¨æ—¶ï¼Œå€™é€‰ç”Ÿæˆè¿‡ç¨‹æœ€ç»ˆä¼šå‘ç°å®ƒä»¬ä¹Ÿè¢«æ¨èå‡ºå»ã€‚ä¸æ’åå™¨åªæ“ä½œä¸€ç»„å·²ç»ç›¸å½“ä¸é”™çš„å€™é€‰é¡¹ç›¸æ¯”ï¼Œè¿™ä½¿å¾—æ’åå™¨çš„è®­ç»ƒå˜å¾—æ›´åŠ å¤æ‚ã€‚
- en: 'Candidate generation does not attempt to improve the end-to-end metrics of
    the service. It is possible to improve it according to this principle, but end
    up with a failed experiment. (However, this would exactly indicate that there
    is a problem in the ranking, such as incorrect targets.) This complicates the
    work: you keep improving, but then you canâ€™t deploy it.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å€™é€‰ç”Ÿæˆå¹¶ä¸è¯•å›¾æ”¹å–„æœåŠ¡çš„ç«¯åˆ°ç«¯æŒ‡æ ‡ã€‚æ ¹æ®è¿™ä¸€åŸåˆ™å¯ä»¥æ”¹å–„å®ƒï¼Œä½†æœ€ç»ˆå¯èƒ½ä»¥å¤±è´¥å‘Šç»ˆã€‚ï¼ˆç„¶è€Œï¼Œè¿™æ°å¥½è¡¨æ˜æ’åå­˜åœ¨é—®é¢˜ï¼Œæ¯”å¦‚é”™è¯¯çš„ç›®æ ‡ã€‚ï¼‰è¿™å¢åŠ äº†å·¥ä½œçš„å¤æ‚æ€§ï¼šä½ ä¸æ–­æ”¹è¿›ï¼Œä½†æœ€ç»ˆå´æ— æ³•éƒ¨ç½²å®ƒã€‚
- en: Limited support for [product rules](https://roizner.medium.com/from-hacks-to-harmony-structuring-product-rules-in-recommendations-838af0873f18).
    This principle dictates that all such rules, except for the hard ones, should
    be applied at the final stage, and the early stages will adapt to them. This refers
    not only to hacks but also to reasonable methods for improving various aspects
    of recommendations like exploration, diversity, etc. You have to provide diverse
    candidates simply because the ranking selects them.
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¯¹äº[äº§å“è§„åˆ™](https://roizner.medium.com/from-hacks-to-harmony-structuring-product-rules-in-recommendations-838af0873f18)çš„æ”¯æŒæœ‰é™ã€‚è¿™ä¸€åŸåˆ™è§„å®šï¼Œé™¤äº†ç¡¬è§„åˆ™ä¹‹å¤–çš„æ‰€æœ‰è§„åˆ™åº”åœ¨æœ€åé˜¶æ®µåº”ç”¨ï¼Œæ—©æœŸé˜¶æ®µå°†ä¼šé€‚åº”å®ƒä»¬ã€‚è¿™ä¸ä»…æ¶‰åŠåˆ°æŠ€å·§ï¼Œè¿˜åŒ…æ‹¬æ”¹è¿›æ¨èç³»ç»Ÿå„ä¸ªæ–¹é¢çš„åˆç†æ–¹æ³•ï¼Œå¦‚æ¢ç´¢ã€å¤šæ ·æ€§ç­‰ã€‚ä½ å¿…é¡»æä¾›å¤šæ ·åŒ–çš„å€™é€‰é¡¹ï¼Œå› ä¸ºæ’åå™¨ä¼šé€‰æ‹©å®ƒä»¬ã€‚
- en: '[](/from-hacks-to-harmony-structuring-product-rules-in-recommendations-838af0873f18?source=post_page-----05ce49692f7c--------------------------------)
    [## From Hacks to Harmony: Structuring Product Rules in Recommendations'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '[## ä»é»‘å®¢åˆ°å’Œè°ï¼šåœ¨æ¨èç³»ç»Ÿä¸­æ„å»ºäº§å“è§„åˆ™](/from-hacks-to-harmony-structuring-product-rules-in-recommendations-838af0873f18?source=post_page-----05ce49692f7c--------------------------------)'
- en: Donâ€™t let heuristics undermine your ML, learn to combine them
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä¸è¦è®©å¯å‘å¼æ–¹æ³•å‰Šå¼±ä½ çš„æœºå™¨å­¦ä¹ ï¼Œå­¦ä¼šå°†å®ƒä»¬ç»“åˆèµ·æ¥
- en: towardsdatascience.com](/from-hacks-to-harmony-structuring-product-rules-in-recommendations-838af0873f18?source=post_page-----05ce49692f7c--------------------------------)
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '[towardsdatascience.com](/from-hacks-to-harmony-structuring-product-rules-in-recommendations-838af0873f18?source=post_page-----05ce49692f7c--------------------------------)'
- en: Having explored the limitations, letâ€™s now shift our focus to the advantages
    of this approach.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ¢è®¨äº†å±€é™æ€§ä¹‹åï¼Œè®©æˆ‘ä»¬ç°åœ¨è½¬å‘è¿™ç§æ–¹æ³•çš„ä¼˜åŠ¿ã€‚
- en: Pros of the Approach
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹
- en: The principle is grounded in decomposition. It provides the early stages with
    a clearer and more measurable goal, significantly simplifying the system. The
    complexity involved in choosing targets and losses for recommendations is concentrated
    in the ranking stage (an aspect that cannot be avoided), while the early stages
    are primarily focused on the utilitarian task of efficiently finding the top candidates.
    Thus, the early stages serve simply as an instrument to expedite the ranking process.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è¿™ä¸€åŸåˆ™åŸºäºåˆ†è§£ã€‚å®ƒä¸ºæ—©æœŸé˜¶æ®µæä¾›äº†æ›´æ¸…æ™°ä¸”å¯æµ‹é‡çš„ç›®æ ‡ï¼Œæ˜¾è‘—ç®€åŒ–äº†ç³»ç»Ÿã€‚æ¨èçš„ç›®æ ‡å’ŒæŸå¤±çš„é€‰æ‹©å¤æ‚æ€§é›†ä¸­åœ¨æ’åé˜¶æ®µï¼ˆè¿™æ˜¯æ— æ³•é¿å…çš„ä¸€ä¸ªæ–¹é¢ï¼‰ï¼Œè€Œæ—©æœŸé˜¶æ®µä¸»è¦é›†ä¸­åœ¨æœ‰æ•ˆæ‰¾åˆ°é¡¶çº§å€™é€‰è€…çš„åŠŸåˆ©ä»»åŠ¡ä¸Šã€‚å› æ­¤ï¼Œæ—©æœŸé˜¶æ®µä»…ä½œä¸ºåŠ å¿«æ’åè¿‡ç¨‹çš„å·¥å…·ã€‚
- en: 'In this principle, there are no fundamental limitations. If one imagines an
    ideal recommendation system, nothing prevents it from being structured in this
    way. (This cannot be said for other approaches â€” perfect recommendations are not
    obliged to guess exactly what the user will interact with!) And as the ranking
    improves, such simplified metrics for candidate generation become increasingly
    closer to end-to-end metrics. This is similar to the well-known iterative approach
    in certain circles: â€˜improve the metrics â€” improve the product based on these
    metrics.â€™'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸€åŸåˆ™ä¸­ï¼Œæ²¡æœ‰æ ¹æœ¬æ€§çš„é™åˆ¶ã€‚å¦‚æœæƒ³è±¡ä¸€ä¸ªç†æƒ³çš„æ¨èç³»ç»Ÿï¼Œä»€ä¹ˆä¹Ÿä¸ä¼šé˜»æ­¢å®ƒä»¥è¿™ç§æ–¹å¼æ„å»ºã€‚ï¼ˆå¯¹äºå…¶ä»–æ–¹æ³•ï¼Œè¿™ä¸€ç‚¹ä¸èƒ½æˆç«‹â€”â€”å®Œç¾çš„æ¨èå¹¶ä¸ä¸€å®šèƒ½å¤Ÿå‡†ç¡®çŒœæµ‹ç”¨æˆ·å°†ä¸ä¹‹äº’åŠ¨çš„å†…å®¹ï¼ï¼‰éšç€æ’åçš„æ”¹å–„ï¼Œè¿™ç§ç®€åŒ–çš„å€™é€‰ç”ŸæˆæŒ‡æ ‡ä¼šè¶Šæ¥è¶Šæ¥è¿‘ç«¯åˆ°ç«¯æŒ‡æ ‡ã€‚è¿™ç±»ä¼¼äºæŸäº›åœˆå­é‡Œå¹¿ä¸ºäººçŸ¥çš„è¿­ä»£æ–¹æ³•ï¼šâ€˜æ”¹è¿›æŒ‡æ ‡â€”â€”åŸºäºè¿™äº›æŒ‡æ ‡æ”¹è¿›äº§å“â€™ã€‚
- en: Different stages of ranking are aligned with each other; they do not try to
    optimize different things. In systems where this is not the case, for example,
    if you were to double the total number of candidates, the overall quality of the
    system might not improve but could actually degrade. For instance, if the early
    stages optimized some form of relevance, then the additional candidates would
    be less relevant, and the overall relevance would decrease (although clickability
    might increase).
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä¸åŒçš„æ’åé˜¶æ®µå½¼æ­¤å¯¹é½ï¼›å®ƒä»¬ä¸ä¼šè¯•å›¾ä¼˜åŒ–ä¸åŒçš„å†…å®¹ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œå¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ å°†å€™é€‰è€…çš„æ€»æ•°ç¿»å€ï¼Œé‚£ä¹ˆç³»ç»Ÿçš„æ•´ä½“è´¨é‡å¯èƒ½ä¸ä¼šæé«˜ï¼Œç”šè‡³å¯èƒ½ä¼šä¸‹é™ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ—©æœŸé˜¶æ®µä¼˜åŒ–æŸç§ç›¸å…³æ€§ï¼Œé‚£ä¹ˆé¢å¤–çš„å€™é€‰è€…å¯èƒ½ä¼šè¾ƒå°‘ç›¸å…³ï¼Œä»è€Œæ•´ä½“ç›¸å…³æ€§ä¸‹é™ï¼ˆå°½ç®¡ç‚¹å‡»ç‡å¯èƒ½ä¼šå¢åŠ ï¼‰ã€‚
- en: 'As a consequence of the point about decomposition: the early stages are much
    easier to measure (and therefore to optimize). The process of evaluation will
    be covered in the section below. Training essentially boils down to distilling
    the ranking model. (Although there are nuances. For example, it would be good
    to log some candidates that did not make it to the top of the ranking.)'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç”±äºåˆ†è§£çš„è§‚ç‚¹ï¼šæ—©æœŸé˜¶æ®µçš„è¡¡é‡ï¼ˆå› æ­¤ä¼˜åŒ–ï¼‰è¦å®¹æ˜“å¾—å¤šã€‚è¯„ä¼°è¿‡ç¨‹å°†åœ¨ä¸‹èŠ‚ä¸­è®¨è®ºã€‚è®­ç»ƒåŸºæœ¬ä¸Šå½’ç»“ä¸ºæç‚¼æ’åæ¨¡å‹ã€‚ï¼ˆå°½ç®¡æœ‰ä¸€äº›ç»†å¾®å·®åˆ«ã€‚ä¾‹å¦‚ï¼Œè®°å½•ä¸€äº›æ²¡æœ‰è¿›å…¥æ’åå‰åˆ—çš„å€™é€‰è€…æ˜¯æ¯”è¾ƒå¥½çš„ã€‚ï¼‰
- en: Furthermore, for training and measuring the early stages, we no longer need
    users, meaning itâ€™s not necessary to roll out a new method on them. For example,
    one could use scraping, as we will discuss later, by sending a number of requests
    using new candidates to the ranking service.
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ­¤å¤–ï¼Œå¯¹äºè®­ç»ƒå’Œæµ‹é‡æ—©æœŸé˜¶æ®µï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ç”¨æˆ·ï¼Œè¿™æ„å‘³ç€ä¸å¿…åœ¨ä»–ä»¬èº«ä¸Šæ¨å‡ºæ–°æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨çˆ¬è™«æŠ€æœ¯ï¼Œæ­£å¦‚æˆ‘ä»¬ç¨åå°†è®¨è®ºçš„ï¼Œé€šè¿‡å‘æ’åæœåŠ¡å‘é€ä¸€ç³»åˆ—ä½¿ç”¨æ–°å€™é€‰è€…çš„è¯·æ±‚ã€‚
- en: Measuring Candidate Generation
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è¡¡é‡å€™é€‰ç”Ÿæˆ
- en: Now, letâ€™s delve into the most hands-on part of the article, discussing how
    the quality of candidate generation (or the early stages of ranking) can be measured
    in practice, based on the principle weâ€™ve outlined earlier.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥æ¢è®¨æ–‡ç« ä¸­æœ€å®é™…çš„éƒ¨åˆ†ï¼Œè®¨è®ºå¦‚ä½•æ ¹æ®æˆ‘ä»¬ä¹‹å‰æ¦‚è¿°çš„åŸåˆ™åœ¨å®è·µä¸­æµ‹é‡å€™é€‰ç”Ÿæˆï¼ˆæˆ–æ’åºçš„æ—©æœŸé˜¶æ®µï¼‰çš„è´¨é‡ã€‚
- en: 'First, letâ€™s examine a simplified but quite important case: when ranking is
    performed based solely on the scores of one final model. In this case, we can
    simply compare the average scores of this model for two sets of candidates. If
    one method finds candidates to which the final model assigns higher predictions
    than the other method, then the first method is better.'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸ªç®€åŒ–ä½†éå¸¸é‡è¦çš„æƒ…å†µï¼šå½“æ’åºå®Œå…¨åŸºäºä¸€ä¸ªæœ€ç»ˆæ¨¡å‹çš„åˆ†æ•°æ—¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ¯”è¾ƒè¿™ä¸ªæ¨¡å‹å¯¹äºä¸¤ç»„å€™é€‰çš„å¹³å‡åˆ†æ•°ã€‚å¦‚æœä¸€ç§æ–¹æ³•å‘ç°æœ€ç»ˆæ¨¡å‹ä¸ºå…¶åˆ†é…çš„é¢„æµ‹é«˜äºå¦ä¸€ç§æ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ç§æ–¹æ³•æ›´å¥½ã€‚
- en: Whether to take the average predictions across the entire output, only for the
    top positions, or with some decay by position (resulting in something akin to
    [*IDCG*](https://en.wikipedia.org/wiki/Discounted_cumulative_gain#Normalized_DCG)
    â€” the denominator in *NDCG*) seems not to be very crucial. Any of these options
    can be chosen based on preference.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: æ˜¯å¦å–æ•´ä¸ªè¾“å‡ºçš„å¹³å‡é¢„æµ‹ï¼Œä»…å–å‰å‡ ä¸ªä½ç½®ï¼Œè¿˜æ˜¯æŒ‰ä½ç½®é€’å‡ï¼ˆç±»ä¼¼äº[*IDCG*](https://en.wikipedia.org/wiki/Discounted_cumulative_gain#Normalized_DCG)â€”â€”*NDCG*ä¸­çš„åˆ†æ¯ï¼‰ä¼¼ä¹ä¸æ˜¯éå¸¸å…³é”®ã€‚å¯ä»¥æ ¹æ®ä¸ªäººå–œå¥½é€‰æ‹©è¿™äº›é€‰é¡¹ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚
- en: Thereâ€™s a technical nuance to consider though. If such a metric is measured
    offline, one needs to be able to run ranking (or the entire recommendation stack)
    on custom candidates. This can be done either through simulation (offline replay
    â€” that is, attempting to retrospectively reproduce all the information about all
    entities) on historical queries, or through scraping â€” as mentioned earlier, sending
    a large number of new queries to the recommendation service, so that it uses the
    candidate generation methods of interest. In both cases, results (predictions
    of the final model) are obtained for different generation methods for the same
    queries. This is beneficial for the sensitivity of the metric.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸è¿‡ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸ªæŠ€æœ¯ç»†èŠ‚ã€‚å¦‚æœè¿™æ ·çš„æŒ‡æ ‡æ˜¯ç¦»çº¿æµ‹é‡çš„ï¼Œéœ€è¦èƒ½å¤Ÿåœ¨è‡ªå®šä¹‰å€™é€‰é¡¹ä¸Šè¿è¡Œæ’åºï¼ˆæˆ–æ•´ä¸ªæ¨èç³»ç»Ÿï¼‰ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨å†å²æŸ¥è¯¢ä¸Šè¿›è¡Œæ¨¡æ‹Ÿï¼ˆç¦»çº¿é‡æ”¾â€”â€”å³è¯•å›¾å›é¡¾æ€§åœ°é‡ç°æ‰€æœ‰å®ä½“çš„æ‰€æœ‰ä¿¡æ¯ï¼‰æˆ–é€šè¿‡æŠ“å–ï¼ˆå¦‚å‰æ‰€è¿°ï¼Œå‘æ¨èæœåŠ¡å‘é€å¤§é‡æ–°æŸ¥è¯¢ï¼Œä»¥ä¾¿å®ƒä½¿ç”¨æ„Ÿå…´è¶£çš„å€™é€‰ç”Ÿæˆæ–¹æ³•ï¼‰æ¥å®Œæˆã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œéƒ½ä¼šä¸ºç›¸åŒæŸ¥è¯¢çš„ä¸åŒç”Ÿæˆæ–¹æ³•è·å¾—ç»“æœï¼ˆæœ€ç»ˆæ¨¡å‹çš„é¢„æµ‹ï¼‰ã€‚è¿™å¯¹æŒ‡æ ‡çš„æ•æ„Ÿæ€§æ˜¯æœ‰ç›Šçš„ã€‚
- en: If, however, this metric is measured online, on a production service, it can
    all be calculated simply based on the logged predictions of the model. This is
    much simpler, but not as flexible, and the comparison will be across different
    queries. The sensitivity of the metric decreases (itâ€™s possible that one of the
    methods just happened to receive more complex queries).
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œå¦‚æœè¿™ä¸ªæŒ‡æ ‡æ˜¯åœ¨ç”Ÿäº§æœåŠ¡ä¸­åœ¨çº¿æµ‹é‡çš„ï¼Œé‚£ä¹ˆæ‰€æœ‰è®¡ç®—éƒ½å¯ä»¥ç®€å•åœ°åŸºäºæ¨¡å‹çš„æ—¥å¿—é¢„æµ‹è¿›è¡Œã€‚è¿™è¦ç®€å•å¾—å¤šï¼Œä½†çµæ´»æ€§è¾ƒå·®ï¼Œå¹¶ä¸”æ¯”è¾ƒå°†è·¨è¶Šä¸åŒçš„æŸ¥è¯¢ã€‚æŒ‡æ ‡çš„æ•æ„Ÿæ€§é™ä½ï¼ˆå¯èƒ½æ˜¯å› ä¸ºæŸäº›æ–¹æ³•æ°å¥½æ¥æ”¶åˆ°æ›´å¤æ‚çš„æŸ¥è¯¢ï¼‰ã€‚
- en: 'Now letâ€™s move on to the general case: final ranking is not just the predictions
    of a certain model, but also involves a lot of other logic, reranking, business
    rules, randomization, etc. When you think about how to compare different sets
    of candidates in such a loose formulation (what is good and what is bad), itâ€™s
    not at all obvious.'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨è®©æˆ‘ä»¬è½¬åˆ°ä¸€èˆ¬æƒ…å†µï¼šæœ€ç»ˆæ’åºä¸ä»…ä»…æ˜¯æŸä¸ªæ¨¡å‹çš„é¢„æµ‹ï¼Œè¿˜æ¶‰åŠå¤§é‡å…¶ä»–é€»è¾‘ã€é‡æ’åºã€ä¸šåŠ¡è§„åˆ™ã€éšæœºåŒ–ç­‰ã€‚å½“ä½ è€ƒè™‘å¦‚ä½•åœ¨è¿™ç§æ¾æ•£çš„è¡¨è¿°ä¸­æ¯”è¾ƒä¸åŒçš„å€™é€‰é›†ï¼ˆä»€ä¹ˆæ˜¯å¥½ï¼Œä»€ä¹ˆæ˜¯åï¼‰æ—¶ï¼Œå¹¶ä¸æ˜¯å¾ˆæ˜æ˜¾ã€‚
- en: However, I once devised a method for this, which turned out to be very simple
    and effective. And so far, I have not seen it mentioned anywhere else.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸è¿‡ï¼Œæˆ‘æ›¾ç»è®¾è®¡äº†ä¸€ç§æ–¹æ³•ï¼Œç»“æœéå¸¸ç®€å•æœ‰æ•ˆã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘è¿˜æ²¡æœ‰çœ‹åˆ°å®ƒåœ¨å…¶ä»–åœ°æ–¹æåˆ°è¿‡ã€‚
- en: The method is as follows. We add a special source to the list of candidate sources,
    which produces random candidates (say, uniformly distributed). We assign this
    source a small fixed quota (say, 50 candidates). Then we observe what proportion
    of the recommended documents ultimately come from this source. If our main candidate
    generation is good enough, then random candidates will very rarely outperform
    it, i.e., make it to the top. If it is poor, they will do so frequently.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: æ–¹æ³•å¦‚ä¸‹ã€‚æˆ‘ä»¬å‘å€™é€‰æºåˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªç‰¹æ®Šçš„æºï¼Œè¯¥æºç”Ÿæˆéšæœºå€™é€‰ï¼ˆä¾‹å¦‚ï¼Œå‡åŒ€åˆ†å¸ƒï¼‰ã€‚æˆ‘ä»¬ä¸ºè¿™ä¸ªæºåˆ†é…ä¸€ä¸ªå°çš„å›ºå®šé…é¢ï¼ˆä¾‹å¦‚ï¼Œ50ä¸ªå€™é€‰ï¼‰ã€‚ç„¶åæˆ‘ä»¬è§‚å¯Ÿæ¨èçš„æ–‡æ¡£ä¸­æœ‰å¤šå°‘æ¯”ä¾‹æœ€ç»ˆæ¥è‡ªè¿™ä¸ªæºã€‚å¦‚æœæˆ‘ä»¬çš„ä¸»è¦å€™é€‰ç”Ÿæˆè¶³å¤Ÿå¥½ï¼Œé‚£ä¹ˆéšæœºå€™é€‰å¾ˆå°‘èƒ½èƒœè¿‡å®ƒï¼Œå³å¾ˆå°‘è¿›å…¥å‰åˆ—ã€‚å¦‚æœå®ƒå¾ˆå·®ï¼Œé‚£ä¹ˆéšæœºå€™é€‰ä¼šç»å¸¸è¶…è¶Šå®ƒã€‚
- en: '![](../Images/ad7534c4c7e6b0c8791e4e79820a934f.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ad7534c4c7e6b0c8791e4e79820a934f.png)'
- en: Synthetic data for illustration purposes only
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: ä»…ç”¨äºè¯´æ˜ç›®çš„çš„åˆæˆæ•°æ®
- en: 'Of course, here we assume that adding random candidates does not significantly
    worsen the system: most of them will not be recommended, and those that are recommended
    will not greatly deteriorate the user experience, and will even add exploration
    both for users and for the ranking model (it will further train on these examples).
    If this is not the case, then itâ€™s first necessary to â€˜fix the rankingâ€™. ğŸ˜‰'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œæˆ‘ä»¬å‡è®¾æ·»åŠ éšæœºå€™é€‰è€…ä¸ä¼šæ˜¾è‘—æ¶åŒ–ç³»ç»Ÿï¼šå¤§å¤šæ•°å€™é€‰è€…ä¸ä¼šè¢«æ¨èï¼Œè€Œé‚£äº›è¢«æ¨èçš„å€™é€‰è€…ä¸ä¼šå¤§å¹…é™ä½ç”¨æˆ·ä½“éªŒï¼Œå¹¶ä¸”è¿˜ä¼šä¸ºç”¨æˆ·å’Œæ’åæ¨¡å‹å¢åŠ æ¢ç´¢ï¼ˆå®ƒä¼šåœ¨è¿™äº›ç¤ºä¾‹ä¸Šè¿›ä¸€æ­¥è®­ç»ƒï¼‰ã€‚å¦‚æœæƒ…å†µå¹¶éå¦‚æ­¤ï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦â€˜ä¿®æ­£æ’åâ€™ã€‚ğŸ˜‰
- en: The coolest thing about this method is that it can serve not only as a metric
    for candidate generation, but also as a monitoring tool for the health of the
    entire system, including the final ranking. It checks how well candidate generation
    is aligned with ranking (optimized for ranking). If the ranking itself degrades
    for some reason, then the candidates also become less suitable for it. We have
    seen this in practice, when one of the components broke down, the proportion of
    random candidates in the response increased.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç§æ–¹æ³•æœ€é…·çš„åœ°æ–¹åœ¨äºå®ƒä¸ä»…å¯ä»¥ä½œä¸ºå€™é€‰ç”Ÿæˆçš„åº¦é‡æ ‡å‡†ï¼Œè¿˜å¯ä»¥ä½œä¸ºæ•´ä¸ªç³»ç»Ÿå¥åº·çŠ¶å†µçš„ç›‘æ§å·¥å…·ï¼ŒåŒ…æ‹¬æœ€ç»ˆæ’åã€‚å®ƒæ£€æŸ¥å€™é€‰ç”Ÿæˆä¸æ’åçš„ä¸€è‡´æ€§ï¼ˆæ˜¯å¦ä¸ºæ’åä¼˜åŒ–ï¼‰ã€‚å¦‚æœæ’åæœ¬èº«å› æŸäº›åŸå› ä¸‹é™ï¼Œé‚£ä¹ˆå€™é€‰è€…ä¹Ÿä¼šå˜å¾—ä¸é‚£ä¹ˆé€‚åˆå®ƒã€‚æˆ‘ä»¬åœ¨å®è·µä¸­è§è¯äº†è¿™ä¸€ç‚¹ï¼Œå½“å…¶ä¸­ä¸€ä¸ªç»„ä»¶å‘ç”Ÿæ•…éšœæ—¶ï¼Œå“åº”ä¸­éšæœºå€™é€‰è€…çš„æ¯”ä¾‹å¢åŠ äº†ã€‚
- en: 'By the way, the randomness of this special source can be adjusted. If you use
    not a uniform distribution but one proportional to the popularity of the document,
    it becomes a stronger â€˜adversarialâ€™ player (which can also increase sensitivity).
    However, with uniform sampling, itâ€™s possible to provide an analytical estimate
    of the proportion of queries where our candidate generation was ideal (i.e., the
    result would not have changed, even if we had added the entire database to the
    candidates):'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: é¡ºä¾¿æä¸€ä¸‹ï¼Œè¿™ä¸ªç‰¹æ®Šæ¥æºçš„éšæœºæ€§å¯ä»¥è¿›è¡Œè°ƒæ•´ã€‚å¦‚æœä½ ä½¿ç”¨çš„ä¸æ˜¯å‡åŒ€åˆ†å¸ƒï¼Œè€Œæ˜¯ä¸æ–‡æ¡£çš„å—æ¬¢è¿ç¨‹åº¦æˆæ¯”ä¾‹çš„åˆ†å¸ƒï¼Œå®ƒä¼šæˆä¸ºæ›´å¼ºçš„â€˜å¯¹æŠ—æ€§â€™å‚ä¸è€…ï¼ˆè¿™ä¹Ÿå¯èƒ½å¢åŠ æ•æ„Ÿæ€§ï¼‰ã€‚ç„¶è€Œï¼Œä½¿ç”¨å‡åŒ€æŠ½æ ·ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªå…³äºæˆ‘ä»¬çš„å€™é€‰ç”Ÿæˆç†æƒ³çš„æŸ¥è¯¢æ¯”ä¾‹çš„åˆ†æä¼°è®¡ï¼ˆå³ï¼Œå³ä½¿æˆ‘ä»¬å°†æ•´ä¸ªæ•°æ®åº“æ·»åŠ åˆ°å€™é€‰è€…ä¸­ï¼Œç»“æœä¹Ÿä¸ä¼šæ”¹å˜ï¼‰ï¼š
- en: '![](../Images/5d194aa1ee6b1719b09a6a41b9e4b7bb.png)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/5d194aa1ee6b1719b09a6a41b9e4b7bb.png)'
- en: In this formula, *N* represents the total number of candidates in the database,
    *k* is the number of random candidates used, and *R* denotes the ratio of queries
    where at least one random candidate appears in the output.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸ªå…¬å¼ä¸­ï¼Œ*N* ä»£è¡¨æ•°æ®åº“ä¸­çš„å€™é€‰è€…æ€»æ•°ï¼Œ*k* æ˜¯ä½¿ç”¨çš„éšæœºå€™é€‰è€…æ•°é‡ï¼Œ*R* è¡¨ç¤ºè‡³å°‘æœ‰ä¸€ä¸ªéšæœºå€™é€‰è€…å‡ºç°åœ¨è¾“å‡ºä¸­çš„æŸ¥è¯¢æ¯”ä¾‹ã€‚
- en: Conclusion
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: Throughout this exploration, weâ€™ve centered on a specific principle for candidate
    generation and early ranking stages in recommendation systems. By thoroughly examining
    its advantages and challenges, and proposing practical evaluation methods, we
    underscored the principleâ€™s potential as a powerful tool for refining these systems.
    Embracing this principle not only simplifies the complex process of recommendation
    but also ensures efficiency and effectiveness. As we continue to refine and apply
    this principle, it stands as a promising direction for advancing the field of
    recommendation systems.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸€æ¢ç´¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸“æ³¨äºæ¨èç³»ç»Ÿä¸­å€™é€‰ç”Ÿæˆå’Œæ—©æœŸæ’åé˜¶æ®µçš„ä¸€ä¸ªå…·ä½“åŸåˆ™ã€‚é€šè¿‡å…¨é¢æ£€æŸ¥å…¶ä¼˜ç‚¹å’ŒæŒ‘æˆ˜ï¼Œå¹¶æå‡ºå®ç”¨çš„è¯„ä¼°æ–¹æ³•ï¼Œæˆ‘ä»¬å¼ºè°ƒäº†è¿™ä¸€åŸåˆ™ä½œä¸ºæ”¹è¿›è¿™äº›ç³»ç»Ÿçš„å¼ºå¤§å·¥å…·çš„æ½œåŠ›ã€‚é‡‡çº³è¿™ä¸€åŸåˆ™ä¸ä»…ç®€åŒ–äº†æ¨èçš„å¤æ‚è¿‡ç¨‹ï¼Œè¿˜ç¡®ä¿äº†æ•ˆç‡å’Œæœ‰æ•ˆæ€§ã€‚éšç€æˆ‘ä»¬ç»§ç»­å®Œå–„å’Œåº”ç”¨è¿™ä¸€åŸåˆ™ï¼Œå®ƒå°†æˆä¸ºæ¨åŠ¨æ¨èç³»ç»Ÿé¢†åŸŸå‘å±•çš„æœ‰å¸Œæœ›çš„æ–¹å‘ã€‚
