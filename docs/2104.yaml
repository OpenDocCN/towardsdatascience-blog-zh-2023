- en: Harnessing Precipitation and Climatological Raster Data in South America
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/harnessing-precipitation-and-climatological-raster-data-in-south-america-18ec36d683?source=collection_archive---------11-----------------------#2023-06-29](https://towardsdatascience.com/harnessing-precipitation-and-climatological-raster-data-in-south-america-18ec36d683?source=collection_archive---------11-----------------------#2023-06-29)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: How to access MERGE precipitation and other climatological products from INPE
    for comprehensive weather insights using Google Colab
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://cordmaur.medium.com/?source=post_page-----18ec36d683--------------------------------)[![Maurício
    Cordeiro](../Images/1ec750bf68bbaa0331fabdebebf28eb5.png)](https://cordmaur.medium.com/?source=post_page-----18ec36d683--------------------------------)[](https://towardsdatascience.com/?source=post_page-----18ec36d683--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----18ec36d683--------------------------------)
    [Maurício Cordeiro](https://cordmaur.medium.com/?source=post_page-----18ec36d683--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8878c77fe1a3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fharnessing-precipitation-and-climatological-raster-data-in-south-america-18ec36d683&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=post_page-8878c77fe1a3----18ec36d683---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----18ec36d683--------------------------------)
    ·7 min read·Jun 29, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F18ec36d683&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fharnessing-precipitation-and-climatological-raster-data-in-south-america-18ec36d683&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=-----18ec36d683---------------------clap_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F18ec36d683&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fharnessing-precipitation-and-climatological-raster-data-in-south-america-18ec36d683&source=-----18ec36d683---------------------bookmark_footer-----------)![](../Images/6c442af44e0e9ff07fc52154fbe962e0.png)'
  prefs: []
  type: TYPE_NORMAL
- en: Photo by [Max](https://unsplash.com/it/@notquitemax?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'As the El Niño phenomenon intensifies in 2023, climatological and precipitation
    data have become fundamental in deciphering its impact on weather patterns and
    climate dynamics in global or regional scales. In terms of precipitation data,
    two globally recognized datasets come to the forefront: CHIRPS (Climate Hazards
    Group InfraRed Precipitation with Station) by USGS and IMERGE (Integrated Multi-satellitE
    Retrievals for GPM) developed by NASA, where GPM denotes the Global Precipitation
    Measurement mission. This mission employs a network of satellites to deliver comprehensive
    global rainfall estimates. Though these products are suitable for global models,
    they aren’t specifically tailored for South American scenarios.'
  prefs: []
  type: TYPE_NORMAL
- en: In this context, the Brazilian National Institute for Space Research (INPE)
    offers daily precipitation raster data specifically calibrated for South America.
    This product, known as MERGE, relies on the IMERGE/GPM model but benefits from
    calibration against thousands of in-situ rain gauges to ensure unbiased results
    (Rozante et al. 2010, Rozante et al. 2020). INPE also provides additional climatological
    data, including monthly averages, daily averages, and more.
  prefs: []
  type: TYPE_NORMAL
- en: Figure 1 depicts the total precipitation in South America for 2015 (left), a
    year with a strong El Niño phenomenon, and the precipitation anomaly in comparison
    to the previous year when no El Niño was present (right).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7880b41dafa9f1ca7d0194ffbfcb2fa2.png)'
  prefs: []
  type: TYPE_IMG
- en: 'FIgure 1: In the left, the total precipitation in South American for the year
    of 2015 and in the right the precipitation anomaly of 2015 in comparison to 2014,
    when there was no el-niño. Image by author.'
  prefs: []
  type: TYPE_NORMAL
- en: We can note from the figure a large area with negative anomaly, specially in
    the Amazon biome, with up to 2,000 mm less rain when compared to the previous
    year.
  prefs: []
  type: TYPE_NORMAL
- en: These resources present immense value for diverse applications including watershed
    and reservoir management, monitoring of critical events, and precision agriculture.
    Nevertheless, the intricacies involved in downloading and manipulating these datasets
    often hinder their effective utilization, limiting their use mostly to meteorologists
    and leaving other professionals like hydrologists and agricultural specialists
    under-equipped. This was a challenge observed within my organization (ANA) where
    hydrologists and engineers often struggle to access rainfall data for specific
    basins.
  prefs: []
  type: TYPE_NORMAL
- en: Addressing this challenge, this article aims to guide readers on how to efficiently
    download and manipulate these data using the `merge-downloader` package, opening
    the door for broader interdisciplinary usage and insights.
  prefs: []
  type: TYPE_NORMAL
- en: Installation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The `merge-downloader` is an unofficial library developed to make it easier
    accessing data from INPE and the source-code is available at: [https://github.com/cordmaur/merge-downloader](https://github.com/cordmaur/merge-downloader).'
  prefs: []
  type: TYPE_NORMAL
- en: 'The installation of the Python libraries required for geospatial applications
    can be daunting sometimes, so I strongly suggest using docker instead. I''ve already
    covered this topic in previous stories published here in TDS:'
  prefs: []
  type: TYPE_NORMAL
- en: '[Configuring a Minimal Docker Image for Spatial Analysis with Python](https://medium.com/towards-data-science/configuring-a-minimal-docker-image-for-spatial-analysis-with-python-dc9970ca8a8a)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Why You Should Use Devcontainers for Your Geospatial Development](https://medium.com/towards-data-science/why-you-should-use-devcontainers-for-your-geospatial-development-600f42c7b7e1)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A docker image is already available on Docker Hub and the installation can be
    done with the following commands in a shell prompt.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Once inside the container, you can install the package and start jupyter, which
    will be accessible through your web browser on `http://127.0.0.1:8888`.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Another option, even more straightforward is to install `merge-downloader` on
    Google Colab, that will be the path followed here.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Downloading Assets
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The first thing we need to cover is how to simply download precipitation and
    climatological assets from INPE. The list of available assets to download with
    `merge-downloader` can be obtained with the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'The meaning of each type is available in the github documentation and summarized
    in the following table:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/71e1e82186739d928f6b265231b83f75.png)'
  prefs: []
  type: TYPE_IMG
- en: To download any asset, the first thing is to create a download instance, pointing
    to the INPE's FTP server and setting a local folder where to download the files.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'Once a downloader instance is created, let''s download the the rain for one
    specific day. We can use `get_file` command for that, like so:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'The file can now be opened with `xarray` library:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/c7e308b18ba8bc77a5954fb2c2011f7f.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Code result: Rain for 06/01/2023 in South America (millimiters).'
  prefs: []
  type: TYPE_NORMAL
- en: Opening Multiple Assets
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Note that in the previous example, the longitude is ranging from 240 to 340
    degrees east. That's not the usual, when we use positive and negative numbers
    for longitudes to the right of Greenwich and left, respectively. This correction
    and other minor ones, such as correct CRS definition are done automatically when
    we open the assets using the `Downloader` instance. That can be achieved by using
    `open_file` instead of `get_file`. As an example, let's open multiple files representing
    the rain that occurred in the first four months of 2023\. Additionally, we are
    going to plot the South American countries as a spatial reference.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/8d2a500179ddeb37e002d4fbc381ab53.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Code result: Monthly accumulated rain in the first four months of 2023.'
  prefs: []
  type: TYPE_NORMAL
- en: Creating a Data Cube
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now, suppose we need to assess the accumulated precipitation that occurred in
    the first half of June 2023 in a specific area (e.g., Amazon biome). In these
    scenarios, instead of opening each file individualy, clipping the area, stacking
    them, etc. it's much easier to create a data cube and operate directly on it.
    The cube consists of several rasters stacked alongside the `time` dimension.
  prefs: []
  type: TYPE_NORMAL
- en: So, first, let's create the cube. The `Downloader` class can automatically create
    a cube for a given date range for us.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/4dda36664d4fc30a1bb11ddea11e78f1.png)'
  prefs: []
  type: TYPE_IMG
- en: Next, we have to perform two operations. Clipping, to limit the data to the
    desired area, and summation, to accumulate the precipitation over the desired
    days. So, in the first step we will cut the cube to the extents of the Amazon
    biome. We can perform this through the `GISUtil.cut_cube_by_geoms()` method. Then
    we sum along the `time` axis, so we end up with a single 2-D layer. Let's see
    it step-by-step.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/7c21a87d308c08f4962e1abb4132e9d9.png)'
  prefs: []
  type: TYPE_IMG
- en: Code result. Rain in the first half of June 2023, in the Amazon region.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a Time Series
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Creating a time series for a particular region can provide valuable insights,
    especially when considering the rainfall or historical climatology data. For instance,
    you might want to plot the monthly rain in the Amazon during the El Niño phenomenon
    in 2015 and compare it to the long-term average precipitation expected in the
    region for each month.
  prefs: []
  type: TYPE_NORMAL
- en: To get started, we are going to create two cubes. One with the monthly precipitation,
    from January to December 2015, and the other one with the long term averages.
    The long term average provided by INPE is calculated from 2000 to 2022 (23 years
    of data) and, in this case, we can passe any year as reference.
  prefs: []
  type: TYPE_NORMAL
- en: Note in the following code, that we are using the `reducer=xr.DataArray.mean`
    that is the method used to aggregate the values from each pixel in the region,
    leaving only the `time` dimension.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/7c68e9d611c69e9b4ae992d66df7c7d9.png)'
  prefs: []
  type: TYPE_IMG
- en: Conclusion
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The `merge-downloader` package and INPE’s precipitation and climatological data
    provide an effective resource for environmental analysis applications. The package’s
    compatibility with well-established libraries like geopandas and xarray further
    enhances its applicability.
  prefs: []
  type: TYPE_NORMAL
- en: Illustrated through various case examples, the package’s functionalities range
    from simple tasks such as downloading and plotting precipitation data, to more
    advanced operations. These include the generation of data cubes, implementation
    of spatial clipping, and execution of time-series analysis. Users can apply these
    tools according to their specific requirements, facilitating tasks such as environmental
    change tracking, climatic event monitoring, or comprehensive regional studies.
    Figure 2 shows an report example fully with `merge-downloader` and other Python
    geospatial tools.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/2f13f91ea5d4939bb0657ea993010c26.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 2: Example of report produced with MERGE data for several Brazilian
    basins. Image by author.'
  prefs: []
  type: TYPE_NORMAL
- en: The presented methodology allows for the evaluation of precipitation data and
    its comparison with climatological references in any spatially defined area and
    can serve multiple domains .
  prefs: []
  type: TYPE_NORMAL
- en: Stay Connected
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '*If you liked this article, consider becoming a* [*Medium member*](https://cordmaur.medium.com/membership)
    *and unlock thousands of articles like this one.*'
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://cordmaur.medium.com/membership?source=post_page-----18ec36d683--------------------------------)
    [## Join Medium with my referral link - Maurício Cordeiro'
  prefs: []
  type: TYPE_NORMAL
- en: As a Medium member, a portion of your membership fee goes to writers you read,
    and you get full access to every story…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: cordmaur.medium.com](https://cordmaur.medium.com/membership?source=post_page-----18ec36d683--------------------------------)
  prefs: []
  type: TYPE_NORMAL
