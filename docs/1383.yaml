- en: Uncovering the Link Between Municipalities’ Influence, Public Health Spending,
    and Patient Displacement in Brazil
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/uncovering-the-link-between-municipalities-influence-public-health-spending-and-patient-b9c083c706a?source=collection_archive---------14-----------------------#2023-04-19](https://towardsdatascience.com/uncovering-the-link-between-municipalities-influence-public-health-spending-and-patient-b9c083c706a?source=collection_archive---------14-----------------------#2023-04-19)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: A compelling storytelling journey with Quarto, Shiny, and ChatGPT
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://fernandobarbalho.medium.com/?source=post_page-----b9c083c706a--------------------------------)[![Fernando
    Barbalho](../Images/0d145585cc73b89b4426af47b41844c5.png)](https://fernandobarbalho.medium.com/?source=post_page-----b9c083c706a--------------------------------)[](https://towardsdatascience.com/?source=post_page-----b9c083c706a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----b9c083c706a--------------------------------)
    [Fernando Barbalho](https://fernandobarbalho.medium.com/?source=post_page-----b9c083c706a--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdcaa8c7ce010&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funcovering-the-link-between-municipalities-influence-public-health-spending-and-patient-b9c083c706a&user=Fernando+Barbalho&userId=dcaa8c7ce010&source=post_page-dcaa8c7ce010----b9c083c706a---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----b9c083c706a--------------------------------)
    ·11 min read·Apr 19, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb9c083c706a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funcovering-the-link-between-municipalities-influence-public-health-spending-and-patient-b9c083c706a&user=Fernando+Barbalho&userId=dcaa8c7ce010&source=-----b9c083c706a---------------------clap_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb9c083c706a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funcovering-the-link-between-municipalities-influence-public-health-spending-and-patient-b9c083c706a&source=-----b9c083c706a---------------------bookmark_footer-----------)![](../Images/f2431458930d7949b5dc0bab03859e93.png)'
  prefs: []
  type: TYPE_NORMAL
- en: Photo by [Natanael Melchor](https://unsplash.com/fr/@nmelchorh?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/s/photos/Brazil-hospital?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  prefs: []
  type: TYPE_NORMAL
- en: The Brazilian public health system has long been fighting battles to improve
    its efficiency in allocating resources and providing care. One of the most significant
    challenges is the need for patients to travel to other cities to receive necessary
    hospital treatment. Using data from Brazilian National Health System, we estimated
    that In 2021 alone, patients all over the country took part in around 4.0 million
    such trips. The article explores the implementation details of a project that
    deals with this fascinating public health issue. Reading the text may be particularly
    important to those who work with public policies on health care. Also, because
    of the detail of the code used in the final product, the document may interest
    professionals working with data visualization and storytelling.
  prefs: []
  type: TYPE_NORMAL
- en: To better understand the issue in this article, we investigated the relationship
    between hospital attendance spending and patient displacement. Our analysis revealed
    a significant inequality in spending among Brazilian municipalities, with smaller
    cities spending much less than their larger counterparts. We hypothesized that
    this disparity in spending would lead to a significant flow of patients from cities
    with low hospital capacity to those with greater availability of care infrastructure.
  prefs: []
  type: TYPE_NORMAL
- en: We confirmed our hypothesis using a city influence model (REGIC) produced by
    the Brazilian Institute of Geography and Statistics (IBGE). We demonstrated that
    patient displacement primarily affects smaller cities with less management capacity
    and proportional hospital and outpatient care spending. Meanwhile, larger municipalities
    with more management and influence capacity are more likely to receive patients
    from outside, increasing the demand for their health services.
  prefs: []
  type: TYPE_NORMAL
- en: To make our findings more accessible to a broader audience, we developed an
    interactive dashboard using Shiny, Quarto, and data visualization techniques.
    The dashboard lets users explore the data in real time, with dynamic ChatGPT prompts
    providing additional insights and storytelling elements. By leveraging these tools,
    we hope to shed new light on the challenges facing the Brazilian public health
    system and contribute to ongoing efforts to improve its performance. See the complete
    analysis and the interactive pages through this [link](https://siconfi-atendimento-hospitalar.tesouro.gov.br).
    In addition, the following sections present some graphs used in the product and
    the related code.
  prefs: []
  type: TYPE_NORMAL
- en: Public health data in graphs (and codes)
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The visualizations used in the product were focused heavily on maps. The idea
    was to show how Brazilian cities behaved concerning the need to travel for hospital
    treatment. The graph below, for example, shows how the cities differ in the outflow
    of patients to seek care in other municipalities.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d18ca5972e8644ba9e76071fe98d1a7f.png)'
  prefs: []
  type: TYPE_IMG
- en: Patients were traveling for assistance. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: Below is the block of code that builds a dataset that will later be used as
    the basis for maps using ggplot.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Each point on the map is a municipality, and the colors indicate the percentage
    of patients from the city who demand care in another municipality. We used the
    “*facet*” data visualization feature to show where each city fits within the REGIC
    model. In this model, the most influential cities with the highest management
    capabilities are the metropolises (groups indicated in the first row of the figure),
    and the lowest level in the hierarchy is the *local centers* placed in the last
    frame.
  prefs: []
  type: TYPE_NORMAL
- en: As seen in the map, the *local centers* concentrate the points with stronger
    red shades that show the municipalities with a high percentage of patients who
    need to travel. On the other hand, the map presents all sub-hierarchical levels
    of metropolises with yellow colors that represent low travel needs.
  prefs: []
  type: TYPE_NORMAL
- en: The picture reinforces what we expected of the extreme hierarchical levels concerning
    autonomy given by management capabilities. With few services and low management,
    there is a strong dependence on hospital structures in other municipalities.
  prefs: []
  type: TYPE_NORMAL
- en: It would be essential to indicate how the flow between the various levels of
    the REGIC model occurs. For this purpose, we use alluvial graphs.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6d2497a8027412e7817553c2bbf539a8.png)'
  prefs: []
  type: TYPE_IMG
- en: The flow between REGIC levels. Image by the author
  prefs: []
  type: TYPE_NORMAL
- en: The alluvial above was built using the code described below. Here it was necessary
    to make some data treatment before calling two functions that build the flow graphic.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The flow represented in the figure above shows that patients from municipalities
    categorized as local centers go mainly, in this order, to sub-regional centers
    B (17.6%), regional capitals C (16.6%), sub-regional centers A (15.7%), and only
    in fourth position appear the metropolises (13.8%). With this, there is no doubt
    that the REGIC hierarchy is, in a certain way, climbed when patients require hospital
    care. The metropolis is attractive to local centers, but other urban levels’ proximity
    and management capacity moderates it.
  prefs: []
  type: TYPE_NORMAL
- en: We identified that some cities are significant in receiving patients from other
    cities. So we made two maps that bring the impact of travel to two cities that
    stand out in receiving patients, showing both the distances traveled and the number
    of patients received. For this purpose, see below the map focusing on Recife,
    the Brazilian city that receives most patients from other locations.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3f7334fa539a8e4aa6246539953d5992.png)'
  prefs: []
  type: TYPE_IMG
- en: Patients traveling to Recife. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: The code below is a bit long. There is a lot of data transformation before the
    instructions that create two objects with the two graphs shown above. Here we
    use the *{patchwork}* package to place the charts side by side.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: The influence of the metropolis of Recife can be seen throughout Brazil when
    it comes to hospital care. Looking at the Haversian distances on the map on the
    left, one can see that Recife serves patients who live more than 4000 km away.
    The sample indicates that the capital of Pernambuco received patients from almost
    all the federative units of the country. On the other hand, when evaluating the
    map on the right, one notices that the most significant influence occurs in the
    cities of the metropolitan region, particularly Olinda and Jaboatão dos Guararapes.
    It is also easy to see an extension of points in red shades that extends over
    the entire state of Pernambuco. One can also identify the influence over neighboring
    states, notably Paraíba, Alagoas, and Rio Grande do Norte.
  prefs: []
  type: TYPE_NORMAL
- en: 'At the end of our original storytelling, we needed to demonstrate that the
    lower municipal spending on hospital care is associated with a greater need for
    patient displacement. To test this association, we created clusters from the percentage
    of evaded and received patients considering each of the 5570 Brazilian municipalities.
    Using the silhouette measure of clusters generated by the PAM technique, we identified
    four groups: moderate entry, weak exit, moderate exit, and strong exit. This last
    group is the most relevant for the analysis. The graphs below provide insights
    for evaluating group importance.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b0b3ec064d37f0b0ca8b403d8a6f9899.png)'
  prefs: []
  type: TYPE_IMG
- en: Box-plot for expenses on Hospital care. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: The code below starts by bringing into memory the data with the clusters of
    municipalities. Next, using ggplot we construct the two box-plots, placed side
    by side using the {patchwork} package.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Each colored dot in the graphs is a Brazilian municipality. The colors of the
    dots represent the percentage of patient outflow on the left graph and the percentage
    of attendance of patients from other cities on the right graph. On the horizontal
    axis of the two graphs, we see the groups and the percentage of expenses with
    inpatient and outpatient care on the vertical axis.
  prefs: []
  type: TYPE_NORMAL
- en: Observing the graphs, we can see the most important conclusion of the association
    between expenses and patient inflow and outflow groups. When we analyze the outflow
    of patients in the left graph, we find that the *strong exit* group presents a
    median of proportional expenses with hospitals much lower than the other groups.
  prefs: []
  type: TYPE_NORMAL
- en: Did you ask for Shiny with interaction?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As we indicated at the beginning of the text, in addition to the main story,
    we prepared several tabs that allow the user to make filters and generate graphics
    that explore the reality of cities specified in the interaction. See below prints
    of some of these interactions. Note the possibility of downloading the data associated
    with the graphics in almost all tabs.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/87b46f0032360be5839f1d65c8154fea.png)'
  prefs: []
  type: TYPE_IMG
- en: The flow of patients — Brazil. Image by the author
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/dd9445ee5f3534f2c4d53a8cd16c3b20.png)'
  prefs: []
  type: TYPE_IMG
- en: Flow of patients to a chosen city. Image by the author
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/88758477cdd2646e9da2b99e01c9300c.png)'
  prefs: []
  type: TYPE_IMG
- en: Position of chosen cities in a Box-plot. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: One tab brings the complete table with data that can be used for filters and
    downloads.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/dbf1a5de62853b2827b25b99e163d367.png)'
  prefs: []
  type: TYPE_IMG
- en: A table with an X-ray of the municipalities. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: What about ChatGPT?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The last tab shows data that summarizes the primary information about a municipality
    selected by the user. See below the screen print.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/79e5bf540cf61b2ee7231abec8cd1388.png)'
  prefs: []
  type: TYPE_IMG
- en: Summary of information and generation of prompt to chatGPT. Image by the author
  prefs: []
  type: TYPE_NORMAL
- en: 'The last table is where one can interoperate with ChatGPT. The panel dynamically
    generates a prompt with the data present in the other tables of this last tab.
    The user can press the Copy button, take the prompt to ChatGPT and watch the magic
    happen. See screenshots of one example. (if the reader does not read Portuguese
    and wants to understand the prompt and the AI’s response, please contact me at
    my e-mail address: [fbarbalho@gmail.com](mailto:fbarbalho@gmail.com)).'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/aa4f2d4c301753d001069295c4af8bc4.png)'
  prefs: []
  type: TYPE_IMG
- en: Prompt generated by the application. Image by the author
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/50c873c4a6a0ec495d0ce0145a1a2759.png)'
  prefs: []
  type: TYPE_IMG
- en: Text generated by chatGPT as a response to the prompt created by the application.
    Image by the author
  prefs: []
  type: TYPE_NORMAL
- en: Code and data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The complete code is available at [github](https://github.com/tchiluanda/siconfi_atendimento_hospitalar).
  prefs: []
  type: TYPE_NORMAL
- en: All datasets are characterized as public domain since they are data produced
    by Brazilian federal government institutions, made available on the internet as
    active transparency, and are subject to the Brazilian Access to Information Law.
  prefs: []
  type: TYPE_NORMAL
- en: '[Datasus](https://datasus.saude.gov.br/transferencia-de-arquivos/): data about
    health facilities’ addresses and hospital attendance.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[IBGE](https://www.ibge.gov.br/#): data about REGIC model.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Secretaria do Tesouro Nacional](https://siconfi.tesouro.gov.br/siconfi/index.jsf;jsessionid=U5bso6l-RBmLg5-OdG7y9b4A.node2):
    data about health expenses.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The author acknowledges [Ben Huberman](https://benzbox.medium.com/) for the
    valuable comments.
  prefs: []
  type: TYPE_NORMAL
