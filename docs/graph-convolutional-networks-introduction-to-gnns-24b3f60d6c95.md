# å›¾å·ç§¯ç½‘ç»œï¼šGNNs ç®€ä»‹

> åŸæ–‡ï¼š[`towardsdatascience.com/graph-convolutional-networks-introduction-to-gnns-24b3f60d6c95?source=collection_archive---------0-----------------------#2023-08-14`](https://towardsdatascience.com/graph-convolutional-networks-introduction-to-gnns-24b3f60d6c95?source=collection_archive---------0-----------------------#2023-08-14)

## ä½¿ç”¨ PyTorch Geometric çš„é€æ­¥æŒ‡å—

[](https://medium.com/@mlabonne?source=post_page-----24b3f60d6c95--------------------------------)![Maxime Labonne](https://medium.com/@mlabonne?source=post_page-----24b3f60d6c95--------------------------------)[](https://towardsdatascience.com/?source=post_page-----24b3f60d6c95--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----24b3f60d6c95--------------------------------) [Maxime Labonne](https://medium.com/@mlabonne?source=post_page-----24b3f60d6c95--------------------------------)

Â·

[å…³æ³¨](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdc89da634938&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgraph-convolutional-networks-introduction-to-gnns-24b3f60d6c95&user=Maxime+Labonne&userId=dc89da634938&source=post_page-dc89da634938----24b3f60d6c95---------------------post_header-----------) å‘è¡¨åœ¨[Towards Data Science](https://towardsdatascience.com/?source=post_page-----24b3f60d6c95--------------------------------) Â·16 åˆ†é’Ÿé˜…è¯»Â·2023 å¹´ 8 æœˆ 14 æ—¥[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F24b3f60d6c95&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgraph-convolutional-networks-introduction-to-gnns-24b3f60d6c95&user=Maxime+Labonne&userId=dc89da634938&source=-----24b3f60d6c95---------------------clap_footer-----------)

--

[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F24b3f60d6c95&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgraph-convolutional-networks-introduction-to-gnns-24b3f60d6c95&source=-----24b3f60d6c95---------------------bookmark_footer-----------)![](img/53a44290154e9eb7c20b5a32cd4d5642.png)

ä½œè€…æä¾›çš„å›¾åƒ

**å›¾ç¥ç»ç½‘ç»œ**ï¼ˆGNNsï¼‰æ˜¯æ·±åº¦å­¦ä¹ é¢†åŸŸä¸­æœ€å¸å¼•äººå’Œè¿…é€Ÿå‘å±•çš„æ¶æ„ä¹‹ä¸€ã€‚ä½œä¸ºå¤„ç†å›¾ç»“æ„æ•°æ®çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ŒGNNs å¸¦æ¥äº†æ˜¾è‘—çš„å¤šæ ·æ€§å’Œå¼ºå¤§çš„å­¦ä¹ èƒ½åŠ›ã€‚

åœ¨å„ç§ç±»å‹çš„ GNN ä¸­ï¼Œ**å›¾å·ç§¯ç½‘ç»œ**ï¼ˆGCNsï¼‰å·²ç»æˆä¸ºæœ€[æ™®éä¸”å¹¿æ³›åº”ç”¨çš„æ¨¡å‹](https://paperswithcode.com/methods/category/graph-models)ã€‚GCNs å› å…¶èƒ½å¤Ÿåˆ©ç”¨èŠ‚ç‚¹çš„ç‰¹å¾åŠå…¶å±€éƒ¨ä¿¡æ¯è¿›è¡Œé¢„æµ‹è€Œå…·æœ‰åˆ›æ–°æ€§ï¼Œæä¾›äº†ä¸€ç§æœ‰æ•ˆå¤„ç†å›¾ç»“æ„æ•°æ®çš„æ–¹æ³•ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ GCN å±‚çš„æœºåˆ¶ï¼Œå¹¶è§£é‡Šå…¶å†…éƒ¨å·¥ä½œåŸç†ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å°†æ¢ç´¢å…¶åœ¨èŠ‚ç‚¹åˆ†ç±»ä»»åŠ¡ä¸­çš„å®é™…åº”ç”¨ï¼Œä½¿ç”¨[PyTorch Geometric](https://pytorch-geometric.readthedocs.io/en/latest/index.html)ä½œä¸ºæˆ‘ä»¬çš„å·¥å…·ã€‚

PyTorch Geometric æ˜¯ PyTorch çš„ä¸€ä¸ªä¸“é—¨æ‰©å±•ï¼Œä¸“ä¸º GNNs çš„å¼€å‘å’Œå®ç°è€Œåˆ›å»ºã€‚å®ƒæ˜¯ä¸€ä¸ªé«˜çº§ä½†ç”¨æˆ·å‹å¥½çš„åº“ï¼Œæä¾›äº†ä¸€æ•´å¥—å·¥å…·æ¥ä¿ƒè¿›åŸºäºå›¾çš„æœºå™¨å­¦ä¹ ã€‚ä¸ºäº†å¼€å§‹æˆ‘ä»¬çš„æ—…ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… PyTorch Geometricã€‚å¦‚æœä½ ä½¿ç”¨ Google Colabï¼Œ[PyTorch](https://pytorch.org/get-started/locally/)åº”è¯¥å·²ç»å®‰è£…å¥½äº†ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æ‰§è¡Œå‡ ä¸ªé¢å¤–çš„å‘½ä»¤ã€‚

æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨[Google Colab](https://colab.research.google.com/drive/1ZugveUjRrbSNwUbryeKJN2wyhGFRCw0q?usp=sharing)å’Œ[GitHub](https://github.com/mlabonne/graph-neural-network-course)ä¸Šæ‰¾åˆ°ã€‚

```py
!pip install torch_geometric
```

```py
import torch
import numpy as np
import networkx as nx
import matplotlib.pyplot as plt
```

ç°åœ¨ PyTorch Geometric å·²ç»å®‰è£…å¥½äº†ï¼Œè®©æˆ‘ä»¬æ¢ç´¢ä¸€ä¸‹æœ¬æ•™ç¨‹ä¸­å°†ä½¿ç”¨çš„æ•°æ®é›†ã€‚

# ğŸŒ I. å›¾æ•°æ®

[å›¾](https://en.wikipedia.org/wiki/Graph_(discrete_mathematics))æ˜¯è¡¨ç¤ºå¯¹è±¡ä¹‹é—´å…³ç³»çš„é‡è¦ç»“æ„ã€‚ä½ å¯ä»¥åœ¨è®¸å¤šç°å®ä¸–ç•Œçš„åœºæ™¯ä¸­é‡åˆ°å›¾æ•°æ®ï¼Œä¾‹å¦‚ç¤¾äº¤å’Œè®¡ç®—æœºç½‘ç»œã€åˆ†å­åŒ–å­¦ç»“æ„ã€è‡ªç„¶è¯­è¨€å¤„ç†å’Œå›¾åƒè¯†åˆ«ç­‰ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶è‡­åæ˜­è‘—ä¸”å¹¿æ³›ä½¿ç”¨çš„[æ‰å¡é‡Œçš„ç©ºæ‰‹é“ä¿±ä¹éƒ¨](https://en.wikipedia.org/wiki/Zachary%27s_karate_club)æ•°æ®é›†ã€‚

![](img/00365b1de2d9e1641523993393467f7c.png)

å›¾ç‰‡ä½œè€…æä¾›

æ‰å¡é‡Œçš„ç©ºæ‰‹é“ä¿±ä¹éƒ¨æ•°æ®é›†ä½“ç°äº† 1970 å¹´ä»£ Wayne W. Zachary è§‚å¯Ÿåˆ°çš„ç©ºæ‰‹é“ä¿±ä¹éƒ¨å†…éƒ¨å½¢æˆçš„å…³ç³»ã€‚è¿™æ˜¯ä¸€ç§ç¤¾äº¤ç½‘ç»œï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªä¿±ä¹éƒ¨æˆå‘˜ï¼ŒèŠ‚ç‚¹ä¹‹é—´çš„è¾¹ä»£è¡¨å‘ç”Ÿåœ¨ä¿±ä¹éƒ¨ç¯å¢ƒä¹‹å¤–çš„äº’åŠ¨ã€‚

åœ¨è¿™ä¸ªç‰¹å®šçš„åœºæ™¯ä¸­ï¼Œä¿±ä¹éƒ¨æˆå‘˜è¢«åˆ†ä¸ºå››ä¸ªä¸åŒçš„ç»„ã€‚æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯**æ ¹æ®ä»–ä»¬çš„äº’åŠ¨æ¨¡å¼ç»™æ¯ä¸ªæˆå‘˜åˆ†é…æ­£ç¡®çš„ç»„**ï¼ˆèŠ‚ç‚¹åˆ†ç±»ï¼‰ã€‚

è®©æˆ‘ä»¬ä½¿ç”¨ PyG çš„å†…ç½®å‡½æ•°å¯¼å…¥æ•°æ®é›†ï¼Œå¹¶å°è¯•äº†è§£å®ƒä½¿ç”¨çš„`Datasets`å¯¹è±¡ã€‚

```py
from torch_geometric.datasets import KarateClub
```

```py
# Import dataset from PyTorch Geometric
dataset = KarateClub()# Print information
print(dataset)
print('------------')
print(f'Number of graphs: {len(dataset)}')
print(f'Number of features: {dataset.num_features}')
print(f'Number of classes: {dataset.num_classes}')
```

```py
KarateClub()
------------
Number of graphs: 1
Number of features: 34
Number of classes: 4
```

è¯¥æ•°æ®é›†ä»…åŒ…å« 1 ä¸ªå›¾ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹å…·æœ‰ 34 ç»´çš„ç‰¹å¾å‘é‡ï¼Œå¹¶ä¸”å±äºå››ä¸ªç±»åˆ«ä¸­çš„ä¸€ä¸ªï¼ˆæˆ‘ä»¬çš„å››ä¸ªç»„ï¼‰ã€‚å®é™…ä¸Šï¼Œ`Datasets`å¯¹è±¡å¯ä»¥çœ‹ä½œæ˜¯`Data`ï¼ˆå›¾ï¼‰å¯¹è±¡çš„é›†åˆã€‚

æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æ£€æŸ¥æˆ‘ä»¬ç‹¬ç‰¹çš„å›¾ï¼Œä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚

```py
# Print first element
print(f'Graph: {dataset[0]}')
```

```py
Graph: Data(x=[34, 34], edge_index=[2, 156], y=[34], train_mask=[34])
```

`[Data](https://pytorch-geometric.readthedocs.io/en/latest/modules/data.html)`å¯¹è±¡ç‰¹åˆ«æœ‰è¶£ã€‚æ‰“å°å®ƒå¯ä»¥å¾ˆå¥½åœ°æ€»ç»“æˆ‘ä»¬æ­£åœ¨ç ”ç©¶çš„å›¾ï¼š

+   `x=[34, 34]`æ˜¯**èŠ‚ç‚¹ç‰¹å¾çŸ©é˜µ**ï¼Œå…¶å½¢çŠ¶ä¸ºï¼ˆèŠ‚ç‚¹æ•°ï¼Œç‰¹å¾æ•°ï¼‰ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æœ‰ 34 ä¸ªèŠ‚ç‚¹ï¼ˆæˆ‘ä»¬çš„ 34 ä¸ªæˆå‘˜ï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¸ä¸€ä¸ª 34 ç»´ç‰¹å¾å‘é‡ç›¸å…³è”ã€‚

+   `edge_index=[2, 156]`è¡¨ç¤º**å›¾çš„è¿é€šæ€§**ï¼ˆèŠ‚ç‚¹å¦‚ä½•è¿æ¥ï¼‰ï¼Œå…¶å½¢çŠ¶ä¸ºï¼ˆ2ï¼Œå®šå‘è¾¹çš„æ•°é‡ï¼‰ã€‚

+   `y=[34]`æ˜¯**èŠ‚ç‚¹çœŸå®æ ‡ç­¾**ã€‚åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹è¢«åˆ†é…åˆ°ä¸€ä¸ªç±»åˆ«ï¼ˆç»„ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯¹æ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªå€¼ã€‚

+   `train_mask=[34]`æ˜¯ä¸€ä¸ªå¯é€‰å±æ€§ï¼Œç”¨äºæŒ‡å®šå“ªäº›èŠ‚ç‚¹åº”ç”¨äºè®­ç»ƒï¼Œåˆ—è¡¨ä¸­åŒ…å«`True`æˆ–`False`ã€‚

è®©æˆ‘ä»¬æ‰“å°è¿™äº›å¼ é‡ä»¥äº†è§£å®ƒä»¬å­˜å‚¨äº†ä»€ä¹ˆã€‚æˆ‘ä»¬ä»èŠ‚ç‚¹ç‰¹å¾å¼€å§‹ã€‚

```py
data = dataset[0]
```

```py
print(f'x = {data.x.shape}')
print(data.x)
```

```py
x = torch.Size([34, 34])
tensor([[1., 0., 0.,  ..., 0., 0., 0.],
        [0., 1., 0.,  ..., 0., 0., 0.],
        [0., 0., 1.,  ..., 0., 0., 0.],
        ...,
        [0., 0., 0.,  ..., 1., 0., 0.],
        [0., 0., 0.,  ..., 0., 1., 0.],
        [0., 0., 0.,  ..., 0., 0., 1.]])
```

åœ¨è¿™é‡Œï¼ŒèŠ‚ç‚¹ç‰¹å¾çŸ©é˜µ`x`æ˜¯ä¸€ä¸ªå•ä½çŸ©é˜µï¼šå®ƒ**ä¸åŒ…å«ä»»ä½•ç›¸å…³ä¿¡æ¯**å…³äºèŠ‚ç‚¹ã€‚å®ƒæœ¬å¯ä»¥åŒ…å«è¯¸å¦‚å¹´é¾„ã€æŠ€èƒ½æ°´å¹³ç­‰ä¿¡æ¯ï¼Œä½†åœ¨è¿™ä¸ªæ•°æ®é›†ä¸­å¹¶éå¦‚æ­¤ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½é€šè¿‡æŸ¥çœ‹èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥æ¥å¯¹å®ƒä»¬è¿›è¡Œåˆ†ç±»ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ‰“å°è¾¹ç´¢å¼•ã€‚

```py
print(f'edge_index = {data.edge_index.shape}')
print(data.edge_index)
```

```py
edge_index = torch.Size([2, 156])
tensor([[ 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,
          1,  1,  1,  1,  1,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  3,
          3,  3,  3,  3,  3,  4,  4,  4,  5,  5,  5,  5,  6,  6,  6,  6,  7,  7,
          7,  7,  8,  8,  8,  8,  8,  9,  9, 10, 10, 10, 11, 12, 12, 13, 13, 13,
         13, 13, 14, 14, 15, 15, 16, 16, 17, 17, 18, 18, 19, 19, 19, 20, 20, 21,
         21, 22, 22, 23, 23, 23, 23, 23, 24, 24, 24, 25, 25, 25, 26, 26, 27, 27,
         27, 27, 28, 28, 28, 29, 29, 29, 29, 30, 30, 30, 30, 31, 31, 31, 31, 31,
         31, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 33, 33, 33, 33, 33,
         33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33],
        [ 1,  2,  3,  4,  5,  6,  7,  8, 10, 11, 12, 13, 17, 19, 21, 31,  0,  2,
          3,  7, 13, 17, 19, 21, 30,  0,  1,  3,  7,  8,  9, 13, 27, 28, 32,  0,
          1,  2,  7, 12, 13,  0,  6, 10,  0,  6, 10, 16,  0,  4,  5, 16,  0,  1,
          2,  3,  0,  2, 30, 32, 33,  2, 33,  0,  4,  5,  0,  0,  3,  0,  1,  2,
          3, 33, 32, 33, 32, 33,  5,  6,  0,  1, 32, 33,  0,  1, 33, 32, 33,  0,
          1, 32, 33, 25, 27, 29, 32, 33, 25, 27, 31, 23, 24, 31, 29, 33,  2, 23,
         24, 33,  2, 31, 33, 23, 26, 32, 33,  1,  8, 32, 33,  0, 24, 25, 28, 32,
         33,  2,  8, 14, 15, 18, 20, 22, 23, 29, 30, 31, 33,  8,  9, 13, 14, 15,
         18, 19, 20, 22, 23, 26, 27, 28, 29, 30, 31, 32]])
```

åœ¨å›¾è®ºå’Œç½‘ç»œåˆ†æä¸­ï¼ŒèŠ‚ç‚¹ä¹‹é—´çš„è¿é€šæ€§é€šè¿‡å¤šç§æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨ã€‚`edge_index`å°±æ˜¯è¿™ç§æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œå…¶ä¸­å›¾çš„è¿æ¥å­˜å‚¨åœ¨**ä¸¤ä¸ªåˆ—è¡¨**ä¸­ï¼ˆ156 æ¡å®šå‘è¾¹ï¼Œç›¸å½“äº 78 æ¡åŒå‘è¾¹ï¼‰ã€‚è¿™ä¸¤ä¸ªåˆ—è¡¨çš„åŸå› åœ¨äºä¸€ä¸ªåˆ—è¡¨å­˜å‚¨æºèŠ‚ç‚¹ï¼Œè€Œç¬¬äºŒä¸ªåˆ—è¡¨æ ‡è¯†ç›®æ ‡èŠ‚ç‚¹ã€‚

è¿™ç§æ–¹æ³•ç§°ä¸º**åæ ‡åˆ—è¡¨**ï¼ˆCOOï¼‰æ ¼å¼ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§é«˜æ•ˆå­˜å‚¨[ç¨€ç–çŸ©é˜µ](https://en.wikipedia.org/wiki/Sparse_matrix#Storing_a_sparse_matrix)çš„æ–¹å¼ã€‚ç¨€ç–çŸ©é˜µæ˜¯é«˜æ•ˆå­˜å‚¨å¤§éƒ¨åˆ†ä¸ºé›¶å…ƒç´ çš„çŸ©é˜µçš„æ•°æ®ç»“æ„ã€‚åœ¨ COO æ ¼å¼ä¸­ï¼Œä»…å­˜å‚¨éé›¶å…ƒç´ ï¼Œä»è€ŒèŠ‚çœå†…å­˜å’Œè®¡ç®—èµ„æºã€‚

ç›¸åï¼Œæ›´ç›´è§‚å’Œç®€æ´çš„è¡¨ç¤ºå›¾è¿é€šæ€§çš„æ–¹æ³•æ˜¯é€šè¿‡**é‚»æ¥çŸ©é˜µ** *A*ã€‚è¿™æ˜¯ä¸€ä¸ªæ–¹é˜µï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ *A*áµ¢â±¼ *s*æŒ‡å®šå›¾ä¸­ä»èŠ‚ç‚¹*i*åˆ°èŠ‚ç‚¹*j*çš„è¾¹çš„å­˜åœ¨ä¸å¦ã€‚æ¢å¥è¯è¯´ï¼Œéé›¶å…ƒç´ *A*áµ¢â±¼ è¡¨ç¤ºä»èŠ‚ç‚¹*i*åˆ°èŠ‚ç‚¹*j*çš„è¿æ¥ï¼Œè€Œé›¶è¡¨ç¤ºæ²¡æœ‰ç›´æ¥è¿æ¥ã€‚

![](img/7a85c8e90254bb8ed5f76a90cbc92443.png)

ä½œè€…æä¾›çš„å›¾ç‰‡

ç„¶è€Œï¼Œé‚»æ¥çŸ©é˜µåœ¨ç¨€ç–çŸ©é˜µæˆ–è¾¹è¾ƒå°‘çš„å›¾ä¸­å¹¶ä¸åƒ COO æ ¼å¼é‚£æ ·èŠ‚çœç©ºé—´ã€‚ç„¶è€Œï¼Œä¸ºäº†æ¸…æ™°å’Œæ˜“äºè§£é‡Šï¼Œé‚»æ¥çŸ©é˜µä»ç„¶æ˜¯è¡¨ç¤ºå›¾è¿é€šæ€§çš„çƒ­é—¨é€‰æ‹©ã€‚

é‚»æ¥çŸ©é˜µå¯ä»¥é€šè¿‡`edge_index`å’Œä¸€ä¸ªå·¥å…·å‡½æ•°`to_dense_adj()`æ¥æ¨æ–­ã€‚

```py
from torch_geometric.utils import to_dense_adj
```

```py
A = to_dense_adj(data.edge_index)[0].numpy().astype(int)
print(f'A = {A.shape}')
print(A)
```

```py
A = (34, 34)
[[0 1 1 ... 1 0 0]
 [1 0 1 ... 0 0 0]
 [1 1 0 ... 0 1 0]
 ...
 [1 0 0 ... 0 1 1]
 [0 0 1 ... 1 0 1]
 [0 0 0 ... 1 1 0]]
```

å¯¹äºå›¾æ•°æ®ï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯†é›†äº’è¿çš„æƒ…å†µç›¸å¯¹è¾ƒå°‘ã€‚æ­£å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬çš„é‚»æ¥çŸ©é˜µ*A*æ˜¯**ç¨€ç–çš„**ï¼ˆå¡«å……äº†é›¶ï¼‰ã€‚

åœ¨è®¸å¤šç°å®ä¸–ç•Œçš„å›¾ä¸­ï¼Œå¤§å¤šæ•°èŠ‚ç‚¹åªä¸å°‘æ•°å…¶ä»–èŠ‚ç‚¹è¿æ¥ï¼Œå¯¼è‡´é‚»æ¥çŸ©é˜µä¸­æœ‰å¤§é‡é›¶ã€‚å­˜å‚¨è¿™ä¹ˆå¤šé›¶æ˜¯å®Œå…¨ä¸é«˜æ•ˆçš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ PyG é‡‡ç”¨äº† COO æ ¼å¼ã€‚

ç›¸åï¼ŒçœŸå®æ ‡ç­¾æ˜“äºç†è§£ã€‚

```py
print(f'y = {data.y.shape}')
print(data.y)
```

```py
y = torch.Size([34])
tensor([1, 1, 1, 1, 3, 3, 3, 1, 0, 1, 3, 1, 1, 1, 0, 0, 3, 1, 0, 1, 0, 1, 0, 0,
        2, 2, 0, 0, 2, 0, 0, 2, 0, 0])
```

æˆ‘ä»¬å­˜å‚¨åœ¨ `y` ä¸­çš„èŠ‚ç‚¹çœŸå®æ ‡ç­¾ä»…ä»…ç¼–ç äº†æ¯ä¸ªèŠ‚ç‚¹çš„ç»„å·ï¼ˆ0, 1, 2, 3ï¼‰ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰ 34 ä¸ªå€¼ã€‚

æœ€åï¼Œè®©æˆ‘ä»¬æ‰“å°è®­ç»ƒæ©ç ã€‚

```py
print(f'train_mask = {data.train_mask.shape}')
print(data.train_mask)
```

```py
train_mask = torch.Size([34])
tensor([ True, False, False, False,  True, False, False, False,  True, False,
        False, False, False, False, False, False, False, False, False, False,
        False, False, False, False,  True, False, False, False, False, False,
        False, False, False, False])
```

è®­ç»ƒæ©ç æ˜¾ç¤ºäº†å“ªäº›èŠ‚ç‚¹åº”è¯¥ç”¨ `True` è¯­å¥è¿›è¡Œè®­ç»ƒã€‚è¿™äº›èŠ‚ç‚¹ä»£è¡¨è®­ç»ƒé›†ï¼Œè€Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥è§†ä¸ºæµ‹è¯•é›†ã€‚è¿™ç§åˆ’åˆ†æœ‰åŠ©äºé€šè¿‡æä¾›æœªè§è¿‡çš„æ•°æ®æ¥è¿›è¡Œæ¨¡å‹è¯„ä¼°ã€‚

ä½†æˆ‘ä»¬è¿˜æ²¡å®Œæˆï¼`[Data](https://pytorch-geometric.readthedocs.io/en/latest/modules/data.html)` å¯¹è±¡æä¾›äº†æ›´å¤šåŠŸèƒ½ã€‚å®ƒæä¾›äº†å„ç§å®ç”¨å‡½æ•°ï¼Œä½¿å¾—å¯ä»¥è°ƒæŸ¥å›¾çš„å¤šä¸ªå±æ€§ã€‚ä¾‹å¦‚ï¼š

+   `is_directed()` å‘Šè¯‰ä½ å›¾æ˜¯å¦**æœ‰å‘**ã€‚æœ‰å‘å›¾æ„å‘³ç€é‚»æ¥çŸ©é˜µä¸æ˜¯å¯¹ç§°çš„ï¼Œå³è¾¹çš„æ–¹å‘åœ¨èŠ‚ç‚¹é—´çš„è¿æ¥ä¸­æ˜¯é‡è¦çš„ã€‚

+   `isolated_nodes()` æ£€æŸ¥æ˜¯å¦æœ‰ä¸€äº›èŠ‚ç‚¹**æ²¡æœ‰è¿æ¥**åˆ°å›¾çš„å…¶ä½™éƒ¨åˆ†ã€‚è¿™äº›èŠ‚ç‚¹å¯èƒ½åœ¨åˆ†ç±»ç­‰ä»»åŠ¡ä¸­å¸¦æ¥æŒ‘æˆ˜ï¼Œå› ä¸ºå®ƒä»¬ç¼ºä¹è¿æ¥ã€‚

+   `has_self_loops()` è¡¨ç¤ºæ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹**è‡ªæˆ‘è¿æ¥**ã€‚è¿™ä¸[ç¯](https://en.wikipedia.org/wiki/Loop_(graph_theory))çš„æ¦‚å¿µä¸åŒï¼šç¯æ„å‘³ç€ä¸€æ¡è·¯å¾„å¼€å§‹å’Œç»“æŸäºåŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­éå†å…¶ä»–èŠ‚ç‚¹ã€‚

åœ¨æ‰å¡é‡Œæ­¦æœ¯ä¿±ä¹éƒ¨æ•°æ®é›†ä¸­ï¼Œæ‰€æœ‰è¿™äº›å±æ€§è¿”å› `False`ã€‚è¿™æ„å‘³ç€å›¾æ˜¯æ— å‘çš„ï¼Œæ²¡æœ‰å­¤ç«‹èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ²¡æœ‰èŠ‚ç‚¹ä¸è‡ªèº«ç›¸è¿ã€‚

```py
print(f'Edges are directed: {data.is_directed()}')
print(f'Graph has isolated nodes: {data.has_isolated_nodes()}')
print(f'Graph has loops: {data.has_self_loops()}')
```

```py
Edges are directed: False
Graph has isolated nodes: False
Graph has loops: False
```

æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `[to_networkx](https://pytorch-geometric.readthedocs.io/en/latest/modules/utils.html?highlight=to_networkx#torch_geometric.utils.to_networkx)` å°† PyTorch Geometric å›¾è½¬æ¢ä¸ºæµè¡Œçš„å›¾åº“ [NetworkX](https://networkx.org/)ã€‚è¿™å¯¹äºä½¿ç”¨ `networkx` å’Œ `matplotlib` å¯è§†åŒ–å°å›¾ç‰¹åˆ«æœ‰ç”¨ã€‚

è®©æˆ‘ä»¬ä¸ºæ¯ä¸ªç»„ç»˜åˆ¶ä¸åŒé¢œè‰²çš„æ•°æ®é›†ã€‚

```py
from torch_geometric.utils import to_networkx
```

```py
G = to_networkx(data, to_undirected=True)
plt.figure(figsize=(12,12))
plt.axis('off')
nx.draw_networkx(G,
                pos=nx.spring_layout(G, seed=0),
                with_labels=True,
                node_size=800,
                node_color=data.y,
                cmap="hsv",
                vmin=-2,
                vmax=3,
                width=0.8,
                edge_color="grey",
                font_size=14
                )
plt.show()
```

![](img/571cb9949785200ba0307b6172e0f3fb.png)

è¿™ä¸ªæ‰å¡é‡Œæ­¦æœ¯ä¿±ä¹éƒ¨çš„å›¾æ˜¾ç¤ºäº†æˆ‘ä»¬çš„ 34 ä¸ªèŠ‚ç‚¹ã€78 æ¡ï¼ˆåŒå‘ï¼‰è¾¹å’Œ 4 ä¸ªæ ‡ç­¾åŠ 4 ç§ä¸åŒé¢œè‰²ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†ä½¿ç”¨ PyTorch Geometric åŠ è½½å’Œå¤„ç†æ•°æ®é›†çš„åŸºæœ¬å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä»‹ç»**å›¾å·ç§¯ç½‘ç»œ**æ¶æ„ã€‚

# âœ‰ï¸ II. å›¾å·ç§¯ç½‘ç»œ

æœ¬èŠ‚æ—¨åœ¨ä»å¤´å¼€å§‹ä»‹ç»å’Œæ„å»ºå›¾å·ç§¯å±‚ã€‚

åœ¨ä¼ ç»Ÿçš„ç¥ç»ç½‘ç»œä¸­ï¼Œçº¿æ€§å±‚å¯¹ä¼ å…¥çš„æ•°æ®åº”ç”¨**çº¿æ€§å˜æ¢**ã€‚è¿™ç§å˜æ¢é€šè¿‡ä½¿ç”¨æƒé‡çŸ©é˜µ ğ– å°†è¾“å…¥ç‰¹å¾ *x* è½¬æ¢ä¸ºéšè—å‘é‡ *h*ã€‚æš‚æ—¶å¿½ç•¥åå·®ï¼Œè¿™å¯ä»¥è¡¨ç¤ºä¸ºï¼š

![](img/d99b824e5c2dca4657e4b2eb18b4d9e7.png)

åœ¨å›¾æ•°æ®ä¸­ï¼Œé€šè¿‡**èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥**å¢åŠ äº†é¢å¤–çš„å¤æ‚æ€§ã€‚è¿™äº›è¿æ¥å¾ˆé‡è¦ï¼Œå› ä¸ºåœ¨ç½‘ç»œä¸­ï¼Œé€šå¸¸å‡è®¾ç›¸ä¼¼çš„èŠ‚ç‚¹æ¯”ä¸ç›¸ä¼¼çš„èŠ‚ç‚¹æ›´å¯èƒ½äº’ç›¸é“¾æ¥ï¼Œè¿™ç§ç°è±¡è¢«ç§°ä¸º[ç½‘ç»œåŒè´¨æ€§](https://en.wikipedia.org/wiki/Network_homophily)ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†èŠ‚ç‚¹çš„ç‰¹å¾ä¸é‚»å±…çš„ç‰¹å¾åˆå¹¶æ¥ä¸°å¯Œæˆ‘ä»¬çš„**èŠ‚ç‚¹è¡¨ç¤º**ã€‚è¿™ä¸ªæ“ä½œç§°ä¸ºå·ç§¯æˆ–é‚»åŸŸèšåˆã€‚è®©æˆ‘ä»¬å°†èŠ‚ç‚¹ *i* åŠå…¶é‚»åŸŸè¡¨ç¤ºä¸º *Ã‘*ã€‚

![](img/c368d96059e7977d7ff141a4b92b8bd6.png)

ä¸å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNsï¼‰ä¸­çš„æ»¤æ³¢å™¨ä¸åŒï¼Œæˆ‘ä»¬çš„æƒé‡çŸ©é˜µ ğ– æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´å…±äº«ã€‚ä½†è¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ï¼šèŠ‚ç‚¹æ²¡æœ‰åƒåƒç´ é‚£æ ·çš„**å›ºå®šé‚»å±…æ•°é‡**ã€‚

æˆ‘ä»¬å¦‚ä½•å¤„ç†ä¸€ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªé‚»å±…ï¼Œè€Œå¦ä¸€ä¸ªèŠ‚ç‚¹æœ‰ 500 ä¸ªé‚»å±…çš„æƒ…å†µï¼Ÿå¦‚æœæˆ‘ä»¬ç®€å•åœ°å°†ç‰¹å¾å‘é‡ç›¸åŠ ï¼Œé‚£ä¹ˆå¯¹äºæ‹¥æœ‰ 500 ä¸ªé‚»å±…çš„èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„åµŒå…¥ *h* å°†ä¼šå¤§å¾—å¤šã€‚ä¸ºäº†ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å…·æœ‰**ç›¸ä¼¼çš„èŒƒå›´**å¹¶ä¾¿äºæ¯”è¾ƒï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®èŠ‚ç‚¹çš„**åº¦**æ¥å½’ä¸€åŒ–ç»“æœï¼Œå…¶ä¸­åº¦æ˜¯æŒ‡ä¸€ä¸ªèŠ‚ç‚¹çš„è¿æ¥æ•°é‡ã€‚

![](img/99665492296bf842d6b89bd2c19fb899.png)

æˆ‘ä»¬å¿«åˆ°äº†ï¼ç”± Kipf ç­‰äººï¼ˆ2016ï¼‰ä»‹ç»çš„[å›¾å·ç§¯å±‚](https://arxiv.org/abs/1609.02907)è¿˜æœ‰ä¸€ä¸ªæœ€ç»ˆçš„æ”¹è¿›ã€‚

ä½œè€…è§‚å¯Ÿåˆ°ï¼Œå…·æœ‰å¤§é‡é‚»å±…çš„èŠ‚ç‚¹çš„ç‰¹å¾æ¯”é‚£äº›è¾ƒå­¤ç«‹èŠ‚ç‚¹çš„ç‰¹å¾ä¼ æ’­å¾—æ›´å®¹æ˜“ã€‚ä¸ºäº†æŠµæ¶ˆè¿™ç§æ•ˆåº”ï¼Œä»–ä»¬å»ºè®®ä¸ºé‚»å±…è¾ƒå°‘çš„èŠ‚ç‚¹çš„ç‰¹å¾åˆ†é…**æ›´å¤§çš„æƒé‡**ï¼Œä»è€Œå¹³è¡¡æ‰€æœ‰èŠ‚ç‚¹çš„å½±å“ã€‚è¿™ä¸ªæ“ä½œå¯ä»¥è¡¨ç¤ºä¸ºï¼š

![](img/04becb820335cbd89cebb547724d12ea.png)

æ³¨æ„ï¼Œå½“ *i* å’Œ *j* æ‹¥æœ‰ç›¸åŒæ•°é‡çš„é‚»å±…æ—¶ï¼Œè¿™ç­‰åŒäºæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å±‚ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ Python ä¸­ä½¿ç”¨ PyTorch Geometric å®ç°å®ƒã€‚

# ğŸ§  III. å®ç°ä¸€ä¸ª GCN

PyTorch Geometric æä¾›äº†`GCNConv`å‡½æ•°ï¼Œè¯¥å‡½æ•°ç›´æ¥å®ç°äº†å›¾å·ç§¯å±‚ã€‚

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„å›¾å·ç§¯ç½‘ç»œï¼ŒåŒ…æ‹¬ä¸€ä¸ª GCN å±‚ã€ä¸€ä¸ª ReLU æ¿€æ´»å‡½æ•°å’Œä¸€ä¸ªçº¿æ€§è¾“å‡ºå±‚ã€‚è¿™ä¸ªè¾“å‡ºå±‚å°†äº§ç”Ÿ**å››ä¸ªå€¼**ï¼Œå¯¹åº”æˆ‘ä»¬çš„å››ä¸ªç±»åˆ«ï¼Œæœ€é«˜å€¼å°†å†³å®šæ¯ä¸ªèŠ‚ç‚¹çš„ç±»åˆ«ã€‚

åœ¨ä»¥ä¸‹ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå…·æœ‰ 3 ç»´éšè—å±‚çš„ GCN å±‚ã€‚

```py
from torch.nn import Linear
from torch_geometric.nn import GCNConv 
```

```py
class GCN(torch.nn.Module):
    def __init__(self):
        super().__init__()
        self.gcn = GCNConv(dataset.num_features, 3)
        self.out = Linear(3, dataset.num_classes) def forward(self, x, edge_index):
        h = self.gcn(x, edge_index).relu()
        z = self.out(h)
        return h, zmodel = GCN()
print(model)
```

```py
GCN(
  (gcn): GCNConv(34, 3)
  (out): Linear(in_features=3, out_features=4, bias=True)
)
```

å¦‚æœæˆ‘ä»¬æ·»åŠ äº†ç¬¬äºŒä¸ª GCN å±‚ï¼Œæˆ‘ä»¬çš„æ¨¡å‹å°†ä¸ä»…ä»…ä»æ¯ä¸ªèŠ‚ç‚¹çš„é‚»å±…å¤„èšåˆç‰¹å¾å‘é‡ï¼Œè¿˜ä¼šä»è¿™äº›é‚»å±…çš„é‚»å±…å¤„èšåˆç‰¹å¾å‘é‡ã€‚

æˆ‘ä»¬å¯ä»¥**å †å å¤šä¸ªå›¾å±‚**ä»¥èšåˆæ›´å¤šçš„è¿œç¦»å€¼ï¼Œä½†æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬æ·»åŠ å¤ªå¤šå›¾å±‚ï¼Œèšåˆå˜å¾—å¦‚æ­¤å¼ºçƒˆï¼Œä»¥è‡³äºæ‰€æœ‰åµŒå…¥æœ€ç»ˆçœ‹èµ·æ¥éƒ½ä¸€æ ·ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¸º**è¿‡åº¦å¹³æ»‘**ï¼Œå½“å›¾å±‚è¿‡å¤šæ—¶ï¼Œå¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªå®é™…é—®é¢˜ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»å®šä¹‰äº† GNNï¼Œè®©æˆ‘ä»¬ç”¨ PyTorch ç¼–å†™ä¸€ä¸ªç®€å•çš„è®­ç»ƒå¾ªç¯ã€‚æˆ‘é€‰æ‹©äº†å¸¸è§„çš„äº¤å‰ç†µæŸå¤±ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¤šç±»åˆ†ç±»ä»»åŠ¡ï¼Œä¼˜åŒ–å™¨ä½¿ç”¨ Adamã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šå®ç°è®­ç»ƒ/æµ‹è¯•æ‹†åˆ†ï¼Œä»¥ä¿æŒç®€å•ï¼Œä¸“æ³¨äº GNN å¦‚ä½•å­¦ä¹ ã€‚

è®­ç»ƒå¾ªç¯æ˜¯æ ‡å‡†çš„ï¼šæˆ‘ä»¬å°è¯•é¢„æµ‹æ­£ç¡®çš„æ ‡ç­¾ï¼Œå¹¶å°† GCN çš„ç»“æœä¸ `data.y` ä¸­å­˜å‚¨çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚é€šè¿‡äº¤å‰ç†µæŸå¤±è®¡ç®—é”™è¯¯ï¼Œå¹¶ä½¿ç”¨ Adam è¿›è¡Œåå‘ä¼ æ’­ï¼Œä»¥å¾®è°ƒ GNN çš„æƒé‡å’Œåå·®ã€‚æœ€åï¼Œæˆ‘ä»¬æ¯ 10 ä¸ª epochs æ‰“å°ä¸€æ¬¡æŒ‡æ ‡ã€‚

```py
criterion = torch.nn.CrossEntropyLoss()
optimizer = torch.optim.Adam(model.parameters(), lr=0.02)
```

```py
# Calculate accuracy
def accuracy(pred_y, y):
    return (pred_y == y).sum() / len(y)# Data for animations
embeddings = []
losses = []
accuracies = []
outputs = []# Training loop
for epoch in range(201):
    # Clear gradients
    optimizer.zero_grad() # Forward pass
    h, z = model(data.x, data.edge_index) # Calculate loss function
    loss = criterion(z, data.y) # Calculate accuracy
    acc = accuracy(z.argmax(dim=1), data.y) # Compute gradients
    loss.backward() # Tune parameters
    optimizer.step() # Store data for animations
    embeddings.append(h)
    losses.append(loss)
    accuracies.append(acc)
    outputs.append(z.argmax(dim=1)) # Print metrics every 10 epochs
    if epoch % 10 == 0:
        print(f'Epoch {epoch:>3} | Loss: {loss:.2f} | Acc: {acc*100:.2f}%')
```

```py
Epoch   0 | Loss: 1.40 | Acc: 41.18%
Epoch  10 | Loss: 1.21 | Acc: 47.06%
Epoch  20 | Loss: 1.02 | Acc: 67.65%
Epoch  30 | Loss: 0.80 | Acc: 73.53%
Epoch  40 | Loss: 0.59 | Acc: 73.53%
Epoch  50 | Loss: 0.39 | Acc: 94.12%
Epoch  60 | Loss: 0.23 | Acc: 97.06%
Epoch  70 | Loss: 0.13 | Acc: 100.00%
Epoch  80 | Loss: 0.07 | Acc: 100.00%
Epoch  90 | Loss: 0.05 | Acc: 100.00%
Epoch 100 | Loss: 0.03 | Acc: 100.00%
Epoch 110 | Loss: 0.02 | Acc: 100.00%
Epoch 120 | Loss: 0.02 | Acc: 100.00%
Epoch 130 | Loss: 0.02 | Acc: 100.00%
Epoch 140 | Loss: 0.01 | Acc: 100.00%
Epoch 150 | Loss: 0.01 | Acc: 100.00%
Epoch 160 | Loss: 0.01 | Acc: 100.00%
Epoch 170 | Loss: 0.01 | Acc: 100.00%
Epoch 180 | Loss: 0.01 | Acc: 100.00%
Epoch 190 | Loss: 0.01 | Acc: 100.00%
Epoch 200 | Loss: 0.01 | Acc: 100.00%
```

å¤ªå¥½äº†ï¼æ¯«ä¸å¥‡æ€ªï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒé›†ï¼ˆå®Œæ•´æ•°æ®é›†ï¼‰ä¸Šè¾¾åˆ°äº† 100% çš„å‡†ç¡®ç‡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬çš„æ¨¡å‹å­¦ä¼šäº†æ­£ç¡®åœ°å°†æ¯ä¸ªç©ºæ‰‹é“ä¿±ä¹éƒ¨çš„æˆå‘˜åˆ†é…åˆ°æ­£ç¡®çš„ç»„ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ¨ç”»åŒ–å›¾å½¢æ¥ç”Ÿæˆä¸€ä¸ªæ•´æ´çš„å¯è§†åŒ–æ•ˆæœï¼Œå¹¶è§‚å¯Ÿ GNN åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­é¢„æµ‹çš„æ¼”å˜ã€‚

```py
%%capture
from IPython.display import HTML
from matplotlib import animation
plt.rcParams["animation.bitrate"] = 3000
```

```py
def animate(i):
    G = to_networkx(data, to_undirected=True)
    nx.draw_networkx(G,
                    pos=nx.spring_layout(G, seed=0),
                    with_labels=True,
                    node_size=800,
                    node_color=outputs[i],
                    cmap="hsv",
                    vmin=-2,
                    vmax=3,
                    width=0.8,
                    edge_color="grey",
                    font_size=14
                    )
    plt.title(f'Epoch {i} | Loss: {losses[i]:.2f} | Acc: {accuracies[i]*100:.2f}%',
              fontsize=18, pad=20)fig = plt.figure(figsize=(12, 12))
plt.axis('off')anim = animation.FuncAnimation(fig, animate, \
            np.arange(0, 200, 10), interval=500, repeat=True)
html = HTML(anim.to_html5_video())
display(html)
```

![](img/04e6b675ab152228d57739474387a402.png)

æœ€åˆçš„é¢„æµ‹æ˜¯éšæœºçš„ï¼Œä½†ç»è¿‡ä¸€æ®µæ—¶é—´ï¼ŒGCN èƒ½å¤Ÿå®Œç¾åœ°æ ‡è®°æ¯ä¸ªèŠ‚ç‚¹ã€‚å®é™…ä¸Šï¼Œæœ€ç»ˆçš„å›¾å½¢ä¸æˆ‘ä»¬åœ¨ç¬¬ä¸€éƒ¨åˆ†æœ«å°¾ç»˜åˆ¶çš„å›¾å½¢ç›¸åŒã€‚ä½† GCN åˆ°åº•å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ

é€šè¿‡èšåˆé‚»è¿‘èŠ‚ç‚¹çš„ç‰¹å¾ï¼ŒGNN å­¦ä¹ äº†ç½‘ç»œä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å‘é‡è¡¨ç¤ºï¼ˆæˆ–**åµŒå…¥**ï¼‰ã€‚åœ¨æˆ‘ä»¬çš„æ¨¡å‹ä¸­ï¼Œæœ€ç»ˆå±‚ä»…å­¦ä¹ å¦‚ä½•ä½¿ç”¨è¿™äº›è¡¨ç¤ºæ¥äº§ç”Ÿæœ€ä½³åˆ†ç±»ã€‚ç„¶è€Œï¼ŒåµŒå…¥æ‰æ˜¯çœŸæ­£çš„ GNN äº§ç‰©ã€‚

è®©æˆ‘ä»¬æ‰“å°å‡ºæ¨¡å‹å­¦åˆ°çš„åµŒå…¥ã€‚

```py
# Print embeddings
print(f'Final embeddings = {h.shape}')
print(h)
```

```py
Final embeddings = torch.Size([34, 3])
tensor([[1.9099e+00, 2.3584e+00, 7.4027e-01],
        [2.6203e+00, 2.7997e+00, 0.0000e+00],
        [2.2567e+00, 2.2962e+00, 6.4663e-01],
        [2.0802e+00, 2.8785e+00, 0.0000e+00],
        [0.0000e+00, 0.0000e+00, 2.9694e+00],
        [0.0000e+00, 0.0000e+00, 3.3817e+00],
        [0.0000e+00, 1.5008e-04, 3.4246e+00],
        [1.7593e+00, 2.4292e+00, 2.4551e-01],
        [1.9757e+00, 6.1032e-01, 1.8986e+00],
        [1.7770e+00, 1.9950e+00, 6.7018e-01],
        [0.0000e+00, 1.1683e-04, 2.9738e+00],
        [1.8988e+00, 2.0512e+00, 2.6225e-01],
        [1.7081e+00, 2.3618e+00, 1.9609e-01],
        [1.8303e+00, 2.1591e+00, 3.5906e-01],
        [2.0755e+00, 2.7468e-01, 1.9804e+00],
        [1.9676e+00, 3.7185e-01, 2.0011e+00],
        [0.0000e+00, 0.0000e+00, 3.4787e+00],
        [1.6945e+00, 2.0350e+00, 1.9789e-01],
        [1.9808e+00, 3.2633e-01, 2.1349e+00],
        [1.7846e+00, 1.9585e+00, 4.8021e-01],
        [2.0420e+00, 2.7512e-01, 1.9810e+00],
        [1.7665e+00, 2.1357e+00, 4.0325e-01],
        [1.9870e+00, 3.3886e-01, 2.0421e+00],
        [2.0614e+00, 5.1042e-01, 2.4872e+00],
...
        [2.1778e+00, 4.4730e-01, 2.0077e+00],
        [3.8906e-02, 2.3443e+00, 1.9195e+00],
        [3.0748e+00, 0.0000e+00, 3.0789e+00],
        [3.4316e+00, 1.9716e-01, 2.5231e+00]], grad_fn=<ReluBackward0>)
```

å¦‚ä½ æ‰€è§ï¼ŒåµŒå…¥ä¸éœ€è¦å…·æœ‰ä¸ç‰¹å¾å‘é‡ç›¸åŒçš„ç»´åº¦ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘é€‰æ‹©å°†ç»´åº¦ä» 34 (`dataset.num_features`) é™åˆ°ä¸‰ç»´ï¼Œä»¥è·å¾—æ›´å¥½çš„ 3D å¯è§†åŒ–æ•ˆæœã€‚

è®©æˆ‘ä»¬åœ¨è®­ç»ƒå¼€å§‹ä¹‹å‰ï¼Œå³ç¬¬ 0 è½®ï¼Œç»˜åˆ¶è¿™äº›åµŒå…¥ã€‚

```py
# Get first embedding at epoch = 0
embed = h.detach().cpu().numpy()
```

```py
fig = plt.figure(figsize=(12, 12))
ax = fig.add_subplot(projection='3d')
ax.patch.set_alpha(0)
plt.tick_params(left=False,
                bottom=False,
                labelleft=False,
                labelbottom=False)
ax.scatter(embed[:, 0], embed[:, 1], embed[:, 2],
           s=200, c=data.y, cmap="hsv", vmin=-2, vmax=3)plt.show()
```

![](img/a961a759d54dbe8911d59fb3ab66f824.png)

æˆ‘ä»¬çœ‹åˆ° Zachary ç©ºæ‰‹é“ä¿±ä¹éƒ¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹åŠå…¶çœŸå®æ ‡ç­¾ï¼ˆè€Œä¸æ˜¯æ¨¡å‹çš„é¢„æµ‹ï¼‰ã€‚ç›®å‰ï¼Œå®ƒä»¬è¿˜å¾ˆåˆ†æ•£ï¼Œå› ä¸º GNN å°šæœªè®­ç»ƒå®Œæˆã€‚ä½†å¦‚æœæˆ‘ä»¬åœ¨è®­ç»ƒå¾ªç¯çš„æ¯ä¸€æ­¥ç»˜åˆ¶è¿™äº›åµŒå…¥ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿå¯è§†åŒ– GNN å®é™…ä¸Šå­¦åˆ°äº†ä»€ä¹ˆã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬éšç€æ—¶é—´çš„æ¨ç§»å¦‚ä½•æ¼”å˜ï¼Œéšç€ GCN åœ¨åˆ†ç±»èŠ‚ç‚¹æ–¹é¢å˜å¾—è¶Šæ¥è¶Šå¥½ã€‚

```py
%%capture
```

```py
def animate(i):
    embed = embeddings[i].detach().cpu().numpy()
    ax.clear()
    ax.scatter(embed[:, 0], embed[:, 1], embed[:, 2],
           s=200, c=data.y, cmap="hsv", vmin=-2, vmax=3)
    plt.title(f'Epoch {i} | Loss: {losses[i]:.2f} | Acc: {accuracies[i]*100:.2f}%',
              fontsize=18, pad=40)fig = plt.figure(figsize=(12, 12))
plt.axis('off')
ax = fig.add_subplot(projection='3d')
plt.tick_params(left=False,
                bottom=False,
                labelleft=False,
                labelbottom=False)anim = animation.FuncAnimation(fig, animate, \
              np.arange(0, 200, 10), interval=800, repeat=True)
html = HTML(anim.to_html5_video())
display(html)
```

![](img/b4af8ca00284bd6d1418674e7584cebe.png)

æˆ‘ä»¬çš„å›¾å·ç§¯ç½‘ç»œï¼ˆGCNï¼‰æœ‰æ•ˆåœ°å­¦ä¹ äº†å°†ç›¸ä¼¼èŠ‚ç‚¹åˆ†ç»„åˆ°**ä¸åŒçš„ç°‡**ä¸­çš„åµŒå…¥ã€‚è¿™ä½¿å¾—æœ€ç»ˆçš„çº¿æ€§å±‚èƒ½å¤Ÿè½»æ¾åœ°åŒºåˆ†å®ƒä»¬ä¸ºä¸åŒçš„ç±»åˆ«ã€‚

åµŒå…¥å¹¶é GNN ç‰¹æœ‰ï¼šå®ƒä»¬åœ¨æ·±åº¦å­¦ä¹ ä¸­æ— å¤„ä¸åœ¨ã€‚å®ƒä»¬ä¹Ÿä¸ä¸€å®šæ˜¯ä¸‰ç»´çš„ï¼šå®é™…ä¸Šï¼Œå®ƒä»¬å¾ˆå°‘æ˜¯ä¸‰ç»´çš„ã€‚ä¾‹å¦‚ï¼Œåƒ[BERT](https://arxiv.org/abs/1810.04805)è¿™æ ·çš„è¯­è¨€æ¨¡å‹ç”Ÿæˆçš„åµŒå…¥ç»´åº¦é€šå¸¸æ˜¯ 768 ç”šè‡³ 1024ã€‚

é¢å¤–çš„ç»´åº¦å­˜å‚¨äº†å…³äºèŠ‚ç‚¹ã€æ–‡æœ¬ã€å›¾åƒç­‰æ›´å¤šçš„ä¿¡æ¯ï¼Œä½†å®ƒä»¬ä¹Ÿä¼šåˆ›å»ºæ›´å¤§çš„æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹æ›´éš¾ä»¥è®­ç»ƒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå°½å¯èƒ½ä¿æŒä½ç»´åµŒå…¥æ˜¯æœ‰åˆ©çš„åŸå› ã€‚

# ç»“è®º

å›¾å·ç§¯ç½‘ç»œæ˜¯ä¸€ç§éå¸¸å¤šåŠŸèƒ½çš„æ¶æ„ï¼Œå¯ä»¥åº”ç”¨äº**è®¸å¤šèƒŒæ™¯**ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰äº† PyTorch Geometric åº“ä»¥åŠåƒ`Datasets`å’Œ`Data`è¿™æ ·çš„å¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬æˆåŠŸåœ°ä»å¤´å¼€å§‹é‡å»ºäº†ä¸€ä¸ªå›¾å·ç§¯å±‚ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡å®ç°ä¸€ä¸ª GCN å°†ç†è®ºä»˜è¯¸å®è·µï¼Œè¿™ä½¿æˆ‘ä»¬ç†è§£äº†å®é™…çš„æ–¹é¢ä»¥åŠå„ä¸ªç»„ä»¶å¦‚ä½•ç›¸äº’ä½œç”¨ã€‚æœ€åï¼Œæˆ‘ä»¬å¯è§†åŒ–äº†è®­ç»ƒè¿‡ç¨‹ï¼Œå¹¶æ¸…æ¥šåœ°äº†è§£äº†è¿™ç§ç½‘ç»œæ‰€æ¶‰åŠçš„å†…å®¹ã€‚

Zachary çš„ç©ºæ‰‹é“ä¿±ä¹éƒ¨æ˜¯ä¸€ä¸ªç®€å•çš„æ•°æ®é›†ï¼Œä½†è¶³å¤Ÿç”¨æ¥ç†è§£å›¾æ•°æ®å’Œ GNN ä¸­çš„æœ€é‡è¦æ¦‚å¿µã€‚å°½ç®¡æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä»…è®¨è®ºäº†èŠ‚ç‚¹åˆ†ç±»ï¼Œä½† GNN è¿˜å¯ä»¥å®Œæˆå…¶ä»–ä»»åŠ¡ï¼š**é“¾æ¥é¢„æµ‹**ï¼ˆä¾‹å¦‚ï¼Œæ¨èæœ‹å‹ï¼‰ã€**å›¾åˆ†ç±»**ï¼ˆä¾‹å¦‚ï¼Œæ ‡è®°åˆ†å­ï¼‰ã€**å›¾ç”Ÿæˆ**ï¼ˆä¾‹å¦‚ï¼Œåˆ›å»ºæ–°åˆ†å­ï¼‰ç­‰ã€‚

é™¤äº† GCN ä¹‹å¤–ï¼Œç ”ç©¶äººå‘˜è¿˜æå‡ºäº†è®¸å¤š GNN å±‚å’Œæ¶æ„ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»[å›¾æ³¨æ„åŠ›ç½‘ç»œ](https://mlabonne.github.io/blog/gat/)ï¼ˆGATï¼‰æ¶æ„ï¼Œå®ƒé€šè¿‡æ³¨æ„æœºåˆ¶åŠ¨æ€è®¡ç®— GCN çš„å½’ä¸€åŒ–å› å­å’Œæ¯ä¸ªè¿æ¥çš„é‡è¦æ€§ã€‚

å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºå›¾ç¥ç»ç½‘ç»œçš„ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡æˆ‘çš„ä¹¦ç±[ã€ŠåŠ¨æ‰‹å®è·µå›¾ç¥ç»ç½‘ç»œã€‹](https://mlabonne.github.io/blog/book.html)æ·±å…¥æ¢ç´¢ GNN çš„ä¸–ç•Œã€‚

# ä¸‹ä¸€ç¯‡æ–‡ç« 

[](/graph-attention-networks-in-python-975736ac5c0c?source=post_page-----24b3f60d6c95--------------------------------) ## ç¬¬äºŒç« ï¼šå›¾æ³¨æ„åŠ›ç½‘ç»œï¼šè‡ªæ³¨æ„åŠ›è§£æ

### ä½¿ç”¨ PyTorch Geometric çš„è‡ªæ³¨æ„åŠ› GNN æŒ‡å—

[towardsdatascience.com

*é€šè¿‡ç‚¹å‡»ä¸€ä¸‹äº†è§£æ›´å¤šæœºå™¨å­¦ä¹ çŸ¥è¯†å¹¶æ”¯æŒæˆ‘çš„å·¥ä½œ â€” æˆä¸º Medium ä¼šå‘˜ï¼Œè¯·ç‚¹å‡»è¿™é‡Œï¼š*

[](https://medium.com/@mlabonne/membership?source=post_page-----24b3f60d6c95--------------------------------) [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Medium â€” Maxime Labonne

### ä½œä¸º Medium ä¼šå‘˜ï¼Œä½ çš„ä¼šå‘˜è´¹çš„ä¸€éƒ¨åˆ†å°†ç”¨äºæ”¯æŒä½ é˜…è¯»çš„ä½œè€…ï¼Œä½ å°†è·å¾—å¯¹æ¯ä¸ªæ•…äº‹çš„å®Œå…¨è®¿é—®æƒé™â€¦â€¦

[medium.com](https://medium.com/@mlabonne/membership?source=post_page-----24b3f60d6c95--------------------------------)

*å¦‚æœä½ å·²ç»æ˜¯ä¼šå‘˜ï¼Œä½ å¯ä»¥* [*åœ¨ Medium ä¸Šå…³æ³¨æˆ‘*](https://medium.com/@mlabonne)*.*
