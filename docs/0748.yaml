- en: 'Case Study: Practical Label Encoding with Rainbow Method'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/case-study-practical-label-encoding-with-rainbow-method-d167c386e78?source=collection_archive---------13-----------------------#2023-02-24](https://towardsdatascience.com/case-study-practical-label-encoding-with-rainbow-method-d167c386e78?source=collection_archive---------13-----------------------#2023-02-24)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: A real-world test on MassMutual’s production model
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@anna_arakelyan?source=post_page-----d167c386e78--------------------------------)[![Anna
    Arakelyan](../Images/fd742f57a1443a275f44786dfe78c020.png)](https://medium.com/@anna_arakelyan?source=post_page-----d167c386e78--------------------------------)[](https://towardsdatascience.com/?source=post_page-----d167c386e78--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----d167c386e78--------------------------------)
    [Anna Arakelyan](https://medium.com/@anna_arakelyan?source=post_page-----d167c386e78--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: ·
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5058c6266b23&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcase-study-practical-label-encoding-with-rainbow-method-d167c386e78&user=Anna+Arakelyan&userId=5058c6266b23&source=post_page-5058c6266b23----d167c386e78---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----d167c386e78--------------------------------)
    ·7 min read·Feb 24, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd167c386e78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcase-study-practical-label-encoding-with-rainbow-method-d167c386e78&user=Anna+Arakelyan&userId=5058c6266b23&source=-----d167c386e78---------------------clap_footer-----------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd167c386e78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcase-study-practical-label-encoding-with-rainbow-method-d167c386e78&source=-----d167c386e78---------------------bookmark_footer-----------)'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: '*Co-authored with* [*Dmytro Karabash*](https://medium.com/u/79cc5dc1f7e1)'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c35a74496e5749414655443e3f3bb5a1.png)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
- en: Photo by [Jason Pogacnik](https://unsplash.com/photos/BY8FZFwLMK0) on [Unsplash](https://unsplash.com/)
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: 'In our previous article, “[Hidden Data Science Gem: Rainbow Method for Label
    Encoding](/hidden-data-science-gem-rainbow-method-for-label-encoding-dfd69f4711e1)”,
    we discussed the advantages of using label encoding over one-hot encoding for
    categorical variables, especially when developing tree-based models. We introduced
    the Rainbow method, which helps identify the most appropriate ordinal encoding
    for different types of categorical variables.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: In this article, we will continue exploring the Rainbow method— this time, from
    a practical perspective, demonstrating its effectiveness using a real project
    developed by the [Data Science team](https://careers.massmutual.com/explore-careers-data-science/)
    at [MassMutual](https://www.massmutual.com/), an esteemed life insurance company
    that prides itself on promoting data scientists, engineers, and technologists
    to help make informed business decisions.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: Business Use Case
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The goal is to predict one of five Mindset Segments for each prospective customer.
    Essentially, it is a multi-class classification problem.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: The segmentation framework comprises five classes that reflect a person’s age,
    financial stability, and attitude toward financial decisions. The MassMutual marketing
    team then uses the predicted segments in various campaigns for targeting and customization.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/26e20118fd5b0d74406539bf37f925c2.png)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
- en: Figure 1 (drawn by Anna Arakelyan)
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: For instance, customers exhibiting Mindset A tend to prioritize independence
    and autonomy in deciding whether to purchase a life insurance policy, whereas
    customers with Mindset B often prefer to receive guidance and detailed explanations
    of various financial products from a dedicated advisor.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: The data represent a small set of labeled individuals (17.5K persons) with labels
    provided by a MassMutual vendor who designed the segment assignment rules. We
    first added columns from our main prospect database to this data. The objective
    is to learn the best model using these target labels and available features, and
    predict segments for all other (unlabeled) prospective customers.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: We use a consumer database that covers approximately 300 columns representing
    a diverse range of demographic characteristics, such as household composition,
    income and net worth propensities, financial behavior, and digital savviness.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: In this article, we compare the conventional One-hot encoding with the ordinal
    encoding via the Rainbow method using the consumer database and the Mindset Segmentation
    project. We showcase a few standard metrics — such as Macro Avg F1 score, Macro
    Avg AUC ROC, Cohen’s Kappa, and Accuracy — for interpretation and comparison purposes
    in this 5-class classification problem.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: Categorical Variables
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We selected all categorical variables in the consumer database — including interval,
    ordinal, and nominal variables — but excluded quantitative and binary variables.
    The aim is to demonstrate the difference in model performance between One-hot
    and Rainbow encoding for the same set of categorical factors.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: We performed a target stratified 4-fold Cross-Validation split, and all data
    processing from this point was done inside the cross-validation loop. This included
    creating One-hot features and Rainbow features from each fold’s train set and
    then applying them to each fold’s validation set.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: The total set of 111 variables was transformed into 121 Rainbow features, and
    alternatively into 2260 One-hot features.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/dfcc0d1da586df8d7d27b38a0469fcfb.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
- en: Table 1\. List of variables before and after encoding
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: The Rainbow transformation for interval and ordinal variables was straightforward,
    resulting in 64 Rainbows from 64 interval features and 14 Rainbows from 14 ordinal
    features.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: The nominal variables’ transformation was more involved, where we created 23
    natural attribute Rainbows and 20 artificial Rainbow features for the remaining
    10 variables. Since we were dealing with five classes, we applied correlation
    ordering and target percent ordering for a random class (see the section [Automated
    Rainbow Selection](/hidden-data-science-gem-rainbow-method-for-label-encoding-dfd69f4711e1#ec50)
    of the original article). For example, the nominal variable “Financial_Cluster”
    was transformed into features “*Financial_Cluster_Mindset_B_correlation_rank*”
    and “*Financial_Cluster_Mindset_D_target_percent*”. Overall, 33 nominal variables
    were transformed into 43 Rainbows.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: Making a choice on the actual ordering — whether it be a natural attribute Rainbow
    or artificial Rainbow — is highly project and context-specific, and is more of
    an art than a science. It requires balancing model simplicity, performance, and
    interpretability.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: Unlike ordinal encoding, One-hot transformation generates over two thousand
    features.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: Why do we make One-hot features for interval and ordinal variables here? Because
    we want to compare Rainbow with One-hot on the full continuum of possible ordering
    — from perfect order, to fuzzy order, to no order (or wrong order).
  id: totrans-32
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Additionally, the classification of a variable into ordinal or nominal is sometimes
    a subjective decision. One bright example is Color. As we discussed in our [first
    article](/hidden-data-science-gem-rainbow-method-for-label-encoding-dfd69f4711e1),
    Color is considered nominal by some modelers, and ordinal by others.
  id: totrans-33
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Initially, we pooled all categorical variables, but later in the article, we
    analyzed interval, ordinal, and nominal variables separately.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: 'We trained all *XGBoost* models covering the hyperparameter space shown below:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: We avoided setting max_depth higher than 5 due to the relatively small data
    size and the need to have at least 100 samples at the end of each branch. We preferred
    using a simple model, which also helps prevent overfit.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: All of the results below represent cross-validation average metrics.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: Aggregate Results
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let us start with the overall averages across all runs. Clearly, the average
    metrics across all models are higher for Rainbow encoding. The overall difference
    is a few percentage points.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/18e6bbfc8456185d80786dfac29570e1.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
- en: Figure 2 (generated by author)
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: Hyperparameters
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The plots below illustrate the changes in metrics for each hyperparameter while
    keeping all other hyperparameters constant. These plots also clearly demonstrate
    that Rainbow outcomes exceed One-hot outcomes for each hyperparameter and metric.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d4f3c9d9544b78ce70ab0e0759d2f202.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
- en: Figure 3a (generated by author)
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/991691aaa512e61abb581dfff7703f30.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
- en: Figure 3b (generated by author)
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/488ffd3527caa93c2eb62c8f0fb9ee27.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
- en: Figure 3c (generated by author)
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: Runtime
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Next, let’s compare the runtimes for each method.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The average time to run a single Rainbow model is nearly 12 times faster than
    that of a single One-hot model! So, in addition to significantly improving the
    model performance metrics, we can see that the Rainbow method can also save data
    scientists an enormous amount of time.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: Interval, Ordinal, and Nominal
  id: totrans-55
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Next, we ran the models which covered the bundles of interval, ordinal, and
    nominal features separately. The results are listed below.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/714d73a19b1db682614be3c22057948b.png)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
- en: Figure 4 (generated by author)
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: These outcomes once again highlight the fact that Rainbow is preferred to One-hot.
    As expected, interval and ordinal features gain the most from Rainbow encoding
    — less so for nominal variables.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: Clearly, the more defined the category order, the higher the benefits of preferring
    Rainbow to One-hot. While the performance of Rainbow for nominal variables is
    either similar or negligibly lower than One-hot, it still achieves the same level
    of performance in considerably less time by using substantially less space, and
    the resulting model is significantly simpler.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: Feature Selection
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Finally, to ensure a fair comparison in terms of dimensionality, we selected
    the top 10, 50, and 100 features from each feature set (Rainbow and One-hot).
    We utilized the feature importance attribute of the *XGBoost* model and aggregated
    feature importance scores for four cross-validation folds on the best hyperparameter
    set for each encoding type. The results are presented below.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8e3402d9ea4aae243269ed5a8ce06405.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
- en: Figure 5 (generated by author)
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: Rainbow encoding outperforms One-hot encoding with ease, particularly for a
    smaller number of features. Rainbow encoding reaches its peak performance faster
    than One-hot encoding and utilizes fewer features. Indeed, with only 10 features,
    Rainbow encoding is already near its peak, while it takes One-hot encoding 50–100
    features to reach a similar level!
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: Furthermore, Rainbow encoding even exhibits better results for 50 features than
    One-hot encoding does for 100 features. It is worth noting that when reducing
    the feature count from 50 to 10, the reduction in Macro-F1 for One-hot encoding
    is six times higher than that of the Rainbow method (three times for Kappa and
    Accuracy, and two times for Macro-AUC).
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: Concluding Notes
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The example of the Mindset Segmentation model at MassMutual clearly illustrates
    that Rainbow label encoding is superior to One-hot encoding. Not only does it
    save significant time for modelers, it also substantially reduces dimensionality
    and provides an organic framework for feature selection. Moreover, if the chosen
    Rainbow order agrees with the data-generating process, then this encoding can
    also lead to significant improvements in model performance metrics.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: MassMutual 的心态分段模型的例子清楚地说明了 Rainbow 标签编码优于 One-hot 编码。**不仅**为建模人员节省了大量时间，还显著降低了维度，并提供了一个有机的特征选择框架。*此外*，如果所选的
    Rainbow 顺序与数据生成过程一致，那么这种编码还可以显著提升模型性能指标。
