# ä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•åœ¨å¤šé‡å‡è®¾æ£€éªŒä¸­è°ƒæ•´ P å€¼

> åŸæ–‡ï¼š[`towardsdatascience.com/why-and-how-to-adjust-p-values-in-multiple-hypothesis-testing-2ccf174cdbf8?source=collection_archive---------0-----------------------#2023-05-05`](https://towardsdatascience.com/why-and-how-to-adjust-p-values-in-multiple-hypothesis-testing-2ccf174cdbf8?source=collection_archive---------0-----------------------#2023-05-05)

## åœ¨é€‰æ‹©ç›¸å…³ç‰¹å¾æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä½äºæŸä¸ªé˜ˆå€¼çš„ P å€¼ä½œä¸ºä¸€ç§æ–¹æ³•ã€‚ä»¥ä¸‹å»ºè®®è¯´æ˜äº†å¦‚ä½•æ­£ç¡®ä½¿ç”¨å®ƒä»¬ã€‚

[](https://medium.com/@igor-s?source=post_page-----2ccf174cdbf8--------------------------------)![Igor Å egota](https://medium.com/@igor-s?source=post_page-----2ccf174cdbf8--------------------------------)[](https://towardsdatascience.com/?source=post_page-----2ccf174cdbf8--------------------------------)![æ•°æ®ç§‘å­¦å‰æ²¿](https://towardsdatascience.com/?source=post_page-----2ccf174cdbf8--------------------------------) [Igor Å egota](https://medium.com/@igor-s?source=post_page-----2ccf174cdbf8--------------------------------)

Â·

[å…³æ³¨](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe5f8ebca4ad8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-and-how-to-adjust-p-values-in-multiple-hypothesis-testing-2ccf174cdbf8&user=Igor+%C5%A0egota&userId=e5f8ebca4ad8&source=post_page-e5f8ebca4ad8----2ccf174cdbf8---------------------post_header-----------) å‘è¡¨åœ¨ [æ•°æ®ç§‘å­¦å‰æ²¿](https://towardsdatascience.com/?source=post_page-----2ccf174cdbf8--------------------------------) Â· 9 åˆ†é’Ÿé˜…è¯» Â· 2023 å¹´ 5 æœˆ 5 æ—¥[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2ccf174cdbf8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-and-how-to-adjust-p-values-in-multiple-hypothesis-testing-2ccf174cdbf8&user=Igor+%C5%A0egota&userId=e5f8ebca4ad8&source=-----2ccf174cdbf8---------------------clap_footer-----------)

--

[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2ccf174cdbf8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-and-how-to-adjust-p-values-in-multiple-hypothesis-testing-2ccf174cdbf8&source=-----2ccf174cdbf8---------------------bookmark_footer-----------)![](img/d511c23677ff0b8f644e2dbec2ba25c2.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚æ‹æ‘„äºåŠ å·æ‹‰è·äºšçš„ Westfield UTC è´­ç‰©ä¸­å¿ƒã€‚

å¤šé‡å‡è®¾æ£€éªŒå‘ç”Ÿåœ¨æˆ‘ä»¬åœ¨å¤šä¸ªç‰¹å¾ä¸Šé‡å¤æµ‹è¯•æ¨¡å‹æ—¶ï¼Œå› ä¸ºéšç€æµ‹è¯•æ•°é‡çš„å¢åŠ ï¼Œè·å¾—ä¸€ä¸ªæˆ–å¤šä¸ªå‡å‘ç°çš„æ¦‚ç‡ä¹Ÿä¼šå¢åŠ ã€‚ä¾‹å¦‚ï¼Œåœ¨åŸºå› ç»„å­¦é¢†åŸŸï¼Œç§‘å­¦å®¶ä»¬ç»å¸¸æƒ³è¦æµ‹è¯•æˆåƒä¸Šä¸‡çš„åŸºå› ä¸­æ˜¯å¦æœ‰ä»»ä½•åŸºå› åœ¨æŸä¸ªç»“æœä¸­è¡¨ç°å‡ºæ˜¾è‘—ä¸åŒçš„æ´»æ€§ã€‚æˆ–è€…[ç³–æœæ˜¯å¦ä¼šå¯¼è‡´ç—¤ç–®](https://xkcd.com/882/)ã€‚

åœ¨è¿™ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å‡ ç§å¸¸ç”¨çš„æ–¹æ³•ï¼Œé€šè¿‡è°ƒæ•´æ¨¡å‹ p å€¼æ¥è€ƒè™‘å¤šé‡å‡è®¾æ£€éªŒï¼š

1.  å‡é˜³æ€§ç‡ï¼ˆFPRï¼‰

1.  å®¶åº­é”™è¯¯ç‡ï¼ˆFWERï¼‰

1.  å‡é˜³æ€§ç‡ï¼ˆFDRï¼‰

å¹¶è§£é‡Šä½•æ—¶ä½¿ç”¨è¿™äº›æ–¹æ³•æ˜¯æœ‰æ„ä¹‰çš„ã€‚

è¿™ä»½æ–‡æ¡£å¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹å›¾åƒï¼š

![](img/5943b7c02580e3f0811215a96b4c40be.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

# åˆ›å»ºæµ‹è¯•æ•°æ®

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿç¤ºä¾‹ï¼Œä»¥æ›´å¥½åœ°ç†è§£å¦‚ä½•é€šè¿‡å„ç§ p å€¼æ“ä½œå¾—å‡ºä¸åŒçš„ç»“è®ºã€‚è¦è¿è¡Œæ­¤ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…`pandas`ã€`numpy`ã€`scipy`å’Œ`statsmodels`åº“çš„ Python ç¯å¢ƒã€‚

ä¸ºäº†è¿™ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ªåŒ…å« 1000 ä¸ªç‰¹å¾çš„ Pandas DataFrame å¼€å§‹ã€‚å…¶ä¸­ 990 ä¸ªç‰¹å¾ï¼ˆ99%ï¼‰çš„å€¼å°†ä»å‡å€¼ä¸º 0 çš„æ­£æ€åˆ†å¸ƒä¸­ç”Ÿæˆï¼Œè¿™ç§°ä¸ºç©ºæ¨¡å‹ã€‚ï¼ˆåœ¨ä¸‹é¢ä½¿ç”¨çš„å‡½æ•°`norm.rvs()`ä¸­ï¼Œå‡å€¼æ˜¯é€šè¿‡`loc`å‚æ•°è®¾ç½®çš„ã€‚ï¼‰å…¶ä½™çš„ 1%çš„ç‰¹å¾å°†ä»å‡å€¼ä¸º 3 çš„æ­£æ€åˆ†å¸ƒä¸­ç”Ÿæˆï¼Œè¿™ç§°ä¸ºéç©ºæ¨¡å‹ã€‚æˆ‘ä»¬å°†ç”¨è¿™äº›ç‰¹å¾æ¥è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›å‘ç°çš„æœ‰è¶£ç‰¹å¾ã€‚

```py
import pandas as pd
import numpy as np
from scipy.stats import norm
from statsmodels.stats.multitest import multipletests

np.random.seed(42)

n_null = 9900
n_nonnull = 100

df = pd.DataFrame({
    'hypothesis': np.concatenate((
        ['null'] * n_null,
        ['non-null'] * n_nonnull,
    )),
    'feature': range(n_null + n_nonnull),
    'x': np.concatenate((
        norm.rvs(loc=0, scale=1, size=n_null),
        norm.rvs(loc=3, scale=1, size=n_nonnull),
    ))
})
```

å¯¹äºæ¯ä¸ª 1000 ä¸ªç‰¹å¾ä¸­çš„ç‰¹å¾ï¼Œp å€¼æ˜¯è§‚å¯Ÿåˆ°çš„å€¼è‡³å°‘å¦‚æ­¤ä¹‹å¤§ï¼ˆå‡è®¾å®ƒæ˜¯ä»ç©ºåˆ†å¸ƒç”Ÿæˆçš„ï¼‰çš„æ¦‚ç‡ã€‚

p å€¼å¯ä»¥é€šè¿‡ç´¯ç§¯åˆ†å¸ƒï¼ˆ`norm.cdf()`æ¥è‡ª`scipy.stats`ï¼‰è®¡ç®—ï¼Œç´¯ç§¯åˆ†å¸ƒè¡¨ç¤ºè·å¾—ä¸€ä¸ªå€¼ç­‰äºæˆ–**å°äº**è§‚å¯Ÿåˆ°çš„å€¼çš„æ¦‚ç‡ã€‚ç„¶åä¸ºäº†è®¡ç®— p å€¼ï¼Œæˆ‘ä»¬è®¡ç®—`1 - norm.cdf()`æ¥æ‰¾åˆ°**å¤§äº**è§‚å¯Ÿåˆ°çš„å€¼çš„æ¦‚ç‡ï¼š

```py
df['p_value'] = 1 - norm.cdf(df['x'], loc = 0, scale = 1)
df
```

![](img/1e09fe5152cdf959d5bb5fa916a04c49.png)

# å‡é˜³æ€§ç‡

ç¬¬ä¸€ä¸ªæ¦‚å¿µç§°ä¸ºå‡é˜³æ€§ç‡ï¼Œå®šä¹‰ä¸ºæˆ‘ä»¬æ ‡è®°ä¸ºâ€œæ˜¾è‘—â€çš„ç©ºå‡è®¾çš„æ¯”ä¾‹ï¼ˆä¹Ÿç§°ä¸ºç¬¬ä¸€ç±»é”™è¯¯ï¼‰ã€‚æˆ‘ä»¬ä¹‹å‰è®¡ç®—çš„ p å€¼å¯ä»¥æŒ‰å…¶å®šä¹‰è§£é‡Šä¸ºå‡é˜³æ€§ç‡ï¼šå®ƒä»¬æ˜¯ä»ç©ºåˆ†å¸ƒä¸­è·å–ä¸€ä¸ªå€¼è‡³å°‘ä¸æŒ‡å®šå€¼ä¸€æ ·å¤§çš„æ¦‚ç‡ã€‚

ä¸ºäº†è¯´æ˜ï¼Œæˆ‘ä»¬å°†åº”ç”¨ä¸€ä¸ªå¸¸è§çš„ï¼ˆç¥å¥‡çš„ğŸ§™ï¼‰p å€¼é˜ˆå€¼ 0.05ï¼Œä½†å¯ä»¥ä½¿ç”¨ä»»ä½•é˜ˆå€¼ï¼š

```py
df['is_raw_p_value_significant'] = df['p_value'] <= 0.05
df.groupby(['hypothesis', 'is_raw_p_value_significant']).size()
```

```py
hypothesis  is_raw_p_value_significant
non-null    False                            8
            True                            92
null        False                         9407
            True                           493
dtype: int64
```

æ³¨æ„ï¼Œåœ¨æˆ‘ä»¬çš„ 9900 ä¸ªé›¶å‡è®¾ä¸­ï¼Œ493 ä¸ªè¢«æ ‡è®°ä¸ºâ€œæ˜¾è‘—â€ã€‚å› æ­¤ï¼Œå‡é˜³æ€§ç‡ä¸ºï¼šFPR = 493 / (493 + 9407) = 0.053ã€‚

FPR çš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œåœ¨å®é™…æƒ…å†µä¸­ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å“ªäº›å‡è®¾æ˜¯ç©ºçš„ï¼Œå“ªäº›ä¸æ˜¯ã€‚å› æ­¤ï¼Œä»…å‡­åŸå§‹ p å€¼ï¼ˆå‡é˜³æ€§ç‡ï¼‰ç”¨é€”æœ‰é™ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œå½“éç©ºç‰¹å¾çš„æ¯”ä¾‹éå¸¸å°ï¼Œå¤§å¤šæ•°æ ‡è®°ä¸ºæ˜¾è‘—çš„ç‰¹å¾å°†æ˜¯ç©ºçš„ï¼Œå› ä¸ºå®ƒä»¬çš„æ•°é‡æ›´å¤šã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ 92 + 493 = 585 ä¸ªæ ‡è®°ä¸ºçœŸæ­£ï¼ˆâ€œæ­£â€ï¼‰çš„ç‰¹å¾ä¸­ï¼Œåªæœ‰ 92 ä¸ªæ¥è‡ªæˆ‘ä»¬çš„éç©ºåˆ†å¸ƒã€‚è¿™æ„å‘³ç€å¤§å¤šæ•°æˆ–çº¦ 84%ï¼ˆ493 / 585ï¼‰çš„æŠ¥å‘Šæ˜¾è‘—ç‰¹å¾æ˜¯å‡é˜³æ€§ï¼

é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ­¤åšäº›ä»€ä¹ˆï¼Ÿæœ‰ä¸¤ç§å¸¸è§çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬å¯ä»¥è®¡ç®—å®¶åº­-wise é”™è¯¯ç‡ï¼ˆFWERï¼‰æˆ–è™šå‡å‘ç°ç‡ï¼ˆFDRï¼‰ï¼Œè€Œä¸æ˜¯è™šå‡æ­£ç‡ã€‚è¿™äº›æ–¹æ³•éƒ½ä»¥åŸå§‹æœªè°ƒæ•´çš„ p å€¼é›†åˆä½œä¸ºè¾“å…¥ï¼Œäº§ç”Ÿä¸€ç»„æ–°çš„â€œè°ƒæ•´å p å€¼â€ä½œä¸ºè¾“å‡ºã€‚è¿™äº›â€œè°ƒæ•´å p å€¼â€ä»£è¡¨äº† *FWER* å’Œ *FDR* çš„ *ä¸Šç•Œ* ä¼°è®¡å€¼ã€‚å®ƒä»¬å¯ä»¥é€šè¿‡ `multipletests()` å‡½æ•°è·å¾—ï¼Œè¯¥å‡½æ•°æ˜¯ `statsmodels` Python åº“çš„ä¸€éƒ¨åˆ†ï¼š

```py
def adjust_pvalues(p_values, method):
   return multipletests(p_values, method = method)[1]
```

# å®¶åº­-wise é”™è¯¯ç‡

å®¶åº­-wise é”™è¯¯ç‡æ˜¯é”™è¯¯æ‹’ç»ä¸€ä¸ªæˆ–å¤šä¸ªé›¶å‡è®¾çš„æ¦‚ç‡ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯å°†çœŸå®çš„é›¶å‡è®¾æ ‡è®°ä¸ºéé›¶å‡è®¾çš„æ¦‚ç‡ï¼Œæˆ–çœ‹åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªè™šå‡æ­£ä¾‹çš„æ¦‚ç‡ã€‚

å½“ä»…æµ‹è¯•ä¸€ä¸ªå‡è®¾æ—¶ï¼Œè¿™ç­‰äºåŸå§‹ p å€¼ï¼ˆè™šå‡æ­£ç‡ï¼‰ã€‚ç„¶è€Œï¼Œæµ‹è¯•çš„å‡è®¾è¶Šå¤šï¼Œæˆ‘ä»¬è·å¾—ä¸€ä¸ªæˆ–å¤šä¸ªè™šå‡æ­£ä¾‹çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚ä¼°è®¡ FWER æœ‰ä¸¤ç§æµè¡Œçš„æ–¹æ³•ï¼šåšå°¼è´¹ç½—å°¼å’Œéœå°”å§†ç¨‹åºã€‚è™½ç„¶åšå°¼è´¹ç½—å°¼å’Œéœå°”å§†ç¨‹åºéƒ½æ²¡æœ‰å¯¹æµ‹è¯•åœ¨å•ä¸ªç‰¹å¾ä¸Šè¿è¡Œçš„ä¾èµ–æ€§åšå‡ºä»»ä½•å‡è®¾ï¼Œä½†å®ƒä»¬ä¼šè¿‡äºä¿å®ˆã€‚ä¾‹å¦‚ï¼Œåœ¨æ‰€æœ‰ç‰¹å¾å®Œå…¨ç›¸åŒï¼ˆç›¸åŒçš„æ¨¡å‹é‡å¤äº† 10,000 æ¬¡ï¼‰çš„æç«¯æƒ…å†µä¸‹ï¼Œä¸éœ€è¦æ ¡æ­£ã€‚è€Œåœ¨å…¶ä»–æç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰ç‰¹å¾ç›¸å…³ï¼Œåˆ™éœ€è¦æŸç§ç±»å‹çš„æ ¡æ­£ã€‚

## åšå°¼è´¹ç½—å°¼ç¨‹åº

ä¿®æ­£å¤šé‡å‡è®¾æ£€éªŒçš„æœ€æµè¡Œæ–¹æ³•ä¹‹ä¸€æ˜¯åšå°¼è´¹ç½—å°¼ç¨‹åºã€‚ä¹‹æ‰€ä»¥è¿™ç§æ–¹æ³•æµè¡Œï¼Œæ˜¯å› ä¸ºå®ƒéå¸¸å®¹æ˜“è®¡ç®—ï¼Œå³ä½¿æ˜¯æ‰‹åŠ¨è®¡ç®—ä¹Ÿå¾ˆç®€å•ã€‚è¯¥ç¨‹åºå°†æ¯ä¸ª p å€¼ä¹˜ä»¥æ‰€è¿›è¡Œçš„æµ‹è¯•æ€»æ•°ï¼Œæˆ–è€…å¦‚æœè¿™ç§ä¹˜æ³•ä¼šä½¿ p å€¼è¶…è¿‡ 1ï¼Œåˆ™å°†å…¶è®¾ç½®ä¸º 1ã€‚

```py
df['p_value_bonf'] = adjust_pvalues(df['p_value'], 'bonferroni')
df.sort_values('p_value_bonf')
```

![](img/55e0101586bf95c693bd99efb4c1e5c1.png)

## éœå°”å§†ç¨‹åº

éœå°”å§†çš„ç¨‹åºæä¾›äº†ä¸€ç§æ¯”åšå°¼è´¹ç½—å°¼ç¨‹åºæ›´å¼ºå¤§çš„æ ¡æ­£æ–¹æ³•ã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼Œp å€¼å¹¶ä¸æ˜¯å…¨éƒ¨ä¹˜ä»¥æµ‹è¯•æ€»æ•°ï¼ˆè¿™é‡Œæ˜¯ 10000ï¼‰ã€‚è€Œæ˜¯ï¼Œæ¯ä¸ªæ’åºåçš„ p å€¼ä¾æ¬¡ä¹˜ä»¥é€’å‡åºåˆ— 10000ã€9999ã€9998ã€9997ã€â€¦â€¦ã€3ã€2ã€1ã€‚

```py
df['p_value_holm'] = adjust_pvalues(df['p_value'], 'holm')
df.sort_values('p_value_holm').head(10)
```

![](img/19df8cf11b5389281f44407675a2cfe9.png)

æˆ‘ä»¬å¯ä»¥è‡ªå·±éªŒè¯è¿™ä¸€ç‚¹ï¼šè¾“å‡ºä¸­çš„ç¬¬åä¸ª p å€¼è¢«ä¹˜ä»¥ 9991ï¼š7.943832e-06 * 9991 = 0.079367ã€‚éœå°”å§†çš„æ ¡æ­£ä¹Ÿæ˜¯ R è¯­è¨€ä¸­ `p.adjust()` å‡½æ•°è°ƒæ•´ p å€¼çš„é»˜è®¤æ–¹æ³•ã€‚

å¦‚æœæˆ‘ä»¬å†æ¬¡åº”ç”¨ p å€¼é˜ˆå€¼ 0.05ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›è°ƒæ•´åçš„ p å€¼å¦‚ä½•å½±å“æˆ‘ä»¬çš„é¢„æµ‹ï¼š

```py
df['is_p_value_holm_significant'] = df['p_value_holm'] <= 0.05
df.groupby(['hypothesis', 'is_p_value_holm_significant']).size()
```

```py
hypothesis  is_p_value_holm_significant
non-null    False                            92
            True                              8
null        False                          9900
dtype: int64
```

è¿™äº›ç»“æœä¸æˆ‘ä»¬å°†ç›¸åŒé˜ˆå€¼åº”ç”¨äºåŸå§‹ p å€¼æ—¶å¤§ç›¸å¾„åº­ï¼ç°åœ¨ï¼Œåªæœ‰ 8 ä¸ªç‰¹å¾è¢«æ ‡è®°ä¸ºâ€œæ˜¾è‘—â€ï¼Œè€Œè¿™ 8 ä¸ªç‰¹å¾éƒ½æ˜¯æ­£ç¡®çš„â€”â€”å®ƒä»¬æ¥è‡ªäºæˆ‘ä»¬çš„éé›¶åˆ†å¸ƒã€‚è¿™æ˜¯å› ä¸ºå³ä½¿æœ‰ä¸€ä¸ªç‰¹å¾è¢«é”™è¯¯æ ‡è®°çš„æ¦‚ç‡ä¹Ÿåªæœ‰ 0.05ï¼ˆ5%ï¼‰ã€‚

ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šå®ƒæœªèƒ½å°†å…¶ä»– 92 ä¸ªéé›¶ç‰¹å¾æ ‡è®°ä¸ºæ˜¾è‘—ã€‚å°½ç®¡å®ƒéå¸¸ä¸¥æ ¼ï¼Œä»¥ç¡®ä¿æ²¡æœ‰é›¶ç‰¹å¾è¢«æ¼å…¥ï¼Œä½†å®ƒåªèƒ½æ‰¾åˆ° 8%ï¼ˆ100 ä¸ªä¸­çš„ 8 ä¸ªï¼‰éé›¶ç‰¹å¾ã€‚è¿™å¯ä»¥è¢«è§†ä¸ºæ¯”è™šå‡æ­£ä¾‹ç‡æ–¹æ³•é‡‡å–äº†ä¸åŒçš„æç«¯ã€‚

æ˜¯å¦æœ‰ä¸€ç§æ›´ä¸­é—´çš„æ–¹æ¡ˆï¼Ÿç­”æ¡ˆæ˜¯â€œæœ‰â€ï¼Œè¿™ç§ä¸­é—´æ–¹æ¡ˆå°±æ˜¯è™šå‡å‘ç°ç‡ã€‚

# è™šå‡å‘ç°ç‡

å¦‚æœæˆ‘ä»¬å¯ä»¥æ¥å—ä¸€äº›è™šå‡æ­£ä¾‹ï¼Œä½†å¸Œæœ›æ•è·æ›´å¤šçš„çœŸæ­£æ­£ä¾‹ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸ªä½æ•°çš„ç™¾åˆ†æ¯”å‘¢ï¼Ÿä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥æ¥å—*ä¸€äº›*è™šå‡æ­£ä¾‹ï¼Œåªè¦è¿™äº›è™šå‡æ­£ä¾‹ä¸ä¼šæ·¹æ²¡æˆ‘ä»¬æ ‡è®°ä¸ºæ˜¾è‘—çš„æ‰€æœ‰ç‰¹å¾â€”â€”å°±åƒåœ¨ FPR ç¤ºä¾‹ä¸­é‚£æ ·ã€‚

è¿™å¯ä»¥é€šè¿‡åœ¨æŒ‡å®šçš„é˜ˆå€¼æ°´å¹³ï¼ˆä¾‹å¦‚ 0.05ï¼‰ä¸‹æ§åˆ¶è™šå‡å‘ç°ç‡ï¼ˆè€Œä¸æ˜¯ FWER æˆ– FPRï¼‰æ¥å®Œæˆã€‚è™šå‡å‘ç°ç‡å®šä¹‰ä¸ºæ‰€æœ‰è¢«æ ‡è®°ä¸ºæ­£é¢çš„ç‰¹å¾ä¸­è™šå‡æ­£ä¾‹çš„æ¯”ä¾‹ï¼šFDR = FP / (FP + TP)ï¼Œå…¶ä¸­ FP æ˜¯è™šå‡æ­£ä¾‹çš„æ•°é‡ï¼ŒTP æ˜¯çœŸæ­£æ­£ä¾‹çš„æ•°é‡ã€‚é€šè¿‡å°† FDR é˜ˆå€¼è®¾ç½®ä¸º 0.05ï¼Œæˆ‘ä»¬è¡¨ç¤ºæˆ‘ä»¬æ¥å—åœ¨æ‰€æœ‰è¢«æ ‡è®°ä¸ºæ­£é¢çš„ç‰¹å¾ä¸­æœ‰ 5%ï¼ˆå¹³å‡ï¼‰è™šå‡æ­£ä¾‹ã€‚

æ§åˆ¶ FDR æœ‰å‡ ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°†åœ¨è¿™é‡Œæè¿°å¦‚ä½•ä½¿ç”¨ä¸¤ç§æµè¡Œçš„æ–¹æ³•ï¼šBenjamini-Hochberg å’Œ Benjamini-Yekutieli ç¨‹åºã€‚è¿™ä¸¤ç§ç¨‹åºè™½ç„¶æ¯” FWER ç¨‹åºæ›´å¤æ‚ï¼Œä½†ä»ç„¶ç±»ä¼¼ã€‚å®ƒä»¬ä»ç„¶ä¾èµ–äºå¯¹ p å€¼è¿›è¡Œæ’åºã€ä¹˜ä»¥ä¸€ä¸ªç‰¹å®šçš„æ•°å­—ï¼Œç„¶åä½¿ç”¨æˆªæ–­æ ‡å‡†ã€‚

## Benjamini-Hochberg ç¨‹åº

Benjamini-Hochberg (BH) ç¨‹åºå‡è®¾æ¯ä¸ªæµ‹è¯•éƒ½æ˜¯*ç‹¬ç«‹çš„*ã€‚ä¾èµ–çš„æµ‹è¯•ä¼šå‘ç”Ÿï¼Œä¾‹å¦‚ï¼Œå½“è¢«æµ‹è¯•çš„ç‰¹å¾ä¹‹é—´å­˜åœ¨ç›¸å…³æ€§æ—¶ã€‚è®©æˆ‘ä»¬è®¡ç®— BH è°ƒæ•´åçš„ p å€¼ï¼Œå¹¶å°†å…¶ä¸æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨ Holm æ ¡æ­£çš„ FWER ç»“æœè¿›è¡Œæ¯”è¾ƒï¼š

```py
df['p_value_bh'] = adjust_pvalues(df['p_value'], 'fdr_bh')
df[['hypothesis', 'feature', 'x', 'p_value', 'p_value_holm', 'p_value_bh']] \
    .sort_values('p_value_bh') \
    .head(10)
```

![](img/e13078444fc6c5d26695e9dfb9f3aa33.png)

```py
df['is_p_value_holm_significant'] = df['p_value_holm'] <= 0.05
df.groupby(['hypothesis', 'is_p_value_holm_significant']).size()
```

```py
hypothesis  is_p_value_holm_significant
non-null    False                            92
            True                              8
null        False                          9900
dtype: int64
```

```py
df['is_p_value_bh_significant'] = df['p_value_bh'] <= 0.05
df.groupby(['hypothesis', 'is_p_value_bh_significant']).size()
```

```py
hypothesis  is_p_value_bh_significant
non-null    False                          67
            True                           33
null        False                        9898
            True                            2
dtype: int64
```

BH ç¨‹åºç°åœ¨æ­£ç¡®åœ°å°† 100 ä¸ªéé›¶ç‰¹å¾ä¸­çš„ 33 ä¸ªæ ‡è®°ä¸ºæ˜¾è‘—â€”â€”ç›¸æ¯”äº Holm æ ¡æ­£çš„ 8 ä¸ªï¼Œè¿™æ˜¯ä¸€ç§æ”¹è¿›ã€‚ç„¶è€Œï¼Œå®ƒä¹Ÿå°† 2 ä¸ªé›¶ç‰¹å¾æ ‡è®°ä¸ºæ˜¾è‘—ã€‚å› æ­¤ï¼Œåœ¨ 35 ä¸ªæ ‡è®°ä¸ºæ˜¾è‘—çš„ç‰¹å¾ä¸­ï¼Œä¸æ­£ç¡®ç‰¹å¾çš„æ¯”ä¾‹æ˜¯ï¼š2 / 33 = 0.06ï¼Œå³ 6%ã€‚

è¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ FDR ç‡ä¸º 6%ï¼Œå°½ç®¡æˆ‘ä»¬æ—¨åœ¨å°†å…¶æ§åˆ¶åœ¨ 5%ã€‚FDR å°†ä»¥ 5% çš„é€Ÿç‡*å¹³å‡*æ§åˆ¶ï¼šæœ‰æ—¶å®ƒå¯èƒ½æ›´ä½ï¼Œæœ‰æ—¶å¯èƒ½æ›´é«˜ã€‚

## Benjamini-Yekutieli ç¨‹åº

Benjamini-Yekutieli (BY) ç¨‹åºåœ¨æµ‹è¯•æ˜¯å¦ç‹¬ç«‹çš„æƒ…å†µä¸‹éƒ½èƒ½æ§åˆ¶ FDRã€‚å†æ¬¡å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ‰€æœ‰è¿™äº›ç¨‹åºéƒ½è¯•å›¾å»ºç«‹ FDRï¼ˆæˆ– FWERï¼‰çš„*ä¸Šé™*ï¼Œå› æ­¤å®ƒä»¬å¯èƒ½æ›´ä¿å®ˆæˆ–æ›´å®½æ¾ã€‚è®©æˆ‘ä»¬å°† BY ç¨‹åºä¸ä¸Šè¿° BH å’Œ Holm ç¨‹åºè¿›è¡Œæ¯”è¾ƒï¼š

```py
df['p_value_by'] = adjust_pvalues(df['p_value'], 'fdr_by')
df[['hypothesis', 'feature', 'x', 'p_value', 'p_value_holm', 'p_value_bh', 'p_value_by']] \
    .sort_values('p_value_by') \
    .head(10)
```

![](img/5009f6b28842380845296c6dd2c3cdea.png)

```py
df['is_p_value_by_significant'] = df['p_value_by'] <= 0.05
df.groupby(['hypothesis', 'is_p_value_by_significant']).size()
```

```py
hypothesis  is_p_value_by_significant
non-null    False                          93
            True                            7
null        False                        9900
dtype: int64
```

BY ç¨‹åºåœ¨æ§åˆ¶ FDR æ–¹é¢æ›´ä¸¥æ ¼ï¼›åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”šè‡³æ¯”ç”¨äºæ§åˆ¶ FWER çš„ Holm æ–¹æ³•æ›´ä¸¥æ ¼ï¼Œä»…æ ‡è®°äº† 7 ä¸ªéç©ºç‰¹å¾ä¸ºæ˜¾è‘—ï¼ä½¿ç”¨å®ƒçš„ä¸»è¦ä¼˜åŠ¿æ˜¯å½“æˆ‘ä»¬çŸ¥é“æ•°æ®å¯èƒ½åŒ…å«å¤§é‡ç›¸å…³ç‰¹å¾æ—¶ã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜å¸Œæœ›è€ƒè™‘è¿‡æ»¤ç›¸å…³ç‰¹å¾ï¼Œä»¥ä¾¿ä¸éœ€è¦æµ‹è¯•æ‰€æœ‰è¿™äº›ç‰¹å¾ã€‚

# æ€»ç»“

æœ€åï¼Œç¨‹åºçš„é€‰æ‹©ç•™ç»™ç”¨æˆ·ï¼Œå–å†³äºåˆ†æè¯•å›¾åšä»€ä¹ˆã€‚å¼•ç”¨æœ¬é›…æ˜ã€éœå¥‡ä¼¯æ ¼ï¼ˆRoyal Stat. Soc. 1995ï¼‰ï¼š

> é€šå¸¸ä¸å¤ªéœ€è¦æ§åˆ¶ FWERã€‚åœ¨å¤šä¸ªå•ç‹¬æ¨æ–­çš„ç»“è®ºå¯èƒ½å‡ºé”™æ—¶ï¼Œæ§åˆ¶ FWER æ˜¯é‡è¦çš„ã€‚
> 
> ä¾‹å¦‚ï¼Œåœ¨å‡ ç§æ–°æ²»ç–—æ–¹æ³•ä¸æ ‡å‡†è¿›è¡Œç«äº‰æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œå¹¶ä¸”ä»è¢«å£°æ˜æ˜¾è‘—ä¼˜äºæ ‡å‡†çš„æ²»ç–—æ–¹æ³•é›†åˆä¸­é€‰æ‹©å•ä¸€æ²»ç–—æ–¹æ³•ã€‚

åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬å¯ä»¥æ¥å—ä¸€äº›å‡é˜³æ€§æ—¶ï¼ŒFDR æ–¹æ³•å¦‚ BH æ ¡æ­£æä¾›äº†ä¸é‚£ä¹ˆä¸¥æ ¼çš„ p å€¼è°ƒæ•´ï¼Œå¹¶ä¸”å¦‚æœæˆ‘ä»¬ä¸»è¦æƒ³å¢åŠ é€šè¿‡æŸä¸ª p å€¼é˜ˆå€¼çš„çœŸé˜³æ€§æ•°é‡ï¼Œåˆ™å¯èƒ½æ›´å¯å–ã€‚

è¿˜æœ‰å…¶ä»–æœªåœ¨æ­¤æåŠçš„è°ƒæ•´æ–¹æ³•ï¼Œå°¤å…¶æ˜¯ä¸€ä¸ª[q-value](https://en.wikipedia.org/wiki/Q-value_(statistics))ï¼Œä¹Ÿç”¨äº FDR æ§åˆ¶ï¼Œåœ¨æ’°å†™æ—¶ä»…å­˜åœ¨ä½œä¸º R åŒ…ã€‚
