# ç†è§£ç¾¤ä½“é¡ºåºæµ‹è¯•

> åŸæ–‡ï¼š[`towardsdatascience.com/understanding-group-sequential-testing-befb35cec07a`](https://towardsdatascience.com/understanding-group-sequential-testing-befb35cec07a)

## [å› æœæ•°æ®ç§‘å­¦](https://towardsdatascience.com/tagged/causal-data-science)

## *å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„å®éªŒï¼ŒåŒ…æ‹¬çª¥è§†å’Œæå‰åœæ­¢ã€‚*

[](https://medium.com/@matteo.courthoud?source=post_page-----befb35cec07a--------------------------------)![Matteo Courthoud](https://medium.com/@matteo.courthoud?source=post_page-----befb35cec07a--------------------------------)[](https://towardsdatascience.com/?source=post_page-----befb35cec07a--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----befb35cec07a--------------------------------) [Matteo Courthoud](https://medium.com/@matteo.courthoud?source=post_page-----befb35cec07a--------------------------------)

Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----befb35cec07a--------------------------------) Â·15 åˆ†é’Ÿé˜…è¯»Â·2023 å¹´ 12 æœˆ 26 æ—¥

--

![](img/36e109332a0572fb79582557617c167a.png)

å°é¢ï¼Œå›¾ç‰‡ç”±ä½œè€…æä¾›

A/B æµ‹è¯•æ˜¯å› æœæ¨æ–­çš„é»„é‡‘æ ‡å‡†ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æˆ‘ä»¬åœ¨æœ€å°å‡è®¾ä¸‹åšå‡ºæœ‰æ•ˆçš„å› æœé™ˆè¿°ï¼Œè¿™è¦å½’åŠŸäº**éšæœºåŒ–**ã€‚å®é™…ä¸Šï¼Œé€šè¿‡éšæœºåˆ†é…**å¤„ç†**ï¼ˆè¯ç‰©ã€å¹¿å‘Šã€äº§å“ç­‰ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒ**ç»“æœ**ï¼ˆç–¾ç—…ã€å…¬å¸æ”¶å…¥ã€å®¢æˆ·æ»¡æ„åº¦ç­‰ï¼‰åœ¨**å—è¯•è€…**ï¼ˆæ‚£è€…ã€ç”¨æˆ·ã€å®¢æˆ·ç­‰ï¼‰ä¹‹é—´çš„å·®å¼‚ï¼Œå¹¶å°†ç»“æœçš„å¹³å‡å·®å¼‚å½’å› äºå¤„ç†çš„å› æœæ•ˆåº”ã€‚

å®æ–½ A/B æµ‹è¯•é€šå¸¸ä¸æ˜¯ç¬é—´å®Œæˆçš„ï¼Œå°¤å…¶æ˜¯åœ¨åœ¨çº¿ç¯å¢ƒä¸­ã€‚ç”¨æˆ·é€šå¸¸æ˜¯**å®æ—¶**æˆ–**åˆ†æ‰¹**å¤„ç†çš„ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨æ•°æ®æ”¶é›†å®Œæˆä¹‹å‰å¤šæ¬¡æŸ¥çœ‹æ•°æ®ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¸º**çª¥è§†**ã€‚è™½ç„¶çª¥è§†æœ¬èº«å¹¶ä¸æˆé—®é¢˜ï¼Œä½†åœ¨çª¥è§†æ—¶ä½¿ç”¨æ ‡å‡†æµ‹è¯•ç¨‹åºå¯èƒ½ä¼šå¯¼è‡´**è¯¯å¯¼æ€§ç»“è®º**ã€‚

è§£å†³**çª¥è§†**é—®é¢˜çš„æ–¹æ³•æ˜¯ç›¸åº”åœ°è°ƒæ•´æµ‹è¯•ç¨‹åºã€‚æœ€è‘—åå’Œä¼ ç»Ÿçš„æ–¹æ³•æ˜¯æ‰€è°“çš„**åºåˆ—æ¦‚ç‡æ¯”æ£€éªŒ (SPRT)**ï¼Œè¯¥æ–¹æ³•å¯ä»¥è¿½æº¯åˆ°ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºè¿™ä¸ªæµ‹è¯•åŠå…¶è¿·äººçš„å†å²ï¼Œæˆ‘å†™äº†ä¸€ç¯‡åšå®¢æ–‡ç« ã€‚

[](/experiments-peeking-and-optimal-stopping-954506cec665?source=post_page-----befb35cec07a--------------------------------) ## å®éªŒã€çª¥è§†ä¸æœ€ä¼˜åœæ­¢

### ç¼–è¾‘æè¿°

towardsdatascience.com

é¡ºåºæ¦‚ç‡æ¯”æ£€éªŒï¼ˆSPRTï¼‰çš„ä¸»è¦**ä¼˜ç‚¹**æ˜¯å®ƒåœ¨ç»™å®šç›®æ ‡ç½®ä¿¡æ°´å¹³å’ŒåŠŸæ•ˆçš„æƒ…å†µä¸‹ï¼Œä¿è¯äº†æœ€å°çš„æ ·æœ¬é‡ã€‚ç„¶è€Œï¼ŒSPRT çš„**ä¸»è¦é—®é¢˜**æ˜¯å®ƒå¯èƒ½ä¼šæ— é™æœŸåœ°ç»§ç»­ã€‚è¿™åœ¨æœ‰æˆªæ­¢æ—¥æœŸå’Œé¢„ç®—é™åˆ¶çš„åº”ç”¨ç¯å¢ƒä¸­æ˜¯ä¸€ä¸ªéæ— å…³çš„é—®é¢˜ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢ä¸€ç§**æ›¿ä»£æ–¹æ³•**ï¼Œå…è®¸åœ¨æ•°æ®æ”¶é›†çš„*ä»»ä½•*ç‚¹è¿›è¡Œ*ä»»ä½•*æ•°é‡çš„ä¸­é—´çª¥æ¢ï¼š**åˆ†ç»„é¡ºåºæµ‹è¯•**ã€‚

# æ¨¡æ‹Ÿ

è®©æˆ‘ä»¬ä»ä¸€äº›æ¨¡æ‹Ÿçš„**æ•°æ®**å¼€å§‹ã€‚ä¸ºäº†ä¿æŒä»£ç å°½å¯èƒ½ç®€æ´ï¼Œæˆ‘å°†æŠ½è±¡åŒ–å®éªŒè®¾ç½®ï¼Œç›´æ¥å¤„ç†æ¥è‡ª**æ­£æ€åˆ†å¸ƒ**çš„æ•°æ®ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºæ ‡å‡† A/B æµ‹è¯•ä¸­å¹³å‡æ²»ç–—æ•ˆæœçš„åˆ†å¸ƒã€‚æ­£æ€åˆ†å¸ƒæ˜¯åŸºäº[ä¸­å¿ƒæé™å®šç†](https://en.wikipedia.org/wiki/Central_limit_theorem)çš„æ¸è¿‘è¿‘ä¼¼ã€‚

åœ¨ç”Ÿæˆæ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»[src.theme](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/theme.py)å¯¼å…¥ç›¸å…³åº“å’Œæˆ‘çš„ç»˜å›¾ä¸»é¢˜ã€‚

```py
from src.theme import *
import numpy as np
import pandas as pd
import scipy as sp
```

å‡è®¾çœŸå®çš„æ•°æ®ç”Ÿæˆè¿‡ç¨‹ç¡®å®æ˜¯ä¸€ä¸ªæ­£æ€åˆ†å¸ƒï¼Œ**å‡å€¼**ä¸º*Î¼=1*ï¼Œ**æ ‡å‡†å·®**ä¸º*Ïƒ=5.644*ã€‚åœ¨ A/B æµ‹è¯•çš„èƒŒæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªæ­£çš„å¹³å‡æ²»ç–—æ•ˆæœï¼Œæ ‡å‡†å·®æ¯”æ•ˆæœå¤§ 5 å€ä»¥ä¸Šã€‚

```py
mu = 1
sigma = 5.644
```

æˆ‘ä»¬å¸Œæœ›å»ºç«‹ä¸€ä¸ªåŒä¾§æ£€éªŒï¼Œå…·æœ‰*95%*çš„ç½®ä¿¡åº¦å’Œ*80%*çš„åŠŸæ•ˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å‡é˜³æ€§é”™è¯¯ç‡å°†æ˜¯*Î±=0.05*ï¼Œç›®æ ‡å‡é˜´æ€§é”™è¯¯ç‡å°†æ˜¯*Î²=0.2*ã€‚

```py
alpha = 0.05
beta = 0.2
```

æˆ‘ä»¬ç°åœ¨å¯ä»¥è®¡ç®—å®éªŒæ‰€éœ€çš„æ ·æœ¬é‡ï¼Œå‡è®¾å¹³å‡æ²»ç–—æ•ˆæœä¸º*1*ï¼Œæ ‡å‡†å·®ä¸º*5.664*ã€‚ç”±äºæˆ‘ä»¬å·²ç»æŠ½è±¡åŒ–äº†ä¸¤ä¸ªç»„çš„æ¯”è¾ƒï¼ŒåŠŸæ•ˆè®¡ç®—çš„å…¬å¼æ˜¯

![](img/9a84ad104e8ee6429d4a21bbef05c74f.png)

åŠŸæ•ˆè®¡ç®—å…¬å¼ï¼Œå›¾ç‰‡æ¥æºäºä½œè€…

å…¶ä¸­*zs*æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„åˆ†ä½æ•°ï¼Œè®¡ç®—åœ¨*1-Î±/2*å’Œ*1-Î²*å¤„ã€‚

```py
ppf = sp.stats.norm(0, 1).ppf
cdf = sp.stats.norm(0, 1).cdf
z_alpha = ppf(1 - alpha/2)
z_beta = ppf(1 - beta)
N = int((2 * sigma * (z_alpha + z_beta) / mu)**2)
print(f"Number of obserations needed: {N}")
```

```py
Number of obserations needed: 1000
```

æˆ‘ä»¬éœ€è¦*N=1000*ä¸ªè§‚å¯Ÿå€¼æ¥è¾¾åˆ°ç›®æ ‡ç½®ä¿¡æ°´å¹³*95%*å’ŒåŠŸæ•ˆ*80%*ã€‚

æˆ‘ä»¬ç°åœ¨å¯ä»¥ç»˜åˆ¶æ¨¡æ‹Ÿæ•°æ®ã€‚ç”±äºæˆ‘ä»¬å°†ç»å¸¸æ¯”è¾ƒä¸åŒæ¨¡æ‹Ÿç»“æœï¼Œæˆ‘ä»¬ç»˜åˆ¶*K=10,000*ä¸ª*N=1,000*æ•°æ®ç‚¹çš„åºåˆ—ã€‚

```py
K = 10_000
np.random.seed(2)
obs = np.random.normal(mu, sigma, size=(N, K))
```

æˆ‘ä»¬ç°åœ¨å‡†å¤‡è°ƒæŸ¥çª¥æ¢å’Œåˆ†ç»„é¡ºåºæµ‹è¯•ã€‚

# çª¥æ¢

å¦‚æœæˆ‘ä»¬åœ¨å®éªŒ**ç»“æŸå‰**å¯¹æ•°æ®è¿›è¡Œ**çª¥æ¢**ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

å‡è®¾ä¾‹å¦‚æˆ‘ä»¬æ¯*50*ä¸ªè§‚å¯Ÿå€¼æŸ¥çœ‹ä¸€æ¬¡æ•°æ®ï¼Œä»*100*å¼€å§‹ã€‚ä¸€ä¸ªåŸå› å¯èƒ½æ˜¯æ•°æ®ä»¥æ‰¹æ¬¡åˆ°è¾¾ï¼Œæˆ–è€…æˆ‘ä»¬æ¯å¤©ä¸€å¼€å§‹å·¥ä½œæ—¶å°±è¿›è¡Œçª¥æ¢ã€‚

```py
N_peek = np.arange(100, N+1, 50, dtype=int)
N_peek
```

```py
array([ 100,  150,  200,  250,  300,  350,  400,  450,  500,  550,  600,  650,  700,  750,  800,  850,  900,  950, 1000])
```

è§‚å¯Ÿæ•°æ®æœ¬èº«å½“ç„¶ä¸æ˜¯é—®é¢˜*per-se*ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¢«è¯±ä½¿**å¾—å‡ºç»“è®º**ï¼ŒåŸºäºæˆ‘ä»¬è§‚å¯Ÿåˆ°çš„å†…å®¹ã€‚å‡è®¾æˆ‘ä»¬çš„*å¹¼ç¨š*å®éªŒå¹³å°æŒç»­æŠ¥å‘Šæœ€æ–°çš„å¹³å‡å€¼ã€æ ‡å‡†å·®å’Œç½®ä¿¡åŒºé—´ï¼Œå…¶ä¸­ç½®ä¿¡åŒºé—´è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š

![](img/4ecf095cfadb01e71cd486fc17c6546b.png)

åœ¨ä¸çª¥è§†çš„æƒ…å†µä¸‹çš„ç½®ä¿¡åŒºé—´ï¼Œå›¾ç‰‡ç”±ä½œè€…æä¾›

å…¶ä¸­ *n* æ˜¯æ ·æœ¬æ•°é‡ï¼Œ*Î¼Ì‚â‚™* æ˜¯ç»è¿‡ *n* ä¸ªæ ·æœ¬åçš„ä¼°è®¡æ ·æœ¬å‡å€¼ï¼Œ*ÏƒÌ‚â‚™* æ˜¯ç»è¿‡ *n* ä¸ªæ ·æœ¬åçš„ä¼°è®¡æ ‡å‡†å·®ï¼Œ*Î±* æ˜¯æ˜¾è‘—æ€§æ°´å¹³ï¼Œ*z* æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ *1-Î±/2* åˆ†ä½æ•°ã€‚

```py
def select_alpha_naive(n, N, N_peek, alpha):
    return alpha
```

å‡è®¾æˆ‘ä»¬å†³å®š**åœ¨è·å¾—ä¸€ä¸ªæ˜¾è‘—ç»“æœååœæ­¢å®éªŒ**ã€‚

è®©æˆ‘ä»¬è®¡ç®—åœ¨æ¯ä¸ªçª¥è§†ç‚¹ä¸Šè§‚å¯Ÿåˆ°çš„ç½®ä¿¡åŒºé—´ã€‚

```py
def compute_intervals(select_alpha, obs, N_peek, alpha=0.05, **kwargs):
    # Compute rolling mean and standard deviation
    N, K = np.shape(obs)
    ns = np.reshape(np.arange(1, N+1), (-1, 1))
    means = np.cumsum(obs, axis=0) / ns
    stdevs = np.sqrt(np.cumsum((obs - means)**2, axis=0) / ns)

    # Compute intervals at each peeking time
    df_intervals = pd.DataFrame({"k": range(K)})
    df_intervals["rejected_0"] = False
    df_intervals["rejected_1"] = False
    df_intervals["length"] = max(N_peek)
    for t, n in enumerate(N_peek):
        df_intervals[f"mean{n}"] = means[n-1, :]
        df_intervals[f"width{n}"] = ppf(1 - select_alpha(n, N, N_peek, alpha, **kwargs)/2) * stdevs[n-1, :] / np.sqrt(n)
        df_intervals[f"lowerb{n}"] = means[n-1, :] - df_intervals[f"width{n}"]
        df_intervals[f"upperb{n}"] = means[n-1, :] + df_intervals[f"width{n}"]
        df_intervals[f"coverage{n}"] = (df_intervals[f"lowerb{n}"] <= mu) & (df_intervals[f"upperb{n}"] >= mu)
        df_intervals["rejected_0"] = df_intervals["rejected_0"] | (df_intervals[f"lowerb{n}"] >= 0) | (df_intervals[f"upperb{n}"] <= 0)
        df_intervals[f"power{n}"] = df_intervals["rejected_0"]
        df_intervals["rejected_1"] = df_intervals["rejected_1"] | ~df_intervals[f"coverage{n}"]
        df_intervals[f"falsep{n}"] = df_intervals["rejected_1"]
        df_intervals["length"] = np.minimum(df_intervals["length"], n) * df_intervals["rejected_0"] + max(N_peek) * (1 - df_intervals["rejected_0"])
    return df_intervals
```

```py
dfi_naive = compute_intervals(select_alpha_naive, obs, N_peek)
```

è¿™äº›å¹³å‡å€¼å’Œç½®ä¿¡åŒºé—´éšæ—¶é—´çš„å˜åŒ–æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿåœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ç»˜åˆ¶äº†æ•°æ®æ”¶é›†çš„ç´¯ç§¯å¹³å‡å€¼ï¼Œä»¥åŠæ¯æ¬¡çª¥è§†æ—¶çš„ç½®ä¿¡åŒºé—´ã€‚

```py
plot_peeking(dfi_naive, obs)
```

![](img/a28e268c352f63b885af3d674c44a5eb.png)

ç´¯ç§¯å¹³å‡æ•ˆåº”å’Œçª¥è§†ç½®ä¿¡åŒºé—´ï¼Œå›¾ç‰‡ç”±ä½œè€…æä¾›

å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå‰ä¸ƒæ¬¡è§‚å¯Ÿæ•°æ®æ—¶ï¼Œç½®ä¿¡åŒºé—´ç©¿è¿‡é›¶çº¿ï¼Œå› æ­¤æˆ‘ä»¬æœªèƒ½æ‹’ç»é›¶å‡å€¼çš„é›¶å‡è®¾ã€‚æˆ‘ç”¨æ©™è‰²æ ‡å‡ºäº†è¿™äº›ç½®ä¿¡åŒºé—´ã€‚ç„¶è€Œï¼Œåœ¨ç¬¬å…«æ¬¡è§‚å¯Ÿæ•°æ®æ—¶ï¼Œå³*450*æ¬¡è§‚å¯Ÿï¼Œç½®ä¿¡åŒºé—´æ²¡æœ‰ç©¿è¿‡é›¶çº¿ï¼Œå› æ­¤æˆ‘ä»¬**æ‹’ç»é›¶å‡è®¾**ï¼Œç»“æŸå®éªŒã€‚

è¿™ä¸ªè¿‡ç¨‹çš„é—®é¢˜ä¸**å¤šé‡å‡è®¾æ£€éªŒ**éå¸¸ç›¸ä¼¼ï¼šæˆ‘ä»¬ä¸ºå•æ¬¡æ•°æ®è§‚å¯Ÿæ„å»ºç½®ä¿¡åŒºé—´ï¼Œå› æ­¤åšå‡º*å•ä¸ª*å†³å®šï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬åšå‡ºäº†*å¤šä¸ª*å†³å®šã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬å·²ç»*å†³å®š*åœ¨è¾¾åˆ° *450* æ¬¡è§‚å¯Ÿä¹‹å‰ä¸ƒæ¬¡ä¸åœæ­¢å®éªŒï¼Œè€Œåœ¨ *450* æ¬¡è§‚å¯Ÿæ—¶åœæ­¢äº†å®éªŒã€‚

çª¥è§†å’Œæ—©æœŸåœæ­¢çš„**åæœ**æ˜¯ä»€ä¹ˆï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœæˆ‘ä»¬é‡å¤è¿™ä¸ªå®éªŒå¤šæ¬¡ä¼šå‘ç”Ÿä»€ä¹ˆã€‚æˆ‘ä»¬ç°åœ¨å°†ç»˜åˆ¶*100*ä¸ªä¸åŒæ¨¡æ‹Ÿåœ¨ä¸‰ä¸ªä¸åŒæ—¶é—´ç‚¹çš„ç½®ä¿¡åŒºé—´ï¼šåœ¨*200*ã€*400* å’Œ *600* æ¬¡è§‚å¯Ÿåã€‚è¯·æ³¨æ„ï¼Œè¿™äº›åˆ†åˆ«å¯¹åº”äºç¬¬*3*æ¬¡ã€ç¬¬*7*æ¬¡å’Œç¬¬*11*æ¬¡æ•°æ®çª¥è§†ã€‚

```py
N_plot = [200, 400, 600]
```

æˆ‘ä»¬é¦–å…ˆè¦æ£€æŸ¥çš„æ˜¯**è¦†ç›–ç‡**ï¼šç½®ä¿¡åŒºé—´æ˜¯å¦çœŸçš„*è¦†ç›–*äº†çœŸå®çš„å¤„ç†æ•ˆåº”ï¼Œæ­£å¦‚å®ƒä»¬æ‰€åº”è¯¥çš„é‚£æ ·ï¼Ÿæˆ‘æ ‡å‡ºäº†é‚£äº›æ²¡æœ‰è¦†ç›–çš„ç½®ä¿¡åŒºé—´ã€‚

```py
plot_intervals(dfi_naive, N_plot, "coverage")
```

![](img/96e0f2fe7643f67710163ef7b347a4b4.png)

ä½¿ç”¨å¹¼ç¨šæµ‹è¯•çš„ 100 æ¬¡æ¨¡æ‹Ÿçš„è¦†ç›–æƒ…å†µï¼Œå›¾ç‰‡ç”±ä½œè€…æä¾›

çœ‹èµ·æ¥æˆ‘ä»¬çš„è¦†ç›–ç‡åœ¨æ¯ä¸ªæ—¶é—´ç‚¹éƒ½æ˜¯æ­£å¸¸çš„ã€‚æˆ‘ä»¬åˆ†åˆ«åœ¨*100*æ¬¡æ¨¡æ‹Ÿä¸­æœ‰*2*ã€*6*å’Œ*2*æ¬¡ä¸è¦†ç›–çœŸå®æ²»ç–—æ•ˆåº”ï¼ˆ*Î¼=1*ï¼‰ã€‚è¿™æ˜¯å¯ä»¥é¢„æœŸçš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç½®ä¿¡æ°´å¹³æ˜¯*5%*ï¼Œå› æ­¤æˆ‘ä»¬æœŸæœ›*100*ä¸ªåŒºé—´ä¸­*å¹³å‡*æœ‰*5*ä¸ªä¸è¦†ç›–çœŸå®æ²»ç–—æ•ˆåº”ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç ”ç©¶**åŠŸæ•ˆ**ï¼šæˆ‘ä»¬ä¼°è®¡é‡åœ¨ç¡®å®å­˜åœ¨æ•ˆåº”æ—¶æ£€æµ‹æ•ˆåº”çš„èƒ½åŠ›ã€‚è®°ä½ï¼ŒåŠŸæ•ˆæ€»æ˜¯*ç›¸å¯¹äº*æ•ˆåº”å¤§å°çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬åœ¨è¿›è¡ŒåŠŸæ•ˆè®¡ç®—æ—¶ä½¿ç”¨äº†çœŸå®æ•ˆåº”ï¼Œå› æ­¤æˆ‘ä»¬æœŸæœ›å®éªŒè¾¾åˆ°*80%*çš„é¢„æœŸåŠŸæ•ˆã€‚

è¯·æ³¨æ„ï¼Œç”±äºæˆ‘ä»¬è¿›è¡Œè§‚å¯Ÿï¼Œæˆ‘ä»¬ä¼šåœ¨*æµ‹è¯•*æ˜¾è‘—æ—¶æ‹’ç»åŸå‡è®¾å¹¶åœæ­¢å®éªŒã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬æ¡ˆä¾‹ä¸­ï¼Œç‰¹å®šæ—¶é—´ç‚¹çš„åŠŸæ•ˆæ˜¯æ‹’ç»åŸå‡è®¾çš„æ¦‚ç‡ï¼Œæ— è®ºæ˜¯è¯¥æµ‹è¯•è¿˜æ˜¯*ä»»ä½•*ä¹‹å‰çš„æµ‹è¯•ã€‚

```py
plot_intervals(dfi_naive, N_plot, "power")
```

![](img/3436e43ad2b5d1db8e8e92498f3a112b.png)

ä½¿ç”¨æœ´ç´ æµ‹è¯•çš„ 100 æ¬¡æ¨¡æ‹Ÿä¸­çš„åŠŸæ•ˆï¼Œå›¾åƒç”±ä½œè€…æä¾›

å¦‚æˆ‘ä»¬æ‰€è§ï¼Œåœ¨*200*æ¬¡è§‚å¯Ÿæ—¶ï¼Œæˆ‘ä»¬å·²ç»åœ¨*100*æ¬¡æ¨¡æ‹Ÿä¸­çš„*72*æ¬¡æ‹’ç»äº†æ²¡æœ‰æ•ˆåº”çš„åŸå‡è®¾ï¼ˆ*Î¼=0*ï¼‰ï¼Œæ¥è¿‘ç›®æ ‡åŠŸæ•ˆçš„*80%*ã€‚ç„¶è€Œï¼Œåœ¨*400*æ¬¡è§‚å¯Ÿæ—¶ï¼Œæˆ‘ä»¬åœ¨è¶…è¿‡*100*æ¬¡æ¨¡æ‹Ÿä¸­çš„*80*æ¬¡æ‹’ç»äº†åŸå‡è®¾ï¼Œè¡¨æ˜æˆ‘ä»¬å¯ä»¥ç¼©çŸ­å®éªŒæ—¶é—´ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡ä¼¼ä¹éƒ½å¾ˆé¡ºåˆ©ï¼šæˆ‘ä»¬çš„åŒºé—´è¦†ç›–äº†çœŸå®æ•ˆåº”ï¼Œå¹¶ä¸”æ¯”é¢„æœŸæ›´å¿«åœ°æ‹’ç»äº†åŸå‡è®¾ã€‚è®©æˆ‘ä»¬æ£€æŸ¥æ‰€æœ‰çš„è§‚å¯Ÿé˜¶æ®µå’Œ*10,000*æ¬¡æ¨¡æ‹Ÿã€‚æˆ‘ä»¬è¿˜è¦æ£€æŸ¥ç¬¬ä¸‰ä¸ªæŒ‡æ ‡ï¼š**å‡é˜³æ€§**é”™è¯¯ç‡ã€‚ä¸ºäº†è®¡ç®—è¿™ä¸ªï¼Œæˆ‘ä»¬å°†åŸå‡è®¾æ›´æ”¹ä¸º*Î¼=1*å¹¶æ£€æŸ¥æˆ‘ä»¬æ‹’ç»å®ƒçš„é¢‘ç‡ã€‚åŒæ ·ï¼Œç”±äºæˆ‘ä»¬è¿›è¡Œäº†å¤šæ¬¡è§‚å¯Ÿï¼Œé‡è¦çš„æ˜¯ç‰¹å®šè§‚å¯Ÿé˜¶æ®µæˆ–*ä»»ä½•*ä¹‹å‰çš„é˜¶æ®µçš„æ‹’ç»ç‡ã€‚

åœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ç»˜åˆ¶äº†æ¯ä¸ªè§‚å¯Ÿé˜¶æ®µ*10,000*æ¬¡æ¨¡æ‹Ÿä¸­çš„è¦†ç›–ç‡ã€åŠŸæ•ˆå’Œé”™è¯¯æ‹’ç»ç‡ã€‚

```py
plot_coverage_power(dfi_naive)
```

![](img/5a3d2ad3f6003a6f7f33751348ab0762.png)

ä½¿ç”¨æœ´ç´ æµ‹è¯•çš„*10,000*æ¬¡æ¨¡æ‹Ÿä¸­çš„ä¼°è®¡å™¨æ€§èƒ½ï¼Œå›¾åƒç”±ä½œè€…æä¾›

è¦†ç›–ç‡ä¼¼ä¹ç¬¦åˆé¢„æœŸã€‚åŠŸæ•ˆåœ¨å¤§çº¦*250*æ¬¡è§‚å¯Ÿåå·²è¾¾åˆ°*80%*ä»¥ä¸Šï¼Œç¡®è®¤äº†æˆ‘ä»¬ä¹‹å‰çš„è§è§£ã€‚ç„¶è€Œï¼Œé”™è¯¯æ‹’ç»ç‡è¿œé«˜äºç›®æ ‡çš„*5%*ã€‚è¿™æ„å‘³ç€å½“åŸå‡è®¾ä¸ºçœŸæ—¶ï¼Œæˆ‘ä»¬çš„æ‹’ç»é¢‘ç‡é«˜äºåº”æœ‰çš„æ°´å¹³ã€‚

æˆ‘ä»¬æœ€åè¦æ£€æŸ¥çš„æ˜¯å®éªŒæ˜¯å¦ç¡®å®åœ¨å¹³å‡ä¸Šæ›´çŸ­ï¼Œä»¥åŠçŸ­äº†å¤šå°‘ã€‚è®©æˆ‘ä»¬è®¡ç®—**å¹³å‡å®éªŒé•¿åº¦**ï¼Œä»¥è§‚å¯Ÿæ¬¡æ•°ä¸ºå•ä½ã€‚

```py
print(f"Average length: n = {dfi_naive.length.mean():.0f}", )
```

```py
Average length: n = 177
```

å¹³å‡è€Œè¨€ï¼Œæˆ‘ä»¬åªéœ€*177*æ¬¡è§‚å¯Ÿå³å¯å¾—å‡ºç»“è®ºï¼ç„¶è€Œï¼Œç”±äºè¾ƒé«˜çš„é”™è¯¯æ‹’ç»ç‡ï¼Œè¿™äº›å¯èƒ½æ˜¯**é”™è¯¯çš„ç»“è®º**ã€‚

æˆ‘ä»¬å¯ä»¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿæˆ‘ä»¬éœ€è¦æ„å»ºè€ƒè™‘åˆ°æˆ‘ä»¬åœ¨é¡ºåºä¸­è¿›è¡Œå¤šæ¬¡æµ‹è¯•çš„ç½®ä¿¡åŒºé—´ã€‚

# Alpha ä¿®æ­£

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ç¬¬ä¸€ç»„æ ¡æ­£ï¼Œè¿™äº›æ ¡æ­£ä¼šä¿®æ”¹ç”¨äºè®¡ç®—ç½®ä¿¡åŒºé—´çš„*Î±*å€¼ï¼Œä»¥è€ƒè™‘çª¥è§†å’Œæå‰åœæ­¢ã€‚

## Bonferroni æ ¡æ­£

ç”±äºçª¥è§†é—®é¢˜ç±»ä¼¼äºå¤šé‡å‡è®¾æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥ä»åº”ç”¨ç›¸åŒçš„è§£å†³æ–¹æ¡ˆå¼€å§‹ã€‚

å¤„ç†å¤šé‡å‡è®¾æµ‹è¯•çš„æœ€ç®€å•æ–¹æ³•æ˜¯æ‰€è°“çš„ [**Bonferroni æ ¡æ­£**](https://en.wikipedia.org/wiki/Bonferroni_correction)ã€‚è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ï¼šæ ¹æ®è§‚å¯Ÿæ¬¡æ•°æŒ‰æ¯”ä¾‹å‡å°‘æ˜¾è‘—æ€§æ°´å¹³*Î±*ã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬ä¸å†å¯¹æ¯æ¬¡è§‚å¯Ÿä½¿ç”¨ç›¸åŒçš„*Î±*ï¼Œè€Œæ˜¯ä½¿ç”¨

![](img/c287adce0da3778a73fcef6023831aa4.png)

Bonferroni çš„Î±æ ¡æ­£ï¼Œä½œè€…æä¾›çš„å›¾åƒ

å…¶ä¸­ *P* æ˜¯æˆ‘ä»¬è®¡åˆ’çª¥è§†çš„æ¬¡æ•°ã€‚

```py
def select_alpha_bonferroni(n, N, N_peek, alpha):
    P = len(N_peek)
    return alpha / P
```

Bonferroni æ ¡æ­£åœ¨**è¦†ç›–ç‡**æ–¹é¢è¡¨ç°å¦‚ä½•ï¼Ÿè®©æˆ‘ä»¬ç»˜åˆ¶ä¸‰ä¸ªçª¥è§†é˜¶æ®µçš„ç½®ä¿¡åŒºé—´ï¼šåœ¨æ”¶é›†äº†*200*ã€*400* å’Œ *600* æ¬¡è§‚å¯Ÿåã€‚

```py
dfi_bonferroni = compute_intervals(select_alpha_bonferroni, obs, N_peek)
plot_intervals(dfi_bonferroni, N_plot, "coverage")
```

![](img/30c8a1a50d6d9dd53a843462b2c0ac5b.png)

Bonferroni æ ¡æ­£ä¸‹çš„è¦†ç›–ç‡åœ¨ 100 æ¬¡æ¨¡æ‹Ÿä¸­ï¼Œä½œè€…æä¾›çš„å›¾åƒ

è¦†ç›–ç‡çœ‹èµ·æ¥å¾ˆæ£’ï¼åªæœ‰ä¸€æ¬¡åœ¨*n=200*æ—¶ä¸€ä¸ªåŒºé—´æ²¡æœ‰è¦†ç›–çœŸå®å€¼*Î¼=1*ã€‚

è™½ç„¶è¿™åœ¨ä¸€å¼€å§‹å¯èƒ½è®©äººæ„Ÿåˆ°å®‰æ…°ï¼Œä½†å®é™…ä¸Šåº”è¯¥å¼•èµ·è­¦è§‰ã€‚äº‹å®ä¸Šï¼Œä½¿ç”¨æ˜¾è‘—æ€§æ°´å¹³*Î±=0.05*æ—¶ï¼Œæˆ‘ä»¬æœŸæœ›çš„è¦†ç›–ç‡æ˜¯*95%*ã€‚æ›´é«˜çš„è¦†ç›–ç‡å¾ˆå¯èƒ½ä¼šä»¥**åŠŸæ•ˆ**ä¸ºä»£ä»·ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ã€‚

```py
plot_intervals(dfi_bonferroni, N_plot, "power")
```

![](img/c042febc1465b9db49bb60fe3cdd6dcc.png)

Bonferroni æ ¡æ­£ä¸‹çš„åŠŸæ•ˆåœ¨ 100 æ¬¡æ¨¡æ‹Ÿä¸­ï¼Œä½œè€…æä¾›çš„å›¾åƒ

åœ¨*200*æ¬¡è§‚å¯Ÿä¸‹æµ‹è¯•åŠŸæ•ˆä¸è¶³ï¼Œè€Œåœ¨*400*æ¬¡è§‚å¯Ÿä¸‹åŠŸæ•ˆéå¸¸æ¥è¿‘ç›®æ ‡çš„*80%*ã€‚åœ¨*600*æ¬¡è§‚å¯Ÿæ—¶ï¼Œæˆ‘ä»¬å‡ ä¹è¾¾åˆ°äº† 100% çš„åŠŸæ•ˆã€‚

è®©æˆ‘ä»¬ç»˜åˆ¶æ¯ä¸ªçª¥è§†é˜¶æ®µçš„è¦†ç›–ç‡ã€åŠŸæ•ˆå’Œå‡é˜³æ€§ç‡ï¼ŒåŸºäº*K=10,000*æ¬¡æ¨¡æ‹Ÿã€‚

```py
plot_coverage_power(dfi_bonferroni)
```

![](img/3a3bd13d292271b633125f5490d495a1.png)

Bonferroni æ ¡æ­£åœ¨ 10,000 æ¬¡æ¨¡æ‹Ÿä¸­çš„ä¼°è®¡æ€§èƒ½ï¼Œä½œè€…æä¾›çš„å›¾åƒ

è¦†ç›–ç‡å¾ˆå¥½ï¼ŒåŠŸæ•ˆåœ¨å¤§çº¦*450*æ¬¡è§‚å¯Ÿåè¾¾åˆ°ç›®æ ‡ï¼Œè™šå‡æ‹’ç»ç‡å§‹ç»ˆä½äº*5%*çš„ç›®æ ‡ã€‚é‚£ä¹ˆå¹³å‡å®éªŒé•¿åº¦å‘¢ï¼Ÿ

```py
print(f"Average length: n = {dfi_bonferroni.length.mean():.0f}", )
```

```py
Average length: n = 317
```

å¹³å‡å®éªŒé•¿åº¦ä¸º*317*æ¬¡è§‚å¯Ÿï¼Œé«˜äºæœ´ç´ æµ‹è¯•ç¨‹åºï¼Œä½†ä»æ˜æ˜¾ä½äºæœªç»çª¥è§†æ‰€éœ€çš„*1000*æ¬¡è§‚å¯Ÿã€‚

ä¸€åˆ‡çœ‹èµ·æ¥éƒ½ä¸é”™ï¼Œç”šè‡³å¯èƒ½**è¿‡äºå®Œç¾**ã€‚ç¡®å®ï¼Œå¯èƒ½è¿˜æœ‰æ”¹è¿›çš„ç©ºé—´ã€‚è€ƒè™‘åˆ°å¦‚æ­¤é«˜çš„è¦†ç›–ç‡å’Œä½çš„è™šå‡æ‹’ç»ç‡ï¼Œç»“æœè¡¨æ˜æˆ‘ä»¬å¯ä»¥ç¼©çŸ­ç½®ä¿¡åŒºé—´ï¼Œä»è€Œæé«˜åŠŸæ•ˆå’Œé™ä½å®éªŒé•¿åº¦ï¼ŒåŒæ—¶ä¸ä½äº*95%*çš„è¦†ç›–ç‡æˆ–è¶…è¿‡*5%*çš„è™šå‡æ‹’ç»ç‡ã€‚å¦‚ä½•ï¼Ÿ

Bonferroni æ ¡æ­£æœ‰**ä¸¤ä¸ªç¼ºç‚¹**ã€‚é¦–å…ˆï¼Œå®ƒ**ä¸æ˜¯ä¸ºåºåˆ—æµ‹è¯•è®¾è®¡**çš„ï¼Œè€Œæ˜¯ä¸ºå¤šé‡å‡è®¾æµ‹è¯•è®¾è®¡çš„ã€‚å…¶æ¬¡ï¼Œå³ä½¿æ˜¯å¤šé‡å‡è®¾æµ‹è¯•ï¼Œå®ƒä¹Ÿè¢«è®¤ä¸ºæ˜¯éå¸¸**ä¿å®ˆ**çš„ã€‚

## æ ¡æ­£

**Bonferroni çš„åºè´¯æ£€éªŒæ ¡æ­£**çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯[Pocock (1977)](https://www.jstor.org/stable/2335684)ã€‚å…¶æ€æƒ³æ˜¯è€ƒè™‘æ£€éªŒçš„**åºè´¯**ç‰¹æ€§ï¼Œè¿™ä¼šåœ¨æ£€éªŒç»Ÿè®¡é‡ä¹‹é—´ç”Ÿæˆéå¸¸ç‰¹å®šçš„ç›¸å…³ç»“æ„ã€‚ç”±äºè¿™ä¸€æ´å¯Ÿï¼ŒPocock èƒ½å¤Ÿä½¿ç”¨ä¸€ä¸ªæ ¡æ­£çš„*Î±*å€¼ï¼Œè¯¥å€¼ä»‹äºå¤©çœŸçš„*Î±*å’Œ Bonferroni çš„*Î±/P*ä¹‹é—´ã€‚æ¯” Bonferroni æ›´å¤§çš„*Î±*æ„å‘³ç€æ›´é«˜çš„åŠŸæ•ˆï¼ŒåŒæ—¶ä¿æŒé«˜è¦†ç›–ç‡å’Œä½å‡é˜³æ€§ç‡ã€‚è¿™äº›å€¼æ˜¯é€šè¿‡ä¸€ä¸ªæ•°å€¼ç®—æ³•å¾—å‡ºçš„ï¼Œè¯¥ç®—æ³•ä»¥æ˜¾è‘—æ€§æ°´å¹³*Î±*å’Œæ€»çª¥æ¢æ¬¡æ•°*P*ä½œä¸ºè¾“å…¥ã€‚

Pocock æ ¡æ­£çš„é—®é¢˜åœ¨äºå®ƒæœªèƒ½å……åˆ†åˆ©ç”¨æ£€éªŒçš„åºè´¯ç‰¹æ€§ï¼Œå› ä¸ºç½®ä¿¡åŒºé—´éšæ—¶é—´ä¿æŒä¸å˜ã€‚[Oâ€™Brien å’Œ Fleming (1979)](https://www.jstor.org/stable/2530245) æå‡ºäº†ä½¿ç”¨**æ—¶é—´å˜åŒ–**çš„*Î±*æ ¡æ­£ã€‚ä»–ä»¬çš„æƒ³æ³•æ˜¯ä½¿ç½®ä¿¡åŒºé—´çš„å®½åº¦ä¸ä»…é€‚åº”æ˜¾è‘—æ€§æ°´å¹³*Î±*å’Œæ€»çª¥æ¢æ¬¡æ•°*P*ï¼Œè¿˜é€‚åº”æ¯æ¬¡çª¥æ¢*p*ã€‚

ç„¶è€Œï¼Œè¿™äº›ç¨‹åºçš„ä¸»è¦ç¼ºç‚¹æ˜¯å®ƒä»¬è¦æ±‚**æå‰è§„åˆ’**çª¥æ¢æ¬¡æ•°ã€‚è¿™é€šå¸¸æ˜¯*ä¸åˆ‡å®é™…çš„*ï¼Œå› ä¸ºçª¥æ¢æ˜¯ä¸€ä¸ªå›ºæœ‰çš„è‡ªå‘è¿‡ç¨‹ï¼Œæ¥æºäºæ•°æ®æ‰¹é‡çš„å¤§å°ã€ç®¡ç†å±‚çš„å‹åŠ›æˆ–å®éªŒè€…çš„å¥½å¥‡å¿ƒã€‚

å½“çª¥æ¢**æœªæå‰è§„åˆ’**æ—¶ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿ

# **ç»„åºè´¯æ£€éªŒ**

[Lan å’Œ DeMets (1983)](https://www.jstor.org/stable/2336502)æ³¨æ„åˆ°ï¼Œçª¥æ¢ä¸­é‡è¦çš„ä¸æ˜¯*ä½ çª¥æ¢äº†å¤šå°‘*ï¼Œè€Œæ˜¯*ä½ ä½•æ—¶çª¥æ¢*ã€‚**ç»„åºè´¯æ£€éªŒï¼ˆGSTï¼‰**çš„ä¸»è¦æ€æƒ³æ˜¯å…è®¸åœ¨ä»»ä½•æ—¶é—´ç‚¹è¿›è¡Œçª¥æ¢ï¼Œå¹¶åœ¨æ•°æ®æ”¶é›†è¿‡ç¨‹ä¸­å¯¹çª¥æ¢æ—¶é—´ç‚¹çš„æ˜¾è‘—æ€§æ°´å¹³è¿›è¡Œæ ¡æ­£ï¼Œ*t = n/N*ã€‚

ç»„åºè´¯æ£€éªŒçš„åŠ¨æ€éƒ¨åˆ†æ˜¯æ‰€è°“çš„**Î±èŠ±è´¹å‡½æ•°**ï¼Œå®ƒå†³å®šäº†å¦‚ä½•æ ¹æ®çª¥æ¢æ—¶é—´*t*æ¥æ ¡æ­£æ˜¾è‘—æ€§æ°´å¹³*Î±*ã€‚åœ¨æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†å›é¡¾ä¸¤ä¸ªÎ±èŠ±è´¹å‡½æ•°ï¼Œåˆ†åˆ«è¿‘ä¼¼äº[Pocock (1977)](https://www.jstor.org/stable/2335684)å’Œ[Oâ€™Brien å’Œ Fleming (1979)](https://www.jstor.org/stable/2530245)çš„æ ¡æ­£ã€‚

## GST Pocock è¿‘ä¼¼

ç¬¬ä¸€ä¸ªÎ±èŠ±è´¹å‡½æ•°æ˜¯[Pocock (1977)](https://www.jstor.org/stable/2335684)çš„è¿‘ä¼¼ï¼Œå…¶è¡¨è¾¾å¼ä¸º

![](img/46ac994f14048165af6ab5bd9c36da45.png)

Pocock çš„Î±èŠ±è´¹å‡½æ•°ç”¨äºç»„åºè´¯æ£€éªŒï¼Œå›¾ç‰‡æ¥æºäºä½œè€…

è¯·æ³¨æ„ï¼Œå½“è§‚å¯Ÿæ¯”ä¾‹*t=n/N*è¾¾åˆ°æ•´ä¸ªæ ·æœ¬(*t=1*)æ—¶ï¼ŒPocock çš„æ ¡æ­£ä¼šæ”¶æ•›åˆ°åŸå§‹æ˜¾è‘—æ€§æ°´å¹³*Î±*ã€‚

```py
def select_alpha_gst_pocock(n, N, N_peek, alpha):
    t = n / N
    return alpha * np.log(1 + (np.exp(1) - 1) * t)
```

è®©æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨ Pocock çš„Î±èŠ±è´¹å‡½æ•°çš„ç»„åºè´¯æ£€éªŒå¦‚ä½•å·¥ä½œã€‚

```py
dfi_gst_pocock = compute_intervals(select_alpha_gst_pocock, obs, N_peek)
plot_coverage_power(dfi_gst_pocock)
```

![](img/d411728a393bad4f796aa3e21f137177.png)

ä½¿ç”¨ Pocock çš„ GST è¿›è¡Œ 10,000 æ¬¡æ¨¡æ‹Ÿçš„ä¼°è®¡å™¨æ€§èƒ½ï¼Œå›¾ç‰‡æ¥æºäºä½œè€…

æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œè¦†ç›–ç‡è¶‹å‘äºç›®æ ‡è¦†ç›–ç‡ï¼Œè§‚å¯Ÿæ¬¡æ•°å¢åŠ ã€‚å®éªŒä¼¼ä¹ä¹Ÿæ¯”ä½¿ç”¨ Bonferroni æ ¡æ­£çš„åŠŸæ•ˆæ›´å¼ºï¼Œä½†å¦‚æœå®éªŒè¿è¡Œæ—¶é—´è¿‡é•¿ï¼Œè™šå‡æ‹’ç»ç‡ä¼šè¶…è¿‡*5%*çš„ç›®æ ‡ã€‚

å¹³å‡å®éªŒé•¿åº¦æ€ä¹ˆæ ·ï¼Ÿ

```py
print(f"Average length: n = {dfi_gst_pocock.length.mean():.0f}", )
```

```py
Average length: n = 229
```

å¹³å‡å®éªŒé•¿åº¦ç¡®å®ä½äº Boferroniï¼Œå¹³å‡ä¸º*229*æ¬¡è§‚å¯Ÿï¼Œè€Œä¸æ˜¯*317*æ¬¡ã€‚

## GST Oâ€™Brien & Fleming è¿‘ä¼¼

ç¬¬äºŒä¸ªÎ±æ”¯å‡ºå‡½æ•°æ˜¯[Oâ€™Brien, Fleming (1979)](https://www.jstor.org/stable/2530245)çš„è¿‘ä¼¼ï¼Œå…¶è¡¨è¾¾å¼ä¸º

![](img/150e368ddfcf6a29dde4676960f56b68.png)

Oâ€™Brien å’Œ Fleming çš„ç»„åºè´¯æµ‹è¯•Î±æ”¯å‡ºå‡½æ•°ï¼Œå›¾åƒç”±ä½œè€…æä¾›

å…¶ä¸­**Î¦**æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆCDFï¼‰ï¼Œè€Œ*Ï*æ˜¯ä¸€ä¸ªè‡ªç”±å‚æ•°ï¼Œé€šå¸¸é»˜è®¤ä¸º*Ï=1*ã€‚

```py
def select_alpha_gst_obrien_fleming(n, N, N_peek, alpha, rho=1):
    t = n / N
    return 4 - 4 * cdf(ppf(1 - alpha/4) / t**(rho/2))
```

è®©æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨ Oâ€™Brien å’Œ Fleming è¿‘ä¼¼çš„ç»„åºè´¯æµ‹è¯•åœ¨*K=10,000*æ¬¡æ¨¡æ‹Ÿä¸­çš„è¡¨ç°ã€‚

```py
dfi_gst_obrien_fleming = compute_intervals(select_alpha_gst_obrien_fleming, obs, N_peek)
plot_coverage_power(dfi_gst_obrien_fleming)
```

![](img/ac4f34809cc78583f2b0044b6946f1c0.png)

ä½¿ç”¨ Oâ€™Brien å’Œ Fleming çš„ GST åœ¨ 10,000 æ¬¡æ¨¡æ‹Ÿä¸­çš„ä¼°è®¡æ€§èƒ½ï¼Œå›¾åƒç”±ä½œè€…æä¾›

çœ‹èµ·æ¥ Oâ€™Brien å’Œ Fleming çš„è¿‘ä¼¼æ¯” Pocock çš„æ›´ä¿å®ˆï¼Œå…·æœ‰æ›´é«˜çš„è¦†ç›–ç‡å’Œè¾ƒä½çš„åŠŸæ•ˆï¼Œä½†è™šå‡æ‹’ç»ç‡æ›´æ¥è¿‘*5%*ç›®æ ‡ã€‚

```py
print(f"Average length: n = {dfi_gst_obrien_fleming.length.mean():.0f}", )
```

```py
Average length: n = 414
```

å¹³å‡å®éªŒé•¿åº¦å®é™…ä¸Šé«˜äº Boferroniï¼Œå¹³å‡ä¸º*414*æ¬¡è§‚å¯Ÿï¼Œè€Œä¸æ˜¯*317*æ¬¡ã€‚ç„¶è€Œï¼Œé€šè¿‡åœ¨æ ¡æ­£å…¬å¼ä¸­é™ä½å‚æ•°*Ï*ï¼Œå¯ä»¥å‡å°‘è¿™ä¸€æ•°å€¼ã€‚ä»¥*Ï=0.5*ä¸ºä¾‹ï¼Œå®ƒå¯¹åº”äº[Wang, Tsiatis (1987)](https://www.jstor.org/stable/2531959)çš„æ ¡æ­£ã€‚

```py
dfi_gst_obrien_fleming_05 = compute_intervals(select_alpha_gst_obrien_fleming, obs, N_peek, rho=0.5)
print(f"Average length: n = {dfi_gst_obrien_fleming_05.length.mean():.0f}", )
```

```py
Average length: n = 303
```

ç¡®å®ï¼Œä½¿ç”¨è¾ƒä½çš„*Ï*ï¼Œæˆ‘ä»¬å·²å°†å¹³å‡å®éªŒé•¿åº¦ä»*414*å‡å°‘åˆ°*303*æ¬¡è§‚å¯Ÿã€‚

## Î±æ”¯å‡ºæƒè¡¡

åœ¨æ€»ç»“ä¹‹å‰ï¼Œå€¼å¾—çœ‹çœ‹çª¥è§†çš„æƒè¡¡ã€‚æˆ‘ä»¬å¼•å…¥äº†ä¸€ç§æ–¹æ³•ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä»»ä½•æ—¶å€™è¿›è¡Œæœ‰æ•ˆæ¨æ–­ã€‚ç„¶è€Œï¼Œ**æˆ‘ä»¬åº”è¯¥çª¥è§†å—**ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œ**çª¥è§†å¤šå°‘æ¬¡**å‘¢ï¼Ÿ

åœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ç»˜åˆ¶äº†ä½¿ç”¨ Pocock è¿‘ä¼¼çš„ç»„åºè´¯æµ‹è¯•çš„æµ‹è¯•æ€§èƒ½ï¼Œå½“æˆ‘ä»¬**å¢åŠ çª¥è§†é¢‘ç‡**ä»*50*æ¬¡è§‚å¯Ÿåˆ°*10*æ¬¡è§‚å¯Ÿæ—¶ã€‚

```py
N_peek_10 = np.arange(30, N+1, 10, dtype=int)
dfi_gst_10 = compute_intervals(select_alpha_gst_pocock, obs, N_peek_10)
plot_coverage_power(dfi_gst_10)
```

![](img/03f9db324688a150d7ff42419f683a56.png)

æ¯ 10 æ¬¡è§‚å¯Ÿä¸‹çš„ GST ä¼°è®¡æ€§èƒ½ï¼Œå›¾åƒç”±ä½œè€…æä¾›

å¦‚æˆ‘ä»¬æ‰€è§ï¼Œè¦†ç›–ç‡åŸºæœ¬ä¸å—å½±å“ï¼Œè€ŒåŠŸæ•ˆå’Œè™šå‡æ‹’ç»ç‡æœ‰æ‰€å¢åŠ ã€‚å¹³å‡å®éªŒé•¿åº¦ä¹Ÿä»*229*å‡å°‘åˆ°*188*æ¬¡è§‚å¯Ÿã€‚

```py
print(f"Average length: n = {dfi_gst_10.length.mean():.0f}", )
```

```py
Average length: n = 188
```

å¦‚æœæˆ‘ä»¬**å‡å°‘çª¥è§†é¢‘ç‡**ä¼šæ€æ ·ï¼Ÿåœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ç»˜åˆ¶äº†æ¯ 200 æ¬¡è§‚å¯Ÿæ—¶çš„ç»“æœã€‚

```py
N_peek_200 = np.arange(200, N+1, 200, dtype=int)
dfi_gst_200 = compute_intervals(select_alpha_gst_pocock, obs, N_peek_200)
plot_coverage_power(dfi_gst_200)
```

![](img/7f7d1feeb1007f086e40eeb7e5b658fc.png)

æ¯ 200 æ¬¡è§‚å¯Ÿä¸‹çš„ GST ä¼°è®¡æ€§èƒ½ï¼Œå›¾åƒç”±ä½œè€…æä¾›

ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›¸åçš„ç»“æœï¼šåŠŸæ•ˆå’Œè™šå‡æ‹’ç»éƒ½å‡å°‘äº†ã€‚å¦ä¸€æ–¹é¢ï¼Œç°åœ¨æˆ‘ä»¬å¹³å‡éœ€è¦ *311* æ¬¡è§‚æµ‹æ‰èƒ½å¾—å‡ºç»“è®ºï¼Œè€Œä¸æ˜¯ *229* æ¬¡ã€‚

```py
print(f"Average length: n = {dfi_gst_200.length.mean():.0f}", )
```

```py
Average length: n = 311
```

# ç»“è®º

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº† **ç»„é¡ºåºæµ‹è¯•**ï¼Œä¸€ç§åœ¨ A/B æµ‹è¯•ä¸­ä»»ä½•æ¬¡æ•°å’Œä»»ä½•æ—¶åˆ»è¿›è¡Œçª¥æ¢æ—¶åšå‡ºæœ‰æ•ˆæ¨æ–­çš„ç¨‹åºã€‚æˆ‘ä»¬è¿˜çœ‹åˆ°çª¥æ¢å¹¶ä¸æ˜¯å…è´¹çš„ã€‚ä¸»è¦çš„ **æƒè¡¡** æ˜¯ï¼Œæˆ‘ä»¬çª¥æ¢çš„æ¬¡æ•°è¶Šå¤šï¼Œå®éªŒåœæ­¢å¾—è¶Šæ—©ï¼Œä½†è™šå‡æ‹’ç»ç‡ä¹Ÿè¶Šé«˜ã€‚

æ–‡ç« ä¸­è‡³å°‘è¿˜æœ‰å‡ ä¸ªæˆ‘æ²¡æœ‰æåŠçš„ä¸»é¢˜ï¼Œä»¥é¿å…è¿‡é•¿ã€‚ç¬¬ä¸€ä¸ªæ˜¯ **åå€š**ã€‚é¡ºåºæµ‹è¯•å®¹æ˜“å¼•å…¥åå€šï¼Œå› ä¸ºæå‰åœæ­¢å¯èƒ½æ˜¯ç”±äºä½æ–¹å·®æˆ–å¤§æ•ˆåº”ã€‚ç”±äºåè€…ï¼Œé¡ºåºæµ‹è¯•å¾€å¾€ä¼šå¯¼è‡´å¯¹æ²»ç–—æ•ˆæœçš„ *é«˜ä¼°*ã€‚è¿™ç§ç°è±¡é€šå¸¸ç§°ä¸º *èµ¢å®¶çš„è¯…å’’*ï¼Œé€šå¸¸å‘ç”Ÿåœ¨ç ”ç©¶çš„åŠŸæ•ˆä¸è¶³æ—¶ï¼Œå³åœ¨æ—©æœŸçª¥æ¢é˜¶æ®µã€‚ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯è®¾è®¡ä¸€ä¸ª **Î² èŠ±è´¹** å‡½æ•°ã€‚

æˆ‘æ²¡æœ‰æ¶µç›–çš„ç¬¬äºŒä¸ªä¸»é¢˜æ˜¯æ‰€è°“çš„ **å› æ— æ•ˆè€Œåœæ­¢**ã€‚åœ¨æœ¬æ–‡çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘ä»¬å¾—åˆ°ç»Ÿè®¡ä¸Šæ˜¾è‘—çš„ä¼°è®¡å€¼ï¼Œæˆ‘ä»¬å°±æå‰åœæ­¢å®éªŒã€‚ç„¶è€Œï¼Œçª¥æ¢ä¹Ÿå¯ä»¥å‘ŠçŸ¥å¦ä¸€ç§åœæ­¢è§„åˆ™ï¼šå› ä¸ºç»§ç»­æµ‹è¯•å˜å¾—æä¸å¯èƒ½äº§ç”Ÿæ˜¾è‘—ç»“æœè€Œåœæ­¢ã€‚

æˆ‘æ²¡æœ‰æ¶µç›–çš„æœ€åä¸€ä¸ªä¸»é¢˜æ˜¯å¦‚ä½•è¿›è¡Œ **åŠŸæ•ˆåˆ†æ**ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¸€å¼€å§‹å°±è¿›è¡Œäº†åŠŸæ•ˆåˆ†æï¼Œå‡è®¾æ²¡æœ‰çª¥æ¢ã€‚ç„¶è€Œï¼Œé‰´äºæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬ä¼šçª¥æ¢ï¼Œæˆ‘ä»¬æœ¬å¯ä»¥é¢„æœŸéœ€è¦ä¸€ä¸ªæ›´å°çš„æ ·æœ¬ã€‚ä¸€ä¸ªå¯†åˆ‡ç›¸å…³çš„ä¸»é¢˜æ˜¯ **æœ€ä½³çª¥æ¢**ã€‚ä¸€æ—¦å†³å®šè¦çª¥æ¢ï¼Œåº”è¯¥ä½•æ—¶è¿›è¡Œï¼Ÿ

## å‚è€ƒæ–‡çŒ®

+   Lakens, Pahlke, Wassmer (2021). [ç»„é¡ºåºè®¾è®¡ï¼šæ•™ç¨‹](https://osf.io/preprints/psyarxiv/x4azm)

+   Lan, DeMets (1983). [ä¸´åºŠè¯•éªŒçš„ç¦»æ•£é¡ºåºè¾¹ç•Œ](https://academic.oup.com/biomet/article-abstract/70/3/659/247777)

+   Spotify (2023). [é€‰æ‹©é¡ºåºæµ‹è¯•æ¡†æ¶](https://engineering.atspotify.com/2023/03/choosing-sequential-testing-framework-comparisons-and-discussions/)

## ç›¸å…³æ–‡çŒ®

+   å®éªŒã€çª¥æ¢å’Œæœ€ä½³åœæ­¢

## ä»£ç 

ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°åŸå§‹çš„ Jupyter Notebookï¼š

[](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/group_sequential_testing.ipynb?source=post_page-----befb35cec07a--------------------------------) [## Blog-Posts/notebooks/group_sequential_testing.ipynb at main Â· matteocourthoud/Blog-Posts

### æˆ‘çš„ Medium åšå®¢æ–‡ç« çš„ä»£ç å’Œç¬”è®°æœ¬ã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ªæ¥è´¡çŒ® matteocourthoud/Blog-Posts å¼€å‘â€¦

github.com](https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/group_sequential_testing.ipynb?source=post_page-----befb35cec07a--------------------------------)

## æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼

*éå¸¸æ„Ÿè°¢ï¼* ğŸ¤— *å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« å¹¶å¸Œæœ›çœ‹åˆ°æ›´å¤šå†…å®¹ï¼Œå¯ä»¥è€ƒè™‘* [***å…³æ³¨æˆ‘***](https://medium.com/@matteo.courthoud)*ã€‚æˆ‘æ¯å‘¨å‘å¸ƒä¸€æ¬¡å…³äºå› æœæ¨æ–­å’Œæ•°æ®åˆ†æçš„å†…å®¹ã€‚æˆ‘å°½é‡ä¿æŒæ–‡ç« ç®€æ´ä½†å‡†ç¡®ï¼Œå§‹ç»ˆæä¾›ä»£ç ã€ç¤ºä¾‹å’Œæ¨¡æ‹Ÿã€‚*

*æ­¤å¤–ï¼Œä¸€ä¸ªå°å°çš„* ***å…è´£å£°æ˜****ï¼šæˆ‘å†™ä½œæ˜¯ä¸ºäº†å­¦ä¹ ï¼Œå› æ­¤é”™è¯¯æ˜¯å¸¸æœ‰çš„äº‹ï¼Œå°½ç®¡æˆ‘å°½åŠ›åšåˆ°æœ€å¥½ã€‚è¯·åœ¨å‘ç°é”™è¯¯æ—¶å‘Šè¯‰æˆ‘ã€‚æˆ‘ä¹Ÿæ¬¢è¿å¯¹æ–°è¯é¢˜çš„å»ºè®®ï¼*
