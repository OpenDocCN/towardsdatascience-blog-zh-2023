# å¦‚ä½•æµ‹è¯•ä½ çš„å•å…ƒæµ‹è¯•

> åŸæ–‡ï¼š[`towardsdatascience.com/how-to-test-your-unit-tests-afe18d6e19d8`](https://towardsdatascience.com/how-to-test-your-unit-tests-afe18d6e19d8)

## [å•å…ƒæµ‹è¯•](https://medium.com/tag/unit-testing)

## çªå˜æµ‹è¯•ç®€ä»‹

[](https://dr-robert-kuebler.medium.com/?source=post_page-----afe18d6e19d8--------------------------------)![Dr. Robert KÃ¼bler](https://dr-robert-kuebler.medium.com/?source=post_page-----afe18d6e19d8--------------------------------)[](https://towardsdatascience.com/?source=post_page-----afe18d6e19d8--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----afe18d6e19d8--------------------------------) [Dr. Robert KÃ¼bler](https://dr-robert-kuebler.medium.com/?source=post_page-----afe18d6e19d8--------------------------------)

Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----afe18d6e19d8--------------------------------) Â·é˜…è¯»æ—¶é•¿ 5 åˆ†é’ŸÂ·2023 å¹´ 1 æœˆ 16 æ—¥

--

![](img/fbcb034d926169de17728b3dae68786b.png)

å›¾ç‰‡ç”± [Erik Mclean](https://unsplash.com/@introspectivedsgn?utm_source=medium&utm_medium=referral) æä¾›ï¼Œæ¥è‡ª [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

åœ¨æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è®²è¿°äº†å•å…ƒæµ‹è¯•å¦‚ä½•æˆä¸ºæ•°æ®ç§‘å­¦å®¶å·¥ä½œä¸­çš„ä¸€ä¸ªé‡è¦æ–¹é¢ï¼Œå› ä¸ºé”™è¯¯çš„ä»£ç ä¼šå¯¼è‡´åˆ†æç»“æœå‡ºç°é—®é¢˜ã€‚æé«˜å•å…ƒæµ‹è¯•çš„ä¸€ç§æ–¹æ³•æ˜¯å°†**å±æ€§é©±åŠ¨æµ‹è¯•**ä¸**ç¤ºä¾‹é©±åŠ¨æµ‹è¯•**ç»“åˆä½¿ç”¨ï¼Œå³*å¸¸è§„*çš„å•å…ƒæµ‹è¯•æ–¹å¼ã€‚ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ï¼š

[](/stop-hardcoding-your-unit-tests-e6643dfd254b?source=post_page-----afe18d6e19d8--------------------------------) ## åœæ­¢ç¡¬ç¼–ç ä½ çš„å•å…ƒæµ‹è¯•

### Python ä¸­ä½¿ç”¨ Hypothesis è¿›è¡Œå±æ€§é©±åŠ¨æµ‹è¯•çš„æŒ‡å—

towardsdatascience.com

åœ¨å‘å¸ƒè¿™ç¯‡æ–‡ç« åï¼Œæˆ‘[æ”¶åˆ°äº†](https://medium.com/@dotcom.software/mutation-testing-is-also-an-amazing-technique-to-verify-if-weve-missed-any-edge-cases-in-our-unit-e3c63cae1a06)æ¥è‡ª**.com è½¯ä»¶**çš„å›åº”ï¼Œå‘æˆ‘æ¨èäº†**çªå˜æµ‹è¯•**ï¼Œæˆ‘ä»Šå¤©æƒ³å‘ä½ è§£é‡Šä¸€ä¸‹ã€‚é•¿è¯çŸ­è¯´ï¼š

> çªå˜æµ‹è¯•å¯ä»¥å¸®åŠ©ä½ å‘ç°å¼±æµ‹è¯•ã€‚

å¼±æµ‹è¯•æ˜¯é‚£äº›ç»™ä½ é”™è¯¯å®‰å…¨æ„Ÿçš„æµ‹è¯•ï¼Œå› ä¸ºå®ƒä»¬å³ä½¿**æ˜çŸ¥é“ä¸è¯¥é€šè¿‡**ä¹Ÿä¼šé€šè¿‡ï¼Œå…¶ä¸­æœ€å…¸å‹çš„å°±æ˜¯`assert True`ã€‚æ›¿æ¢è¿™äº›æµ‹è¯•å¯ä»¥ä½¿ä½ çš„æ•´ä¸ªæµ‹è¯•å¥—ä»¶æ›´æœ‰æ„ä¹‰å’Œå¯ä¿¡ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹è¿™æ˜¯ä»€ä¹ˆå§ï¼

# å¼±æµ‹è¯•

è€ƒè™‘è¿™ä¸ªéå¸¸ç®€å•çš„å‡½æ•°ï¼š

```py
def mean(x, y):
    return (x+y) / 2
```

å‡è®¾ä½ æƒ³ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œå°½ç®¡è¿™ä¸ªå‡½æ•°éå¸¸ç®€å•ã€‚ä¸€ä¸ª*test_mean.py* æ–‡ä»¶å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š

```py
def mean(x, y):
    return (x+y) / 2

def test_mean():
    assert mean(4, 0) == 2
```

è°ƒç”¨`pytest test_mean.py`å½“ç„¶ä¼šå¯¼è‡´æµ‹è¯•é€šè¿‡ã€‚ä¸€åˆ‡éƒ½æ˜¯ç»¿è‰²çš„ï¼Œæˆ‘ä»¬ç”šè‡³è¾¾åˆ°äº† 100%çš„è¦†ç›–ç‡ï¼æ˜¯æ—¶å€™ç»§ç»­ä¸‹ä¸€ä¸ªåŠŸèƒ½äº†ï¼Œå¯¹å§ï¼Ÿ**ä¸ï¼**

è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹æµ‹è¯•ä»£ç ä¸­çš„æ–­è¨€ï¼šå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯é›¶ï¼Œè¿™æ„å‘³ç€å‡½æ•°ä¸­çš„`y`åŸºæœ¬ä¸Šè¢«å¿½ç•¥äº†ã€‚è¾“å…¥å…·æœ‰ç‰¹æ®Šçš„å½¢çŠ¶ï¼Œä½¿æµ‹è¯•æ¯”é¢„æœŸæ›´å®¹æ˜“é€šè¿‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå‡½æ•°æ˜¯

```py
def definitely_not_the_mean(x, y): 
    return (x-y) / 2 # test_mean still passes
```

å³ä½¿åœ¨è¿™ç§ç®€å•çš„**å‡½æ•°å˜å¼‚**â€”â€”å°†åŠ å·æ”¹ä¸ºå‡å·â€”â€”`test_mean`ä»ç„¶é€šè¿‡ã€‚

> **è¿™ä¸åº”è¯¥å‘ç”Ÿ**ï¼Œå¦‚æœæµ‹è¯•è¶³å¤Ÿå¥½ï¼Œå®ƒåº”è¯¥åœ¨æˆ‘ä»¬æ›´æ”¹å‡½æ•°å®šä¹‰æ—¶å¤±è´¥ï¼

åƒè¿™æ ·çš„æµ‹è¯•å°±åƒä¸€ä¸ªé‡‘å±æ¢æµ‹å™¨ï¼Œå³ä½¿é¢å¯¹æœ¨æä¹Ÿä¼šå‘å‡ºå£°éŸ³ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ç§°`test_mean`ä¸º**è–„å¼±çš„æµ‹è¯•**ã€‚

è¿™ä¸ªè–„å¼±çš„æµ‹è¯•åœ¨è¿™é‡Œå¯èƒ½å¾ˆå®¹æ˜“è¢«å‘ç°ï¼Œä½†å¦‚æœä½ å†™çš„ä»£ç ç¨å¾®å¤æ‚ä¸€äº›ï¼Œä½ å¯èƒ½ä¼šæ„å¤–åœ°åˆ›å»ºå‡ºè–„å¼±çš„ç¤ºä¾‹å´æ²¡æœ‰æ³¨æ„åˆ°ï¼Œä»è€Œç»™ä½ ä¸€ç§è™šå‡çš„å®‰å…¨æ„Ÿã€‚

# å˜å¼‚æµ‹è¯•

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨**å˜å¼‚æµ‹è¯•**æ¥å‘ç°è–„å¼±çš„æµ‹è¯•ã€‚å˜å¼‚æµ‹è¯•çš„ç†å¿µå·²ç»ç›¸å½“å¤è€ï¼šå®ƒæœ€åˆç”±ç†æŸ¥å¾·Â·åˆ©æ™®é¡¿åœ¨ 1971 å¹´ä½œä¸ºå­¦ç”Ÿæå‡ºã€‚å®ƒä¹Ÿéå¸¸ç®€å•ï¼Œå®é™…ä¸Šæˆ‘åœ¨ä¸Šä¸€ç« å·²ç»ç®€å•ä»‹ç»è¿‡äº†ã€‚

> å¯¹ä½ æƒ³è¦æµ‹è¯•çš„å‡½æ•°æºä»£ç è¿›è¡Œå°çš„ä¿®æ”¹ï¼Œå¹¶æŸ¥çœ‹æµ‹è¯•æ˜¯å¦ä»ç„¶é€šè¿‡ã€‚å¦‚æœå®ƒä»¬é€šè¿‡äº†ï¼Œé‚£å®ƒä»¬å°±æ˜¯è–„å¼±çš„ã€‚å¦‚æœå®ƒä»¬å¤±è´¥ï¼ˆå¹¶ä¸”åŸå‡½æ•°æ²¡æœ‰å¤±è´¥ï¼‰ï¼Œå®ƒä»¬å¹¸å­˜ä¸‹æ¥å¹¶å¯èƒ½æ˜¯å¼ºçš„ã€‚

ä½ å·²ç»çœ‹åˆ°äº†ä¸€ä¸ªå˜å¼‚ï¼Œå³ä» + å˜ä¸º -ã€‚æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥æ”¹å˜ï¼š

+   - æ”¹ä¸º +

+   / æ”¹ä¸º * æˆ–åä¹‹äº¦ç„¶ï¼Œ

+   â‰¥ æ”¹ä¸º > æˆ–è€… <ï¼Œ

+   â‰¤ æ”¹ä¸º < æˆ–è€… >

+   = æ”¹ä¸º != æˆ–åä¹‹äº¦ç„¶

+   ä»æ•´æ•°ä¸­åŠ å‡ 1

+   å‘å­—ç¬¦ä¸²ä¸­æ·»åŠ ä¸€äº›éšæœºå­—ç¬¦

+   â€¦

ä½ æ˜ç™½äº†å§ã€‚åªéœ€ç®€å•çš„è°ƒæ•´ï¼Œ**ä»ç„¶ç”Ÿæˆæœ‰æ•ˆçš„æºä»£ç **ï¼Œå°†ä½ æƒ³è¦æµ‹è¯•çš„åŸå‡½æ•°å˜æˆç¨å¾®ä¸åŒçš„ä¸œè¥¿ã€‚

å½“ç„¶ï¼Œä½ å¯ä»¥æ‰‹åŠ¨å®Œæˆè¿™äº›æ“ä½œï¼Œå‡ æ¬¡æ›´æ”¹æºä»£ç ï¼Œæ¯æ¬¡ä¹‹åéƒ½è¿è¡Œä¸€æ¬¡`pytest`ã€‚ä½†å› ä¸ºè¿™æ²¡æœ‰è¶£å‘³ï¼Œ[æœ‰äººåˆ›å»ºäº†ä¸€ä¸ªåŒ…æ¥è‡ªåŠ¨å®Œæˆè¿™é¡¹å·¥ä½œ](https://github.com/boxed/mutmut)å¹¶è®°å½•ç»“æœã€‚

# Mutmut æ–¹ä¾¿çš„å˜å¼‚æµ‹è¯•

[Anders HovmÃ¶ller aka boxed](https://github.com/boxed)å’Œè®¸å¤šå…¶ä»–è´¡çŒ®è€…åˆ›å»ºäº†ä¸€ä¸ªåä¸º[mutmut](https://github.com/boxed/mutmut)çš„åŒ…æ¥ä¸ºä½ å®Œæˆè¿™é¡¹å·¥ä½œã€‚

é¦–å…ˆï¼Œé€šè¿‡`pip install mutmut`å®‰è£…å®ƒã€‚ç„¶åï¼Œä½ éœ€è¦å°†ä½ æƒ³è¦æµ‹è¯•çš„å‡½æ•°æå–åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º*function.py*ã€‚æˆ‘ä»¬è¿˜å‡è®¾æµ‹è¯•åœ¨*test_mean.py*ä¸­ã€‚ç„¶åä½ å¯ä»¥è°ƒç”¨

```py
mutmut run --paths-to-mutate function.py
```

å®ƒå°†åˆ›å»ºä¸€äº›åŒ…å«æˆ‘ä»¬æƒ³è¦æµ‹è¯•çš„*mean*å‡½æ•°çš„*function.py*çš„å˜å¼‚ã€‚

> *å¦‚æœä½ åœ¨ mutmut è¿è¡Œæ—¶åœ¨ä¸€ä¸ªä¼šä¸æ–­é‡æ–°åŠ è½½æ–‡ä»¶çš„ç¼–è¾‘å™¨ä¸­æ‰“å¼€* function.py *ï¼Œä½ ç”šè‡³å¯ä»¥çœ‹åˆ°æ–‡ä»¶å¦‚ä½•å®æ—¶å˜åŒ–ï¼ä½†ä¸ç”¨æ‹…å¿ƒï¼šmutmut ä¼šåœ¨è¿›è¡Œä¿®æ”¹ä¹‹å‰å…ˆåˆ›å»ºåŸå§‹æ–‡ä»¶çš„å‰¯æœ¬ã€‚*

è¾“å‡ºå°†å¦‚ä¸‹æ‰€ç¤ºï¼š

![](img/38069b69d36188159342474601ce3ee1.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å‡ ä¸ªæ–¹é¢ï¼Œå°¤å…¶æ˜¯**åœ¨åº•éƒ¨**ï¼š

1.  åˆ›å»ºäº†ä¸‰ä¸ªçªå˜ä½“ã€‚(*æ—æ³¨ï¼š+å˜ä¸º-ï¼Œ/å˜ä¸º*ï¼Œåœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­æ˜¯ 2 å˜ä¸º 3*)

1.  è¿™ä¸‰ä¸ªçªå˜ä½“ä¸­çš„ä¸¤ä¸ªè¢«*æ€æ­»*ï¼Œæ„å‘³ç€ä¹‹å‰é€šè¿‡çš„å•å…ƒæµ‹è¯•åœ¨æ–‡ä»¶æ›´æ”¹åå¤±è´¥äº†ï¼Œè¿™å¾ˆå¥½ ğŸ‰ã€‚

1.  ä¸€ä¸ªçªå˜ä½“å¹¸å­˜äº†ï¼Œè¿™æ„å‘³ç€å°½ç®¡æºä»£ç å‘ç”Ÿäº†å˜åŒ–ï¼Œæµ‹è¯•ä»ç„¶é€šè¿‡ã€‚è¿™å¾ˆç³Ÿç³• ğŸ™ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°è¿‡è¿™ä¸ªå¹¸å­˜è€…ï¼š

```py
def mean(x, y): 
    return (x-y) / 2 # the surviving mutant
```

ä½ è¿˜å¯ä»¥é€šè¿‡ `mutmut html` åˆ›å»ºä¸€ä¸ª HTML æŠ¥å‘Šå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š

![](img/cc091067fd6dceec2c9a101112a4d40e.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

è®¾è®¡å¯ä»¥æ›´å¥½ï¼Œä½†å®ƒåŒ…å«äº†å…³äºå¹¸å­˜è€…çš„ä¸»è¦ä¿¡æ¯ã€‚

> ***æ³¨æ„ï¼š*** *æœ‰æ—¶ä¸¤ä¸ªè¾ƒå¼±çš„å•ç‹¬æµ‹è¯•å¯ä»¥å½¢æˆä¸€ä¸ªæ›´å¥½çš„æµ‹è¯•å¥—ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ·»åŠ äº†æ–­è¨€* `*assert mean(-1, 1) == 0*` *â€” å¦ä¸€ä¸ªè¾ƒå¼±çš„æµ‹è¯•ï¼Œå› ä¸ºçªå˜ä½“* `*return (x+y) * 2*` *å°†å¹¸å­˜ â€” æ€»çš„æ¥è¯´ï¼Œæ²¡æœ‰çªå˜ä½“ä¼šå¹¸å­˜äº mutmut çš„ç¨‹åºï¼Œä»è€Œæ”¹è¿›æµ‹è¯•å¥—ä»¶ã€‚*

# ç»“è®º

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°é€šè¿‡æµ‹è¯•ç”šè‡³ 100%çš„æµ‹è¯•è¦†ç›–ç‡å¯èƒ½ä¼šä»¤äººè¯¯è§£ã€‚é€šè¿‡çš„æµ‹è¯•å¾ˆå¥½ï¼Œä½†å¦‚æœå³ä½¿åœ¨æ›´æ”¹è¢«æµ‹è¯•å‡½æ•°åä»ç„¶é€šè¿‡ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªçº¢æ——ï¼Œè¡¨æ˜æµ‹è¯•å¯èƒ½è¾ƒå¼±ã€‚

çªå˜æµ‹è¯•æä¾›äº†ä¸€ç§ç»“æ„åŒ–çš„æ–¹å¼æ¥æ›´æ”¹ï¼ˆçªå˜ï¼‰å‡½æ•°ã€‚Python åº“ mutmut ç”šè‡³å…è®¸æˆ‘ä»¬è‡ªåŠ¨æ›´æ”¹æºä»£ç ï¼ˆäº‹å…ˆåˆ›å»ºäº†å¤‡ä»½ï¼‰ï¼Œå¹¶æ£€æŸ¥å“ªäº›æµ‹è¯•åœ¨çªå˜åä»ç„¶é€šè¿‡ï¼ˆğŸ™ï¼‰ï¼Œå“ªäº›æµ‹è¯•å¤±è´¥ï¼ˆğŸ‰ï¼‰ã€‚

è¿™ä½¿ä½ çš„æµ‹è¯•å¥—ä»¶æ›´åŠ å¥å£®ï¼Œä»è€Œè®©ä½ ç”Ÿæˆæ­£ç¡®çš„ä»£ç ï¼Œè¿™å¯¹äºæ— é”™è¯¯åˆ†ææ˜¯å¿…è¦çš„ã€‚

æˆ‘å¸Œæœ›ä½ ä»Šå¤©å­¦åˆ°äº†æ–°çš„ã€æœ‰è¶£çš„ã€æœ‰ç”¨çš„ä¸œè¥¿ã€‚æ„Ÿè°¢é˜…è¯»ï¼

**æœ€åä¸€ç‚¹ï¼Œå¦‚æœä½ **

1.  **æƒ³æ”¯æŒæˆ‘å†™æ›´å¤šå…³äºæœºå™¨å­¦ä¹ çš„å†…å®¹å’Œ**

1.  **è®¡åˆ’æ— è®ºå¦‚ä½•è·å¾—ä¸€ä¸ª Medium è®¢é˜…ï¼Œ**

**ä¸ºä»€ä¹ˆä¸é€šè¿‡** [**è¿™ä¸ªé“¾æ¥**](https://dr-robert-kuebler.medium.com/membership)**æ”¯æŒæˆ‘å‘¢**ï¼Ÿè¿™å¯¹æˆ‘å¸®åŠ©å¾ˆå¤§ï¼ğŸ˜Š**

*ä¸ºäº†é€æ˜èµ·è§ï¼Œå¯¹ä½ æ¥è¯´ä»·æ ¼ä¸ä¼šæ”¹å˜ï¼Œä½†çº¦ä¸€åŠçš„è®¢é˜…è´¹ç”¨ç›´æ¥å½’æˆ‘ã€‚*

**éå¸¸æ„Ÿè°¢ï¼Œå¦‚æœä½ è€ƒè™‘æ”¯æŒæˆ‘ï¼**

> *å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨* [*LinkedIn*](https://www.linkedin.com/in/dr-robert-k%C3%BCbler-983859150/)*ä¸Šå†™ä¿¡ç»™æˆ‘ï¼*
