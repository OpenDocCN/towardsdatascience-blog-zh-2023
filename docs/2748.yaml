- en: 'Mapping South America with R: A Deep Dive into Geo-Visualization'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/mapping-south-america-with-r-a-deep-dive-into-geo-visualization-2fc8e34ec263?source=collection_archive---------5-----------------------#2023-08-30](https://towardsdatascience.com/mapping-south-america-with-r-a-deep-dive-into-geo-visualization-2fc8e34ec263?source=collection_archive---------5-----------------------#2023-08-30)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Navigating datasets, geopolitical nuances, and coding challenges to paint a
    comprehensive picture of the continent
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://fernandobarbalho.medium.com/?source=post_page-----2fc8e34ec263--------------------------------)[![Fernando
    Barbalho](../Images/0d145585cc73b89b4426af47b41844c5.png)](https://fernandobarbalho.medium.com/?source=post_page-----2fc8e34ec263--------------------------------)[](https://towardsdatascience.com/?source=post_page-----2fc8e34ec263--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----2fc8e34ec263--------------------------------)
    [Fernando Barbalho](https://fernandobarbalho.medium.com/?source=post_page-----2fc8e34ec263--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdcaa8c7ce010&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmapping-south-america-with-r-a-deep-dive-into-geo-visualization-2fc8e34ec263&user=Fernando+Barbalho&userId=dcaa8c7ce010&source=post_page-dcaa8c7ce010----2fc8e34ec263---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----2fc8e34ec263--------------------------------)
    ·8 min read·Aug 30, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2fc8e34ec263&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmapping-south-america-with-r-a-deep-dive-into-geo-visualization-2fc8e34ec263&user=Fernando+Barbalho&userId=dcaa8c7ce010&source=-----2fc8e34ec263---------------------clap_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2fc8e34ec263&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmapping-south-america-with-r-a-deep-dive-into-geo-visualization-2fc8e34ec263&source=-----2fc8e34ec263---------------------bookmark_footer-----------)![](../Images/e71adde3706de5aabb654caa506e69a4.png)'
  prefs: []
  type: TYPE_NORMAL
- en: Photo by [Alexander Schimmeck](https://unsplash.com/@alschim?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/Aohf8gqa7Zc?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  prefs: []
  type: TYPE_NORMAL
- en: So you are that kind of data scientist and amateur Medium writer who has enjoyed
    maps and geography since childhood. You are searching for a good theme for your
    subsequent work with graphs and, most certainly, maps when you realize that the
    official statistics agency of your country, Brazil, released the most recent census
    data. Why not? Why not take a picture of Brazil compared to its neighbors in South
    America? It might be a simple task using R and all its good packages. Let’s do
    it.
  prefs: []
  type: TYPE_NORMAL
- en: The minute after this decision comes the realization that the simple task is
    indeed a hero’s journey with elements such as discovering the most suitable dataset
    with shapefiles, lack of information, shapefiles interoperability, latitude and
    longitude mathematics, cultural differences in Geography concepts, and even geopolitical
    issues, like understanding how to put French overseas territories’ map and data
    correctly in South America.
  prefs: []
  type: TYPE_NORMAL
- en: The next paragraphs explain one of some possible paths to paint demographic
    information in a delimited portion of a world map. The step-by-step described
    below might be useful for all those interested in international comparison with
    a Geo-visualization approach, even if one’s purpose is to compare access to water
    among African countries or obesity rates in North America.
  prefs: []
  type: TYPE_NORMAL
- en: '[**Pachamama**](https://en.wikipedia.org/wiki/Pachamama)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let’s start with the whole picture: an R version of *mapa-mundi*. See the image
    and code below.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1c60df1557e87e17f4cbd5c7547002f6.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Mapa Mundi: Image by author'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: I use the package [{spData}](https://cran.r-project.org/web/packages/spData/spData.pdf)
    as a reference for a dataframe with geometry information for territories shapefiles
    all around the planet. The aes function uses the population information to fill
    the shapes. As we know, China and India are the most populated countries in the
    world, with over 1 billion people each. The heat colors show the contrast with
    all other countries. Most of the sequential colors are weak. We can barely understand
    the gradient of colors in the picture. The logarithm is the best alternative if
    you want a glimpse of a better color distribution. See below.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f3908f1eff92f38848f7638dc127cf75.png)'
  prefs: []
  type: TYPE_IMG
- en: Mapa mundi with log scale. Image by author
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: In the code, you can see the logarithm transformation in the scale_fill_continuous_sequential
    function.
  prefs: []
  type: TYPE_NORMAL
- en: In the world dataframe structure, there is a Continent column. So, filtering
    the data using this column to get a South American map is obvious. See the code
    and, right after, the map.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/089f997838d93643ecb65422795c1cdf.png)'
  prefs: []
  type: TYPE_IMG
- en: 'South America map: first version. Image by author'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: As you can see, the dplyr filter function worked fine; this is just the map
    we wanted to see. But is it really correct?
  prefs: []
  type: TYPE_NORMAL
- en: Climate change is a huge issue, but the sea levels haven’t risen yet with such
    a volume to drown a pronounced area that used to appear in North of South America.
    What happened here? Let’s draw another map now with the help of coordinates and
    naming the polygons.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/deae3ce74e9dd8ffe0a1ac3412b02c63.png)'
  prefs: []
  type: TYPE_IMG
- en: 'South America map: second version. Image by author'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: The theme_light instead of theme_void was sufficient to display the coordinates.
    The polygon naming took more work. We had to calculate the centroid of each polygon
    and then use this information as x and y coordinates in a geom_text_repel function.
  prefs: []
  type: TYPE_NORMAL
- en: 'With this new map version and some previous knowledge, we discovered the missing
    territory was French Guyana, between 0º and 10º north latitude and 53º and 55º
    west longitude. Our next quest is understanding how to get pieces of information
    on French Guyana: polygon, population, and some coordinates to fill our map.'
  prefs: []
  type: TYPE_NORMAL
- en: '[**La Mer**](https://open.spotify.com/intl-pt/track/1ZK8WJqkD1XhEYI1AlkMHG?si=254b1ac4ba1646d1)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: I had to isolate France from the rest of the world to understand how the {spData}
    package dealt with this country map’s data. See the result below.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/2ecc88d62e48cc11ecc18630f696ad85.png)'
  prefs: []
  type: TYPE_IMG
- en: A map of France. Image by author
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: France has many so-called overseas territories. The approach of the *{spData}*
    package was to represent only the main territory, plus Corsica, an island in the
    Mediterranean Sea, and French Guyana, located precisely in the coordinate range
    that characterizes the gap in our last map of South America.
  prefs: []
  type: TYPE_NORMAL
- en: My next try was to add the dataframe with France geometry data to my South America
    filter, but I knew I would need more. See below
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/9df870266c071dbee436c60750844b82.png)'
  prefs: []
  type: TYPE_IMG
- en: South America + France. Image by author
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: As you can see in the code, I used bind_row to combine South American territories
    with France shapefile. So we had now the French Guyana well positioned. On the
    other hand, there is no population information on the map, and France is a part
    of South America on the reverse of colonialism’s history.
  prefs: []
  type: TYPE_NORMAL
- en: In other words, I wanted this map.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/31cd893d321f76e97e7d5caacc009de5.png)'
  prefs: []
  type: TYPE_IMG
- en: French Guyana is on the South America map. Image by author
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: As you can read, I used an [R package](https://www.data.gouv.fr/en/reuses/insee-package-r/)
    produced by France’s official statistics office to obtain the population of Guyana.
    In addition, I limited the map to the appropriate coordinates to see South America.
  prefs: []
  type: TYPE_NORMAL
- en: '[**Emolduram e aquarelam o meu Brasil**](https://www.youtube.com/watch?v=VHN2TVwNhEo)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now that the map hero finally resolved the South American issues and played
    the [pipes of peace](https://www.youtube.com/watch?v=9MBFyU7FhGs&t=220s) with
    France, it’s time to return to Brazilian data and maps. Remember, I want to compare
    some Brazilian census details with other countries and territories south of Panama.
  prefs: []
  type: TYPE_NORMAL
- en: The data census is available in an [R package](https://github.com/rpradosiqueira/sidrar)
    or at an [API](https://servicodados.ibge.gov.br/api/docs/agregados?versao=3) address.
    I did the more challenging option using the API. Using the other option another
    time might be a good idea. See the code and the map below, where I show the population
    of the Brazilian states in contrast to the other South American territories.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ecac872b5d553f3b6908d5a8b4d11dcd.png)'
  prefs: []
  type: TYPE_IMG
- en: South America + Brazilian states. Image by author
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'I wrote the function get_municipalites_data using the API cited above. The
    code is available in my [gist](https://gist.github.com/fernandobarbalho/04429d85a499f2bc80cec88878d61287).
    Note also two functions that provide the shapefiles used to draw the Brazilian
    and its sub-region limits: read_country and read_states. These functions are present
    at the [{geobr}](https://github.com/ipeaGIT/geobr) package.'
  prefs: []
  type: TYPE_NORMAL
- en: 'I used another filter from the world dataframe. In this case, the purpose is
    to show the beginning of the Central American subcontinent and paint its map with
    a shade of gray. Here, we faced a cultural divergence as we learned in Brazil
    that the Americas have three sub-continents: North America, Central America, and
    South America. For the authors of the dataset, Central America is a sub-region
    of North America.'
  prefs: []
  type: TYPE_NORMAL
- en: Now it’s time to finish my work. I want to show the names of the eight most
    populous territories on the map. Even in this final sprint, there were a few code
    tricks.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7785052f63fb129506f4009e60c81ed9.png)'
  prefs: []
  type: TYPE_IMG
- en: Most populated territories. Image by author
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Three Brazilian states are among the eight most populated territories in South
    America. In fact, São Paulo is the second most inhabited space on the map, surpassing
    all the countries except Colombia.
  prefs: []
  type: TYPE_NORMAL
- en: Now, focusing on the code, you can see that I created a new dataframe to build
    this ranking by combining two different sf objects. I selected a sub-set of columns
    and changed the type from sf to tibble to enable the row binding.
  prefs: []
  type: TYPE_NORMAL
- en: So this is it. The hero has completed one possible path and left the footprints
    for the next journey. Now it’s your turn. Remember all of your projects that could
    have a significant improvement using a map representation. Using the walk-through
    above and gathering all the data available about population, socioeconomic issues,
    and so on, it’s just a matter of choosing the variable to fill the polygons.
  prefs: []
  type: TYPE_NORMAL
- en: Code and data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The complete code is available at [gist](https://gist.github.com/fernandobarbalho/04429d85a499f2bc80cec88878d61287).
  prefs: []
  type: TYPE_NORMAL
- en: All Brazilian datasets are characterized as public domain since they are data
    produced by federal government institutions, made available on the internet as
    active transparency, and are subject to the Brazilian Access to Information Law.
  prefs: []
  type: TYPE_NORMAL
- en: '[IBGE](https://apisidra.ibge.gov.br/values/t/4714/n6/all/v/all/p/all/d/v614%202):
    Brazilian census Data'
  prefs: []
  type: TYPE_NORMAL
- en: '[IPEA](https://github.com/ipeaGIT/geobr): Brazilian shapefiles'
  prefs: []
  type: TYPE_NORMAL
- en: The French data is available from the [Open Data Portal](https://www.data.gouv.fr/en/datasets/population/)
    and is listed as [Open License](https://www.etalab.gouv.fr/wp-content/uploads/2014/05/Licence_Ouverte.pdf)
    which allows explore the information for commercial purposes.
  prefs: []
  type: TYPE_NORMAL
