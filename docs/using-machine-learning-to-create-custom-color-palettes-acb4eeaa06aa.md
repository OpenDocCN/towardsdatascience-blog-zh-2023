# ä½¿ç”¨æœºå™¨å­¦ä¹ åˆ›å»ºè‡ªå®šä¹‰è‰²å½©è°ƒè‰²æ¿

> åŸæ–‡ï¼š[`towardsdatascience.com/using-machine-learning-to-create-custom-color-palettes-acb4eeaa06aa`](https://towardsdatascience.com/using-machine-learning-to-create-custom-color-palettes-acb4eeaa06aa)

## æ·±å…¥äº†è§£ Streamlit çš„æœ¬æœˆåº”ç”¨

[](https://medium.com/@siavashyasini?source=post_page-----acb4eeaa06aa--------------------------------)![Siavash Yasini](https://medium.com/@siavashyasini?source=post_page-----acb4eeaa06aa--------------------------------)[](https://towardsdatascience.com/?source=post_page-----acb4eeaa06aa--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----acb4eeaa06aa--------------------------------) [Siavash Yasini](https://medium.com/@siavashyasini?source=post_page-----acb4eeaa06aa--------------------------------)

Â·å‘è¡¨åœ¨[Towards Data Science](https://towardsdatascience.com/?source=post_page-----acb4eeaa06aa--------------------------------) Â·12 åˆ†é’Ÿé˜…è¯»Â·2023 å¹´ 2 æœˆ 16 æ—¥

--

![](img/1f09de41ab54258a22eed6764d2b2464.png)

ç…§ç‰‡ç”±[Ricardo Gomez Angel](https://unsplash.com/@rgaleriacom?utm_source=medium&utm_medium=referral)æä¾›ï¼Œ[Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

# **ä»‹ç»**

æˆ‘ä»¬éƒ½å–œæ¬¢æ¥è§¦æ–°çš„æ•°æ®é›†ã€æ¢ç´¢å®ƒï¼Œå¹¶ä»ä¸­å­¦ä¹ ã€‚ä½†åŸå§‹æ•°å­—æœ¬èº«å¹¶ä¸æ˜¯ä¼˜ç§€çš„è®²è¿°è€…ã€‚æˆ‘ä»¬åŸå§‹çš„å¤§è„‘å¤©ç”Ÿå¯¹çº¿æ¡ã€å½¢çŠ¶å’Œé¢œè‰²æ•æ„Ÿã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ•°å­—éœ€è¦è¢«å¯è§†åŒ–æ‰èƒ½è®²è¿°ä¸€ä¸ªå¥½çš„æ•…äº‹ã€‚

æ•°æ®å¯è§†åŒ–çš„è‰²å½©è°ƒè‰²æ¿å¯èƒ½ä¼šå†³å®šä½ çš„æ•°æ®æ•…äº‹çš„æˆè´¥ã€‚è™½ç„¶ä¸ºä½ çš„æ•°æ®å¯è§†åŒ–æ‰¾åˆ°å®Œç¾çš„é¢œè‰²ç»„åˆå¯èƒ½æ˜¯ä¸€ä¸ªä¸¥æ ¼ä¸”è€—æ—¶çš„ä»»åŠ¡ï¼Œä½†ä½ ä¸å¿…å®Œå…¨ç‹¬è‡ªå®Œæˆã€‚ä½ å¯ä»¥ä»å†å²ä¸Šæœ€ä¼Ÿå¤§çš„ç”»å®¶å’Œè‰ºæœ¯å®¶é‚£é‡Œè·å¾—çµæ„Ÿã€‚

![](img/d50d19ef7363c358c55970608f26affd.png)

ä½œè€…æä¾›çš„å›¾ç‰‡

ä»é›¶å¼€å§‹åˆ›å»ºè‰²å½©è°ƒè‰²æ¿é€šå¸¸æ˜¯å¯è§†åŒ–å·¥ç¨‹å¸ˆå’Œè®¾è®¡å¸ˆçš„ä¸“ä¸šé¢†åŸŸï¼Œä»–ä»¬ä½¿ç”¨è‰²å½©ç†è®ºæ¥ç»„åˆé€‚åˆå„ç§å¯è§†åŒ–ç›®çš„çš„å’Œè°è°ƒè‰²æ¿ï¼ˆä¾‹å¦‚ï¼Œ*å•è‰²*è°ƒè‰²æ¿ç”¨äºé¡ºåºæˆ–æ¸å˜å›¾ï¼Œæˆ–*äº’è¡¥*è°ƒè‰²æ¿ç”¨äºåˆ†ç±»å›¾è¡¨ï¼‰ã€‚åƒ`[matplotlib](https://matplotlib.org/)`æˆ–`[plotly](https://plotly.com)`è¿™æ ·çš„å¯è§†åŒ–åŒ…å·²ç»æä¾›äº†ä»¤äººæƒŠå¹çš„è°ƒè‰²æ¿é›†åˆã€‚

è™½ç„¶æ•°æ®åˆ†æå¸ˆå’Œæ•°æ®ç§‘å­¦å®¶å¯ä»¥ä½¿ç”¨é¢„åˆ¶çš„é¢œè‰²è°ƒè‰²æ¿ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦è‡ªå·±åˆ›å»ºè‡ªå®šä¹‰è°ƒè‰²æ¿ã€‚ä¾‹å¦‚ï¼Œå½“ä½ æƒ³åˆ¶ä½œä¸€ä¸ªä¸å…¬å¸é¢œè‰²ä¸»é¢˜ä¸€è‡´çš„å¯è§†åŒ–æ—¶ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³åˆ›å»ºä¸€ä¸ªä¸å–œæ¬¢çš„å…¬å¸çš„ logo ä¸»é¢˜åŒ¹é…çš„æŸ±çŠ¶å›¾ã€‚æœ‰ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨ä¸ºä½ å®Œæˆè¿™é¡¹å·¥ä½œçš„åº”ç”¨ç¨‹åºä¼šéå¸¸å¥½ï¼Œå¯¹å§ï¼Ÿ

![](img/b101e9b82ec488901cd97df3978afca1.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›

![](img/262ffc426620d97852cb8bd71881c38b.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›

æˆ‘èŠ±è´¹äº†å¤ªå¤šæ—¶é—´è¯•å›¾ä¸ºæˆ‘çš„å¯è§†åŒ–æ‰¾å‡ºå®Œç¾çš„é¢œè‰²ç»„åˆï¼Œå› æ­¤æˆ‘å†³å®šè®©è¿™ä¸ªè¿‡ç¨‹å¯¹æˆ‘è‡ªå·±æ¥è¯´æ›´ç®€å•ä¸€äº›ã€‚

æˆ‘ä½¿ç”¨[Streamlit](https://www.linkedin.com/company/streamlit/) ğŸˆæ„å»ºäº†ä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä»ä»»ä½•è¾“å…¥å›¾åƒä¸­æ¨æ–­é¢œè‰²è°ƒè‰²æ¿ï¼šæ— è®ºæ˜¯ç”»ä½œã€ç”µå½±æµ·æŠ¥ã€æ‘‡æ»šä¸“è¾‘å°é¢ï¼Œè¿˜æ˜¯åœ£è¯å®¶åº­ç…§ç‰‡ï¼Œåº”æœ‰å°½æœ‰ï¼è™½ç„¶åº”ç”¨ç¨‹åºå¯èƒ½ä¸ä¼šç«‹å³æä¾›å®Œç¾çš„é¢œè‰²è°ƒè‰²æ¿ï¼Œä½†è‡³å°‘ä¼šç»™ä½ ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ã€‚

é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘æ˜¯å¦‚ä½•æ„å»ºè¿™ä¸ªåº”ç”¨ç¨‹åºçš„ã€‚

# æ„å»ºé¢œè‰²è°ƒè‰²æ¿æ¨æ–­åº”ç”¨ç¨‹åº

![](img/9fa1dc289439f16bba94504a7ba93a7a.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›

ä¸ºäº†åˆ›å»ºä¸€ä¸ªé¢œè‰²è°ƒè‰²æ¿æ¨æ–­å·¥å…·ï¼Œæˆ‘ä»¬éœ€è¦å‡ ä¸ªç»„ä»¶ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æ•™ä½ ï¼š

1.  å¦‚ä½•æ„å»ºä¸€ä¸ªå›¾åƒåŠ è½½ç»„ä»¶

1.  å¦‚ä½•æ„å»ºä¸€ä¸ªå¸¦æ»‘å—çš„å›¾åƒå¢å¼ºç»„ä»¶

1.  å¦‚ä½•å¯¹åƒç´ è¿›è¡Œèšç±»å¹¶ä½¿ç”¨ç»„å¹³å‡å€¼æ¥åˆ¶ä½œè°ƒè‰²æ¿

1.  å¦‚ä½•ä½¿ç”¨é¢œè‰²é€‰æ‹©å™¨å°éƒ¨ä»¶æ¥æ˜¾ç¤ºå’Œä¿®æ”¹è°ƒè‰²æ¿

æƒ³è¦äº²è‡ªè¯•ç”¨è¿™ä¸ªåº”ç”¨ç¨‹åºå—ï¼Ÿä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://sophisticated-palette.streamlit.app/)æŸ¥çœ‹å®ƒï¼Œå¹¶åœ¨[è¿™é‡Œ](https://github.com/syasini/sophisticated_palette)æŸ¥çœ‹æºä»£ç ã€‚

## 1\. å¦‚ä½•æ„å»ºä¸€ä¸ªå›¾åƒåŠ è½½ç»„ä»¶

æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯è¾“å…¥æˆ‘ä»¬æƒ³è¦è½¬æ¢ä¸ºé¢œè‰²è°ƒè‰²æ¿çš„å›¾åƒçš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‰ç§æ–¹å¼åšåˆ°è¿™ä¸€ç‚¹ï¼š

+   ä»ç°æœ‰çš„å›¾åƒæˆ–è‰ºæœ¯å“åº“ä¸­åŠ è½½ã€‚

+   ä½¿ç”¨`st.file_uploader()`å°†æ–°çš„å›¾åƒæ–‡ä»¶ä¸Šä¼ åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚

+   ä» URL ä¸‹è½½ä¸€å¼ æ–°å›¾åƒåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`st.tabs()`æ„å»ºä¸‰ä¸ªä¸åŒçš„é€‰é¡¹å¡ï¼Œè®©æˆ‘ä»¬å¯ä»¥æ— ç¼åˆ‡æ¢è¿™ä¸‰ç§è¾“å…¥æ¨¡å¼ã€‚

![](img/ef24ea3236c1e77a27219776a2ab50ff.png)

ä½¿ç”¨`st.tabs()`æ„å»ºçš„å›¾åƒè¾“å…¥æºã€‚

ç”±äº Streamlit è¿è¡Œåº”ç”¨ç¨‹åºçš„æ–¹å¼æ˜¯ä»ä¸Šåˆ°ä¸‹ï¼Œåæ¥çš„è¾“å…¥æ¨¡å¼ä¼šè·å¾—æ›´é«˜çš„ä¼˜å…ˆçº§å¹¶è¦†ç›–ä¹‹å‰åŠ è½½å™¨çš„è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œç”±äºä½ å°†è¾“å…¥æ¨¡å¼æŒ‰ Gallery â†’ File Uploader â†’ Image URL çš„é¡ºåºæ’åˆ—ï¼Œå¦‚æœä½ å°†å›¾åƒä¿å­˜åˆ°å˜é‡`img`ä¸­ï¼Œåˆ™ç”»å»ŠåŠ è½½çš„ä»»ä½•å†…å®¹éƒ½ä¼šè¢«æ–‡ä»¶ä¸Šä¼ å™¨å’Œ URL ä¸‹è½½å™¨çš„è¾“å‡ºè¦†ç›–ã€‚

å½“ç”¨æˆ·ä½¿ç”¨å±‚çº§è¾ƒä½çš„åŠ è½½å™¨åŠ è½½å›¾åƒæ—¶ï¼Œä½ å¯ä»¥ä¸ºç”¨æˆ·æ·»åŠ å¼¹å‡ºè­¦å‘Šï¼Œå¦‚æœå±‚çº§è¾ƒé«˜çš„åŠ è½½å™¨å·²ç»åŠ è½½äº†å›¾åƒã€‚

è¿™å°±æ˜¯ä»£ç çš„æ ·å­ï¼š

```py
# define three tabs for the three loading methods
gallery_tab, upload_tab, url_tab = st.tabs(["Gallery", "Upload", "Image URL"])
```

```py
with gallery_tab:
    ...

# raise a warning if file uploader or URL downloader have already loaded an image 
    if st.session_state.get("file_uploader") is not None:
        st.warning("To use the Gallery, remove the uploaded image first.")
    if st.session_state.get("image_url") not in ["", None]:
        st.warning("To use the Gallery, remove the image URL first.")

  img = ...

with upload_tab:
  img = ...

  # raise a warning if the URL downloader has already loaded an image
    if st.session_state.get("image_url") not in ["", None]:
        st.warning("To use the file uploader, remove the image URL first.")

with url_tab:
  img = ...
```

å› æ­¤ï¼Œå¦‚æœä½ å°è¯•ä»ç”»å»ŠåŠ è½½ä¸€ä¸ªé¢„å…ˆå­˜åœ¨çš„å›¾åƒï¼Œä½†åœ¨ URL ä¸‹è½½å™¨ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªé“¾æ¥ï¼Œä½ å°†éœ€è¦å…ˆåˆ é™¤é‚£ä¸ªé“¾æ¥ã€‚è¿™å¯èƒ½ä¸æ˜¯æœ€ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒæœ‰æ•ˆï¼

ç°åœ¨ï¼Œç»§ç»­å®ç°æ¯ä¸€éƒ¨åˆ†çš„åŠ è½½æ–¹æ³•ã€‚

**ç”»å»Šè§†å›¾**

å¯¹äºç”»å»Šè§†å›¾ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†ä¸€äº›å›¾åƒä¿å­˜åœ¨å…¬å…±å­˜å‚¨åº“ä¸­ï¼Œå¹¶ç›´æ¥åœ¨åº”ç”¨ç¨‹åºä¸­åŠ è½½è¿™äº›å›¾åƒï¼ˆæˆ‘åœ¨è¿™é‡Œä½¿ç”¨ GitHubï¼Œä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ AWS S3 æˆ– Google Cloud Storageï¼‰ã€‚`st.selectbox` åŒ…å«æˆ‘ä¿å­˜çš„è‰ºæœ¯å“åç§°ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥é€šè¿‡ä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©æ¥åŠ è½½å®ƒä»¬ã€‚å®ç°ä»£ç å¦‚ä¸‹ã€‚

```py
import streamlit as st
from PIL import Image

with gallery_tab:
    options = list(gallery_dict.keys())
    file_name = st.selectbox("Select Art",
                             options=options, 
                             index=options.index("Mona Lisa (Leonardo da Vinci)")
                             )
    img_file = gallery_dict[file_name]

    if st.session_state.get("file_uploader") is not None:
        st.warning("To use the Gallery, remove the uploaded image first.")
    if st.session_state.get("image_url") not in ["", None]:
        st.warning("To use the Gallery, remove the image URL first.")

    img = Image.open(img_file)
```

`gallery_dict` æ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«æ–‡ä»¶åå’Œå›¾åƒæ–‡ä»¶è·¯å¾„ä½œä¸ºé”®å€¼å¯¹ï¼Œ`PIL.Image.open()` ç”¨äºåŠ è½½è¿™äº›æ–‡ä»¶ã€‚ç»“æœä¿å­˜åœ¨ä¸€ä¸ªåä¸º `img` çš„å˜é‡ä¸­ã€‚

**æ–‡ä»¶ä¸Šä¼ å™¨**

å®ç°æ–‡ä»¶ä¸Šä¼ å™¨éå¸¸ç®€å•ï¼Œå› ä¸ºå·²ç»æœ‰ä¸€ä¸ª Streamlit å°éƒ¨ä»¶ã€‚å®ƒå«åšï¼ˆä½ èƒ½çŒœåˆ°å—ï¼Ÿï¼‰`st.file_uploader()`ï¼

å®ç°ä»£ç å¦‚ä¸‹ï¼š

```py
with upload_tab:
    img_file = st.file_uploader("Upload Art", key="file_uploader")
    if file is not None:
        try:
            img = Image.open(img_file)
        except:
            st.error("The file you uploaded does not seem to be a valid image. Try uploading a png or jpg file.")

    if st.session_state.get("image_url") not in ["", None]:
        st.warning("To use the file uploader, remove the image URL first.")
```

è¿™ä¸ªå°éƒ¨ä»¶å…è®¸ä½ ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åä½ å¯ä»¥å°†å…¶ä¼ é€’ç»™ `PIL.Image.open()` æ¥åŠ è½½ã€‚å¦‚æœæ–‡ä»¶å®é™…ä¸Šä¸æ˜¯å›¾åƒæ–‡ä»¶ï¼Œæˆ–è€…æ ¼å¼ä¸ `PIL.Image` æœŸæœ›çš„ä¸ä¸€è‡´ï¼Œè¿™ä¸€æ­¥å¯èƒ½ä¼šå¤±è´¥ã€‚ä¸ºäº†é˜²æ­¢è¿™ä¸ªé—®é¢˜å‘ç”Ÿï¼Œæˆ‘ä»¬å¯ä»¥å°†åŠ è½½éƒ¨åˆ†æ”¾å…¥ä¸€ä¸ª `try/except` å—ä¸­ã€‚

âš ï¸ æˆ‘åœ¨è¿™é‡Œä½¿ç”¨è¿™ä¸ªä»£ç å—ä½œä¸ºä¸‡ç”¨å—ï¼Œä»¥é¿å…åœ¨åŠ è½½æ–‡ä»¶æ—¶å‡ºç°å„ç§æ„å¤–é”™è¯¯ã€‚ç„¶è€Œï¼Œé€šå¸¸ä¸æ¨èåœ¨æ²¡æœ‰å®é™…æŒ‡å®šè¦ç»•è¿‡çš„`Exception`ç±»å‹çš„æƒ…å†µä¸‹ä½¿ç”¨`except`ï¼Œå°¤å…¶æ˜¯å› ä¸ºä½ å¯èƒ½ä¸çŸ¥é“çš„è‡´å‘½é”™è¯¯ä¼šé»˜é»˜åœ°é€šè¿‡è¿™ä¸ªä»£ç å—ï¼Œä½¿å¾—è°ƒè¯•ä»£ç å˜å¾—å›°éš¾ã€‚

**URL ä¸‹è½½å™¨**

è¯´å®è¯ï¼è™½ç„¶ä¸Šä¼ æ–‡ä»¶æ˜¯ç”¨æˆ·åŠ è½½ä»–ä»¬å¸Œæœ›æ¨æ–­é¢œè‰²è°ƒè‰²æ¿çš„è‡ªå®šä¹‰å›¾åƒçš„å¥½æ–¹æ³•ï¼Œä½†è¿™ä¸æ˜¯æœ€ç®€å•çš„æ–¹æ³•ã€‚ç”¨æˆ·éœ€è¦æ‰¾åˆ°å›¾åƒï¼ˆå¦‚æœä»–ä»¬è¿˜æ²¡æœ‰çš„è¯ï¼‰ï¼Œåœ¨æœ¬åœ°ä¸‹è½½ï¼Œç„¶åä¸Šä¼ åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚å¬èµ·æ¥ç®€å•ï¼Œä½†åœ¨å®é™…æ“ä½œä¸­å´å¾ˆéº»çƒ¦ã€‚

ä¸ºäº†æ¶ˆé™¤è¿™ä¸ªéšœç¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­æ·»åŠ ä¸€ä¸ª URL ä¸‹è½½å™¨ï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥ç®€å•åœ°å¤åˆ¶å›¾åƒé“¾æ¥ï¼ˆä¾‹å¦‚ï¼Œä» Google æœç´¢ç»“æœä¸­ï¼‰ï¼Œç„¶åç›´æ¥ç²˜è´´åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ `requests` æ¨¡å—ï¼Œå®ƒè·å– URL çš„å†…å®¹ï¼Œä»¥åŠ `io.BytesIO` å‡½æ•°ï¼Œå®ƒä½¿å¾—å†…å®¹èƒ½å¤Ÿè¢« `PIL.Image.open()` ç†è§£ã€‚å®ç°èµ·æ¥ç®€å•ä¸”ä¸æ–‡ä»¶ä¸Šä¼ å™¨çš„å®ç°ç±»ä¼¼ã€‚

```py
import requests
from io import BytesIO

with url_tab:
    url_text = st.empty()

    url = url_text.text_input("Image URL", key="image_url")

    if url != "":
        try:
            response = requests.get(url)
            img = Image.open(BytesIO(response.content))
        except:
            st.error("The URL does not seem to be valid.")
```

## 2\. å¦‚ä½•ä½¿ç”¨æ»‘å—æ„å»ºå›¾åƒå¢å¼ºç»„ä»¶

ç°åœ¨æˆ‘ä»¬å·²ç»ä¸Šä¼ äº†å›¾åƒï¼Œæˆ‘ä»¬å‡†å¤‡æ¨æ–­é¢œè‰²è°ƒè‰²æ¿ï¼Œå¯¹å—ï¼Ÿå…¶å®ä¸å®Œå…¨æ˜¯ã€‚

ä½ åŠ è½½åˆ°åº”ç”¨ç¨‹åºä¸­çš„åŸå§‹å›¾åƒå¯èƒ½æœªç»è¿‡é¢œè‰²æ¨æ–­çš„ä¼˜åŒ–ã€‚é¢œè‰²å¯èƒ½è¿‡äºæš—æ·¡ï¼Œç”»å¸ƒä¸Šçš„äº®åº¦æˆ–å¯¹æ¯”åº¦å¯èƒ½ä¸è¶³ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ éœ€è¦é¦–å…ˆè¿›è¡Œä¸€äº›å›¾åƒè°ƒæ•´ã€‚

![](img/5817b6a837e8ae6e175989ec428582ed.png)

ä¸ºäº†å°†å¢å¼ºåŠŸèƒ½åº”ç”¨äºå›¾åƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `PIL.ImageEnhance`ã€‚API éå¸¸ç®€å•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³å°†å›¾åƒï¼ˆåŠ è½½åˆ° `img` ä¸­ï¼‰çš„é¢œè‰²å¢å¼ºå› å­è®¾ç½®ä¸º 2.5ï¼Œä½ å¯ä»¥è¿è¡Œï¼š

```py
img = ImageEnhance.Color(img)
img = img.enhance(2.5)
```

åªéœ€å°† `Color` æ›¿æ¢ä¸º `Shapness`ã€`Contrast` æˆ– `Brightness`ï¼Œå³å¯åˆ†åˆ«è°ƒæ•´è¿™äº›å›¾åƒå±æ€§ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºå››ä¸ªä¸åŒçš„æ»‘å—ï¼Œå°†æ¯ä¸ªå±æ€§çš„å€¼åˆ†é…ç»™è¿™äº›æ»‘å—ï¼Œç„¶åç¼–å†™å•ç‹¬çš„ä»£ç å—ï¼Œä¾æ¬¡å°†å¢å¼ºåº”ç”¨äºå›¾åƒã€‚ä½†æˆ‘ä»¬æ˜¯ä¼˜ç§€çš„ç¨‹åºå‘˜ï¼Œæˆ‘ä»¬å°½é‡ä¿æŒä»£ç ä¼˜é›…å’Œ DRYï¼ˆDonâ€™t Repeat Yourselfï¼‰ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ä»¥æ›´å®ç”¨çš„æ–¹å¼æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚

æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬å¸Œæœ›åº”ç”¨çš„æ‰€æœ‰å¢å¼ºåŠŸèƒ½ä½œä¸ºé”®ï¼Œå€¼è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›åœ¨åº”ç”¨ç¨‹åºä¸­åˆ†é…ç»™è¿™äº›å¢å¼ºåŠŸèƒ½çš„æ»‘å—èŒƒå›´å’Œæ­¥é•¿ã€‚

```py
enhancement_range = {
  # "enhancement_type": [min, max, step_size]
    "Color": [0., 5., 0.2], 
    "Sharpness": [0., 3., 0.2], 
    "Contrast": [0.5, 1.5, 0.1], 
    "Brightness": [0.5, 1.5, 0.1]
}
enhancement_categories = enhancement_range.keys()
# put adjustment sliders inside an expander 
enh_expander = st.sidebar.expander("Image Enhancements", expanded=False)
# create a reset button that resets all enhancements to default value (1.0)
with enh_expander:
    if st.button("reset"):
        for cat in enhancement_categories:
            if f"{cat}_enhancement" in st.session_state:
                st.session_state[f"{cat}_enhancement"] = 1.0
# create sliders for each enhancement category using the dictionary values (min, max, step_size)
enhancement_factor_dict = {
    cat: enh_expander.slider(f"{cat} Enhancement", 
                            value=1., 
                            min_value=enhancement_range[cat][0], 
                            max_value=enhancement_range[cat][1], 
                            step=enhancement_range[cat][2],
                            key=f"{cat}_enhancement")
    for cat in enhancement_categories
}
```

ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ›´æ”¹å¢å¼ºç±»å‹æˆ–å€¼èŒƒå›´ï¼Œæˆ‘ä»¬åªéœ€æ›´æ”¹åŸå§‹å­—å…¸ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨ä¾§è¾¹æ ä¸Šæ”¾ç½®äº†æ»‘å—ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä½¿ç”¨ `ImageEnhance` å°†è¿™äº›å€¼åº”ç”¨äºå›¾åƒã€‚

```py
from PIL import ImageEnhance
for cat in enhancement_categories:
  # apply the enhancement class to the image
  # e.g. for cat='Color' this would be the same as 
    # img = ImageEnhance.Color(img)
    img = getattr(ImageEnhance, cat)(img)

  # apply the enhencement value from the corresponding st.slider
    img = img.enhance(enhancement_factor_dict[cat])
```

**æ˜¾ç¤ºå›¾åƒ**

ç°åœ¨æˆ‘ä»¬å·²ç»åŠ è½½äº†å›¾åƒï¼Œå‰©ä¸‹çš„å°±æ˜¯ä½¿ç”¨ `st.image()` å°†å…¶æ˜¾ç¤ºåœ¨åº”ç”¨ç¨‹åºä¸­ï¼š

```py
with st.expander("ğŸ–¼  Artwork", expanded=True):
    st.image(img, use_column_width=True)
```

å’Œ *ç§*ï¼

## 3\. å¦‚ä½•èšç±»åƒç´ å¹¶ä½¿ç”¨ç»„å¹³å‡å€¼åˆ¶ä½œè°ƒè‰²æ¿

æœ€åï¼Œè¿›å…¥æœ‰è¶£çš„éƒ¨åˆ†ï¼ä½¿ç”¨æœºå™¨å­¦ä¹ æ¨æ–­è‰²å½©è°ƒè‰²æ¿ã€‚

è¿™é‡Œçš„æƒ³æ³•éå¸¸ç®€å•ã€‚ä¸€å¹…å›¾åƒæ˜¯åƒç´ çš„é›†åˆï¼Œæ¯ä¸ªåƒç´ éƒ½æœ‰ä¸‰ä¸ªå€¼ï¼šRã€Gã€Bã€‚è¿™äº›å€¼åŸºæœ¬ä¸Šå‘Šè¯‰ä½ æ¯ä¸ªåƒç´ åŒ…å«å¤šå°‘çº¢è‰²ã€ç»¿è‰²å’Œè“è‰²ã€‚ä¸ºäº†æ¨æ–­è‰²å½©è°ƒè‰²æ¿ï¼Œåƒç´ åœ¨ç”»å¸ƒä¸Šçš„å®é™…ä½ç½®åŸºæœ¬ä¸Šæ˜¯æ— å…³ç´§è¦çš„ã€‚é‡è¦çš„æ˜¯å®ƒåœ¨ (R, G, B) åæ ‡ç©ºé—´ä¸­çš„ä½ç½®ã€‚å› æ­¤ï¼Œåœ¨ç»§ç»­ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å°†å›¾åƒåˆ†è§£åˆ°è¿™ä¸ªæ–°çš„åæ ‡ç³»ç»Ÿä¸­ï¼Œå¹¶æ‘†è„±åƒç´ åœ¨å›¾åƒä¸Šçš„å®é™…ä½ç½®ã€‚

```py
r, g, b = np.array(img).reshape(-1, 3).T
df_rgb = pd.DataFrame({"R": r, "G": g, "B": b}).sample(n=sample_size)
```

å¦‚æœæˆ‘ä»¬æŸ¥çœ‹ RGB åæ ‡ä¸­çš„åƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›¸äº’æ¥è¿‘çš„åƒç´ åˆ†ç»„ï¼Œå¹¶ä½¿ç”¨åƒç´ çš„å¹³å‡å€¼æ¥è¡¨ç¤ºæ¯ä¸ªç»„â€”â€”å®é™…ä¸Šæ˜¯æˆ‘ä»¬è°ƒè‰²æ¿ä¸­çš„ä¸€ç§é¢œè‰²ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä»è’™å¨œä¸½èçš„å¢å¼ºå›¾åƒä¸­æ„å»ºä¸€ä¸ª 5 è‰²è°ƒè‰²æ¿ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆæŸ¥çœ‹ RGB ç©ºé—´ä¸­åƒç´ çš„åˆ†å¸ƒï¼ˆè¿™é‡Œé€šè¿‡ PCA ç®—æ³•æŠ•å½±åˆ°äºŒç»´ï¼‰ï¼š

![](img/aaf50c2e6a36baff6e418262156e77bc.png)

åŸå§‹åƒç´ é¢œè‰²åœ¨ (R, G, B) ç©ºé—´ä¸­çš„äºŒç»´ PCA åˆ†è§£

![](img/79b2d0844aea6616e93aa70a23ce6a38.png)

ç„¶åæˆ‘ä»¬é€‰æ‹© 5 ä¸ªä¸åŒçš„ç°‡ï¼Œå¹¶å°†æ¯ä¸ªç°‡çš„å¹³å‡å€¼åˆ†é…ç»™è°ƒè‰²æ¿ä¸­çš„ä¸€ä¸ªæ§½ã€‚

ä½¿ç”¨ K-means ç®—æ³•å°†åŸå§‹é‡‡æ ·åƒç´ åˆ†é…åˆ° 5 ä¸ªä¸åŒçš„ç°‡

æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å®Œæˆè¿™ä¸ªå·¥ä½œã€‚æœ‰ä¸€ç§æ–¹ä¾¿çš„æœºå™¨å­¦ä¹ ç®—æ³•å«åš K-means èšç±»ï¼Œå®ƒå¯ä»¥ä¸€ä¸¾å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚æˆ‘ä»¬å”¯ä¸€éœ€è¦æä¾›çš„å‚æ•°æ˜¯èšç±»çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„è°ƒè‰²æ¿å¤§å°ã€‚è¿™æ˜¯ä½¿ç”¨ `sklearn.cluster.KMeans` å®ç°çš„æ ·å­ã€‚

```py
from sklearn.cluster import KMeans
palette_size = st.sidebar.number_input("palette size", 
                    min_value=1, 
                    max_value=20, 
                    value=5, 
                    step=1, 
                    help="Number of colors to infer from the image.")
model = KMeans(n_clusters=palette_size)
clusters = model.fit_predict(df_rgb)

palette = model.cluster_centers_.astype(int).tolist()
```

å°±è¿™æ ·ï¼æˆ‘ä»¬ç°åœ¨æœ‰äº†æˆ‘ä»¬çš„è°ƒè‰²æ¿ï¼Œåªéœ€è¦å°†å…¶è¿”å›ç»™åº”ç”¨ä¸­çš„ç”¨æˆ·ã€‚

â„¹ï¸ å°½ç®¡æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨äº†æµè¡Œçš„ Rã€Gã€B åƒç´ åˆ†è§£ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸æ˜¯åˆ†è§£é¢œè‰²çš„å”¯ä¸€æ–¹æ³•ã€‚æˆ‘ä»¬æœ¬å¯ä»¥åœ¨ HSVï¼ˆè‰²è°ƒã€é¥±å’Œåº¦ã€æ˜åº¦ï¼‰ç©ºé—´ä¸­è¿›è¡Œåƒç´ èšç±»ï¼Œè¿™å°†ä»¥ä¸åŒçš„æ–¹å¼åˆ†å¸ƒåƒç´ ï¼Œä»è€Œå¾—åˆ°ä¸åŒçš„è°ƒè‰²æ¿ã€‚

## 4\. å¦‚ä½•ä½¿ç”¨è‰²å½©é€‰æ‹©å™¨æ§ä»¶

ä¸çŸ¥ä¸ºä½•ï¼Œæˆ‘æ„Ÿè§‰æˆ‘å†³å®šæ„å»ºè¿™ä¸ªåº”ç”¨çš„æ½œæ„è¯†åŸå› æ˜¯ä¸ºäº†ä½¿ç”¨ Streamlit çš„ç¥å¥‡ `st.color_picker()` æ§ä»¶ï¼è¿™ä¸ªæ§ä»¶çš„å¥½å¤„åœ¨äºï¼Œä½ å¯ä»¥åŒæ—¶å±•ç¤ºä»å›¾åƒä¸­æ¨æ–­å‡ºçš„è°ƒè‰²æ¿é¢œè‰²ï¼Œå¹¶ä¸”å¦‚æœæ„¿æ„çš„è¯ï¼Œè¿˜å¯ä»¥æ›´æ”¹å®ƒä»¬ã€‚è¿™éå¸¸å®Œç¾ï¼Œå› ä¸ºæ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œä»åº”ç”¨ä¸­å¾—åˆ°çš„é¢œè‰²å¯èƒ½å¹¶ä¸æ˜¯é’ˆå¯¹ä½ ç‰¹å®šç”¨ä¾‹çš„ 100% å®Œç¾ï¼Œè€Œåªæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ã€‚æ‰€ä»¥ä½ å¯èƒ½éœ€è¦ç¨å¾®è°ƒæ•´ä¸€ä¸‹ï¼Œåœ¨å®é™…ç”¨äºä½ çš„å¯è§†åŒ–ä¹‹å‰åšä¸€äº›ä¿®é¥°ã€‚

æˆ‘ä»¬ä¸å¸Œæœ›è°ƒè‰²æ¿åœ¨åº”ç”¨ç¨‹åºä¸­å æ®é¡µé¢çš„ä¸€åŠï¼Œå› æ­¤è®©æˆ‘ä»¬æŠŠå®ƒä»¬åˆ†åˆ«æ”¾åœ¨ä¸åŒçš„åˆ—ä¸­ã€‚

```py
columns = st.columns(palette_size)
for i, col in enumerate(columns):
    with col:        
        st.session_state[f"col_{i}"]= \\
				    st.color_picker(label=str(i), 
                                    value=palette[i], 
                                    key=f"pal_{i}")
						  							value=palette[i], 
							  						key=f"pal_{i}")
```

ç¾æäº†ï¼

æœ€åä¸€ä»¶è¦åšçš„äº‹æƒ…æ˜¯ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªå¯ä»¥åœ¨æ—¥å¸¸å·¥ä½œä¸­ä½¿ç”¨çš„å®ç”¨äº§å“ã€‚å¦‚æœæ•°æ®åˆ†æå¸ˆæˆ–æ•°æ®ç§‘å­¦å®¶ä½¿ç”¨è¿™ä¸ªåº”ç”¨æ¥æ¨æ–­ä¸€ä¸ªè‰²å½©è°ƒè‰²æ¿ï¼Œä»–ä»¬å¾ˆå¯èƒ½ä¼šåœ¨ `matplotlib` æˆ– `plotly` ä¸­ä½¿ç”¨è¿™ä¸ªè°ƒè‰²æ¿æ¥åº”ç”¨äºä»–ä»¬çš„å¯è§†åŒ–ä¸­ã€‚ä¸ºä»€ä¹ˆä¸æä¾›ä¸€ä¸ªä»£ç ç‰‡æ®µæ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œè¿™æ ·ä»–ä»¬å°±ä¸å¿…å°†æ¯ä¸€ä¸ªåå…­è¿›åˆ¶é¢œè‰²ä»£ç ä»è°ƒè‰²æ¿ä¸­å¤åˆ¶ç²˜è´´åˆ°ä»–ä»¬çš„ç¼–ç ç¯å¢ƒä¸­ã€‚

![](img/a5da3376d560c68a39cdbae2260d0f7b.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›

æ„Ÿè°¢ Streamlit çš„ `st.code()` æ§ä»¶ï¼Œå¯ä»¥ä¸€é”®å¤åˆ¶æ•´ä¸ªä»£ç å—ï¼

# æ€»ç»“

å°±è¿™æ ·ï¼ç°åœ¨ä½ æœ‰äº†ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„è°ƒè‰²æ¿æ¨æ–­åº”ç”¨ï¼Œå¯ä»¥å¸®åŠ©ä½ å¼„æ¸…æ¥šåˆ—å¥¥çº³å¤šÂ·è¾¾Â·èŠ¬å¥‡æ˜¯ç”¨ä»€ä¹ˆé¢œè‰²è®©è’™å¨œä¸½èçš„è„¸ä¸Šå¸¦ä¸Šå¾®ç¬‘çš„ï¼

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¾ˆå¤š Streamlit çš„åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯åƒ `st.image`ã€`st.tabs`ã€`st.file_uploader` å’Œ `st.color_picker` è¿™æ ·çš„æ§ä»¶ã€‚ä¸è¿‡ä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘ä»¬æ²¡æœ‰æ¶µç›–æ‰€æœ‰å†…å®¹ï¼Œæ‰€ä»¥è¯·éšæ—¶è·³è½¬åˆ° [æºä»£ç ](https://github.com/syasini/sophisticated_palette) ä»“åº“ï¼Œè‡ªå·±æŸ¥çœ‹æ‰€æœ‰ç»†èŠ‚ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨å¤šä¸ªåº”ç”¨è¿è¡Œé—´ä¿æŒä¸€è‡´æ€§æ—¶ï¼Œä¾èµ–äº†å¤§é‡çš„ `st.session_state`ã€‚

æˆ‘ä»¬å­¦ä¼šäº†

+   æ„å»ºä¸€ä¸ªå›¾åƒåŠ è½½ç»„ä»¶ï¼ˆåŠ è½½ç°æœ‰å›¾åƒã€ä¸Šä¼ æˆ– URL ä¸‹è½½ï¼‰ã€‚

+   æ„å»ºä¸€ä¸ªå¸¦æ»‘å—çš„å›¾åƒå¢å¼ºç»„ä»¶ã€‚

+   ä½¿ç”¨ K-means å°†åƒç´ èšç±»ï¼Œå¹¶ä½¿ç”¨ç»„å¹³å‡å€¼æ¥æ„å»ºè°ƒè‰²æ¿ã€‚

+   ä½¿ç”¨é¢œè‰²é€‰æ‹©å™¨å°éƒ¨ä»¶å°†è°ƒè‰²æ¿è¿”å›ç»™æœ€ç»ˆç”¨æˆ·ã€‚

æˆ‘å¾ˆé«˜å…´èƒ½å¸¦ä½ èµ°è¿‡æ‰€æœ‰è¿™äº›æ­¥éª¤ï¼Œå¸Œæœ›ä½ å–œæ¬¢é˜…è¯»/æµè§ˆè¿™ç¯‡æ–‡ç« ï¼Œå¹¶å¸Œæœ›ä½ å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ã€‚

ä½ å¯ä»¥äº²è‡ªæŸ¥çœ‹è¿™ä¸ªåº”ç”¨ï¼Œ[è¿™é‡Œ](https://sophisticated-palette.streamlit.app/)ã€‚æˆ‘å¾ˆæƒ³å¬å¬ä½ çš„æƒ³æ³•ã€é—®é¢˜ã€è¯„è®ºå’Œåé¦ˆï¼é€šè¿‡[LinkedIn](https://www.linkedin.com/in/siavash-yasini/)æˆ–æˆ‘çš„[ç½‘ç«™](https://www.siavashyasini.com/)ä¸æˆ‘è”ç³»ã€‚

*è¿™ç¯‡æ–‡ç« ä¸* [*Ksenia Anske*](https://www.linkedin.com/in/kseniaanske/) *åŠå›¢é˜Ÿ* [*Streamlit*](https://streamlit.io/) *åœ¨* [*Snowflake*](https://www.snowflake.com/en/) *çš„åˆä½œä¸‹ç¼–å†™ã€‚è¯·æŸ¥çœ‹è¿™ç¯‡æ–‡ç« åœ¨ Streamlit åšå®¢ä¸Šå‘å¸ƒçš„æœ€ç»ˆç‰ˆæœ¬* [*è¿™é‡Œ*](https://blog.streamlit.io/create-a-color-palette-from-any-image/)*ã€‚*

*é™¤éå¦æœ‰è¯´æ˜ï¼Œæ‰€æœ‰å›¾ç‰‡å‡ç”±ä½œè€…æä¾›ã€‚*
