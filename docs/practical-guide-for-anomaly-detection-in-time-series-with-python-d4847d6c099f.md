# ä½¿ç”¨ Python è¿›è¡Œæ—¶é—´åºåˆ—å¼‚å¸¸æ£€æµ‹çš„å®žç”¨æŒ‡å—

> åŽŸæ–‡ï¼š[`towardsdatascience.com/practical-guide-for-anomaly-detection-in-time-series-with-python-d4847d6c099f`](https://towardsdatascience.com/practical-guide-for-anomaly-detection-in-time-series-with-python-d4847d6c099f)

## ä¸€ç¯‡å…³äºŽä½¿ç”¨ Python å’Œ sklearn æ£€æµ‹æ—¶é—´åºåˆ—æ•°æ®å¼‚å¸¸å€¼çš„å®žè·µæ–‡ç« 

[](https://medium.com/@marcopeixeiro?source=post_page-----d4847d6c099f--------------------------------)![Marco Peixeiro](https://medium.com/@marcopeixeiro?source=post_page-----d4847d6c099f--------------------------------)[](https://towardsdatascience.com/?source=post_page-----d4847d6c099f--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----d4847d6c099f--------------------------------) [Marco Peixeiro](https://medium.com/@marcopeixeiro?source=post_page-----d4847d6c099f--------------------------------)

Â·å‘è¡¨äºŽ [Towards Data Science](https://towardsdatascience.com/?source=post_page-----d4847d6c099f--------------------------------) Â·é˜…è¯»æ—¶é•¿ 13 åˆ†é’ŸÂ·2023 å¹´ 3 æœˆ 16 æ—¥

--

![](img/4b3f1bd78c54730bd401ce05e9b15b28.png)

å›¾ç‰‡ç”± [Will Myers](https://unsplash.com/@will_myers?utm_source=medium&utm_medium=referral) æä¾›ï¼Œæ¥æºäºŽ [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

å¼‚å¸¸æ£€æµ‹æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›è¯†åˆ«å‡ºæ˜Žæ˜¾åç¦»æ•°æ®å¤§å¤šæ•°éƒ¨åˆ†çš„ç¨€æœ‰äº‹ä»¶ã€‚

æ—¶é—´åºåˆ—ä¸­çš„å¼‚å¸¸æ£€æµ‹æœ‰å¹¿æ³›çš„å®žé™…åº”ç”¨ï¼Œä»Žåˆ¶é€ ä¸šåˆ°åŒ»ç–—ä¿å¥ã€‚å¼‚å¸¸å€¼è¡¨ç¤ºæ„å¤–äº‹ä»¶ï¼Œå®ƒä»¬å¯èƒ½ç”±ç”Ÿäº§æ•…éšœæˆ–ç³»ç»Ÿç¼ºé™·å¼•èµ·ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæˆ‘ä»¬ç›‘æŽ§ä¸€ä¸ªç½‘ç«™çš„è®¿å®¢æ•°é‡ï¼Œæ•°é‡é™åˆ° 0ï¼Œå¯èƒ½æ„å‘³ç€æœåŠ¡å™¨å‡ºçŽ°æ•…éšœã€‚

åœ¨è¿›è¡Œé¢„æµ‹å»ºæ¨¡ä¹‹å‰ï¼Œæ£€æµ‹æ—¶é—´åºåˆ—æ•°æ®ä¸­çš„å¼‚å¸¸å€¼ä¹Ÿå¾ˆæœ‰ç”¨ã€‚è®¸å¤šé¢„æµ‹æ¨¡åž‹æ˜¯è‡ªå›žå½’çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¼šè€ƒè™‘è¿‡åŽ»çš„å€¼æ¥è¿›è¡Œé¢„æµ‹ã€‚è¿‡åŽ»çš„å¼‚å¸¸å€¼è‚¯å®šä¼šå½±å“æ¨¡åž‹ï¼Œå› æ­¤åŽ»é™¤è¿™äº›å¼‚å¸¸å€¼å¯èƒ½æ˜¯ä¸€ä¸ªå¥½çš„ä¸»æ„ï¼Œä»¥èŽ·å¾—æ›´åˆç†çš„é¢„æµ‹ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸‰ç§ä¸åŒçš„å¼‚å¸¸æ£€æµ‹æŠ€æœ¯ï¼Œå¹¶åœ¨ Python ä¸­å®žçŽ°å®ƒä»¬ã€‚

1.  å¹³å‡ç»å¯¹åå·®ï¼ˆMADï¼‰

1.  éš”ç¦»æ£®æž—

1.  å±€éƒ¨ç¦»ç¾¤å› å­ï¼ˆLOFï¼‰

ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯åŸºçº¿æ–¹æ³•ï¼Œå¦‚æžœç³»åˆ—æ»¡è¶³æŸäº›å‡è®¾ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°å·¥ä½œã€‚å…¶ä»–ä¸¤ç§æ–¹æ³•æ˜¯æœºå™¨å­¦ä¹ æ–¹æ³•ã€‚

> ***ä½¿ç”¨æˆ‘çš„*** [***å…è´¹æ—¶é—´åºåˆ—å¤‡å¿˜å•***](https://www.datasciencewithmarco.com/pl/2147608294) ***å­¦ä¹ æœ€æ–°çš„æ—¶é—´åºåˆ—åˆ†æžæŠ€æœ¯ï¼èŽ·å–ç»Ÿè®¡å­¦å’Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„å®žçŽ°ï¼Œå…¨éƒ¨ä½¿ç”¨ Python å’Œ TensorFlowï¼***

è®©æˆ‘ä»¬å¼€å§‹å§ï¼

# æ—¶é—´åºåˆ—ä¸­çš„å¼‚å¸¸æ£€æµ‹ä»»åŠ¡ç±»åž‹

æ—¶é—´åºåˆ—æ•°æ®ä¸­çš„å¼‚å¸¸æ£€æµ‹ä»»åŠ¡ä¸»è¦æœ‰ä¸¤ç§ç±»åž‹ï¼š

+   åŸºäºŽç‚¹çš„å¼‚å¸¸æ£€æµ‹

+   åŸºäºŽæ¨¡å¼çš„å¼‚å¸¸æ£€æµ‹

åœ¨ç¬¬ä¸€ç§ç±»åž‹ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°è¢«è®¤ä¸ºå¼‚å¸¸çš„å•ä¸ªæ—¶é—´ç‚¹ã€‚ä¾‹å¦‚ï¼Œä¸€æ¬¡æ¬ºè¯ˆäº¤æ˜“å°±æ˜¯ä¸€ä¸ªç‚¹çŠ¶å¼‚å¸¸ã€‚

ç¬¬äºŒç§ç±»åž‹å…³æ³¨äºŽå¯»æ‰¾ä½œä¸ºç¦»ç¾¤ç‚¹çš„å­åºåˆ—ã€‚ä¸€ä¸ªä¾‹å­å¯èƒ½æ˜¯ä¸€ä¸ªè‚¡ç¥¨åœ¨è®¸å¤šå°æ—¶æˆ–å‡ å¤©å†…ä»¥å¼‚å¸¸æ°´å¹³äº¤æ˜“ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åªå…³æ³¨åŸºäºŽç‚¹çš„å¼‚å¸¸æ£€æµ‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬çš„ç¦»ç¾¤ç‚¹æ˜¯åœ¨æ—¶é—´ä¸Šçš„å­¤ç«‹ç‚¹ã€‚

# åœºæ™¯ï¼šAWS äº‘ä¸Šçš„ CPU åˆ©ç”¨çŽ‡

æˆ‘ä»¬åœ¨ä¸€ä¸ªç›‘æŽ§ AWS äº‘ä¸­ EC2 å®žä¾‹ CPU åˆ©ç”¨çŽ‡çš„æ•°æ®é›†ä¸Šåº”ç”¨ä¸åŒçš„å¼‚å¸¸æ£€æµ‹æŠ€æœ¯ã€‚è¿™æ˜¯å®žé™…æ•°æ®ï¼Œæ¯ 5 åˆ†é’Ÿè®°å½•ä¸€æ¬¡ï¼Œä»Ž 2014 å¹´ 2 æœˆ 14 æ—¥ 14:30 å¼€å§‹ã€‚æ•°æ®é›†åŒ…å« 4032 ä¸ªæ•°æ®ç‚¹ã€‚å®ƒé€šè¿‡[Numenta Anomaly Benchmark (NAB)](https://github.com/numenta/NAB)åœ¨ AGPL-3.0 è®¸å¯è¯ä¸‹æä¾›ã€‚

æœ¬æ–‡æ‰€ç”¨çš„ç‰¹å®šæ•°æ®é›†å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/numenta/NAB/blob/master/data/realAWSCloudwatch/ec2_cpu_utilization_24ae8d.csv)æ‰¾åˆ°ï¼Œç›¸å…³æ ‡ç­¾åœ¨[è¿™é‡Œ](https://github.com/numenta/NAB/blob/master/labels/combined_labels.json)ã€‚å®Œæ•´æºä»£ç å¯åœ¨[GitHub](https://github.com/marcopeix/datasciencewithmarco/blob/master/time_series_anomaly_detection.ipynb)ä¸Šæ‰¾åˆ°ã€‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ ¼å¼åŒ–æ•°æ®ï¼Œä»¥ä¾¿å°†æ¯ä¸ªå€¼æ ‡è®°ä¸ºç¦»ç¾¤ç‚¹æˆ–å†…ç‚¹ã€‚

```py
df = pd.read_csv('data/ec2_cpu_utilization.csv')

# The labels are listed in the NAB repository for each dataset
anomalies_timestamp = [
        "2014-02-26 22:05:00",
        "2014-02-27 17:15:00"
    ]

# Ensure the timestamp column is an actual timestamp
df['timestamp'] = pd.to_datetime(df['timestamp'])
```

çŽ°åœ¨ï¼Œç¦»ç¾¤ç‚¹è¢«æ ‡è®°ä¸º-1ï¼Œè€Œå†…ç‚¹è¢«æ ‡è®°ä¸º 1ã€‚è¿™ä¸Ž scikit-learn ä¸­çš„å¼‚å¸¸æ£€æµ‹ç®—æ³•è¾“å‡ºä¸€è‡´ã€‚

```py
df['is_anomaly'] = 1

for each in anomalies_timestamp:
    df.loc[df['timestamp'] == each, 'is_anomaly'] = -1
```

![](img/48b39a86bf1504a0c73dd2b1e7226575.png)

æ ¼å¼åŒ–çš„æ•°æ®åŒ…æ‹¬æ—¶é—´æˆ³ã€å€¼å’Œæ ‡ç­¾ï¼Œä»¥ç¡®å®šå…¶æ˜¯å¦ä¸ºç¦»ç¾¤ç‚¹ï¼ˆ-1ï¼‰æˆ–å†…ç‚¹ï¼ˆ1ï¼‰ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªæ ¼å¼æ­£ç¡®çš„æ•°æ®é›†ï¼ŒåŒ…æ‹¬æ—¶é—´æˆ³ã€å€¼å’Œæ ‡ç­¾ï¼Œä»¥æŒ‡ç¤ºå€¼æ˜¯å¦ä¸ºç¦»ç¾¤ç‚¹ï¼ˆ-1ï¼‰æˆ–å†…ç‚¹ï¼ˆ1ï¼‰ã€‚

çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬ç»˜åˆ¶æ•°æ®ä»¥å¯è§†åŒ–å¼‚å¸¸ã€‚

```py
anomaly_df = df.loc[df['is_anomaly'] == -1]
inlier_df = df.loc[df['is_anomaly'] == 1]

fig, ax = plt.subplots()

ax.scatter(inlier_df.index, inlier_df['value'], color='blue', s=3, label='Inlier')
ax.scatter(anomaly_df.index, anomaly_df['value'], color='red', label='Anomaly')
ax.set_xlabel('Time')
ax.set_ylabel('CPU usage')
ax.legend(loc=2)

fig.autofmt_xdate()
plt.tight_layout()
```

![](img/8803146e1e998c3319afffb1cf83ca5d.png)

ç›‘æŽ§ EC2 å®žä¾‹ä¸Šçš„ CPU ä½¿ç”¨æƒ…å†µã€‚ä¸¤ä¸ªçº¢ç‚¹è¡¨ç¤ºå¼‚å¸¸ç‚¹ï¼Œè€Œå…¶ä»–è“ç‚¹è¢«è®¤ä¸ºæ˜¯æ­£å¸¸çš„ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

ä»Žä¸Šé¢çš„å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ•°æ®ä»…åŒ…å«ä¸¤ä¸ªç¦»ç¾¤ç‚¹ï¼Œå¦‚çº¢è‰²ç‚¹æ‰€ç¤ºã€‚

è¿™æ˜¾ç¤ºäº†å¼‚å¸¸æ£€æµ‹çš„æŒ‘æˆ˜æ€§ï¼ç”±äºŽè¿™äº›äº‹ä»¶å¾ˆå°‘ï¼Œæˆ‘ä»¬å¾ˆå°‘æœ‰æœºä¼šä»Žä¸­å­¦ä¹ ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ 2 ä¸ªç‚¹æ˜¯ç¦»ç¾¤ç‚¹ï¼Œå æ•°æ®çš„ 0.05%ã€‚è¿™ä¹Ÿä½¿å¾—æ¨¡åž‹è¯„ä¼°æ›´å…·æŒ‘æˆ˜æ€§ã€‚ä¸€ä¸ªæ–¹æ³•åŸºæœ¬ä¸Šåªæœ‰ä¸¤æ¬¡æ­£ç¡®çš„æœºä¼šï¼Œè€Œæœ‰ 4030 æ¬¡é”™è¯¯çš„æœºä¼šã€‚

é‰´äºŽä»¥ä¸Šæ‰€æœ‰å†…å®¹ï¼Œè®©æˆ‘ä»¬åº”ç”¨ä¸€äº›æ—¶é—´åºåˆ—å¼‚å¸¸æ£€æµ‹æŠ€æœ¯ï¼Œä»Žå¹³å‡ç»å¯¹åå·®å¼€å§‹ã€‚

# å¹³å‡ç»å¯¹åå·®ï¼ˆMADï¼‰

å¦‚æžœæˆ‘ä»¬çš„æ•°æ®æ˜¯æ­£æ€åˆ†å¸ƒçš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆç†åœ°è¯´ï¼Œå°¾éƒ¨çš„æ¯ä¸ªæ•°æ®ç‚¹éƒ½å¯ä»¥è¢«è§†ä¸ºç¦»ç¾¤ç‚¹ã€‚

ä¸ºäº†è¯†åˆ«å®ƒä»¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Z åˆ†æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªä»¥æ ‡å‡†å·®ä¸ºå•ä½çš„å‡å€¼æµ‹é‡ã€‚å¦‚æžœ Z åˆ†æ•°ä¸º 0ï¼Œåˆ™å€¼ç­‰äºŽå‡å€¼ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬è®¾ç½® Z åˆ†æ•°é˜ˆå€¼ä¸º 3 æˆ– 3.5ï¼Œä»¥æŒ‡ç¤ºä¸€ä¸ªå€¼æ˜¯å¦æ˜¯å¼‚å¸¸å€¼ã€‚

çŽ°åœ¨ï¼Œå›žæƒ³ä¸€ä¸‹ Z åˆ†æ•°çš„è®¡ç®—æ–¹æ³•ã€‚

![](img/87d492189d18a7d3083679f6d2eeeed6.png)

Z åˆ†æ•°çš„å…¬å¼ã€‚ä½œè€…æä¾›çš„å›¾åƒã€‚

å…¶ä¸­ *mu* æ˜¯æ ·æœ¬çš„å‡å€¼ï¼Œ*sigma* æ˜¯æ ‡å‡†å·®ã€‚åŸºæœ¬ä¸Šï¼Œå¦‚æžœ Z åˆ†æ•°å¾ˆå¤§ï¼Œæ„å‘³ç€è¯¥å€¼è¿œç¦»å‡å€¼ï¼ŒæŽ¥è¿‘åˆ†å¸ƒå°¾éƒ¨çš„ä¸€ç«¯ï¼Œè¿™ä¹Ÿå¯èƒ½è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå¼‚å¸¸å€¼ã€‚

![](img/de982122e3febefb67266f9215c7f351.png)

å¸¦æœ‰ Z åˆ†æ•°çš„æ­£æ€åˆ†å¸ƒã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“ Z åˆ†æ•°ä¸º 3 æ—¶ï¼Œæˆ‘ä»¬è¾¾åˆ°äº†åˆ†å¸ƒçš„å°¾éƒ¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¯´ï¼Œè¶…è¿‡è¯¥é˜ˆå€¼çš„æ•°æ®æ˜¯å¼‚å¸¸å€¼ã€‚ä½œè€…æä¾›çš„å›¾åƒã€‚

ä»Žä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°ç»å…¸çš„ Z åˆ†æ•°é˜ˆå€¼ 3ï¼Œç”¨äºŽç¡®å®šä¸€ä¸ªå€¼æ˜¯å¦æ˜¯å¼‚å¸¸å€¼ã€‚å¦‚é»‘è‰²è™šçº¿æ‰€ç¤ºï¼ŒZ åˆ†æ•°ä¸º 3 æ—¶ï¼Œæˆ‘ä»¬è¾¾åˆ°äº†æ­£æ€åˆ†å¸ƒçš„å°¾éƒ¨ã€‚å› æ­¤ï¼Œä»»ä½• Z åˆ†æ•°å¤§äºŽ 3ï¼ˆæˆ–å°äºŽ -3ï¼Œå¦‚æžœæˆ‘ä»¬ä¸å¤„ç†ç»å¯¹å€¼çš„è¯ï¼‰éƒ½å¯ä»¥æ ‡è®°ä¸ºå¼‚å¸¸å€¼ã€‚

çŽ°åœ¨ï¼Œè¿™åœ¨æˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªå®Œå…¨æ­£æ€åˆ†å¸ƒçš„æƒ…å†µä¸‹æ•ˆæžœå¾ˆå¥½ï¼Œä½†å¼‚å¸¸å€¼çš„å­˜åœ¨å¿…ç„¶ä¼šå½±å“å‡å€¼ï¼Œä»Žè€Œå½±å“ Z åˆ†æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æ³¨æ„åŠ›è½¬å‘ä¸­ä½ç»å¯¹åå·®æˆ– MADã€‚

## å¼ºå¥ Z åˆ†æ•°æ–¹æ³•

ä¸ºäº†é¿å…å¼‚å¸¸å€¼å¯¹ Z åˆ†æ•°çš„å½±å“ï¼Œæ”¹ç”¨ä¸­ä½æ•°ï¼Œè¿™åœ¨å­˜åœ¨å¼‚å¸¸å€¼æ—¶æ˜¯æ›´å¼ºå¥çš„æŒ‡æ ‡ã€‚

ä¸­ä½ç»å¯¹åå·®æˆ– MAD å®šä¹‰ä¸ºï¼š

![](img/7d608cd3d231b2bdc8fe5375a6663d86.png)

MAD æ˜¯å€¼ä¸Žæ ·æœ¬ä¸­ä½æ•°ä¹‹é—´ç»å¯¹å·®å€¼çš„ä¸­ä½æ•°ã€‚ä½œè€…æä¾›çš„å›¾åƒã€‚

åŸºæœ¬ä¸Šï¼ŒMAD æ˜¯æ ·æœ¬å€¼ä¸Žæ ·æœ¬ä¸­ä½æ•°ä¹‹é—´ç»å¯¹å·®å€¼çš„ä¸­ä½æ•°ã€‚ç„¶åŽï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼è®¡ç®—å¼ºå¥ Z åˆ†æ•°ï¼š

![](img/484d48fce120d5619883d7d44cc8958f.png)

å¼ºå¥ Z åˆ†æ•°å…¬å¼ã€‚è¯·æ³¨æ„ï¼Œ0.6745 æ˜¯ MAD æ”¶æ•›çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ç¬¬ 75 ä¸ªç™¾åˆ†ä½æ•°ã€‚ä½œè€…æä¾›çš„å›¾åƒã€‚

åœ¨è¿™é‡Œï¼Œå¼ºå¥ Z åˆ†æ•°è®¡ç®—æ–¹æ³•æ˜¯ï¼šå–å€¼ä¸Žæ ·æœ¬ä¸­ä½æ•°ä¹‹é—´çš„å·®å€¼ï¼Œä¹˜ä»¥ 0.6745ï¼Œç„¶åŽé™¤ä»¥ MADã€‚è¯·æ³¨æ„ï¼Œ0.6745 ä»£è¡¨æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ç¬¬ 75 ä¸ªç™¾åˆ†ä½æ•°ã€‚

## **ä¸ºä»€ä¹ˆæ˜¯ 0.6745ï¼Ÿï¼ˆå¯é€‰é˜…è¯»ï¼‰**

ä¸Žä¼ ç»Ÿçš„ Z åˆ†æ•°ä¸åŒï¼Œå¼ºå¥ Z åˆ†æ•°ä½¿ç”¨ä¸­ä½ç»å¯¹åå·®ï¼Œè¿™é€šå¸¸å°äºŽæ ‡å‡†å·®ã€‚å› æ­¤ï¼Œä¸ºäº†èŽ·å¾—ç±»ä¼¼ Z åˆ†æ•°çš„å€¼ï¼Œæˆ‘ä»¬å¿…é¡»è¿›è¡Œç¼©æ”¾ã€‚

åœ¨æ²¡æœ‰å¼‚å¸¸å€¼çš„æ­£æ€åˆ†å¸ƒä¸­ï¼ŒMAD å¤§çº¦æ˜¯æ ‡å‡†å·®çš„ 2/3ï¼ˆç²¾ç¡®æ¥è¯´æ˜¯ 0.6745ï¼‰ã€‚å› æ­¤ï¼Œç”±äºŽæˆ‘ä»¬æ˜¯é™¤ä»¥ MADï¼Œæˆ‘ä»¬ä¹˜ä»¥ 0.6745 ä»¥å›žåˆ°æ­£æ€ Z åˆ†æ•°çš„å°ºåº¦ã€‚

ç¨³å¥ Z åˆ†æ•°æ–¹æ³•åœ¨ä¸¤ä¸ªé‡è¦å‡è®¾ä¸‹æ•ˆæžœæœ€ä½³ï¼š

1.  æ•°æ®æŽ¥è¿‘æ­£æ€åˆ†å¸ƒ

1.  MAD ä¸ç­‰äºŽ 0ï¼ˆå½“è¶…è¿‡ 50%çš„æ•°æ®å…·æœ‰ç›¸åŒå€¼æ—¶ä¼šå‘ç”Ÿï¼‰

ç¬¬äºŒç‚¹å¾ˆæœ‰è¶£ï¼Œå› ä¸ºå¦‚æžœæ˜¯è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆä»»ä½•ä¸ç­‰äºŽä¸­ä½æ•°çš„å€¼éƒ½ä¼šè¢«æ ‡è®°ä¸ºå¼‚å¸¸å€¼ï¼Œæ— è®ºé˜ˆå€¼å¦‚ä½•ï¼Œå› ä¸ºç¨³å¥ Z åˆ†æ•°å°†ä¼šéžå¸¸å¤§ã€‚

é‰´äºŽæ­¤ï¼Œè®©æˆ‘ä»¬å°†æ­¤æ–¹æ³•åº”ç”¨åˆ°æˆ‘ä»¬çš„åœºæ™¯ä¸­ã€‚

## åº”ç”¨ MAD è¿›è¡Œå¼‚å¸¸å€¼æ£€æµ‹

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥æ•°æ®çš„åˆ†å¸ƒæƒ…å†µã€‚

```py
import seaborn as sns

sns.kdeplot(df['value']);
plt.grid(False)
plt.axvline(0.134, 0, 1, c='black', ls='--')
plt.tight_layout()
```

![](img/e216f583307e317516864b7cb9e47561.png)

æˆ‘ä»¬çš„æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°æ•°æ®ä¸ç¬¦åˆæ­£æ€åˆ†å¸ƒï¼æ›´ç³Ÿçš„æ˜¯ï¼Œè®¸å¤šæ•°æ®ç‚¹æ­£å¥½è½åœ¨ä¸­ä½æ•°ï¼ˆé»‘è‰²è™šçº¿ï¼‰ä¸Šï¼Œè¿™æ„å‘³ç€ MAD è¦ä¹ˆæ˜¯ 0ï¼Œè¦ä¹ˆéžå¸¸æŽ¥è¿‘ 0ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

ä»Žä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªé—®é¢˜ã€‚é¦–å…ˆï¼Œæ•°æ®æŽ¥è¿‘æ­£æ€åˆ†å¸ƒã€‚å…¶æ¬¡ï¼Œé»‘è‰²è™šçº¿è¡¨ç¤ºæ ·æœ¬çš„ä¸­ä½æ•°ï¼Œå®ƒæ­£å¥½ä½äºŽåˆ†å¸ƒçš„å³°å€¼ä¸Šã€‚è¿™æ„å‘³ç€è®¸å¤šæ•°æ®ç‚¹ç­‰äºŽä¸­ä½æ•°ï¼Œæ„å‘³ç€æˆ‘ä»¬å¤„äºŽ MAD å¯èƒ½ä¸º 0 æˆ–éžå¸¸æŽ¥è¿‘ 0 çš„æƒ…å†µã€‚

å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç»§ç»­åº”ç”¨è¯¥æ–¹æ³•ï¼Œä»¥ä¾¿äº†è§£å¦‚ä½•ä½¿ç”¨å®ƒã€‚

ä¸‹ä¸€æ­¥æ˜¯è®¡ç®—æ ·æœ¬çš„ MAD å’Œä¸­ä½æ•°ï¼Œä»¥è®¡ç®—ç¨³å¥ Z åˆ†æ•°ã€‚*scipy*åŒ…åŒ…å«äº† MAD å…¬å¼çš„å®žçŽ°ã€‚

```py
from scipy.stats import median_abs_deviation

mad = median_abs_deviation(df['value'])
median = np.median(df['value'])
```

ç„¶åŽï¼Œæˆ‘ä»¬ç®€å•åœ°ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—ç¨³å¥ Z åˆ†æ•°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°åˆ—æ¥å­˜å‚¨åˆ†æ•°ã€‚

```py
def compute_robust_z_score(x):
    return .6745*(x-median)/mad

df['z-score'] = df['value'].apply(compute_robust_z_score)
```

æ³¨æ„ï¼Œæˆ‘ä»¬å¾—åˆ°äº† 0.002 çš„ MADï¼Œè¿™ç¡®å®žæŽ¥è¿‘ 0ï¼Œæ„å‘³ç€è¿™ä¸ªåŸºå‡†å¯èƒ½è¡¨çŽ°ä¸ä½³ã€‚

å®ŒæˆåŽï¼Œæˆ‘ä»¬å†³å®šä¸€ä¸ªé˜ˆå€¼æ¥æ ‡è®°å¼‚å¸¸å€¼ã€‚å…¸åž‹çš„é˜ˆå€¼æ˜¯ 3 æˆ– 3.5ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»»ä½•ç¨³å¥ Z åˆ†æ•°å¤§äºŽ 3.5ï¼ˆå³å°¾ï¼‰æˆ–å°äºŽ-3.5ï¼ˆå·¦å°¾ï¼‰çš„å€¼å°†è¢«æ ‡è®°ä¸ºå¼‚å¸¸å€¼ã€‚

```py
df['baseline'] = 1

df.loc[df['z-score'] >= 3.5, 'baseline'] = -1 # Right-end tail
df.loc[df['z-score'] <=-3.5, 'baseline'] = -1 # Left-hand tail
```

æœ€åŽï¼Œæˆ‘ä»¬å¯ä»¥ç»˜åˆ¶æ··æ·†çŸ©é˜µï¼Œçœ‹çœ‹æˆ‘ä»¬çš„åŸºå‡†æ˜¯å¦æ­£ç¡®è¯†åˆ«äº†å¼‚å¸¸å€¼å’Œæ­£å¸¸å€¼ã€‚

```py
from sklearn.metrics import confusion_matrix, ConfusionMatrixDisplay

cm = confusion_matrix(df['is_anomaly'], df['baseline'], labels=[1, -1])

disp_cm = ConfusionMatrixDisplay(cm, display_labels=[1, -1])

disp_cm.plot();

plt.grid(False)
plt.tight_layout()
```

![](img/d6bffc49f5cd8ef27ecc24323f0be5d1.png)

åŸºå‡†å¼‚å¸¸å€¼æ£€æµ‹æ–¹æ³•çš„æ··æ·†çŸ©é˜µã€‚æ˜¾ç„¶ï¼Œè®¸å¤šæ­£å¸¸å€¼è¢«æ ‡è®°ä¸ºå¼‚å¸¸å€¼ï¼Œè¿™åœ¨é¢„æœŸä¹‹ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®æ²¡æœ‰ç¬¦åˆ MAD æ–¹æ³•çš„å‡è®¾ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

æ¯«ä¸æ„å¤–åœ°ï¼Œæˆ‘ä»¬çœ‹åˆ°åŸºå‡†æ–¹æ³•è¡¨çŽ°ä¸ä½³ï¼Œå› ä¸º 1066 ä¸ªæ­£å¸¸å€¼è¢«æ ‡è®°ä¸ºå¼‚å¸¸å€¼ã€‚è¿™å†æ¬¡æ˜¯é¢„æœŸä¸­çš„æƒ…å†µï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®æ²¡æœ‰ç¬¦åˆè¯¥æ–¹æ³•çš„å‡è®¾ï¼Œä¸” MAD éžå¸¸æŽ¥è¿‘ 0ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘è¿˜æ˜¯æƒ³ä»‹ç»è¿™ç§æ–¹æ³•çš„å®žçŽ°ï¼Œä»¥é˜²åœ¨å…¶ä»–åœºæ™¯ä¸­å¯¹ä½ æœ‰ç”¨ã€‚

å°½ç®¡ç»“æžœä»¤äººå¤±æœ›ï¼Œä½†å½“å‡è®¾å¯¹ä½ çš„æ•°æ®é›†æˆç«‹æ—¶ï¼Œè¿™ç§æ–¹æ³•ä»ç„¶æœ‰æ•ˆï¼ŒçŽ°åœ¨ä½ çŸ¥é“åœ¨æœ‰æ„ä¹‰çš„æƒ…å†µä¸‹å¦‚ä½•åº”ç”¨å®ƒã€‚

çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬è½¬åˆ°æœºå™¨å­¦ä¹ æ–¹æ³•ï¼Œé¦–å…ˆä»Žéš”ç¦»æ£®æž—å¼€å§‹ã€‚

# éš”ç¦»æ£®æž—

å­¤ç«‹æ£®æž—ç®—æ³•æ˜¯ä¸€ç§åŸºäºŽæ ‘çš„ç®—æ³•ï¼Œé€šå¸¸ç”¨äºŽå¼‚å¸¸æ£€æµ‹ã€‚

ç®—æ³•é¦–å…ˆéšæœºé€‰æ‹©ä¸€ä¸ªå±žæ€§ï¼Œå¹¶åœ¨è¯¥å±žæ€§çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ä¹‹é—´éšæœºé€‰æ‹©ä¸€ä¸ªåˆ†è£‚å€¼ã€‚è¿™ä¸ªåˆ†åŒºè¿‡ç¨‹ä¼šé‡å¤å¤šæ¬¡ï¼Œç›´åˆ°ç®—æ³•éš”ç¦»äº†æ•°æ®é›†ä¸­çš„æ¯ä¸ªç‚¹ã€‚

ç„¶åŽï¼Œè¿™ä¸ªç®—æ³•çš„ç›´è§‰æ˜¯ï¼Œç¦»ç¾¤ç‚¹éš”ç¦»æ‰€éœ€çš„åˆ†åŒºä¼šæ¯”æ­£å¸¸ç‚¹å°‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](img/27a7c0261401deb2477d19830352ec9b.png)

éš”ç¦»ä¸€ä¸ªå†…ç‚¹ã€‚æ³¨æ„åœ¨ç‚¹è¢«éš”ç¦»ä¹‹å‰ï¼Œæ•°æ®å¿…é¡»ç»è¿‡å¤šæ¬¡åˆ†åŒºã€‚å›¾åƒç”± Sai Borrelli æä¾› â€” [ç»´åŸºç™¾ç§‘](https://commons.wikimedia.org/w/index.php?curid=82709489)

![](img/d456164b1a2801e575d9499036d1997f.png)

éš”ç¦»ä¸€ä¸ªç¦»ç¾¤ç‚¹ã€‚çŽ°åœ¨ï¼Œæˆ‘ä»¬çœ‹åˆ°éš”ç¦»å®ƒæ‰€éœ€çš„åˆ†åŒºè¾ƒå°‘ã€‚å› æ­¤ï¼Œå®ƒå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªå¼‚å¸¸å€¼ã€‚å›¾åƒç”± Sai Borrelli æä¾› â€” [ç»´åŸºç™¾ç§‘](https://commons.wikimedia.org/w/index.php?curid=82709491)

åœ¨ä¸Šé¢çš„ä¸¤ä¸ªå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨éš”ç¦»å†…ç‚¹å’Œç¦»ç¾¤ç‚¹æ—¶ï¼Œåˆ†åŒºçš„æ•°é‡å¦‚ä½•ä¸åŒã€‚åœ¨é¡¶éƒ¨å›¾ä¸­ï¼Œéš”ç¦»ä¸€ä¸ªå†…ç‚¹éœ€è¦å¾ˆå¤šåˆ†è£‚ã€‚åœ¨åº•éƒ¨å›¾ä¸­ï¼Œéš”ç¦»ç‚¹æ‰€éœ€çš„åˆ†è£‚è¾ƒå°‘ã€‚å› æ­¤ï¼Œå®ƒå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªå¼‚å¸¸å€¼ã€‚

æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°åœ¨å­¤ç«‹æ£®æž—ä¸­ï¼Œå¦‚æžœéš”ç¦»æ•°æ®ç‚¹çš„è·¯å¾„å¾ˆçŸ­ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå¼‚å¸¸å€¼ï¼

## åº”ç”¨å­¤ç«‹æ£®æž—

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°†æ•°æ®åˆ†æˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥è¯„ä¼°æ¨¡åž‹æ˜¯å¦èƒ½å¤Ÿåœ¨æœªè§æ•°æ®ä¸Šæ ‡è®°å¼‚å¸¸å€¼ã€‚è¿™æœ‰æ—¶è¢«ç§°ä¸ºæ–°é¢–æ€§æ£€æµ‹ï¼Œè€Œä¸æ˜¯å¼‚å¸¸æ£€æµ‹ã€‚

```py
train = df[:3550]
test = df[3550:]
```

ç„¶åŽï¼Œæˆ‘ä»¬å¯ä»¥è®­ç»ƒæˆ‘ä»¬çš„å­¤ç«‹æ£®æž—ç®—æ³•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šä¸€ä¸ªæ±¡æŸ“æ°´å¹³ï¼Œè¿™åªæ˜¯è®­ç»ƒæ•°æ®ä¸­ç¦»ç¾¤ç‚¹çš„æ¯”ä¾‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„è®­ç»ƒé›†åªæœ‰ä¸€ä¸ªç¦»ç¾¤ç‚¹ã€‚

```py
from sklearn.ensemble import IsolationForest

# Only one outlier in the training set
contamination = 1/len(train)

iso_forest = IsolationForest(contamination=contamination, random_state=42)

X_train = train['value'].values.reshape(-1,1)

iso_forest.fit(X_train)
```

è®­ç»ƒå®ŒæˆåŽï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆé¢„æµ‹ã€‚

```py
preds_iso_forest = iso_forest.predict(test['value'].values.reshape(-1,1))
```

å†æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥ç»˜åˆ¶æ··æ·†çŸ©é˜µä»¥æŸ¥çœ‹æ¨¡åž‹çš„è¡¨çŽ°ã€‚

```py
cm = confusion_matrix(test['is_anomaly'], preds_iso_forest, labels=[1, -1])

disp_cm = ConfusionMatrixDisplay(cm, display_labels=[1, -1])

disp_cm.plot();

plt.grid(False)
plt.tight_layout()
```

![](img/b7a0966b20d32421c0fb468077a81ee7.png)

å­¤ç«‹æ£®æž—ç®—æ³•çš„æ··æ·†çŸ©é˜µã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç®—æ³•æ²¡æœ‰æ ‡è®°ä»»ä½•å¼‚å¸¸å€¼ã€‚å®ƒè¿˜é”™è¯¯åœ°å°†ä¸€ä¸ªå¼‚å¸¸å€¼æ ‡è®°ä¸ºæ­£å¸¸ç‚¹ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

ä»Žä¸Šé¢çš„å›¾ä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ç®—æ³•æ— æ³•æ ‡è®°æ–°çš„å¼‚å¸¸å€¼ã€‚å®ƒè¿˜å°†ä¸€ä¸ªå¼‚å¸¸å€¼æ ‡è®°ä¸ºæ­£å¸¸ç‚¹ã€‚

å†æ¬¡ï¼Œè¿™æ˜¯ä¸€é¡¹ä»¤äººå¤±æœ›çš„ç»“æžœï¼Œä½†æˆ‘ä»¬è¿˜æœ‰ä¸€ç§æ–¹æ³•éœ€è¦ä»‹ç»ï¼Œå³å±€éƒ¨ç¦»ç¾¤å› å­ã€‚

# å±€éƒ¨ç¦»ç¾¤å› å­

ç›´è§‚ä¸Šï¼Œå±€éƒ¨ç¦»ç¾¤å› å­ï¼ˆLOFï¼‰é€šè¿‡æ¯”è¾ƒç‚¹çš„å±€éƒ¨å¯†åº¦ä¸Žå…¶é‚»å±…çš„å±€éƒ¨å¯†åº¦æ¥å·¥ä½œã€‚å¦‚æžœç‚¹å’Œé‚»å±…çš„å¯†åº¦ç›¸ä¼¼ï¼Œé‚£ä¹ˆè¯¥ç‚¹å°±æ˜¯ä¸€ä¸ªå†…ç‚¹ã€‚ç„¶è€Œï¼Œå¦‚æžœç‚¹çš„å¯†åº¦è¿œå°äºŽé‚»å±…çš„å¯†åº¦ï¼Œé‚£ä¹ˆå®ƒä¸€å®šæ˜¯ä¸€ä¸ªç¦»ç¾¤ç‚¹ï¼Œå› ä¸ºè¾ƒä½Žçš„å¯†åº¦æ„å‘³ç€è¯¥ç‚¹æ›´å­¤ç«‹ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®è¦æŸ¥çœ‹çš„é‚»å±…æ•°é‡ï¼Œ*scikit-learn* çš„é»˜è®¤å‚æ•°æ˜¯ 20ï¼Œè¿™åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ•ˆæžœå¾ˆå¥½ã€‚

ä¸€æ—¦è®¾ç½®äº†é‚»å±…çš„æ•°é‡ï¼Œæˆ‘ä»¬å°±è®¡ç®—*å¯è¾¾è·ç¦»*ã€‚ä»…ç”¨æ–‡å­—å’Œå›¾ç‰‡è§£é‡Šè¿™æœ‰ç‚¹å¤æ‚ï¼Œä½†æˆ‘ä¼šå°½åŠ›è¯´æ˜Žã€‚

![](img/44737a3754b4972abba7ac5125c01aa0.png)

å¯è§†åŒ–å¯è¾¾è·ç¦»ï¼Œå›¾åƒç”±ä½œè€…æä¾›ã€‚

å‡è®¾æˆ‘ä»¬æ­£åœ¨ç ”ç©¶ç‚¹ Aï¼Œå¹¶ä¸”æˆ‘ä»¬å°†é‚»å±…æ•°é‡è®¾ç½®ä¸º 3ï¼ˆk=3ï¼‰ã€‚åœ¨ä¿æŒç‚¹ A åœ¨ä¸­é—´çš„æƒ…å†µä¸‹ç”»ä¸€ä¸ªåœ†åœˆï¼Œå°±ä¼šå¾—åˆ°ä½ åœ¨ä¸Šå›¾ä¸­çœ‹åˆ°çš„é»‘è‰²è™šçº¿åœ†åœˆã€‚ç‚¹ Bã€C å’Œ D æ˜¯ç¦» A æœ€è¿‘çš„ä¸‰ä¸ªé‚»å±…ï¼Œè€Œç‚¹ E åœ¨è¿™ç§æƒ…å†µä¸‹å¤ªè¿œï¼Œå› æ­¤è¢«å¿½ç•¥ã€‚

çŽ°åœ¨ï¼Œå¯è¾¾è·ç¦»è¢«å®šä¹‰ä¸ºï¼š

![](img/69369779b5f660ab492552f1d7bba59f.png)

å¯è¾¾è·ç¦»æ–¹ç¨‹ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

æ¢å¥è¯è¯´ï¼Œä»Ž A åˆ° B çš„å¯è¾¾è·ç¦»æ˜¯ B çš„ k-è·ç¦»å’Œ A åˆ° B çš„å®žé™…è·ç¦»ä¹‹é—´çš„è¾ƒå¤§å€¼ã€‚

B çš„ k-è·ç¦»åªæ˜¯ä»Žç‚¹ B åˆ°å…¶ç¬¬ä¸‰ä¸ªæœ€è¿‘é‚»çš„è·ç¦»ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä¸Šé¢çš„å›¾ä¸­ï¼Œæˆ‘ä»¬ç”»äº†ä¸€ä¸ªä»¥ B ä¸ºä¸­å¿ƒçš„è“è‰²è™šçº¿åœ†åœˆï¼Œä»¥ä½“çŽ°ä»Ž B åˆ° C çš„è·ç¦»æ˜¯ B çš„ k-è·ç¦»ã€‚

ä¸€æ—¦è®¡ç®—äº† A çš„æ‰€æœ‰ k ä¸ªæœ€è¿‘é‚»çš„å¯è¾¾è·ç¦»ï¼Œå°†è®¡ç®—å±€éƒ¨å¯è¾¾å¯†åº¦ã€‚è¿™ä»…ä»…æ˜¯å¯è¾¾è·ç¦»çš„å¹³å‡å€¼çš„å€’æ•°ã€‚

ç›´è§‚ä¸Šï¼Œå¯è¾¾å¯†åº¦å‘Šè¯‰æˆ‘ä»¬åˆ°è¾¾é‚»è¿‘ç‚¹éœ€è¦èµ°å¤šè¿œã€‚å¦‚æžœå¯†åº¦å¤§ï¼Œåˆ™ç‚¹å½¼æ­¤é è¿‘ï¼Œæˆ‘ä»¬ä¸éœ€è¦èµ°å¤ªè¿œã€‚

æœ€åŽï¼Œå±€éƒ¨å¼‚å¸¸å› å­ä»…ä»…æ˜¯å±€éƒ¨å¯è¾¾å¯†åº¦çš„æ¯”çŽ‡ã€‚åœ¨ä¸Šé¢çš„å›¾ä¸­ï¼Œæˆ‘ä»¬å°† *k* è®¾ç½®ä¸º 3ï¼Œå› æ­¤æˆ‘ä»¬ä¼šæœ‰ä¸‰ä¸ªæ¯”çŽ‡éœ€è¦è¿›è¡Œå¹³å‡ã€‚è¿™å…è®¸æˆ‘ä»¬å°†ç‚¹çš„å±€éƒ¨å¯†åº¦ä¸Žå…¶é‚»å±…è¿›è¡Œæ¯”è¾ƒã€‚

å¦‚å‰æ‰€è¿°ï¼Œå¦‚æžœè¯¥å› å­æŽ¥è¿‘ 1 æˆ–å°äºŽ 1ï¼Œåˆ™ä¸ºæ­£å¸¸ç‚¹ã€‚å¦‚æžœå¤§äºŽ 1ï¼Œåˆ™ä¸ºå¼‚å¸¸å€¼ã€‚

å½“ç„¶ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå› ä¸ºå¤§äºŽ 1 çš„å€¼å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œç¾Žçš„é˜ˆå€¼ã€‚ä¾‹å¦‚ï¼ŒLOF ä¸º 1.1 å¯èƒ½æ„å‘³ç€æŸä¸ªæ•°æ®é›†ä¸­çš„å¼‚å¸¸å€¼ï¼Œä½†å¯¹å¦ä¸€ä¸ªæ•°æ®é›†åˆ™ä¸é€‚ç”¨ã€‚

## åº”ç”¨å±€éƒ¨å¼‚å¸¸å› å­æ–¹æ³•

ä½¿ç”¨*scikit-learn*åº”ç”¨å±€éƒ¨å¼‚å¸¸å› å­æ–¹æ³•æ˜¯ç›´æŽ¥çš„ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸Žéš”ç¦»æ£®æž—ç›¸åŒçš„è®­ç»ƒ/æµ‹è¯•æ‹†åˆ†ï¼Œä»¥ä¾¿èŽ·å¾—å¯æ¯”è¾ƒçš„ç»“æžœã€‚

```py
from sklearn.neighbors import LocalOutlierFactor

lof = LocalOutlierFactor(contamination=contamination, novelty=True)

lof.fit(X_train)
```

ç„¶åŽï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆé¢„æµ‹ä»¥æ ‡è®°æµ‹è¯•é›†ä¸­çš„æ½œåœ¨å¼‚å¸¸å€¼ã€‚

```py
preds_lof = lof.predict(test['value'].values.reshape(-1,1))
```

æœ€åŽï¼Œæˆ‘ä»¬ç»˜åˆ¶æ··æ·†çŸ©é˜µæ¥è¯„ä¼°æ€§èƒ½ã€‚

```py
cm = confusion_matrix(test['is_anomaly'], preds_lof, labels=[1, -1])

disp_cm = ConfusionMatrixDisplay(cm, display_labels=[1, -1])

disp_cm.plot();
```

![](img/203bb5e4b53dfff6cab3f7fdd6761e4d.png)

å±€éƒ¨å¼‚å¸¸å› å­çš„æ··æ·†çŸ©é˜µã€‚æˆ‘ä»¬çœ‹åˆ°è¯¥ç®—æ³•æˆåŠŸè¯†åˆ«äº†æµ‹è¯•é›†ä¸­å”¯ä¸€çš„å¼‚å¸¸å€¼ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

åœ¨ä¸Šé¢çš„å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° LOF æ–¹æ³•èƒ½å¤Ÿæ ‡è®°æµ‹è¯•é›†ä¸­å”¯ä¸€çš„å¼‚å¸¸å€¼ï¼Œå¹¶ä¸”æ­£ç¡®åœ°å°†å…¶ä»–æ¯ä¸ªç‚¹æ ‡è®°ä¸ºæ­£å¸¸ç‚¹ã€‚

å’Œå¾€å¸¸ä¸€æ ·ï¼Œè¿™å¹¶ä¸æ„å‘³ç€å±€éƒ¨å¼‚å¸¸å› å­æ¯”å­¤ç«‹æ£®æž—æ–¹æ³•æ›´å¥½ã€‚è¿™åªæ˜¯è¡¨ç¤ºåœ¨è¿™ä¸ªç‰¹å®šæƒ…å†µä¸‹ï¼Œå±€éƒ¨å¼‚å¸¸å› å­æ•ˆæžœæ›´å¥½ã€‚

# ç»“è®º

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æŽ¢è®¨äº†ä¸‰ç§ä¸åŒçš„æ—¶é—´åºåˆ—æ•°æ®å¼‚å¸¸æ£€æµ‹æ–¹æ³•ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬æŽ¢è®¨äº†ä¸€ç§ä½¿ç”¨å¹³å‡ç»å¯¹åå·®ï¼ˆMADï¼‰çš„å¼ºå¥ Z-scoreã€‚è¿™åœ¨æ•°æ®å‘ˆæ­£æ€åˆ†å¸ƒä¸” MAD ä¸ä¸º 0 æ—¶æ•ˆæžœè‰¯å¥½ã€‚

ç„¶åŽï¼Œæˆ‘ä»¬çœ‹äº†å­¤ç«‹æ£®æž—æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ç§æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå®ƒç¡®å®šæ•°æ®é›†éœ€è¦å¤šå°‘æ¬¡åˆ†å‰²æ‰èƒ½å­¤ç«‹ä¸€ä¸ªç‚¹ã€‚å¦‚æžœéœ€è¦çš„åˆ†å‰²æ¬¡æ•°å¾ˆå°‘ï¼Œé‚£ä¹ˆè¿™ä¸ªç‚¹å°±æ˜¯ä¸€ä¸ªå¼‚å¸¸ç‚¹ã€‚å¦‚æžœéœ€è¦å¾ˆå¤šåˆ†å‰²ï¼Œé‚£ä¹ˆè¿™ä¸ªç‚¹å¾ˆå¯èƒ½æ˜¯å†…ç‚¹ã€‚

æœ€åŽï¼Œæˆ‘ä»¬çœ‹äº†å±€éƒ¨å¼‚å¸¸å› å­ï¼ˆLOFï¼‰æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ç§æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ï¼Œå®ƒå°†ä¸€ä¸ªç‚¹çš„å±€éƒ¨å¯†åº¦ä¸Žå…¶é‚»å±…çš„å¯†åº¦è¿›è¡Œæ¯”è¾ƒã€‚åŸºæœ¬ä¸Šï¼Œå¦‚æžœä¸€ä¸ªç‚¹çš„å¯†åº¦ç›¸å¯¹äºŽå…¶é‚»å±…è¾ƒå°ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯ä¸€ä¸ªå­¤ç«‹ç‚¹ï¼Œå¾ˆå¯èƒ½æ˜¯å¼‚å¸¸ç‚¹ã€‚

å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œå¹¶å­¦åˆ°äº†æ–°çŸ¥è¯†ï¼

æƒ³è¦æŽŒæ¡æ—¶é—´åºåˆ—é¢„æµ‹å—ï¼ŸæŸ¥çœ‹[Python ä¸­çš„åº”ç”¨æ—¶é—´åºåˆ—é¢„æµ‹](https://www.datasciencewithmarco.com/offers/zTAs2hi6/checkout?coupon_code=ATSFP10)ï¼Œè¿™æ˜¯å”¯ä¸€æ¶µç›–ç»Ÿè®¡å­¦ã€æ·±åº¦å­¦ä¹ å’Œæœ€å…ˆè¿›æ¨¡åž‹çš„ 100% Python è¯¾ç¨‹ã€‚

å¹²æ¯ ðŸ»

# æ”¯æŒæˆ‘

äº«å—æˆ‘çš„å·¥ä½œå—ï¼Ÿé€šè¿‡[è¯·æˆ‘å–å’–å•¡](http://buymeacoffee.com/dswm)æ¥æ”¯æŒæˆ‘ï¼Œè¿™æ˜¯ä¸€ç§ç®€å•çš„æ–¹å¼æ¥é¼“åŠ±æˆ‘ï¼Œè€Œæˆ‘ä¹Ÿå¯ä»¥äº«å—ä¸€æ¯å’–å•¡ï¼å¦‚æžœä½ æ„¿æ„ï¼Œç‚¹å‡»ä¸‹é¢çš„æŒ‰é’® ðŸ‘‡

![](http://buymeacoffee.com/dswm)
