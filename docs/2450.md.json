["```py\n!BUILD_CUDA_EXT=0 pip install -q auto-gptq transformers\n```", "```py\nimport random\n\nfrom auto_gptq import AutoGPTQForCausalLM, BaseQuantizeConfig\nfrom datasets import load_dataset\nimport torch\nfrom transformers import AutoTokenizer\n\n# Define base model and output directory\nmodel_id = \"gpt2\"\nout_dir = model_id + \"-GPTQ\"\n```", "```py\n# Load quantize config, model and tokenizer\nquantize_config = BaseQuantizeConfig(\n    bits=4,\n    group_size=128,\n    damp_percent=0.01,\n    desc_act=False,\n)\nmodel = AutoGPTQForCausalLM.from_pretrained(model_id, quantize_config)\ntokenizer = AutoTokenizer.from_pretrained(model_id)\n```", "```py\n# Load data and tokenize examples\nn_samples = 1024\ndata = load_dataset(\"allenai/c4\", data_files=\"en/c4-train.00001-of-01024.json.gz\", split=f\"train[:{n_samples*5}]\")\ntokenized_data = tokenizer(\"\\n\\n\".join(data['text']), return_tensors='pt')\n\n# Format tokenized examples\nexamples_ids = []\nfor _ in range(n_samples):\n    i = random.randint(0, tokenized_data.input_ids.shape[1] - tokenizer.model_max_length - 1)\n    j = i + tokenizer.model_max_length\n    input_ids = tokenized_data.input_ids[:, i:j]\n    attention_mask = torch.ones_like(input_ids)\n    examples_ids.append({'input_ids': input_ids, 'attention_mask': attention_mask})\n```", "```py\n# Quantize with GPTQ\nmodel.quantize(\n    examples_ids,\n    batch_size=1,\n    use_triton=True,\n)\n\n# Save model and tokenizer\nmodel.save_quantized(out_dir, use_safetensors=True)\ntokenizer.save_pretrained(out_dir)\n```", "```py\ndevice = \"cuda:0\" if torch.cuda.is_available() else \"cpu\"\n\n# Reload model and tokenizer\nmodel = AutoGPTQForCausalLM.from_quantized(\n    out_dir,\n    device=device,\n    use_triton=True,\n    use_safetensors=True,\n)\ntokenizer = AutoTokenizer.from_pretrained(out_dir)\n```", "```py\nfrom transformers import pipeline\n\ngenerator = pipeline('text-generation', model=model, tokenizer=tokenizer)\nresult = generator(\"I have a dream\", do_sample=True, max_length=50)[0]['generated_text']\nprint(result)\n```", "```py\nI have a dream,\" she told CNN last week. \"I have this dream of helping my mother find her own. But, to tell that for the first time, now that I'm seeing my mother now, just knowing how wonderful it is that\n```"]