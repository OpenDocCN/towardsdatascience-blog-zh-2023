- en: Customer Lifetime Value Prediction with PyMC-Marketing
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/pymc-marketing-the-key-to-advanced-clv-customer-lifetime-value-forecasting-bc0730973c0a?source=collection_archive---------1-----------------------#2023-11-10](https://towardsdatascience.com/pymc-marketing-the-key-to-advanced-clv-customer-lifetime-value-forecasting-bc0730973c0a?source=collection_archive---------1-----------------------#2023-11-10)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Explore the Depths of Buy-till-You-Die (BTYD) Modeling and Practical Coding
    Techniques
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@hajime.takeda?source=post_page-----bc0730973c0a--------------------------------)[![Hajime
    Takeda](../Images/42ffd8c9416240fa43773817e76a55fa.png)](https://medium.com/@hajime.takeda?source=post_page-----bc0730973c0a--------------------------------)[](https://towardsdatascience.com/?source=post_page-----bc0730973c0a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----bc0730973c0a--------------------------------)
    [Hajime Takeda](https://medium.com/@hajime.takeda?source=post_page-----bc0730973c0a--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6d7012b72e49&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpymc-marketing-the-key-to-advanced-clv-customer-lifetime-value-forecasting-bc0730973c0a&user=Hajime+Takeda&userId=6d7012b72e49&source=post_page-6d7012b72e49----bc0730973c0a---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----bc0730973c0a--------------------------------)
    ·15 min read·Nov 10, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbc0730973c0a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpymc-marketing-the-key-to-advanced-clv-customer-lifetime-value-forecasting-bc0730973c0a&user=Hajime+Takeda&userId=6d7012b72e49&source=-----bc0730973c0a---------------------clap_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbc0730973c0a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpymc-marketing-the-key-to-advanced-clv-customer-lifetime-value-forecasting-bc0730973c0a&source=-----bc0730973c0a---------------------bookmark_footer-----------)![](../Images/911c8fd8f93c5e4448f5294fe42fabe9.png)'
  prefs: []
  type: TYPE_NORMAL
- en: Photo by [Boxed Water Is Better](https://unsplash.com/@boxedwater?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: '**TL; DR:** The Customer Lifetime Value (CLV) model is a key technique in customer
    analytics which help companies identify who valuable customers are. Neglecting
    CLV can lead to overinvestment in short-term customers who may only make a single
    purchase. ‘Buy Till You Die’ modeling, which utilizes the BG/NBD and Gamma-Gamma
    models, can estimate CLV. Although the best practices vary depending on data size
    and modeling priorities, [PyMC-Marketing](https://github.com/pymc-labs/pymc-marketing)
    is a recommended Python library for those looking to quickly implement CLV modeling.'
  prefs: []
  type: TYPE_NORMAL
- en: For those eager to dive straight into the sample code, please refer to my [GitHub
    repository](https://github.com/takechanman1228/Effective-CLV-Modeling/blob/main/PyMC_Marketing_CLV_demo.ipynb).
    I’d be thrilled if you could leave a star!
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://github.com/takechanman1228/Effective-CLV-Modeling/tree/main?source=post_page-----bc0730973c0a--------------------------------)
    [## GitHub - takechanman1228/Effective-CLV-Modeling'
  prefs: []
  type: TYPE_NORMAL
- en: Contribute to takechanman1228/Effective-CLV-Modeling development by creating
    an account on GitHub.
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: github.com](https://github.com/takechanman1228/Effective-CLV-Modeling/tree/main?source=post_page-----bc0730973c0a--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: 1\. What is CLV?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**The definition of CLV is the total net revenue a company can expect from
    a single customer throughout their relationship.** Some of you might be more familiar
    with the term ‘LTV’ (Lifetime Value). Yes, CLV and LTV are interchangeable.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a087a3d1f6f110149bfe94b51f0a7e31.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: The first goal is to calculate and predict future CLV, which will help you find
    out how much money can be expected from each customer.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The second objective is to identify profitable customers. The model will tell
    you who those valuable customers are by analyzing the characteristics of the high
    CLV customers.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The third goal is to take marketing actions based on the analysis and from there,
    you will be able to optimize your marketing budget allocation accordingly.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](../Images/d7a027532b930fc16aecb49dc06a9865.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: 2\. Business Context
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let’s take the e-commerce site of a fashion brand like Nike, for example, which
    might use advertisements and coupons to attract new customers. Now, let’s assume
    that college students and working professionals are two major important customer
    segments. For first-time purchases, the company spends $10 on advertising for
    college students and $20 for working professionals. And both segments make purchases
    worth around $100.
  prefs: []
  type: TYPE_NORMAL
- en: If you were in charge of marketing, which segment would you want to invest more
    in? You might naturally think it’s more logical to invest more in the college
    students segment, considering their lower cost and higher ROI.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b2d5573d2b3a26a22b53a494f2efcbbe.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author, with photos used from Pixabay
  prefs: []
  type: TYPE_NORMAL
- en: So, what if you knew this information?
  prefs: []
  type: TYPE_NORMAL
- en: The college student segment tends to have a high churn rate, meaning they don’t
    purchase anymore after that one purchase, resulting in $100 being spent on average.
    On the other hand, the working professionals segment has a higher rate of repeat
    purchases, resulting in an average of $400 per customer.
  prefs: []
  type: TYPE_NORMAL
- en: In that case, you would likely prefer to invest more in the business professionals
    segment, as it promises a higher ROI. This may seem like a simple thing that anyone
    can understand. However, surprisingly, most marketing people are focused on achieving
    the Cost Per Acquisition (CPA), but they are not considering who the profitable
    customers are in the long run.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ff1f97ad3e16294afb7a08e9b97d555c.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author, with photos used from Pixabay
  prefs: []
  type: TYPE_NORMAL
- en: By adjusting the “cost per acquisition”, CPA, we can attract more high-value
    customers and improve our ROI. This graph on the left represents the approach
    without considering CLV. The red line represents CPA.’ , which is the maximum
    cost we can spend to get a new customer. Using the same marketing budget for every
    customer leads to overinvestment in low-value customers and underinvestment in
    high-value customers.
  prefs: []
  type: TYPE_NORMAL
- en: Now, the graph on the right side shows the ideal spending allocation when utilizing
    CLV. We set a higher CPA for high-value customers, and a lower CPA for low-value
    customers.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1ce5265ad118b6a8775d95eb1bd56cb7.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author, with photos used from Pixabay
  prefs: []
  type: TYPE_NORMAL
- en: It’s similar to the hiring process. If you aim to hire ex-Goolers, offering
    a competitive salary is essential, right? By doing this, we can acquire more high-value
    customers without changing the total marketing budget.
  prefs: []
  type: TYPE_NORMAL
- en: 3\. Required Data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The CLV model I’m introducing only uses sales transaction data. As you can
    see, we have threedata columns: customer_id, transaction date, and transaction
    value. In terms of data volume, CLVs typically require two to three years of transaction
    data.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e21fa6fa3331c5c080bc6f6dad3dce88.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: 4\. Traditional CLV Formula
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**4.1 Approaches for CLV Modeling**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s start by understanding the two broad types to calculate CLV: the Historical
    Approach and the Predictive Approach. Under the Predictive approach, there are
    two models. The Probabilistic Model and the Machine Learning Models.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a6ff97d19373dc0e4c83be5a02e70694.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: '**4.2 Traditional CLV Formula**'
  prefs: []
  type: TYPE_NORMAL
- en: 'First, let’s start by considering a traditional CLV formula. Here, CLV can
    be broken down into three components. : Average order value, Purchase Frequency,
    and Customer lifespan.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c53d565bec6b3c835317311da0d8e329.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s consider a fashion company for example, on average:'
  prefs: []
  type: TYPE_NORMAL
- en: Customers spend $100 per order
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: They shop 4 times per year
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: They stay loyal for 3 years
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In this case, the CLV is calculated as 100 times 4 times 3, which equals $1,200
    per customer. This Formula is very simple and looks straightforward, right? However,
    there are some limitations.
  prefs: []
  type: TYPE_NORMAL
- en: '**4.3 Limitations of Traditional CLV Formula**'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/748db88585c29f5c086b9aaaaee0899b.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: '**Limitation #1: Not All Customers Are The Same**'
  prefs: []
  type: TYPE_NORMAL
- en: This traditional formula assumes that all customers are homogenous by assigning
    one average number. When some customers make exceptionally large purchases, the
    average doesn’t represent the characteristics of all customers. Therefore, instead
    of aggregating everyone together, we need to do modeling at the individual level.
  prefs: []
  type: TYPE_NORMAL
- en: '**Limitation #2 : Differences in First Purchase Timing**'
  prefs: []
  type: TYPE_NORMAL
- en: Let’s say, we use the last 12 months as our data collection period.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/cd1e21953f9a99f1c7d44fa6d4b6ebb8.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author, with photos used from Pixabay
  prefs: []
  type: TYPE_NORMAL
- en: This man made his first purchase about a year ago. In this case, we can accurately
    calculate his purchase frequency per year. It’s 8.
  prefs: []
  type: TYPE_NORMAL
- en: How about two customers? One started purchasing 6 months ago, and the other
    began 3 months ago. Everyone has been buying at the same pace. However, when we
    look at the total number of purchases over the past year, they differ. The key
    point here is we need to consider the tenure of the customer, meaning the duration
    since they made their first purchase.
  prefs: []
  type: TYPE_NORMAL
- en: '**Limitation #3 : Dead or Alive?**'
  prefs: []
  type: TYPE_NORMAL
- en: Determining when a customer is considered “churned” is tricky. For subscription
    services like Netflix, we can consider a customer to have churned once they unsubscribe.
    However, in the case of retail or E-commerce, whether a customer is ‘Alive’ or
    ‘Dead’ is ambiguous.
  prefs: []
  type: TYPE_NORMAL
- en: A customer’s ‘Probability of Being Alive’ depends on their past purchasing patterns.
    For example, if someone who normally buys every month doesn’t make a purchase
    in the next three months, they might switch to a different brand. However, there’s
    no need to worry if a person who typically shops only once every six months doesn’t
    buy anything in the next three months.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3dba306eb464405b6803a778c9576f3a.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author, with photos used from Pixabay
  prefs: []
  type: TYPE_NORMAL
- en: 5\. **Buy-Till-You-Die (BTYD) Model**
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To address these challenges, we often turn to [‘Buy Till You Die’ (BTYD) modeling](https://en.wikipedia.org/wiki/Buy_Till_you_Die).
    This approach comprises two sub-models:'
  prefs: []
  type: TYPE_NORMAL
- en: BG-NBD model:This predicts the likelihood of a customer being active and their
    transaction frequency.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Gamma-Gamma model: This estimates the average order value.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: By combining the results from these sub-models, we can effectively forecast
    the Customer Lifetime Value (CLV).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4d74137dd9e592c1ab0a3af3c37ea317.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: '**5.1 BG/NBD model**'
  prefs: []
  type: TYPE_NORMAL
- en: 'We believe that there are two processes in the customer’s status: the ‘Purchase
    Process,’ where customers are actively buying, and the ‘Dropout Process,’ where
    customers have stopped purchasing.'
  prefs: []
  type: TYPE_NORMAL
- en: During the Active Purchasing Phase, the model forecasts the customer’s purchase
    frequency with the “Poisson process”.
  prefs: []
  type: TYPE_NORMAL
- en: There’s always a chance that a customer might drop out after each purchase.
    The BG/NBD model assigns a probability ‘p’ to this possibility.
  prefs: []
  type: TYPE_NORMAL
- en: Consider the image below for illustration. The data indicates this customer
    made five purchases. However, under the assumption, the model thinks that if the
    customer had remained active, they would have made eight purchases in total. But,
    because the probability of being alive dropped at some point, we only see five
    actual purchases.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/589a40c0d68cf1d19f03d9f03f27359e.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: The purchase frequency follows a Poisson process while they are considered ‘active’.
    The Poisson distribution typically represents the count of randomly occurring
    events. Here, ‘λ’ symbolizes the purchase frequency for each customer. However,
    the customer’s purchase frequency can fluctuate. The Poisson distribution accounts
    for such variability in purchase frequency.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/fd0ddbecf6cef9adccef94e7042f4c00.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author; Graph sourced from Wikipedia
  prefs: []
  type: TYPE_NORMAL
- en: The graph below illustrates how ‘p’ changes over time. As the time since the
    last purchase increases (T=31), the probability of a customer being ‘alive’ decreases.
    When a repurchase occurs (around T=36), you’ll notice that ‘p’ increases once
    again.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8e1c21c76bf8e21d0d251380c7610b25.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: This is the graphical model. As mentioned earlier, it includes lambda (λ) and
    p. Here, λ and p vary from person to person. To account for this diversity, we
    assume that heterogeneity in λ follows a gamma distribution and Heterogeneity
    in p follows a “beta distribution. In other words, this model uses a layered approach
    informed by Bayes’ theorem, which is also called Bayesian hierarchical modeling.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e28328bbafd56a1495c9c256fa0a12de.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'For a detailed derivation of the formulas, please refer to this paper: [https://www.brucehardie.com/papers/bgnbd_2004-04-20.pdf](https://www.brucehardie.com/papers/bgnbd_2004-04-20.pdf)'
  prefs: []
  type: TYPE_NORMAL
- en: '**5.2 Gamma-Gamma model**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The gamma distribution is ideal for modeling Average Order Value because it
    naturally accounts for the continuous and strictly positive nature of spend data,
    which tends to be right-skewed. The Gamma Distribution is shaped by two parameters:
    the shape parameter and the scale parameter. As this graph shows, the form of
    the Gamma distribution can change quite a bit by changing these two parameters.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c35786954801dafebc941d8e0903a27e.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author; Graph sourced from Wikipedia
  prefs: []
  type: TYPE_NORMAL
- en: This diagram illustrates the graphical model in use. The model employs two Gamma
    distributions within a Bayesian hierarchical approach. The first Gamma distribution
    represents the “average order value” for each customer. Since this value differs
    among customers, the second Gamma distribution captures the variation in average
    order value across the entire customer base. The parameters p, q, and γ (gamma)
    for the prior distributions are determined by using Half-flat priors.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1f4c2584fe48a9f2541d99d7c575af08.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'For a detailed derivation of the formulas, please refer to this paper: [https://www.brucehardie.com/notes/025/gamma_gamma.pdf](https://www.brucehardie.com/notes/025/gamma_gamma.pdf)'
  prefs: []
  type: TYPE_NORMAL
- en: 6\. Sample Code
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Useful CLV libraries**'
  prefs: []
  type: TYPE_NORMAL
- en: Here, let me introduce two great OSS libraries for CLV modeling. The first one
    is PyMC-Marketing and the second is CLVTools. Both libraries incorporate Buy-till-you-die
    modeling. The most significant difference is that PyMC-Marketing is a Python-based
    library, while CLVTools is R-based. PyMC-Marketing is built on PyMC, a popular
    Bayesian library. Previously, there was a well-known library called ‘Lifetimes’.
    However, ‘Lifetimes’ is now in maintenance mode, so it has transitioned into a
    PyMC-Marketing.
  prefs: []
  type: TYPE_NORMAL
- en: '**Full code**'
  prefs: []
  type: TYPE_NORMAL
- en: The full code can be found on my Github below. My sample code is based on yMC-Marketing’s
    official quick start.
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://github.com/takechanman1228/Effective-CLV-Modeling?source=post_page-----bc0730973c0a--------------------------------)
    [## GitHub - takechanman1228/Effective-CLV-Modeling'
  prefs: []
  type: TYPE_NORMAL
- en: Contribute to takechanman1228/Effective-CLV-Modeling development by creating
    an account on GitHub.
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: github.com](https://github.com/takechanman1228/Effective-CLV-Modeling?source=post_page-----bc0730973c0a--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: '**Code Walkthrough**'
  prefs: []
  type: TYPE_NORMAL
- en: First, you will need to import pymc_marketing and other libraries.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: You will need to download the [“Online Retail Dataset” from the “UCI Machine
    Learning Repository”](https://archive.ics.uci.edu/dataset/352/online+retail).
    This dataset contains transactional data from a UK-based online retailer and is
    licensed under a Creative Commons Attribution 4.0 International (CC BY 4.0) license.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/805019ed21336f546a08b99f8f7463a1.png)'
  prefs: []
  type: TYPE_IMG
- en: '**Data Cleansing**'
  prefs: []
  type: TYPE_NORMAL
- en: A quick data cleansing is needed. For instance, we need to handle return orders,
    filter out records without a customer ID, and create a ‘total sales’ column by
    multiplying the quantity and unit price together.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/83830ea13d626064fdf07893f32a7b64.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: Then, we need to create a summary table using this ‘clv_summary’ function. The
    function returns the dataframe in an RFM-T format. RFM-T means Recency, Frequency,
    Monetary, and Tenure of each customer. These metrics are popular in shopper analysis.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/5f4aa39e85182f00572b99583822652b.png)'
  prefs: []
  type: TYPE_IMG
- en: '**BG/NBD model**'
  prefs: []
  type: TYPE_NORMAL
- en: The BG/NBD model is available as a BetaGeoModel function in this library. When
    you execute bgm.fit(), your model begins the training.
  prefs: []
  type: TYPE_NORMAL
- en: When you execute bgm.fit_summary(), the system provides a statistical summary
    of the learning process. For example, this table shows the mean, standard deviation,
    High-Density Interval, HDI for short, etc. for the parameters. We can also check
    r_hat value, which helps assess whether a Markov Chain Monte Carlo (MCMC) simulation
    has converged. R-hat is considered acceptable if it’s 1.1 or less.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/afce79c5a5316b732e87c915fd29ae3d.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The matrix below is called the Probability Alive Matrix. With this, we can
    infer users who are likely to return and those who are unlikely to return. The
    X-axis represents the customer’s historical purchase frequency and the y-axis
    represents the customers’ recency. The color shows the probability of being alive.
    Our new customers are in the bottom-left corner: Low frequency and high recency.
    Those customers have a high probability of being alive. Our loyal customers are
    those on the bottom-right: High-frequency and High-recency customers. If they
    don’t purchase for a long time, loyal customers become at-risk customers, which
    have low probability of being alive.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/b3e29e13012ac77d73a7d1a12c31e6a4.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: The next thing we can do is to predict the future transactions for each customer.
    You can use the expected_num_purchases function. Having fit the model, we can
    ask what is the expected number of purchases in the next period.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/7ba8489861c0c8c150165770b839dc5a.png)'
  prefs: []
  type: TYPE_IMG
- en: '**Gamma-Gamma model**'
  prefs: []
  type: TYPE_NORMAL
- en: Next, we will move on to the Gamma-Gamma model to predict the average order
    value. We can predict the expected “average order value” with ‘Expected_customer_spend’
    function.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: The graph below shows the expected average order value of 5 customers. The average
    order value of these two customers is more than $500, while the average order
    value of these three customers is around $350.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/05bd826e68482b82c88a33692f70105a.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: '**Outcomes**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally, we can combine two sub-models to estimate the CLV of each customer.
    One thing I want to mention here is the parameter: Discount_rate. This function
    uses the DCF method, short for “discounted cash flow.” When a monthly discount
    rate is 1%, $100 in one month is worth $99 today.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Now, I am going to show you how we can improve our marketing actions. The graph
    below shows an estimated CLV by Country.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/ab11faf31ba96af8fa215c012d66f245.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: Customers in France tend to have a high CLV. On the other hand, customers in
    Belgium tend to have a lower CLV. From this output, I recommend increasing the
    marketing budget for acquiring customers in France and reducing the marketing
    budget for acquiring customers in Belgium. When we do the modeling with the U.S.-based
    data., we would use the states instead of the country.
  prefs: []
  type: TYPE_NORMAL
- en: 7\. How can you improve the model’s accuracy?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You might be wondering:'
  prefs: []
  type: TYPE_NORMAL
- en: Can we utilize additional types of data, such as access logs?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Is it possible to incorporate more features like demographic information or
    marketing activity into the model?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Basically, the BTYD model only requires transaction data. If you want to use
    other data or other features, an ML approach might be an option. After that, you
    can assess the performance of both Bayesian and ML models, choosing the one that
    offers better accuracy and interpretability.
  prefs: []
  type: TYPE_NORMAL
- en: The flowchart below shows a guideline for better CLV modeling.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/2be43fbfbc79f5cb3b79b28dc9baa14a.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: First, consider your data size. If your data isn’t large enough or you only
    have transaction data, BTYD modeling using PyMC Marketing might be the best choice.
    Even though your data is large enough, I think a good approach is to start with
    a BTYD model and if it underperforms, try a different approach. Specifically,
    if your priority is accuracy over interpretability, neural networks, XGboost,
    LightGBM, or ensemble techniques could be beneficial. If interpretability is still
    important to you, consider methods like Random Forest or the explainable AI approach.
  prefs: []
  type: TYPE_NORMAL
- en: In summary, I recommend starting with PyMC Marketing is a good first step in
    any case!
  prefs: []
  type: TYPE_NORMAL
- en: 8\. Conclusion
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Here are some key takeaways.
  prefs: []
  type: TYPE_NORMAL
- en: Customer lifetime value (CLV) is the total net profit a company can expect from
    a single customer throughout their relationship.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We can build a Probabilistic model (BTYD) using the BG/NBD model and the Gamma-Gamma
    model.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you are familiar with Python, PyMC-Marketing is where you can start.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Thank you for reading! If you have any questions/suggestions, feel free to contact
    me on [Linkedin](https://www.linkedin.com/in/hajime-takeda/)! Also, I would be
    happy if you follow me on Towards Data Science.
  prefs: []
  type: TYPE_NORMAL
- en: 9\. Reference
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**BG/NBD Model :** [https://www.brucehardie.com/papers/bgnbd_2004-04-20.pdf](https://www.brucehardie.com/papers/bgnbd_2004-04-20.pdf)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Gamma-Gamma Model :** [https://www.brucehardie.com/notes/025/gamma_gamma.pdf](https://www.brucehardie.com/notes/025/gamma_gamma.pdf)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**PyMC Marketing :** [https://github.com/pymc-labs/pymc-marketing](https://github.com/pymc-labs/pymc-marketing)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Online Retail Dataset (**LicenseCC BY 4.0**)**[: https://archive.ics.uci.edu/dataset/352/online+retail](https://archive.ics.uci.edu/dataset/352/online+retail)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
