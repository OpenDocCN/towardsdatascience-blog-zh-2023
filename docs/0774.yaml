- en: Practical Approaches to Optimizing Budget in Marketing Mix Modeling
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/practical-approaches-to-optimizng-budget-in-marketing-mix-modeling-7816a27f2f71?source=collection_archive---------1-----------------------#2023-02-28](https://towardsdatascience.com/practical-approaches-to-optimizng-budget-in-marketing-mix-modeling-7816a27f2f71?source=collection_archive---------1-----------------------#2023-02-28)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: How to optimize the media mix using saturation curves and statistical models
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@slavax?source=post_page-----7816a27f2f71--------------------------------)[![Slava
    Kisilevich](../Images/5a2a00fb7a9d4c33868d071b6cc1a009.png)](https://medium.com/@slavax?source=post_page-----7816a27f2f71--------------------------------)[](https://towardsdatascience.com/?source=post_page-----7816a27f2f71--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----7816a27f2f71--------------------------------)
    [Slava Kisilevich](https://medium.com/@slavax?source=post_page-----7816a27f2f71--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fba0d56f8b910&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-approaches-to-optimizng-budget-in-marketing-mix-modeling-7816a27f2f71&user=Slava+Kisilevich&userId=ba0d56f8b910&source=post_page-ba0d56f8b910----7816a27f2f71---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----7816a27f2f71--------------------------------)
    ·9 min read·Feb 28, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7816a27f2f71&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-approaches-to-optimizng-budget-in-marketing-mix-modeling-7816a27f2f71&user=Slava+Kisilevich&userId=ba0d56f8b910&source=-----7816a27f2f71---------------------clap_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7816a27f2f71&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-approaches-to-optimizng-budget-in-marketing-mix-modeling-7816a27f2f71&source=-----7816a27f2f71---------------------bookmark_footer-----------)![](../Images/c036f613d716e8185ca185b7300c04d3.png)'
  prefs: []
  type: TYPE_NORMAL
- en: Photo by [Joel Filipe](https://unsplash.com/@joelfilip?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: Marketing Mix Modeling (MMM) is a data-driven approach that is used to identify
    and analyze the key drivers of the business outcome such as sales or revenue by
    examining the impact of various factors that may influence the response. The goal
    of MMM is to provide insights into how marketing activities, including advertising,
    pricing, and promotions, can be optimized to improve the business performance.
    Among all the factors influencing the business outcome, marketing contribution,
    such as advertising spend in various media channels, is considered to have a direct
    and measurable impact on the response. By analyzing the effectiveness of advertising
    spend in different media channels, MMM can provide valuable insights into which
    channels are the most effective for increasing sales or revenue, and which channels
    may need to be optimized or eliminated to maximize marketing ROI.
  prefs: []
  type: TYPE_NORMAL
- en: Short introduction into MMM
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Marketing Mix Modeling (MMM) is a multi-step process involving series of unique
    steps that are driven by the marketing effects being analyzed. First, the coefficients
    of the media channels are constrained to be positive to account for positive effect
    of advertising activity.
  prefs: []
  type: TYPE_NORMAL
- en: '[](/modeling-marketing-mix-with-constrained-coefficients-234b23190ee2?source=post_page-----7816a27f2f71--------------------------------)
    [## Modeling Marketing Mix with Constrained Coefficients'
  prefs: []
  type: TYPE_NORMAL
- en: How to fit a SciPy Linear Regression and call R Ridge Regression from Python
    using RPy2 Interface
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/modeling-marketing-mix-with-constrained-coefficients-234b23190ee2?source=post_page-----7816a27f2f71--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Second, adstock transformation is applied to capture the lagged and decayed
    impact of advertising on consumer behavior.
  prefs: []
  type: TYPE_NORMAL
- en: '[](/modeling-marketing-mix-using-pymc3-ba18dd9e6e68?source=post_page-----7816a27f2f71--------------------------------)
    [## Modeling Marketing Mix using PyMC3'
  prefs: []
  type: TYPE_NORMAL
- en: Experimenting with priors, data normalization, and comparing Bayesian modeling
    with Robyn, Facebook’s open-source MMM…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/modeling-marketing-mix-using-pymc3-ba18dd9e6e68?source=post_page-----7816a27f2f71--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Third, the relationship between advertising spend and the corresponding business
    outcome is not linear, and follows the law of diminishing returns. In most MMM
    solutions, the modeler typically employs linear regression to train the model,
    which presents two key challenges. Firstly, the modeler must apply the saturation
    transformation step to establish the non-linear relationship between the media
    activity variables and the response variable. Secondly, the modeler must develop
    hypotheses about the possible transformation functions that are applicable to
    each media channel. However, more complex machine learning models may capture
    non-linear relationships without applying the saturation transformation.
  prefs: []
  type: TYPE_NORMAL
- en: '[](/modeling-marketing-mix-using-smoothing-splines-98dc8e84c367?source=post_page-----7816a27f2f71--------------------------------)
    [## Modeling Marketing Mix Using Smoothing Splines'
  prefs: []
  type: TYPE_NORMAL
- en: Capturing non-linear advertising saturation and diminishing returns without
    explicitly transforming media variables
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/modeling-marketing-mix-using-smoothing-splines-98dc8e84c367?source=post_page-----7816a27f2f71--------------------------------)
    [](/improving-marketing-mix-modeling-using-machine-learning-approaches-25ea4cd6994b?source=post_page-----7816a27f2f71--------------------------------)
    [## Improving Marketing Mix Modeling Using Machine Learning Approaches
  prefs: []
  type: TYPE_NORMAL
- en: Building MMM models using tree-based ensembles and explaining media channel
    performance using SHAP (Shapley Additive…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/improving-marketing-mix-modeling-using-machine-learning-approaches-25ea4cd6994b?source=post_page-----7816a27f2f71--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: The last step is to build a marketing mix model by estimating the coefficients,
    and parameters of the adstock and saturation functions.
  prefs: []
  type: TYPE_NORMAL
- en: Budget Optimization
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Both saturation curves and a trained model can be used in marketing mix modeling
    to optimize budget spend. The advantages of using saturation curves are:'
  prefs: []
  type: TYPE_NORMAL
- en: Simplicity in visualizing the influence of spend on the outcome
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The underlying model is not required anymore so budget optimization procedure
    is simplified and requires only the parameters of the saturation transformation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: One of the disadvantages is that saturation curves are based on historical data
    and may not always accurately predict the response to future spends.
  prefs: []
  type: TYPE_NORMAL
- en: The advantages of using the trained model for budget optimization is that the
    model uses complex relationship between media activities and other variables including
    trend, and seasonality and can better capture the diminishing returns over time.
  prefs: []
  type: TYPE_NORMAL
- en: Data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: I continue using the dataset made available by [Robyn](https://github.com/facebookexperimental/Robyn)
    under MIT Licence as in my previous articles for practical examples, and follow
    the same data preparation steps by applying Prophet to decompose trends, seasonality,
    and holidays.
  prefs: []
  type: TYPE_NORMAL
- en: 'The dataset consists of 208 weeks of revenue (from 2015–11–23 to 2019–11–11)
    having:'
  prefs: []
  type: TYPE_NORMAL
- en: '5 media spend channels: **tv_S, ooh_S, print_S, facebook_S, search_S**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '2 media channels that have also the exposure information (Impression, Clicks):
    facebook_I, search_clicks_P (not used in this article)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Organic media without spend: **newsletter**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Control variables: **events, holidays**, competitor sales (**competitor_sales_B)**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Modeling
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'I built a complete working MMM pipeline that can be applied in a real-life
    scenario for analyzing media spend on the response variable, consisting of the
    following components:'
  prefs: []
  type: TYPE_NORMAL
- en: '[Adstock Transformation](https://medium.com/towards-data-science/modeling-marketing-mix-using-pymc3-ba18dd9e6e68)
    with infinite decay rate (0 < α < 1)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Saturation Hill Transformation](https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/46001.pdf)
    with two parameters: slope / shape parameter, controlling the steepness of the
    curve (s > 0) and half saturation point (0 < k ≤ 1)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Ridge Regression from [scikit-learn](https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Ridge.html)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Time-based cross-validation](https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.TimeSeriesSplit.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Optuna hyperparameter tuning](https://optuna.org)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**A note on coefficients**'
  prefs: []
  type: TYPE_NORMAL
- en: In scikit-learn, Ridge Regression does not offer the option to set a subset
    of coefficients to be positive. However, a possible workaround is to reject the
    optuna solution if some of the media coefficients turn out to be negative. This
    can be achieved by returning a very large value, indicating that the negative
    coefficients are unacceptable and must be excluded.
  prefs: []
  type: TYPE_NORMAL
- en: '**A note on saturation transformation**'
  prefs: []
  type: TYPE_NORMAL
- en: The Hill saturation function assumes that the input variable falls within a
    range of 0 to 1, which means that the input variable must be normalized before
    applying the transformation. This is important because the Hill function assumes
    that the input variable has a maximum value of 1.
  prefs: []
  type: TYPE_NORMAL
- en: 'However, it is possible to apply the Hill transformation on non-normalized
    data by scaling the half saturation parameter to the spend range by using the
    following equation:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: where *half_saturation* is the original half saturation parameter in the range
    between 0 and 1, *spend_min* and *spend_max* represent the minimum and maximum
    spend values, respectively.
  prefs: []
  type: TYPE_NORMAL
- en: 'The complete transformation function is provided below:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '**Budget Optimization using Saturation Curves**'
  prefs: []
  type: TYPE_NORMAL
- en: Once the model is trained, we can visualize the impact of media spend on the
    response variable using response curves that have been generated through Hill
    saturation transformations for each media channel. The plot below illustrates
    the response curves for five media channels, depicting the relationship between
    spend of each channel (on weekly basis) and response over a period of 208 weeks.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/bfd812bc762f0aea5c469ff26aeb588a.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: Optimizing budget using saturation curves involves identifying the optimal spend
    for each media channel that will result in the highest overall response while
    keeping the total budget fixed for a selected time period.
  prefs: []
  type: TYPE_NORMAL
- en: To initiate optimization, the average spend for a specific time period is generally
    used as a baseline. The optimizer then uses the budget per channel, which can
    fluctuate within predetermined minimum and maximum limits (boundaries), for constrained
    optimization.
  prefs: []
  type: TYPE_NORMAL
- en: The following code snippet demonstrates how budget optimization can be achieved
    using the [*minimize*](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html)function
    from the *scipy.optimize* package. However, it’s worth noting that alternative
    optimization packages, such as [nlopt](https://nlopt.readthedocs.io/en/latest/NLopt_Python_Reference/)
    or [nevergrad](https://github.com/facebookresearch/nevergrad), can also be used
    for this purpose.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Some important points:'
  prefs: []
  type: TYPE_NORMAL
- en: '**fun** — the objective function to be minimized. In this case, it takes the
    following parameters:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*media coefficients* — Ridge regression coefficients for each media channel
    that are multiplied with the corresponding saturation level to estimate the response
    level for each media channel.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '*slopes* and *half saturations* — two parameters of the Hill transformation
    spend min-max values for each media channel to correctly estimate the response
    level for a given media spend.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: The objective function iterates over all media channels and calculates the total
    response based on the sum of individual response levels per media channel. To
    maximize the response in the optimization function, we need to convert it into
    a minimization problem. Therefore, we obtain the negative value of the total response,
    which we then use as the objective for the optimization function.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '**method = SLSQP** — The Sequential Least Squares Programming (SLSQP) algorithm
    is a popular method for constrained optimization problems, and it is often used
    for optimizing budget allocation in marketing mix modeling.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**x0** — Initial guess. Array of real elements of size (n,), where `n` is the
    number of independent variables. In this case, x0 corresponds to the media channel
    average spend, i.e., an array of average spends per channel.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**bounds** — refers to the bounds of media spend per channel.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**constraints** — constraints for SLSQP are defined as a list of dictionaries,
    where `budget_constraint`is a function that ensures that the sum of media spends
    is equal to the fixed budget: `np.sum(media_channel_average_spend)`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: After the optimization process is complete, we can generate response curves
    for each media channel and compare the spend allocation before and after optimization
    to assess the impact of the optimization process.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/eea054d44c7be24698bbc765843cf951.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by Author
  prefs: []
  type: TYPE_NORMAL
- en: '**Budget Optimization using the Trained Model**'
  prefs: []
  type: TYPE_NORMAL
- en: The process of optimizing the budget using the trained model is quite similar
    to the previous approach, and can be applied to both models that have and those
    that do not have the saturation transformation. This approach offers greater flexibility
    for optimizing marketing mix, allowing for optimization across various time periods,
    including future ones.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following code highlights the differences between the current and the previous
    approach:'
  prefs: []
  type: TYPE_NORMAL
- en: The average spend per channel is multiplied by the desired optimization period
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: We can interpet the results of the optimization as “what is the appropriate
    amount of spending per channel during a specific time interval”
  prefs: []
  type: TYPE_NORMAL
- en: 'The objective function expects two additional parameters: `*optimization_period*`and
    `*additional_inputs*`*—* all other variables like *trend*, *seasonality*, *control
    variables* used for model training and available for the selected time period:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: The objective function takes in media spends that are bounded by our constraints
    within the time period through the `*media_inputs*`parameter. We assume that these
    media spends are equally distributed along all weeks of the time period. Therefore,
    we first divide `*media_inputs*`by the time period to obtain the average spend
    and then replicate it using `np.tile.`After that, we concatenate the non-media
    variables with the media spends and use them to predict the response with`model.predict(X=new_data)`for
    each week within the time interval. Finally, we calculate the total response as
    the sum of the weekly responses and return the negative value of the total response
    for minimization.
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Optimizing budget spend in marketing mix modeling is important because it allows
    marketers to allocate their resources in the most effective way possible, maximizing
    the impact of their marketing efforts and achieving their business objectives.
  prefs: []
  type: TYPE_NORMAL
- en: I showed two practical approaches to optimizing marketing mix using saturation
    curves and trained models.
  prefs: []
  type: TYPE_NORMAL
- en: For a detailed implementation, please refer to the complete code available for
    download on my [Github repo](https://github.com/slavakx/medium_posts).
  prefs: []
  type: TYPE_NORMAL
- en: Thanks for reading!
  prefs: []
  type: TYPE_NORMAL
