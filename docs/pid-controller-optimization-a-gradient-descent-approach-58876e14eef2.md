# PID æ§åˆ¶å™¨ä¼˜åŒ–ï¼šæ¢¯åº¦ä¸‹é™æ–¹æ³•

> åŸæ–‡ï¼š[`towardsdatascience.com/pid-controller-optimization-a-gradient-descent-approach-58876e14eef2`](https://towardsdatascience.com/pid-controller-optimization-a-gradient-descent-approach-58876e14eef2)

## ä½¿ç”¨æœºå™¨å­¦ä¹ è§£å†³å·¥ç¨‹ä¼˜åŒ–é—®é¢˜

[](https://medium.com/@callum.bruce1?source=post_page-----58876e14eef2--------------------------------)![Callum Bruce](https://medium.com/@callum.bruce1?source=post_page-----58876e14eef2--------------------------------)[](https://towardsdatascience.com/?source=post_page-----58876e14eef2--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----58876e14eef2--------------------------------) [Callum Bruce](https://medium.com/@callum.bruce1?source=post_page-----58876e14eef2--------------------------------)

Â·å‘å¸ƒäº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----58876e14eef2--------------------------------) Â·10 åˆ†é’Ÿé˜…è¯»Â·2023 å¹´ 8 æœˆ 1 æ—¥

--

![](img/4350abf8767e1ec8d3ce9a121cb47b01.png)

æ¢¯åº¦ä¸‹é™ç®—æ³•æ²¿ç€ä¸‹å¡çš„æ–¹å‘å‡å°‘æˆæœ¬å‡½æ•°ã€‚

æœºå™¨å­¦ä¹ ã€‚æ·±åº¦å­¦ä¹ ã€‚äººå·¥æ™ºèƒ½ã€‚è¶Šæ¥è¶Šå¤šçš„äººæ¯å¤©éƒ½åœ¨ä½¿ç”¨è¿™äº›æŠ€æœ¯ã€‚è¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç”±äºåƒ ChatGPTã€Bard ç­‰å¤§å‹è¯­è¨€æ¨¡å‹çš„å…´èµ·ã€‚å°½ç®¡è¿™äº›æŠ€æœ¯è¢«å¹¿æ³›ä½¿ç”¨ï¼Œä½†ç›¸å¯¹è¾ƒå°‘çš„äººäº†è§£è¿™äº›æŠ€æœ¯èƒŒåçš„æ–¹æ³•ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†æœºå™¨å­¦ä¹ ä¸­ä½¿ç”¨çš„åŸºæœ¬æ–¹æ³•ä¹‹ä¸€ï¼šæ¢¯åº¦ä¸‹é™ç®—æ³•ã€‚

æˆ‘ä»¬å°†ä¸ä»ç¥ç»ç½‘ç»œçš„è§’åº¦æ¥å®¡è§†æ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œåœ¨ç¥ç»ç½‘ç»œä¸­å®ƒç”¨äºä¼˜åŒ–ç½‘ç»œæƒé‡å’Œåç½®ï¼Œè€Œæ˜¯å°†å…¶ä½œä¸ºè§£å†³ç»å…¸å·¥ç¨‹ä¼˜åŒ–é—®é¢˜çš„å·¥å…·æ¥æ¢è®¨ã€‚

å…·ä½“è€Œè¨€ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ¥è°ƒæ•´æ±½è½¦å·¡èˆªæ§åˆ¶ç³»ç»Ÿä¸­ PIDï¼ˆæ¯”ä¾‹-ç§¯åˆ†-å¾®åˆ†ï¼‰æ§åˆ¶å™¨çš„å¢ç›Šã€‚

é‡‡ç”¨è¿™ç§æ–¹æ³•çš„åŠ¨æœºæœ‰ä¸¤ä¸ªï¼š

é¦–å…ˆï¼Œä¼˜åŒ–ç¥ç»ç½‘ç»œä¸­çš„æƒé‡å’Œåç½®æ˜¯ä¸€ä¸ªé«˜ç»´é—®é¢˜ã€‚æœ‰è®¸å¤šå˜é‡ï¼Œæˆ‘è®¤ä¸ºè¿™äº›ä¼šåˆ†æ•£æ¢¯åº¦ä¸‹é™åœ¨è§£å†³ä¼˜åŒ–é—®é¢˜ä¸­çš„åŸºæœ¬æ•ˆç”¨ã€‚

å…¶æ¬¡ï¼Œæ­£å¦‚ä½ å°†çœ‹åˆ°çš„ï¼Œæ¢¯åº¦ä¸‹é™åœ¨åº”ç”¨äºç»å…¸å·¥ç¨‹é—®é¢˜å¦‚ PID æ§åˆ¶å™¨è°ƒä¼˜ã€æœºå™¨äººä¸­çš„é€†è¿åŠ¨å­¦å’Œæ‹“æ‰‘ä¼˜åŒ–æ—¶ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ã€‚æ¢¯åº¦ä¸‹é™æ˜¯ä¸€ä¸ªåœ¨æˆ‘çœ‹æ¥ï¼Œæ›´å¤šå·¥ç¨‹å¸ˆåº”è¯¥ç†Ÿæ‚‰å¹¶èƒ½å¤Ÿåˆ©ç”¨çš„å·¥å…·ã€‚

é˜…è¯»æœ¬æ–‡åï¼Œä½ å°†äº†è§£ä»€ä¹ˆæ˜¯ PID æ§åˆ¶å™¨ï¼Œæ¢¯åº¦ä¸‹é™ç®—æ³•çš„å·¥ä½œåŸç†ï¼Œä»¥åŠå®ƒå¦‚ä½•åº”ç”¨äºè§£å†³ç»å…¸å·¥ç¨‹ä¼˜åŒ–é—®é¢˜ã€‚ä½ å¯èƒ½ä¼šå—åˆ°æ¿€åŠ±ï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™æ¥åº”å¯¹è‡ªå·±çš„ä¼˜åŒ–æŒ‘æˆ˜ã€‚

æœ¬æ–‡ä¸­ä½¿ç”¨çš„æ‰€æœ‰ä»£ç å¯ä»¥åœ¨[GitHub ä¸Šæ‰¾åˆ°](https://github.com/c-bruce/pid_controller_gradient_descent)ã€‚

# ä»€ä¹ˆæ˜¯ PID æ§åˆ¶å™¨ï¼Ÿ

PID æ§åˆ¶å™¨æ˜¯å·¥ç¨‹å’Œè‡ªåŠ¨åŒ–ç³»ç»Ÿä¸­å¹¿æ³›ä½¿ç”¨çš„åé¦ˆæ§åˆ¶æœºåˆ¶ã€‚å…¶ç›®æ ‡æ˜¯é€šè¿‡æŒç»­è°ƒæ•´æ§åˆ¶ä¿¡å·ä»¥ç»´æŒæœŸæœ›çš„è®¾å®šç‚¹ï¼ŒåŸºäºè®¾å®šç‚¹å’Œç³»ç»Ÿæµ‹é‡è¾“å‡ºï¼ˆè¿‡ç¨‹å˜é‡ï¼‰ä¹‹é—´çš„è¯¯å·®ã€‚

![](img/4bebce93124edeb5a68f3e150a4cc86f.png)

PID æ§åˆ¶å™¨çš„å…¸å‹é˜¶è·ƒå“åº”

PID æ§åˆ¶å™¨åœ¨å„ä¸ªè¡Œä¸šå’Œé¢†åŸŸä¸­åº”ç”¨å¹¿æ³›ã€‚å®ƒä»¬è¢«å¹¿æ³›ç”¨äºè¿‡ç¨‹æ§åˆ¶ç³»ç»Ÿï¼Œå¦‚åˆ¶é€ ä¸šä¸­çš„æ¸©åº¦æ§åˆ¶ã€åŒ–å·¥å‚ä¸­çš„æµé‡æ§åˆ¶ä»¥åŠ HVAC ç³»ç»Ÿä¸­çš„å‹åŠ›æ§åˆ¶ã€‚PID æ§åˆ¶å™¨è¿˜è¢«åº”ç”¨äºæœºå™¨äººæŠ€æœ¯ä¸­ä»¥å®ç°ç²¾ç¡®å®šä½å’Œè¿åŠ¨æ§åˆ¶ï¼Œä»¥åŠæ±½è½¦ç³»ç»Ÿä¸­çš„æ²¹é—¨æ§åˆ¶ã€å‘åŠ¨æœºé€Ÿåº¦è°ƒèŠ‚å’Œé˜²æŠ±æ­»åˆ¹è½¦ç³»ç»Ÿã€‚å®ƒä»¬åœ¨èˆªç©ºèˆªå¤©å’Œèˆªç©ºåº”ç”¨ä¸­ä¹Ÿå‘æŒ¥ç€é‡è¦ä½œç”¨ï¼ŒåŒ…æ‹¬é£æœºè‡ªåŠ¨é©¾é©¶ä»ªå’Œå§¿æ€æ§åˆ¶ç³»ç»Ÿã€‚

PID æ§åˆ¶å™¨ç”±ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ç»„æˆï¼šæ¯”ä¾‹é¡¹ã€ç§¯åˆ†é¡¹å’Œå¾®åˆ†é¡¹ã€‚æ¯”ä¾‹é¡¹å¯¹å½“å‰è¯¯å·®åšå‡ºå³æ—¶å“åº”ï¼Œç§¯åˆ†é¡¹ç´¯ç§¯å¹¶ä¿®æ­£è¿‡å»çš„è¯¯å·®ï¼Œå¾®åˆ†é¡¹é¢„æµ‹å¹¶æŠµæ¶ˆæœªæ¥çš„è¯¯å·®è¶‹åŠ¿ã€‚

![](img/6fe42cfd42b6ca09246fce764897838c.png)

PID æ§åˆ¶å™¨æ¡†å›¾

ä¸Šå›¾ä¸­çš„ PID æ§åˆ¶å™¨æ§åˆ¶å›è·¯å±•ç¤ºäº† *r(t)* æ˜¯è®¾å®šç‚¹ï¼Œ*y(t)* æ˜¯è¿‡ç¨‹å˜é‡ã€‚è¿‡ç¨‹å˜é‡ä»è®¾å®šç‚¹ä¸­å‡å»ä»¥è·å¾—è¯¯å·®ä¿¡å· *e(t)*ã€‚

æ§åˆ¶ä¿¡å·ï¼Œ*u(t)*ï¼Œæ˜¯æ¯”ä¾‹ã€ç§¯åˆ†å’Œå¾®åˆ†é¡¹çš„æ€»å’Œã€‚æ§åˆ¶ä¿¡å·è¢«è¾“å…¥åˆ°è¿‡ç¨‹å½“ä¸­ï¼Œè¿™ä¼šå¯¼è‡´è¿‡ç¨‹å˜é‡æ›´æ–°ã€‚

PID æ§åˆ¶å™¨æ§åˆ¶ä¿¡å· u(t)

# æ¢¯åº¦ä¸‹é™ç®—æ³•

æ¢¯åº¦ä¸‹é™æ˜¯ä¸€ç§å¸¸ç”¨äºæœºå™¨å­¦ä¹ å’Œæ•°å­¦ä¼˜åŒ–çš„ä¼˜åŒ–ç®—æ³•ã€‚å®ƒé€šè¿‡åŸºäºæˆæœ¬å‡½æ•°æ¢¯åº¦è¿­ä»£è°ƒæ•´å‚æ•°ï¼Œæ—¨åœ¨æ‰¾åˆ°ç»™å®šæˆæœ¬å‡½æ•°çš„æœ€å°å€¼ã€‚æ¢¯åº¦æŒ‡å‘æœ€é™¡çš„ä¸Šå‡æ–¹å‘ï¼Œå› æ­¤é€šè¿‡æœç›¸åæ–¹å‘è¿ˆæ­¥ï¼Œç®—æ³•é€æ¸æ”¶æ•›åˆ°æœ€ä¼˜è§£ã€‚

å•æ­¥æ¢¯åº¦ä¸‹é™æ›´æ–°å®šä¹‰ä¸ºï¼š

æ¢¯åº¦ä¸‹é™æ›´æ–°æ­¥éª¤

***a****â‚™* æ˜¯è¾“å…¥å‚æ•°çš„å‘é‡ã€‚ä¸‹æ ‡ *n* è¡¨ç¤ºè¿­ä»£ã€‚*f(****a****â‚™)* æ˜¯å¤šå˜é‡æˆæœ¬å‡½æ•°ï¼Œâˆ‡*f(****a****)* æ˜¯è¯¥æˆæœ¬å‡½æ•°çš„æ¢¯åº¦ã€‚âˆ‡*f(****a****â‚™)* ä»£è¡¨æœ€é™¡å‡é«˜çš„æ–¹å‘ï¼Œå› æ­¤å®ƒä» ***a****â‚™* ä¸­å‡å»ä»¥åœ¨ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­å‡å°‘æˆæœ¬å‡½æ•°ã€‚ğ›¾ æ˜¯å­¦ä¹ ç‡ï¼Œå†³å®šäº†æ¯æ¬¡è¿­ä»£çš„æ­¥é•¿ã€‚

å¿…é¡»é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ğ›¾å€¼ã€‚å¦‚æœå€¼è¿‡å¤§ï¼Œæ¯æ¬¡è¿­ä»£æ—¶é‡‡å–çš„æ­¥éª¤å°†è¿‡å¤§ï¼Œå¯¼è‡´æ¢¯åº¦ä¸‹é™ç®—æ³•æ— æ³•æ”¶æ•›ã€‚å¦‚æœå€¼è¿‡å°ï¼Œæ¢¯åº¦ä¸‹é™ç®—æ³•å°†è®¡ç®—å¼€é”€å¤§ï¼Œæ”¶æ•›æ—¶é—´é•¿ã€‚

![](img/aba8bdc7d4833adb595ed30d9acda58e.png)

æ¢¯åº¦ä¸‹é™ç®—æ³•åº”ç”¨äº y=xÂ²ä»£ä»·å‡½æ•°ï¼ˆåˆå§‹ x=5ï¼‰ï¼Œå¯¹äºğ›¾=0.1ï¼ˆå·¦ä¾§ï¼‰å’Œğ›¾=1.02ï¼ˆå³ä¾§ï¼‰

æ¢¯åº¦ä¸‹é™åœ¨å¹¿æ³›çš„é¢†åŸŸå’Œå­¦ç§‘ä¸­åº”ç”¨ã€‚åœ¨æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ ä¸­ï¼Œå®ƒæ˜¯ç”¨äºè®­ç»ƒç¥ç»ç½‘ç»œå’Œä¼˜åŒ–å…¶å‚æ•°çš„åŸºæœ¬ä¼˜åŒ–ç®—æ³•ã€‚é€šè¿‡æ ¹æ®ä»£ä»·å‡½æ•°çš„æ¢¯åº¦è¿­ä»£æ›´æ–°ç½‘ç»œçš„æƒé‡å’Œåå·®ï¼Œæ¢¯åº¦ä¸‹é™ä½¿ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ å¹¶éšç€æ—¶é—´çš„æ¨ç§»æé«˜å…¶æ€§èƒ½ã€‚

é™¤äº†æœºå™¨å­¦ä¹ ä¹‹å¤–ï¼Œæ¢¯åº¦ä¸‹é™è¢«åº”ç”¨äºå·¥ç¨‹ã€ç‰©ç†å­¦ã€ç»æµå­¦åŠå…¶ä»–é¢†åŸŸçš„å„ç§ä¼˜åŒ–é—®é¢˜ä¸­ã€‚å®ƒå¸®åŠ©è¿›è¡Œå‚æ•°ä¼°è®¡ã€ç³»ç»Ÿè¯†åˆ«ã€ä¿¡å·å¤„ç†ã€å›¾åƒé‡å»ºä»¥åŠè®¸å¤šå…¶ä»–éœ€è¦æ‰¾åˆ°å‡½æ•°æœ€å°å€¼æˆ–æœ€å¤§å€¼çš„ä»»åŠ¡ã€‚æ¢¯åº¦ä¸‹é™çš„å¤šåŠŸèƒ½æ€§å’Œæœ‰æ•ˆæ€§ä½¿å…¶æˆä¸ºè§£å†³ä¼˜åŒ–é—®é¢˜å’Œæ”¹å–„å„é¢†åŸŸæ¨¡å‹å’Œç³»ç»Ÿçš„é‡è¦å·¥å…·ã€‚

# ä½¿ç”¨æ¢¯åº¦ä¸‹é™ä¼˜åŒ– PID æ§åˆ¶å™¨å¢ç›Š

æœ‰å‡ ç§æ–¹æ³•å¯ä»¥è°ƒæ•´ PID æ§åˆ¶å™¨ã€‚è¿™äº›æ–¹æ³•åŒ…æ‹¬æ‰‹åŠ¨è°ƒèŠ‚æ³•å’Œåƒ[é½æ ¼å‹’-å°¼ç§‘å°”æ–¯æ³•](https://en.wikipedia.org/wiki/Ziegler%E2%80%93Nichols_method)è¿™æ ·çš„å¯å‘å¼æ–¹æ³•ã€‚æ‰‹åŠ¨è°ƒèŠ‚æ³•å¯èƒ½è€—æ—¶ä¸”å¯èƒ½éœ€è¦å¤šæ¬¡è¿­ä»£æ‰èƒ½æ‰¾åˆ°æœ€ä½³å€¼ï¼Œè€Œé½æ ¼å‹’-å°¼ç§‘å°”æ–¯æ³•å¾€å¾€ä¼šäº§ç”Ÿæ¿€è¿›çš„å¢ç›Šå’Œè¾ƒå¤§çš„è¶…è°ƒï¼Œè¿™æ„å‘³ç€å®ƒä¸é€‚åˆæŸäº›åº”ç”¨ã€‚

è¿™é‡Œå±•ç¤ºäº†ä¸€ç§æ¢¯åº¦ä¸‹é™æ–¹æ³•æ¥ä¼˜åŒ– PID æ§åˆ¶å™¨ã€‚æˆ‘ä»¬å°†ä¼˜åŒ–ä¸€ä¸ªè½¦è½½å·¡èˆªæ§åˆ¶ç³»ç»Ÿçš„æ§åˆ¶ç³»ç»Ÿï¼Œä»¥åº”å¯¹è®¾å®šç‚¹çš„é˜¶è·ƒå˜åŒ–ã€‚

é€šè¿‡æ§åˆ¶è¸æ¿ä½ç½®ï¼Œæ§åˆ¶å™¨çš„ç›®æ ‡æ˜¯å°†è½¦è¾†åŠ é€Ÿåˆ°é€Ÿåº¦è®¾å®šç‚¹ï¼ŒåŒæ—¶æœ€å°åŒ–è¶…è°ƒã€ç¨³å®šæ—¶é—´å’Œç¨³æ€è¯¯å·®ã€‚

è½¦è¾†å—åˆ°ä¸è¸æ¿ä½ç½®æˆæ¯”ä¾‹çš„é©±åŠ¨åŠ›ã€‚æ»šåŠ¨é˜»åŠ›å’Œç©ºæ°”é˜»åŠ›ä½œç”¨äºä¸é©±åŠ¨åŠ›ç›¸åçš„æ–¹å‘ã€‚è¸æ¿ä½ç½®ç”± PID æ§åˆ¶å™¨æ§åˆ¶ï¼Œå¹¶é™åˆ¶åœ¨-50%åˆ° 100%èŒƒå›´å†…ã€‚å½“è¸æ¿ä½ç½®ä¸ºè´Ÿå€¼æ—¶ï¼Œè½¦è¾†åœ¨åˆ¶åŠ¨ã€‚

åœ¨è°ƒæ•´ PID æ§åˆ¶å™¨å¢ç›Šæ—¶ï¼Œæ‹¥æœ‰ç³»ç»Ÿæ¨¡å‹æ˜¯æœ‰å¸®åŠ©çš„ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿç³»ç»Ÿå“åº”ã€‚ä¸ºæ­¤ï¼Œæˆ‘åœ¨ Python ä¸­å®ç°äº†ä¸€ä¸ª`Car`ç±»ï¼š

```py
import numpy as np

class Car:
    def __init__(self, mass, Crr, Cd, A, Fp):
        self.mass = mass # [kg]
        self.Crr = Crr # [-]
        self.Cd = Cd # [-]
        self.A = A # [mÂ²]
        self.Fp = Fp # [N/%]

    def get_acceleration(self, pedal, velocity):
        # Constants
        rho = 1.225 # [kg/mÂ³]
        g = 9.81 # [m/sÂ²]

        # Driving force
        driving_force = self.Fp * pedal

        # Rolling resistance force
        rolling_resistance_force = self.Crr * (self.mass * g)

        # Drag force
        drag_force = 0.5 * rho * (velocity ** 2) * self.Cd * self.A

        acceleration = (driving_force - rolling_resistance_force - drag_force) / self.mass
        return acceleration

    def simulate(self, nsteps, dt, velocity, setpoint, pid_controller):
        pedal_s = np.zeros(nsteps)
        velocity_s = np.zeros(nsteps)
        time = np.zeros(nsteps)
        velocity_s[0] = velocity

        for i in range(nsteps - 1):
            # Get pedal position [%]
            pedal = pid_controller.compute(setpoint, velocity, dt)
            pedal = np.clip(pedal, -50, 100)
            pedal_s[i] = pedal

            # Get acceleration
            acceleration = self.get_acceleration(pedal, velocity)

            # Get velocity
            velocity = velocity_s[i] + acceleration * dt
            velocity_s[i+1] = velocity

            time[i+1] = time[i] + dt

        return pedal_s, velocity_s, time
```

`PIDController`ç±»çš„å®ç°å¦‚ä¸‹ï¼š

```py
class PIDController:
    def __init__(self, Kp, Ki, Kd):
        self.Kp = Kp
        self.Ki = Ki
        self.Kd = Kd
        self.error_sum = 0
        self.last_error = 0

    def compute(self, setpoint, process_variable, dt):
        error = setpoint - process_variable

        # Proportional term
        P = self.Kp * error

        # Integral term
        self.error_sum += error * dt
        I = self.Ki * self.error_sum

        # Derivative term
        D = self.Kd * (error - self.last_error)
        self.last_error = error

        # PID output
        output = P + I + D

        return output
```

é‡‡å–è¿™ç§é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ–¹æ³•ä½¿å¾—è®¾ç½®å’Œè¿è¡Œå¤šä¸ªå¸¦æœ‰ä¸åŒ PID æ§åˆ¶å™¨å¢ç›Šçš„ä»¿çœŸå˜å¾—æ›´åŠ å®¹æ˜“ï¼Œè¿™åœ¨è¿è¡Œæ¢¯åº¦ä¸‹é™ç®—æ³•æ—¶æ˜¯å¿…é¡»çš„ã€‚

`GradientDescent` ç±»çš„å®ç°å¦‚ä¸‹ï¼š

```py
class GradientDescent:
    def __init__(self, a, learning_rate, cost_function, a_min=None, a_max=None):
        self.a = a
        self.learning_rate = learning_rate
        self.cost_function = cost_function
        self.a_min = a_min
        self.a_max = a_max
        self.G = np.zeros([len(a), len(a)])
        self.points = []
        self.result = []

    def grad(self, a):
        h = 0.0000001
        a_h = a + (np.eye(len(a)) * h)
        cost_function_at_a = self.cost_function(a)
        grad = []
        for i in range(0, len(a)):
            grad.append((self.cost_function(a_h[i]) - cost_function_at_a) / h)
        grad = np.array(grad)
        return grad

    def update_a(self, learning_rate, grad):
        if len(grad) == 1:
            grad = grad[0]
        self.a -= (learning_rate * grad)
        if (self.a_min is not None) or (self.a_max is not None):
            self.a = np.clip(self.a, self.a_min, self.a_max)

    def update_G(self, grad):
        self.G += np.outer(grad,grad.T)

    def execute(self, iterations):
        for i in range(0, iterations):
            self.points.append(list(self.a))
            self.result.append(self.cost_function(self.a))
            grad = self.grad(self.a)
            self.update_a(self.learning_rate, grad)

    def execute_adagrad(self, iterations):
        for i in range(0, iterations):
            self.points.append(list(self.a))
            self.result.append(self.cost_function(self.a))
            grad = self.grad(self.a)
            self.update_G(grad)
            learning_rate = self.learning_rate * np.diag(self.G)**(-0.5)
            self.update_a(learning_rate, grad)
```

é€šè¿‡è°ƒç”¨ `execute` æˆ– `execute_adagrad` æ¥è¿è¡Œç®—æ³•æŒ‡å®šæ¬¡æ•°çš„è¿­ä»£ã€‚`execute_adagrad` æ–¹æ³•æ‰§è¡Œä¸€ç§ä¿®æ”¹åçš„æ¢¯åº¦ä¸‹é™å½¢å¼ï¼Œç§°ä¸º AdaGradï¼ˆè‡ªé€‚åº”æ¢¯åº¦ä¸‹é™ï¼‰ã€‚

AdaGrad å…·æœ‰é€å‚æ•°çš„å­¦ä¹ ç‡ï¼Œè¿™äº›å­¦ä¹ ç‡å¯¹äºç¨€ç–å‚æ•°ä¼šå¢åŠ ï¼Œå¯¹äºä¸é‚£ä¹ˆç¨€ç–çš„å‚æ•°ä¼šå‡å°‘ã€‚å­¦ä¹ ç‡åœ¨æ¯æ¬¡è¿­ä»£åä¼šæ ¹æ®å†å²æ¢¯åº¦å¹³æ–¹å’Œè¿›è¡Œæ›´æ–°ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ AdaGrad æ¥ä¼˜åŒ–æ±½è½¦å·¡èˆªæ§åˆ¶ç³»ç»Ÿçš„ PID æ§åˆ¶å™¨å¢ç›Šã€‚ä½¿ç”¨ AdaGrad æ—¶ï¼Œæ¢¯åº¦ä¸‹é™æ›´æ–°æ–¹ç¨‹å˜ä¸ºï¼š

AdaGrad æ¢¯åº¦ä¸‹é™æ›´æ–°æ­¥éª¤

ç°åœ¨æˆ‘ä»¬éœ€è¦å®šä¹‰æˆ‘ä»¬çš„æˆæœ¬å‡½æ•°ã€‚æˆæœ¬å‡½æ•°å¿…é¡»æ¥å—ä¸€ç»„è¾“å…¥å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•°å­—ï¼›å³æˆæœ¬ã€‚æ±½è½¦å·¡èˆªæ§åˆ¶çš„ç›®æ ‡æ˜¯å°†æ±½è½¦åŠ é€Ÿåˆ°é€Ÿåº¦è®¾å®šç‚¹ï¼ŒåŒæ—¶æœ€å°åŒ–è¶…è°ƒã€ç¨³å®šæ—¶é—´å’Œç¨³æ€è¯¯å·®ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªç›®æ ‡å®šä¹‰å¤šç§æˆæœ¬å‡½æ•°ã€‚è¿™é‡Œæˆ‘ä»¬å°†å…¶å®šä¹‰ä¸ºè¯¯å·®å¹…åº¦éšæ—¶é—´çš„ç§¯åˆ†ï¼š

æ±½è½¦å·¡èˆªæ§åˆ¶æˆæœ¬å‡½æ•°

ç”±äºæˆ‘ä»¬çš„æˆæœ¬å‡½æ•°æ˜¯ä¸€ä¸ªç§¯åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å¯è§†åŒ–ä¸ºè¯¯å·®å¹…åº¦æ›²çº¿ä¸‹çš„é¢ç§¯ã€‚æˆ‘ä»¬æœŸæœ›çœ‹åˆ°æ›²çº¿ä¸‹çš„é¢ç§¯åœ¨æ¥è¿‘å…¨å±€æœ€å°å€¼æ—¶å‡å°‘ã€‚åœ¨ç¨‹åºä¸­ï¼Œæˆæœ¬å‡½æ•°å®šä¹‰ä¸ºï¼š

```py
def car_cost_function(a):
    # Car parameters
    mass = 1000.0  # Mass of the car [kg]
    Cd = 0.2  # Drag coefficient []
    Crr = 0.02 # Rolling resistance []
    A = 2.5 # Frontal area of the car [mÂ²]
    Fp = 30 # Driving force per % pedal position [N/%]

    # PID controller parameters
    Kp = a[0]
    Ki = a[1]
    Kd = a[2]

    # Simulation parameters
    dt = 0.1  # Time step
    total_time = 60.0  # Total simulation time
    nsteps = int(total_time / dt)
    initial_velocity = 0.0  # Initial velocity of the car [m/s]
    target_velocity = 20.0 # Target velocity of the car [m/s]

    # Define Car and PIDController objects
    car = Car(mass, Crr, Cd, A, Fp)
    pid_controller = PIDController(Kp, Ki, Kd)

    # Run simulation
    pedal_s, velocity_s, time = car.simulate(nsteps, dt, initial_velocity, target_velocity, pid_controller)

    # Calculate cost
    cost = np.trapz(np.absolute(target_velocity - velocity_s), time)
    return cost
```

æˆæœ¬å‡½æ•°åŒ…æ‹¬æ¨¡æ‹Ÿå‚æ•°ã€‚æ¨¡æ‹Ÿè¿è¡Œ 60 ç§’ã€‚åœ¨æ­¤æœŸé—´ï¼Œæˆ‘ä»¬è§‚å¯Ÿç³»ç»Ÿå¯¹ä» 0 m/s åˆ° 20 m/s çš„è®¾å®šç‚¹é˜¶è·ƒå˜åŒ–çš„å“åº”ã€‚é€šè¿‡éšæ—¶é—´ç§¯åˆ†è¯¯å·®å¹…åº¦ï¼Œè®¡ç®—æ¯æ¬¡è¿­ä»£çš„æˆæœ¬ã€‚

ç°åœ¨ï¼Œåªå‰©ä¸‹è¿è¡Œä¼˜åŒ–äº†ã€‚æˆ‘ä»¬å°†ä»åˆå§‹å€¼ *Kp* = 5.0ï¼Œ*Ki* = 1.0 å’Œ *Kd* = 0.0 å¼€å§‹ã€‚è¿™äº›å€¼ä¼šäº§ç”Ÿä¸€ä¸ªç¨³å®šçš„ã€å¸¦æœ‰è¶…è°ƒçš„æŒ¯è¡å“åº”ï¼Œæœ€ç»ˆæ”¶æ•›åˆ°è®¾å®šç‚¹ã€‚ä»è¿™ä¸ªèµ·ç‚¹å¼€å§‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŸºç¡€å­¦ä¹ ç‡ ğ›¾=0.1 è¿è¡Œæ¢¯åº¦ä¸‹é™ç®—æ³• 500 æ¬¡ï¼š

```py
a = np.array([5.0, 1.0, 0.0])
gradient_descent = GradientDescent(a, 0.1, car_cost_function, a_min=[0,0,0])
gradient_descent.execute_adagrad(500)
```

![](img/aef6802298914bd17d835a1e6233d53f.png)

æ±½è½¦å·¡èˆªæ§åˆ¶çš„é˜¶è·ƒå“åº”ï¼ˆå·¦ä¾§ï¼‰ï¼Œè¯¯å·®å¹…åº¦ï¼ˆä¸­é—´ï¼‰å’Œæˆæœ¬ï¼ˆå³ä¾§ï¼‰ï¼Œéšç€æ¢¯åº¦ä¸‹é™ç®—æ³•è¿­ä»£è¶‹å‘äºæœ€ä¼˜è§£

ä¸Šé¢çš„åŠ¨ç”»å›¾æ˜¾ç¤ºäº†æ±½è½¦å·¡èˆªæ§åˆ¶çš„é˜¶è·ƒå“åº”å¦‚ä½•éšç€æ¢¯åº¦ä¸‹é™ç®—æ³•å¯¹ *Kp*ã€*Ki* å’Œ *Kd* å¢ç›Šçš„è°ƒä¼˜è€Œæ¼”å˜ã€‚

åˆ°ç¬¬ 25 æ¬¡è¿­ä»£æ—¶ï¼Œæ¢¯åº¦ä¸‹é™ç®—æ³•å·²æ¶ˆé™¤äº†æŒ¯è¡å“åº”ã€‚åœ¨è¿™ä¸€ç‚¹ä¹‹åï¼Œå‘ç”Ÿäº†æœ‰è¶£çš„äº‹æƒ…ã€‚ç®—æ³•ä¼šåœ¨ä¸€ä¸ªå±€éƒ¨æœ€å°å€¼å¤„å¾˜å¾Šï¼Œè¯¥æœ€å°å€¼çš„ç‰¹å¾æ˜¯çº¦ 3 m/s çš„è¶…è°ƒã€‚è¿™å‘ç”Ÿåœ¨ 6.0 < *Kp* < 7.5ï¼Œ*Ki* ~= 0.5ï¼Œ*Kd* = 0.0 çš„èŒƒå›´å†…ï¼Œå¹¶æŒç»­åˆ°ç¬¬ 300 æ¬¡è¿­ä»£ã€‚

ç¬¬ 300 æ¬¡è¿­ä»£åï¼Œç®—æ³•ä¼šè„±ç¦»å±€éƒ¨æœ€å°å€¼ï¼Œæ‰¾åˆ°æ›´æ¥è¿‘å…¨å±€æœ€å°å€¼çš„æ›´ä»¤äººæ»¡æ„çš„å“åº”ã€‚ç°åœ¨çš„å“åº”ç‰¹å¾æ˜¯é›¶è¶…è°ƒã€å¿«é€Ÿç¨³å®šæ—¶é—´å’Œæ¥è¿‘é›¶çš„ç¨³æ€è¯¯å·®ã€‚

è¿è¡Œæ¢¯åº¦ä¸‹é™ç®—æ³• 500 æ¬¡è¿­ä»£åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¼˜åŒ–çš„ PID æ§åˆ¶å™¨å¢ç›Šï¼›*Kp* = 8.33ï¼Œ*Ki* = 0.12 å’Œ *Kd* = 0.00ã€‚

æ¯”ä¾‹å¢ç›Šä»åœ¨ç¨³æ­¥ä¸Šå‡ã€‚è¿è¡Œæ›´å¤šçš„è¿­ä»£ï¼ˆæ­¤å¤„æœªæ˜¾ç¤ºï¼‰ï¼Œéšç€ *Kp* çš„ç¼“æ…¢å¢åŠ ï¼Œæˆ‘ä»¬å‘ç°å¯¹æˆæœ¬å‡½æ•°çš„è¿›ä¸€æ­¥å‡å°‘æ˜¯å¯èƒ½çš„ï¼Œå°½ç®¡è¿™ç§æ•ˆæœé€æ¸å˜å¾—è¾¹é™…åŒ–ã€‚

# æ‘˜è¦

é‡‡ç”¨ä¸€ç§å¹¿æ³›ç”¨äºè§£å†³æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ é—®é¢˜çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æˆåŠŸåœ°ä¼˜åŒ–äº†æ±½è½¦å·¡èˆªæ§åˆ¶ç³»ç»Ÿçš„ PID æ§åˆ¶å™¨å¢ç›Šã€‚

ä»åˆå§‹å€¼ *Kp* = 5.0ï¼Œ*Ki* = 1.0 å’Œ *Kd* = 0.0 å¼€å§‹ï¼Œåº”ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•çš„ AdaGrad å½¢å¼ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°è¯¥ä½ç»´ç³»ç»Ÿå¦‚ä½•é¦–å…ˆè¿›å…¥å±€éƒ¨æœ€å°å€¼ï¼Œç„¶åæœ€ç»ˆæ‰¾åˆ°ä¸€ä¸ªæ›´æ»¡æ„çš„å“åº”ï¼Œå…·æœ‰é›¶è¶…è°ƒã€å¿«é€Ÿçš„ç¨³å®šæ—¶é—´å’Œæ¥è¿‘é›¶çš„ç¨³æ€è¯¯å·®ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°æ¢¯åº¦ä¸‹é™åœ¨åº”ç”¨äºç»å…¸å·¥ç¨‹ä¼˜åŒ–é—®é¢˜æ—¶å¯ä»¥æˆä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ã€‚é™¤äº†è¿™é‡Œå±•ç¤ºçš„ä¾‹å­å¤–ï¼Œæ¢¯åº¦ä¸‹é™è¿˜å¯ä»¥ç”¨äºè§£å†³å…¶ä»–å·¥ç¨‹é—®é¢˜ï¼Œå¦‚æœºå™¨äººä¸­çš„é€†å‘è¿åŠ¨å­¦ã€æ‹“æ‰‘ä¼˜åŒ–ç­‰ã€‚

æ‚¨æ˜¯å¦æœ‰ä¸€ä¸ªè®¤ä¸ºå¯ä»¥åº”ç”¨æ¢¯åº¦ä¸‹é™çš„ä¼˜åŒ–é—®é¢˜ï¼Ÿåœ¨ä¸‹é¢çš„è¯„è®ºä¸­å‘Šè¯‰æˆ‘ã€‚

> **å–œæ¬¢é˜…è¯»è¿™ç¯‡æ–‡ç« å—ï¼Ÿ**
> 
> [å…³æ³¨](https://medium.com/@callum.bruce1)å¹¶[è®¢é˜…](https://medium.com/@callum.bruce1/subscribe)è·å–æ›´å¤šç±»ä¼¼å†…å®¹â€”â€”ä¸æ‚¨çš„ç½‘ç»œåˆ†äº«â€”â€”å°è¯•å°†æ¢¯åº¦ä¸‹é™åº”ç”¨äºæ‚¨è‡ªå·±çš„ä¼˜åŒ–é—®é¢˜ã€‚

*æ‰€æœ‰å›¾ç‰‡ï¼Œé™¤éå¦æœ‰è¯´æ˜ï¼Œå‡ç”±ä½œè€…æä¾›ã€‚*

# å‚è€ƒæ–‡çŒ®

## ç½‘ç»œ

[1] GitHub (2023), [pid_controller_gradient_descent](https://github.com/c-bruce/pid_controller_gradient_descent)

[2] ç»´åŸºç™¾ç§‘ (2023)ï¼Œ[é½æ ¼å‹’â€“å°¼ç§‘å°”æ–¯æ³•](https://en.wikipedia.org/wiki/Zieglerâ€“Nichols_method)ï¼ˆè®¿é—®æ—¥æœŸï¼š2023 å¹´ 7 æœˆ 10 æ—¥ï¼‰
