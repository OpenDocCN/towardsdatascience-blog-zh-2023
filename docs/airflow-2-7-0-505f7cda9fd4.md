# Airflow 2.7 ç°å·²å‘å¸ƒ

> åŸæ–‡ï¼š[`towardsdatascience.com/airflow-2-7-0-505f7cda9fd4`](https://towardsdatascience.com/airflow-2-7-0-505f7cda9fd4)

## è¿™é‡Œæ˜¯ä¸€äº›é‡è¦çš„åŠŸèƒ½æ›´æ–°ï¼Œå°†ä½¿æ‚¨çš„ç”Ÿæ´»æ›´è½»æ¾ï¼Œå¹¶èŠ‚çœæ‚¨çš„æ—¶é—´

[](https://gmyrianthous.medium.com/?source=post_page-----505f7cda9fd4--------------------------------)![Giorgos Myrianthous](https://gmyrianthous.medium.com/?source=post_page-----505f7cda9fd4--------------------------------)[](https://towardsdatascience.com/?source=post_page-----505f7cda9fd4--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----505f7cda9fd4--------------------------------) [Giorgos Myrianthous](https://gmyrianthous.medium.com/?source=post_page-----505f7cda9fd4--------------------------------)

Â·å‘è¡¨äº[Towards Data Science](https://towardsdatascience.com/?source=post_page-----505f7cda9fd4--------------------------------) Â·5 åˆ†é’Ÿé˜…è¯»Â·2023 å¹´ 8 æœˆ 22 æ—¥

--

![](img/95857018b07b867da39e2c1abf6d8df6.png)

å›¾åƒç”± DALL-E-2 ç”Ÿæˆï¼Œä½¿ç”¨æç¤ºâ€œæ•°æ®ä»å¤–éƒ¨ç³»ç»Ÿæµå…¥ç›®æ ‡ç³»ç»Ÿä½œä¸ºç³»ç»Ÿè®¾è®¡å›¾ï¼Œæ•°å­—è‰ºæœ¯â€

Apache Airflow 2.7.0 ç»ˆäºå‘å¸ƒäº†ï¼Œæˆ‘ä»¬éƒ½å¾ˆå…´å¥‹çœ‹åˆ°è¿™äº›æ˜¾è‘—çš„æ–°åŠŸèƒ½å‡ºç°åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­ã€‚æ–°ç‰ˆæœ¬åŒ…æ‹¬ 40 ä¸ªæ–°åŠŸèƒ½ã€53 ä¸ªé”™è¯¯ä¿®å¤ã€49 ä¸ªæ”¹è¿›å’Œ 15 ä¸ªæ–‡æ¡£æ›´æ–°ã€‚

æ­¤æ¬¡å‘å¸ƒçš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯å®‰å…¨æ€§ï¼Œä½†åŒæ—¶ä¹Ÿæ¨å‡ºäº†è®¸å¤šä»¤äººå…´å¥‹çš„éå®‰å…¨ç›¸å…³åŠŸèƒ½ã€‚

## æ–°çš„é›†ç¾¤æ´»åŠ¨ç”¨æˆ·ç•Œé¢

ä» Airflow 2.7.0 å¼€å§‹ï¼ŒAirflow UI çš„é¡¶çº§èœå•ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°æ ‡ç­¾ï¼Œç§°ä¸º**é›†ç¾¤æ´»åŠ¨**ã€‚

![](img/27e0d7eabb941dfe0463b86345e65170.png)

ä¸» Airflow èœå•ä¸­çš„æ–°é›†ç¾¤æ´»åŠ¨æ ‡ç­¾â€”â€”æ¥æºï¼šä½œè€…

æ–°çš„é›†ç¾¤æ´»åŠ¨ç”¨æˆ·ç•Œé¢æ¦‚è§ˆäº†æ•´ä½“é›†ç¾¤çŠ¶æ€ï¼ŒåŒ…æ‹¬ç»„ä»¶å¥åº·ï¼ˆå¦‚ MetaDatabaseã€Schedulerã€Triggerer å’Œ DAG å¤„ç†å™¨ï¼‰ä»¥åŠ DAG/ä»»åŠ¡è¿è¡ŒçŠ¶æ€å’Œ DAG è¿è¡Œç±»å‹çš„è¯¦ç»†ä¿¡æ¯ã€‚

![](img/d2a707ee34b801b418698fe63baad245.png)

æ–°çš„é›†ç¾¤æ´»åŠ¨ç”¨æˆ·ç•Œé¢ä½œä¸º Airflow 2.7.0 ç‰ˆæœ¬çš„ä¸€éƒ¨åˆ†å‘å¸ƒâ€”â€”æ¥æºï¼šä½œè€…

## æŸ¥çœ‹æºä»£ç æœ€åä¸€æ¬¡è§£æçš„æ—¶é—´

è¿‡å»ï¼Œæˆ‘å¸¸å¸¸å› ä¸ºæ— æ³•ç¡®è®¤å¯¹ç‰¹å®š DAG æºä»£ç æ‰€åšçš„æ›´æ”¹æ˜¯å¦è¢«è§£æè€Œæ„Ÿåˆ°çƒ¦æ¼ã€‚æˆ‘é€šå¸¸éœ€è¦åˆ·æ–°é¡µé¢ï¼ˆå¤šæ¬¡ï¼‰å¹¶å¼€å§‹æŸ¥æ‰¾æºä»£ç ä¸­çš„ç‰¹å®šåŒºåŸŸï¼Œä»¥ç¡®ä¿è¿™äº›æ›´æ”¹å·²è¢«è§£æï¼Œä»è€Œé‡æ–°è§¦å‘ DAGã€‚

æ–°ç‰ˆæœ¬çš„ Airflow åœ¨ DAG çš„ä»£ç æ ‡ç­¾ä¸­å¼•å…¥äº†`Parsed at`å­—æ®µï¼ŒæŒ‡ç¤º DAG æºä»£ç æœ€åæ›´æ–°çš„æ—¶é—´æˆ³ã€‚

![](img/4022e9dc868f0d9251e108effe21c535.png)

æ–°çš„ä»£ç æ ‡ç­¾åŒ…æ‹¬ä¸€ä¸ªæ—¶é—´æˆ³ï¼ŒæŒ‡ç¤º DAG æºä»£ç ä¸Šæ¬¡è¢«è§£æçš„æ—¶é—´ â€” æ¥æºï¼šä½œè€…

ç®€å•ä½†æœ‰ç”¨çš„è¡¥å……ï¼

## é”®ç›˜å¿«æ·é”®æ”¯æŒ

Airflow ç½‘æ ¼è§†å›¾ç°åœ¨ä¹Ÿæ”¯æŒé”®ç›˜å¿«æ·é”®ã€‚è¿›å…¥ DAG çš„ç½‘æ ¼å±å¹•åï¼Œæ‚¨ä¼šæ³¨æ„åˆ°è¿‡æ»¤éƒ¨åˆ†ä¸‹æ–¹æœ‰ä¸€ä¸ªæ³¨é‡Šï¼Œè¡¨ç¤ºæ‚¨å¯ä»¥é€šè¿‡é”®å…¥ `shift` + `/` è®¿é—®æ”¯æŒçš„å¿«æ·é”®åˆ—è¡¨ã€‚

![](img/a3cc8e204c1a16977d4c8003c07c6298.png)

shift + / å¿«æ·é”®å°†åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å¿«æ·é”®ï¼Œä»¥ä¾¿ä¸ Airflow DAG å’Œä»»åŠ¡è¿›è¡Œäº¤äº’ â€” æ¥æºï¼šä½œè€…

æ‚¨å¯ä»¥é€šè¿‡é”®ç›˜å¿«æ·é”®æ‰§è¡Œçš„æ“ä½œåŒ…æ‹¬æ¸…é™¤ DAG è¿è¡Œä»¥åŠå°†å…¶æ ‡è®°ä¸ºæˆåŠŸæˆ–å¤±è´¥ç­‰ã€‚

![](img/b9bf3ddfe05e69e90eb1c9c0b84b90c6.png)

ä¸ Airflow DAG å’Œä»»åŠ¡äº¤äº’çš„å¿«æ·é”®å®Œæ•´åˆ—è¡¨ â€” æ¥æºï¼šä½œè€…

## å›¾è¡¨å’Œç”˜ç‰¹å›¾è§†å›¾é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚

ç”˜ç‰¹å›¾å’Œå›¾è¡¨è§†å›¾ç°åœ¨è¢«ç§»åŠ¨åˆ° DAG çš„ç½‘æ ¼è§†å›¾ä¸­ï¼Œè¿™æ ·åœ¨ä»»åŠ¡è¯¦ç»†ä¿¡æ¯ã€å›¾è¡¨ã€æ—¥å¿—å’Œç”˜ç‰¹è§†å›¾ä¹‹é—´å¯¼èˆªä¼šæ›´å®¹æ˜“ â€” å°¤å…¶æ˜¯åœ¨æŸ¥çœ‹æ›´å¤æ‚çš„ DAG æ—¶ã€‚

![](img/135d43aaf0d8f1c2f6378df7d9c21ebe.png)

ç°åœ¨ï¼Œå¯ä»¥åœ¨ç½‘æ ¼è§†å›¾ä¸‹æ‰¾åˆ°ç”˜ç‰¹å›¾å’Œå›¾è¡¨è§†å›¾ â€” æ¥æºï¼šä½œè€…

è¯·æ³¨æ„ï¼Œæ—§çš„å›¾è¡¨è§†å›¾å·²è¢«ç§»é™¤ï¼Œæ–°å›¾è¡¨è§†å›¾æ˜¯é»˜è®¤è§†å›¾ã€‚

## è®¾ç½®å’Œæ‹†è§£ä»»åŠ¡

åœ¨è®¾è®¡æ•°æ®ç®¡é“æ—¶ï¼Œé€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªèµ„æºæ¥æ‰§è¡ŒæŸé¡¹å·¥ä½œï¼Œç„¶åå°†å…¶æ‹†é™¤ã€‚æ–°çš„ Airflow ç‰ˆæœ¬å¼•å…¥äº†è®¾ç½®å’Œæ‹†è§£ä»»åŠ¡ï¼Œä½¿è¿™ç§æ¨¡å¼æˆä¸ºå¯èƒ½ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª DAGï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªè®¡ç®—èµ„æºï¼Œè¿è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼Œç„¶åæœ€åæ‹†é™¤å…ˆå‰åˆ›å»ºçš„èµ„æºã€‚é€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸‰ä¸ªä»»åŠ¡å¹¶æŒ‡å®šå¦‚ä¸‹çš„ä¾èµ–å…³ç³»ï¼š

```py
create_resource >> run_query >> delete_resource
```

ä½¿ç”¨æ–°åŠŸèƒ½ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥è½»æ¾åœ°å°†ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä»»åŠ¡åˆ†åˆ«æ ‡è®°ä¸ºè®¾ç½®å’Œæ‹†è§£ï¼š

```py
create_resource.as_setup() >> run_query >> delete_resource.as_teardown()
create_resource >> delete_resource

# equivalent notation
create_resource >> run_query >> delete_resource.as_teardown(setups=create_resource)
```

æ³¨æ„ï¼š

+   å½“ `run_query` ä»»åŠ¡è¢«æ¸…é™¤æ—¶ï¼Œ`create_resource`ï¼ˆè®¾ç½®ï¼‰å’Œ `delete_resource`ï¼ˆæ‹†è§£ï¼‰ä»»åŠ¡ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚

+   å½“ `run_query` å¤±è´¥æ—¶ï¼Œæ‹†è§£ä»»åŠ¡ `delete_resource` ä»ä¼šè¿è¡Œã€‚

+   `create_resource` å’Œ `delete_resource` çŠ¶æ€å°†ä¸å†ç”¨äºç¡®å®š DAG è¿è¡Œçš„æˆåŠŸã€‚è¿™æ„å‘³ç€å³ä½¿åªæœ‰ `run_query` ä»»åŠ¡æˆåŠŸï¼ŒDAG ä¹Ÿä¼šè¢«æ ‡è®°ä¸ºæˆåŠŸã€‚

## æ”¾å¼ƒå¯¹ç»ˆæ­¢ç”Ÿå‘½å‘¨æœŸçš„ Python 3.7 çš„æ”¯æŒã€‚

æ­¤å¤–ï¼ŒAirflow 2.7.0 å·²ç»æ”¾å¼ƒå¯¹ç»ˆæ­¢ç”Ÿå‘½å‘¨æœŸ Python 3.7 çš„æ”¯æŒã€‚ä¸ºäº†ä½¿ç”¨ Airflow 2.7.0ï¼Œæ‚¨éœ€è¦æ‹¥æœ‰ä»¥ä¸‹ Python ç‰ˆæœ¬ä¹‹ä¸€ï¼š

+   3.8

+   3.9

+   3.10

+   æˆ– 3.11

è¯·æ³¨æ„ï¼ŒPython 3.7 å·²ä¸å†å—åˆ° Python ç¤¾åŒºçš„æ”¯æŒã€‚å¦‚æœæ‚¨ä»åœ¨ä½¿ç”¨å®ƒï¼ˆå³ä½¿åœ¨ Airflow çš„ä¸Šä¸‹æ–‡ä¹‹å¤–ï¼‰ï¼Œè¯·ç¡®ä¿å‡çº§åˆ°æ›´é«˜ç‰ˆæœ¬ã€‚

## `airflow db migrate` å‘½ä»¤

`db init` å’Œ `db upgrade` å‘½ä»¤ç°å·²å¼ƒç”¨ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ `airflow db migrate` å‘½ä»¤æ¥åˆ›å»ºæˆ–å‡çº§ Airflow æ•°æ®åº“ã€‚

åŒæ ·ï¼Œ`load_default_connections` é…ç½®é€‰é¡¹ä¹Ÿå·²è¢«å¼ƒç”¨ã€‚ä¸ºäº†åˆ›å»ºé»˜è®¤è¿æ¥ï¼Œä½ éœ€è¦åœ¨è¿è¡Œ `airflow db migrate` åï¼Œæ‰§è¡Œ `airflow connections create-default-commenctions` å‘½ä»¤ã€‚

## ä¸€äº›å®‰å…¨æ›´æ–°

å¦‚å‰æ‰€è¿°ï¼Œæœ€æ–°çš„ Airflow ç‰ˆæœ¬ä¸»è¦é›†ä¸­åœ¨æå‡å®‰å…¨æ€§ä¸Šã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¸å®‰å…¨ç›¸å…³çš„æ›´æ”¹ï¼š

+   è¿æ¥æµ‹è¯•åŠŸèƒ½ç°åœ¨é»˜è®¤è¢«ç¦ç”¨ã€‚å¦‚æœä½ ä»ç„¶éœ€è¦å¯ç”¨å®ƒï¼Œä½ å¯ä»¥åœ¨ `airflow.cfg` çš„ `core` éƒ¨åˆ†ä¸­æŒ‡å®š `test_connection` æ ‡å¿—ï¼Œæˆ–é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ `AIRFLOW__CORE__TEST_CONNECTION`ã€‚

+   `/dags/*/dagRuns/*/taskInstances/*/xcomEntries/*` API ç«¯ç‚¹ç°åœ¨ç¦ç”¨äº† `deserialize` é€‰é¡¹

+   ç°åœ¨ï¼Œä½¿ç”¨ SMTP SSL è¿æ¥æ—¶ï¼Œä¸Šä¸‹æ–‡ä½¿ç”¨ Python çš„é»˜è®¤ `default_ssl_contest` ä¸Šä¸‹æ–‡

## å°è¯• Airflow 2.7

å¦‚æœä½ æƒ³æµ‹è¯•æ–°åŠŸèƒ½ï¼Œæˆ‘å»ºè®®é€šè¿‡åœ¨æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œ Airflow çš„ Docker ç‰ˆæœ¬æ¥è¿›è¡Œã€‚ä½ å¯ä»¥åœ¨ä¸‹é¢çš„é“¾æ¥ä¸­æ‰¾åˆ°ä¸€ä¸ªé€æ­¥æŒ‡å—ï¼Œå¸®åŠ©ä½ åœ¨ä¸åˆ°ä¸€åˆ†é’Ÿçš„æ—¶é—´å†…å¯åŠ¨å¹¶è¿è¡Œ Airflowã€‚

[## å¦‚ä½•ä½¿ç”¨ Docker æœ¬åœ°è¿è¡Œ Airflow](https://towardsdatascience.com/run-airflow-docker-1b83a57616fb?source=post_page-----505f7cda9fd4--------------------------------)

### åœ¨æœ¬åœ°æœºå™¨ä¸Šä½¿ç”¨ Docker è¿è¡Œ Airflow çš„é€æ­¥æŒ‡å—

[å¦‚ä½•ä½¿ç”¨ Docker è¿è¡Œ Airflow](https://towardsdatascience.com/run-airflow-docker-1b83a57616fb?source=post_page-----505f7cda9fd4--------------------------------)

## æœ€åçš„æƒ³æ³•..

è·Ÿä¸Šæœ€æ–°çš„ Airflow ç‰ˆæœ¬å¯ä»¥ç¡®ä¿ä½ è·å¾—æœ€æ–°çš„åŠŸèƒ½ä»¥åŠä»»ä½•æ–°çš„å®‰å…¨è¡¥ä¸ï¼Œä»è€Œé¿å…è®©è‡ªå·±å¤œä¸èƒ½å¯ã€‚

æœ€æ–°çš„ Airflow ç‰ˆæœ¬å¸¦æ¥äº†å¤§é‡çš„æ–°åŠŸèƒ½ã€æ”¹è¿›ã€é”™è¯¯ä¿®å¤ã€æ–‡æ¡£æ›´æ–°å’Œå®‰å…¨è¡¥ä¸ã€‚æµ‹è¯•ä¸€ä¸‹å®ƒæ˜¯å¾ˆé‡è¦çš„ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œå‡çº§ä½ çš„ç”Ÿäº§å®ä¾‹ï¼Œä»¥ä¾¿å……åˆ†åˆ©ç”¨è¿™äº›æ–°ç‰¹æ€§ï¼ŒåŒæ—¶å¢å¼ºå®‰å…¨æ€§ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»…è¦†ç›–äº† Airflow 2.7.0 ä¸­å¼•å…¥çš„ä¸€å°éƒ¨åˆ†æ›´æ”¹ã€‚ä½ å¯ä»¥åœ¨[å‘å¸ƒè¯´æ˜](https://airflow.apache.org/docs/apache-airflow/2.7.0/release_notes.html#airflow-2-7-0-2023-08-14)ä¸­æŸ¥çœ‹å®Œæ•´çš„æ›´æ”¹åˆ—è¡¨ã€‚

ğŸ‘‡**ä½ å¯èƒ½è¿˜ä¼šå–œæ¬¢çš„ç›¸å…³æ–‡ç« **ğŸ‘‡

[## å¦‚ä½•åœ¨ Airflow DAG ä¸­è·³è¿‡ä»»åŠ¡](https://towardsdatascience.com/airflow-skip-task-a5a6ab319378?source=post_page-----505f7cda9fd4--------------------------------) [å¦‚ä½•åœ¨ Airflow ä¸­è¿è¡Œ dbt](https://levelup.gitconnected.com/run-dbt-airflow-b6107d849ddb?source=post_page-----505f7cda9fd4--------------------------------)

### æ ¹æ®ç‰¹å®šæ¡ä»¶è·³è¿‡ Airflow DAG ä¸­çš„ä»»åŠ¡

[## å¦‚ä½•åœ¨ Airflow ä¸­è¿è¡Œ dbt](https://levelup.gitconnected.com/run-dbt-airflow-b6107d849ddb?source=post_page-----505f7cda9fd4--------------------------------) [å¦‚ä½•è·³è¿‡ Airflow DAG ä¸­çš„ä»»åŠ¡](https://towardsdatascience.com/airflow-skip-task-a5a6ab319378?source=post_page-----505f7cda9fd4--------------------------------)

### åœ¨ Apache Airflow ä¸Šè‡ªåŠ¨åŒ–æ¸²æŸ“ dbt é¡¹ç›®

[å¦‚ä½•åœ¨ Airflow ä¸­è¿è¡Œ dbt](https://levelup.gitconnected.com/run-dbt-airflow-b6107d849ddb?source=post_page-----505f7cda9fd4--------------------------------)
