- en: Producing insights with Generalized Additive Models (GAMs)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/producing-insights-with-generalized-additive-models-gams-cf2b68b1b847?source=collection_archive---------4-----------------------#2023-01-30](https://towardsdatascience.com/producing-insights-with-generalized-additive-models-gams-cf2b68b1b847?source=collection_archive---------4-----------------------#2023-01-30)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Learn how to interpret GAMs and extract useful insights from data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@alvarofps?source=post_page-----cf2b68b1b847--------------------------------)[![Alvaro
    Peña](../Images/49859139c2cf5e43239a25f1d82ef3fd.png)](https://medium.com/@alvarofps?source=post_page-----cf2b68b1b847--------------------------------)[](https://towardsdatascience.com/?source=post_page-----cf2b68b1b847--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----cf2b68b1b847--------------------------------)
    [Alvaro Peña](https://medium.com/@alvarofps?source=post_page-----cf2b68b1b847--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3884c9f0acaf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fproducing-insights-with-generalized-additive-models-gams-cf2b68b1b847&user=Alvaro+Pe%C3%B1a&userId=3884c9f0acaf&source=post_page-3884c9f0acaf----cf2b68b1b847---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----cf2b68b1b847--------------------------------)
    ·10 min read·Jan 30, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fcf2b68b1b847&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fproducing-insights-with-generalized-additive-models-gams-cf2b68b1b847&user=Alvaro+Pe%C3%B1a&userId=3884c9f0acaf&source=-----cf2b68b1b847---------------------clap_footer-----------)'
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fcf2b68b1b847&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fproducing-insights-with-generalized-additive-models-gams-cf2b68b1b847&source=-----cf2b68b1b847---------------------bookmark_footer-----------)![](../Images/44fc4956fbbacf15481d778898b30210.png)'
  prefs: []
  type: TYPE_NORMAL
- en: Photo by [A. L.](https://unsplash.com/@overdriv3?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: 'Today we are going to learn how to use Generalized Additive Models to predict
    the number of bicycles rented in Washington D.C. between 2011 and 2012\. This
    dataset was provided by the bike-sharing company: Capital Bikeshare. Bike-sharing
    systems are a new generation of service that allows users to pick up and drop
    off bicycles at convenient locations. Thus, promoting zero-emission transportation
    that has positive effects on traffic, the environment, and health issues.'
  prefs: []
  type: TYPE_NORMAL
- en: What are GAMs?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: “A generalized additive model is a generalized linear model with a linear predictor
    involving a sum of smooth functions of covariates” (Wood, 2017).
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: GAMs work the same way as linear regression by adding the estimated weights
    of their covariates. The biggest difference is that these weights represent flexible
    relationships as opposed to just linear ones and we use a link function to model
    the target variable.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can use this type of model for different applications: Model the spread
    of a disease over time using the Poisson distribution, predict if a patient has
    a disease based on numeric/categorical variables using the Binomial distribution
    (logistic regression), study the spatial behavior of a species over an area using
    latitude and longitude data. GAMs is a versatile framework that can be applied
    to almost any field.'
  prefs: []
  type: TYPE_NORMAL
- en: In our context, we could create a model that explains how the number of rented
    bikes changes due to the flexible behavior of time, humidity, and temperature.
    Additionally, the number of rented bikes behaves like a Normal distribution.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can write our model formally as:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c255ce44bf64607eabc6278a63eba60b.png)'
  prefs: []
  type: TYPE_IMG
- en: The mathematical expression of an example GAM
  prefs: []
  type: TYPE_NORMAL
- en: The functions f1, f2, and f3 allow us to model flexible relationships between
    the target and the explanatory variables. Finally, the sum of the estimated weights
    of those relationships is the predicted/estimated number of rented bikes. Before
    training a model we’ll describe the dataset and start with some exploratory data
    analysis to decide what explanatory variables to use.
  prefs: []
  type: TYPE_NORMAL
- en: Load libraries
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: The dataset
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let’s download the dataset from the Interpretable Machine Learning book GitHub
    repository, this data has been preprocessed and is ready for us to work on. Let’s
    explain each variable:'
  prefs: []
  type: TYPE_NORMAL
- en: '**season:** Season of the year.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**holiday:** If that day was a holiday or not.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**workingday:** If that day was workable or not, essentially weekend or not.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**weathersit:** The weather situation of that day, in three categories.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**temp:** Temperature in degrees Celsius.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**hum:** Relative humidity percentage.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**windspeed:** Wind speed in km/h.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**days_since_2011:** A timestep variable to account for the passing of time.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**cnt:** The number of bicycles rented.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**weekday:** Day of the week'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We are going to use the function below and summarize the variables of interest.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/bb7828953fc0916b582b4fa624bfc1f2.png)'
  prefs: []
  type: TYPE_IMG
- en: The output of the summary function
  prefs: []
  type: TYPE_NORMAL
- en: We have cleverly summarized our data with a single function, we have categorical
    and numerical data for each day. We have 730 entries in our dataset which is about
    two years worth of data.
  prefs: []
  type: TYPE_NORMAL
- en: Data exploration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Let’s start analyzing the numeric variables to check if they have any effect
    on the number of rented bikes.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/2e12ac0d9af89ff4e760e6c45472eb44.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 1\. Checking variable correlation
  prefs: []
  type: TYPE_NORMAL
- en: We used the *ggpairs* function to create this graphic where we can visualize
    what variables influence each other and spot patterns. In broad terms, we can
    see that temperature positively impacts the number of bikes rented (see the plot
    in the bottom-left corner). Let’s investigate the effect of temperature with the
    rest of the categorical variables that explain the weather situation and days.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8d6d7bef246d3eb1c070a227b4023046.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 2\. Weather situation by season and its effect on the number of rented bikes
  prefs: []
  type: TYPE_NORMAL
- en: Regardless of the season, if the weather is good the number of rented bikes
    will be higher compared to bad weather. For instance, during winter there have
    been three types of weather but on average the number of bikes is higher when
    the weather is not bad. Additionally, the number of rented bikes is significantly
    higher during summer compared to winter. Perhaps we should consider the weather
    situation for our model.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a543d4beae7eb9e3eda3eaa106bb80bf.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 3\. Effect of temperature within seasons and weather situations
  prefs: []
  type: TYPE_NORMAL
- en: The left plot confirms our findings, suggesting that good weather contributes
    significantly towards increasing the number of rented bikes. On the other hand,
    the right plot shows that temperature has a positive effect on colder seasons
    like Fall and Winter. Interestingly enough we observe a slight negative trend
    when temperatures get close to 30 degrees Celsius during Summer. Suggesting some
    cyclists don’t want to cycle in high heat.
  prefs: []
  type: TYPE_NORMAL
- en: Training a Generalized additive model (GAM)?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To train/fit a GAM in R, we’ll use the *mgcv* library. It’s a powerful and well-maintained
    library.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'Our model will predict the number of rented bikes taking into account the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '***weathersit:*** A different intercept for each weather situation will be
    estimated. What is an intercept? The average value of rented bikes that depends
    only on a given weather situation if all other variables are set to zero.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '***s(days_since_2011, bs = “cr”, k = 70)****:* This term means that we will
    use a cubic regression spline (smooth function) to estimate how the number of
    rented bikes changes over time. The ***k*** value, is the rank of the function
    which dictates how flexible it is. This will become clear later.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '***s(temp, by = season, k = 15)****:* This term estimates the effect of temperature
    during different seasons on the number of rented bikes. Because k is smaller it’s
    not as flexible as the term above.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '***season:*** A different intercept for each season because we are using a
    term that estimates temperature by season.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The sum of all these terms will result in the predictions of our model.
  prefs: []
  type: TYPE_NORMAL
- en: Summarizing and checking our model
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/edd6cf931438ea54fec565e4e246d6de.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 4\. Model summary
  prefs: []
  type: TYPE_NORMAL
- en: 'For starters, the model summary in Fig 4\. tells us the distribution and link
    function of the target variable. In our case: Gaussian (Normal) and identity function
    (variable was unchanged). We have the parametric coefficients or intercepts, we
    calculated an intercept for each season and for each weather situation (also called
    parametric effects). In the next block, the effective degrees of freedom of our
    smooth functions are presented. These values tell us how flexible the relationships
    are (essentially how much they differ from a linear relationship which would be
    edf = 1). Finally, we have the deviance explained which in our case is 88%. Our
    model explains 88% of the data.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/54217118adf09c0b53aef2bfef90593e.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 5\. Checking the model’s flexibility
  prefs: []
  type: TYPE_NORMAL
- en: The next bit of model checking in Fig 5\. has to do with the rank of the smooth
    functions. For instance, the first smooth function that explains the relationship
    between the number of bikes and time was given a rank of 70\. One of the ranks
    was used to calculate the intercept and the rest to model the relationship. The
    edf tells us how much of the available flexibility (69 ranks) was used by the
    used function. As a good rule of thumb, we want k to be larger than the edf and
    k-index to be larger than 1\. We also want a large p-value not a small one, which
    is often the case. In our case, we do not manage to obtain the latter two but
    we have given the functions enough flexibility as the edf demonstrate.
  prefs: []
  type: TYPE_NORMAL
- en: Interpreting smooth effects
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'This section will show how the smooth functions model complex relationships
    between the explanatory variables and the number of rented bikes. The graphics
    shown below can be created using the following function:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/f59620e434e7382abaa9e704b17fd7ee.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 6\. Non-linear relationship between time and rented bikes
  prefs: []
  type: TYPE_NORMAL
- en: One important thing to note is that all partial effect plots are centered on
    the mean and the shaded area represents the 95% confidence interval. This means
    that the increase or decrease shown in the y-axis is reflected in the average
    predicted value of rented bikes. For instance, one could interpret Fig 6\. by
    stating that during the first half of the days the number of bikes was lower than
    the average. We can also see that the relationship is quite flexible due to the
    30 effective degrees of freedom the function used.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8eb8e2b1eee8fca04c139a1d21dcc60e.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 7\. Effect of temperature on rented bikes during fall
  prefs: []
  type: TYPE_NORMAL
- en: The effect of temperature in Fig 7\. does not have a lot of flexibility but
    we can clearly spot some *“wiggliness”.* One important aspect to note is the rug
    plot on the x-axis which shows the number of data points. When there are no data
    points the confidence intervals get considerably larger because we are not certain
    about the relationship. We can interpret this plot by stating that during the
    Fall season the increase in temperature increases the number of rented bikes.
    More precisely we could say that when the temperature is about 5 degrees Celsius
    the predicted number of bikes is — 1200 (1200 lower) than the average.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/aa603ed8550b81593d82889e1411a3f2.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 8\. Effect of temperature on rented bikes during spring
  prefs: []
  type: TYPE_NORMAL
- en: During Spring the temperature behaves differently, the predicted number of bikes
    rises sharply when the temperatures goes from 4 to 20 degrees Celsius but after
    that, the predicted number of bikes starts to drop. We need to consider carefully
    the uncertainty around higher values of temperature, the rug plot indicates there
    are not many data points. Perhaps if there were more data that portion of the
    plot could show a flat curve?
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/393064990c9a7bc2eff52e20deef0f2e.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 9\. Effect of temperature on rented bikes during summer
  prefs: []
  type: TYPE_NORMAL
- en: Summer is very interesting because we see a decline during warmer days. In Fig
    9\. we can see that temperatures above 30 degrees Celsius have a negative effect
    on the predicted number of rented bikes, about — 2500 than the predicted average.
    It could be that cyclist are not keen on cycling during really warm days.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/cd96c5ce22490714e229f48b05bc26f7.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 10\. Effect of temperature on rented bikes during winter
  prefs: []
  type: TYPE_NORMAL
- en: Finally, during the Winter season as temperature rises more bikes are predicted
    to be rented. Note Fig 10\. shows an almost linear relationship corroborated by
    the 1.24 edf shown on the model summary. Although its certainly not as flexible
    as the other smooth functions it seems appropriate to model temperature by season.
    We could interpret this plot by stating that at 15 degrees Celsius during winter
    the predicted number of bikes is about the same as the average.
  prefs: []
  type: TYPE_NORMAL
- en: Next we are going to interpret the estimated intercept or parametric effects.
  prefs: []
  type: TYPE_NORMAL
- en: Interpreting parametric effects
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](../Images/8f8d63a77bb1714669a5a7fab51be29f.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 11\. Effect of season of the year on rented bikes
  prefs: []
  type: TYPE_NORMAL
- en: Fig 11\. shows the estimated parametric effects with a 95% confidence interval.
    We can interpret this plot by stating that during Spring the predicted number
    of bikes is 1489 lower than during fall. We are confident about this statement
    because the confidence interval do not include zero (our point of comparison).
    The effect of the Spring season would not be significant if the predictions also
    included the predictions from the fall season, right? We can make the same statement
    regarding the effect of Winter on the predicted number of bikes. On the other
    hand, the effect of summer is not significant because its confidence interval
    is quite large and includes zero. This indicates that during Summer our model
    predicts a quantity of rented bikes that could be predicted on fall too. We can
    extract an insight about this, the number of rented bikes rises not because of
    the Summer season but because of cold/mild temperatures getting warmer.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/99e34ab49a6496c28ea71cdfa7cec556.png)'
  prefs: []
  type: TYPE_IMG
- en: Fig 12\. Effect of the weather situations on rented bikes
  prefs: []
  type: TYPE_NORMAL
- en: Finally, Fig 12\. tell us that when the weather is misty or raining/snowing/storming
    the change on predicted bikes is significant (because the confidence do not include
    zero). In this case the effect is negative because we can state the the predicted
    number of rented bikes during a misty day is 690 lower than a day with good weather.
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We trained a Generalized Additive Model to predict the number of rented bikes
    in Washington D.C. based on the time variation, temperature change during seasons
    and overall weather situation. We learned how to read the model summary and check
    the effective degrees of freedom for a correct fit. Finally, we interpreted the
    smooth and parametric effects of the model to understand what drives the number
    of rented bikes and obtained the following insights:'
  prefs: []
  type: TYPE_NORMAL
- en: Cyclist tend to avoid renting bikes when the temperatures get too warm during
    the summer (above ~ 25 degrees Celsius).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The rise in rented bikes occurs during mild weather seasons that start to get
    warmer temperatures (fall and winter).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We have high confidence that rain/snow is a significant factor that negatively
    influences the number of rented bikes.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In conclusion, a GAM is a powerful machine learning framework that is vastly
    interpretable and can be used to extract insights from data. Turning noise into
    sentences.
  prefs: []
  type: TYPE_NORMAL
- en: '*All images unless otherwise noted are by the author.*'
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Wood, S.N., 2017\. *Generalized additive models: an introduction with R*. 2nd
    Edition. Chapman and hall/CRC.'
  prefs: []
  type: TYPE_NORMAL
- en: Code
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Can be found in my GitHub repo:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://github.com/alvarofps/Producing-Insights-with-GAMs](https://github.com/alvarofps/Producing-Insights-with-GAMs)'
  prefs: []
  type: TYPE_NORMAL
