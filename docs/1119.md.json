["```py\nhdx_data_categories_file = './data/Data Completeness Definitions  - version_1.csv'\ndg_categories = pd.read_csv(hdx_data_categories_file)\ndg_categories = dg_categories[\n    [\"Category\", \"Subcategory\", \"Definition\", \"Datagrid recipe category\"]\n]\ndg_categories[\"prompt_text\"] = dg_categories.apply(\n    lambda x: f\"- Category '{x['Category']} : {x['Subcategory']}' is defined as: {x['Definition']}\",\n    axis=1,\n)\n\ncategory_prompt_text = dg_categories[\"prompt_text\"].to_string(index=False, header=False)\ndisplay(category_prompt_text)\n```", "```py\n- Category \\'Affected People : Internally Displaced Persons\\' is defined as: Tabular data of the number of displaced people by location. Locations can be administrative divisions or other locations (such as camps) if an additional dataset defining those locations is also available.\\n                                              \n- Category \\'Affected People : Refugees and Persons of Concern\\' is defined as: Tabular data of the number of refugees and persons of concern either in the country or originating from the country disaggregated by their current location. Locations can be administrative divisions or other locations (such as camps) if an additional dataset defining those locations is also available or if the locations\\' coordinates are defined in the tabular data.\\n                                                                                                                                                                                                                                                                                                                                                                                  \n- Category \\'Affected People : Returnees\\' is defined as: Tabular data of the number of displaced people who have returned.\\n                                                                                                                                                                                                                                                                                                                      \n- Category \\'Affected People : Humanitarian Needs\\' is defined as: Tabular data of the number of people in need of humanitarian assistance by location and humanitarian cluster/sector.\\n                                                                                                                                                                                                                                                                                       \n- Category \\'Coordination & Context : 3W - Who is doing what where\\' is defined as: List of organisations working on humanitarian issues, by humanitarian cluster/sector and disaggregated by administrative division.\\n                                                                                                                                                                                                                                                                                                                                                                                                                         \n- Category \\'Coordination & Context : 3W - Who is doing what where\\' is defined as: \\n                                                                                                                                                                                                                                                                        \n- Category \\'Coordination & Context : 3W - Who is doing what where\\' is defined as: Note: An exception for the subnational rule is made for the IATI dataset which, if available, should always be included as an incomplete dataset.\\n                                                                                                                                                                                                                                                                                                                                                           \n- Category \\'Coordination & Context : Funding\\' is defined as: Tabular data listing the amount of funding provided by humanitarian cluster/sector.\\n                                                                                                                                                                                                                                                                                                                                                                                                                                              \n- Category \\'Coordination & Context : Funding\\' is defined as: \\n                                                                                                                                                                                                                                                                                                 \n- Category \\'Coordination & Context : Funding\\' is defined as: Note: An exception for the subnational rule is made for the FTS dataset which, if available, should always be included as a complete dataset.\\n                                                                                                                                                                                                                                                                                                                               \n- Category \\'Coordination & Context : Conflict Events\\' is defined as: Vector data or tabular data with coordinates describing the location, date, and type of conflict event.\\n                                                                                                                                                                                                                                              \n- Category \\'Coordination & Context : Humanitarian Access\\' is defined as: Tabular or vector data describing the location of natural hazards, permissions, active fighting, or other access constraints that impact the delivery of humanitarian interventions.\\n                                                              \n- Category \\'Coordination & Context : Climate Impact\\' is defined as: Tabular or vector data containing current and historical impacts of climate events relating to floods, droughts and storms. The data should specify the location of the event, date of the event, and contain at least one indicator of impact such as spatial extent of event, disruption to affected populations, destroyed infrastructure, and/or affected vegetation.\\n                                                                                                                                                                                                                                      \n- Category \\'Food Security & Nutrition : Food Security\\' is defined as: Vector data representing the IPC/CH acute food insecurity phase classification or tabular data representing population or percentage of population by IPC/CH phase and administrative division.\\n                                                                                                                                                                                                                                                                                                \n- Category \\'Food Security & Nutrition : Acute Malnutrition\\' is defined as: Tabular data specifying the global acute malnutrition (GAM) or severe acute malnutrition (SAM) rate\\xa0 by administrative division.\\n                                                                                                                                                                                                                                                                                                                                                                  \n- Category \\'Food Security & Nutrition : Food Prices\\' is defined as: Time series prices for common food commodities at a set of locations.\\n- Category \\'Geography & Infrastructure : Administrative Divisions\\' is defined as: Vector geographic data describing the sub-national administrative divisions of a location, usually a country, including the names and unique identifiers, usually p-codes, of each administrative division. To be considered \"complete\", and included here, the humanitarian community working in the location has to have endorsed a preferred set of administrative boundaries as the Common Operational Dataset (COD).\\n                                                                                                                                                                                                                                                                                                            \n- Category \\'Geography & Infrastructure : Populated Places\\' is defined as: Vector data or tabular data with coordinates representing the location of populated places (cities, towns, villages).\\n                                                                                                                                                                           \n- Category \\'Geography & Infrastructure : Roads\\' is defined as: Geographic data describing the location of roads with some indication of the importance of each road segment in the transportation network. The data should exclude or indicate roads that are not usable by typical four-wheel-drive vehicles (footpaths, etc.).\\n                                                                                                                                                                                                                                                                              \n- Category \\'Geography & Infrastructure : Airports\\' is defined as: Geographic data representing all operational airports including a name or other unique identifier and an indication of what types of aircraft can use each.\\n                                                                                                                                                                                                                                                                                      \n- Category \\'Health & Education : Health Facilities\\' is defined as: Vector data or tabular data with coordinates representing health facilities with some indication of the type of facility (clinic, hospital, etc.).\\n                                                                                                                                                                                                                                                                              \n- Category \\'Health & Education : Education Facilities\\' is defined as: Vector data or tabular data with coordinates representing education facilities with some indication of the type of facility (school, university, etc.).\\n                                                                                                                                                                                                                                                                                                                                 \n- Category \\'Population & Socio-economy : Baseline Population\\' is defined as: Total population disaggregated age and sex categories, aggregated by administrative division.\\n                                                                                                                                                                                                                                                             \n- Category \\'Population & Socio-economy : Poverty Rate\\' is defined as: Population living under a defined poverty threshold, aggregated by administrative division and represented as a percentage of total population or as an absolute number.'\n```", "```py\nfilename = \"./data/number-of-acreage-under-irrigation.xlsx\"\ndf = pd.read_excel(filename, sheet_name=\"Sheet1\")\ndf = df.fillna(\"\")\ndisplay(df)\n```", "```py\ncsv_as_str = df[0:20].to_csv(index=False)\nprint(csv_as_str)\n\nUnnamed: 0,Unnamed: 1,Unnamed: 2,Unnamed: 3,Unnamed: 4,Unnamed: 5,Unnamed: 6,Unnamed: 7,Unnamed: 8,Unnamed: 9,Unnamed: 10,Unnamed: 11\nTable 3: Number of acreage under irrigation,,,,,,,,,,,\n,,OVERALL,,Sub county,,,,,,,\n,,,,Chepalungu,,,,Bomet Central,,,\n,,,,Male,,Female,,Male,,Female,\n,,N,%,N,%,N,%,N,%,N,%\nWhat is the average size of land you own that is currently under irrigation?,0 - 2 acres,22,2.8%,4,2.2%,10,3.8%,3,1.7%,5,2.9%\n,2 - 5 acres,6,.8%,2,1.1%,2,.8%,0,0.0%,2,1.2%\n,5 - 10 acres,1,.1%,0,0.0%,0,0.0%,0,0.0%,1,.6%\n,More than 10 acres,0,0.0%,0,0.0%,0,0.0%,0,0.0%,0,0.0%\n,None,760,96.3%,176,96.7%,251,95.4%,170,98.3%,163,95.3%\n,Total,789,100.0%,182,100.0%,263,100.0%,173,100.0%,171,100.0%\n```", "```py\nprompts    = []\nprompts.append(f\"Here is a list of HDX data categories with their definition: \\n\\n {category_prompt_text} \\n\\n\")\nprompts.append(f\"Does the following table from file {filename} fall into one of the categories provided, if not say no. \"\\\n               f\"If it does, which category and explain why? \\n\\n {csv_as_str} \\n\\n\")\n```", "```py\nHere is a list of HDX data categories with their definition:\n\n- Category \\'Affected People : Internally Displaced Persons\\' is defined as: Tabular data of the number of displaced people by location. Locations can be administrative divisions or other locations (such as camps) if an additional dataset defining those locations is also available.\\n                                              \n- Category \\'Affected People : Refugees and Persons of Concern\\' is defined as: Tabular data of the number of refugees and persons of concern either in the country or originating from the country disaggregated by their current location. Locations can be administrative divisions or other locations (such as camps) if an additional dataset defining those locations is also available or if the locations\\' coordinates are defined in the tabular data.\\n                                                                                                                                                                                                                                                                                                                                                                                  \n- Category \\'Affected People : Returnees\\' is defined as: Tabular data of the number of displaced people who have returned.\\n                                                                                                                                                                                                                                                                                                                      \n- Category \\'Affected People : Humanitarian Needs\\' is defined as: Tabular data of the number of people in need of humanitarian assistance by location and humanitarian cluster/sector.\\n                                                                                                                                                                                                                                                                                       \n- Category \\'Coordination & Context : 3W - Who is doing what where\\' is defined as: List of organisations working on humanitarian issues, by humanitarian cluster/sector and disaggregated by administrative division.\\n                                                                                                                                                                                                                                                                                                                                                                                                                         \n- Category \\'Coordination & Context : 3W - Who is doing what where\\' is defined as: \\n                                                                                                                                                                                                                                                                        \n- Category \\'Coordination & Context : 3W - Who is doing what where\\' is defined as: Note: An exception for the subnational rule is made for the IATI dataset which, if available, should always be included as an incomplete dataset.\\n                                                                                                                                                                                                                                                                                                                                                           \n- Category \\'Coordination & Context : Funding\\' is defined as: Tabular data listing the amount of funding provided by humanitarian cluster/sector.\\n                                                                                                                                                                                                                                                                                                                                                                                                                                              \n- Category \\'Coordination & Context : Funding\\' is defined as: \\n                                                                                                                                                                                                                                                                                                 \n- Category \\'Coordination & Context : Funding\\' is defined as: Note: An exception for the subnational rule is made for the FTS dataset which, if available, should always be included as a complete dataset.\\n                                                                                                                                                                                                                                                                                                                               \n- Category \\'Coordination & Context : Conflict Events\\' is defined as: Vector data or tabular data with coordinates describing the location, date, and type of conflict event.\\n                                                                                                                                                                                                                                              \n- Category \\'Coordination & Context : Humanitarian Access\\' is defined as: Tabular or vector data describing the location of natural hazards, permissions, active fighting, or other access constraints that impact the delivery of humanitarian interventions.\\n                                                              \n- Category \\'Coordination & Context : Climate Impact\\' is defined as: Tabular or vector data containing current and historical impacts of climate events relating to floods, droughts and storms. The data should specify the location of the event, date of the event, and contain at least one indicator of impact such as spatial extent of event, disruption to affected populations, destroyed infrastructure, and/or affected vegetation.\\n                                                                                                                                                                                                                                      \n- Category \\'Food Security & Nutrition : Food Security\\' is defined as: Vector data representing the IPC/CH acute food insecurity phase classification or tabular data representing population or percentage of population by IPC/CH phase and administrative division.\\n                                                                                                                                                                                                                                                                                                \n- Category \\'Food Security & Nutrition : Acute Malnutrition\\' is defined as: Tabular data specifying the global acute malnutrition (GAM) or severe acute malnutrition (SAM) rate\\xa0 by administrative division.\\n                                                                                                                                                                                                                                                                                                                                                                  \n- Category \\'Food Security & Nutrition : Food Prices\\' is defined as: Time series prices for common food commodities at a set of locations.\\n- Category \\'Geography & Infrastructure : Administrative Divisions\\' is defined as: Vector geographic data describing the sub-national administrative divisions of a location, usually a country, including the names and unique identifiers, usually p-codes, of each administrative division. To be considered \"complete\", and included here, the humanitarian community working in the location has to have endorsed a preferred set of administrative boundaries as the Common Operational Dataset (COD).\\n                                                                                                                                                                                                                                                                                                            \n- Category \\'Geography & Infrastructure : Populated Places\\' is defined as: Vector data or tabular data with coordinates representing the location of populated places (cities, towns, villages).\\n                                                                                                                                                                           \n- Category \\'Geography & Infrastructure : Roads\\' is defined as: Geographic data describing the location of roads with some indication of the importance of each road segment in the transportation network. The data should exclude or indicate roads that are not usable by typical four-wheel-drive vehicles (footpaths, etc.).\\n                                                                                                                                                                                                                                                                              \n- Category \\'Geography & Infrastructure : Airports\\' is defined as: Geographic data representing all operational airports including a name or other unique identifier and an indication of what types of aircraft can use each.\\n                                                                                                                                                                                                                                                                                      \n- Category \\'Health & Education : Health Facilities\\' is defined as: Vector data or tabular data with coordinates representing health facilities with some indication of the type of facility (clinic, hospital, etc.).\\n                                                                                                                                                                                                                                                                              \n- Category \\'Health & Education : Education Facilities\\' is defined as: Vector data or tabular data with coordinates representing education facilities with some indication of the type of facility (school, university, etc.).\\n                                                                                                                                                                                                                                                                                                                                 \n- Category \\'Population & Socio-economy : Baseline Population\\' is defined as: Total population disaggregated age and sex categories, aggregated by administrative division.\\n                                                                                                                                                                                                                                                             \n- Category \\'Population & Socio-economy : Poverty Rate\\' is defined as: Population living under a defined poverty threshold, aggregated by administrative division and represented as a percentage of total population or as an absolute number.'\n```", "```py\nDoes the following table from file ./data/number-of-acreage-under-irrigation.xlsx fall into one of the categories provided, if not say no. If it does, which category and explain why? \n\nUnnamed: 0,Unnamed: 1,Unnamed: 2,Unnamed: 3,Unnamed: 4,Unnamed: 5,Unnamed: 6,Unnamed: 7,Unnamed: 8,Unnamed: 9,Unnamed: 10,Unnamed: 11\\nTable 3: Number of acreage under irrigation,,,,,,,,,,,\n,,OVERALL,,Sub county,,,,,,,\n,,,,Chepalungu,,,,Bomet Central,,,\n,,,,Male,,Female,,Male,,Female,\n,,N,%,N,%,N,%,N,%,N,%\nWhat is the average size of land you own that is currently under irrigation?,0 - 2 acres,22,2.8%,4,2.2%,10,3.8%,3,1.7%,5,2.9%\n,2 - 5 acres,6,.8%,2,1.1%,2,.8%,0,0.0%,2,1.2%\n,5 - 10 acres,1,.1%,0,0.0%,0,0.0%,0,0.0%,1,.6%\n,More than 10 acres,0,0.0%,0,0.0%,0,0.0%,0,0.0%,0,0.0%\n,None,760,96.3%,176,96.7%,251,95.4%,170,98.3%,163,95.3%\n,Total,789,100.0%,182,100.0%,263,100.0%,173,100.0%,171,100.0%\n```", "```py\ndef prompt_model(prompts, temperature=0.0, model=\"gpt-4\"):\n    messages = [{\"role\": \"system\", \"content\": \"You are a helpful assistant.\"}]\n    for prompt in prompts:\n        messages.append({\"role\": \"user\", \"content\": prompt})\n        response = ai.ChatCompletion.create(\n            model=model, temperature=temperature, messages=messages\n        )\n    return response[\"choices\"][0][\"message\"][\"content\"]\n\nprompts = []\nprompts.append(\n    f\"Here is a list of HDX data categories with their definition: \\n\\n {category_prompt_text} \\n\\n\"\n)\nprompts.append(\n    f\"Does the following table from file {filename} fall into one of the categories provided, if not say no. \"\n    f\"If it does, which category and explain why? \\n\\n {csv_as_str} \\n\\n\"\n)\n\nfor model in [\"gpt-3.5-turbo\", \"gpt-4\"]:\n    response = prompt_model(prompts, temperature=0.0, model=model)\n    print(f\"\\n{model} Model response: \\n\\n{response}\")\n```", "```py\ngpt-3.5-turbo Model response: \n\nNo, the table does not fall into any of the categories provided. \nThe table is about the number and percentage of people who own land of \ndifferent sizes that are currently under irrigation. \nIt does not provide any information about the number of affected people, \ncoordination and context, food security and nutrition, geography and \ninfrastructure, health and education, or population and socio-economy.\n\ngpt-4 Model response: \n\nThe table from the file ./data/number-of-acreage-under-irrigation.xlsx \ndoes not fall into any of the provided HDX data categories. \nThe table provides information about the number of acreage under \nirrigation in different sub-counties and is not related to any of the \ncategories mentioned, such as affected people, coordination & context, \nfood security & nutrition, geography & infrastructure, health & education, \nor population & socio-economy.\n```", "```py\ndate,admin1,admin2,market,latitude,longitude,category,commodity,unit,priceflag,pricetype,currency,price,usdprice\n#date,#adm1+name,#adm2+name,#loc+market+name,#geo+lat,#geo+lon,#item+type,#item+name,#item+unit,#item+price+flag,#item+price+type,#currency,#value,#value+usd\n2003-10-15,Barh El Gazal,Barh El Gazel Sud,Moussoro,13.640841,16.490069,cereals and tubers,Maize,KG,actual,Retail,XAF,134.0,0.2377\n2003-10-15,Barh El Gazal,Barh El Gazel Sud,Moussoro,13.640841,16.490069,cereals and tubers,Millet,KG,actual,Retail,XAF,147.0,0.2608\n2003-10-15,Lac,Mamdi,Bol,13.5,14.683333,cereals and tubers,Maize,KG,actual,Retail,XAF,81.0,0.1437\n2003-10-15,Lac,Mamdi,Bol,13.5,14.683333,cereals and tubers,Maize (white),KG,actual,Retail,XAF,81.0,0.1437\n2003-10-15,Logone Occidental,Lac Wey,Moundou,8.5666667,16.0833333,cereals and tubers,Millet,KG,actual,Retail,XAF,95.0,0.1685\n2003-10-15,Logone Occidental,Lac Wey,Moundou,8.5666667,16.0833333,cereals and tubers,Sorghum,KG,actual,Retail,XAF,62.0,0.11\n2003-10-15,Logone Occidental,Lac Wey,Moundou,8.5666667,16.0833333,cereals and tubers,Sorghum (red),KG,actual,Retail,XAF,62.0,0.11\n2003-10-15,Moyen Chari,Barh-K h,Sarh,9.1429,18.3923,cereals and tubers,Millet,KG,actual,Retail,XAF,100.0,0.1774\n2003-10-15,Moyen Chari,Barh-K h,Sarh,9.1429,18.3923,cereals and tubers,Sorghum,KG,actual,Retail,XAF,90.0,0.1597\n2003-10-15,Moyen Chari,Barh-K h,Sarh,9.1429,18.3923,cereals and tubers,Sorghum (red),KG,actual,Retail,XAF,90.0,0.1597\n2003-10-15,Ndjaména,Ndjamena,Ndjamena,12.11,15.04,cereals and tubers,Maize,KG,actual,Retail,XAF,132.0,0.2342\n2003-10-15,Ndjaména,Ndjamena,Ndjamena,12.11,15.04,cereals and tubers,Maize (white),KG,actual,Retail,XAF,132.0,0.2342\n2003-10-15,Ndjaména,Ndjamena,Ndjamena,12.11,15.04,cereals and tubers,Millet,KG,actual,Retail,XAF,110.0,0.1952\n2003-10-15,Ndjaména,Ndjamena,Ndjamena,12.11,15.04,cereals and tubers,Rice (imported),KG,actual,Retail,XAF,396.0,0.7026\n2003-10-15,Ndjaména,Ndjamena,Ndjamena,12.11,15.04,cereals and tubers,Rice (local),KG,actual,Retail,XAF,297.0,0.5269\n2003-10-15,Ndjaména,Ndjamena,Ndjamena,12.11,15.04,cereals and tubers,Sorghum,KG,actual,Retail,XAF,100.0,0.1774\n2003-10-15,Ndjaména,Ndjamena,Ndjamena,12.11,15.04,cereals and tubers,Sorghum (red),KG,actual,Retail,XAF,100.0,0.1774\n2003-10-15,Ouaddai,Ouara,Abeche,13.8166667,20.8166667,cereals and tubers,Millet,KG,actual,Retail,XAF,155.0,0.275\n2003-10-15,Ouaddai,Ouara,Abeche,13.8166667,20.8166667,cereals and tubers,Sorghum,KG,actual,Retail,XAF,97.0,0.1721\n```", "```py\ngpt-3.5-turbo Model response: \n\nYes, the table falls into the category 'Food Security & Nutrition : Food Prices'. \nThis is because the table contains time series prices for common food \ncommodities at different locations.\n\ngpt-4 Model response: \n\nYes, the table falls into the category \"Food Security & Nutrition : Food Prices\". \nThis is because the table contains time series prices for common \nfood commodities (such as Maize, Millet, and Sorghum) at various \nlocations (markets) with their respective coordinates (latitude and longitude). \nThe data also includes information on the date, administrative divisions, \nand currency.\n```", "```py\n[\n    {\n       \"filename\":\"<DATASET NAME>/<FILE NAME 1>\",\n       \"format\": \"EXCEL\",\n       \"sheet\": \"<SHEET 1>\",\n       \"table_excerpt\": \"<FIRST 20 ROWS OF TABLE IN CSV FORMAT>\"  \n    },\n    {\n       \"filename\":\"<DATASET NAME>/<FILE NAME 1>\",\n       \"format\": \"EXCEL\",\n       \"sheet\": \"<SHEET 2>\",\n       \"table_excerpt\": \"<FIRST 20 ROWS OF TABLE IN CSV FORMAT>\"  \n    },\n    {\n       \"filename\":\"<DATASET NAME>/<FILE NAME 2>\",\n       \"format\": \"CSV\",\n       \"sheet\": \"\",\n       \"table_excerpt\": \"<FIRST 20 ROWS OF TABLE IN CSV FORMAT>\"  \n    },\n    {\n       \"filename\":\"<DATASET NAME>/<FILE NAME 3>\",\n       \"format\": \"EXCEL\",\n       \"sheet\": \"<SHEET 1>\",\n       \"table_excerpt\": \"<FIRST 20 ROWS OF TABLE IN CSV FORMAT>\"  \n    },\n    ... etc\n]\n```", "```py\ndef predict(data_excerpts, temperature=0.0):\n    results = []\n    for index, row in data_excerpts.iterrows():\n        dataset = row[\"name\"]\n        title = row[\"title\"]\n        print(\n            f\"\\n========================================= {dataset} =============================================\\n\"\n        )\n\n        prompts = []\n\n        # Start the prompt by defining the categories we want to assign\n        prompts.append(\n            f\"Here is a list of HDX data categories with their definition: \\n\\n {category_prompt_text} \\n\\n\"\n        )\n        prompts.append(\n            f\"Here are excerpts from all the tables in this dataset: {title} ...\\n\\n\"\n        )\n\n        # Build multiple prompts for each table excerpt for this dataset\n        tables = row[\"table_excerpts\"]\n        for table in tables:\n            table = json.loads(table)\n            csv_as_str = table[\"table_excerpt\"]\n            sheet = table[\"sheet\"]\n            type = table[\"type\"]\n            filename = table[\"filename\"]\n            print(f\"DATA > {filename} / {sheet}\")\n            prompts.append(\n                f\"Type {type} sheet {sheet} from file {filename} Table excerpt: \\n\\n {csv_as_str} \\n\\n\"\n            )\n\n        # Finish up with our request\n        prompts.append(\n            \"Does the dataset fall into exactly one of the categories mentioned above, if not say no. \"\n            \"If it does, add a pipe charatcter '|' before and after the top category and sub-category category and explain why it was chosen step-by-step.\\n\\n\"\n            \"What is the second most likely category if you had to pick one (adding a ^ character either side)? \\n\\n\"\n        )\n\n        actual_category = row[\"datagrid_category\"]\n        d = {\n            \"dataset_name\": dataset,\n            \"filename\": filename,\n            \"prompts\": prompts,\n            \"actual_category\": actual_category,\n        }\n\n        # Send our prompt array to two models\n        for model in [\"gpt-3.5-turbo\", \"gpt-4\"]:\n            # for model in ['gpt-3.5-turbo']:\n            # GPT-4 is in test and can fail sometimes\n            try:\n                print(f\"\\nCalling model {model}\")\n                response = prompt_model(prompts, temperature=temperature, model=model)\n                if \"|\" in response:\n                    predicted_category = response.split(\"|\")[1].strip()\n                else:\n                    predicted_category = response\n                print(f\"\\n{model} Model response: \\n\\n{response}\")\n                match = actual_category == predicted_category\n                d[f\"{model}_response\"] = response\n                d[f\"{model}_predicted_category\"] = predicted_category\n                d[f\"{model}_match\"] = match\n                print(\n                    f\"******* RESULT: || {match} || prediced {predicted_category}, actual {actual_category} *******\"\n                )\n            except Exception as e:\n                print(e)\n        results.append(d)\n\n    results = pd.DataFrame(results)\n    return results \n```", "```py\nHere is a list of HDX data categories with their definition: \n- Category \\'Affected People : Internally Displaced Persons\\' is defined as: Tabular data of the number of displaced people by location. Locations can be administrative divisions or other locations (such as camps) if an additional dataset defining those locations is also available.\\n                                              \n- Category \\'Affected People : Refugees and Persons of Concern\\' is defined as: Tabular data of the number of refugees and persons of concern either in the country or originating from the country disaggregated by their current location. Locations can be administrative divisions or other locations (such as camps) if an additional dataset defining those locations is also available or if the locations\\' coordinates are defined in the tabular data.\\n                                                                                                                                                                                                                                                                                                                                                                                  \n- Category \\'Affected People : Returnees\\' is defined as: Tabular data of the number of displaced people who have returned.\\n\n... etc \n```", "```py\nHere are excerpts from all the tables in this colombia-health-facilities-2021: ...\n```", "```py\nType XLSX sheet servicios from file ./data/prompts/colombia-health-facilities-2021/fservicios.xlsx Table excerpt: \\\n,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\n0,depa_nombre,muni_nombre,habi_codigo_habilitacion,codigo_habilitacion,numero_sede,sede_nombre,nivel,grse_codigo,grse_nombre,serv_codigo,serv_nombre,ambulatorio,hospitalario,unidad_movil,domiciliario,otras_extramural,centro_referencia,institucion_remisora,complejidad_baja,complejidad_media,complejidad_alta\n1,Amazonas,LETICIA,9100100019,9100100019,01,E.S.E. HOSPITAL SAN RAFAEL,2,7,Apoyo Diagnóstico y Complementación Terapéutica,706,LABORATORIO CLÍNICO,SI,SI,NO,NO,NO,NO,NO,NO,SI,NO\n2,Amazonas,LETICIA,9100100019,9100100019,01,E.S.E. HOSPITAL SAN RAFAEL,2,7,Apoyo Diagnóstico y Complementación Terapéutica,712,TOMA DE MUESTRAS DE LABORATORIO CLÍNICO,SI,SI,SI,NO,NO,NO,NO,SI,NO,NO\\n3,Amazonas,LETICIA,9100100019,9100100019,01,E.S.E. HOSPITAL SAN RAFAEL,2,7,Apoyo Diagnóstico y Complementación Terapéutica,714,SERVICIO FARMACÉUTICO,SI,SI,NO,NO,NO,NO,NO,SI,NO,NO\n... etc\n\nType XLSX sheet capacidad from file ./data/prompts/colombia-health-facilities-2021/fcapacidad.xlsx Table excerpt: \n,0,1,2,3,4,5,6,7,8,9,10\\n0,depa_nombre,muni_nombre,codigo_habilitacion,numero_sede,sede_nombre,nivel,grupo_capacidad,coca_nombre,cantidad,modalidad,modelo\n1,Amazonas,EL ENCANTO,9126300019,11,CENTRO DE SALUD SAN RAFAEL - E.S.E HOSPITAL SAN RAFAEL DE LETICIA,2,CAMAS,Pediátrica,1,,0\n2,Amazonas,EL ENCANTO,9126300019,11,CENTRO DE SALUD SAN RAFAEL - E.S.E HOSPITAL SAN RAFAEL DE LETICIA,2,CAMAS,Adultos,3,,0\n... etc\n```", "```py\nDoes the dataset fall into exactly one of the categories mentioned above, if not say no. \nIf it does, add a pipe charatcter '|' before and after the top category and sub-category category and explain why it was chosen step-by-step.\nWhat is the second most likely category if you had to pick one (adding a ^ character either side)? \n```", "```py\noutput_folder = \"./data/prompts\"\ndata_excerpts = pd.read_pickle(f\"{output_folder}/datasets_excerpts.pkl\")\ndata_excerpts = data_excerpts[data_excerpts[\"is_datagrid\"] == True]\ndata_excerpts = data_excerpts.sample(min(150, data_excerpts.shape[0]), random_state=42)\n\nresults = predict(data_excerpts, temperature=0.0)\nresults.to_excel(f\"{output_folder}/results.xlsx\")\n```", "```py\ndef output_prediction_metrics(results, prediction_field=\"predicted_post_processed\", actual_field=\"actual_category\"):\n    \"\"\"\n    Prints out model performance report if provided results.\n\n    Parameters\n    ----------\n    results : list\n        Where each element has fields as defined by ...\n    prediction_field : str\n        Field name of element with prediction\n    actual_field : str\n        Field name of element with actual value\n    \"\"\"\n    y_test = []\n    y_pred = []\n    for index, r in results.iterrows():\n        if actual_field not in r:\n            print(\"Provided results do not contain expected values.\")\n            sys.exit()\n        y_pred.append(r[prediction_field])\n        y_test.append(r[actual_field])\n\n    print(f\"Results for {prediction_field}, {len(results)} predictions ...\\n\")\n    print(f\"Accuracy: {round(accuracy_score(y_test, y_pred),2)}\")\n    print(\n        f\"Precision: {round(precision_score(y_test, y_pred, average='weighted', zero_division=0),2)}\"\n    )\n    print(\n        f\"Recall: {round(recall_score(y_test, y_pred, average='weighted', zero_division=0),2)}\"\n    )\n    print(\n        f\"F1: {round(f1_score(y_test, y_pred, average='weighted', zero_division=0),2)}\"\n    )\n\n    return \n\nresults.fillna(\"\", inplace=True)\n\nprint(\"\\ngpt-3.5-turbo ...\")\noutput_prediction_metrics(results, prediction_field=\"gpt-3.5-turbo_predicted_category\", actual_field=\"actual_category\")\n\nprint(\"\\ngpt-4 ...\")\noutput_prediction_metrics(results, prediction_field=\"gpt-4_predicted_category\", actual_field=\"actual_category\")\n```", "```py\nResults for **gpt-3.5**-turbo_predicted_category_1, 53 predictions ...\n\nAccuracy: 0.66\nPrecision: 0.86\nRecall: 0.66\nF1: 0.68\n\nResults for **gpt-4**_predicted_category_1, 53 predictions ...\n\nAccuracy: 0.96\nPrecision: 0.97\nRecall: 0.96\nF1: 0.96\n```", "```py\nResults for **gpt-3.5**-turbo_predicted_category, 53 predictions ...\n\nAccuracy: 0.57\nPrecision: 0.73\nRecall: 0.57\nF1: 0.60\n\nResults for **gpt-4**_predicted_category, 53 predictions ...\n\nAccuracy: 0.89\nPrecision: 0.92\nRecall: 0.89\nF1: 0.89\n```", "```py\ndf = results.loc[results[\"gpt-4_match\"] == False]\n\nfor index, row in df.iterrows():\n    response = row[\"gpt-4_response\"]\n    predicted_second_category = response.split(\"^\")[1].strip()\n    print(f\"Dataset: {row['dataset_name']}\")\n    # print(f\"Dataset: {row['filename']}\")\n    print(\"\")\n    print(f\"Actual: {row['actual_category']}\")\n    print(f\"Predicted category: {row['gpt-4_predicted_category']}\")\n    print(f\"Predicted second category: {predicted_second_category}\\n\")\n    print(\n        f\"Secondary category matched: {predicted_second_category == row['actual_category']}\"\n    )\n    print(\"=====================================================\")\n```", "```py\nDataset: mozambique-attacks-on-aid-operations-education-health-and-protection\n\nActual: Coordination & Context : Humanitarian Access\nPredicted category: Coordination & Context : Conflict Events\nPredicted second category: Health & Education : Health Facilities\n\nSecondary category matched: False\n=====================================================\nDataset: iraq-violence-against-civilians-and-vital-civilian-facilities\n\nActual: Coordination & Context : Humanitarian Access\nPredicted category: Coordination & Context : Conflict Events\nPredicted second category: Affected People : Humanitarian Needs\n\nSecondary category matched: False\n=====================================================\nDataset: south-sudan-access-incidents\n\nActual: Coordination & Context : Conflict Events\nPredicted category: Coordination & Context : Humanitarian Access\nPredicted second category: Coordination & Context : Conflict Events\n\nSecondary category matched: **True**\n=====================================================\nDataset: somalia-displacement-idps-returnees-baseline-assessment-iom-dtm\n\nActual: Affected People : Returnees\nPredicted category: Affected People : Internally Displaced Persons\nPredicted second category: Affected People : Returnees\n\nSecondary category matched: **True**\n=====================================================\nDataset: ukraine-border-crossings\n\nActual: Coordination & Context : Humanitarian Access\nPredicted category: Geography & Infrastructure : Populated Places\nPredicted second category: Coordination & Context : Humanitarian Access\n\nSecondary category matched: **True**\n=====================================================\nDataset: northeast-nigeria-displacement-for-borno-adamawa-and-yobe-states-bay-state\n\nActual: Affected People : Returnees\nPredicted category: Affected People : Internally Displaced Persons\nPredicted second category: Affected People : Returnees\n\nSecondary category matched: **True**\n=====================================================\nDataset: somalia-acute-malnutrition-burden-and-prevalence\n\nActual: Food Security & Nutrition : Acute Malnutrition\nPredicted category: Affected People : Acute Malnutrition\nPredicted second category: Food Security & Nutrition : Food Security\n\nSecondary category matched: False\n=====================================================\nDataset: colombia-people-in-need-pin-del-cluster-en-seguridad-alimentaria-y-nutricion-san-sp\n\nActual: Food Security & Nutrition : Food Security\nPredicted category: Affected People : Humanitarian Needs\nPredicted second category: Coordination & Context : 3W - Who is doing what where\n\nSecondary category matched: False\n=====================================================\nDataset: sind-safeguarding-healthcare-monthly-news-briefs-dataset\n\nActual: Coordination & Context : Humanitarian Access\nPredicted category: Coordination & Context : Conflict Events\nPredicted second category: Affected People : Humanitarian Needs\n\nSecondary category matched: False\n=====================================================\n```", "```py\nYes, the dataset falls into exactly one of the categories mentioned above.\n\n|Geography & Infrastructure : Populated Places|\n\nThe dataset contains information about border crossings in Ukraine, \nincluding their names in English and Ukrainian, the country they connect to, \nand their latitude and longitude coordinates. This information is related to \npopulated places (border crossings) and their geographic locations, which is why the \"Geography & Infrastructure : Populated Places\" category is the most appropriate.\n\n^Coordination & Context : Humanitarian Access^\n\nThe second most likely category would be \"Coordination & Context : Humanitarian Access\" \nborder crossings can be considered as points of access between countries, and \nunderstanding their locations could be relevant in the context of humanitarian \ninterventions. However, this category is not as fitting as the first one \nsince the dataset does not specifically describe access constraints or \npermissions related to humanitarian interventions.\n```"]