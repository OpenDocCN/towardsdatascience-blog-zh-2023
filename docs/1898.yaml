- en: Training a Machine Learning Model on a Kafka Stream
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 Kafka 流上训练机器学习模型
- en: 原文：[https://towardsdatascience.com/training-a-machine-learning-model-on-a-kafka-stream-a5079f543e98?source=collection_archive---------6-----------------------#2023-06-09](https://towardsdatascience.com/training-a-machine-learning-model-on-a-kafka-stream-a5079f543e98?source=collection_archive---------6-----------------------#2023-06-09)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/training-a-machine-learning-model-on-a-kafka-stream-a5079f543e98?source=collection_archive---------6-----------------------#2023-06-09](https://towardsdatascience.com/training-a-machine-learning-model-on-a-kafka-stream-a5079f543e98?source=collection_archive---------6-----------------------#2023-06-09)
- en: Updating a machine learning model online and in near real-time using training
    data generated by a Kafka producer
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用由 Kafka 生产者生成的训练数据在线和近实时地更新机器学习模型
- en: '[](https://medium.com/@kylegallatin?source=post_page-----a5079f543e98--------------------------------)[![Kyle
    Gallatin](../Images/ee2796ba575412e9caf6034a65d741e5.png)](https://medium.com/@kylegallatin?source=post_page-----a5079f543e98--------------------------------)[](https://towardsdatascience.com/?source=post_page-----a5079f543e98--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----a5079f543e98--------------------------------)
    [Kyle Gallatin](https://medium.com/@kylegallatin?source=post_page-----a5079f543e98--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@kylegallatin?source=post_page-----a5079f543e98--------------------------------)[![Kyle
    Gallatin](../Images/ee2796ba575412e9caf6034a65d741e5.png)](https://medium.com/@kylegallatin?source=post_page-----a5079f543e98--------------------------------)[](https://towardsdatascience.com/?source=post_page-----a5079f543e98--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----a5079f543e98--------------------------------)
    [Kyle Gallatin](https://medium.com/@kylegallatin?source=post_page-----a5079f543e98--------------------------------)'
- en: ·
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: ·
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F51ff4b76ebf4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-machine-learning-model-on-a-kafka-stream-a5079f543e98&user=Kyle+Gallatin&userId=51ff4b76ebf4&source=post_page-51ff4b76ebf4----a5079f543e98---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----a5079f543e98--------------------------------)
    ·5 min read·Jun 9, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa5079f543e98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-machine-learning-model-on-a-kafka-stream-a5079f543e98&user=Kyle+Gallatin&userId=51ff4b76ebf4&source=-----a5079f543e98---------------------clap_footer-----------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[关注](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F51ff4b76ebf4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-machine-learning-model-on-a-kafka-stream-a5079f543e98&user=Kyle+Gallatin&userId=51ff4b76ebf4&source=post_page-51ff4b76ebf4----a5079f543e98---------------------post_header-----------)
    发表在 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----a5079f543e98--------------------------------)
    ·5 分钟阅读·2023年6月9日[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa5079f543e98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-machine-learning-model-on-a-kafka-stream-a5079f543e98&user=Kyle+Gallatin&userId=51ff4b76ebf4&source=-----a5079f543e98---------------------clap_footer-----------)'
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa5079f543e98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-machine-learning-model-on-a-kafka-stream-a5079f543e98&source=-----a5079f543e98---------------------bookmark_footer-----------)![](../Images/d379c69615c47a586b2e92f500891d1f.png)'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa5079f543e98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-machine-learning-model-on-a-kafka-stream-a5079f543e98&source=-----a5079f543e98---------------------bookmark_footer-----------)![](../Images/d379c69615c47a586b2e92f500891d1f.png)'
- en: Photo by [Jonathan Borba](https://unsplash.com/@jonathanborba?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 照片由 [Jonathan Borba](https://unsplash.com/@jonathanborba?utm_source=medium&utm_medium=referral)
    提供，发布于 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
- en: Lately, I’ve become increasingly interested in *online machine learning* — the
    ability to update an ML model’s weights in a production setting. Besides the the
    topic providing [fun architectural challenges](/thoughts-on-stateful-ml-online-learning-and-intelligent-ml-model-retraining-4e583728e8a1?sk=d5650f2c6be6af8ef512d9c109da3a65)
    for me, the approach boasts massive potential gains. This [study from Grubhub
    in 2021](https://arxiv.org/abs/2107.07106) demonstrated a +20% with metrics increase
    *and* 45x cost savings by leveraging online learning, and I’m all about saving
    money to make money.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 最近，我对*在线机器学习*越来越感兴趣——即在生产环境中更新ML模型的权重。除了这一主题为我提供的[有趣的架构挑战](/thoughts-on-stateful-ml-online-learning-and-intelligent-ml-model-retraining-4e583728e8a1?sk=d5650f2c6be6af8ef512d9c109da3a65)外，这种方法还具有巨大的潜力。2021年Grubhub的这项[研究](https://arxiv.org/abs/2107.07106)通过利用在线学习展示了+20%的指标提升*和*
    45倍的成本节约，我非常支持节省开支以赚取更多收益。
- en: '![](../Images/d74d07e0c17ed88c29b53dfce38d84a2.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d74d07e0c17ed88c29b53dfce38d84a2.png)'
- en: Stateful retraining — Image by Chip Huyen with permission
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 状态重训练——Chip Huyen授权提供的图片
- en: '![](../Images/941f78afa2549ce3c1b4779620b3d705.png)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/941f78afa2549ce3c1b4779620b3d705.png)'
- en: Online learning — Image by Author
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在线学习——作者提供的图片
- en: 'From a practical perspective, however, working with data streams and streaming
    architecture is still pretty new to ML practitioners. Creating a real-time stream
    of training data aside, there are fairly few resources on consuming such a data
    source to update a model in an online setting. In this article, I’ll demonstrate:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 从实际的角度来看，与数据流和流式架构的工作对机器学习从业者来说仍然是相当新的。除了创建实时训练数据流外，关于在在线环境中使用这种数据源来更新模型的资源相对较少。在这篇文章中，我将展示：
- en: Setting up a Kafka instance
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置Kafka实例
- en: Creating a producer that generates training data
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个生成训练数据的生产者
- en: Creating a consumer that uses that training data to update an ML model
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个使用这些训练数据更新ML模型的消费者
- en: Running Kafka with Docker
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Docker运行Kafka
- en: My preferred method of working with Kafka locally is via `docker-compose`. If
    not already installed in your environment, you can follow instructions [here](https://docs.docker.com/compose/install/).
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我在本地使用Kafka的首选方法是通过`docker-compose`。如果你的环境中还没有安装，你可以按照[这里](https://docs.docker.com/compose/install/)的说明进行安装。
- en: 'Shuyi Yang’s [article on the topic](/kafka-docker-python-408baf0e1088) provides
    a high-level overview of this approach, and we can use a similar `docker-compose.yaml`
    file that creates local Kafka and Zookeeper instances and exposes Kafka on port
    9092:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: Shuyi Yang的[相关文章](/kafka-docker-python-408baf0e1088)提供了这种方法的高层次概述，我们可以使用一个类似的`docker-compose.yaml`文件来创建本地Kafka和Zookeeper实例，并在9092端口上暴露Kafka：
- en: '[PRE0]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'It also creates a Kafka topic called `ml_training_data` that we’ll use later.
    You can run the file by changing in the directory with the file above and running:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 它还创建了一个名为`ml_training_data`的Kafka主题，我们稍后会用到。你可以通过切换到包含该文件的目录并运行以下命令来执行该文件：
- en: '[PRE1]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: A Kafka producer for training data
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 一个用于训练数据的Kafka生产者
- en: 'First, let’s install the Python libraries we’ll need to use:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们安装所需的Python库：
- en: '[PRE2]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Next, we need to create an artificial source of training data that’s written
    to our Kafka topic. For this, we’ll use the [River Python library](https://riverml.xyz/0.15.0/),
    which has easy-to-use APIs for streaming data:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要创建一个人工生成的训练数据源，将其写入我们的Kafka主题。为此，我们将使用[River Python库](https://riverml.xyz/0.15.0/)，它具有易于使用的流数据API：
- en: '[PRE3]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The code above uses the toy [River Phishing dataset](https://riverml.xyz/0.15.0/api/datasets/Phishing/)
    ([CC BY 4.0](http://archive.ics.uci.edu/dataset/379/website+phishing)), and sends
    labeled data observations to our Kafka topic one-at-a-time. This dataset contains
    features from web pages that are classified as phishing or not. The samples in
    the dataset are tuples that look like this:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的代码使用了玩具[River Phishing数据集](https://riverml.xyz/0.15.0/api/datasets/Phishing/)（[CC
    BY 4.0](http://archive.ics.uci.edu/dataset/379/website+phishing)），并将标记的数据观察值逐一发送到我们的Kafka主题。这个数据集包含来自网页的特征，这些特征被分类为钓鱼或非钓鱼。数据集中的样本是这样的元组：
- en: '[PRE4]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'First, run the producer:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，运行生产者：
- en: '[PRE5]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Then you should see the following in the console:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 然后你应该在控制台中看到以下内容：
- en: '[PRE6]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: A Kafka consumer for training an ML model
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 一个用于训练ML模型的Kafka消费者
- en: Writing a simple Kafka consumer will let us read the data we’ve been pushing
    from the stream as it comes in, and use it to update the weights on our model.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 编写一个简单的Kafka消费者将允许我们读取从流中推送过来的数据，并用来更新模型的权重。
- en: '[PRE7]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The code above initializes a simple ML model using River’s `LogisticRegression`
    class. Then, we continuously process events and use them to update our ML model
    — printing the ROCAUC metric for each sample added.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码使用 River 的 `LogisticRegression` 类初始化了一个简单的 ML 模型。然后，我们不断处理事件，并使用它们来更新我们的
    ML 模型——为每个添加的样本打印 ROCAUC 指标。
- en: 'To start training, run:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始训练，请运行：
- en: '[PRE8]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: You should see something like the following in the console as the model learns
    observation by observation!
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 随着模型逐渐学习观察到的内容，你应该在控制台看到类似的输出！
- en: '[PRE9]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Conclusion
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结论
- en: Both continuous training and online learning have *huge* potential in areas
    where real-time or near real-time labeled data can be made available to models
    making real-time decisions. All code and instructions are available in [this Github
    repo](https://github.com/kylegallatin/kafka-ml-training). More to come soon!
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在可以向模型提供实时或近实时标记数据的领域中，持续训练和在线学习具有*巨大*的潜力。所有代码和说明可以在[这个 Github 仓库](https://github.com/kylegallatin/kafka-ml-training)中找到。更多内容敬请期待！
