- en: Intuitive Explanation of Exponential Moving Average
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/intuitive-explanation-of-exponential-moving-average-2eb9693ea4dc?source=collection_archive---------2-----------------------#2023-12-16](https://towardsdatascience.com/intuitive-explanation-of-exponential-moving-average-2eb9693ea4dc?source=collection_archive---------2-----------------------#2023-12-16)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Understand the logic behind the fundamental algorithm used inside the gradient
    descent
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@slavahead?source=post_page-----2eb9693ea4dc--------------------------------)[![Vyacheslav
    Efimov](../Images/db4b02e75d257063e8e9d3f1f75d9d6d.png)](https://medium.com/@slavahead?source=post_page-----2eb9693ea4dc--------------------------------)[](https://towardsdatascience.com/?source=post_page-----2eb9693ea4dc--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----2eb9693ea4dc--------------------------------)
    [Vyacheslav Efimov](https://medium.com/@slavahead?source=post_page-----2eb9693ea4dc--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: ·
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: '[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc8a0ca9d85d8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitive-explanation-of-exponential-moving-average-2eb9693ea4dc&user=Vyacheslav+Efimov&userId=c8a0ca9d85d8&source=post_page-c8a0ca9d85d8----2eb9693ea4dc---------------------post_header-----------)
    Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----2eb9693ea4dc--------------------------------)
    ·6 min read·Dec 16, 2023[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2eb9693ea4dc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitive-explanation-of-exponential-moving-average-2eb9693ea4dc&user=Vyacheslav+Efimov&userId=c8a0ca9d85d8&source=-----2eb9693ea4dc---------------------clap_footer-----------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2eb9693ea4dc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitive-explanation-of-exponential-moving-average-2eb9693ea4dc&source=-----2eb9693ea4dc---------------------bookmark_footer-----------)![](../Images/f65b757753e90cbe70d7ae2c04608e84.png)'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: Introduction
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In time series analysis, there is often a need to understand the trend direction
    of a sequence by taking into account previous values. Approximation of the next
    values in a sequence can be performed in several ways, including the usage of
    simple baselines or the construction of advanced machine learning models.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: An **exponential (weighted) moving average** is a robust trade-off between these
    two methods. Having a simple recursive method under the hood makes it possible
    to efficiently implement the algorithm. At the same time, it is very flexible
    and can be successfully adapted for most types of sequences.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: This article covers the motivation behind the method, a description of its workflow
    and bias correction — an effective technique to overcome a bias obstacle in approximation.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: Motivation
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Imagine a problem of approximating a given parameter that changes in time. On
    every iteration, we are aware of all of its previous values. The objective is
    to predict the next value which depends on the previous values.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: One of the naive strategies is to simply take the average of the last several
    values. This might work in certain cases but it is not very suitable for scenarios
    when a parameter is more dependent on the most recent values.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: One of the possible ways to overcome this issue is to distribute higher weights
    to more recent values and assign fewer weights to prior values. The exponential
    moving average is exactly a strategy that follows this principle. **It is based
    on the assumption that more recent values of a variable contribute more to the
    formation of the next value than precedent values**.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: Formula
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To understand how the exponential moving average works, let us look at its
    recursive equation:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1ee395f76a578feac3fbfb7250c75d0f.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
- en: Exponential moving average formula
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: vₜ is a time series that approximates a given variable. Its index t corresponds
    to the timestamp t. Since this formula is recursive, the value v₀ for the initial
    timestamp t = 0 is needed. In practice, v₀ is usually taken as 0.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: θ is the observation on the current iteration.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: β is a hyperparameter between 0 and 1 which defines how weight importance should
    be distributed between a previous average value vₜ-₁ and the current observation
    θ
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Let us write this formula for first several parameter values:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1ded5cd1e0b8e9dfc5d8637a452907e7.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
- en: Obtaining formula for the t-th timestamp
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: 'As a result, the final formula looks like this:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/2520ba4bbbbd0aa1c25fe694d2ce7d6e.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
- en: Exponential moving average for the t-th timestamp
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: We can see that the most recent observation θ has a weight of 1, the second
    last observation — β, the third last — β², etc. Since 0 < β < 1, the multiplication
    term βᵏ goes exponentially down with the increase of k, *so the older the observations,
    the less important they are*. Finally, every sum term is multiplied by (1 —β).
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: In practice, the value for β is usually chosen close to 0.9.
  id: totrans-30
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](../Images/946afdcedcea1cae3b14897b927bb2e1.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
- en: Weight distribution for different timestamps (β = 0.9)
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: Mathematical interpretation
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Using the famous second wonderful limit from mathematical analysis, it is possible
    to prove the following limit:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/088ede23a815fe975357a0f9c57e7506.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
- en: The second wonderful limit
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: 'By making a substitution β = 1 - *x*, we can rewrite it in the form below:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 通过将 β = 1 - *x* 代入，我们可以将其改写成如下形式：
- en: '![](../Images/e648d093856d49a1a829473a3bc8008f.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/e648d093856d49a1a829473a3bc8008f.png)'
- en: The second wonderful limit in another form
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种形式的奇妙极限
- en: 'We also know that in the equation for the exponential moving average, every
    observation value is multiplied by a term βᵗ where t indicates how many timestamps
    ago the observation was computed. Since the base β is equal in both cases, we
    can equate the exponents of both formulas:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还知道，在指数加权平均的公式中，每个观察值都乘以一个 βᵗ 的项，其中 t 表示观察值被计算的时间戳数。由于基数 β 在两种情况中是相等的，我们可以使两个公式的指数相等：
- en: '![](../Images/7bedd715d3f938568c452996e6e00451.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7bedd715d3f938568c452996e6e00451.png)'
- en: By using this equation, for a chosen value of β, we can compute an approximate
    number of timestamps t it takes for weight terms to reach the value of 1 / e ≈
    0.368). It means that observations computed within last t iterations have a weight
    term greater than 1 / e and those more precedent calculated out of last t timestamp
    range come up with weights lower than 1 / e having a much less significance.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用这个公式，对于选择的 β 值，我们可以计算出权重项达到 1 / e ≈ 0.368 的大致时间戳数量 t。这意味着在最近的 t 次迭代中计算的观察值的权重项大于
    1 / e，而在最后 t 个时间戳范围之外计算的观察值的权重低于 1 / e，其重要性则大大减少。
- en: In reality, weights lower than 1 / e make a tiny impact on the exponentially
    weighted average. That is why it is said that **for a given value of β, the exponential
    weighted average takes into consideration the last t = 1 / (1 - β) observations**.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，低于 1 / e 的权重对指数加权平均的影响微乎其微。这就是为什么人们说**对于给定的 β 值，指数加权平均会考虑到最后的 t = 1 / (1
    - β) 个观察值**。
- en: To get a better sense of the formula, let us plug in different values for β**:**
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地理解公式，让我们插入不同的 β 值**：**
- en: '![](../Images/de06a335b31a2fbeb4c261e9c312f732.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/de06a335b31a2fbeb4c261e9c312f732.png)'
- en: For instance, taking β= 0.9 indicates that approximately in t = 10 iterations,
    the weight decays to 1 / e, compared to the weight of the current observation.
    In other words, the exponential weighted average mostly depends only on the last
    t = 10 observations.
  id: totrans-46
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 例如，选择 β = 0.9 表示大约在 t = 10 次迭代后，权重衰减到 1 / e，相较于当前观察值的权重。换句话说，指数加权平均主要依赖于最后的
    t = 10 个观察值。
- en: Bias correction
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 偏差修正
- en: 'The common problem with using exponential weighted average is that in most
    problems it cannot approximate well the first series values. It occurs due to
    the absence of a sufficient amount of data on the first iterations. For example,
    imagine we are given the following time series sequence:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 使用指数加权平均的一个常见问题是，在大多数问题中，它不能很好地近似前几项值。这是由于在前几次迭代中缺少足够的数据。例如，假设我们给定了以下时间序列：
- en: '![](../Images/9d079e18b99a43f4c6e4aada6d25daa4.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/9d079e18b99a43f4c6e4aada6d25daa4.png)'
- en: The goal is to approximate it with the exponential weighted average. However,
    if we use the normal formula, then the first several values will put a large weight
    on v₀ which is 0 whereas most of the points on the scatterplot are above 20\.
    As a consequence, a sequence of first weighted averages will be too low to precisely
    approximate the original sequence.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 目标是用指数加权平均来近似它。然而，如果我们使用常规公式，那么前几个值将对 v₀ 赋予较大权重，而 v₀ 为 0，尽管散点图上的大多数点都在 20 以上。因此，初始的加权平均序列将会过低，无法准确近似原始序列。
- en: One of the naive solutions is to take a value for v₀ being close to the first
    observation θ₁. Though this approach works well in some situations, it is still
    not perfect, especially in cases when a given sequence is volatile. For example,
    if θ₂ differs too much from θ₁, then while calculating the second value v₂, the
    weighted average will normally put much more importance on the previous trend
    v₁ than the current observation θ₂. As a result, the approximation will be very
    poor.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 一种简单的解决方案是将 v₀ 的值设置得接近第一次观察值 θ₁。虽然这种方法在某些情况下效果很好，但它仍然不完美，特别是当给定序列波动时。例如，如果 θ₂
    与 θ₁ 差异过大，那么在计算第二个值 v₂ 时，加权平均通常会更重视先前的趋势 v₁ 而不是当前的观察值 θ₂。结果，近似值将会非常差。
- en: A much more flexible solution is to use a technique called “**bias correction**”.
    Instead of simply using computed values vₖ, they are divided by (1 —βᵏ). Assuming
    that β is chosen close to 0.9–1, this expression tends to be close to 0 for first
    iterations where k is small. Thus, instead of slowly accumulating the first several
    values where v₀ = 0, they are now divided by a relatively small number scaling
    them into larger values.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ed809abff8a65e5f605c4394dfdbec49.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
- en: Exponential moving average computation example with and without bias correction
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: In general, this scaling works very well and precisely adapts the first several
    terms. When k becomes larger, the denominator gradually approaches 1, thus gradually
    omitting the effect of this scaling which is no longer needed, because starting
    from a certain iteration, the algorithm can rely with a high confidence on its
    recent values without any additional scaling.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a505a4b5dbc0326cb86660f06e5f0fb9.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
- en: Conclusion
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this article, we have covered an extremely useful technique for approximating
    a time series sequence. The robustness of the exponential weighted average algorithm
    is primarily achieved by its hyperparameter β which can be adapted for a particular
    type of sequence. Apart from it, the introduced bias correction mechanism makes
    it possible to efficiently approximate data even on early timestamps when there
    is too little information.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: Exponential weighted average has a wide application scope in time series analysis.
    Additionally, it used in variations of gradient descent algorithm for convergence
    acceleration. One of the most popular of them is the Momentum optimizer in deep
    learning which removes unnecessary oscillations of an optimized function aligning
    it more precisely towards a local minimum.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: '*All images unless otherwise noted are by the author*'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
