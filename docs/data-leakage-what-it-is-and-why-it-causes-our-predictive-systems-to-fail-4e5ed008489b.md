# 数据泄漏：它是什么，为什么会导致我们的预测系统失败

> 原文：[`towardsdatascience.com/data-leakage-what-it-is-and-why-it-causes-our-predictive-systems-to-fail-4e5ed008489b`](https://towardsdatascience.com/data-leakage-what-it-is-and-why-it-causes-our-predictive-systems-to-fail-4e5ed008489b)

## *数据泄漏与过拟合/欠拟合一起，代表了机器学习项目在生产中失败的主要原因*

[](https://medium.com/@theDrewDag?source=post_page-----4e5ed008489b--------------------------------)![Andrea D'Agostino](https://medium.com/@theDrewDag?source=post_page-----4e5ed008489b--------------------------------)[](https://towardsdatascience.com/?source=post_page-----4e5ed008489b--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----4e5ed008489b--------------------------------) [Andrea D'Agostino](https://medium.com/@theDrewDag?source=post_page-----4e5ed008489b--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----4e5ed008489b--------------------------------) ·阅读时间 5 分钟·2023 年 8 月 4 日

--

![](img/76015a8e90a6ce9fe834ebd8b66a25a7.png)

图片由 [Grianghraf](https://unsplash.com/@grianghraf?utm_source=medium&utm_medium=referral) 提供，来源于 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

数据泄漏无疑是一个威胁，困扰着数据科学家，无论其资历如何。

这是一个可能影响每个人的现象——即使是拥有多年经验的专业人士也会受到影响。

与过拟合/欠拟合一起，**它代表了机器学习项目在生产中失败的主要原因。**

> 数据泄漏发生在训练集中的信息泄漏到评估集（无论是验证集还是测试集）时。

*但为什么数据泄漏会造成如此多的受害者？*

因为即使经过了许多实验和评估阶段，**我们的模型在生产环境中仍可能会失败得很惨。**

避免数据泄漏并不容易。希望通过这篇文章，你能理解为什么以及如何在你的项目中避免它！

# 数据泄漏的示例

这里有一个示例，可能对你理解数据泄漏有帮助。

想象一下，我们是应用 AI 的开发者，受雇于一家大规模生产儿童玩具的公司。

我们的任务是创建一个机器学习模型，以识别一个玩具是否会在销售后的 3 天内收到退款请求。

我们从工厂接收数据，以图像的形式捕捉玩具在罐装前的状态。

![](img/5fdc65428777ffa910f6676f2ba32d5d.png)

图片由 [Jerry Wang](https://unsplash.com/@jerry_318?utm_source=medium&utm_medium=referral) 提供，来源于 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

我们使用这些图像来训练我们的模型，该模型在交叉验证和测试集上表现非常好。

我们交付了模型，并且在第一个月**客户报告只有 5%的玩具退款请求是由于缺陷。**

在第二个月，我们准备对模型进行重新训练。工厂向我们发送了更多照片，我们用这些照片来扩充初始训练数据集。

再次，模型在交叉验证和测试中表现良好。

然而，这次我们收到的通信表示客户提出了请求，并且 90%的这些请求涉及到一个有缺陷的玩具。

我们查看这些照片……并注意到客户在最后一批中发送的照片**显示了第一月内退货的玩具。**

> 工厂提供的新照片不经意间包含了玩具销售后三天内的退款请求信息。

基本上，客户在申请退款后向我们发送了精选的图像，**因此这些图像捕捉了已退货玩具的特定特征**。这可能包括客户发现的可见损坏或明显缺陷，并导致了退款请求。

*因此，我们理解模型在识别特定缺陷方面非常出色，从而在开发中表现良好，但在生产中表现不佳。*

我们必须联系客户，解释情况，并可能需要清理训练数据集。

> **尽管其重要性，数据泄漏的概念与过拟合相比鲜有提及。这使得它对新兴的数据科学家更具危险性。**

# 数据泄漏的常见原因

现在，让我们看看导致数据泄漏的一些最常见原因。

## 1\. 时间线随机拆分，而不是按时间拆分

我们通常被教导随机拆分训练、验证和测试数据集是正确的选择。

然而，我们的**数据很可能在时间上相关**，这意味着时间变量会影响我们标签的分布。

比如说一个来自股市的时间序列。

如果我们随机拆分数据集，**数据泄漏的概率将达到 100%。**

这是因为接下来的数据会随机混入训练数据集中。**我们的模型将接触到“正确”的标签，而无需学习它们。**

这有点像是学校里的孩子拥有了测试的正确答案。表现优秀，但知识水平很低。

为了避免问题，**基于时间拆分数据是有用的**：例如，如果我们有一个月的数据，我们在前 20 天上训练模型，在剩余的 10 天上进行测试，按顺序进行。

## 2\. 在拆分之前转换数据

这是数据科学新手中最常见的原因之一。

这种错误是如何表现的

```py
from sklearn import model_selection
from sklearn import preprocessing

# ...

scaler = preprocessing.StandardScaler()
data = scaler.fit_transform(data)

train, test = model_selection.train_test_split(
  data, 
  test_size=0.2, 
  random_state=42
)

# ...
```

**这里的错误是我们在将数据拆分成训练集和测试集之前对所有数据应用了缩放。**

在这种情况下，缩放器对象需要知道它所应用的数据集的均值和标准差。

通过提供整个数据集，它也会存储和使用测试集中的信息，**这将改变均值和标准差。**

**为了解决这个问题，*总是*在应用诸如缩放之类的转换之前先划分数据。**

## 3\. 用测试集中的信息填补缺失数据

有点类似于上面的观点，但从另一个角度看。

插补缺失数据的一种常见方法是用列中所有数据的均值或中位数填充单元格。

如果均值也基于测试集中的值进行计算，我们就在训练集中生成了泄漏。

再次提醒，我们在应用插补之前需要先划分数据。

## 4\. 未能移除重复项

如果我们在数据集中有重复记录，那么这些记录有可能同时出现在训练集和测试集中。

因此，数据泄漏。我们的模型将显然能很好地预测这些重复项的值，显著降低预测误差（但这并不正确）。

为了避免这个错误，**你必须在进行训练-测试划分之前移除重复项**。

如果我们进行*过采样*，即创建人工重复项以在不平衡的数据集上训练模型，那么我们需要在划分数据后再进行过采样。

## 5\. 错误的数据生成过程

就像上面的玩具工厂例子一样。

有时，泄漏来自于**我们需要训练模型的数据是如何生成和交付的**。

这种情况是不可避免的。我们只能保持警惕，提出问题，不要掉以轻心，尤其是在我们无法控制数据生成过程的情况下，就像玩具工厂的例子一样。

> 一般建议是，如果数据不是由数据科学团队处理/交付的，应该总是检查数据。

# 结论

感谢你读到这里。

你已经了解了数据泄漏是什么，以及为什么即使对于经验丰富的数据科学家来说，它也是如此难以管理。

在这种情况下，问题出在细节上，尤其是对于新程序员来说，这些细节在编码时很容易被忽视。

我给你展示的例子应该可以帮助你评估你的项目是否遇到了数据泄漏。

**通常，如果你在开发中发现性能非常高，一定要检查是否存在数据泄漏。**

我们绝不希望我们的模型在生产环境中失败！

下次见，

安德鲁
