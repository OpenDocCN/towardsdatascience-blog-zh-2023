# Pandas 2.0 æœ‰ä»€ä¹ˆæ–°å˜åŒ–ï¼Ÿ

> åŸæ–‡ï¼š[`towardsdatascience.com/whats-new-in-pandas-2-0-5df366eb0197`](https://towardsdatascience.com/whats-new-in-pandas-2-0-5df366eb0197)

## å…³äºè¿™æ¬¡é‡å¤§å‘å¸ƒçš„äº”ä»¶äº‹

[](https://jeffhale.medium.com/?source=post_page-----5df366eb0197--------------------------------)![Jeff Hale](https://jeffhale.medium.com/?source=post_page-----5df366eb0197--------------------------------)[](https://towardsdatascience.com/?source=post_page-----5df366eb0197--------------------------------)![Towards Data Science](https://towardsdatascience.com/?source=post_page-----5df366eb0197--------------------------------) [Jeff Hale](https://jeffhale.medium.com/?source=post_page-----5df366eb0197--------------------------------)

Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----5df366eb0197--------------------------------) Â·é˜…è¯»æ—¶é—´ 5 åˆ†é’ŸÂ·2023 å¹´ 4 æœˆ 10 æ—¥

--

Pandas 2.0 äº 2023 å¹´ 4 æœˆ 3 æ—¥æ­£å¼å‘å¸ƒã€‚è®©æˆ‘ä»¬çœ‹çœ‹å“ªäº›åŠŸèƒ½æ¯”é˜³å…‰ä¸‹çš„æŸ¯åŸºè¿˜è¦ç‚™æ‰‹å¯çƒ­ã€‚â˜€ï¸

![](img/64c4f87ef9ed00d3cb56323cded1e96c.png)

æ¥æºï¼špixabay.com

ä¸‰å¹´å‰ï¼Œæˆ‘å†™äº† Pandas 1.0 æœ‰ä»€ä¹ˆæ–°å˜åŒ–ã€‚ç»å†äº†ä¸€åœºå¤§æµè¡Œå’Œä¸€ç³»åˆ— AI è¿›å±•ä¹‹åï¼Œæˆ‘ä»¬è¿æ¥äº† pandas 2.0ã€‚

Pandas æ˜¯æ ‡å‡†çš„ã€è„‘åŠ›å‹å¥½çš„ Python æ•°æ®å¤„ç†åº“ã€‚2.0 æ›´æ–°çš„é‡ç‚¹æ˜¯è®© pandas æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜ã€‚å†…å­˜æ˜¯äººä»¬éœ€è¦ç¦»å¼€ pandas è½¬å‘ Daskã€Rayã€SQL æ•°æ®åº“ã€Spark DataFrames å’Œå…¶ä»–å·¥å…·çš„ä¸»è¦åŸå› ã€‚å‡å°‘å†…å­˜ä½¿ç”¨ä¼šä½¿ pandas çš„ä½¿ç”¨å˜å¾—æ›´åŠ è½»æ¾ã€‚ğŸ™‚

æ­£å¦‚ä½ å¯èƒ½æœŸæœ›çš„é‚£æ ·ï¼Œä½œä¸ºä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ï¼Œpandas 2.0 æœ‰è®¸å¤šæ˜¾è‘—çš„å˜åŒ–ã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ï¼

## pyarrow *ğŸâ¡ï¸*

å¦‚æœç”¨ä¸€ä¸ªè¯æ¥æ€»ç»“è¿™æ¬¡å‘å¸ƒï¼Œé‚£å°±æ˜¯ *pyarrow*ã€‚

Pandas æ˜¯ä½¿ç”¨ NumPy æ•°æ®ç»“æ„è¿›è¡Œå†…å­˜ç®¡ç†æ„å»ºçš„ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ [pyarrow](https://arrow.apache.org/docs/python/index.html) ä½œä¸ºä½ çš„åå¤‡å†…å­˜æ ¼å¼ã€‚

ä½¿ç”¨ pyarrow æ„å‘³ç€ä½ å¯ä»¥åŠ å¿«é€Ÿåº¦å¹¶æé«˜å†…å­˜ä½¿ç”¨æ•ˆç‡ï¼Œå› ä¸ºä½ å¯ä»¥åˆ©ç”¨ [Arrow](https://arrow.apache.org/docs/cpp/index.html) çš„ C++ å®ç°ã€‚æœ‰è¶£çš„æ˜¯ï¼Œpandas çš„åˆ›å§‹äºº [Wes McKinney](https://en.wikipedia.org/wiki/Wes_McKinney) åœ¨ 2009 å¹´å¼€æº pandas åï¼Œäº 2016 å¹´å¼€å§‹å‚ä¸ Arrow çš„å¼€å‘ã€‚

Arrow æ˜¯ä»€ä¹ˆï¼Ÿ [Sebastian Raschk](https://twitter.com/rasbt) è§£é‡Šé“ï¼Œå®ƒæ˜¯â€œâ€¦ä¸€ç§å¼€æºä¸”ä¸è¯­è¨€æ— å…³çš„åˆ—å¼æ•°æ®æ ¼å¼ï¼Œç”¨äºåœ¨å†…å­˜ä¸­è¡¨ç¤ºæ•°æ®ã€‚å®ƒå¯ä»¥å®ç°è¿›ç¨‹é—´çš„æ•°æ®é›¶æ‹·è´å…±äº«ã€‚â€

åˆ—å¼æ•°æ®å­˜å‚¨å°†æ•°æ®åˆ—ç»„è£…åœ¨å†…å­˜ä¸­ï¼Œä»è€Œä½¿å¾—åœ¨è¯¸å¦‚è®¡ç®—åˆ—å‡å€¼ç­‰ä»»åŠ¡ä¸Šæ“ä½œæ›´å¿«ã€‚Arrow æ•°æ®ç±»å‹è¿˜åŒ…å«äº†å¦‚ç©ºå€¼ç­‰æœ‰ç”¨çš„æ¦‚å¿µï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚

ä½¿ç”¨ pyarrow çš„ pandas æ¯”å…¶ä»– pandas æ›¿ä»£æ–¹æ¡ˆæ›´å¿«å—ï¼Ÿåœ¨ä¸€äº›ä»»åŠ¡ä¸Šï¼Œ[Sebastian Raschka æ˜¾ç¤º pandas å¯èƒ½æ¯”](https://twitter.com/rasbt/status/1632090412117532672) [polars](https://github.com/pola-rs/polars) æ›´å¿«ï¼Œpolars æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„â€œRust å’Œ Python çš„ lightning-fast DataFrame åº“â€ï¼Œä¹Ÿä½¿ç”¨ Arrowã€‚

ç„¶åï¼Œpolars åº“çš„ä½œè€… Ritchie Vink å¯¹ [TPCH-10 åŸºå‡†æµ‹è¯•](https://docs.deistercloud.com/content/Databases.30/TPCH%20Benchmark.90/index.xml?embedded=true) è¿›è¡Œäº†æ¯”è¾ƒæµ‹è¯•ï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´å¤§ã€æ›´ç›¸å…³çš„å®é™…æ•°æ®æµ‹è¯•ã€‚è¯·æŸ¥çœ‹ä»¥ä¸‹ä¸€äº›ç»“æœå’Œè®¨è®ºï¼š

æ¥æºï¼š[`twitter.com/RitchieVink/status/1632334005264580608`](https://twitter.com/RitchieVink/status/1632334005264580608)

çœ‹èµ·æ¥ pandas å¯èƒ½è¿˜æœ‰ä¸€æ®µè·¯è¦èµ°ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰å°è¯•è¿‡ï¼Œpolars å¯èƒ½å€¼å¾—ä¸€è¯•ã€‚

å¦‚æœä½ è§‰å¾—éœ€è¦é€Ÿåº¦ï¼Œ[Numba](https://pandas.pydata.org/docs/user_guide/enhancingperf.html#pandas-numba-engine) æ˜¯å¦ä¸€ä¸ªé€‰é¡¹ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œé¿å…è¿‡æ—©ä¼˜åŒ–çš„æ™®éå»ºè®®æ˜¯åˆç†çš„ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨ pyrarrow åç«¯æ ¼å¼è¯»å– CSV æ–‡ä»¶çš„ä»£ç ï¼š

```py
pd.read_csv(my_file, dytpe_backend='pyarrow')
```

å¦‚æœä½ æƒ³æ·±å…¥äº†è§£ï¼ŒMarc Garcia æœ‰ä¸€ç¯‡[ä¸é”™çš„æ–‡ç« ](https://datapythonista.me/blog/pandas-20-and-the-arrow-revolution-part-i)ï¼Œä»‹ç»äº† pandas å†…å­˜ç»“æ„çš„å†å²ä»¥åŠ pandas 2.0 ä¸­å¯¹ pyarrow çš„æ”¯æŒï¼ˆæ³¨æ„ï¼Œåœ¨é¢„å‘å¸ƒç‰ˆæœ¬å’Œæ­£å¼å‘å¸ƒä¹‹é—´è¯­æ³•æœ‰æ‰€æ›´æ–°ï¼‰ã€‚

## ä»ä¸€å¼€å§‹å°±æ”¯æŒå¯ç©ºæ•°æ®ç±»å‹

åœ¨ pandas ä¸­å¤„ç†ç¼ºå¤±ï¼ˆç©ºï¼‰å€¼å¹¶ä¸æ€»æ˜¯é‚£ä¹ˆå®¹æ˜“ã€‚Pandas æ˜¯å»ºç«‹åœ¨ NumPy ä¸Šçš„ï¼Œè€Œ NumPy å¯¹æŸäº›æ•°æ®ç±»å‹ä¸æ”¯æŒç©ºå€¼ã€‚

ä¾‹å¦‚ï¼ŒNumPy æ•´æ•°æ•°æ®ç±»å‹æ— æ³•æ”¯æŒç©ºå€¼ã€‚åœ¨æ•´æ•°åˆ—ä¸­å¼•å…¥ç©ºå€¼ä¼šå¯¼è‡´è¯¥åˆ—è‡ªåŠ¨è½¬æ¢ä¸ºæµ®ç‚¹æ•°æ®ç±»å‹ã€‚ä¸€åˆ†é’Ÿåˆ—æ˜¯æ•´æ•°ï¼Œä¸‹ä¸€åˆ†é’Ÿå˜æˆæµ®ç‚¹æ•°ã€‚è¿™è‡³å°‘å¯ä»¥è¯´æ˜¯ä¸ç†æƒ³çš„ã€‚

Pandas 1.0 ä¸ºæˆ‘ä»¬æä¾›äº†å¯ç©ºçš„æ•°æ®ç±»å‹ï¼Œä½†ä½¿ç”¨èµ·æ¥éœ€è¦ä¸€äº›å·¥ä½œã€‚ç°åœ¨ï¼Œå½“ä½ å°†æ•°æ®è¯»å–åˆ° DataFrame ä¸­æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šä½ æƒ³è¦å¯ç©ºçš„ NumPy æ”¯æŒçš„æ•°æ®ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```py
pd.read_csv(my_file, dtype_backend="numpy_nullable")
```

æ›´æ–°ï¼šæ³¨æ„ï¼Œè‡ª 2.0 beta ç‰ˆæœ¬ä»¥æ¥ï¼Œè¿™ç§è¯­æ³•å·²è¢«æ›´æ–°ã€‚

æ³¨æ„ï¼Œå¤§å¤šæ•°ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„ `read_xxx` å‡½æ•°éƒ½æ”¯æŒå¯ç©ºçš„æ•°æ®ç±»å‹ã€‚æ›´å¤šä¿¡æ¯è¯·è§[è¿™é‡Œ](https://pandas.pydata.org/docs/whatsnew/v2.0.0.html#argument-dtype-backend-to-return-pyarrow-backed-or-numpy-backed-nullable-dtypes)ã€‚

`pyarrow` æ•°æ®ç±»å‹ä»ä¸€å¼€å§‹å°±æä¾›äº†ç©ºå€¼æ”¯æŒã€‚

## æ›´å¤š NumPy æ•°æ®ç±»å‹ç”¨äºç´¢å¼•

ç°åœ¨ï¼Œä½ å¯ä»¥ä¸º pandas ç´¢å¼•é€‰æ‹©æ›´å¤šçš„ NumPy æ•°æ®ç±»å‹ä»¥å‡å°‘å†…å­˜ä½¿ç”¨ã€‚ç°åœ¨ä½ å¯ä»¥é€‰æ‹©æ›´ä½å†…å­˜çš„æ•°æ®ç±»å‹ä½œä¸ºç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æŒ‡å®šç´¢å¼•ä½¿ç”¨ 32 ä½æ•´æ•°ï¼Œä»è€ŒèŠ‚çœä¹‹å‰åªèƒ½ä½¿ç”¨ 64 ä½æ•´æ•°æ—¶çš„ä¸€åŠå†…å­˜ã€‚

```py
pd.Index([1, 2, 3], dtype=np.int32)
```

é˜…è¯»æ›´å¤š[è¿™é‡Œ](https://pandas.pydata.org/pandas-docs/version/2.0/whatsnew/v2.0.0.html#index-can-now-hold-numpy-numeric-dtypes)ã€‚

## å¤åˆ¶-on-å†™æ¨¡å¼

Pandas å˜å¾—æ‡’æƒ°äº†ã€‚ä»¥ä¸€ç§å¥½çš„æ–¹å¼ã€‚ ğŸ™‚ å¤§é‡ DataFrame å’Œ Series æ–¹æ³•åœ¨éœ€è¦ä¹‹å‰ä¸ä¼šå†åˆ›å»º pandas å¯¹è±¡çš„å‰¯æœ¬ã€‚ä¾‹å¦‚ï¼Œ`df.head()` ä¸ä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«å‰äº”è¡Œçš„æ–° DataFrameï¼Œè€Œåªæ˜¯è¿”å›å‰äº”è¡Œçš„è§†å›¾ã€‚

è¿™äº›å˜åŒ–å°†èŠ‚çœæ—¶é—´å’Œå†…å­˜ã€‚åªéœ€ä½¿ç”¨ï¼š

```py
pd.set_option("mode.copy_on_write", True)
```

ä½ å¯ä»¥é€šè¿‡å‡ ç§å…¶ä»–æ–¹å¼è®¾ç½®è¿™ä¸ªè¡Œä¸ºï¼Œå› ä¸º pandas å–œæ¬¢ç»™ä½ å¤šç§æ–¹æ³•æ¥å®Œæˆä»»åŠ¡ã€‚ â¤ï¸

## å¯å®‰è£…çš„é¢å¤–åŠŸèƒ½

ç°åœ¨ä½ å¯ä»¥åœ¨å®‰è£… pandas æ—¶åŒæ—¶å®‰è£… pandas éœ€è¦çš„é¢å¤– Python åº“ã€‚ä¾‹å¦‚ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å°†ä¸ºä½ æä¾›å¤„ç† Google Cloud Platform å’Œ Parquet æ–‡ä»¶æ ¼å¼æ‰€éœ€çš„åº“ã€‚

```py
pip install "pandas[gcp, parquet]==2.0.0"
```

âš ï¸ ç¡®ä¿ä¸è¦å¿˜è®°å¼•å·ï¼

è¿™é‡Œæ˜¯å¯ç”¨çš„å®‰è£…é€‰é¡¹ï¼š

+   all (æ‰€æœ‰é™„åŠ åŠŸèƒ½)

+   performance

+   computation

+   timezone

+   fss

+   aws

+   gcp

+   excel

+   parquet

+   feather

+   hdf5

+   spss

+   postgresql

+   mysql

+   sql-other

+   html

+   xml

+   plot

+   output_formatting

+   clipboard

+   compression

+   test

äº†è§£å®‰è£…çš„ä¾èµ–é¡¹è¯·è®¿é—® [è¿™é‡Œ](https://pandas.pydata.org/docs/getting_started/install.html#install-dependencies)ã€‚

# Upgrading

è¦åœ¨ä½ çš„è™šæ‹Ÿç¯å¢ƒä¸­ä» PyPI å®‰è£… pandas 2.0ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå‡çº§ï¼š

```py
pip install -U pandas
```

ç°åœ¨ä½ å·²ç»å¼€å§‹æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜çš„æ•°æ®å¤„ç†ä¹‹æ—…äº†ï¼ ğŸ‰

# Wrap

ä½ å·²ç»çœ‹åˆ° pandas 2.0 çš„æœ€å¤§å˜åŒ–äº†ã€‚è¿˜æœ‰å…¶ä»–å˜åŒ–ï¼Œæ¯”å¦‚ `read_csv` å’Œç±»ä¼¼å‡½æ•°çš„æ–°æ—¥æœŸå‚æ•°åç§°ã€‚ [æŸ¥çœ‹å‘å¸ƒå¸–å­äº†è§£æ‰€æœ‰ç»†èŠ‚](https://pandas.pydata.org/pandas-docs/version/2.0/whatsnew/v2.0.0.html#configuration-option-mode-dtype-backend-to-return-pyarrow-backed-dtypes)ã€‚

å³ä½¿æœ‰äº†è¿™äº›æ–°å˜åŒ–ï¼Œå½“ä½ çš„ pandas DataFrame æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æ—¶ä¹Ÿä¼šå‡ºç°é—®é¢˜ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘åœ¨ è¿™ä»½æŒ‡å— ä¸­åˆ†äº«äº†å…«ä¸ªå¸®åŠ©ä½ åº”å¯¹çš„æŠ€å·§ã€‚

å¦‚æœä½ æ˜¯ pandas æ–°æ‰‹ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘çš„å…¥é—¨ä¹¦ç± [Memorable Pandas](https://memorablepandas.com/)ã€‚

å¸Œæœ›ä½ è§‰å¾—è¿™ä»½ pandas 2.0 å˜åŒ–æŒ‡å—å¯¹ä½ æœ‰å¸®åŠ©ã€‚å¦‚æœæœ‰ï¼Œè¯·åˆ†äº«ç»™å…¶ä»–äººï¼Œè®©ä»–ä»¬ä¹Ÿèƒ½æ‰¾åˆ°å®ƒï¼ ğŸš€

æˆ‘å†™å…³äº Pythonã€æ•°æ®å’Œå…¶ä»–æŠ€æœ¯è¯é¢˜çš„æ–‡ç« ã€‚å¦‚æœä½ å¯¹è¿™äº›æ„Ÿå…´è¶£ï¼Œ*è·Ÿéšæˆ‘* [follow me](https://jeffhale.medium.com/)ï¼Œè¿™æ ·ä½ å°±ä¸ä¼šé”™è¿‡æ›´æ–°ï¼

![](img/7a28dc434ef34199ac66bccca51578a1.png)

æ¥æºï¼špixabay.com

ç¼–ç¨‹æ„‰å¿«ï¼
