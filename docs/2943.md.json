["```py\ndef rerank(documents, count, rules, scorer):\n    result = []\n    while len(result) < count and len(documents) > 0:\n        position = len(result)\n        candidates = documents\n        for rule in rules:\n            filtered = [doc for doc in candidates if rule(position, doc)]\n            if len(filtered) > 0:\n                candidates = filtered\n        next_doc = max(candidates, key=lambda doc: scorer(position, doc))\n        result.append(next_doc)\n        documents.remove(next_doc)\n        scorer.update(position, next_doc)\n        for rule in rules:\n            rule.update(position, next_doc)\n    return result\n```"]