- en: Performing Image Annotation using Python and OpenCV
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/performing-image-annotation-using-python-and-opencv-f0124746613c](https://towardsdatascience.com/performing-image-annotation-using-python-and-opencv-f0124746613c)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Learn how to create bounding boxes for your images
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://weimenglee.medium.com/?source=post_page-----f0124746613c--------------------------------)[![Wei-Meng
    Lee](../Images/10fc13e8a6858502d6a7b89fcaad7a10.png)](https://weimenglee.medium.com/?source=post_page-----f0124746613c--------------------------------)[](https://towardsdatascience.com/?source=post_page-----f0124746613c--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----f0124746613c--------------------------------)
    [Wei-Meng Lee](https://weimenglee.medium.com/?source=post_page-----f0124746613c--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----f0124746613c--------------------------------)
    ·6 min read·Apr 27, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/36465bcf9bbb42baa466e690d7543696.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Héctor J. Rivas](https://unsplash.com/es/@hjrc33?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: One of the common tasks in deep learning is ***object detection***, a process
    in which you locate specific objects in a given image. An example of object detection
    is detecting cars in an image, where you could tally the total number of cars
    detected in an image. This might be useful in cases where you need to analyze
    the traffic flow at a specific junction.
  prefs: []
  type: TYPE_NORMAL
- en: In order to train a deep learning model to detect specific objects, you need
    to supply your model with a set of training images, with the coordinates of the
    specific object in the images all mapped out. This process is known as ***image
    annotation***. Image annotation assigns labels to objects present in an image,
    with the objects all marked out.
  prefs: []
  type: TYPE_NORMAL
- en: In this article, I will show you how to use Python and OpenCV to annotate your
    images — you will use your mouse to mark out the object that you are annotating
    and the application will draw a bounding rectangle around the object. You can
    then see the coordinates of the object you have mapped out and optionally save
    it to a log file.
  prefs: []
  type: TYPE_NORMAL
- en: Displaying an Image using OpenCV
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'First, create a text file and name it as **bounding.py**. Then, populate it
    with the following statements:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: The above Python console application takes in an argument from the console,
    which is the name of the image to display. Once the image name is obtained, you
    will use OpenCV to display the image. At the same time, you want to clone the
    image so that you can use it later on. To stop the program, you can press Ctrl-C
    on your keyboard.
  prefs: []
  type: TYPE_NORMAL
- en: 'To run the program, go to Terminal and type in the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The above **Cabs.jpg** file can be downloaded from https://en.wikipedia.org/wiki/Taxi#/media/File:Cabs.jpg.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The image should now be displayed:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/33de29c06cccb91f83e5d5f5e5d065f8.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Source: [https://en.wikipedia.org/wiki/Taxi#/media/File:Cabs.jpg](https://en.wikipedia.org/wiki/Taxi#/media/File:Cabs.jpg).
    Image by Users Omnibus, Uris on en.wikipedia — Uris took this photograph.'
  prefs: []
  type: TYPE_NORMAL
- en: Handling Mouse Events
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We want the user to be able to click on the image using their mouse and then
    drag across the image to select a particular *region of interest* (ROI). For this,
    let’s add two global variables into the program:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'The following figure shows how `roi_pt` will store the coordinates of the ROI:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/09ea124a9d10035621becfade8b552f9.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: 'You will now define a function name `draw_rectangle()` to be the handler for
    mouse clicks. This function takes in five arguments — `event`, `x`, `y`, `flags`,
    and `param`. We will only be using the first three arguments for this exercise:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'In the above function:'
  prefs: []
  type: TYPE_NORMAL
- en: When the left mouse button is depressed (`cv2.EVENT_LBUTTONDOWN`), you record
    the first point of the ROI. You then set the `is_button_down` variable to `True`
    so that you can start drawing a rectangle when the user moves his mouse while
    depressing the left mouse button.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When the user moves the mouse with the left mouse button depressed (`cv2.EVENT_MOUSEMOVE
    and is_button_down`), you will now draw a rectangle on a copy of the original
    image. You need to draw on a clone image because as the user moves the mouse you
    need to also remove the previous rectangle that you have drawn earlier. So the
    easiest way to accomplish this is to discard the previous image and use the clone
    image to draw the new rectangle.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'When the user finally releases the left mouse button (`cv2.EVENT_LBUTTONUP`),
    you append the end point of the ROI to `roi_pt`. You then print out the bounding
    box coordinates. For some deep learning packages, the bounding box coordinates
    are in the format of *(x,y,width, height)*, so I also computed the ROI coordindates
    in this format:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](../Images/cc0f2a92021c300a886ecbcaf9b35b8f.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: Finally, draw the bounding box for the ROI
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To wire up the mouse events with its event handler, add in the following statements:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'Run the program one more time and you can now select the ROI from the image
    and a rectangle will be displayed:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/371c9a3ede3003b1bfdfcc43439a7dce.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: 'At the same time, the coordinates of the ROI will also be displayed:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'For your convenience, here is the complete Python program:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '**If you like reading my articles and that it helped your career/study, please
    consider signing up as a Medium member. It is $5 a month, and it gives you unlimited
    access to all the articles (including mine) on Medium. If you sign up using the
    following link, I will earn a small commission (at no additional cost to you).
    Your support means that I will be able to devote more time on writing articles
    like this.**'
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://weimenglee.medium.com/membership?source=post_page-----f0124746613c--------------------------------)
    [## Join Medium with my referral link - Wei-Meng Lee'
  prefs: []
  type: TYPE_NORMAL
- en: Read every story from Wei-Meng Lee (and thousands of other writers on Medium).
    Your membership fee directly supports…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: weimenglee.medium.com](https://weimenglee.medium.com/membership?source=post_page-----f0124746613c--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this short article, I demonstrated how you can annotate an image by selecting
    the object in an image. Of course, once the coordinates of the object have been
    mapped up, you need to store it in an external file (such as a JSON or CSV file).
    For this, I will leave it as an exercise to the reader. Let me know if this is
    useful, or what are some of the annotation tools you use in your daily work.
  prefs: []
  type: TYPE_NORMAL
