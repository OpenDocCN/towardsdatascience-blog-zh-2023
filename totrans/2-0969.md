# 使用 OSMnx 进行地理空间数据分析

> 原文：[https://towardsdatascience.com/geospatial-data-analysis-with-osmnx-8a300d77b592](https://towardsdatascience.com/geospatial-data-analysis-with-osmnx-8a300d77b592)

## 学习如何使用 Python 下载、分析和可视化 OpenStreetMap 数据

[](https://eugenia-anello.medium.com/?source=post_page-----8a300d77b592--------------------------------)[![尤金妮亚·安内洛](../Images/537f444252cdc60709e7a19e37734c7b.png)](https://eugenia-anello.medium.com/?source=post_page-----8a300d77b592--------------------------------)[](https://towardsdatascience.com/?source=post_page-----8a300d77b592--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----8a300d77b592--------------------------------) [尤金妮亚·安内洛](https://eugenia-anello.medium.com/?source=post_page-----8a300d77b592--------------------------------)

·发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----8a300d77b592--------------------------------) ·6 分钟阅读·2023年6月16日

--

![](../Images/7dad29578270e9b12624d8eb686a6fd3.png)

照片由 [Denys Nevozhai](https://unsplash.com/@dnevozhai) 提供，来源于 [Unsplash](https://unsplash.com/photos/7nrsVjvALnA)

*这是关于地理空间数据分析系列的第四篇文章：*

1.  [*使用 QGIS 进行地理空间数据分析*](/a-practical-introduction-to-geospatial-data-analysis-using-qgis-a6f82105b30e?sk=e6251697a54bc62fa33bc6a9a81258a7)

1.  [*OpenStreetMap 入门指南*](/a-comprehensive-guide-for-getting-started-with-openstreetmap-e92dff95fc80?sk=e0981a4fed7f4cfefa9a58477a863ea6)

1.  [*使用 GeoPandas 进行地理空间数据分析*](/geospatial-data-analysis-with-geopandas-876cb72721cb?sk=042a0f2fb834cb08ffd0f74eb856e7e1)

1.  *使用 OSMnx 进行地理空间数据分析（本文）*

1.  [*数据科学家的地理编码*](https://www.datacamp.com/tutorial/geocoding-for-data-scientists)

1.  [*使用 Geemap 进行地理空间数据分析*](https://www.kdnuggets.com/geospatial-data-analysis-with-geemap)

在之前的教程中，我涵盖了地理空间数据分析的各个方面。我首先展示了不使用任何代码的地理空间数据实际示例，以帮助你深入理解这些概念。地理空间数据分析是一个普遍存在的领域，涉及处理一种特殊类型的数据——地理空间数据。

这包括将位置添加到非地理数据中。文中充满了示例。你可以想到咖啡馆、医院、道路、河流、卫星图像等。即使你用 Google Maps 搜索一个地点，你也在与地理空间数据互动。

这次我将专注于从 OpenStreetMap 下载、可视化和分析数据。OpenStreetMap 是最大的免费且可编辑的地理数据库，来自世界各地的志愿者共同参与这个庞大的项目。这个教程得益于一个名为 OSMnx 的 Python 包。让我们开始吧！

**目录：**

+   **OSMNx简介**

+   **下载和可视化OSM数据**

+   **将图形转换为GeoDataframe**

+   **提取兴趣点**

+   **寻找最短路径**

## **OSMNx简介**

OSMnx是一个用于下载、分析和可视化OpenStreetMap网络数据的库。它依赖于两个库，[NetworkX](https://networkx.org/)和[GeoPandas](https://geopandas.org/en/stable/)。特别地，它利用NetworkX库中的`graph`模块来检索网络数据。

此外，它允许我们与两个OpenStreetMap API进行交互：

+   [**Nomatism**](https://nominatim.org/)用于地理编码，即通过名称和地址查找位置。

+   [**Overpass API**](https://wiki.openstreetmap.org/wiki/Overpass_API)用于提取兴趣点，如高速公路、学校和公园。

## **下载和可视化OSM数据**

我们可以直接使用OSMNx，而不是从网站或Geofabrik手动下载数据。

首先，我们需要导入四个库，这些库将在教程中稍后使用：

[PRE0]

除了OSMnx和matplotlib，我们还将利用**folium**，它以创建交互式地图而闻名，以及**contextily**来添加背景地图。这一点对获得现实地图非常重要。

像之前一样，我们将读取并可视化博洛尼亚的OSM街道网络数据，博洛尼亚是意大利最大的城市之一。

[PRE1]

![](../Images/d83d8634904aea63069af3ebd25cb134.png)

博洛尼亚的黑白可视化

从黑白可视化中，我们可以观察到代表节点的点和描绘线路的线条。与OpenStreetMap网站相比，它可能显得非常静态和基础。Folium通过其强大的可解释地图来拯救我们：

[PRE2]

![](../Images/690c6f56e31751195b6008415e8cee32.png)

使用Folium获得的博洛尼亚地图

这要好得多，你不觉得吗？亮丽的颜色和与地图交互的可能性是使用Google Maps去未知地方时至关重要的特点。

如果你更仔细地查看OpenStreetMap网站，你会发现默认情况下是标准图层。除了标准图层，还有其他图层，比如Cycle Map和Transport Map。我们可以根据目的利用不同的图层，这一点非常令人惊叹。

![](../Images/b915493d7967d14bc9b3196cef8ee42e.png)

如果我们对自行车情有独钟，我们会更关注Cycle Map。只需一行代码就能实现：

[PRE3]

在接下来的部分，我们将考虑标准图形。

## 将图形转换为GeoDataframe

处理图形不像处理Dataframes和GeoDataframes那样直观。因此，我们可能需要将图形转换为GeoDataframe：

[PRE4]

![](../Images/d4c86ffb0ab82edda44131be8c9bef3e.png)

[PRE5]

![](../Images/88526562cc4c56348be0124a12ff992f.png)

你会发现我们得到了两个 GeoDataframe，一个用于节点，一个用于边。查看几何形状就会很清楚。区域 geodataframe 只有一对坐标，即纬度和经度，而包含边的 geodataframe 中有两对坐标。

## **提取兴趣点**

在进行数据科学项目时，我们尝试通过在互联网上搜索开放数据来为数据集添加信息。从 OSM 数据中，可以提取 **兴趣点**（POI），这些是根据我们的分析目的我们可能会觉得有趣的地方。示例包括餐馆、教堂、博物馆和公园。

例如，我们想要分析博洛尼亚的交通情况，以优化和减少运输成本。在这种情况下，了解高速公路、加油站、停车场以及其他可能成为瓶颈的地方将非常有用。

让我们来看看城市中的所有加油站。这可以通过将 [燃料](https://wiki.openstreetmap.org/wiki/Tag:amenity=fuel?uselang=en) 作为 amenity 键的值来实现。

[PRE6]

![](../Images/4bcdadda327c18186952bd4386838478.png)

由于我们已经提取了所有加油站，通过可视化地图来理解它们的位置会更有用。此外，我们可以添加基础地图来更好地 contextualize 我们的结果。

[PRE7]

![](../Images/bdcb8dac2b1ba5e053b4e59ab23021b1.png)

太棒了！我们可以注意到大多数加油站集中在城市边缘。此外，我们可以区分不同组的服务站，这些在测量中心外交通时需要考虑。

## **找到最短路线**

OSMnx 库的另一个有用功能是能够计算两个点之间的最短路径。

[PRE8]

这是通过 shortest_path() 方法实现的，该方法默认使用 **Dijkstra 算法** 来计算源节点和目标节点之间的路径。

[PRE9]

我们还可以尝试在同一地图上可视化图形和最短路径：

[PRE10]

![](../Images/e789fc218f054bedee2eac0cb0676cc0.png)

看吧！这就像我们使用了 Google Maps 来寻找路线一样，不过我们利用了 OSMnx 库的功能来进行查找。

## 最后的想法：

这是一份指南，让你了解如何使用 Python 操作 OSM 数据。我发现 OSMnx 是处理 OpenStreetMap 数据的最完整的 Python 库。当然，它更适合探索较小的地方，比如城市。如果数据集较大，最好使用更专业的软件，比如 QGIS 来进行可视化。如果你尝试过其他库来处理 OSM 数据，请在评论中分享。如果你想查看代码，可以点击 [这里](https://jovian.com/eugeniaring/geospatial-osm-osmnx)。感谢阅读！祝你有美好的一天！

**有用的资源：**

+   [OSMnx 文档](https://osmnx.readthedocs.io/en/stable/)

+   [兴趣点](https://wiki.openstreetmap.org/wiki/Points_of_interest)

+   [OSMnx: 用于街道网络的 Python](https://geoffboeing.com/2016/11/osmnx-python-street-networks/)

+   [自动化 GIS 过程](https://autogis-site.readthedocs.io/en/latest/lessons/lesson-6/network-analysis.html)

你喜欢我的文章吗？[*成为会员*](https://eugenia-anello.medium.com/membership) *并每天获得无限的数据科学文章访问权限！这是一种间接支持我的方式，对你没有额外费用。如果你已经是会员，* [*订阅*](https://eugenia-anello.medium.com/subscribe) *以便每当我发布新的数据科学和 Python 指南时接收邮件！*
