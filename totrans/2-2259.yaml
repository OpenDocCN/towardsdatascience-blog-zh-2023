- en: User Churn Prediction
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç”¨æˆ·æµå¤±é¢„æµ‹
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/user-churn-prediction-d43c53e6f6df](https://towardsdatascience.com/user-churn-prediction-d43c53e6f6df)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/user-churn-prediction-d43c53e6f6df](https://towardsdatascience.com/user-churn-prediction-d43c53e6f6df)
- en: Modern data warehousing and Machine Learning
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç°ä»£æ•°æ®ä»“åº“ä¸æœºå™¨å­¦ä¹ 
- en: '[](https://mshakhomirov.medium.com/?source=post_page-----d43c53e6f6df--------------------------------)[![ğŸ’¡Mike
    Shakhomirov](../Images/bc6895c7face3244d488feb97ba0f68e.png)](https://mshakhomirov.medium.com/?source=post_page-----d43c53e6f6df--------------------------------)[](https://towardsdatascience.com/?source=post_page-----d43c53e6f6df--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----d43c53e6f6df--------------------------------)
    [ğŸ’¡Mike Shakhomirov](https://mshakhomirov.medium.com/?source=post_page-----d43c53e6f6df--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://mshakhomirov.medium.com/?source=post_page-----d43c53e6f6df--------------------------------)[![ğŸ’¡Mike
    Shakhomirov](../Images/bc6895c7face3244d488feb97ba0f68e.png)](https://mshakhomirov.medium.com/?source=post_page-----d43c53e6f6df--------------------------------)[](https://towardsdatascience.com/?source=post_page-----d43c53e6f6df--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----d43c53e6f6df--------------------------------)
    [ğŸ’¡Mike Shakhomirov](https://mshakhomirov.medium.com/?source=post_page-----d43c53e6f6df--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----d43c53e6f6df--------------------------------)
    Â·12 min readÂ·Dec 23, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----d43c53e6f6df--------------------------------)
    Â·12 åˆ†é’Ÿé˜…è¯»Â·2023å¹´12æœˆ23æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/0a9d2bfb8a03495210b04f4972d48852.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/0a9d2bfb8a03495210b04f4972d48852.png)'
- en: Photo by [Martin Adams](https://unsplash.com/@martinadams?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ç…§ç‰‡ç”± [Martin Adams](https://unsplash.com/@martinadams?utm_source=medium&utm_medium=referral)
    æä¾›ï¼Œå‘å¸ƒåœ¨ [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
- en: 'No doubt, **user retention** is a crucial performance metric for many companies
    and online apps. We will discuss how we can use built-in data warehouse machine
    learning capabilities to run propensity models on user behaviour data to determine
    the likelihood of **user churn**. In this story, I would like to focus on dataset
    preparation and model training using standard SQL. Modern data warehouses allow
    this. Indeed, retention is an important business metric that helps understand
    user behaviourâ€™s mechanics. It provides a high-level overview of how successful
    our Application is in terms of retaining users by answering one simple question:
    Is our App good enough at retaining users? It is a well-known fact that itâ€™s cheaper
    to retain an existing user than to acquire a new one.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯«æ— ç–‘é—®ï¼Œ**ç”¨æˆ·ç•™å­˜**æ˜¯è®¸å¤šå…¬å¸å’Œåœ¨çº¿åº”ç”¨ç¨‹åºçš„é‡è¦ç»©æ•ˆæŒ‡æ ‡ã€‚æˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åˆ©ç”¨å†…ç½®çš„æ•°æ®ä»“åº“æœºå™¨å­¦ä¹ åŠŸèƒ½ï¼Œè¿è¡Œç”¨æˆ·è¡Œä¸ºæ•°æ®çš„å€¾å‘æ¨¡å‹ï¼Œä»¥ç¡®å®š**ç”¨æˆ·æµå¤±**çš„å¯èƒ½æ€§ã€‚åœ¨è¿™ä¸ªæ•…äº‹ä¸­ï¼Œæˆ‘æƒ³é‡ç‚¹å…³æ³¨æ•°æ®é›†å‡†å¤‡å’Œä½¿ç”¨æ ‡å‡†
    SQL è¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚ç°ä»£æ•°æ®ä»“åº“å…è®¸è¿™æ ·åšã€‚ç¡®å®ï¼Œç•™å­˜æ˜¯ä¸€ä¸ªé‡è¦çš„ä¸šåŠ¡æŒ‡æ ‡ï¼Œæœ‰åŠ©äºç†è§£ç”¨æˆ·è¡Œä¸ºçš„æœºåˆ¶ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé«˜å±‚æ¬¡çš„æ¦‚è¿°ï¼Œå›ç­”äº†æˆ‘ä»¬åº”ç”¨ç¨‹åºåœ¨ç•™ä½ç”¨æˆ·æ–¹é¢çš„æˆåŠŸç¨‹åº¦ï¼šæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ˜¯å¦è¶³å¤Ÿå¥½ï¼Œèƒ½å¤Ÿç•™ä½ç”¨æˆ·ï¼Ÿä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„äº‹å®æ˜¯ï¼Œç•™ä½ç°æœ‰ç”¨æˆ·æ¯”è·å¾—æ–°ç”¨æˆ·è¦ä¾¿å®œã€‚
- en: In one of my previous articles, I wrote about modern data warehousing [1].
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æˆ‘ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å†™åˆ°äº†ç°ä»£æ•°æ®ä»“åº“ [1]ã€‚
- en: '[](/modern-data-warehousing-2b1b0486ce4a?source=post_page-----d43c53e6f6df--------------------------------)
    [## Modern Data Warehousing'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '[](/modern-data-warehousing-2b1b0486ce4a?source=post_page-----d43c53e6f6df--------------------------------)
    [## ç°ä»£æ•°æ®ä»“åº“'
- en: State-of-the-art data platform design
  id: totrans-11
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: å…ˆè¿›çš„æ•°æ®å¹³å°è®¾è®¡
- en: towardsdatascience.com](/modern-data-warehousing-2b1b0486ce4a?source=post_page-----d43c53e6f6df--------------------------------)
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: towardsdatascience.com](/modern-data-warehousing-2b1b0486ce4a?source=post_page-----d43c53e6f6df--------------------------------)
- en: Modern DWH has a lot of useful features and components which differentiate them
    from other data platform types [2].
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: ç°ä»£ DWH å…·æœ‰è®¸å¤šæœ‰ç”¨çš„åŠŸèƒ½å’Œç»„ä»¶ï¼Œä½¿å…¶ä¸å…¶ä»–æ•°æ®å¹³å°ç±»å‹æœ‰æ‰€åŒºåˆ« [2]ã€‚
- en: ML model support seems to be the foundational DWH component when dealing with
    big data.
  id: totrans-14
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ML æ¨¡å‹æ”¯æŒä¼¼ä¹æ˜¯å¤„ç†å¤§æ•°æ®æ—¶çš„åŸºç¡€ DWH ç»„ä»¶ã€‚
- en: In this story, I will use **Binary logistic regression**, one of the fastest
    models to train. I will demonstrate how we can use it to predict user propensity
    to churn. Indeed, We donâ€™t need to know every machine-learning model.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸ªæ•…äº‹ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨**äºŒå…ƒé€»è¾‘å›å½’**ï¼Œè¿™æ˜¯è®­ç»ƒé€Ÿåº¦æœ€å¿«çš„æ¨¡å‹ä¹‹ä¸€ã€‚æˆ‘å°†æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨å®ƒæ¥é¢„æµ‹ç”¨æˆ·æµå¤±çš„å€¾å‘ã€‚ç¡®å®ï¼Œæˆ‘ä»¬ä¸éœ€è¦äº†è§£æ¯ä¸€ä¸ªæœºå™¨å­¦ä¹ æ¨¡å‹ã€‚
- en: We canâ€™t compete with cloud service providers such as Amazon ang Google in machine
    learning and data science but we need to know how to use it.
  id: totrans-16
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æ— æ³•ä¸ Amazon å’Œ Google ç­‰äº‘æœåŠ¡æä¾›å•†åœ¨æœºå™¨å­¦ä¹ å’Œæ•°æ®ç§‘å­¦é¢†åŸŸç«äº‰ï¼Œä½†æˆ‘ä»¬éœ€è¦çŸ¥é“å¦‚ä½•ä½¿ç”¨å®ƒã€‚
- en: 'I previously wrote about it in my article here [3]:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘åœ¨æˆ‘çš„æ–‡ç« ä¸­æ›¾ç»å†™è¿‡å…³äºè¿™ä¸ªçš„å†…å®¹ [3]ï¼š
- en: '[](/how-to-become-a-data-engineer-c0319cb226c2?source=post_page-----d43c53e6f6df--------------------------------)
    [## How to Become a Data Engineer'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '[](/how-to-become-a-data-engineer-c0319cb226c2?source=post_page-----d43c53e6f6df--------------------------------)
    [## å¦‚ä½•æˆä¸ºæ•°æ®å·¥ç¨‹å¸ˆ'
- en: A shortcut for beginners in 2024
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2024å¹´åˆå­¦è€…çš„å¿«æ·æ–¹å¼
- en: towardsdatascience.com](/how-to-become-a-data-engineer-c0319cb226c2?source=post_page-----d43c53e6f6df--------------------------------)
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '[towardsdatascience.com](/how-to-become-a-data-engineer-c0319cb226c2?source=post_page-----d43c53e6f6df--------------------------------)'
- en: In this tutorial, we will learn how to transform raw event data to create a
    training dataset for our ML model. We will use it to generate predictions for
    our users. I will use **BigQuery ML** as an example but there are a lot of other
    DWH tools that support this feature.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•è½¬æ¢åŸå§‹äº‹ä»¶æ•°æ®ï¼Œä»¥åˆ›å»ºä¸€ä¸ªç”¨äº ML æ¨¡å‹çš„è®­ç»ƒæ•°æ®é›†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥ç”Ÿæˆå¯¹ç”¨æˆ·çš„é¢„æµ‹ã€‚æˆ‘å°†ä»¥**BigQuery ML**ä½œä¸ºç¤ºä¾‹ï¼Œä½†è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ”¯æŒæ­¤åŠŸèƒ½çš„æ•°æ®ä»“åº“å·¥å…·ã€‚
- en: BigQuery ML democratizes machine learning operations and model training, so
    now data analysts or software engineers can train models with ease. All we need
    is a good knowledge of SQL and an understanding of user retention dataset logic
    [4].
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: BigQuery ML ä½¿æœºå™¨å­¦ä¹ æ“ä½œå’Œæ¨¡å‹è®­ç»ƒå˜å¾—æ›´åŠ æ™®åŠï¼Œå› æ­¤ç°åœ¨æ•°æ®åˆ†æå¸ˆæˆ–è½¯ä»¶å·¥ç¨‹å¸ˆå¯ä»¥è½»æ¾è®­ç»ƒæ¨¡å‹ã€‚æˆ‘ä»¬åªéœ€è¦å¯¹ SQL æœ‰è‰¯å¥½çš„çŸ¥è¯†ï¼Œå¹¶äº†è§£ç”¨æˆ·ä¿ç•™æ•°æ®é›†çš„é€»è¾‘[4]ã€‚
- en: The data preparation process is straightforward and should be easy to follow.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: æ•°æ®å‡†å¤‡è¿‡ç¨‹ç®€å•æ˜äº†ï¼Œåº”è¯¥å¾ˆå®¹æ˜“è·Ÿéšã€‚
- en: We will use standard SQL for this.
  id: totrans-24
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†ä½¿ç”¨æ ‡å‡† SQL æ¥å®ç°ã€‚
- en: Very often, it helps to reveal some useful facts about the data and user base.
    Analyzing user behaviour and performing exploratory data analysis helps to detect
    important user behaviour funnels (open funnels)that can later be used for further
    feature engineering and to improve the model.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: é€šå¸¸ï¼Œè¿™æœ‰åŠ©äºæ­ç¤ºä¸€äº›æœ‰å…³æ•°æ®å’Œç”¨æˆ·åŸºç¡€çš„æœ‰ç”¨ä¿¡æ¯ã€‚åˆ†æç”¨æˆ·è¡Œä¸ºå’Œè¿›è¡Œæ¢ç´¢æ€§æ•°æ®åˆ†ææœ‰åŠ©äºæ£€æµ‹é‡è¦çš„ç”¨æˆ·è¡Œä¸ºæ¼æ–—ï¼ˆå¼€æ”¾æ¼æ–—ï¼‰ï¼Œè¿™äº›æ¼æ–—å¯ä»¥ç”¨äºè¿›ä¸€æ­¥çš„ç‰¹å¾å·¥ç¨‹ï¼Œå¹¶æ”¹è¿›æ¨¡å‹ã€‚
- en: As an example, we can use one of those free user behaviour datasets with user
    event data kindly provided by Google. The typical mobile application has two builds
    â€” Android and IOS which generate a constant flow of event data. Google Analytics
    4 is a good example and this data can be used to measure traffic and engagement
    levels in our application.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Google å‹å–„æä¾›çš„å…è´¹ç”¨æˆ·è¡Œä¸ºæ•°æ®é›†ä¸­çš„ä¸€ä¸ªã€‚è¿™äº›æ•°æ®é›†çš„å…¸å‹ç§»åŠ¨åº”ç”¨æœ‰ä¸¤ä¸ªç‰ˆæœ¬â€”â€”Android å’Œ iOSï¼Œå®ƒä»¬ç”ŸæˆæŒç»­çš„äº‹ä»¶æ•°æ®æµã€‚Google
    Analytics 4 æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œè¿™äº›æ•°æ®å¯ä»¥ç”¨æ¥è¡¡é‡æˆ‘ä»¬åº”ç”¨ä¸­çš„æµé‡å’Œå‚ä¸åº¦æ°´å¹³ã€‚
- en: Every model requires a dataset
  id: totrans-27
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æ¯ä¸ªæ¨¡å‹éƒ½éœ€è¦ä¸€ä¸ªæ•°æ®é›†
- en: 'We would want to create one. We will need to:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªã€‚æˆ‘ä»¬éœ€è¦ï¼š
- en: Perform exploratory data analysis (EDA) on BigQuery export dataset from Firebase
    (Google Analytics 4).
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¯¹æ¥è‡ª Firebaseï¼ˆGoogle Analytics 4ï¼‰çš„ BigQuery å¯¼å‡ºæ•°æ®é›†è¿›è¡Œæ¢ç´¢æ€§æ•°æ®åˆ†æï¼ˆEDAï¼‰ã€‚
- en: Split the dataset into two parts for training and tests with categorical and
    behavioural attributes for the Machine Learning (ML) model.
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å°†æ•°æ®é›†åˆ†ä¸ºä¸¤éƒ¨åˆ†ç”¨äºè®­ç»ƒå’Œæµ‹è¯•ï¼ŒåŒ…å«ç”¨äºæœºå™¨å­¦ä¹ ï¼ˆMLï¼‰æ¨¡å‹çš„åˆ†ç±»å’Œè¡Œä¸ºå±æ€§ã€‚
- en: Train and Evaluate Machine learning models using BigQuery ML
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ BigQuery ML è®­ç»ƒå’Œè¯„ä¼°æœºå™¨å­¦ä¹ æ¨¡å‹
- en: Make predictions using the BigQuery ML models
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ BigQuery ML æ¨¡å‹è¿›è¡Œé¢„æµ‹
- en: Use model insights in practice
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å°†æ¨¡å‹æ´å¯Ÿåº”ç”¨äºå®è·µ
- en: In Firebase or Google Analytics 4 all user-behaviour data is being stored as
    events, which means that each row within a table corresponds to a single event
    with additional parameters and properties.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Firebase æˆ– Google Analytics 4 ä¸­ï¼Œæ‰€æœ‰ç”¨æˆ·è¡Œä¸ºæ•°æ®éƒ½ä½œä¸ºäº‹ä»¶å­˜å‚¨ï¼Œè¿™æ„å‘³ç€è¡¨ä¸­çš„æ¯ä¸€è¡Œå¯¹åº”ä¸€ä¸ªå•ç‹¬çš„äº‹ä»¶ï¼Œå¹¶é™„å¸¦é¢å¤–çš„å‚æ•°å’Œå±æ€§ã€‚
- en: '![](../Images/de2206802fb76a7cda08f3f6d97b2263.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/de2206802fb76a7cda08f3f6d97b2263.png)'
- en: Dataset prep and model training diag
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: æ•°æ®é›†å‡†å¤‡å’Œæ¨¡å‹è®­ç»ƒç¤ºæ„å›¾
- en: We will use a publicly available Google Analytics dataset [5], it has data for
    a mobile game app called "Flood It!" (Android, iOS) and there are no associated
    costs to that. However, Google Cloud Platform (GCP) services are billable and
    might incur costs.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå…¬å¼€çš„ Google Analytics æ•°æ®é›†[5]ï¼Œå®ƒåŒ…å«ä¸€ä¸ªåä¸ºâ€œFlood It!â€çš„ç§»åŠ¨æ¸¸æˆåº”ç”¨çš„æ•°æ®ï¼ˆAndroidã€iOSï¼‰ï¼Œä¸”æ²¡æœ‰ç›¸å…³è´¹ç”¨ã€‚ç„¶è€Œï¼ŒGoogle
    Cloud Platformï¼ˆGCPï¼‰æœåŠ¡æ˜¯æŒ‰ä½¿ç”¨é‡è®¡è´¹çš„ï¼Œå¯èƒ½ä¼šäº§ç”Ÿè´¹ç”¨ã€‚
- en: '![](../Images/9e7f7a3247dd443790173bac26e0f466.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/9e7f7a3247dd443790173bac26e0f466.png)'
- en: Dataset exaple. Image by author.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: æ•°æ®é›†ç¤ºä¾‹ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: This dataset contains 5.7M events from over 15k users. Open the link above and
    click Preview.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: è¯¥æ•°æ®é›†åŒ…å«æ¥è‡ªè¶…è¿‡ 15,000 ä¸ªç”¨æˆ·çš„ 570 ä¸‡ä¸ªäº‹ä»¶ã€‚æ‰“å¼€ä¸Šé¢çš„é“¾æ¥å¹¶ç‚¹å‡»é¢„è§ˆã€‚
- en: It wonâ€™t cost anything to run a Preview on any table.
  id: totrans-41
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: è¿è¡Œä»»ä½•è¡¨çš„é¢„è§ˆä¸ä¼šäº§ç”Ÿè´¹ç”¨ã€‚
- en: 'Copy this dataset by running this in the command line below:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡åœ¨ä¸‹é¢çš„å‘½ä»¤è¡Œä¸­è¿è¡Œæ­¤å‘½ä»¤æ¥å¤åˆ¶æ­¤æ•°æ®é›†ï¼š
- en: '[PRE0]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Explore the data
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ¢ç´¢æ•°æ®
- en: Analyzing user behaviour and performing exploratory data analysis [6] helps
    to understand the user journey better.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ†æç”¨æˆ·è¡Œä¸ºå’Œè¿›è¡Œæ¢ç´¢æ€§æ•°æ®åˆ†æ [6] æœ‰åŠ©äºæ›´å¥½åœ°ç†è§£ç”¨æˆ·æ—…ç¨‹ã€‚
- en: '[](/exploratory-data-analysis-with-bigquery-sql-easy-69895ac4eb9e?source=post_page-----d43c53e6f6df--------------------------------)
    [## Exploratory Data Analysis with BigQuery SQL? Easy!'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '[](/exploratory-data-analysis-with-bigquery-sql-easy-69895ac4eb9e?source=post_page-----d43c53e6f6df--------------------------------)
    [## ä½¿ç”¨BigQuery SQLè¿›è¡Œæ¢ç´¢æ€§æ•°æ®åˆ†æï¼Ÿç®€å•ï¼'
- en: Complete Python comparison and Step by Step guide for any dataset. Kaggle User
    churn data.
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: å®Œæ•´çš„Pythonæ¯”è¾ƒå’Œé€æ­¥æŒ‡å—ï¼Œé€‚ç”¨äºä»»ä½•æ•°æ®é›†ã€‚Kaggleç”¨æˆ·æµå¤±æ•°æ®ã€‚
- en: towardsdatascience.com](/exploratory-data-analysis-with-bigquery-sql-easy-69895ac4eb9e?source=post_page-----d43c53e6f6df--------------------------------)
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: towardsdatascience.com](/exploratory-data-analysis-with-bigquery-sql-easy-69895ac4eb9e?source=post_page-----d43c53e6f6df--------------------------------)
- en: 'Run this query to check the dataset structure:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: è¿è¡Œæ­¤æŸ¥è¯¢ä»¥æ£€æŸ¥æ•°æ®é›†ç»“æ„ï¼š
- en: '[PRE1]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The limitation of this dataset is that user data doesnâ€™t have an actual `user_id`
    that is often assigned after registration. So working with this dataset, we work
    only with `device ids`, which is not great in an ideal world as those are constantly
    updated after re-install or new App version rollout.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: è¯¥æ•°æ®é›†çš„é™åˆ¶åœ¨äºç”¨æˆ·æ•°æ®æ²¡æœ‰å®é™…çš„ `user_id`ï¼Œè€Œ `user_id` é€šå¸¸æ˜¯åœ¨æ³¨å†Œååˆ†é…çš„ã€‚å› æ­¤ï¼Œåœ¨å¤„ç†è¯¥æ•°æ®é›†æ—¶ï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨ `device
    ids`ï¼Œè¿™åœ¨ç†æƒ³æƒ…å†µä¸‹ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºè¿™äº›åœ¨é‡æ–°å®‰è£…æˆ–æ–°åº”ç”¨ç‰ˆæœ¬æ¨å‡ºåä¼šä¸æ–­æ›´æ–°ã€‚
- en: Firstly, we would want to pre-process raw event data and create a new dataset
    that has the right structure for the ML model.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹åŸå§‹äº‹ä»¶æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå…·æœ‰æ­£ç¡®ç»“æ„çš„æ–°æ•°æ®é›†ï¼Œä»¥ä¾¿ç”¨äºæœºå™¨å­¦ä¹ æ¨¡å‹ã€‚
- en: We will label each user as **retained (0)** if they were active during the last
    30 days.
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¦‚æœç”¨æˆ·åœ¨è¿‡å»30å¤©å†…æ´»è·ƒï¼Œæˆ‘ä»¬å°†æ ‡è®°æ¯ä¸ªç”¨æˆ·ä¸º**ä¿ç•™ï¼ˆ0ï¼‰**ã€‚
- en: We will use the `user_pseudo_id` (device_id) that is used by GA4\. Firebase
    by default to identify each userâ€™s device.
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†ä½¿ç”¨ GA4 çš„ `user_pseudo_id`ï¼ˆdevice_idï¼‰ï¼ŒFirebase é»˜è®¤ä½¿ç”¨å®ƒæ¥è¯†åˆ«æ¯ä¸ªç”¨æˆ·çš„è®¾å¤‡ã€‚
- en: Based on our EDA we will exclude some obvious outliers, i.e. spammers (too many
    events), and `bounced` users (those who spent less than 10 minutes in the App
    after the `install` event).
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ ¹æ®æˆ‘ä»¬çš„EDAï¼Œæˆ‘ä»¬å°†æ’é™¤ä¸€äº›æ˜æ˜¾çš„å¼‚å¸¸å€¼ï¼Œä¾‹å¦‚åƒåœ¾é‚®ä»¶å‘é€è€…ï¼ˆäº‹ä»¶è¿‡å¤šï¼‰å’Œ `bounced` ç”¨æˆ·ï¼ˆåœ¨ `install` äº‹ä»¶ååœ¨åº”ç”¨ä¸­åœç•™æ—¶é—´å°‘äº10åˆ†é’Ÿçš„ç”¨æˆ·ï¼‰ã€‚
- en: We will add a few columns with categorical features extracted from raw event
    data, i.e. `platform`, `device_type`, `country`, etc.
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†æ·»åŠ å‡ ä¸ªä»åŸå§‹äº‹ä»¶æ•°æ®ä¸­æå–çš„ç±»åˆ«ç‰¹å¾åˆ—ï¼Œä¾‹å¦‚ `platform`ã€`device_type`ã€`country` ç­‰ã€‚
- en: We will finally add user behaviour and activity totals for each user within
    a certain period of time, i.e. `user_engagement`, `spend_virtual_currency`, etc.
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æœ€ç»ˆä¼šæ·»åŠ æ¯ä¸ªç”¨æˆ·åœ¨ä¸€å®šæ—¶é—´å†…çš„ç”¨æˆ·è¡Œä¸ºå’Œæ´»åŠ¨æ€»é‡ï¼Œä¾‹å¦‚ `user_engagement`ã€`spend_virtual_currency` ç­‰ã€‚
- en: These calculations will be used as ML model features, but in a nutshell, they
    are open event funnels, i.e. userâ€™s steps while using the App.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™äº›è®¡ç®—å°†ç”¨ä½œæœºå™¨å­¦ä¹ æ¨¡å‹çš„ç‰¹å¾ï¼Œä½†ç®€è€Œè¨€ä¹‹ï¼Œå®ƒä»¬æ˜¯å¼€æ”¾çš„äº‹ä»¶æ¼æ–—ï¼Œå³ç”¨æˆ·åœ¨ä½¿ç”¨åº”ç”¨ç¨‹åºæ—¶çš„æ­¥éª¤ã€‚
- en: Our **not churned** (returning user) definition is that the user was active,
    and engaging with the App within the last 30 days from the current date. You can
    try to tweak this parameter. You can also try to predict something, i.e. the likelihood
    of spending money in the App (`in_app_purchase`), etc.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çš„**æœªæµå¤±**ï¼ˆå›å½’ç”¨æˆ·ï¼‰å®šä¹‰æ˜¯ç”¨æˆ·åœ¨å½“å‰æ—¥æœŸå‰çš„è¿‡å»30å¤©å†…æ´»è·ƒå¹¶ä¸åº”ç”¨ç¨‹åºäº’åŠ¨ã€‚ä½ å¯ä»¥å°è¯•è°ƒæ•´æ­¤å‚æ•°ã€‚ä½ è¿˜å¯ä»¥å°è¯•é¢„æµ‹æŸäº›å†…å®¹ï¼Œä¾‹å¦‚åœ¨åº”ç”¨ä¸­æ¶ˆè´¹çš„å¯èƒ½æ€§ï¼ˆ`in_app_purchase`ï¼‰ç­‰ã€‚
- en: Calculating bounced and churned users
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è®¡ç®—è·³å¤±å’Œæµå¤±ç”¨æˆ·
- en: 'If weâ€™re using `user_pseudo_id` in our model, then we would calculate `bounced
    = 1` if `last_touch` within 10 min after registration, else 0:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬åœ¨æ¨¡å‹ä¸­ä½¿ç”¨ `user_pseudo_id`ï¼Œåˆ™å¦‚æœ `last_touch` åœ¨æ³¨å†Œå10åˆ†é’Ÿå†…ï¼Œæˆ‘ä»¬ä¼šè®¡ç®— `bounced = 1`ï¼Œå¦åˆ™ä¸º0ï¼š
- en: '[PRE2]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Using ``current_date()`` to identify churned users would be ideal if we have
    a dynamic dataset that is being updated daily. However, we are working with some
    sample data and therefore, we should use the last known date in that data, i.e.
    we imagine we collected the data on that particular day (20181003).
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæ¯å¤©æ›´æ–°çš„åŠ¨æ€æ•°æ®é›†ï¼Œä½¿ç”¨ `current_date()` æ¥è¯†åˆ«æµå¤±ç”¨æˆ·æ˜¯ç†æƒ³çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æ­£åœ¨å¤„ç†ä¸€äº›æ ·æœ¬æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥ä½¿ç”¨æ•°æ®ä¸­çš„æœ€åå·²çŸ¥æ—¥æœŸï¼Œå³æˆ‘ä»¬å‡è®¾åœ¨ç‰¹å®šæ—¥æœŸï¼ˆ20181003ï¼‰æ”¶é›†äº†æ•°æ®ã€‚
- en: 'Ideally, we would want to track only those users who have passed the registration
    in the App after they installed it. In that case, we wouldnâ€™t need to calculate
    ``bounced``, and we will count ``churned = 1`` if ``last_seen_dt`` was before
    ***24 hr/ 3 day/ 30******day***s from `current_timestamp()`, else 0:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åªè·Ÿè¸ªé‚£äº›åœ¨å®‰è£…åº”ç”¨åå®Œæˆæ³¨å†Œçš„ç”¨æˆ·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦è®¡ç®— `bounced`ï¼Œå¦‚æœ `last_seen_dt` åœ¨ä» `current_timestamp()`
    è®¡ç®—çš„ ***24å°æ—¶/3å¤©/30å¤©*** ä¹‹å‰ï¼Œåˆ™è®¡ç®— `churned = 1`ï¼Œå¦åˆ™ä¸º0ï¼š
- en: '[PRE3]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Adding behavioural quantitative and categorical features
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ·»åŠ è¡Œä¸ºå®šé‡å’Œç±»åˆ«ç‰¹å¾
- en: This is what we will use to build our model. Categorical features can represent
    some non-quantifiable demographic values, i.e. male/female, etc. Quantitative
    is what we can measure and count.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°±æ˜¯æˆ‘ä»¬å°†ç”¨æ¥æ„å»ºæ¨¡å‹çš„æ•°æ®ã€‚åˆ†ç±»ç‰¹å¾å¯ä»¥è¡¨ç¤ºä¸€äº›ä¸å¯é‡åŒ–çš„äººå£ç»Ÿè®¡å€¼ï¼Œä¾‹å¦‚æ€§åˆ«ç­‰ã€‚å®šé‡ç‰¹å¾åˆ™æ˜¯æˆ‘ä»¬å¯ä»¥æµ‹é‡å’Œè®¡æ•°çš„ã€‚
- en: A combination of both types of these features helps to create a more predictive
    model. There is a lot of information in the Firebase/GA4 dataset extract which
    might be useful for our model, i.e. app_info, device, event_params, geo etc.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸¤ç§ç‰¹å¾çš„ç»„åˆæœ‰åŠ©äºåˆ›å»ºä¸€ä¸ªæ›´å…·é¢„æµ‹æ€§çš„æ¨¡å‹ã€‚Firebase/GA4 æ•°æ®é›†ä¸­æå–äº†å¤§é‡ä¿¡æ¯ï¼Œè¿™å¯èƒ½å¯¹æˆ‘ä»¬çš„æ¨¡å‹æœ‰ç”¨ï¼Œä¾‹å¦‚ app_infoã€deviceã€event_paramsã€geo
    ç­‰ã€‚
- en: Many events are being collected automatically by Firebase, but keep in mind
    that there is a way to set custom events and properties. This is important for
    us as mobile developers can integrate a custom event, i.e. user `tag`. For our
    example App, it would indicate that a user might have certain in-app privileges
    (Premium, Influencer, Group Admin, Moderator, etc.).
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: Firebase ä¼šè‡ªåŠ¨æ”¶é›†è®¸å¤šäº‹ä»¶ï¼Œä½†è¯·è®°ä½ï¼Œä¹Ÿå¯ä»¥è®¾ç½®è‡ªå®šä¹‰äº‹ä»¶å’Œå±æ€§ã€‚ä½œä¸ºç§»åŠ¨å¼€å‘è€…ï¼Œæˆ‘ä»¬å¯ä»¥é›†æˆä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œä¾‹å¦‚ç”¨æˆ· `tag`ã€‚å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œè¿™å°†æŒ‡ç¤ºç”¨æˆ·å¯èƒ½å…·æœ‰æŸäº›åº”ç”¨å†…æƒé™ï¼ˆå¦‚é«˜çº§ä¼šå‘˜ã€å½±å“è€…ã€ç¾¤ç»„ç®¡ç†å‘˜ã€ç‰ˆä¸»ç­‰ï¼‰ã€‚
- en: 'Having said that, we would want to use the following categorical features:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: è¯è™½å¦‚æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ä»¥ä¸‹åˆ†ç±»ç‰¹å¾ï¼š
- en: platform (IOS/Android)
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: platform (IOS/Android)
- en: geo.country
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: geo.country
- en: device.operating_system
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: device.operating_system
- en: device.language
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: device.language
- en: It is important to say that users might have different values in these fields,
    i.e. different devices, changed languages, and VPN settings might affect those.
    So we would need only the first engagement event and the device setting they used
    on `install` or `registration`.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”¨æˆ·åœ¨è¿™äº›å­—æ®µä¸­å¯èƒ½å…·æœ‰ä¸åŒçš„å€¼ï¼Œä¾‹å¦‚ä¸åŒçš„è®¾å¤‡ã€è¯­è¨€æ›´æ”¹å’Œ VPN è®¾ç½®å¯èƒ½ä¼šå½±å“è¿™äº›å€¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦ç¬¬ä¸€ä¸ªå‚ä¸äº‹ä»¶å’Œä»–ä»¬åœ¨ `install`
    æˆ– `registration` æ—¶ä½¿ç”¨çš„è®¾å¤‡è®¾ç½®ã€‚
- en: 'Adding row_number function will help with that:'
  id: totrans-76
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æ·»åŠ  row_number å‡½æ•°å°†æœ‰åŠ©äºå®ç°è¿™ä¸€ç‚¹ï¼š
- en: '[PRE4]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Then, to predict user churn, we would want to count the number of events a
    user encountered within ***24 hours/3 days/ 7 days*** after registration/installation:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œä¸ºäº†é¢„æµ‹ç”¨æˆ·æµå¤±ï¼Œæˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡ç”¨æˆ·åœ¨æ³¨å†Œ/å®‰è£…åçš„ ***24å°æ—¶/3å¤©/7å¤©*** å†…é‡åˆ°çš„äº‹ä»¶æ•°é‡ï¼š
- en: 'In our case, we would want to collect and count these events:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ”¶é›†å’Œç»Ÿè®¡è¿™äº›äº‹ä»¶ï¼š
- en: user_engagement
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: user_engagement
- en: level_start_quickplay
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: level_start_quickplay
- en: level_end_quickplay
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: level_end_quickplay
- en: level_complete_quickplay
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: level_complete_quickplay
- en: level_reset_quickplay
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: level_reset_quickplay
- en: post_score
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: post_score
- en: spend_virtual_currency
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: spend_virtual_currency
- en: ad_reward
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ad_reward
- en: challenge_a_friend
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: challenge_a_friend
- en: completed_5_levels
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: completed_5_levels
- en: use_extra_steps
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: use_extra_steps
- en: 'For other Apps it might be useful to collect any other events that would describe
    user behaviour, i.e.:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºå…¶ä»–åº”ç”¨ç¨‹åºï¼Œæ”¶é›†æè¿°ç”¨æˆ·è¡Œä¸ºçš„å…¶ä»–äº‹ä»¶å¯èƒ½æ˜¯æœ‰ç”¨çš„ï¼Œå³ï¼š
- en: message_sent
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: message_sent
- en: chat_open
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: chat_open
- en: spend_virtual_currency
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: spend_virtual_currency
- en: account_topup
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: account_topup
- en: set_avatar
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: set_avatar
- en: group_join
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: group_join
- en: broadcast_listened
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: broadcast_listened
- en: achievement_unlocked
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: achievement_unlocked
- en: reputation_update
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: reputation_update
- en: Calculate model features
  id: totrans-101
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è®¡ç®—æ¨¡å‹ç‰¹å¾
- en: 'Letâ€™s create a dedicated dataset for our future model and its data: ``sample_churn_model``.'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ä¸ºæœªæ¥çš„æ¨¡å‹åŠå…¶æ•°æ®åˆ›å»ºä¸€ä¸ªä¸“ç”¨æ•°æ®é›†ï¼š`sample_churn_model`ã€‚
- en: 'The SQL query in `./sql/churn.sql` below demonstrates how these user metrics
    can be calculated. We can find this file in the code widget. To create this dataset
    run this in the command line:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '`./sql/churn.sql` ä¸­çš„ SQL æŸ¥è¯¢æ¼”ç¤ºäº†å¦‚ä½•è®¡ç®—è¿™äº›ç”¨æˆ·æŒ‡æ ‡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç å°éƒ¨ä»¶ä¸­æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚è¦åˆ›å»ºè¿™ä¸ªæ•°æ®é›†ï¼Œè¯·åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œï¼š'
- en: '[PRE5]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '`./sql/churn.sql:`'
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '`./sql/churn.sql:`'
- en: '[PRE6]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Letâ€™s see how many churned users we have:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬çœ‹çœ‹æœ‰å¤šå°‘ç”¨æˆ·æµå¤±äº†ï¼š
- en: 'From our dataset, we found that 4030 churned and were inactive during the last
    30 days:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: ä»æˆ‘ä»¬çš„æ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬å‘ç° 4030 åç”¨æˆ·åœ¨è¿‡å» 30 å¤©å†…æµå¤±å¹¶å¤„äºéæ´»åŠ¨çŠ¶æ€ï¼š
- en: '[PRE7]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](../Images/7c648c05ca2479c4d3ec0899d72617bb.png)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7c648c05ca2479c4d3ec0899d72617bb.png)'
- en: Churned users. Image by author.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: æµå¤±çš„ç”¨æˆ·ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: Model training and classification
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ¨¡å‹è®­ç»ƒå’Œåˆ†ç±»
- en: 'There are different model types [7] available in BigQuery ML at the moment:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å‰åœ¨ BigQuery ML ä¸­æœ‰ä¸åŒçš„æ¨¡å‹ç±»å‹ [7]ï¼š
- en: BOOSTED_TREE_CLASSIFIER
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: BOOSTED_TREE_CLASSIFIER
- en: Neural Networks
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç¥ç»ç½‘ç»œ
- en: AutoML Tables
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AutoML Tables
- en: Logistic Regression
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é€»è¾‘å›å½’
- en: Logistic regression might be a good choice to start with as it is the one that
    can be trained relatively fast. Other types of models might provide better performance
    but also require more time to train, i.e. Deep Neural Networks.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: é€»è¾‘å›å½’å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼Œå› ä¸ºå®ƒå¯ä»¥ç›¸å¯¹è¾ƒå¿«åœ°è®­ç»ƒã€‚å…¶ä»–ç±»å‹çš„æ¨¡å‹å¯èƒ½æä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œä½†ä¹Ÿéœ€è¦æ›´å¤šçš„è®­ç»ƒæ—¶é—´ï¼Œä¾‹å¦‚æ·±åº¦ç¥ç»ç½‘ç»œã€‚
- en: Each of these models will output a probability score (propensity) between 0
    and 1.0 of how likely the model prediction is based on the training data.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™äº›æ¨¡å‹ä¸­çš„æ¯ä¸€ä¸ªéƒ½ä¼šè¾“å‡ºä¸€ä¸ª0åˆ°1.0ä¹‹é—´çš„æ¦‚ç‡åˆ†æ•°ï¼ˆå€¾å‘ï¼‰ï¼Œè¡¨ç¤ºæ¨¡å‹é¢„æµ‹çš„å¯èƒ½æ€§ã€‚
- en: Consider the file ``./sql/churn_model.sql``. It will create and train the model
    if we run it.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·å‚è€ƒæ–‡ä»¶``./sql/churn_model.sql``ã€‚å¦‚æœæˆ‘ä»¬è¿è¡Œå®ƒï¼Œå®ƒå°†åˆ›å»ºå¹¶è®­ç»ƒæ¨¡å‹ã€‚
- en: 'Run this query to evaluate the model:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: è¿è¡Œæ­¤æŸ¥è¯¢æ¥è¯„ä¼°æ¨¡å‹ï¼š
- en: '[PRE8]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: You will see model performance metrics. Analyzing them might help to choose
    between different models.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å°†çœ‹åˆ°æ¨¡å‹æ€§èƒ½æŒ‡æ ‡ã€‚åˆ†æè¿™äº›æŒ‡æ ‡å¯èƒ½æœ‰åŠ©äºåœ¨ä¸åŒæ¨¡å‹ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚
- en: For instance, with regard to model accuracy, anything that is above 70% is considered
    to be a strong model performance.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚ï¼Œå…³äºæ¨¡å‹å‡†ç¡®æ€§ï¼Œä»»ä½•è¶…è¿‡70%çš„ç»“æœéƒ½è¢«è§†ä¸ºå¼ºæ¨¡å‹æ€§èƒ½ã€‚
- en: Our model has a recall of 0.559 â€” in other words, it correctly identifies 56%
    of all churned users.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çš„æ¨¡å‹çš„å¬å›ç‡ä¸º0.559â€”â€”æ¢å¥è¯è¯´ï¼Œå®ƒæ­£ç¡®è¯†åˆ«äº†56%çš„æ‰€æœ‰æµå¤±ç”¨æˆ·ã€‚
- en: '![](../Images/bb94cf7248e2a509ffe875dd8836488b.png)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/bb94cf7248e2a509ffe875dd8836488b.png)'
- en: Model performance metrics. Image by author.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: æ¨¡å‹æ€§èƒ½æŒ‡æ ‡ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: We can use a confusion matrix to see how well our model predicted the labels,
    compared to the actual labels.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ··æ·†çŸ©é˜µæ¥æŸ¥çœ‹æˆ‘ä»¬çš„æ¨¡å‹åœ¨é¢„æµ‹æ ‡ç­¾æ–¹é¢çš„è¡¨ç°ï¼Œä¸å®é™…æ ‡ç­¾è¿›è¡Œæ¯”è¾ƒã€‚
- en: If we run this SQL below it will generate a confusion matrix.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬è¿è¡Œä¸‹é¢çš„SQLï¼Œå®ƒå°†ç”Ÿæˆä¸€ä¸ªæ··æ·†çŸ©é˜µã€‚
- en: '[PRE9]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: This can be interpreted as a comparison of `false positive` and `false negative`
    predictions.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å¯ä»¥è¢«è§£é‡Šä¸º`false positive`å’Œ`false negative`é¢„æµ‹çš„æ¯”è¾ƒã€‚
- en: '![](../Images/5b057e352395c60f9a4a9b62348e78ef.png)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/5b057e352395c60f9a4a9b62348e78ef.png)'
- en: Confusion matrix. Image by author.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: æ··æ·†çŸ©é˜µã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: Using predictions
  id: totrans-134
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä½¿ç”¨é¢„æµ‹
- en: 'For our classification model, the most important metric is the user propensity
    to churn and be inactive. In other words, it is a probability and the closer this
    probability is to 1 the more likely this user will not return to the App according
    to the modelâ€™s prediction:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºæˆ‘ä»¬çš„åˆ†ç±»æ¨¡å‹ï¼Œæœ€é‡è¦çš„æŒ‡æ ‡æ˜¯ç”¨æˆ·æµå¤±å’Œä¸æ´»è·ƒçš„å€¾å‘ã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ˜¯ä¸€ç§æ¦‚ç‡ï¼Œä¸”è¯¥æ¦‚ç‡è¶Šæ¥è¿‘1ï¼Œæ¨¡å‹é¢„æµ‹çš„ç”¨æˆ·è¶Šä¸å¯èƒ½è¿”å›åº”ç”¨ç¨‹åºï¼š
- en: '[PRE10]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](../Images/ae4b21d5e38c60fa08b8944e23023472.png)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ae4b21d5e38c60fa08b8944e23023472.png)'
- en: Predictions. Image by author.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: é¢„æµ‹ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: In real-life scenario we would want to create a dataset with predictions that
    is being updated daily.
  id: totrans-139
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ªæ¯å¤©æ›´æ–°çš„é¢„æµ‹æ•°æ®é›†ã€‚
- en: '**Firstly**, we will need Firebase/Analytics users who registered yesterday.
    We will need to schedule our ``sample_churn_model.churn`` dataset and incrementally
    add new users from yesterday, i.e.:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '**é¦–å…ˆ**ï¼Œæˆ‘ä»¬éœ€è¦æ˜¨å¤©æ³¨å†Œçš„Firebase/Analyticsç”¨æˆ·ã€‚æˆ‘ä»¬éœ€è¦å®‰æ’æˆ‘ä»¬çš„``sample_churn_model.churn``æ•°æ®é›†ï¼Œå¹¶é€æ­¥æ·»åŠ æ˜¨å¤©çš„æ–°ç”¨æˆ·ï¼Œå³ï¼š'
- en: '[PRE11]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Then we would want to generate prediction for them and insert into our new
    `predictions` dataset:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åæˆ‘ä»¬å¸Œæœ›ç”Ÿæˆå¯¹å®ƒä»¬çš„é¢„æµ‹å¹¶å°†å…¶æ’å…¥åˆ°æˆ‘ä»¬çš„æ–°`predictions`æ•°æ®é›†ä¸­ï¼š
- en: '[PRE12]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: With this model we can better understand user behaviour through patterns, and,
    of course, we would want to do something with this knowledge.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨è¿™ä¸ªæ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨¡å¼æ›´å¥½åœ°ç†è§£ç”¨æˆ·è¡Œä¸ºï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›åˆ©ç”¨è¿™äº›çŸ¥è¯†åšäº›äº‹æƒ…ã€‚
- en: There are a number of ways to use prediction data (activate). For instance,
    we can read data directly from our DWH solution using SDK and client libraries.
    For example, we might want to **create a data service** that collects predictions
    every day for new users and then sends that data somewhere else, i.e. **retargeting
    service**. Yes, we would probably want to retarget users who are likely to churn
    or users who are likely to stay in the App too.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰å¤šç§æ–¹æ³•å¯ä»¥ä½¿ç”¨é¢„æµ‹æ•°æ®ï¼ˆæ¿€æ´»ï¼‰ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨SDKå’Œå®¢æˆ·ç«¯åº“ç›´æ¥ä»æˆ‘ä»¬çš„DWHè§£å†³æ–¹æ¡ˆä¸­è¯»å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›**åˆ›å»ºä¸€ä¸ªæ•°æ®æœåŠ¡**ï¼Œæ¯å¤©æ”¶é›†æ–°ç”¨æˆ·çš„é¢„æµ‹æ•°æ®ï¼Œç„¶åå°†è¿™äº›æ•°æ®å‘é€åˆ°å…¶ä»–åœ°æ–¹ï¼Œå³**é‡æ–°å®šå‘æœåŠ¡**ã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬å¯èƒ½ä¹Ÿå¸Œæœ›é‡æ–°å®šå‘é‚£äº›å¯èƒ½æµå¤±çš„ç”¨æˆ·æˆ–å¯èƒ½ç•™åœ¨åº”ç”¨ä¸­çš„ç”¨æˆ·ã€‚
- en: Conclusion
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: It is true that acting on machine learning (ML) model data to retain users proved
    itself extremely useful and might help to gain a competitive advantage in the
    fast-changing market environment. That is why it is important to be able to forecast
    user engagement to predict if users are about to leave. We donâ€™t need to be data
    scientists to create and train ML models. All we need â€” is a modern DWH, good
    knowledge of SQL and a good understanding of user retention logic. Modern data
    warehouses evolved to that state where we have the luxury of all known ML models
    and they are already set and ready to be created using standard SQL dialect. With
    predicted retention numbers, we can create and edit audiences. Using ML capabilities
    in modern DWH we can tailor user experience by targeting our identified users
    with relevant information, useful offers and promos. Modern DWH solutions democratize
    machine learning ops and model training. It is an extremely useful feature for
    data engineers as all these processes can be easily automated, scheduled and triggered
    depending on the use case scenario.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: ç¡®å®ï¼Œå¯¹æœºå™¨å­¦ä¹ ï¼ˆMLï¼‰æ¨¡å‹æ•°æ®é‡‡å–è¡ŒåŠ¨ä»¥ä¿ç•™ç”¨æˆ·è¢«è¯æ˜æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå¹¶ä¸”å¯èƒ½å¸®åŠ©åœ¨å¿«é€Ÿå˜åŒ–çš„å¸‚åœºç¯å¢ƒä¸­è·å¾—ç«äº‰ä¼˜åŠ¿ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆèƒ½å¤Ÿé¢„æµ‹ç”¨æˆ·å‚ä¸åº¦ä»¥é¢„æµ‹ç”¨æˆ·æ˜¯å¦å³å°†ç¦»å¼€æ˜¯é‡è¦çš„ã€‚æˆ‘ä»¬ä¸éœ€è¦æˆä¸ºæ•°æ®ç§‘å­¦å®¶å°±èƒ½åˆ›å»ºå’Œè®­ç»ƒMLæ¨¡å‹ã€‚æˆ‘ä»¬æ‰€éœ€è¦çš„
    â€” æ˜¯ç°ä»£æ•°æ®ä»“åº“ã€è‰¯å¥½çš„SQLçŸ¥è¯†ä»¥åŠå¯¹ç”¨æˆ·ä¿ç•™é€»è¾‘çš„è‰¯å¥½ç†è§£ã€‚ç°ä»£æ•°æ®ä»“åº“å·²å‘å±•åˆ°å¯ä»¥æä¾›æ‰€æœ‰å·²çŸ¥MLæ¨¡å‹çš„çŠ¶æ€ï¼Œå®ƒä»¬å·²ç»å‡†å¤‡å¥½ä½¿ç”¨æ ‡å‡†SQLæ–¹è¨€è¿›è¡Œåˆ›å»ºã€‚é€šè¿‡é¢„æµ‹çš„ä¿ç•™æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå’Œç¼–è¾‘å—ä¼—ã€‚åˆ©ç”¨ç°ä»£æ•°æ®ä»“åº“ä¸­çš„MLåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘è¯†åˆ«å‡ºçš„ç”¨æˆ·æä¾›ç›¸å…³ä¿¡æ¯ã€æœ‰ç”¨çš„ä¼˜æƒ å’Œä¿ƒé”€æ¥é‡èº«å®šåˆ¶ç”¨æˆ·ä½“éªŒã€‚ç°ä»£æ•°æ®ä»“åº“è§£å†³æ–¹æ¡ˆä½¿æœºå™¨å­¦ä¹ æ“ä½œå’Œæ¨¡å‹è®­ç»ƒæ°‘ä¸»åŒ–ã€‚è¿™å¯¹äºæ•°æ®å·¥ç¨‹å¸ˆæ¥è¯´æ˜¯ä¸€ä¸ªæå…¶æœ‰ç”¨çš„ç‰¹æ€§ï¼Œå› ä¸ºæ‰€æœ‰è¿™äº›è¿‡ç¨‹å¯ä»¥å¾ˆå®¹æ˜“åœ°è‡ªåŠ¨åŒ–ã€è®¡åˆ’å’Œè§¦å‘ï¼Œå…·ä½“å–å†³äºä½¿ç”¨æ¡ˆä¾‹åœºæ™¯ã€‚
- en: Recommended read
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ¨èé˜…è¯»
- en: '[1] [https://towardsdatascience.com/modern-data-warehousing-2b1b0486ce4a](/modern-data-warehousing-2b1b0486ce4a)'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '[1] [https://towardsdatascience.com/modern-data-warehousing-2b1b0486ce4a](/modern-data-warehousing-2b1b0486ce4a)'
- en: '[2] [https://towardsdatascience.com/data-platform-architecture-types-f255ac6e0b7](/data-platform-architecture-types-f255ac6e0b7)'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '[2] [https://towardsdatascience.com/data-platform-architecture-types-f255ac6e0b7](/data-platform-architecture-types-f255ac6e0b7)'
- en: '[3] [https://towardsdatascience.com/how-to-become-a-data-engineer-c0319cb226c2](/how-to-become-a-data-engineer-c0319cb226c2)'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '[3] [https://towardsdatascience.com/how-to-become-a-data-engineer-c0319cb226c2](/how-to-become-a-data-engineer-c0319cb226c2)'
- en: '[4] [https://towardsdatascience.com/retention-and-daily-active-users-explained-79c5dab1bf84](/retention-and-daily-active-users-explained-79c5dab1bf84)'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '[4] [https://towardsdatascience.com/retention-and-daily-active-users-explained-79c5dab1bf84](/retention-and-daily-active-users-explained-79c5dab1bf84)'
- en: '[5] [https://console.cloud.google.com/bigquery?p=firebase-public-project&d=analytics_153293282&t=events_20181003&page=table&_ga=2.124992394.-1293267939.1657258995](https://console.cloud.google.com/bigquery?p=firebase-public-project&d=analytics_153293282&t=events_20181003&page=table&_ga=2.124992394.-1293267939.1657258995)'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '[5] [https://console.cloud.google.com/bigquery?p=firebase-public-project&d=analytics_153293282&t=events_20181003&page=table&_ga=2.124992394.-1293267939.1657258995](https://console.cloud.google.com/bigquery?p=firebase-public-project&d=analytics_153293282&t=events_20181003&page=table&_ga=2.124992394.-1293267939.1657258995)'
- en: '[6] [https://towardsdatascience.com/exploratory-data-analysis-with-bigquery-sql-easy-69895ac4eb9e](/exploratory-data-analysis-with-bigquery-sql-easy-69895ac4eb9e)'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '[6] [https://towardsdatascience.com/exploratory-data-analysis-with-bigquery-sql-easy-69895ac4eb9e](/exploratory-data-analysis-with-bigquery-sql-easy-69895ac4eb9e)'
- en: '[7] [https://cloud.google.com/bigquery-ml/docs/introduction](https://cloud.google.com/bigquery-ml/docs/introduction)'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '[7] [https://cloud.google.com/bigquery-ml/docs/introduction](https://cloud.google.com/bigquery-ml/docs/introduction)'
