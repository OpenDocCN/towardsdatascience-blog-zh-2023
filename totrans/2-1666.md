# Python 依赖管理：你应该选择哪个工具？

> 原文：[https://towardsdatascience.com/poetry-a-better-way-to-manage-python-dependencies-bd7b5f1eab25](https://towardsdatascience.com/poetry-a-better-way-to-manage-python-dependencies-bd7b5f1eab25)

## Poetry、Pip 和 Conda 的深入比较

[](https://khuyentran1476.medium.com/?source=post_page-----bd7b5f1eab25--------------------------------)[![Khuyen Tran](../Images/98aa66025ad29b618e875c75f1c400a5.png)](https://khuyentran1476.medium.com/?source=post_page-----bd7b5f1eab25--------------------------------)[](https://towardsdatascience.com/?source=post_page-----bd7b5f1eab25--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----bd7b5f1eab25--------------------------------) [Khuyen Tran](https://khuyentran1476.medium.com/?source=post_page-----bd7b5f1eab25--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----bd7b5f1eab25--------------------------------) ·10 分钟阅读·2023 年 6 月 13 日

--

![](../Images/a87494b4a6efa276955127728c116a55.png)

作者提供的图片

*最初发表于* [*https://mathdatasimplified.com*](https://mathdatasimplified.com/2023/06/12/poetry-a-better-way-to-manage-python-dependencies/) *于 2023 年 6 月 13 日。*

# 动机

随着数据科学项目的扩展，依赖项的数量也会增加。为了保持项目环境的可重现性和可维护性，使用高效的依赖管理工具非常重要。

因此，我决定比较三种流行的依赖管理工具：Pip、Conda 和 Poetry。经过仔细评估，我相信 Poetry 在有效性和性能方面超越了其他两个选项。

在本文中，我们将深入探讨 Poetry 的优势，并突出其与 Pip 和 Conda 的主要区别。

# 可用的包

拥有广泛的包选择使开发人员更容易找到最适合其需求的特定包和版本。

## Conda

一些包，例如 “snscrape”，无法通过 conda 安装。此外，某些版本，例如 Pandas 2.0，可能无法通过 Conda 安装。

虽然你可以在 conda 虚拟环境中使用 pip 解决包的限制，但 conda 无法跟踪用 pip 安装的依赖项，这使得依赖管理变得具有挑战性。

[PRE0]

## Pip

Pip 可以从 Python 包索引（PyPI）和其他仓库中安装任何包。

## Poetry

Poetry 还允许从 Python 包索引（PyPI）和其他仓库中安装包。

# 依赖项数量

减少环境中的依赖项数量简化了开发过程。

## Conda

Conda 提供了完整的环境隔离，管理 Python 包和系统级别的依赖项。这可能导致与其他包管理器相比，包的大小更大，在安装和分发过程中可能会消耗更多的存储空间。

[PRE1]

## Pip

Pip 只安装包所需的依赖项。

[PRE2]

## Poetry

Poetry 也只安装包所需的依赖项。

[PRE3]

# 卸载包

卸载包及其依赖项可以释放磁盘空间，防止不必要的杂乱，并优化存储资源的使用。

## Pip

Pip 仅移除指定的包，而不是它的依赖项，这可能导致随着时间的推移积累未使用的依赖项。这可能导致存储空间使用增加以及潜在的冲突。

[PRE4]

## Conda

Conda 移除包及其依赖项。

[PRE5]

## Poetry

Poetry 也会移除包及其依赖项。

[PRE6]

# 依赖文件

依赖文件通过指定所需包的确切版本或版本范围，确保软件项目环境的可重现性。

这有助于在不同系统或不同时间点重新创建相同的环境，确保开发者之间使用相同的依赖项进行协作。

## Conda

要在 Conda 环境中保存依赖项，你需要手动将它们写入文件。`environment.yml` 文件中指定的版本范围可能会导致安装不同的版本，可能在重现环境时引入兼容性问题。

假设我们已经安装了 pandas 版本 1.5.3 作为示例。这里是一个示例 `environment.yml` 文件，指定了依赖项：

[PRE7]

如果新用户尝试在 pandas 的最新版本为 2.0 时重现环境，则会安装 pandas 2.0。

[PRE8]

如果代码库依赖于 pandas 版本 1.5.3 特有的语法或行为，而在版本 2.0 中语法发生了变化，那么使用 pandas 2.0 运行代码可能会引入错误。

## Pip

相同的问题也可能发生在 pip 上。

[PRE9]

[PRE10]

你可以通过在 `requirements.txt` 文件中冻结版本来固定版本：

[PRE11]

[PRE12]

然而，这使得代码环境的灵活性降低，并且在长期维护中可能变得更加困难。任何对依赖项的更改都需要手动修改 `requirements.txt` 文件，这可能既耗时又容易出错。

## Poetry

Poetry 在安装包时会自动更新 `pyproject.toml` 文件。

在以下示例中，“pandas” 包被添加了版本约束 `^1.5`。这种灵活的版本管理方法确保了你的项目可以适应更新的版本而无需手动调整。

[PRE13]

[PRE14]

`poetry.lock` 文件存储了每个包及其依赖项的精确版本号。

[PRE15]

这确保了安装的包的一致性，即使包的 `pyproject.toml` 文件中指定了版本范围。在这里，我们可以看到安装了 pandas 1.5.3 而不是 pandas 2.0

[PRE16]

# 开发和生产的独立依赖项

通过分离依赖项，你可以清楚地区分开发用途所需的包（例如测试框架和代码质量工具）与生产环境所需的包（通常包括核心依赖项）。

## Conda

Conda 本身不支持为不同环境分别设置依赖项，但可以通过创建两个环境文件来解决这个问题：一个用于开发环境，另一个用于生产环境。开发文件包含生产和开发依赖项。

[PRE17]

[PRE18]

## Pip

Pip 也不直接支持分开的依赖项，但可以使用类似的方法通过分开的需求文件来实现。

[PRE19]

[PRE20]

[PRE21]

## Poetry

Poetry 通过支持一个文件中的分组来简化依赖项管理。这使你可以在一个地方跟踪所有依赖项。

[PRE22]

[PRE23]

要仅安装生产依赖项：

[PRE24]

要安装开发和生产依赖项：

[PRE25]

# 更新环境

更新依赖项对于从 bug 修复、性能改进和新包版本中引入的新功能中受益是至关重要的。

## Conda

Conda 允许你只更新指定的包。

[PRE26]

[PRE27]

之后，你需要手动更新 environment.yaml 文件，以保持与更新的依赖项同步。

[PRE28]

## Pip

Pip 也只允许你更新指定的包，并要求你手动更新 requirements.txt 文件。

[PRE29]

[PRE30]

## Poetry

使用 Poetry，你可以使用 `update` 命令来升级 pyproject.toml 文件中指定的所有包。此操作会自动更新 poetry.lock 文件，确保包规范和锁定文件之间的一致性。

[PRE31]

# 依赖解析

依赖冲突发生在项目所需的包或库具有冲突的版本或不兼容的依赖项时。正确解决冲突对于避免错误、运行时问题或项目失败至关重要。

## Pip

pip 顺序地安装包，这意味着它会按照指定的顺序逐个安装每个包。这种顺序方式有时会导致当包具有不兼容的依赖项或版本要求时发生冲突。

例如，假设你首先安装 `pandas==2.0.2`，它需要 `numpy>=1.20.3`。后来，你使用 pip 安装 `numpy==1.20.2`。尽管这会导致依赖冲突，但 pip 会继续更新 numpy 的版本。

[PRE32]

## Conda

Conda 使用 SAT 求解器来探索所有包版本和依赖项的组合，以找到兼容的集合。

例如，如果一个现有包对其依赖项有特定的约束（例如，statsmodels==0.13.2 需要 numpy>=1.21.2,<2.0a0），而你要安装的包不符合该要求（例如，numpy<1.21.2），conda 不会立即引发错误。相反，它会仔细搜索所有所需包及其依赖项的兼容版本，只有在找不到合适的解决方案时才报告错误。

[PRE33]

尽管这种方法提高了找到解决方案的机会，但在处理广泛环境时可能会计算密集。

## 诗歌

通过专注于项目的直接依赖，Poetry 的确定性解析器缩小了搜索范围，使得解析过程更为高效。它评估指定的约束条件，如版本范围或特定版本，并立即识别任何冲突。

[PRE34]

这种即时反馈有助于防止潜在问题升级，并允许开发者在开发过程早期解决问题。例如，在以下代码中，我们可以放宽对 seaborn 的要求，以便安装特定版本的 matplotlib：

[PRE35]

# 结论

总结而言，Poetry 相比 pip 和 conda 提供了几个优势：

1.  **广泛的软件包选择：** Poetry 提供对 PyPI 上广泛软件包的访问，允许你利用多样的生态系统来支持你的项目。

1.  **高效的依赖管理：** Poetry 只安装指定软件包所需的必要依赖，减少了环境中多余的软件包数量。

1.  **简化的软件包移除：** Poetry 简化了软件包及其相关依赖的移除，使得维护一个干净高效的项目环境变得更加容易。

1.  **依赖解决：** Poetry 的确定性解析器高效地解决依赖关系，及时识别和处理任何不一致或冲突。

虽然 Poetry 可能需要一些额外的时间和精力来让你的团队成员学习和适应，但长期来看，使用像 Poetry 这样的工具可以节省时间和精力。

我喜欢写关于数据科学概念的文章，并玩弄各种数据科学工具。你可以通过以下方式跟进我的最新帖子：

+   订阅我在[Data Science Simplified](https://mathdatasimplified.com/)上的新闻通讯。

+   在[LinkedIn](https://www.linkedin.com/in/khuyen-tran-1401/)和[Twitter](https://twitter.com/KhuyenTran16)上与我联系。
