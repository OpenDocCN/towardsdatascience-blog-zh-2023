# Loguru: 简单如打印，灵活如日志记录

> 原文：[https://towardsdatascience.com/loguru-simple-as-print-flexible-as-logging-c964467f64aa](https://towardsdatascience.com/loguru-simple-as-print-flexible-as-logging-c964467f64aa)

## 适用于你的数据科学项目的简单日志记录解决方案

[](https://khuyentran1476.medium.com/?source=post_page-----c964467f64aa--------------------------------)[![Khuyen Tran](../Images/98aa66025ad29b618e875c75f1c400a5.png)](https://khuyentran1476.medium.com/?source=post_page-----c964467f64aa--------------------------------)[](https://towardsdatascience.com/?source=post_page-----c964467f64aa--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----c964467f64aa--------------------------------) [Khuyen Tran](https://khuyentran1476.medium.com/?source=post_page-----c964467f64aa--------------------------------)

·发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----c964467f64aa--------------------------------) ·阅读时间 8 分钟·2023年7月17日

--

![](../Images/3829b994881a3b1be639cbae3c28152d.png)

作者提供的图像

*最初发布于* [*https://mathdatasimplified.com*](https://mathdatasimplified.com/2023/07/17/simplify-your-python-logging-with-loguru/) *2023年7月17日。*

# 为什么在数据科学项目中使用日志记录？

数据科学家通常使用打印函数来调试代码。然而，随着打印语句数量的增加，由于缺乏行号或函数名称，难以确定输出来自哪里。

[PRE0]

输出：

[PRE1]

当将代码投入生产时，手动检查并删除所有调试行可能是一个乏味且容易出错的任务。

[PRE2]

日志记录通过允许数据科学家为其输出指定不同的级别（调试、信息、警告、错误）提供了完美的解决方案。

[PRE3]

输出：

[PRE4]

通过设置适当的日志级别，数据科学家可以根据需要选择性地启用或禁用某些类型的输出。在生产环境中，他们可以将日志级别设置为“INFO”或更高，以排除调试日志，从而使日志简洁且相关。

[PRE5]

由于日志包含额外的信息，例如时间戳、函数名称和行号，数据科学家可以快速确定日志消息的来源。

数据科学家还可以将日志输出重定向到文件中，以查看以前运行的日志。

[PRE6]

# 为什么许多数据科学家不使用日志记录？

许多数据科学家仍然倾向于使用打印语句而非日志记录，因为打印更简单且不需要过多的设置。对于小脚本和一次性任务，设置日志框架的开销似乎是不必要的。

[PRE7]

如果有一个库可以让你利用日志记录的强大功能，同时使体验像打印一样简单，那该多好。

这时，开源 Python 库 Loguru 就显得很方便了。本文将展示一些 Loguru 的功能，使其成为标准日志库的一个很好的替代选择。

可以在这里随意使用和分叉本文的源代码：

[](https://github.com/khuyentran1401/Data-science/tree/master/productive_tools/logging_tools?source=post_page-----c964467f64aa--------------------------------) [## Data-science/productive_tools/logging_tools at master · khuyentran1401/Data-science

### 有用的数据科学主题集合，包括文章、视频和代码……

github.com](https://github.com/khuyentran1401/Data-science/tree/master/productive_tools/logging_tools?source=post_page-----c964467f64aa--------------------------------)

# 优雅的开箱即用功能

默认情况下，日志库提供的日志很无聊且不太有用：

[PRE8]

输出：

[PRE9]

相比之下，Loguru 默认生成信息丰富且生动的日志。

[PRE10]

![](../Images/54018e60bf25a291e18e51b50a965a91.png)

作者提供的图片

# 格式化日志

格式化日志允许你向日志中添加有用的信息，如时间戳、日志级别、模块名称、函数名称和行号。

传统的日志方法使用 % 格式化，这不直观：

[PRE11]

输出：

[PRE12]

相比之下，Loguru 使用 `{}` 格式化，这更加可读和易于使用：

[PRE13]

# 将日志保存到文件

使用传统的日志模块将日志保存到文件并打印到终端需要两个额外的类 `FileHandler` 和 `StreamHandler`。

[PRE14]

然而，使用 Loguru，你只需 `add` 方法即可实现相同的功能。

[PRE15]

# 轮转日志

日志轮转通过定期创建新的日志文件并归档或删除旧日志文件，防止日志文件大小过大。

在日志库中，轮转日志需要一个额外的类 `TimedRotatingFileHandler`。以下代码每周切换到一个新的日志文件（`when="WO", interval=1`），并保留最多 4 周的日志文件（`backupCount=4`）。

[PRE16]

在 Loguru 中，你可以通过将 `rotation` 和 `retention` 参数添加到 `add` 方法来复制这种行为。指定这些参数的语法可读且易于使用。

[PRE17]

# 过滤

日志中的过滤功能允许你根据特定标准选择性地控制哪些日志记录应该输出。

在日志库中，过滤日志需要创建一个自定义的日志过滤类。

[PRE18]

在 Loguru 中，你可以简单地使用 lambda 函数来过滤日志。

[PRE19]

# 捕捉异常

传统的异常日志可能含糊不清，调试起来很有挑战：

[PRE20]

[PRE21]

上述显示的异常信息不太有帮助，因为它们没有提供触发异常的 `c` 的值的信息。

Loguru 通过显示整个堆栈跟踪，包括变量值，增强了错误识别：

[PRE22]

![](../Images/00e66ec52d1208b3a60d0c3b4bda08d6.png)

作者提供的图片

Loguru的`catch`装饰器允许你捕获函数中的任何错误。这个装饰器还会识别错误发生的线程。

[PRE23]

![](../Images/df176fcc258471a4f72be579f57daf34.png)

作者提供的图像

# 但我不想在我的Python项目中增加更多依赖。

尽管将Loguru集成到你的项目中需要安装额外的库，但它非常轻量，占用的磁盘空间极少。

此外，它有助于减少样板代码，显著降低使用日志记录的摩擦，并使你的项目在长期维护中更为轻松。

我喜欢撰写有关数据科学概念的文章，并玩弄不同的数据科学工具。你可以通过以下方式随时了解我最新的文章：

+   订阅我的[数据科学简化](https://mathdatasimplified.com/)新闻通讯。

+   在[LinkedIn](https://www.linkedin.com/in/khuyen-tran-1401/)和[Twitter](https://twitter.com/KhuyenTran16)上与我联系。
