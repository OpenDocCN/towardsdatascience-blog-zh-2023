- en: Change Your Focus Over Time in DAX Measures
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/change-your-focus-over-time-in-dax-measures-292ff012643a](https://towardsdatascience.com/change-your-focus-over-time-in-dax-measures-292ff012643a)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '*How to determine if your investment has paid off when you advertise products
    over time*'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@salvatorecagliari?source=post_page-----292ff012643a--------------------------------)[![Salvatore
    Cagliari](../Images/a24b0cefab6e707cfee06cde9e857559.png)](https://medium.com/@salvatorecagliari?source=post_page-----292ff012643a--------------------------------)[](https://towardsdatascience.com/?source=post_page-----292ff012643a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----292ff012643a--------------------------------)
    [Salvatore Cagliari](https://medium.com/@salvatorecagliari?source=post_page-----292ff012643a--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----292ff012643a--------------------------------)
    ·7 min read·May 19, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/183d6605f8a88c4d2475b366fc77db29.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [David Travis](https://unsplash.com/@dtravisphd?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: How do you measure the success of an advertising campaign?
  prefs: []
  type: TYPE_NORMAL
- en: Especially when you want to advertise different brands over time?
  prefs: []
  type: TYPE_NORMAL
- en: A similar question was posed to me by one of my clients.
  prefs: []
  type: TYPE_NORMAL
- en: He wants to analyze sales for his brands over time and compare them to those
    for advertised brands to recognize if the investment has paid off.
  prefs: []
  type: TYPE_NORMAL
- en: The challenge was to change the data model to make this analysis possible without
    breaking the existing reports and analysis.
  prefs: []
  type: TYPE_NORMAL
- en: Focus on selected Brands
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The first step was to have a table of the advertised brands over time.
  prefs: []
  type: TYPE_NORMAL
- en: 'Something like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c184a414bb34f2b1425bf078828a4c38.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1 — Table with the focus brands per month (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: In this table, you will find one or more brands for almost every month.
  prefs: []
  type: TYPE_NORMAL
- en: Now I can expand my data model.
  prefs: []
  type: TYPE_NORMAL
- en: 'The starting point in my Contoso data model is the following (extract from
    the entire data model):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/aebb48f6b43e7c177d4637ca8a872431.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 2 — Initial Data model (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, I have a column for the Brand Name but no Brand ID.
  prefs: []
  type: TYPE_NORMAL
- en: In this case, I must create a Relationship through the column [BrandName].
  prefs: []
  type: TYPE_NORMAL
- en: Integrating the Focus Brands table
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'After adding the Focus Brands table to my Data model, I added the following
    Relationships:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/2dd9e6c74cae563a673d8564fe97e03e.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 3 — New Data model with the new Relationships (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: Instead of bidirectional Filtering between the tables Focus Brands and Products,
    I set the Filtering “Focus Brand” filter “Product”. But bidirectional filtering
    works as well, but it introduces one unneeded filter direction. We need to set
    the correct filter direction as we want to drill down the results with Attributes
    from the Product table.
  prefs: []
  type: TYPE_NORMAL
- en: As we have multiple Products within the table Product, with the same name, we
    must have a Many-to-Many (m:n) relationship to the Product table.
  prefs: []
  type: TYPE_NORMAL
- en: Another way to create a data model in this scenario is to add a Brands table
    containing one row for each Brand and create 1:n relationships from both tables
    to this new table.
  prefs: []
  type: TYPE_NORMAL
- en: For the sake of simplicity, I refrain from going this extra step here, and I
    stick with the m:n relationship. There are better solutions than this, as described
    in the SQLBI article referenced in the References section below.
  prefs: []
  type: TYPE_NORMAL
- en: The same applies to the relationship between the Focus Brands table and the
    Date table based on the MonthKey column.
  prefs: []
  type: TYPE_NORMAL
- en: But both Relationships must be Disabled to avoid ambiguity in the data model.
  prefs: []
  type: TYPE_NORMAL
- en: The critical relationship is between the Focus Brands and the Online Sales tables.
  prefs: []
  type: TYPE_NORMAL
- en: My first approach was without the relationship to the Online Sales table. But
    I had to use cross-filtering between the tables to calculate the results correctly.
  prefs: []
  type: TYPE_NORMAL
- en: 'This approach brought some issues:'
  prefs: []
  type: TYPE_NORMAL
- en: Inability to calculate the part of sales for advertised and non-advertised products.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Inability to calculate time series correctly.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Most importantly, the report didn’t work for all Users.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The last point was crucial. I used the [CROSSFILTER()](https://dax.guide/crossfilter/)
    function in my Measures.
  prefs: []
  type: TYPE_NORMAL
- en: As you can read in the [Remarks of the Microsoft documentation](https://learn.microsoft.com/en-us/dax/crossfilter-function?WT.mc_id=DP-MVP-4025372#remarks),
    CROSSFILTER() is not supported when Row-Level-Security is implemented in a data
    model, which my client had.
  prefs: []
  type: TYPE_NORMAL
- en: To implement the Relationship between the Focus Brands and the Online Sales
    tables, I had to add one new column in each table to map each Brand to each Month.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the Focus Brands table, I added this column with the following expression:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d4b1f299db9183679a6172f396dc8078.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 4 — Focus Brands table with the Brand per Month column (Figure by the
    Author)
  prefs: []
  type: TYPE_NORMAL
- en: 'On the Online Sales table, I used this expression to add the corresponding
    column:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Now, I was able to add the new Relationship.
  prefs: []
  type: TYPE_NORMAL
- en: Create the Measure and check the Results
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The Measure to calculate the Results is the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'After adding a Visual with the [Sum Online Sales] and the new [Online Sales
    for Focus Brands] Measures, the result looks like this for March 2019:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/06209076b15940a29809f868e636af3c.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 5 — Check the result for the Focus Brands Measure (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, the results for both Measures are the same for each Focus Brand
    in March 2019 (marked in blue).
  prefs: []
  type: TYPE_NORMAL
- en: The new Measure is calculating the correct results for the Focus Brands.
  prefs: []
  type: TYPE_NORMAL
- en: But now, we must use the Brand Name column from the Focus Brands columns to
    get these results.
  prefs: []
  type: TYPE_NORMAL
- en: But the biggest issue is that I get a blank row for all Sales without a corresponding
    Focus Brand.
  prefs: []
  type: TYPE_NORMAL
- en: 'This is more apparent when using only the new Measure in a column visual:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8a865b5637805a532ddd9da13b91d1fb.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6 — Focus Sales per month with Blank (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: I can add a Filter to the Visual to exclude all rows with [BrandName] = Blank,
    but I would like to avoid this, as all users of the data model need to do it instead
    of solving this issue once with a good data model.
  prefs: []
  type: TYPE_NORMAL
- en: The target is to have the column Brand Name available for reporting only once
    without disrupting all other existing visuals or reports already in place using
    the Product table.
  prefs: []
  type: TYPE_NORMAL
- en: Improve the data model
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To achieve this, I must ensure that the Filter context flows correctly when
    calculating the Sales for the Focus Brands.
  prefs: []
  type: TYPE_NORMAL
- en: 'Look at the following picture for the needed flow:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/63006685923e1a0a303b73ea8cc4f95e.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7 — The needed Filter flow directions (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: In this case I must set bidirectional filtering between the tables Focus Brands
    and Product.
  prefs: []
  type: TYPE_NORMAL
- en: Then I must change my Measure to enforce the flow of the Filter context from
    the Product table through the Focus Brands table.
  prefs: []
  type: TYPE_NORMAL
- en: 'For this, I adapted the Measure to include a CROSSFILTER():'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: With this, we have the issue that this Measure will not work for all users to
    which an RLS Rule is applied.
  prefs: []
  type: TYPE_NORMAL
- en: Without this restriction, this Measure will work while using it with the Brand
    Name column from the Product table.
  prefs: []
  type: TYPE_NORMAL
- en: I tried other approaches to solve this issue, but whatever I did, it would either
    not work as needed or disrupt existing reports.
  prefs: []
  type: TYPE_NORMAL
- en: 'I even added a Brands table and intentionally set the relationship between
    the Brands and Focus Brands table to Many-to-Many. Still, it didn’t solve the
    need for the CROSSFILTER() function:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b2d5ad35adf6540a7646553c675260ea.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 8 — Data model with Brands table (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: I set the relationship between the Focus Brands and the Brands table to Many-to-Many
    because the relationship turns to a restricted one, which avoids the creation
    of a <Blank> row in the Result.
  prefs: []
  type: TYPE_NORMAL
- en: But it continued to work only with the CROSSFILTER() function in the Measure.
  prefs: []
  type: TYPE_NORMAL
- en: And the Drill Down still doesn’t work.
  prefs: []
  type: TYPE_NORMAL
- en: At the moment I don’t have a solution to this problem.
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Initially, I thought the requirement would be relatively easy to solve.
  prefs: []
  type: TYPE_NORMAL
- en: It turned out to be a perfect example to explain how a good data model can solve
    problems and how to manipulate relationships to achieve a goal.
  prefs: []
  type: TYPE_NORMAL
- en: Even so, I couldn’t remove the need for the additional filter.
  prefs: []
  type: TYPE_NORMAL
- en: Sometimes we must accept that the requirements collide and need a workaround
    to achieve our goals.
  prefs: []
  type: TYPE_NORMAL
- en: Based on the solution shown above, I can now create measures to calculate the
    success of an advertising campaign or how the sales of Focus Brands are related
    to all other brands.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6f72918646c3269ee01f0c91e17fe1a8.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Kai Dahms](https://unsplash.com/@dilucidus?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Read this Article from SQLBI about the possible solutions when working with
    m:n Relationships:'
  prefs: []
  type: TYPE_NORMAL
- en: '[Different options to model many-to-many relationships in Power BI and Tabular
    — SQLBI](https://www.sqlbi.com/articles/different-options-to-model-many-to-many-relationships-in-power-bi-and-tabular/)'
  prefs: []
  type: TYPE_NORMAL
- en: I use the Contoso sample dataset, like in my previous articles. You can download
    the ContosoRetailDW Dataset for free from Microsoft [here](https://www.microsoft.com/en-us/download/details.aspx?id=18279).
  prefs: []
  type: TYPE_NORMAL
- en: The table Focus Brands was generated from this dataset with a semi-random process.
  prefs: []
  type: TYPE_NORMAL
- en: The Contoso Data can be freely used under the MIT License, as described [here](https://github.com/microsoft/Power-BI-Embedded-Contoso-Sales-Demo).
  prefs: []
  type: TYPE_NORMAL
- en: I enlarged the dataset to make the DAX engine work harder.
  prefs: []
  type: TYPE_NORMAL
- en: The Online Sales table contains 71 million rows (instead of 12.6 million rows),
    and the Retail Sales table contains 18.5 million rows (instead of 3.4 million
    rows).
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/@salvatorecagliari/membership?source=post_page-----292ff012643a--------------------------------)
    [## Join Medium with my referral link - Salvatore Cagliari'
  prefs: []
  type: TYPE_NORMAL
- en: Read every story from Salvatore Cagliari (and thousands of other writers on
    Medium). Your membership fee directly…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: medium.com](https://medium.com/@salvatorecagliari/membership?source=post_page-----292ff012643a--------------------------------)
  prefs: []
  type: TYPE_NORMAL
