# 荷兰的电动汽车：使用 Python 进行探索性数据分析

> 原文：[https://towardsdatascience.com/electric-cars-in-the-netherlands-exploratory-data-analysis-with-python-d01477949984](https://towardsdatascience.com/electric-cars-in-the-netherlands-exploratory-data-analysis-with-python-d01477949984)

## 使用 Python、Pandas 和 Bokeh 进行数据分析和可视化

[](https://dmitryelj.medium.com/?source=post_page-----d01477949984--------------------------------)[![Dmitrii Eliuseev](../Images/7c48f0c016930ead59ddb785eaf3e0e6.png)](https://dmitryelj.medium.com/?source=post_page-----d01477949984--------------------------------)[](https://towardsdatascience.com/?source=post_page-----d01477949984--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----d01477949984--------------------------------) [Dmitrii Eliuseev](https://dmitryelj.medium.com/?source=post_page-----d01477949984--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----d01477949984--------------------------------) ·16 min 阅读·2023年2月10日

--

![](../Images/d82a9da311e424b14898ce93dffcbc64.png)

Smart EQ Car，图片来源 [https://en.wikipedia.org/wiki/Smart_electric_drive](https://en.wikipedia.org/wiki/Smart_electric_drive)

第一个电动汽车是什么时候注册的？（剧透：比大多数人想象的要早得多。）电动 Porsche 还是 Jaguar 更贵？探索性数据分析（EDA）不仅是建立每个数据管道的重要部分，而且还是一个相当有趣的过程。在本文中，我将使用荷兰 RDW（荷兰车辆管理局）公共数据集来查找有关电动汽车的信息。我们将看看哪些数据可以使用 Python、Pandas 和 Bokeh 提取和展示。

让我们开始吧。

# 加载数据

**RDW**（“Rijks Dienst Wegverkeer”，[https://www.rdw.nl](https://www.rdw.nl/)）是一个荷兰机构，负责处理荷兰的机动车和驾驶执照的审批与登记。作为一个公共政府机构，它的数据对所有人开放。对我们最感兴趣的是“Gekentekende voertuigen”（“带有车牌的车辆”）数据集。它可以在 [opendata.rdw.nl](https://opendata.rdw.nl/Voertuigen/Open-Data-RDW-Gekentekende_voertuigen/m9d7-ebf2) 上免费下载，使用公共领域许可证。文件大小约为 10 GB，包含自 1952 年以来在荷兰注册的所有车辆的信息。处理这样大小的文件也可能是一个挑战——这使得任务更加有趣。

我将使用Jupyter Lab，这种方法比使用标准IDE更方便，因为每次启动项目时重新加载10 GB的文件似乎不是一个好主意。同时，我将使用Pandas进行处理，并使用Bokeh进行可视化。首先，让我们导入所需的库：

[PRE0]

现在我们准备加载数据集。我们先尝试一种“天真”的方法：

[PRE1]

运行此代码后，PC冻结了大约30秒……而且Python内核崩溃了。哎呀。它不仅加载缓慢，而且内存也不够。至少在我的电脑上，32 GB的RAM对于这个任务是不够的。

如果我们无法将文件加载到内存中，可以逐行读取；这种方法从IBM主机和磁带驱动器时代就已经存在。让我们读取文件的前几行，看看里面有什么：

[PRE2]

结果如下：

[PRE3]

正如我们所看到的，有许多不同的数据字段，而我们实际上不需要所有这些字段。关于每辆车，我只想了解其类型、车牌、型号、价格和注册日期。这个数据库已经足够旧了，没有字段表示汽车是否为电动汽车。但至少，有一个字段包含“Number of cylinders”，这可以帮助我们排除*不是*电动汽车的车辆。

现在我们只有7个字段需要加载，在Pandas中，我们可以指定列列表，这会大幅减少数据大小。第二个技巧是将*pd.UInt32Dtype*指定给“Number of cylinders”和“Price”字段。我还想只查看“个人”汽车（荷兰语中的“Personenauto”），而不是卡车或公共汽车：

[PRE4]

现在文件已正确加载，正如“info”方法所示，内存使用量为2.5 GB：

![](../Images/67d628476b608891455bba6d326c4963.png)

Dataset information, Image by author

由于文件大小较大，数据加载仍然需要较长时间。最简单的方法是将筛选后的数据集保存为新文件，并使用该文件进行进一步的实验：

[PRE5]

这个文件只有580 KB大小，比原始的10 GB小得多，并且加载时没有造成任何问题。

我们也不再需要“Voertuigsoort”字段，删除这一列将释放一些RAM和屏幕空间。最后一步，让我们将数据字段从荷兰语翻译成英语——这对分析不是强制性的，但对读者会更方便：

[PRE6]

现在我们准备好了。

# 基本分析

开始时，让我们看看数据集的**主要属性**，例如数据样本和维度：

[PRE7]

*display(df)*方法向我们显示数据集的第一行和最后一行，这样我们可以看到数据的样子。第二行显示了记录的总数，这对计算可能有用，最后的请求将返回每列的空值数量。

输出如下：

![](../Images/ed213107a3939043eeef62955455d024.png)

Dataframe properties, Image by author

我们有9,487,265条记录，每辆车都有车牌、型号和登记日期（这些字段可能是注册的必填项），但其他字段，如“贸易名称”或“目录价格”，在一些汽车中缺失。从技术上讲，我们现在不需要任何清理，但对于某些请求（如价格分布），在进行请求之前我们应该去除 Null 值。

作为这种方法的示例，让我们**排序数据**，以查看荷兰最贵和最便宜的汽车：

[PRE8]

![](../Images/b413f0fb6bead23efc77722a3d516de5.png)

按价格排序的数据框，作者图片

结果很有趣。第一名是“PEUGEOT 5008”，价格为9,700,305欧元，这很奇怪，因为在Google上它的价格大约是41,000欧元——可能是数据库中的错误，或者车主为升级花了很多钱 ;) 或者这可能是全新的电动“PEUGEOT E-5008”，但它计划在2024年才发布。不管怎样，已经可以看出公共数据并不总是一致的。第二名的“PORSCHE CAYENNE”的价格可能是实际的。对于其他车型，很难判断，我不是豪华车专家，如果有人知道更多，请在下面的评论中写出来。至于最便宜的汽车，它们的价格为1欧元。可能它们作为“零件”从二手市场进口到荷兰，因此车主申报了最低可能的价值。

# 数据转换

让我们检查一下数据是否适合进一步分析。列表中的第一个汽车型号是“PEUGEOT”，让我们显示所有具有相同名称的汽车。“unique”方法将仅返回列中的**唯一值**：

[PRE9]

输出如下：

![](../Images/ef4975cd27d2afd47e031ad164033fc5.png)

“Peugeot”型号请求，作者图片

我们可以看到数据库中的模型名称不一致。一些汽车的名称为“PEUGEOT”，其他汽车则被保存为“PEUGEOT BOXER”或“PEUGEOT/MOBILCAR”。为了按模型名称分组汽车，首个单词“PEUGEOT”就足够了，名称的右侧部分可以去掉。将所有字符转换为大写字母也更好，因为理论上汽车型号可以写作“PEUGEOT”或“Peugeot”。为了确保没有多余的字符，我会调用“strip”方法，该方法可以去除字符串中的多余空格。我创建了一个名为“name_normalize”的方法，它执行这种类型的转换：

[PRE10]

可以使用正则表达式进行更灵活的转换，但这段代码对于我们的任务来说已经足够了。当我们有了这个方法后，我们可以使用“map”函数转换 Pandas 数据框中的所有行：

[PRE11]

现在让我们处理“贸易名称”字段：

![](../Images/85f03d9ec6cf9736145f103db59e69fb.png)

“贸易名称”样本，作者图片

如我们所见，大多数汽车在第一个字段中有制造商名称，在第二个字段中有商品名称，如截图中的“VOLVO” + “C30”。但一些其他汽车在两个字段中都有重复的制造商名称，如“NISSAN” + “NISSAN MURANO”。通过删除重复项使其更一致，并且作为奖励，这也会使数据集稍微变小：

[PRE12]

这里的*isinstance*检查很重要，因为“商品名称”字段是可选的，一些记录中有None而不是字符串，获取*len(None)*显然会导致方法崩溃。

要更新数据框，我们可以使用Pandas中的“apply”方法：

[PRE13]

让我们检查一下结果。拥有这些数据后，我们可以提取一些有用的信息，例如，看看**荷兰最受欢迎的前50款汽车**：

[PRE14]

*np.unique*方法可以计算每个模型的数量，我们不需要手动进行。这里第二个棘手的部分是同时对两个数组（汽车数量和汽车模型）进行排序，我们使用*counts.argsort*方法获得排序索引序列，然后将相同的索引应用于“models”数组。

[Bokeh](https://bokeh.org)库非常适合绘制这样的图表：

![](../Images/1456f23cf75ba10e66368f10204ad2f3.png)

顶级汽车模型条形图，作者提供的图像

数据转换的下一部分更棘手——我们需要确定汽车是否电动。这很棘手，因为每个制造商都有自己命名系统，并且没有通用规则。对于一些品牌，如“TESLA”，这很简单——所有特斯拉汽车都是电动的。对于其他型号，如“HYUNDAI IONIQ”或“NISSAN LEAF”，名称中存在特定关键字，而对于其他一些汽车，根本没有明确的规则（“HONDA E”是电动的，但“HONDA EE8”则不是）。

通过Google搜索和汽车制造商的网站，我创建了这个字典：

[PRE15]

现在我可以轻松检查特定关键字是否出现在汽车模型中，或者是否有模型名称的直接匹配。最后检查，我可以使用数据库中拥有的气缸数。如果这个值大于零，那么我们知道这辆车*不是*完全电动的。最终的方法（好吧，也许不是最终的，但对于我们的任务来说或多或少有效）如下所示：

[PRE16]

作为一种单元测试，我们可以使用不同的参数来使用此方法：

[PRE17]

使用这个函数，我们可以轻松地将新字段添加到数据框中，并仅保留电动汽车：

[PRE18]

如果一切都做得正确，我们应该得到这样的结果：

![](../Images/5b4ec7a9c90ed7ac14aafc8e58780a60.png)

电动汽车数据框，作者提供的图像

# 分析

现在我们终于准备好开始分析荷兰的电动汽车了。

作为热身，计算**均值、标准差和百分位数**是很简单的：

[PRE19]

输出结果如下：

![](../Images/7e9c58c96906657695c2a77a91ef711e.png)

均值、标准差和百分位数结果，作者提供的图像

我们可以看到荷兰共有9,487,265辆汽车，其中仅有278,141辆（2.93%）是电动汽车。好吧，到2023年，我们只是这个时代的开始。根据[rvo.nl](https://www.rvo.nl/sites/default/files/2021/12/electric-vehicles-statistics-in-the-netherlands.pdf)的报告，2019年电动汽车占比为1.22%，2020年为1.98%，2021年为2.55%，因此这些数字在增长，未来10-20年比较结果会很有趣。至于非电动汽车的价格，第95百分位数为€71,381。这意味着荷兰95%的汽车价格低于此值。电动汽车则处于更“高端”的区间——平均价格为€49,975，第95百分位数为€106,989。

荷兰第一辆电动汽车是什么时候出现的，这个数量随着时间的推移有何变化？这个问题很容易回答。让我们构建一个**每季度汽车注册数量**的柱状图。为此，我需要在Pandas数据框中创建一个新的*Quarter*字段，并按此字段分组数据。我们可以从Python的“datetime”对象中提取季度号，但Pandas已经有所有需要的转换器：

[PRE20]

结果很有趣：

![](../Images/920a37675132ae37c8c18893aae8ad22.png)

电动汽车注册情况，作者提供的图片

第一辆（在接下来的15年里全国唯一的一辆！）电动汽车于1992年在荷兰注册，距今已有30多年。我们可以轻松地在数据集中找到，它是一辆[Fiat Panda Elettra](https://www.fcaheritage.com/en-uk/heritage/stories/fiat-panda-elettra)，这是一款最高时速70公里、续航100公里的两座小车，电源由12个6V铅酸电池提供。接下来的3辆[Tesla Roadster](https://en.wikipedia.org/wiki/Tesla_Roadster_(first_generation))仅在2009年注册。第二件有趣的事情是季节性模式——很容易看到每年年底的注册数量最大（更详细的图表将在本文末尾展示）。

拥有电动汽车数据框后，我们也很容易看到**价格分布**：

[PRE21]

输出如下：

![](../Images/626ddc7c0292a12fc694f31407289c01.png)

电动汽车价格分布，作者提供的图片

如我们所见，分布大多向右偏斜。在计算直方图之前，我去除了右侧的异常值，否则由于2–3辆价格超过1百万欧元的汽车，图像几乎是空的。

使用直方图我们可以看到，大多数荷兰的电动汽车价格在€40–70K范围内，但我们不知道具体是哪些车型。我们可以更详细地探索价格——让我们**按车型名称分组价格**：

[PRE22]

在这里，我将所有汽车按型号分组，并将数据汇总到一个表中：

![](../Images/e11b14d0b91987e69ef4963721903c18.png)

按车型名称分组的电动汽车，作者提供的图片

让我们以**箱形图**的形式绘制这些数据：

[PRE23]

在这里，我按价格对所有车型进行了排序。结合箱线图，我们可以清楚地看到价格分布的情况：

![](../Images/b76464ac2d30fa7a09cbe01796bea5f1.png)

电动汽车制造商和价格箱线图，图片由作者提供

不足为奇的是，分布顶部的是著名的豪华车，如保时捷、捷豹或Lucid（顺便说一下，我之前从未听说过）。但更令人惊讶的是，这个分布中最便宜的车并不是最受欢迎的。例如，在荷兰只有1,269辆“Smart”和15,414辆“Renault”，相比之下，65,885辆“Tesla”模型不到25%。我甚至怀疑图表中是否有错误，但[2021年英国汽车销售分布](https://cleantechnica.com/2021/10/28/tesla-model-3-20-of-uk-electric-car-sales/)总体上看起来是一样的。

**最大续航** **（公里）**可能是选择电动汽车时一个重要的因素，构建一个显示续航与价格相关性的图表会很有趣。但遗憾的是，RDW数据集中没有“续航”字段。一些不同电动汽车的值可以从[Kaggle数据集](https://www.kaggle.com/datasets/geoffnel/evs-one-electric-vehicle-dataset)中获得。但实际上，两张表之间没有直接匹配。例如，数据集中有一个“E-TRON SPORTBACK 50 QUATTRO”模型。在RDW数据中，有两个类似名称的车型，“E-TRON SPORTBACK 50”和“Q4 SPORTBACK 50 E-TRON”，但我不确定这些车型是否实际上是一样的。每个型号名称中的字母可能都有自己的含义，没有汽车专家的知识，很难匹配所有汽车制造商的所有名称。不过，有兴趣的读者可以自行尝试。

至少，拥有来自RDW数据的汽车价格和注册日期，我们可以构建**散点图：**

[PRE24]

在这里，我将所有汽车按型号名称分组，然后从每个子集随机抽取1:15的样本（显然，我们不能在一个图上绘制所有216316辆车）。Bokeh的一个非常棒的功能是能够通过点击“静音”标签，例如，仅用鼠标点击突出显示Tesla汽车：

![](../Images/14a2b15ed61bda74da3d16ea721001ab.png)

价格和注册日期散点图，图片由作者提供

看到季节性模式相当有趣——看起来汽车注册每年“波动”4次，每年年底会有大量新车注册。也许有些客户特别等待年末促销，或者只是想以新车开始新的一年？第二个有趣的点是，在2019年出现了大量中等价格范围的电动汽车。在此之前，选择仅限于便宜的和高端的车型（当然，相对便宜，因为大多数电动汽车与汽油车相比都属于高端细分市场）。

# 结论

如我们所见，使用来自“现实世界”的数据集带来了一些挑战。这不仅仅是数据规模，还有数据不完整或不一致，甚至数据字段中的语法错误（例如，我看到一个“Tesla Raodster”而不是“Tesla Roadster”），等等。与此同时，探索这些数据并发现其中有趣的模式要有趣得多，我建议读者自己做类似的实验。这项分析是为了娱乐和自我教育目的，显然还有很大的改进空间，例如寻找更好的检测方法以判断汽车是否是电动的，找出不同型号的续航里程，等等。而荷兰政府保持这些数据公开并对所有人开放，这很好。如果有人知道其他国家的数据集，请在下方评论中添加链接，我将尝试做类似的分析并在下一个帖子中比较结果。

如果你喜欢这个故事，可以随时[订阅](https://medium.com/@dmitryelj/membership) Medium，你将获得新文章发布的通知，并可以全面访问其他作者的数千个故事。

感谢阅读。
