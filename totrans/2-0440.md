# ä½¿ç”¨Redshift Serverlesså’ŒKinesisæ„å»ºæµæ•°æ®ç®¡é“

> åŸæ–‡ï¼š[https://towardsdatascience.com/building-a-streaming-data-pipeline-with-redshift-serverless-and-kinesis-04e09d7e85b2](https://towardsdatascience.com/building-a-streaming-data-pipeline-with-redshift-serverless-and-kinesis-04e09d7e85b2)

## é¢å‘åˆå­¦è€…çš„å®Œæ•´æ•™ç¨‹

[](https://mshakhomirov.medium.com/?source=post_page-----04e09d7e85b2--------------------------------)[![ğŸ’¡Mike Shakhomirov](../Images/bc6895c7face3244d488feb97ba0f68e.png)](https://mshakhomirov.medium.com/?source=post_page-----04e09d7e85b2--------------------------------)[](https://towardsdatascience.com/?source=post_page-----04e09d7e85b2--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----04e09d7e85b2--------------------------------) [ğŸ’¡Mike Shakhomirov](https://mshakhomirov.medium.com/?source=post_page-----04e09d7e85b2--------------------------------)

Â·å‘è¡¨äº[Towards Data Science](https://towardsdatascience.com/?source=post_page-----04e09d7e85b2--------------------------------) Â·é˜…è¯»æ—¶é—´9åˆ†é’ŸÂ·2023å¹´10æœˆ6æ—¥

--

![](../Images/d1700c0485714244a17aec09305461e6.png)

å›¾ç‰‡ç”±[Sebastian Pandelache](https://unsplash.com/@pandelache?utm_source=medium&utm_medium=referral)æ‹æ‘„ï¼Œæ¥æºäº[Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºæœ€å—æ¬¢è¿çš„æ•°æ®ç®¡é“è®¾è®¡æ¨¡å¼ä¹‹ä¸€â€”â€”äº‹ä»¶æµã€‚é™¤äº†å…¶ä»–å¥½å¤„ï¼Œå®ƒè¿˜æ”¯æŒè¶…å¿«çš„æ•°æ®åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå®æ—¶æ›´æ–°ç»“æœçš„æŠ¥å‘Šä»ªè¡¨ç›˜ã€‚æˆ‘å°†æ¼”ç¤ºå¦‚ä½•é€šè¿‡æ„å»ºä¸€ä¸ªä½¿ç”¨AWS Kinesiså’ŒRedshiftçš„æµæ•°æ®ç®¡é“æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å‡ æ¬¡ç‚¹å‡»ä½¿ç”¨åŸºç¡€è®¾æ–½å³ä»£ç è¿›è¡Œéƒ¨ç½²ã€‚æˆ‘ä»¬å°†ä½¿ç”¨AWS CloudFormationæ¥æè¿°æˆ‘ä»¬çš„æ•°æ®å¹³å°æ¶æ„å¹¶ç®€åŒ–éƒ¨ç½²è¿‡ç¨‹ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œä½œä¸ºæ•°æ®å·¥ç¨‹å¸ˆï¼Œä½ çš„ä»»åŠ¡æ˜¯åˆ›å»ºä¸€ä¸ªå°†æœåŠ¡å™¨äº‹ä»¶æµä¸æ•°æ®ä»“åº“è§£å†³æ–¹æ¡ˆï¼ˆRedshiftï¼‰è¿æ¥èµ·æ¥çš„æ•°æ®ç®¡é“ï¼Œä»¥ä¾¿è½¬æ¢æ•°æ®å¹¶åˆ›å»ºåˆ†æä»ªè¡¨ç›˜ã€‚

![](../Images/19d9e86d0773049b03bcd3c4ea66b9ab.png)

ç®¡é“åŸºç¡€è®¾æ–½ã€‚å›¾ç‰‡æ¥æºï¼šä½œè€…ã€‚

> ä»€ä¹ˆæ˜¯æ•°æ®ç®¡é“ï¼Ÿ
> 
> å®ƒæ˜¯ä¸€ä¸ªæ•°æ®å¤„ç†æ­¥éª¤çš„åºåˆ—ã€‚ç”±äºè¿™äº›é˜¶æ®µä¹‹é—´çš„***é€»è¾‘æ•°æ®æµè¿æ¥***ï¼Œæ¯ä¸ªé˜¶æ®µç”Ÿæˆä¸€ä¸ª**è¾“å‡º**ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„**è¾“å…¥**ã€‚

æˆ‘ä¹‹å‰åœ¨è¿™ç¯‡æ–‡ç« ä¸­å†™è¿‡ç›¸å…³å†…å®¹ï¼š

[](/data-pipeline-design-patterns-100afa4b93e3?source=post_page-----04e09d7e85b2--------------------------------) [## æ•°æ®ç®¡é“è®¾è®¡æ¨¡å¼

### é€‰æ‹©åˆé€‚çš„æ¶æ„åŠç¤ºä¾‹

towardsdatascience.com](/data-pipeline-design-patterns-100afa4b93e3?source=post_page-----04e09d7e85b2--------------------------------)

ä¾‹å¦‚ï¼Œäº‹ä»¶æ•°æ®å¯ä»¥ç”±åç«¯çš„æºåˆ›å»ºï¼Œä½¿ç”¨ Kinesis Firehose æˆ– Kafka æµæ„å»ºäº‹ä»¶æµã€‚ç„¶åå®ƒå¯ä»¥é¦ˆé€åˆ°å¤šä¸ªä¸åŒçš„æ¶ˆè´¹è€…æˆ–ç›®çš„åœ°ã€‚

æµå¼å¤„ç†æ˜¯ä¼ä¸šæ•°æ®çš„â€œå¿…å¤‡â€è§£å†³æ–¹æ¡ˆï¼Œå› å…¶æµæ•°æ®å¤„ç†èƒ½åŠ›ã€‚å®ƒèƒ½å¤Ÿå®ç°å®æ—¶æ•°æ®åˆ†æã€‚

åœ¨æˆ‘ä»¬çš„ç”¨ä¾‹åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ª**ELT æµå¼**æ•°æ®ç®¡é“åˆ° AWS Redshiftã€‚AWS Firehose æµå¯ä»¥æä¾›è¿™ç§æ— ç¼é›†æˆï¼Œå½“æ•°æ®æµè¢«ç›´æ¥ä¸Šä¼ åˆ°æ•°æ®ä»“åº“è¡¨æ—¶ã€‚ç„¶åï¼Œæ•°æ®å¯ä»¥è¢«è½¬æ¢ä»¥ä½¿ç”¨ AWS Quicksight ä½œä¸º BI å·¥å…·æ¥åˆ›å»ºæŠ¥å‘Šï¼Œä¾‹å¦‚ã€‚

![](../Images/90a8cb4b073924f3113fce5df13ab20c.png)

æ·»åŠ äº† BI ç»„ä»¶ã€‚å›¾ç‰‡æ¥æºäºä½œè€…ã€‚

> æœ¬æ•™ç¨‹å‡è®¾å­¦ä¹ è€…ç†Ÿæ‚‰ AWS CLI å¹¶ä¸”å…·æœ‰åŸºæœ¬çš„ Python çŸ¥è¯†ã€‚

## å·¥ä½œæµç¨‹

1\. é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ AWS CloudFormation åˆ›å»º Kinesis æ•°æ®æµã€‚

2\. æˆ‘ä»¬å°†ä½¿ç”¨ AWS Lambda å‘æ­¤äº‹ä»¶æµå‘é€ç¤ºä¾‹æ•°æ®äº‹ä»¶ã€‚

3\. æœ€åï¼Œæˆ‘ä»¬å°†é…ç½® AWS Redshift é›†ç¾¤å¹¶æµ‹è¯•æˆ‘ä»¬çš„æµå¼ç®¡é“ã€‚

## åˆ›å»º AWS Kinesis æ•°æ®æµ

AWS Kinesis Data Streams æ˜¯ä¸€ä¸ª Amazon Kinesis å®æ—¶æ•°æ®æµè§£å†³æ–¹æ¡ˆã€‚å®ƒæä¾›äº†å‡ºè‰²çš„å¯æ‰©å±•æ€§å’Œè€ç”¨æ€§ï¼Œæ•°æ®æµå¯ä»¥è¢«ä»»ä½•æ¶ˆè´¹è€…è®¿é—®ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CloudFormation æ¨¡æ¿æ¥åˆ›å»ºå®ƒã€‚ä¸‹é¢çš„å‘½ä»¤è¡Œè„šæœ¬å°†è§¦å‘ AWS CLI å‘½ä»¤è¿›è¡Œéƒ¨ç½²ï¼š

[PRE0]

å¹¶ä¸”æ¨¡æ¿ kinesis-data-stream.yaml å°†å¦‚ä¸‹æ‰€ç¤ºï¼š

[PRE1]

éå¸¸ç®€å•ã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æˆ‘ä»¬çš„ Kinesis æµè¢«éƒ¨ç½²ï¼š

![](../Images/0f33f2db4f4b45e501787735db96cb76.png)

æµå·²åˆ›å»ºã€‚å›¾ç‰‡æ¥æºäºä½œè€…ã€‚

## 2\. åˆ›å»º AWS Lambda å‡½æ•°ä»¥æ¨¡æ‹Ÿäº‹ä»¶æµ

ç°åœ¨æˆ‘ä»¬å¸Œæœ›å°†ä¸€äº›äº‹ä»¶å‘é€åˆ°æˆ‘ä»¬çš„ Kinesis æ•°æ®æµã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ AWS Lambdaã€‚æˆ‘ä»¬å°†ä½¿ç”¨`boto3`åº“ï¼ˆAWS çš„ Python SDKï¼‰æ¥æ„å»ºä¸€ä¸ªæ•°æ®è¿æ¥å™¨ä¸ AWS Kinesis è¿›è¡Œæ•°æ®æºè¿æ¥ã€‚

![](../Images/611621ecd4f8ba97807a73dcbfff5e82.png)

æœ¬åœ°è¿è¡Œåº”ç”¨ä»¥æ¨¡æ‹Ÿäº‹ä»¶æµã€‚å›¾ç‰‡æ¥æºäºä½œè€…ã€‚

æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹ç»“æ„å¯ä»¥å¦‚ä¸‹æ‰€ç¤ºï¼š

[PRE2]

æˆ‘ä»¬çš„`app.py`å¿…é¡»èƒ½å¤Ÿå‘ Kinesis æ•°æ®æµå‘é€äº‹ä»¶ï¼š

[PRE3]

æˆ‘ä»¬å¸Œæœ›æ·»åŠ ä¸€ä¸ªå¸®åŠ©å‡½æ•°æ¥ç”Ÿæˆä¸€äº›éšæœºäº‹ä»¶æ•°æ®ã€‚ä¾‹å¦‚ï¼š

[PRE4]

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`python-lambda-local`åº“æœ¬åœ°è¿è¡Œå’Œæµ‹è¯• AWS Lambdaï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š

[PRE5]

`env.json` åªæ˜¯ä¸€ä¸ªäº‹ä»¶è´Ÿè½½ï¼Œç”¨äºæœ¬åœ°è¿è¡Œ Lambdaã€‚

`config/staging.yaml` å¯ä»¥åŒ…å«æˆ‘ä»¬åº”ç”¨ç¨‹åºæœªæ¥å¯èƒ½éœ€è¦çš„ä»»ä½•ç¯å¢ƒç‰¹å®šè®¾ç½®ã€‚ä¾‹å¦‚ï¼š

[PRE6]

å¦‚æœä½ éœ€è¦ä½¿ç”¨`requirements.txt`ï¼Œå®ƒå¯ä»¥å¦‚ä¸‹æ‰€ç¤ºï¼š

[PRE7]

åœ¨ä½ çš„å‘½ä»¤è¡Œä¸­è¿è¡Œè¿™ä¸ªï¼š

[PRE8]

è¿™ç§æ–¹æ³•å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½å¸Œæœ›å°†æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°äº‘ä¸­å¹¶è¿›è¡Œè°ƒåº¦ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CloudFormation æ¨¡æ¿æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æˆ‘ä¹‹å‰åœ¨è¿™é‡Œå†™è¿‡ï¼š

[## Infrastructure as Code for Beginners](https://levelup.gitconnected.com/infrastructure-as-code-for-beginners-a4e36c805316?source=post_page-----04e09d7e85b2--------------------------------)

### ä½¿ç”¨è¿™äº›æ¨¡æ¿åƒä¸“ä¸šäººå£«ä¸€æ ·éƒ¨ç½²æ•°æ®ç®¡é“

[levelup.gitconnected.com](https://levelup.gitconnected.com/infrastructure-as-code-for-beginners-a4e36c805316?source=post_page-----04e09d7e85b2--------------------------------)

å½“æˆ‘ä»¬ä½¿ç”¨ CloudFormation æ¨¡æ¿æ—¶ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ç±»ä¼¼çš„ shell è„šæœ¬è¿›è¡Œéƒ¨ç½²ï¼š

[PRE9]

è¿™æ˜¯ä¸€ä¸ªçµæ´»çš„è®¾ç½®ï¼Œå…è®¸æˆ‘ä»¬åˆ›å»ºå¼ºå¤§çš„ CI/CD ç®¡é“ã€‚æˆ‘è®°å¾—æˆ‘åœ¨ä¸‹é¢çš„å¸–å­ä¸­åˆ›å»ºäº†ä¸€ä¸ªã€‚

[## Continuous Integration and Deployment for Data Platforms

### æ•°æ®å·¥ç¨‹å¸ˆå’Œ ML Ops çš„ CI/CD

[towardsdatascience.com](/continuous-integration-and-deployment-for-data-platforms-817bf1b6bed1?source=post_page-----04e09d7e85b2--------------------------------)

## åˆ›å»º Redshift Serverless èµ„æº

ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„æµæ•°æ®ç®¡é“åˆ›å»º Redshift Serverless é›†ç¾¤ã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æˆ–ä½¿ç”¨ CloudFormation æ¨¡æ¿é…ç½® Redshift Workgroupã€åˆ›å»º Namespace å’Œå…¶ä»–æ‰€éœ€èµ„æºã€‚

Redshift Serverless ä»…ä»…æ˜¯ä¸€ä¸ªæ•°æ®ä»“åº“è§£å†³æ–¹æ¡ˆã€‚å®ƒå¯ä»¥æ‰§è¡Œä»»ä½•è§„æ¨¡çš„åˆ†æå·¥ä½œè´Ÿè½½ï¼Œæ— éœ€æ•°æ®ä»“åº“åŸºç¡€è®¾æ–½ç®¡ç†ã€‚Redshift è¿è¡Œè¿…é€Ÿï¼Œå¹¶èƒ½åœ¨å‡ ç§’é’Ÿå†…ä»å·¨é‡æ•°æ®ä¸­ç”Ÿæˆæ´å¯Ÿã€‚å®ƒä¼šè‡ªåŠ¨æ‰©å±•ï¼Œä¸ºå³ä½¿æ˜¯æœ€è‹›åˆ»çš„åº”ç”¨ç¨‹åºæä¾›å¿«é€Ÿæ€§èƒ½ã€‚

![](../Images/9e11cbe2d920bab18ad3e3c56a7a0a94.png)

ä¾‹å­è§†å›¾æ˜¾ç¤ºäº†æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„äº‹ä»¶ã€‚å›¾åƒæ¥æºäºä½œè€…ã€‚

åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CloudFormation æ¨¡æ¿å®šä¹‰æ¥éƒ¨ç½² Redshift èµ„æºã€‚

[PRE10]

æ‰€ä»¥å¦‚æœæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œè¿™æ®µä»£ç ï¼Œå®ƒå°†éƒ¨ç½²è¿™ä¸ªå †æ ˆï¼š

[PRE11]

é€šå¸¸ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ç§æœ‰å­ç½‘ä¸­éƒ¨ç½²æ•°æ®åº“ã€‚ç„¶è€Œï¼Œåœ¨å¼€å‘çš„æ—©æœŸé˜¶æ®µï¼Œä½ å¯èƒ½å¸Œæœ›ä»å¼€å‘æœºå™¨ç›´æ¥è®¿é—® Redshiftã€‚

> è¿™ä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä½†åœ¨è¿™ç§å¼€å‘æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å…ˆå°† Redshift æ”¾å…¥æˆ‘ä»¬çš„ `default` VPC å­ç½‘ã€‚
> 
> ç°åœ¨ï¼Œå½“æ‰€æœ‰æ‰€éœ€çš„ç®¡é“èµ„æºæˆåŠŸé…ç½®åï¼Œæˆ‘ä»¬å¯ä»¥è¿æ¥æˆ‘ä»¬çš„ Kinesis æµå’Œ Redshift æ•°æ®ä»“åº“ã€‚

ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SQL è¯­å¥åœ¨ Redshift ä¸­åˆ›å»º `kinesis_data` æ¨¡å¼ï¼š

[PRE12]

è¿™æ®µ SQL çš„ç¬¬ä¸€éƒ¨åˆ†å°†è®¾ç½® AWS Kinesis ä½œä¸ºæ•°æ®æºã€‚ç¬¬äºŒéƒ¨åˆ†å°†åˆ›å»ºä¸€ä¸ªåŒ…å«æˆ‘ä»¬åº”ç”¨ç¨‹åºäº‹ä»¶æ•°æ®çš„è§†å›¾ã€‚

ç¡®ä¿åˆ›å»ºä¸€ä¸ªå…·æœ‰ `AmazonRedshiftAllCommandsFullAccess` AWS ç®¡ç†ç­–ç•¥çš„ AWS Redshift è§’è‰²ã€‚

[PRE13]

å°±è¿™æ ·ã€‚ä¸€åˆ‡å‡†å¤‡å¥½è¿è¡Œåº”ç”¨ç¨‹åºä»¥æ¨¡æ‹Ÿäº‹ä»¶æ•°æ®æµã€‚è¿™äº›äº‹ä»¶ä¼šç«‹å³å‡ºç°åœ¨æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ Redshift è§†å›¾ä¸­ï¼š

![](../Images/611621ecd4f8ba97807a73dcbfff5e82.png)

åº”ç”¨ç¨‹åºåœ¨æœ¬åœ°è¿è¡Œã€‚å›¾åƒæ¥æºäºä½œè€…ã€‚

![](../Images/9e11cbe2d920bab18ad3e3c56a7a0a94.png)

ç¤ºä¾‹è§†å›¾æ˜¾ç¤ºäº†æ¥è‡ªæˆ‘ä»¬åº”ç”¨ç¨‹åºçš„äº‹ä»¶ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

# ç»“è®º

æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•è€Œå¯é çš„æµæ•°æ®ç®¡é“ï¼Œä»ä½¿ç”¨ AWS Lambda åˆ›å»ºçš„æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºåˆ° AWS Redshift æ•°æ®ä»“åº“ï¼Œåœ¨é‚£é‡Œæ•°æ®å®æ—¶è½¬åŒ–å’Œæ‘„å–ã€‚å®ƒèƒ½å¤Ÿè½»æ¾æ•è·ã€å¤„ç†å’Œå­˜å‚¨ä»»ä½•è§„æ¨¡çš„æ•°æ®æµã€‚å¯¹äºä»»ä½•æœºå™¨å­¦ä¹ ï¼ˆMLï¼‰ç®¡é“éƒ½éå¸¸é€‚ç”¨ï¼Œå…¶ä¸­æ¨¡å‹ç”¨äºæ£€æŸ¥æ•°æ®å¹¶é¢„æµ‹æ¨ç†ç«¯ç‚¹ï¼Œå› ä¸ºæ•°æ®æµå‘å…¶ç›®æ ‡ã€‚

æˆ‘ä»¬ä½¿ç”¨åŸºç¡€è®¾æ–½å³ä»£ç æ¥éƒ¨ç½²æ•°æ®ç®¡é“èµ„æºã€‚è¿™æ˜¯éƒ¨ç½²ä¸åŒæ•°æ®ç¯å¢ƒä¸­èµ„æºçš„é¦–é€‰æ–¹æ³•ã€‚

# æ¨èé˜…è¯»

[/continuous-integration-and-deployment-for-data-platforms-817bf1b6bed1?source=post_page-----04e09d7e85b2--------------------------------) [## æ•°æ®å¹³å°çš„æŒç»­é›†æˆå’Œéƒ¨ç½²

### æ•°æ®å·¥ç¨‹å¸ˆå’Œ ML è¿ç»´çš„ CI/CD

[Towards Data Science](/continuous-integration-and-deployment-for-data-platforms-817bf1b6bed1?source=post_page-----04e09d7e85b2--------------------------------) [/data-platform-architecture-types-f255ac6e0b7?source=post_page-----04e09d7e85b2--------------------------------) [## æ•°æ®å¹³å°æ¶æ„ç±»å‹

### å®ƒèƒ½å¤šå¤§ç¨‹åº¦ä¸Šæ»¡è¶³ä½ çš„ä¸šåŠ¡éœ€æ±‚ï¼Ÿé€‰æ‹©çš„å›°å¢ƒã€‚

[Towards Data Science](/data-platform-architecture-types-f255ac6e0b7?source=post_page-----04e09d7e85b2--------------------------------) [https://levelup.gitconnected.com/infrastructure-as-code-for-beginners-a4e36c805316?source=post_page-----04e09d7e85b2--------------------------------) [## åˆå­¦è€…çš„åŸºç¡€è®¾æ–½å³ä»£ç 

### ä½¿ç”¨è¿™äº›æ¨¡æ¿åƒä¸“ä¸šäººå£«ä¸€æ ·éƒ¨ç½²æ•°æ®ç®¡é“

[LevelUp](https://levelup.gitconnected.com/infrastructure-as-code-for-beginners-a4e36c805316?source=post_page-----04e09d7e85b2--------------------------------)
