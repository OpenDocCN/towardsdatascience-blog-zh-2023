# 使用Seaborn制作嵌套条形图

> 原文：[https://towardsdatascience.com/make-a-nested-bar-chart-with-seaborn-9a9988e30dca](https://towardsdatascience.com/make-a-nested-bar-chart-with-seaborn-9a9988e30dca)

## 我 快速成功的数据科学

## 大学足球投票的准确性基准测试

[](https://medium.com/@lee_vaughan?source=post_page-----9a9988e30dca--------------------------------)[![Lee Vaughan](../Images/9f6b90bb76102f438ab0b9a4a62ffa3f.png)](https://medium.com/@lee_vaughan?source=post_page-----9a9988e30dca--------------------------------)[](https://towardsdatascience.com/?source=post_page-----9a9988e30dca--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----9a9988e30dca--------------------------------) [Lee Vaughan](https://medium.com/@lee_vaughan?source=post_page-----9a9988e30dca--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----9a9988e30dca--------------------------------) ·阅读时间9分钟·2023年10月19日

--

![](../Images/374d6c5dd302c2d2c0047599a38579a3.png)

嵌套条形图示例（作者提供）

*嵌套条形图*是一种可视化方法，用于比较类别中的多个测量值。其中一个测量值代表次要或*背景*测量，例如*目标*或*之前*的值。主要测量值代表*实际*或*当前*值。

次要测量通常以*减少的容量*呈现，从而为主要测量提供背景。将较宽且较暗的主要条形图放在较窄且较浅的次要条形图上面，能够生成一个美观且紧凑的图表。这也解释了为什么这种图形有时被称为*口红条形图*。

![](../Images/5556ea6fec96d5bba13e831b46480f10.png)

口红图片由Onder Ortel在Unsplash上提供

当然，为了使其正常工作，主要的条形图应该*永远*不要比次要的条形图*更长*。因此，你将需要使用嵌套条形图来绘制每个类别中*递减*值的示例，例如房价下降或由于新疫苗导致的疾病率下降。

在这个*快速成功的数据科学*项目中，我们将查看著名的*美联社大学足球前25名投票*在每个赛季开始时挑选25支最佳美国大学足球队的表现。由于赛季前挑选的球队数量不能超过排名中的最终球队数量，这是一种很好的嵌套条形图应用。

# AP大学足球前25名投票

AP每年8月或9月发布他们的*赛季前*投票，并在整个赛季中每周更新一次。全国范围内超过60位知名体育作家和广播员会为最佳球队投票。

他们首先创建了一个列表，列出了他们认为的25支最佳球队（从133支球队中选出），并给每支球队分配了投票数，给予最佳球队最多25分。然后，AP将这些投票结合起来，按降序对球队进行排名。在碗赛季和大学橄榄球季后赛结束后，它会发布一份*最终*排名。

你可以在AP网站以及[Sports Illustrated](https://www.si.com/)、[NCAA](http://www.ncaa.com)和[Sports Reference](https://www.sports-reference.com/)等体育网站上找到这些投票结果。为了方便起见，我已经将过去20年（2002–2022）的季前赛和最终排名整理成CSV文件，并存储在这个[Gist](https://gist.github.com/rlvaugh/047dc3b39a712fabccd3e509cb94174e)中。

# 代码

以下代码的灵感来自Oscar Leo最近关于口红图的文章：

[](/how-to-create-a-lipstick-chart-with-matplotlib-2fde5412fee9?source=post_page-----9a9988e30dca--------------------------------) [## 如何使用Matplotlib创建口红图

### 一种数据可视化，当数值越低越好

towardsdatascience.com](/how-to-create-a-lipstick-chart-with-matplotlib-2fde5412fee9?source=post_page-----9a9988e30dca--------------------------------)

在这篇文章中，我们将基于Oscar的Python代码，设置颜色调色板，一个吸引人的seaborn样式，以及一个绘制不同宽度和透明度的水平条形图的函数，这些都是制作嵌套条形图所必需的。我们将调整一些代码，并添加更多代码以加载和准备数据，并进行最终展示。

## 导入库并设置样式

对于这个项目，我们需要使用matplotlib和seaborn进行绘图，使用pandas进行数据加载和准备。你可以通过搜索*install <library name>*找到每个库的当前安装说明。

对于颜色调色板，我选择了Oscar Leo文章中推荐的[Color Hunt site](https://colorhunt.co/palette/186f65b5cb99fce09bb2533e)上的“足球”绿色和棕色。

Seaborn提供了一个设置运行配置样式参数的方法，这些参数会自动应用于每个图形。如果你希望制作多个具有相同参数的图形，或者想通过将这些细节抽象到另一个单元格或位置来“简化”你的绘图代码，这个功能会很有帮助。显然，如果你使用的是seaborn的*默认*绘图参数，你不需要这些代码。

[PRE0]

## 加载数据

以下代码使用pandas的`read_csv()`方法从gist中加载CSV格式的投票数据，然后显示前三行以进行质量控制。

[PRE1]

![](../Images/4f67103c276a4fd82da4c09a475d6ff9.png)

> 注：由于我们将比较球队*名称*，因此最好检查它们是否在各个排名中*一致*。在这种情况下，一些排名在球队名称后面附上了球队的*战绩*。这是一个小问题，我已经清理过了，但如果你想在未来扩展这个项目，你应该注意这一点。

## 准备绘制前 25 结果的数据

我们将从查看季前排名中进入赛季结束时的*最终*排名的球队数量开始。为此，我们将依赖 Python 的 `set` 数据类型。

就像在经典数学中一样，`set` 只能包含唯一值（无重复），并且你可以使用内置函数找到两个集合的*交集*。这意味着我们可以提取季前排名和最终排名之间共享的项（球队）。

[PRE2]

![](../Images/b99d34d4d739abf8ec2f335c21a91ffe.png)

## 定义绘制条形图的函数

以下代码定义了一个函数，该函数调用 seaborn 的 `barplot()` 方法。其参数让你可以控制生成嵌套条形图时使用的参数。例如，你需要坐标轴对象（`ax_obj`）以便在同一图中叠加条形，`width` 使主条比副条宽，以及 `alpha` 调整每个条形的透明度，使主条更暗。

[PRE3]

## 绘制前 25 的嵌套条形图

在接下来的代码中，我们设置了一个图形，然后调用 `add_bars()` 函数两次，调整参数，来生成主条和副条。`label` 参数用于图例中。

为了使显示更加信息化，我们将使用 `bar_label()` 方法添加关于季前预测准确率的文本。我们将*填充*文本到左侧，以确保文本在视觉上与正确的条形相关联。

[PRE4]

![](../Images/f02579bc53368f5ee08689bd424a125e.png)

显示进入最终排名的季前球队数量的嵌套条形图（作者）

在过去 20 年中排名前 500 的球队中，有 313 支季前被选中的球队进入了最终名单，成功率约为 63%。

这算是一个好结果吗？我不太确定。美国大学橄榄球被多个强大程序主宰，这些程序通常出现在最终排名中，因此挑选这些球队相对容易且可靠。然而，一个有趣的观察是，自 2011 年以来，成功率呈下降趋势。

![](../Images/168d0c464b298acc7367fa7f153c63f2.png)

自 2011 年以来预测结果的一般下降趋势（作者）

这个趋势可能是巧合，也可能是多个因素的结果，包括游戏规则的变化、会议调整、NIL（名称、图像和肖像）支付的引入以及转会门户的开放。

## 准备绘制前 4 结果的数据

从2014年开始，*全国大学体育协会（NCAA）*采用了四队淘汰赛来决定*第一级橄榄球碗分区*的国家冠军。让我们重新审视之前的代码，选择前4名球队，以查看排名对最终冠军的选择效果如何。这里有个剧透：季前赛排名在过去20年中只正确选择了2次最终冠军，成功率仅为10%！

[PRE5]

![](../Images/d5c9ea48a83374a0313bfbad9f2c9e45.png)

[PRE6]

这里需要注意的一点是，这次我们必须将条形标签填充到*右侧*。问题在于2010年和2013年没有任何季前赛球队进入最终排名。如果我们像之前的显示那样将标签填充到左侧，注释将“掉出边缘”，并覆盖y轴值。正如你可以想象的那样，短条和长条的组合不适合注释嵌套条形图。

![](../Images/1f386c33610961ba3456db229522fa95.png)

团队在AP大学橄榄球排名中开始和结束于前4名的嵌套条形图（作者提供）

在过去20年中，80支进入前4名的球队中，季前赛排名大约识别了42%。在2011年和2020年中，它准确地预测了4中的3个。在2010年和2013年中，它的预测全都错误。

# 总结

嵌套条形图是一种干净且紧凑的方式，用于比较一个测量值始终低于另一个测量值的分类数据。通过包含*条形标签*来提供额外信息，你可以轻松将这些图表转化为有吸引力的信息图，传达*意义*和*信息*。

# 谢谢！

感谢阅读，未来请关注我更多的*快速成功数据科学*项目。
