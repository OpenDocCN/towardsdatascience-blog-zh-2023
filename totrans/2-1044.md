# å˜¿ï¼ŒGPUï¼Œæˆ‘çš„çŸ©é˜µæ€ä¹ˆäº†ï¼Ÿ

> åŸæ–‡ï¼š[https://towardsdatascience.com/hey-gpu-whats-up-with-my-matrix-cb7f6d7ae7d6](https://towardsdatascience.com/hey-gpu-whats-up-with-my-matrix-cb7f6d7ae7d6)

## äº†è§£GPUå¦‚ä½•æ‰§è¡ŒçŸ©é˜µä¹˜æ³•çš„æ¸©å’ŒæŒ‡å—

[](https://thushv89.medium.com/?source=post_page-----cb7f6d7ae7d6--------------------------------)[![Thushan Ganegedara](../Images/3fabfa37132f7d3a9e7679c3b8d7e061.png)](https://thushv89.medium.com/?source=post_page-----cb7f6d7ae7d6--------------------------------)[](https://towardsdatascience.com/?source=post_page-----cb7f6d7ae7d6--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----cb7f6d7ae7d6--------------------------------) [Thushan Ganegedara](https://thushv89.medium.com/?source=post_page-----cb7f6d7ae7d6--------------------------------)

Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----cb7f6d7ae7d6--------------------------------) Â·é˜…è¯»æ—¶é•¿8åˆ†é’ŸÂ·2023å¹´6æœˆ13æ—¥

--

![](../Images/a911c1d35115175bbfe3894ea74e8d00.png)

å›¾ç‰‡æ¥æºï¼š[Thomas Foster](https://unsplash.com/@thomasfos?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) åœ¨ [Unsplash](https://unsplash.com/photos/vWgoeEYdtIY?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

çŸ©é˜µä¹˜æ³•ï¼›æ·±åº¦ç¥ç»ç½‘ç»œå’Œç°ä»£è¯­è¨€ç†è§£å·¨å¤´çš„åœ£æ¯ã€‚ä½œä¸ºMLEæˆ–æ•°æ®ç§‘å­¦å®¶ï¼Œæˆ‘ä»¬çš„æ‰‹æŒ‡å¤ªå¿«äº†ï¼Œä»¥è‡³äºåªéœ€æ•²å…¥ `tf.matmul` æˆ– `torch.matmul`ï¼Œç„¶åä»æœªå›å¤´ã€‚ä½†ä¸è¦å‘Šè¯‰æˆ‘ä½ ä»æœªå¯¹çŸ©é˜µè¿›å…¥GPUæ—¶å¯èƒ½å‘ç”Ÿçš„æƒ…å†µæ„Ÿåˆ°è¿‡ä¸€ä¸å…´å¥‹ï¼å¦‚æœä½ æœ‰ï¼Œé‚£ä½ æ¥å¯¹åœ°æ–¹äº†ã€‚è·Ÿéšæˆ‘ï¼Œä¸€èµ·æ¢ç´¢GPUå†…éƒ¨é‚£äº›è¿·äººçš„å¤æ‚æ€§ã€‚

æˆ‘å°†å‘ä½ è§£é‡Šè¿™äº›è®¡ç®—å¼ºè€…æ˜¯å¦‚ä½•å¤„ç†æ•°å­—çš„ã€‚ä½ å°†äº†è§£GPUåœ¨é¢å¯¹çŸ©é˜µæ—¶åšçš„ä¸‰ä»¶é²œä¸ºäººçŸ¥çš„ä»¤äººå°è±¡æ·±åˆ»çš„äº‹æƒ…ã€‚åœ¨æœ¬æ–‡ç»“æŸæ—¶ï¼Œä½ å°†å¯¹GPUå†…éƒ¨çš„çŸ©é˜µä¹˜æ³•æœ‰ä¸€ä¸ªæ¸…æ™°çš„ç†è§£ã€‚

# GEMMï¼šä¸€ä¸ªçœŸæ­£çš„ğŸ’ä¸ºGPUæ‰€ç”¨

GEMM æˆ–å¹¿ä¹‰çŸ©é˜µä¹˜æ³•æ˜¯å½“GPUæ‰§è¡ŒçŸ©é˜µä¹˜æ³•æ—¶è¿è¡Œçš„å†…æ ¸ã€‚

`C = a (A.B) + b C`

åœ¨è¿™é‡Œï¼Œ`a` å’Œ `b` æ˜¯æ ‡é‡ï¼Œ`A` æ˜¯ä¸€ä¸ª `MxK` çŸ©é˜µï¼Œ`B` æ˜¯ä¸€ä¸ª `KxN` çŸ©é˜µï¼Œå› æ­¤ `C` æ˜¯ä¸€ä¸ª `MxN` çŸ©é˜µã€‚å°±æ˜¯è¿™ä¹ˆç®€å•ï¼ä½ å¯èƒ½ä¼šå¥½å¥‡ä¸ºä»€ä¹ˆä¼šæœ‰é‚£ä¸€ä¸ªé¢å¤–çš„åŠ æ³•ã€‚äº‹å®è¯æ˜ï¼Œè¿™æ˜¯ä¸€ç§åœ¨ç¥ç»ç½‘ç»œä¸­éå¸¸å¸¸è§çš„æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œæ·»åŠ åç½®ã€åº”ç”¨ReLUã€æ·»åŠ æ®‹å·®è¿æ¥ï¼‰ã€‚

# æŠ€å·§ #1ï¼šå¤–ç§¯çš„æ•ˆæœå‡ºä¹æ„æ–™ğŸ‘½

å¦‚æœä½ è¢«è¦æ±‚ä»åŸºæœ¬åŸç†å‡ºå‘ç¼–å†™ä¸€ä¸ªçŸ©é˜µä¹˜æ³•ç®—æ³•ï¼Œè¿™é‡Œæ˜¯ä½ è¦åšçš„ï¼ˆé™¤éä½ å¤©ç”Ÿèªæ…§ï¼Œèƒ½ç”¨GPUä»£æ›¿å¤§è„‘â€”â€”é‚£æ ·ä¸å°±èƒ½ä¸ºMLEçœä¸‹ä¸å°‘é’±äº†ï¼ï¼‰ã€‚

[PRE0]

è¿™é‡Œæœ‰ä¸€ä¸ªåŠ¨ç”»è§†è§‰æ•ˆæœï¼Œå¯ä»¥å±•ç¤ºè¿™æ˜¯ä»€ä¹ˆæ•ˆæœã€‚

![](../Images/4f0c3e4a00f1242d2e82a1d450984883.png)

åŸºäºå†…ç§¯çš„ä¸¤ä¸ªçŸ©é˜µçš„ä¹˜æ³•ï¼ˆç”±ä½œè€…é‡ç° â€” çµæ„Ÿæ¥æºï¼š[https://www.adityaagrawal.net/blog/architecture/matrix_multiplication](https://www.adityaagrawal.net/blog/architecture/matrix_multiplication)ï¼‰

ä½†ä½ çŸ¥é“GPUè®¨åŒè¿™ç§å®ç°å—ğŸ¤”ï¼Ÿè¦ç†è§£åŸå› ï¼Œä½ éœ€è¦äº†è§£GPUå†…å­˜æ¶æ„ï¼Œ

> æ‰€æœ‰æ¯”è¾ƒå’Œè§„æ ¼ï¼Œæˆ‘å°†ä½¿ç”¨Nvidia A100 GPUè§„æ ¼ã€‚

GPUæœ‰ä¸‰ä¸ªä¸»è¦çš„å†…å­˜çº§åˆ«ï¼Œ

+   å…¨å±€å†…å­˜æˆ–HBMï¼ˆé€šå¸¸æŒ‡çš„GPUå†…å­˜ï¼Œä»¥åŠä½ åœ¨è¿è¡Œ`nvidia-smi`æ—¶çœ‹åˆ°çš„å†…å­˜ï¼‰

+   å…±äº«å†…å­˜ï¼ˆä¸“é—¨åˆ†é…ç»™ä¸€ä¸ªæµå¼å¤šå¤„ç†å™¨[æˆ–SM]çš„æœ¬åœ°å†…å­˜ï¼Œå¹¶åœ¨è¯¥SMä¸­è¿è¡Œçš„çº¿ç¨‹ä¹‹é—´å…±äº«ï¼‰

+   å¯„å­˜å™¨ï¼ˆåˆ†é…ç»™çº¿ç¨‹ä»¥æ‰§è¡Œå…¶å·¥ä½œè´Ÿè½½ï¼‰

è¿™å°±æ˜¯å®ƒçš„æ ·å­ï¼Œ

![](../Images/df76c1f0c3b54d513f3aaa48519ea1c5.png)

GPUçš„å…¸å‹å†…å­˜å±‚æ¬¡ç»“æ„ï¼ˆä¸ºäº†ç®€ä¾¿ï¼Œå¿½ç•¥L0/L1/L2ç¼“å­˜ï¼‰

é¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼Œå…±äº«å†…å­˜ï¼ˆä»ç°åœ¨èµ·ç§°ä¸ºSRAMï¼‰æ¯”HBMå°å¾—å¤šï¼Œæ›´ä¸ç”¨è¯´å¯„å­˜å™¨äº†ã€‚æ‰€ä»¥ä½ çš„çŸ©é˜µä¸å¯èƒ½é€‚åˆå…¶ä¸­ï¼ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼‰ã€‚å¦‚æœæˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„åŠ¨ç”»ï¼Œå¯¹äº`A`çš„ä¸€è¡Œï¼Œéœ€è¦æ£€ç´¢`B`çš„æ‰€æœ‰åˆ—ï¼Œå¹¶å¯¹`A`ä¸­çš„æ‰€æœ‰è¡Œé‡å¤æ­¤è¿‡ç¨‹ã€‚è¿™æ„å‘³ç€ï¼ŒGPUéœ€è¦è¿›è¡Œå¤§é‡è¯»å–æ¥è®¡ç®—è¾“å‡ºã€‚HBMï¼ˆçº¦1.5TB/sï¼‰æ¯”SRAMï¼ˆçº¦19TB/sï¼‰æ…¢å‡ ä¸ªæ•°é‡çº§ã€‚

ç”¨æ•°å­—æ¥è¯´ï¼Œå‡è®¾ä½ æƒ³ä¹˜ä»¥ä¸€ä¸ª`10x20`å’Œ`20x30`çš„çŸ©é˜µï¼Œä½ éœ€è¦è¯»å–`B`çš„åˆ—`10x30=300`æ¬¡ã€‚æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•å‘¢ï¼Ÿ

äº‹å®è¯æ˜ä¸€ä¸ªç®€å•çš„æŠ€å·§èƒ½å¤§æœ‰å¸®åŠ©ï¼åªéœ€ç¿»è½¬å¾ªç¯çš„é¡ºåºï¼Œä½¿`k`æˆä¸ºæœ€å¤–å±‚çš„å¾ªç¯ã€‚å°±å®Œæˆäº†ï¼ğŸ˜®

[PRE1]

æˆ‘ä»¬æ²¡æœ‰è§¦åŠå®é™…è®¡ç®—ï¼Œåªæ˜¯è°ƒæ•´äº†å¾ªç¯çš„é¡ºåºï¼Œå› æ­¤ç»“æœåº”è¯¥å’Œä¹‹å‰ä¸€æ ·ã€‚ç°åœ¨çŸ©é˜µä¹˜æ³•çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼

![](../Images/2b847b863d6664b2bc0cf87042f7a6ab.png)

åŸºäºå¤–ç§¯çš„ä¸¤ä¸ªçŸ©é˜µçš„ä¹˜æ³•ï¼ˆç”±ä½œè€…é‡ç° â€” çµæ„Ÿæ¥æºï¼š[https://www.adityaagrawal.net/blog/architecture/matrix_multiplication](https://www.adityaagrawal.net/blog/architecture/matrix_multiplication)ï¼‰

ä½ çœ‹ï¼Œæˆ‘ä»¬ä¸€æ¬¡åªå¸¦æ¥`A`çš„ä¸€ä¸ª*åˆ—*å’Œ`B`çš„ä¸€ä¸ª*è¡Œ*ï¼Œå¹¶ä¸”ä¸ä¼šå›å¤´çœ‹ã€‚è¿™éœ€è¦çš„è¯»å–æ¬¡æ•°æ¯”åŸå§‹å®ç°å°‘å¾—å¤šã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œæˆ‘ä»¬ä¹‹å‰è®¡ç®—çš„æ˜¯ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„*å†…ç§¯*ï¼Œç°åœ¨æˆ‘ä»¬è®¡ç®—çš„æ˜¯*å¤–ç§¯*ã€‚

![](../Images/d844eb8589acdba180851c314b96e206.png)

ç»¿è‰²æ˜¾ç¤ºçš„ä¸¤ä¸ªå‘é‡ï¼ˆè“è‰²å’Œé»„è‰²ï¼‰ä¹‹é—´çš„å†…ç§¯å’Œå¤–ç§¯çš„åŒºåˆ«ã€‚

ä½†ä»ç„¶ï¼Œæˆ‘ä»¬éœ€è¦æ•´ä¸ª`C`åœ¨SRAMä¸­ï¼Œè¿™å¯èƒ½å¤ªå¤§è€Œæ— æ³•å®¹çº³åœ¨SRAMä¸­ã€‚é‚£ä¹ˆCUDAæ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿè¿™å°±å¼•å‡ºäº†ç¬¬äºŒä¸ªæŠ€å·§ã€‚

# æŠ€å·§ #2ï¼šåˆ†è€Œæ²»ä¹‹ï¼ˆå¹¶ç´¯ç§¯ï¼‰

ä¸ç”¨æ‹…å¿ƒï¼æˆ‘ä¸ä¼šç”¨å¤æ‚çš„æ•°å­¦æˆ–Leetcodeç®—æ³•è½°ç‚¸ä½ ã€‚ä¸»è¦è¦è®°ä½çš„æ˜¯ï¼ŒçŸ©é˜µæ˜¯å•ç‹¬ç“¦ç‰‡çš„äºŒç»´å¸ƒå±€ã€‚ä¸‹é¢çš„åŠ¨ç”»å¾ˆå¥½åœ°å±•ç¤ºäº†æˆ‘è¯•å›¾è§£é‡Šçš„å†…å®¹ã€‚

![](../Images/52fbea7b18ac1a73b3158ececd0f9c16.png)

ä½ å¯ä»¥è¿­ä»£Aå’ŒBä¸­çš„æ¯ä¸ªå—ï¼Œä»ç„¶å¯ä»¥è®¡ç®—Cå¯¹åº”å—çš„å‡†ç¡®ç­”æ¡ˆ

ç»¿è‰²å—ğŸ’šçš„ç»“æœæ˜¯æµ…è“è‰²çš„Aæ¡ğŸ’™å’Œæµ…é»„è‰²çš„Bæ¡ğŸ’›ã€‚æ›´è¿›ä¸€æ­¥ï¼Œä¸ºäº†è®¡ç®—è¾“å‡ºï¼Œä½ å¯ä»¥ä¸€æ¬¡å¸¦æ¥ä¸€ä¸ªAæ¡çš„å—å’Œä¸€ä¸ªBæ¡çš„å—ï¼Œè®¡ç®—è¾“å‡ºå¹¶å°†ç»“æœç´¯ç§¯åœ¨ç»¿è‰²æ¡†ä¸­ã€‚

è¿™ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªçµæ´»çš„æ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥åŠ è½½ä»»æ„å¤§å°çš„Aå’ŒBçš„å—ï¼ˆæˆ–ç“¦ç‰‡ï¼‰ï¼Œä»ç„¶èƒ½å¤Ÿè®¡ç®—æœ€ç»ˆçš„ç­”æ¡ˆã€‚æˆ‘ä»¬ä¸å¿…æ­¢æ­¥äºæ­¤ï¼Œå¯ä»¥ç»§ç»­é€’å½’åœ°å°†é—®é¢˜åˆ’åˆ†ä¸ºæ›´å°çš„é—®é¢˜ã€‚å³çŸ©é˜µè¢«æ‹†åˆ†æˆç“¦ç‰‡ï¼Œç“¦ç‰‡è¢«æ‹†åˆ†æˆç‰‡æ®µï¼Œç‰‡æ®µè¿›ä¸€æ­¥æ‹†åˆ†æˆå•ä¸ªå€¼ã€‚

![](../Images/9ebe0775cebde0334adaa9b57b088d8c.png)

ä½¿ç”¨ç“¦ç‰‡æ–¹æ³•ï¼Œé—®é¢˜å¯ä»¥é€’å½’åœ°æ‹†è§£ã€‚

è¿™å¾ˆå¥½åœ°é€‚ç”¨äºGPUä¸­çš„è¿‡ç¨‹æ‰§è¡Œæ¶æ„ã€‚GPUä¸­çš„å†…æ ¸æ‰§è¡Œæœ‰ä¸‰å±‚ã€‚ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬è¯´ä¸€ä¸ªSMè¿è¡Œä¸€ä¸ªçº¿ç¨‹å—ï¼ˆè™½ç„¶å®é™…ä¸Šå®ƒä»¬æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œä»¥å‡å°‘è¢«ç§°ä¸º[å°¾æ•ˆåº”](https://docs.nvidia.com/deeplearning/performance/dl-performance-gpu-background/index.html#gpu-execution)çš„å½±å“ï¼‰ã€‚

+   çº¿ç¨‹

+   Warpsï¼ˆ32ä¸ªçº¿ç¨‹çš„é›†åˆï¼‰

+   çº¿ç¨‹å—ï¼ˆå‡ ä¸ªwarpçš„é›†åˆï¼‰

çº¿ç¨‹å—ä¸­çš„ç¡®åˆ‡çº¿ç¨‹æ•°é‡å–å†³äºç‰¹å®šçš„æ¶æ„ã€‚ä¾‹å¦‚ï¼Œ[A100å…·æœ‰ä»¥ä¸‹è§„æ ¼](https://developer.nvidia.com/blog/nvidia-ampere-architecture-in-depth/)ã€‚

+   æ¯ä¸ªSMæœ€å¤§æ”¯æŒ2048ä¸ªçº¿ç¨‹

+   æ¯ä¸ªå—æœ€å¤§æ”¯æŒ1024ä¸ªçº¿ç¨‹

+   æ¯ä¸ªSMæœ€å¤§æ”¯æŒ32ä¸ªçº¿ç¨‹å—

## ä¾§è¾¹æ  #2ï¼š2çš„å¹‚çš„é­”åŠ›

å›åˆ°ç“¦ç‰‡æ–¹æ³•ï¼Œå·²å‘ç°ï¼ˆå¯å‘å¼åœ°ï¼‰æ¯ä¸ªçº¿ç¨‹å—çš„çŸ©é˜µç“¦ç‰‡å¤§å°ä¸º`256x128`åœ¨å¤§å¤šæ•°é—®é¢˜ä¸­èƒ½æä¾›åˆç†çš„æ•ˆç‡ã€‚å› æ­¤ï¼Œè¿™æ˜¯CUDAå¸¸ç”¨çš„ç“¦ç‰‡å¤§å°ã€‚

ä½ å¯èƒ½å¬è¯´è¿‡å°†æ‰¹å¤„ç†å¤§å°ã€éšè—ç»´åº¦å¤§å°ä¿æŒä¸º2çš„å¹‚çš„æœ€ä½³å®è·µã€‚è¿™å°±æ˜¯æ¥æºï¼å½“ä½ çš„çŸ©é˜µç»´åº¦æ˜¯2çš„å¹‚æ—¶ï¼Œå®ƒå°†è¢«å®Œå…¨åˆ’åˆ†ä¸ºä¸€ç»„æ²¡æœ‰ä½™æ•°çš„ç“¦ç‰‡ã€‚å¦‚æœä¸æ˜¯ï¼Œè¿™ä¼šä½¿ä½ çš„ä»£ç [æ•ˆç‡æ›´ä½](https://docs.nvidia.com/deeplearning/performance/dl-performance-matrix-multiplication/index.html#requirements-tc)ã€‚

> å½“ä½ çš„çŸ©é˜µç»´åº¦æ˜¯2çš„å¹‚æ—¶ï¼ŒGPUè®¡ç®—ä¼šæ›´é«˜æ•ˆ

å½“ä¸æ˜¯2çš„å¹‚æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

## ä¾§è¾¹æ  #2ï¼šç“¦ç‰‡é‡åŒ–

è¿™ä¼šå¯¼è‡´ä¸€ç§å«åš [*tile quantization*](https://docs.nvidia.com/deeplearning/performance/dl-performance-matrix-multiplication/index.html#tile-quant) çš„ç°è±¡ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ çš„ tile è¡Œç»´åº¦ä¸º 128ï¼Œä½†çŸ©é˜µçš„è¡Œä¸­æœ‰ 257 ä¸ªå…ƒç´ ï¼Œä½ éœ€è¦çš„ä¸ä»…ä»…æ˜¯ä¸¤ä¸ªï¼Œè€Œæ˜¯ä¸‰ä¸ª tilesï¼ˆå³ 256+1ï¼‰ã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚

![](../Images/6c0e19fcfcf9ef9bf3d1da19ff0313ca.png)

ä»…ä»…å› ä¸ºè¡Œä¸­å¤šäº†ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬ä¸å¾—ä¸åˆ†é…ä¸¤ä¸ªå®Œæ•´çš„çº¿ç¨‹å—ã€‚

é—®é¢˜åœ¨äºï¼Œæ— è®ºçº¿ç¨‹å—ä¸­æœ‰ç”¨çš„æ•°æ®å¦‚ä½•ï¼Œçº¿ç¨‹å—æ‰§è¡Œçš„è®¡ç®—é‡æ˜¯ç›¸åŒçš„ã€‚å› æ­¤ï¼Œä½ ä¼šæŠŠæ‰§è¡Œæœ‰ç”¨è®¡ç®—çš„æœºä¼šä» GPU ä¸­æ‹¿èµ°ï¼Œå¯¼è‡´æ•ˆç‡ä½ä¸‹ã€‚

ç±»ä¼¼çš„ç°è±¡ç§°ä¸º wave é‡åŒ–ï¼Œå³çŸ©é˜µè¿‡å¤§ï¼ŒSMs æ— æ³•ä¸€æ¬¡æ€§å®¹çº³ã€‚è¿™æ—¶ GPU éœ€è¦è¿›è¡Œ 2 æ¬¡â€œæ³¢â€ã€‚ä¸è¿‡ï¼Œè¿™å¯¹ç°ä»£ GPU å½±å“è¾ƒå°ï¼Œå› ä¸ºå®ƒä»¬åˆ©ç”¨å¹¶å‘æ€§æ¥å‡å°‘ wave é‡åŒ–ã€‚

> å½“çº¿ç¨‹å—éœ€è¦éƒ¨åˆ†æº¢å‡ºæ•°æ®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿ tile é‡åŒ–ï¼›å½“ SMs éœ€è¦æº¢å‡ºæ•°æ®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿ wave é‡åŒ–ã€‚

# æŠ€å·§ #3ï¼šä¸€ä¸ªæ¯”ä¸¤ä¸ªå¥½

æœ€ç»ˆçš„æŠ€å·§æ˜¯å†…æ ¸èåˆã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå°†æ‰€æœ‰è®¡ç®—æ”¾åœ¨ä¸€ä¸ªå†…æ ¸ä¸­è¦æ¯”ä¸€ä¸ªæ¥ä¸€ä¸ªè°ƒç”¨ä¸¤ä¸ªå†…æ ¸è¦å¿«ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºä¸€ä¸ªå†…æ ¸éœ€è¦å°†æ•°æ®å†™å…¥ HBMï¼Œå¦ä¸€ä¸ªéœ€è¦è¯»å–æ•°æ®ã€‚æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡è¿™ç§æ“ä½œæœ‰å¤šæ…¢ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯å°†ä¸¤ä¸ªæ“ä½œåˆå¹¶ä¸ºä¸€ä¸ªã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œ

+   [matmul + bias + relu](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/matmul_op_fused.cc)

+   [conv + bias + relu](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/conv_ops_fused_impl.h)

+   [batchnorm + relu](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/fused_batch_norm_op.h)

æ­£å¦‚è¿™é‡Œæ‰€çœ‹åˆ°çš„ï¼ˆæˆ‘ç›¸ä¿¡ Pytorch ä¹Ÿæœ‰ç±»ä¼¼çš„æœ¯è¯­è¡¨ï¼‰ï¼ŒTensorFlow æä¾›äº†è®¸å¤šèåˆçš„å†…æ ¸ï¼Œå°†ä¾¿æ·çš„æ“ä½œåˆå¹¶åˆ°ä¸€ä¸ªå†…æ ¸ä¸­ã€‚åœ¨ä»£ç ä¸­ï¼Œè¿™æ„å‘³ç€ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼Œ

[PRE2]

æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ä¼šçæƒœæˆ‘ä»¬çš„ `tmp` å˜é‡ï¼Œç›´åˆ°å®Œæˆæ‰€æœ‰è®¡ç®—åæ‰å°†ç»“æœå†™å› `C`ã€‚

# ç»“è®º

å°±è¿™äº›äº†ï¼Œå¸Œæœ›è¿™æ¬¡é€šè¿‡ GPU çš„â€œä¸›æ—æ¢é™©â€å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚å¦‚æœä½ å¯¹éŸ³é¢‘è§†è§‰ç‰ˆæœ¬æ„Ÿå…´è¶£ï¼Œè¿™é‡Œæ˜¯æˆ‘çš„ YouTube è§†é¢‘çš„é“¾æ¥ã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸‰ä»¶ä½¿ GPU åœ¨çŸ©é˜µä¹˜æ³•ä¸­éå¸¸å¿«é€Ÿçš„äº‹æƒ…ã€‚

+   GPUs æ‘’å¼ƒäº†æ›´å‹å¥½çš„å†…ç§¯å®ç°ï¼Œè½¬è€Œé‡‡ç”¨æ›´é«˜æ•ˆçš„å¤–ç§¯å®ç°ã€‚

+   GPUs å°†çŸ©é˜µåˆ†å‰²æˆæ›´å°çš„å—ï¼ˆå—å†åˆ†å‰²æˆç¢ç‰‡ï¼‰ï¼Œå¹¶å°†è®¡ç®—è´Ÿè½½åˆ†é…åˆ°çº¿ç¨‹å—ã€warp å’Œçº¿ç¨‹ä¸Šã€‚

+   GPUs ä½¿ç”¨å†…æ ¸èåˆå°†å¸¸è§çš„åŠŸèƒ½ç»„åˆåœ¨ä¸€èµ·ï¼Œæé«˜ GPU æ•ˆç‡ã€‚

å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæ•…äº‹ï¼Œå¯ä»¥éšæ—¶[è®¢é˜…](https://thushv89.medium.com/membership)Mediumï¼Œè¿™æ ·ä½ å°±ä¼šæ”¶åˆ°æˆ‘çš„æœ€æ–°å†…å®¹é€šçŸ¥ï¼Œå¹¶ä¸”èƒ½å¤Ÿè§£é”æ¥è‡ªå…¶ä»–ä½œè€…çš„æˆåƒä¸Šä¸‡çš„ä¼˜è´¨æ•…äº‹çš„å®Œæ•´è®¿é—®æƒé™ã€‚

[](https://thushv89.medium.com/membership?source=post_page-----cb7f6d7ae7d6--------------------------------) [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥Medium - Thushan Ganegedara

### ä½œä¸ºMediumä¼šå‘˜ï¼Œä½ çš„ä¸€éƒ¨åˆ†ä¼šå‘˜è´¹ç”¨å°†ä¼šæ”¯æŒä½ é˜…è¯»çš„ä½œè€…ï¼Œå¹¶ä¸”ä½ å¯ä»¥å®Œå…¨è®¿é—®æ¯ä¸€ç¯‡æ•…äº‹â€¦

[https://thushv89.medium.com/membership?source=post_page-----cb7f6d7ae7d6--------------------------------](https://thushv89.medium.com/membership?source=post_page-----cb7f6d7ae7d6--------------------------------)

*é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™æ‰€æœ‰å›¾ç‰‡å‡ç”±ä½œè€…æä¾›*

# å‚è€ƒæ–‡çŒ®ï¼š

+   [https://docs.nvidia.com/deeplearning/performance/dl-performance-matrix-multiplication/index.html](https://docs.nvidia.com/deeplearning/performance/dl-performance-matrix-multiplication/index.html)

+   [https://developer.nvidia.com/blog/cutlass-linear-algebra-cuda/](https://developer.nvidia.com/blog/cutlass-linear-algebra-cuda/)

+   [https://developer.nvidia.com/blog/nvidia-ampere-architecture-in-depth/](https://developer.nvidia.com/blog/nvidia-ampere-architecture-in-depth/)
