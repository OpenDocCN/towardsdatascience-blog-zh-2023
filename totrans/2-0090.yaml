- en: 4 Useful BigQuery SQL Functions You May Not Know
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/4-useful-bigquery-sql-functions-you-may-not-know-82e830d994ca](https://towardsdatascience.com/4-useful-bigquery-sql-functions-you-may-not-know-82e830d994ca)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: And how to use them
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://madfordata.medium.com/?source=post_page-----82e830d994ca--------------------------------)[![Vicky
    Yu](../Images/54a32f45ebd13a18811912877f60f2f7.png)](https://madfordata.medium.com/?source=post_page-----82e830d994ca--------------------------------)[](https://towardsdatascience.com/?source=post_page-----82e830d994ca--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----82e830d994ca--------------------------------)
    [Vicky Yu](https://madfordata.medium.com/?source=post_page-----82e830d994ca--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----82e830d994ca--------------------------------)
    ·4 min read·Jan 26, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1c2be453429ef62ac777a6d882068008.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Priscilla Du Preez](https://unsplash.com/@priscilladupreez?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: As a long-time SQL user, I’m always looking for ways to make it easier to analyze
    data with SQL. In a previous article, I reviewed [6 BigQuery SQL functions](/6-bigquery-sql-functions-every-user-should-know-9ed97b1cf72e)
    I wish I had known earlier, and today I want to share 4 more functions I hope
    you’ll find useful.
  prefs: []
  type: TYPE_NORMAL
- en: 1\. PERCENTILE_CONT
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PERCENTILE_CONT](https://cloud.google.com/bigquery/docs/reference/standard-sql/navigation_functions#percentile_cont)
    calculates the percentile from a column of values. BigQuery doesn’t have a **MEDIAN**
    function but you can use **PERCENTILE_CONT** to calculate the [median because
    it’s equivalent to the 50th percentile](https://www.statisticshowto.com/probability-and-statistics/percentiles-rank-range/).
    Calculating the median and percentiles is useful to get a sense of the distribution
    and determine outliers that may affect your analysis.'
  prefs: []
  type: TYPE_NORMAL
- en: In the example below, I have 6 numbers ( 1, 3, 5, 8, 10, and 1000 ) in an array
    that are expanded into rows using the **UNNEST** function. Row 4 calculates the
    median with 0.5 as the argument indicating the 50th percentile and row 5 uses
    0.95 to calculate the 95th percentile. Notice the results show the **95th percentile**
    is **752** while the **25th percentile** is **3.5** and the **median** is **6.5**.
    This indicates outliers may need to be removed for analysis because the differences
    are very large.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0737467f5c768c7be9f2134e0350b3be.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot with PERCENTILE_CONT query example created by author
  prefs: []
  type: TYPE_NORMAL
- en: 2\. COUNTIF
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The [COUNTIF](https://cloud.google.com/bigquery/docs/reference/standard-sql/aggregate_functions#countif)
    function counts the value if it satisfies a condition. This is useful to get counts
    from a table with different conditions without having to run multiple SQL queries.
  prefs: []
  type: TYPE_NORMAL
- en: In the example below, to get the count of the negative numbers and positive
    numbers I could run the query twice with two different where conditions in rows
    3 and 7.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/63eb4d0b2797e5bbb0c52dfed07a9d62.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot with COUNT queries example created by author
  prefs: []
  type: TYPE_NORMAL
- en: However, using **COUNTIF** I can run this query once to get the count of both
    positive and negative numbers in rows 1 and 2.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/528a556fc57febccd27d1bff449bfe33.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot with COUNTIF query example created by author
  prefs: []
  type: TYPE_NORMAL
- en: 3\. IF
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[IF](https://cloud.google.com/bigquery/docs/reference/standard-sql/conditional_expressions#if)
    is an alternative to [CASE](https://cloud.google.com/bigquery/docs/reference/standard-sql/conditional_expressions#case)
    if you only need to evaluate whether a condition is true or false. In row 10,
    if A is less than B and A is greater than 0 then the **result_from_if** column
    to set to **true** else **result_from_if** is set to **false**. In row 11, CASE
    is used to get the same result but it is a longer expression compared to using
    the IF function.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/aec1e3b1165d878b0351956c4a5c3088.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot with IF and CASE query example created by author
  prefs: []
  type: TYPE_NORMAL
- en: '***Note***: You can combine [COUNT](https://cloud.google.com/bigquery/docs/reference/standard-sql/aggregate_functions#count)
    and IF with DISTINCT to get a count of distinct values meeting a condition. In
    the example below, only positive numbers ( 1, 3, and 4 ) are counted in the DISTINCT
    returning a count of 3.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/79c7bd97ab2a07fbd888d768b86f0568.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot with COUNT, IF and DISTINCT query example created by author
  prefs: []
  type: TYPE_NORMAL
- en: 4\. ERROR
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[ERROR](https://cloud.google.com/bigquery/docs/reference/standard-sql/debugging_functions#error)
    is useful to alert you of unexpected values in the data. In the example below,
    the **ERROR** function is used on row 4 when CASE encounters a value other than
    **cat** or **dog**. This is useful for troubleshooting, especially in ETL pipelines
    where you may want the SQL to fail if there are unexpected values in a column
    that requires investigation.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f33db78f185d9f04a16df5c719257ba6.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot with ERROR query example created by author
  prefs: []
  type: TYPE_NORMAL
- en: Final Thoughts
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: While the functions I mentioned are available in BigQuery, they may also be
    available in other databases but with different names. For example, COUNTIF is
    COUNT_IF in Snowflake. If you have a few minutes I highly recommend reading your
    database documentation because you never know the useful functions you may find.
  prefs: []
  type: TYPE_NORMAL
- en: '*Note: All queries above were run on* [*BigQuery sandbox*](https://cloud.google.com/bigquery/docs/sandbox)
    *that’s free to anyone with a Google account.*'
  prefs: []
  type: TYPE_NORMAL
- en: '[](/4-bigquery-sql-shortcuts-that-can-simplify-your-queries-30f94666a046?source=post_page-----82e830d994ca--------------------------------)
    [## 4 BigQuery SQL Shortcuts That Can Simplify Your Queries'
  prefs: []
  type: TYPE_NORMAL
- en: Check if your database has them too
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/4-bigquery-sql-shortcuts-that-can-simplify-your-queries-30f94666a046?source=post_page-----82e830d994ca--------------------------------)
    [](/6-bigquery-sql-functions-every-user-should-know-9ed97b1cf72e?source=post_page-----82e830d994ca--------------------------------)
    [## 6 BigQuery SQL Functions Every User Should Know
  prefs: []
  type: TYPE_NORMAL
- en: Check if your database has them too
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/6-bigquery-sql-functions-every-user-should-know-9ed97b1cf72e?source=post_page-----82e830d994ca--------------------------------)
    [](/bigquery-sql-procedural-language-to-simplify-data-engineering-66ecfc47f3ac?source=post_page-----82e830d994ca--------------------------------)
    [## BigQuery SQL Procedural Language to Simplify Data Engineering
  prefs: []
  type: TYPE_NORMAL
- en: An introduction
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/bigquery-sql-procedural-language-to-simplify-data-engineering-66ecfc47f3ac?source=post_page-----82e830d994ca--------------------------------)
  prefs: []
  type: TYPE_NORMAL
