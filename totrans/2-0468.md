# ChatGPT能写出比数据分析师更好的SQL吗？

> 原文：[https://towardsdatascience.com/can-chatgpt-write-better-sql-than-a-data-analyst-f079518efab2](https://towardsdatascience.com/can-chatgpt-write-better-sql-than-a-data-analyst-f079518efab2)

[](https://medium.com/@marietruong?source=post_page-----f079518efab2--------------------------------)[![Marie Truong](../Images/2816e49beef958724dc0f38cfa49c4be.png)](https://medium.com/@marietruong?source=post_page-----f079518efab2--------------------------------)[](https://towardsdatascience.com/?source=post_page-----f079518efab2--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----f079518efab2--------------------------------) [Marie Truong](https://medium.com/@marietruong?source=post_page-----f079518efab2--------------------------------)

·发表于[Towards Data Science](https://towardsdatascience.com/?source=post_page-----f079518efab2--------------------------------) ·6分钟阅读·2023年1月5日

--

![](../Images/f2655bf17162524ed1547496c3c4b170.png)

[DeepMind](https://unsplash.com/@deepmind?utm_source=medium&utm_medium=referral)拍摄的照片在[Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

我尝试了[ChatGPT](https://chat.openai.com/)，这是GPT-3语言模型的一个变体，专门设计用于在对话上下文中生成类似人类的文本。当然，就像大多数人一样，我也好奇：人工智能能做我的工作吗？它能做得比我好吗？

我有2年的数据分析师和分析工程师工作经验。根据[BBC Science Focus](https://www.sciencefocus.com/future-technology/gpt-3/)，ChatGPT 已吸收了570 GB的数据。那么谁写的SQL更好呢？

# 来玩吧！

这个游戏将基于3个LeetCode SQL挑战（一个简单，两个中等）。我会先写出每个解决方案，然后将练习发给ChatGPT，看看哪个解决方案效果最好。

我将提供每个挑战的链接，供你也尝试击败ChatGPT。

## 挑战1（简单）

这个挑战叫做[客户下的最大订单数量](https://leetcode.com/problems/customer-placing-the-largest-number-of-orders/)。

![](../Images/0ec1b96ddbf576a2d6c76fb843c70491.png)

作者截图

这是我写的查询：

[PRE0]

它通过了，并且运行时间正确：

![](../Images/75b5c9b6e291d0dea7aa3695f4a59d5a.png)

作者截图

现在让我们看看ChatGPT在这方面的表现。

这是ChatGPT的回答：

![](../Images/ac75a691af623b0303e4b053eb75d730.png)

作者截图

ChatGPT甚至解释了它所做的工作。我觉得这个查询的可读性不高——这也是我喜欢公共表表达式的原因之一——但让我们看看它的表现如何。

![](../Images/41c06d21e8cae27c840c9f1cc7f5fb93.png)

令人印象深刻的是，它有效，但速度比我的结果慢。尽管我很高兴能做得比ChatGPT更好，但我希望能知道如何改进这个查询。

## 挑战2（中等）

下一个挑战叫做 [树节点](https://leetcode.com/problems/tree-node/)。

![](../Images/7a4f164d806385bfe3e058a5ee756a0d.png)

作者截图

我写的第一个查询是这个：

[PRE1]

我在提交之前运行了它，它得到了错误的结果…

![](../Images/dfc0882e59ed813ed3fbacfd3885808a.png)

作者截图

结果我没有足够注意示例，特别是第二个：

![](../Images/0f80c2ce4f7be72ebc34935c069bd992.png)

作者截图

当一个节点既是叶子又是根节点时，它应该被输出为根节点。我将 CASE WHEN 的顺序改为：

[PRE2]

而这次，它通过了！

我的查询得到了平均结果：

![](../Images/4f27f92a48e4a3f25777333bd8b4c7db.png)

作者截图

现在是 ChatGPT 玩游戏的时候了！

ChatGPT 阅读了所有示例，并且没有在既是根节点又是叶节点的节点上犯我的错误：

![](../Images/fbf217774e0e7c72081c3e00851f7e6d.png)

作者截图

但它仍然给了我一个错误的答案：

![](../Images/cfd932af855fe4fdb0096174a7632fd2.png)

作者截图

ChatGPT 没有按每个 id 返回一行。

所以我决定给 ChatGPT 一个提示：

![](../Images/13d29a10b7d68e364fd0d7e59166fbc4.png)

作者截图

而且它能够纠正它！

![](../Images/c07374a6cc891bd1c1b16cf176e5643a.png)

作者截图

我们在这个挑战中都犯了一个错误，但都能纠正它（尽管我不得不给 ChatGPT 提示）。在运行时间方面我有稍微更好的结果，所以得分给我，但差距很小！

## 挑战 3（中等）

最后的挑战叫做 [资本收益/亏损](https://leetcode.com/problems/capital-gainloss/)。

![](../Images/5751d0eb2a65226a2eef11f9356ea05d.png)

作者截图

这是我写的查询：

[PRE3]

![](../Images/19932aa1c08426f372e794b9a7a92345.png)

作者截图

它通过了，但运行时间相当差，超过 90% 的玩家在这方面表现得比我好。

让我们看看 ChatGPT 是否其中之一。

![](../Images/332d69a37cb812ef6b02498c0d1bfad4.png)

作者截图

让我们尝试这个解决方案：

![](../Images/5584cb1710d6e08c45369031e8d938a4.png)

作者截图

再次，它得到了错误的结果。ChatGPT 将一个买入与每一个未来的卖出连接，而不仅仅是对应的一个，因此它的解决方案只在只有一对买入/卖出操作时有效。

我试图告诉 ChatGPT 纠正它的错误，而没有给它任何提示：

![](../Images/ae6fcb9e1d109919d54a63a454f95d5c.png)

作者截图

不幸的是，它给了我完全相同的查询。所以我抱怨了：

![](../Images/6fa457ec958761e22d4c1b3e004ebaf7.png)

作者截图

![](../Images/46ad31bb200fc87515ef303973e01a98.png)

作者截图

这一次，ChatGPT 和我使用了类似的结构，查询通过了。然而，我不确定 ChatGPT 是否真的理解了它一开始错在哪里。

![](../Images/7aaa930367d61792b2536aa4970efe23.png)

作者截图

ChatGPT 的运行时间稍微比我差。

# **结果**

[PRE4]

我认为可以公平地说，我在这次SQL挑战中“战胜”了ChatGPT。我仍然对它的能力感到印象深刻，并惊讶于它能够纠正自己的错误！ChatGPT在速度上绝对超过我；它能在几秒钟内写出有效的SQL语法，而我需要几分钟。

但它仍然有50%的错误。即使它成功完成了每一个挑战，我也不会担心我的工作。利益相关者从不会向分析师提出如此明确的请求和输出示例。他们带来的是业务问题，我们必须考虑如何利用现有数据来找到最佳答案。ChatGPT能做到这一点吗？

我问了ChatGPT对这个问题的看法：

![](../Images/e0edd8c7fd6bf821297d055a713e4510.png)

截图作者

这就总结完了！

希望你喜欢这篇文章！如果喜欢的话，请关注我，获取更多关于SQL和数据分析的内容。
