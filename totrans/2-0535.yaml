- en: How to Compare Two Tables For Equality in BigQuery
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/compare-tables-bigquery-1419ff1b3a2c](https://towardsdatascience.com/compare-tables-bigquery-1419ff1b3a2c)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Compare tables and extract their differences with standard SQL
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://gmyrianthous.medium.com/?source=post_page-----1419ff1b3a2c--------------------------------)[![Giorgos
    Myrianthous](../Images/ff4b116e4fb9a095ce45eb064fde5af3.png)](https://gmyrianthous.medium.com/?source=post_page-----1419ff1b3a2c--------------------------------)[](https://towardsdatascience.com/?source=post_page-----1419ff1b3a2c--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----1419ff1b3a2c--------------------------------)
    [Giorgos Myrianthous](https://gmyrianthous.medium.com/?source=post_page-----1419ff1b3a2c--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----1419ff1b3a2c--------------------------------)
    ·6 min read·Jan 26, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d91f79f374c08c8dffd598f1df953ed3.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Zakaria Ahada](https://unsplash.com/@zakariahada?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/0xOCVe7nUU0?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  prefs: []
  type: TYPE_NORMAL
- en: Comparing tables in BigQuery is a crucial task when testing the results of data
    pipelines and queries prior to productionizing them. The ability to compare tables
    allows for the detection of any changes or discrepancies in the data, ensuring
    that the data remains accurate and consistent.
  prefs: []
  type: TYPE_NORMAL
- en: In this article we will demonstrate how to compare two (or more) tables on BigQuery
    and extract the records that differ (if any). More specifically, we will showcase
    how to compare tables with identical columns as well as tables with a different
    amount of columns.
  prefs: []
  type: TYPE_NORMAL
- en: First, let’s start by creating two tables with some dummy values that we will
    then be referencing throughout this tutorial in order to demonstrate a few different
    concepts.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Comparing records of tables with the same columns
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now that we have created our two example tables, you should have noticed that
    there are a couple of differences between them.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Now assuming that table `temp.tableB` is the latest version of some dataset
    whereas `temp.tableA` is an older one and we would like to see the actual differences
    (in terms of records) between the two tables, all we need is the following query:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Now the result will contain all the differences observed between the tables
    along with a reference to the table name where the records were found.
  prefs: []
  type: TYPE_NORMAL
- en: In our specific examples, tables A and B were having a difference in two records;
    The first one seems to be the record for `Andrew White` since this person has
    a different value for `no_of_purchases` field. Additionally, table `tableB` has
    one additional record that is not even present on table `tableA`.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '*Note: If you are not familiar with the* `*WITH*` *clause and Common Table
    Expressions (CTEs) in SQL, make sure to read the following article:*'
  prefs: []
  type: TYPE_NORMAL
- en: '[](/cte-sql-945e4b461de3?source=post_page-----1419ff1b3a2c--------------------------------)
    [## What are CTEs in SQL'
  prefs: []
  type: TYPE_NORMAL
- en: Understanding Common Table Expression (CTE) in SQL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/cte-sql-945e4b461de3?source=post_page-----1419ff1b3a2c--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Comparing records of tables with different columns
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now let’s suppose you would like to compare the records between two tables having
    a different amount of columns. Obviously, we would have to do an apples-to-apples
    comparison meaning that we somehow need to extract only the common fields from
    both tables in order to be able to perform a meaningful comparison.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s re-create our tables in order to generate some mis-matching columns so
    that we can then demonstrate how to deal with these cases:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Now our new tables have only three columns in common, namely `first_name`, `last_name`
    and `is_active`.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'Now if we attempt to run the query we executed in the previous section where
    the two tables were having the same columns, we will end up with this error:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'This is absolutely normal given that our tables no longer have matching columns.
    We need to slightly amend our initial query such that the very first CTEs will
    only select the mutual columns for every table. Our query will look as below:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'The tables created in this section were having the following mismatches (when
    considering only their mutual columns):'
  prefs: []
  type: TYPE_NORMAL
- en: The record for `Maria Brown` has differences in column `is_active`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Table `tableB` has one additional record (`John Down`) which is not present
    in `tableA`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'These differences can be observed in query results shared below:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: Final Thoughts
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this article, we provided a comprehensive guide on how to compare tables
    in BigQuery. We highlighted the importance of this task in ensuring the accuracy
    and consistency of data and demonstrated multiple techniques for comparing tables
    with identical columns as well as tables with different amounts of columns. We
    also walked through the process of extracting records that differ between tables
    (if any).
  prefs: []
  type: TYPE_NORMAL
- en: Overall, this article aimed to equip readers with the necessary tools and knowledge
    to effectively and efficiently compare tables in BigQuery. I hope you found it
    useful!
  prefs: []
  type: TYPE_NORMAL
- en: '[**Become a member**](https://gmyrianthous.medium.com/membership) **and read
    every story on Medium. Your membership fee directly supports me and other writers
    you read. You’ll also get full access to every story on Medium.**'
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://gmyrianthous.medium.com/membership?source=post_page-----1419ff1b3a2c--------------------------------)
    [## Join Medium with my referral link — Giorgos Myrianthous'
  prefs: []
  type: TYPE_NORMAL
- en: As a Medium member, a portion of your membership fee goes to writers you read,
    and you get full access to every story…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: gmyrianthous.medium.com](https://gmyrianthous.medium.com/membership?source=post_page-----1419ff1b3a2c--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: '**Related articles you may also like**'
  prefs: []
  type: TYPE_NORMAL
- en: '[](/etl-vs-elt-68e221d78719?source=post_page-----1419ff1b3a2c--------------------------------)
    [## ETL vs ELT: What’s the Difference?'
  prefs: []
  type: TYPE_NORMAL
- en: A comparison between ETL and ELT in the context of Data Engineering
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/etl-vs-elt-68e221d78719?source=post_page-----1419ff1b3a2c--------------------------------)
    [](/dbt-55b35c974533?source=post_page-----1419ff1b3a2c--------------------------------)
    [## What is dbt (data build tool)
  prefs: []
  type: TYPE_NORMAL
- en: A gentle introduction to dbt that is taking over the data world
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/dbt-55b35c974533?source=post_page-----1419ff1b3a2c--------------------------------)
  prefs: []
  type: TYPE_NORMAL
