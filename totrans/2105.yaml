- en: 'Time Series for Climate Change: Solar Irradiance Forecasting'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/time-series-for-climate-change-solar-irradiance-forecasting-a972dac7418f](https://towardsdatascience.com/time-series-for-climate-change-solar-irradiance-forecasting-a972dac7418f)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: How to use time series analysis and forecasting to tackle climate change
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://vcerq.medium.com/?source=post_page-----a972dac7418f--------------------------------)[![Vitor
    Cerqueira](../Images/9e52f462c6bc20453d3ea273eb52114b.png)](https://vcerq.medium.com/?source=post_page-----a972dac7418f--------------------------------)[](https://towardsdatascience.com/?source=post_page-----a972dac7418f--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----a972dac7418f--------------------------------)
    [Vitor Cerqueira](https://vcerq.medium.com/?source=post_page-----a972dac7418f--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----a972dac7418f--------------------------------)
    ·8 min read·Apr 5, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8cb4875f364354ea926c19d6ebf8674d.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Andrey Grinkevich](https://unsplash.com/@grin?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: 'This is Part 2 of the series *Time Series for Climate Change.* List of articles:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Part 1: [Forecasting Wind Power](/time-series-for-climate-change-forecasting-wind-power-8ed6d653a255)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Solar Power Systems
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Solar power is an increasingly prevalent source of clean energy.
  prefs: []
  type: TYPE_NORMAL
- en: Sunlight is converted into electricity by photovoltaic devices. Since these
    devices are not pollutants, they are considered a source of clean energy. Besides
    environmental benefits, solar power is also appealing due to its low cost. The
    initial investment is large, but the low long-term costs are worthwhile.
  prefs: []
  type: TYPE_NORMAL
- en: The amount of energy produced is determined by the level of solar radiation.
    But, solar conditions can change rapidly. For example, a cloud may unexpectedly
    cover the sun and decrease the efficiency of photovoltaic devices.
  prefs: []
  type: TYPE_NORMAL
- en: So, solar power systems rely on forecasting models to predict solar conditions.
    Like [in the case of wind power](https://medium.com/towards-data-science/time-series-for-climate-change-forecasting-wind-power-8ed6d653a255),
    accurate forecasts have a direct impact on the effectiveness of these systems.
  prefs: []
  type: TYPE_NORMAL
- en: Beyond energy production
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Forecasting solar irradiance has other applications besides energy, for example:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Agriculture: Farmers can leverage forecasts to optimize crop production. Instances
    include estimating when to plant or harvest a crop, or optimizing irrigation systems;'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Civil engineering: Forecasting solar irradiance is also valuable for designing
    and constructing buildings. Predictions can be used to maximize solar radiation,
    thereby reducing heating/cooling costs. Forecasts can also be useful to configure
    air-conditioning systems. This contributes to the efficient use of energy within
    buildings.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Challenges, and what’s next
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Despite its importance, solar conditions are highly variable and difficult to
    predict. These depend on several meteorological factors, whose information is
    sometimes unavailable.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the rest of this article, we’ll develop a model for solar irradiance forecasting.
    Among other things, you’ll learn how to:'
  prefs: []
  type: TYPE_NORMAL
- en: visualize a multivariate time series;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: transform a multivariate time series for supervised learning;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: do feature selection based on correlation and importance scores.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Tutorial: Forecasting Solar Irradiance'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This tutorial is based on a dataset collected by the U.S. Department of Agriculture.
    You can check more details in reference [1]. The full code for this tutorial is
    available on Github:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://github.com/vcerqueira/tsa4climate](https://github.com/vcerqueira/tsa4climate)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The data is a multivariate time series: at each instant, an observation is
    composed of several variables. These include the following weather and hydrological
    variables:'
  prefs: []
  type: TYPE_NORMAL
- en: Solar irradiance (watts per square meter);
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Wind direction;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Snow depth;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Wind speed;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Dew point temperature;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Precipitation;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Vapor pressure;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Relative humidity;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Air temperature.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The series spans from October 1, 2007, to October 1, 2013\. It’s collected at
    an hourly frequency totaling 52.608 observations.
  prefs: []
  type: TYPE_NORMAL
- en: 'After downloading the data, we can read it using pandas:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'This code leads to the following data set:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/43edbf53cb2068dd53777e5d5e83ca07.png)'
  prefs: []
  type: TYPE_IMG
- en: Sample of the multivariate time series
  prefs: []
  type: TYPE_NORMAL
- en: Exploratory data analysis
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](../Images/e4629c8b8d540b7861468340ee9b035d.png)'
  prefs: []
  type: TYPE_IMG
- en: Multivariate time series plot in log-scale. For visualization purposes, the
    series was resampled to a daily frequency. This was done by taking the mean value
    per day. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: The series plot suggests there’s a strong yearly seasonality. Radiation levels
    peak during summertime, and other variables show similar patterns. Apart from
    seasonal fluctuations, the level of the time series is stable over time.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can also visualize the solar irradiance variable individually:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/bd8d7456c63995ee1ee08293c91865c5.png)'
  prefs: []
  type: TYPE_IMG
- en: Daily total solar radiation. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: Besides the clear seasonality, we can also spot some downward spikes around
    the level of the series. These cases need to be predicted timely so that backup
    energy systems are used efficiently.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can also analyze the correlation between each pair of variables:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f2a4244cd0689ea4258ba2624a60acc1.png)'
  prefs: []
  type: TYPE_IMG
- en: Heatmap showing the pairwise correlation. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: Solar irradiance is correlated with some of the variables. For example, air
    temperature, relative humidity (negative correlation), or wind speed.
  prefs: []
  type: TYPE_NORMAL
- en: We’ve explored how to build a forecasting model with a univariate time series
    [in a previous article](/machine-learning-for-forecasting-transformations-and-feature-extraction-bbbea9de0ac2).
    Yet, the correlation heatmap suggests that it may be valuable to include these
    variables in the model.
  prefs: []
  type: TYPE_NORMAL
- en: How can we do that?
  prefs: []
  type: TYPE_NORMAL
- en: Primer on Auto-Regressive Distributed Lags modeling
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Auto-regressive distributed lags (ARDL)](/machine-learning-for-forecasting-supervised-learning-with-multivariate-time-series-b5b5044fe068)
    is a modeling technique for multivariate time series.'
  prefs: []
  type: TYPE_NORMAL
- en: ARDL is a useful approach to identifying the relationship between several variables
    over time. It works by extending the auto-regression technique to multivariate
    data. The future values of a given variable of the series are modeled based on
    its lags and the lags of other variables.
  prefs: []
  type: TYPE_NORMAL
- en: In this case, we want to forecast solar irradiance based on the lags of several
    factors such as air temperature or vapor pressure.
  prefs: []
  type: TYPE_NORMAL
- en: Transforming the data for ARDL
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Applying the ARDL method involves transforming the time series into a tabular
    format. This is done by [applying time delay embedding](https://medium.com/towards-data-science/machine-learning-for-forecasting-transformations-and-feature-extraction-bbbea9de0ac2)
    to each variable, and then concatenating the results into a single matrix. The
    following function can be used to do this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'This function is applied to the data as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: We set the forecasting horizon to 48 hours. Predicting many steps in advance
    is valuable for the effective integration of several energy sources into the electricity
    grid.
  prefs: []
  type: TYPE_NORMAL
- en: It’s difficult to say a priori how many lags should be included. So, this value
    is set to 24 for each variable. This leads to a total of 216 lag-based features.
  prefs: []
  type: TYPE_NORMAL
- en: Building a forecasting model
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before building a model, we extract 8 more features based on the date and time.
    These include data such as the day of the year or hour which are useful to model
    seasonality.
  prefs: []
  type: TYPE_NORMAL
- en: We reduce the number of explanatory variables with feature selection. First,
    we apply a correlation filter. This is used to remove any feature with a correlation
    greater than 95% with any other explanatory variable. Then, we also apply recursive
    feature elimination (RFE) based on the importance scores of a Random Forest. After
    feature engineering, we train a model using a Random Forest.
  prefs: []
  type: TYPE_NORMAL
- en: 'We leverage sklearn’s *Pipeline* and *RandomSearchCV* to optimize the parameters
    of the different steps:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Evaluating the model
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We selected a model using a random search coupled with [a validation split](https://medium.com/@vcerq/9-techniques-for-cross-validating-time-series-data-7828fc3f781d).
    Now, we can evaluate its forecasting performance on the test set.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'The selected model kept only 65 out of the original 224 explanatory variables.
    Here’s the importance of the top 20 features:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/471bdbe1b1450e22f64699c66f950d52.png)'
  prefs: []
  type: TYPE_IMG
- en: Importance of each feature in the model. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: The features hour of the day and day of the year are among the top 4 features.
    This result highlights the strength of seasonal effects in the data. Besides those,
    the first lags of some of the variables are also useful to the model.
  prefs: []
  type: TYPE_NORMAL
- en: Key Takeaways
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Solar power is a relevant source of clean energy that depends on solar radiation;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Forecasting solar irradiance is an important aspect of the effective integration
    of solar power in the grid;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Solar irradiance depends on many variables. These are difficult to model or
    may not be readily available;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When these variables are available, they represent a multivariate time series.
    This type of data can be modeled with an ARDL technique;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can estimate the number of lags of each variable with a feature selection
    process.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Thank you for reading, and see you in the next story!
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[1] [Weather, Snow, and Streamflow data from four western juniper-dominated
    Experimental Catchments in south western Idaho, USA.](https://data.nal.usda.gov/dataset/data-weather-snow-and-streamflow-data-four-western-juniper-dominated-experimental-catchments-south-western-idaho-usa)
    (Licence: U.S. Public Domain)'
  prefs: []
  type: TYPE_NORMAL
- en: '[2] Rolnick, David, et al. “Tackling climate change with machine learning.”
    *ACM Computing Surveys (CSUR)* 55.2 (2022): 1–96.'
  prefs: []
  type: TYPE_NORMAL
