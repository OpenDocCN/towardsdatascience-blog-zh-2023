- en: Quickly Evaluate your RAG Without Manually Labeling Test Data
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¿«é€Ÿè¯„ä¼°ä½ çš„ RAGï¼Œæ— éœ€æ‰‹åŠ¨æ ‡æ³¨æµ‹è¯•æ•°æ®
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/quickly-evaluate-your-rag-without-manually-labeling-test-data-43ade0ae187a](https://towardsdatascience.com/quickly-evaluate-your-rag-without-manually-labeling-test-data-43ade0ae187a)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/quickly-evaluate-your-rag-without-manually-labeling-test-data-43ade0ae187a](https://towardsdatascience.com/quickly-evaluate-your-rag-without-manually-labeling-test-data-43ade0ae187a)
- en: Automate the evaluation process of your Retrieval Augment Generation apps without
    any manual intervention
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è‡ªåŠ¨åŒ–è¯„ä¼°ä½ çš„æ£€ç´¢å¢å¼ºç”Ÿæˆåº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ï¼Œæ— éœ€äººå·¥å¹²é¢„
- en: '[](https://ahmedbesbes.medium.com/?source=post_page-----43ade0ae187a--------------------------------)[![Ahmed
    Besbes](../Images/93804d9291439715e578f204b79c9bdd.png)](https://ahmedbesbes.medium.com/?source=post_page-----43ade0ae187a--------------------------------)[](https://towardsdatascience.com/?source=post_page-----43ade0ae187a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----43ade0ae187a--------------------------------)
    [Ahmed Besbes](https://ahmedbesbes.medium.com/?source=post_page-----43ade0ae187a--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://ahmedbesbes.medium.com/?source=post_page-----43ade0ae187a--------------------------------)[![Ahmed
    Besbes](../Images/93804d9291439715e578f204b79c9bdd.png)](https://ahmedbesbes.medium.com/?source=post_page-----43ade0ae187a--------------------------------)[](https://towardsdatascience.com/?source=post_page-----43ade0ae187a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----43ade0ae187a--------------------------------)
    [Ahmed Besbes](https://ahmedbesbes.medium.com/?source=post_page-----43ade0ae187a--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----43ade0ae187a--------------------------------)
    Â·12 min readÂ·Dec 21, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘å¸ƒäº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----43ade0ae187a--------------------------------)
    Â·é˜…è¯»æ—¶é—´ 12 åˆ†é’ŸÂ·2023å¹´12æœˆ21æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/d058a92e9619f69812d1ccfc71bcb537.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d058a92e9619f69812d1ccfc71bcb537.png)'
- en: Image generated by the user
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ç”¨æˆ·ç”Ÿæˆçš„å›¾åƒ
- en: Todayâ€™s topic is evaluating your RAG without manually labeling test data.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: ä»Šå¤©çš„è¯é¢˜æ˜¯å¦‚ä½•åœ¨ä¸æ‰‹åŠ¨æ ‡æ³¨æµ‹è¯•æ•°æ®çš„æƒ…å†µä¸‹è¯„ä¼°ä½ çš„ RAGã€‚
- en: Measuring the performance of your RAG is something you should care about especially
    if youâ€™re building such systems and serving them in production.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: æµ‹é‡ä½ çš„ RAG çš„æ€§èƒ½æ˜¯ä½ åº”è¯¥å…³æ³¨çš„ï¼Œå°¤å…¶æ˜¯å½“ä½ æ­£åœ¨æ„å»ºè¿™äº›ç³»ç»Ÿå¹¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æä¾›æœåŠ¡æ—¶ã€‚
- en: Besides giving you a rough idea of how your application behaves, evaluating
    your RAG also provides quantitative feedback that guides experimentations and
    the appropriate selection of parameters (LLMs, embedding models, chunk size, top
    K, etc.)
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: é™¤äº†è®©ä½ å¤§è‡´äº†è§£åº”ç”¨çš„è¡¨ç°å¤–ï¼Œè¯„ä¼°ä½ çš„ RAG è¿˜æä¾›äº†é‡åŒ–åé¦ˆï¼Œè¿™äº›åé¦ˆæŒ‡å¯¼å®éªŒå’Œå‚æ•°çš„é€‚å½“é€‰æ‹©ï¼ˆå¦‚ LLMsã€åµŒå…¥æ¨¡å‹ã€åˆ†å—å¤§å°ã€top K ç­‰ï¼‰ã€‚
- en: Evaluating your RAG is also important for your client or stakeholders because
    they are ***always*** expecting performance metrics to validate your project.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: è¯„ä¼°ä½ çš„ RAG å¯¹ä½ çš„å®¢æˆ·æˆ–åˆ©ç›Šç›¸å…³è€…ä¹Ÿå¾ˆé‡è¦ï¼Œå› ä¸ºä»–ä»¬***æ€»æ˜¯***æœŸæœ›æœ‰æ€§èƒ½æŒ‡æ ‡æ¥éªŒè¯ä½ çš„é¡¹ç›®ã€‚
- en: 'Less teasing, hereâ€™s what this issue covers:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸å†å–å…³å­ï¼Œè¿™ä¸ªé—®é¢˜æ¶µç›–äº†ä»¥ä¸‹å†…å®¹ï¼š
- en: Automatically generating a synthetic test set from your RAGâ€™s data
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåˆæˆæµ‹è¯•é›†ï¼Œä»ä½ çš„ RAG æ•°æ®ä¸­
- en: Overview of popular RAG metrics
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æµè¡Œçš„ RAG æŒ‡æ ‡æ¦‚è¿°
- en: Computing RAG metrics on the synthetic dataset using the Ragas package
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ Ragas åŒ…åœ¨åˆæˆæ•°æ®é›†ä¸Šè®¡ç®— RAG æŒ‡æ ‡
- en: '*PS: Some sections of this issue are a bit hands-on. They include the necessary
    coding material to implement dataset generation and evaluate the RAG.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '*PS: è¿™ä¸ªé—®é¢˜çš„æŸäº›éƒ¨åˆ†æ˜¯ç¨å¾®åŠ¨æ‰‹çš„ã€‚å®ƒä»¬åŒ…æ‹¬å®ç°æ•°æ®é›†ç”Ÿæˆå’Œè¯„ä¼° RAG æ‰€éœ€çš„ç¼–ç ææ–™ã€‚*'
- en: Everything will also be available in this* [*notebook*](https://colab.research.google.com/drive/1Qr3fUfBvJbDLZ0k6al_axlmFrArlm9-u?usp=drive_link)*.*
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€æœ‰å†…å®¹ä¹Ÿä¼šåœ¨è¿™ä¸ª* [*notebook*](https://colab.research.google.com/drive/1Qr3fUfBvJbDLZ0k6al_axlmFrArlm9-u?usp=drive_link)*ä¸­æä¾›ã€‚*
- en: Letâ€™s have a look ğŸ”
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€èµ·æ¥çœ‹çœ‹ ğŸ”
- en: 1 â€” Generate a synthetic test set ğŸ§ª
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1 â€” ç”Ÿæˆåˆæˆæµ‹è¯•é›† ğŸ§ª
- en: Letâ€™s say youâ€™ve just built a RAG and now want to evaluate its performance.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: å‡è®¾ä½ åˆšåˆšæ„å»ºäº†ä¸€ä¸ª RAGï¼Œç°åœ¨æƒ³è¦è¯„ä¼°å…¶æ€§èƒ½ã€‚
- en: 'To do that, you need an evaluation dataset that has the following columns:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºæ­¤ï¼Œä½ éœ€è¦ä¸€ä¸ªå…·æœ‰ä»¥ä¸‹åˆ—çš„è¯„ä¼°æ•°æ®é›†ï¼š
- en: '**question** (str): to evaluate the RAG on'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**question** (str)ï¼šç”¨æ¥è¯„ä¼° RAG çš„é—®é¢˜'
- en: '**ground_truths** (list): the reference (i.e. true) answers to the questions'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ground_truths** (åˆ—è¡¨)ï¼šé—®é¢˜çš„å‚è€ƒï¼ˆå³çœŸå®ï¼‰ç­”æ¡ˆ'
- en: '**answer** (str): the answers predicted by the RAG'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**answer** (str)ï¼šRAG é¢„æµ‹çš„ç­”æ¡ˆ'
- en: '**contexts** (list): the list of relevant contexts the RAG used for each question
    to generate the answer'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**contexts** (åˆ—è¡¨)ï¼šRAG ç”¨äºæ¯ä¸ªé—®é¢˜ç”Ÿæˆç­”æ¡ˆçš„ç›¸å…³ä¸Šä¸‹æ–‡åˆ—è¡¨'
- en: '***â†’ the first two columns represent ground-truth data and the last two columns
    represent the RAG predictions.***'
  id: totrans-26
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '***â†’ å‰ä¸¤åˆ—è¡¨ç¤ºçœŸå®æ•°æ®ï¼Œåä¸¤åˆ—è¡¨ç¤º RAG é¢„æµ‹ã€‚***'
- en: '![](../Images/103ca833aac503a2d0c58bce1f8c30b8.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/103ca833aac503a2d0c58bce1f8c30b8.png)'
- en: Screenshot by the author
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„æˆªå›¾
- en: To build such a dataset, we first need to generate tuples of questions and corresponding
    answers.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: è¦æ„å»ºè¿™æ ·çš„æ•°æ®é›†ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç”Ÿæˆé—®é¢˜å’Œç›¸åº”ç­”æ¡ˆçš„å…ƒç»„ã€‚
- en: Then, in the next step, we need to run the RAG over these questions to make
    the predictions.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œåœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¿™äº›é—®é¢˜è¿è¡Œ RAG ä»¥è¿›è¡Œé¢„æµ‹ã€‚
- en: ğŸ‘‰ Generate questions and ground-truth answers (the theory)
  id: totrans-31
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ğŸ‘‰ ç”Ÿæˆé—®é¢˜å’ŒçœŸå®ç­”æ¡ˆï¼ˆç†è®ºï¼‰
- en: To generate tuples of (question, answer), we first need to prepare the RAG data,
    split it into chunks, and embed it into a vector database.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†ç”Ÿæˆ (é—®é¢˜, ç­”æ¡ˆ) çš„å…ƒç»„ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å‡†å¤‡ RAG æ•°æ®ï¼Œå°†å…¶æ‹†åˆ†æˆå—ï¼Œå¹¶åµŒå…¥åˆ°å‘é‡æ•°æ®åº“ä¸­ã€‚
- en: Once the splits are created and embedded, we will instruct an LLM to generate
    `N_q` questions from `N_c` topics to finally obtain `N_q x N_c` tuples of questions
    and answers.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æ‹†åˆ†å®Œæˆå¹¶åµŒå…¥ï¼Œæˆ‘ä»¬å°†æŒ‡ç¤ºä¸€ä¸ª LLM ä» `N_c` ä¸ªä¸»é¢˜ä¸­ç”Ÿæˆ `N_q` ä¸ªé—®é¢˜ï¼Œæœ€ç»ˆå¾—åˆ° `N_q x N_c` ä¸ªé—®é¢˜å’Œç­”æ¡ˆçš„å…ƒç»„ã€‚
- en: 'To generate questions and answers from a given context, we need to go through
    the following steps:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†ä»ç»™å®šä¸Šä¸‹æ–‡ä¸­ç”Ÿæˆé—®é¢˜å’Œç­”æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š
- en: Sample a random split and use it as a root context
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: éšæœºæŠ½å–ä¸€ä¸ªæ‹†åˆ†ï¼Œå¹¶å°†å…¶ç”¨ä½œæ ¹ä¸Šä¸‹æ–‡
- en: Fetch K similar contexts from the vector database
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä»å‘é‡æ•°æ®åº“ä¸­æå– K ä¸ªç›¸ä¼¼ä¸Šä¸‹æ–‡
- en: Concatenate the texts of the root context with its K neighbors to build a larger
    context
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å°†æ ¹ä¸Šä¸‹æ–‡çš„æ–‡æœ¬ä¸å…¶ K ä¸ªé‚»å±…è¿æ¥èµ·æ¥ï¼Œä»¥æ„å»ºæ›´å¤§çš„ä¸Šä¸‹æ–‡
- en: Use the large `context` and `num_questions` in the following prompt template
    to generate questions and answers
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ä¸‹åˆ—æç¤ºæ¨¡æ¿ä¸­çš„å¤§ `context` å’Œ `num_questions` ç”Ÿæˆé—®é¢˜å’Œç­”æ¡ˆ
- en: '[PRE0]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Then, repeat steps 1 to 4 `N_c` times to vary the context each time and generate
    different questions
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œé‡å¤æ­¥éª¤ 1 åˆ° 4 `N_c` æ¬¡ï¼Œä»¥æ¯æ¬¡å˜åŒ–ä¸Šä¸‹æ–‡å¹¶ç”Ÿæˆä¸åŒçš„é—®é¢˜
- en: Iâ€™ve used this workflow to produce questions and answers on Python programming
    and hereâ€™s a sample of the results I got.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å·²ç»ä½¿ç”¨è¿™ä¸ªå·¥ä½œæµæ¥ç”Ÿæˆ Python ç¼–ç¨‹ç›¸å…³çš„é—®é¢˜å’Œç­”æ¡ˆï¼Œä»¥ä¸‹æ˜¯æˆ‘å¾—åˆ°çš„ä¸€äº›ç»“æœç¤ºä¾‹ã€‚
- en: '[PRE1]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: ğŸ‘‰ Now the coding part ğŸ’»
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ğŸ‘‰ ç°åœ¨æ˜¯ç¼–ç éƒ¨åˆ† ğŸ’»
- en: Letâ€™s first start by building a vectorstore that includes the data used by the
    RAG.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬é¦–å…ˆä»æ„å»ºä¸€ä¸ªåŒ…å« RAG ä½¿ç”¨æ•°æ®çš„ vectorstore å¼€å§‹ã€‚
- en: We can load that from Wikipedia (but if you have any interesting PDF on Python
    programming, you can load that too)
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥ä»ç»´åŸºç™¾ç§‘åŠ è½½è¿™äº›ï¼ˆä½†å¦‚æœä½ æœ‰ä»»ä½•æœ‰è¶£çš„ Python ç¼–ç¨‹ PDFï¼Œä½ ä¹Ÿå¯ä»¥åŠ è½½ï¼‰
- en: '[PRE2]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: After loading the data, we split it into chunks.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: åŠ è½½æ•°æ®åï¼Œæˆ‘ä»¬å°†å…¶æ‹†åˆ†æˆå—ã€‚
- en: '[PRE3]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Then, we create an index in Pinecone:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬åœ¨ Pinecone ä¸­åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼š
- en: '[PRE4]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: and use a LangChain wrapper to index the splitsâ€™ embeddings in it.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¶ä½¿ç”¨ LangChain åŒ…è£…å™¨æ¥å¯¹æ‹†åˆ†çš„åµŒå…¥è¿›è¡Œç´¢å¼•ã€‚
- en: '[PRE5]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Now comes the interesting part: generating the synthetic dataset.'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨è¿›å…¥æœ‰è¶£çš„éƒ¨åˆ†ï¼šç”Ÿæˆåˆæˆæ•°æ®é›†ã€‚
- en: To do that, we initialize an object from a `TestsetGenerator` class using an
    LLM, the document splits, an embedding model, and the name of the Pinecone index.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ LLMã€æ–‡æ¡£æ‹†åˆ†ã€åµŒå…¥æ¨¡å‹å’Œ Pinecone ç´¢å¼•åç§°åˆå§‹åŒ–ä¸€ä¸ª `TestsetGenerator` ç±»çš„å¯¹è±¡ã€‚
- en: '[PRE6]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Then, we call the `generate` method by passing two parameters:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ä¼ é€’ä¸¤ä¸ªå‚æ•°æ¥è°ƒç”¨ `generate` æ–¹æ³•ï¼š
- en: '[PRE7]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'This produces this following dataframe:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¼šç”Ÿæˆä»¥ä¸‹æ•°æ®æ¡†ï¼š
- en: '[PRE8]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Pretty simple, right?
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿ
- en: '**If youâ€™re interested in the implementation details, you can find them in
    the** [**notebook**](https://colab.research.google.com/drive/1Qr3fUfBvJbDLZ0k6al_axlmFrArlm9-u?usp=drive_link)**.**'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '**å¦‚æœä½ å¯¹å®ç°ç»†èŠ‚æ„Ÿå…´è¶£ï¼Œå¯ä»¥åœ¨** [**notebook**](https://colab.research.google.com/drive/1Qr3fUfBvJbDLZ0k6al_axlmFrArlm9-u?usp=drive_link)**
    ä¸­æ‰¾åˆ°å®ƒä»¬ã€‚**'
- en: Weâ€™ll only be halfway through it. Now, we need to use the RAG to predict the
    answers for each question and provide the context list used to ground the response.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™åªæ˜¯å…¶ä¸­çš„ä¸€åŠã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ RAG æ¥é¢„æµ‹æ¯ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œå¹¶æä¾›ç”¨äºç”Ÿæˆå“åº”çš„ä¸Šä¸‹æ–‡åˆ—è¡¨ã€‚
- en: 'The RAG is defined in a RAG class, so letâ€™s initialize it first:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: RAG å®šä¹‰åœ¨ RAG ç±»ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦åˆå§‹åŒ–å®ƒï¼š
- en: '[PRE9]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Then, we iterate over the synthetic dataset by calling the `predict` method
    over each question and collect the predictions.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡å¯¹æ¯ä¸ªé—®é¢˜è°ƒç”¨ `predict` æ–¹æ³•æ¥è¿­ä»£åˆæˆæ•°æ®é›†ï¼Œå¹¶æ”¶é›†é¢„æµ‹ç»“æœã€‚
- en: '[PRE10]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'and hereâ€™s what the final result looks like:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹é¢æ˜¯æœ€ç»ˆç»“æœçš„æ ·å­ï¼š
- en: '[PRE11]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: ğŸ† Congratulations if youâ€™ve made it this far, now youâ€™re ready to evaluate your
    RAG.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ† æ­å–œä½ å®Œæˆåˆ°è¿™ä¸€æ­¥ï¼Œç°åœ¨ä½ å‡†å¤‡å¥½è¯„ä¼°ä½ çš„ RAG äº†ã€‚
- en: 2 â€” Popular RAG metrics ğŸ“Š
  id: totrans-70
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2 â€” æµè¡Œçš„ RAG æŒ‡æ ‡ ğŸ“Š
- en: Before jumping into the code, letâ€™s cover the **four** basic metrics weâ€™ll use
    to evaluate our RAG.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è·³å…¥ä»£ç ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹ç”¨äºè¯„ä¼° RAG çš„ **å››** ä¸ªåŸºæœ¬æŒ‡æ ‡ã€‚
- en: Each metric examines a different facet. Therefore, when evaluating your application,
    it is crucial to consider multiple metrics for a comprehensive perspective.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯ä¸ªæŒ‡æ ‡è€ƒå¯Ÿäº†ä¸åŒçš„æ–¹é¢ã€‚å› æ­¤ï¼Œåœ¨è¯„ä¼°ä½ çš„åº”ç”¨æ—¶ï¼Œè€ƒè™‘å¤šä¸ªæŒ‡æ ‡ä»¥è·å¾—å…¨é¢çš„è§†è§’è‡³å…³é‡è¦ã€‚
- en: '**1 â€” Answer Relevancy**:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '**1 â€” ç­”æ¡ˆç›¸å…³æ€§**ï¼š'
- en: The answer relevance metric is designed to **evaluate the pertinence of the
    generated answer with the provided prompt**. Answers that lack completeness or
    include redundant information receive lower scores. This metric utilizes both
    the question and the answer, generating values between 0 and 1\. Higher scores
    signify better relevance.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: ç­”æ¡ˆç›¸å…³æ€§æŒ‡æ ‡æ—¨åœ¨**è¯„ä¼°ç”Ÿæˆç­”æ¡ˆä¸æä¾›çš„æç¤ºçš„ç›¸å…³æ€§**ã€‚ç¼ºä¹å®Œæ•´æ€§æˆ–åŒ…å«å†—ä½™ä¿¡æ¯çš„ç­”æ¡ˆä¼šè·å¾—è¾ƒä½çš„åˆ†æ•°ã€‚è¯¥æŒ‡æ ‡åˆ©ç”¨é—®é¢˜å’Œç­”æ¡ˆï¼Œç”Ÿæˆ0åˆ°1ä¹‹é—´çš„å€¼ã€‚å¾—åˆ†è¶Šé«˜ï¼Œç›¸å…³æ€§è¶Šå¥½ã€‚
- en: '**Example**'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '**ç¤ºä¾‹**'
- en: 'â“*Question: What are the key features of a healthy diet?*'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: â“*é—®é¢˜ï¼šå¥åº·é¥®é£Ÿçš„å…³é”®ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ*
- en: 'â¬‡ï¸ *Low relevance answer*: A healthy diet is important for overall well-being.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: â¬‡ï¸ *ä½ç›¸å…³æ€§ç­”æ¡ˆ*ï¼šå¥åº·é¥®é£Ÿå¯¹æ•´ä½“å¥åº·éå¸¸é‡è¦ã€‚
- en: 'â¬†ï¸ *High relevance answer*: A healthy diet should include a variety of fruits,
    vegetables, whole grains, lean proteins, and dairy products, providing essential
    nutrients for optimal health.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: â¬†ï¸ *é«˜ç›¸å…³æ€§ç­”æ¡ˆ*ï¼šå¥åº·é¥®é£Ÿåº”åŒ…æ‹¬å¤šç§æ°´æœã€è”¬èœã€å…¨è°·ç‰©ã€ç˜¦è›‹ç™½å’Œä¹³åˆ¶å“ï¼Œæä¾›å¿…éœ€çš„è¥å…»ç´ ä»¥ä¿ƒè¿›æœ€ä½³å¥åº·ã€‚
- en: '**2 â€” Faithfulness**'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '**2 â€” å‡†ç¡®æ€§**'
- en: This metric evaluates **the factual consistency of the generated answer within
    the provided context**. The calculation involves both the answer and the retrieved
    context, with the answer scaled to a range between 0 and 1, where higher values
    indicate better faithfulness.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: è¯¥æŒ‡æ ‡è¯„ä¼°**ç”Ÿæˆç­”æ¡ˆåœ¨æä¾›çš„ä¸Šä¸‹æ–‡ä¸­çš„äº‹å®ä¸€è‡´æ€§**ã€‚è®¡ç®—æ¶‰åŠç­”æ¡ˆå’Œæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ï¼Œç­”æ¡ˆçš„è¯„åˆ†èŒƒå›´åœ¨0åˆ°1ä¹‹é—´ï¼Œå¾—åˆ†è¶Šé«˜è¡¨ç¤ºä¸€è‡´æ€§è¶Šå¥½ã€‚
- en: For an answer to be deemed faithful, all claims made in the response must be
    inferable from the given context.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†ä½¿ç­”æ¡ˆè¢«è®¤ä¸ºæ˜¯å‡†ç¡®çš„ï¼Œå›ç­”ä¸­æå‡ºçš„æ‰€æœ‰ä¸»å¼ å¿…é¡»å¯ä»¥ä»ç»™å®šçš„ä¸Šä¸‹æ–‡ä¸­æ¨æ–­å‡ºæ¥ã€‚
- en: '**Example:**'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '**ç¤ºä¾‹ï¼š**'
- en: 'â“*Question: What are the main accomplishments of Marie Curie?*'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: â“*é—®é¢˜ï¼šç›ä¸½Â·å±…é‡Œçš„ä¸»è¦æˆå°±æ˜¯ä»€ä¹ˆï¼Ÿ*
- en: 'ğŸ“‘ *Context*: Marie Curie (1867â€“1934) was a pioneering physicist and chemist,
    the first woman to win a Nobel Prize and the only woman to win Nobel Prizes in
    two different fields.'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ“‘ *ä¸Šä¸‹æ–‡*ï¼šç›ä¸½Â·å±…é‡Œï¼ˆ1867â€“1934ï¼‰æ˜¯å¼€åˆ›æ€§çš„ç‰©ç†å­¦å®¶å’ŒåŒ–å­¦å®¶ï¼Œç¬¬ä¸€ä½è·å¾—è¯ºè´å°”å¥–çš„å¥³æ€§ï¼Œä¹Ÿæ˜¯å”¯ä¸€ä¸€ä½åœ¨ä¸¤ä¸ªä¸åŒé¢†åŸŸè·å¾—è¯ºè´å°”å¥–çš„å¥³æ€§ã€‚
- en: 'â¬†ï¸ *High faithfulness answer*: Marie Curie won Nobel Prizes in both physics
    and chemistry, making her the first woman to achieve this feat.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: â¬†ï¸ *é«˜å‡†ç¡®æ€§ç­”æ¡ˆ*ï¼šç›ä¸½Â·å±…é‡Œè·å¾—äº†ç‰©ç†å­¦å’ŒåŒ–å­¦ä¸¤é¡¹è¯ºè´å°”å¥–ï¼Œä½¿å¥¹æˆä¸ºé¦–ä½å®ç°è¿™ä¸€æˆå°±çš„å¥³æ€§ã€‚
- en: â¬‡ï¸ *Low faithfulness answer:* Marie Curie won Nobel Prizes only in physics.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: â¬‡ï¸ *ä½å‡†ç¡®æ€§ç­”æ¡ˆ*ï¼šç›ä¸½Â·å±…é‡Œä»…è·å¾—äº†ç‰©ç†å­¦æ–¹é¢çš„è¯ºè´å°”å¥–ã€‚
- en: '**3 â€” Context precision**'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '**3 â€” ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦**'
- en: Context Precision is a metric that evaluates whether all of the ground-truth
    relevant items present in the `contexts` are ranked higher or not. Ideally, all
    the relevant chunks must appear at the top ranks. This metric is computed using
    the `question` and the `contexts`, with values ranging between 0 and 1, where
    higher scores indicate better precision.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦æ˜¯ä¸€ä¸ªæŒ‡æ ‡ï¼Œè¯„ä¼°`ä¸Šä¸‹æ–‡`ä¸­æ‰€æœ‰çœŸå®ç›¸å…³æ¡ç›®æ˜¯å¦éƒ½è¢«æ’åœ¨æ›´é«˜çš„ä½ç½®ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç›¸å…³ç‰‡æ®µåº”å‡ºç°åœ¨æ’åé å‰çš„ä½ç½®ã€‚è¯¥æŒ‡æ ‡ä½¿ç”¨`é—®é¢˜`å’Œ`ä¸Šä¸‹æ–‡`è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ†èŒƒå›´åœ¨0åˆ°1ä¹‹é—´ï¼Œå¾—åˆ†è¶Šé«˜è¡¨ç¤ºç²¾ç¡®åº¦è¶Šå¥½ã€‚
- en: '**4 â€” Answer correctness**'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: '**4 â€” ç­”æ¡ˆå‡†ç¡®æ€§**'
- en: This metric measures the accuracy of the generated answer in comparison to the
    ground truth. This assessment utilizes both the ground truth and the answer, assigning
    scores within the 0 to 1 range. A higher score indicates a more accurate alignment
    between the generated answer and the ground truth, indicative of superior correctness.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: è¯¥æŒ‡æ ‡è¡¡é‡ç”Ÿæˆç­”æ¡ˆä¸çœŸå®ç­”æ¡ˆä¹‹é—´çš„å‡†ç¡®æ€§ã€‚è¿™é¡¹è¯„ä¼°åˆ©ç”¨çœŸå®ç­”æ¡ˆå’Œç”Ÿæˆç­”æ¡ˆï¼Œå¹¶åœ¨0åˆ°1çš„èŒƒå›´å†…è¿›è¡Œè¯„åˆ†ã€‚å¾—åˆ†è¶Šé«˜ï¼Œè¡¨æ˜ç”Ÿæˆçš„ç­”æ¡ˆä¸çœŸå®ç­”æ¡ˆä¹‹é—´çš„å¯¹é½è¶Šå‡†ç¡®ï¼Œè¡¨ç¤ºæ›´é«˜çš„æ­£ç¡®æ€§ã€‚
- en: '**Example:**'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '**ç¤ºä¾‹ï¼š**'
- en: 'ğŸŸ¢ *Ground Truth: The Eiffel Tower was completed in 1889 in Paris, France.*'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸŸ¢ *çœŸå®ç­”æ¡ˆï¼šåŸƒè²å°”é“å¡”äº1889å¹´åœ¨æ³•å›½å·´é»ç«£å·¥ã€‚*
- en: 'â¬†ï¸ *High answer correctness*: The construction of the Eiffel Tower concluded
    in 1889 in Paris, France.'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: â¬†ï¸ *é«˜å‡†ç¡®æ€§ç­”æ¡ˆ*ï¼šåŸƒè²å°”é“å¡”çš„å»ºè®¾äº1889å¹´åœ¨æ³•å›½å·´é»å®Œæˆã€‚
- en: 'â¬‡ï¸ *Low answer correctness*: Completed in 1889, the Eiffel Tower stands in
    London, England.'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: â¬‡ï¸ *ä½å‡†ç¡®æ€§ç­”æ¡ˆ*ï¼šåŸƒè²å°”é“å¡”äº1889å¹´ç«£å·¥ï¼Œä½äºè‹±å›½ä¼¦æ•¦ã€‚
- en: 3 â€” Evaluate RAGs with RAGAS ğŸ“
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 3 â€” ä½¿ç”¨RAGASè¯„ä¼°RAG ğŸ“
- en: To evaluate the RAG and compute the four metrics, we can use [Ragas](https://github.com/explodinggradients/ragas).
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†è¯„ä¼°RAGå¹¶è®¡ç®—å››ä¸ªæŒ‡æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨[Ragas](https://github.com/explodinggradients/ragas)ã€‚
- en: Ragas (for Rag Assessment), is a framework that helps you evaluate your Retrieval
    Augmented Generation (RAG) pipelines.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: Ragasï¼ˆç”¨äºRagè¯„ä¼°ï¼‰æ˜¯ä¸€ä¸ªå¸®åŠ©ä½ è¯„ä¼°æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç®¡é“çš„æ¡†æ¶ã€‚
- en: It also provides a bunch of [metrics](https://docs.ragas.io/en/latest/concepts/metrics/index.html)
    and utility [functions](https://docs.ragas.io/en/latest/concepts/testset_generation.html)
    to generate synthetic datasets.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒè¿˜æä¾›äº†ä¸€äº›[æŒ‡æ ‡](https://docs.ragas.io/en/latest/concepts/metrics/index.html)å’Œå®ç”¨çš„[å‡½æ•°](https://docs.ragas.io/en/latest/concepts/testset_generation.html)æ¥ç”Ÿæˆåˆæˆæ•°æ®é›†ã€‚
- en: To run Ragas over our dataset, you first need to import the metrics and convert
    the dataframe of synthetic data to a Dataset object.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: è¦åœ¨æˆ‘ä»¬çš„æ•°æ®é›†ä¸Šè¿è¡ŒRagasï¼Œä½ é¦–å…ˆéœ€è¦å¯¼å…¥æŒ‡æ ‡å¹¶å°†åˆæˆæ•°æ®çš„æ•°æ®æ¡†è½¬æ¢ä¸ºæ•°æ®é›†å¯¹è±¡ã€‚
- en: '[PRE12]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Then, we need to configure Ragas to use VertexAI LLMs and embeddings.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬éœ€è¦é…ç½®Ragasä»¥ä½¿ç”¨VertexAI LLMså’ŒåµŒå…¥ã€‚
- en: This step is important since Ragas is configured to use OpenAI by default.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œå› ä¸ºRagasé»˜è®¤é…ç½®ä¸ºä½¿ç”¨OpenAIã€‚
- en: '[PRE13]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Finally, we call the `evaluate` function on the synthetic dataset and specifcy
    the metrics we want to compute:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œæˆ‘ä»¬åœ¨åˆæˆæ•°æ®é›†ä¸Šè°ƒç”¨`evaluate`å‡½æ•°ï¼Œå¹¶æŒ‡å®šæˆ‘ä»¬æƒ³è¦è®¡ç®—çš„æŒ‡æ ‡ï¼š
- en: '[PRE14]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Once the evaluation is done, you can print the result directly.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: è¯„ä¼°å®Œæˆåï¼Œä½ å¯ä»¥ç›´æ¥æ‰“å°ç»“æœã€‚
- en: '[PRE15]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: or you can convert it to a dataframe to inspect each of these metrics for every
    question.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ–è€…ä½ å¯ä»¥å°†å…¶è½¬æ¢ä¸ºæ•°æ®æ¡†ï¼Œä»¥æ£€æŸ¥æ¯ä¸ªé—®é¢˜çš„è¿™äº›æŒ‡æ ‡ã€‚
- en: '[PRE16]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Conclusion
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: Generating a synthetic dataset to evaluate your RAG is a good start, especially
    when you donâ€™t have access to labeled data.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: ç”Ÿæˆä¸€ä¸ªåˆæˆæ•°æ®é›†ä»¥è¯„ä¼°ä½ çš„RAGæ˜¯ä¸€ä¸ªå¥½çš„å¼€å§‹ï¼Œç‰¹åˆ«æ˜¯å½“ä½ æ²¡æœ‰è®¿é—®æ ‡æ³¨æ•°æ®æ—¶ã€‚
- en: However, this solution also comes with its problems.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆä¹Ÿæœ‰å…¶é—®é¢˜ã€‚
- en: 'Some of the generated answers:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€äº›ç”Ÿæˆçš„ç­”æ¡ˆï¼š
- en: May lack diversity
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¯èƒ½ç¼ºä¹å¤šæ ·æ€§
- en: Are redundant
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ˜¯å†—ä½™çš„
- en: Are plain rephrasing of the original text and need more complexity to reflect
    real questions that need reasoning
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åªæ˜¯å¯¹åŸå§‹æ–‡æœ¬çš„ç®€å•æ”¹è¿°ï¼Œéœ€è¦æ›´å¤šçš„å¤æ‚æ€§æ¥åæ˜ éœ€è¦æ¨ç†çš„å®é™…é—®é¢˜
- en: Can be too generic (especially in very technical domains)
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¯èƒ½è¿‡äºç¬¼ç»Ÿï¼ˆå°¤å…¶æ˜¯åœ¨éå¸¸æŠ€æœ¯æ€§çš„é¢†åŸŸï¼‰
- en: To tackle these issues, you can adjust and tune your prompts, filter irrelevant
    questions, create synthetic questions on specific topics, and use Ragas for dataset
    generation.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†åº”å¯¹è¿™äº›é—®é¢˜ï¼Œä½ å¯ä»¥è°ƒæ•´å’Œè°ƒæ•´ä½ çš„æç¤ºï¼Œè¿‡æ»¤æ— å…³çš„é—®é¢˜ï¼Œåˆ›å»ºç‰¹å®šä¸»é¢˜çš„åˆæˆé—®é¢˜ï¼Œå¹¶ä½¿ç”¨Ragasè¿›è¡Œæ•°æ®é›†ç”Ÿæˆã€‚
