- en: Convenient Bayesian Marketing Mix Modeling With PyMC Marketing
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/convenient-bayesian-marketing-mix-modeling-with-pymc-marketing-8b02a9a9c4aa](https://towardsdatascience.com/convenient-bayesian-marketing-mix-modeling-with-pymc-marketing-8b02a9a9c4aa)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[Marketing Analytics](https://medium.com/tag/marketing-analytics)'
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A new and shiny library from the PyMC team worth trying out
  id: totrans-3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://dr-robert-kuebler.medium.com/?source=post_page-----8b02a9a9c4aa--------------------------------)[![Dr.
    Robert Kübler](../Images/3b8d8b88f76c0c43d9c305e3885e7ab9.png)](https://dr-robert-kuebler.medium.com/?source=post_page-----8b02a9a9c4aa--------------------------------)[](https://towardsdatascience.com/?source=post_page-----8b02a9a9c4aa--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----8b02a9a9c4aa--------------------------------)
    [Dr. Robert Kübler](https://dr-robert-kuebler.medium.com/?source=post_page-----8b02a9a9c4aa--------------------------------)'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----8b02a9a9c4aa--------------------------------)
    ·6 min read·Apr 13, 2023
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: --
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f28f4c3f55d755db249a94b0f4d38e6a.png)'
  id: totrans-7
  prefs: []
  type: TYPE_IMG
- en: Photo by [Nathan Fertig](https://unsplash.com/@nathanfertig?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: You can tell the importance of a topic by how many big companies are releasing
    software packages on it. In the field of marketing mix modeling,
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: Google released [LMMM](https://github.com/google/lightweight_mmm)
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Meta released [Robyn](https://github.com/facebookexperimental/Robyn)
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: PyMC Labs released [PyMC Marketing](https://github.com/pymc-labs/pymc-marketing)
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: (and I released [mamimo](https://github.com/Garve/mamimo) 😇)
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Even better than marketing mix modeling is **Bayesian marketing mix modeling,**
    which Google’s and PyMC Labs’ libraries provide. While LMMM is certainly interesting
    as well, today, we will focus on PyMC Marketing.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: In this article, you will learn how easy it is to build a state-of-the-art Bayesian
    marketing mix model nowadays!
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: In case you need a refresher, please check out my old article that tells you
    what Bayesian marketing mix modeling is all about.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: '[](/bayesian-marketing-mix-modeling-in-python-via-pymc3-7b2071f6001a?source=post_page-----8b02a9a9c4aa--------------------------------)
    [## Bayesian Marketing Mix Modeling in Python via PyMC3'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: Estimate the saturation, carryover, and other parameters all at once, including
    their uncertainty
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/bayesian-marketing-mix-modeling-in-python-via-pymc3-7b2071f6001a?source=post_page-----8b02a9a9c4aa--------------------------------)
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: The Manual Process
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In my old article (see above), I coded a Bayesian marketing mix model myself.
    To do this, I needed to define a function for the carryover effect of media spending,
    which was cumbersome. Still using the older PyMC3, it looked like this:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This one works, but it is not easy to parse and may also need to be more efficient.
    Also, using Theano in PyMC is outdated, as I would have to use PyTensor now, a
    fork of Aesara based on Theano. A complicated history, it seems.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: So I am happily relying on more professional and general code now to achieve
    my goals. I learned a lot by checking out how [they implemented the carryover
    effect](https://github.com/pymc-labs/pymc-marketing/blob/main/pymc_marketing/mmm/transformers.py).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: Before continuing, ensure you have the packages pymc and pymc-marketing installed.
    I installed PyMC using mamba as described [in their Github](https://github.com/pymc-labs/pymc-marketing/blob/main/README.md)
    and then installed pymc-marketing via
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: PyMC Marketing
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let us revisit our old example [from my Bayesian marketing mix modeling article](/bayesian-marketing-mix-modeling-in-python-via-pymc3-7b2071f6001a).
    We start by importing a dataset that I synthetically created.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The data looks like this:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/fe62d57d88361767adefea2ec3ab44c7.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
- en: Image by the author.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: Model Definition
  id: totrans-33
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Now, let’s get our star on stage and define the model:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: This creates a model with saturations and carryover effects per channel, similar
    to what I did manually before. That’s why I will not go into detail about how
    this model works from a mathematical perspective.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: 'We can now visualize what we have created:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](../Images/bdea93818a562ae51ac36916380b2896.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
- en: Image by the author.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: Here, we can see that the adstock (carryover) is first applied, then the saturation.
    We have three parameters `alpha`, `beta_channel`, and `lam` per channel, where
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: '`alpha` is the carryover rate that is between 0 and 1,'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`lam` is the saturation rate, and'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`beta_channel` is the actual linear regression coefficient.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To give a bit more context, the abridged model formula is
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/668257542f5ab088715d518f77fd9b21.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
- en: Image by the author.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: where *c* runs over all different channels.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: Model Fit
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Fitting the model is as easy as in scikit-learn:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Model Inference
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'After the model is trained, we can check the parameters as follows:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'I got something like this:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/20cec6e69676cbe3c0142f0cb41d9e1a.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
- en: Image by the author.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: Judging from the 1.0s in the **r_hat** column, we can see that the chains seem
    to have converged just fine, i.e., the results in the rest of the table are reliable.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: We can also check what the model believes are the correct values for all parameters.
    For example, the channel TV carryover `alpha[TV]` is between 0.465 and 0.515 with
    a 94% probability, as seen in the columns **hdi_3% and hdi_97%**. If the model
    had to decide on a single number, it would be 0.49, as you can see in the **mean**
    column.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: '***Note:*** *For creating this dataset, I used saturation values of 0.5 for
    TV, 0.2 for radio, and 0 for banners. Our PyMC model was able to pick this up
    quite decently!*'
  id: totrans-60
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'For the visual folks:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](../Images/cb46bc219af59de89fe6388e40657eb1.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
- en: Image by the author.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: We can even check out the channel contributions using the convenient method
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](../Images/32d0c9b4c1a4d3510e537efab17b72fe.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
- en: Image by the author.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: According to the model, TV is responsible for about 40% of the **additional**
    sales (additional to the base), radio for about 26%, and banners for about 34%.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: Posterior Predictive Check
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We can do a posterior predictive check, i.e., sampling predictions (blue), and
    see how well they follow the model (black).
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](../Images/81511a4824840d75e10859c479c7fdee.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
- en: Image by the author.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: Looks like a good fit! We can even decompose the signal into a baseline and
    the channel contributions via
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](../Images/a466816b1c0b3480dc9196b4e1fb9f14.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
- en: Image by the author.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: 'Insightful, but in addition, it might be helpful to add the following to the
    library as well:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/bbbf4934aa3edcf3e991fecb29a0bd09.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
- en: Image by the author.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: I opened a pull request that is currently still open. You can check it out [here](https://github.com/pymc-labs/pymc-marketing/pull/247).
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: '***Update:*** *It was merged! You can use it with* `[*plot_grouped_contribution_breakdown_over_time*](https://github.com/pymc-labs/pymc-marketing/blob/a59a89c41e7a1166c61ed2ca4293ff792d726622/pymc_marketing/mmm/base.py#L503)`
    *method. Happy to have contributed! 😄*'
  id: totrans-83
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '**Conclusion**'
  id: totrans-84
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Bayesian marketing mix modeling is currently **the** best way to find out which
    of your marketing channels perform well and which don’t. Building such a model
    is not too complicated, but still by far not as straightforward as clicking together
    a scikit-learn model.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
- en: Luckily, the new [PyMC Marketing](https://www.pymc-marketing.io/en/latest/)
    makes Bayesian marketing mix modeling a breeze compared to what we had to manually
    code before.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: Don't get me wrong, I like coding, and it is crucial that **you** know how to
    code it as well. But still, it is nice to have a well-maintained package that
    presumably gets even more common marketing mix model functionalities in the future.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: 'And I only covered **some** of the functionalities. PyMC Marketing can even:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: efficiently deal with control variables by passing a list of columns via the
    `control_columns` into the `DelayedSaturatedMMM` class
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: plot saturation curves via `mmm.plot_contribution_curves()`
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: calculate the ROAS, although it is still manual work.
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For more information, check out [this great notebook](https://www.pymc-marketing.io/en/stable/notebooks/mmm/mmm_example.html)
    by the PyMC people.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: I hope that you learned something new, interesting, and valuable today. Thanks
    for reading!
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: '*If you have any questions, write me on* [*LinkedIn*](https://www.linkedin.com/in/dr-robert-k%C3%BCbler-983859150/)*!*'
  id: totrans-94
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: And if you want to dive deeper into the world of algorithms, give my new publication
    **All About Algorithms** a try! I’m still searching for writers!
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想更深入地探索算法的世界，不妨试试我的新出版物**《所有关于算法》**！我还在寻找作者！
- en: '[](https://medium.com/all-about-algorithms?source=post_page-----8b02a9a9c4aa--------------------------------)
    [## All About Algorithms'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/all-about-algorithms?source=post_page-----8b02a9a9c4aa--------------------------------)
    [## 所有关于算法'
- en: From intuitive explanations to in-depth analysis, algorithms come to life with
    examples, code, and awesome…
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从直观的解释到深入的分析，算法通过实例、代码和精彩的内容变得生动起来……
- en: medium.com](https://medium.com/all-about-algorithms?source=post_page-----8b02a9a9c4aa--------------------------------)
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '[medium.com](https://medium.com/all-about-algorithms?source=post_page-----8b02a9a9c4aa--------------------------------)'
