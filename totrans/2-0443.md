# 建立一个能够识别我手写字的人工智能 — 第一部分

> 原文：[https://towardsdatascience.com/building-an-ai-to-recognize-my-handwriting-part-i-7bef0d3cdc46](https://towardsdatascience.com/building-an-ai-to-recognize-my-handwriting-part-i-7bef0d3cdc46)

## 理论（和实践）的出发点

[](https://jonas-schroeder.medium.com/?source=post_page-----7bef0d3cdc46--------------------------------)[![Jonas Schröder](../Images/2ceb59a8a0de7331311c81c32fcaea06.png)](https://jonas-schroeder.medium.com/?source=post_page-----7bef0d3cdc46--------------------------------)[](https://towardsdatascience.com/?source=post_page-----7bef0d3cdc46--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----7bef0d3cdc46--------------------------------) [Jonas Schröder](https://jonas-schroeder.medium.com/?source=post_page-----7bef0d3cdc46--------------------------------)

·发表于[Towards Data Science](https://towardsdatascience.com/?source=post_page-----7bef0d3cdc46--------------------------------) ·12分钟阅读·2023年4月2日

--

![](../Images/383b2040b10b7cd8b492bb2bf80f1f94.png)

图片由作者提供

大约十年前，受到Tim Ferriss和其他自助书籍作者的启发，我开始定期在笔记本（纸质的那种）上手写。我现在已经填满了10到15本笔记本。把它们数字化岂不是很好吗？

本系列文章记录了我开发一个能够**将我的手写笔记转换为正式纯文本文件**的人工智能的过程。根据我的手写字的样子，这将确实非常具有挑战性。

这第一篇文章，第一部分，将涵盖基础知识。我将首先**进一步解释我的动机**，然后介绍**理论框架**，说明如何可以解决这个问题。

我将简要介绍**卷积神经网络（CNNs）**，这是一种专门为图像识别设计的人工神经网络。之后，我将尝试一种自动化的方式来“识别”我的手写字，目的是避免手动标注和注释我的输入数据。

接下来的部分将更加实用，并实际使用CNNs与训练数据。但我认为这第一部分作为必要的基础是有用的，即使它以令人失望的结局告终。

像我许多的文章一样，**我会在进展中发布，处理尚未知道的挑战**，带领读者一起体验这个过程。

根据我收到的关于[“数据科学家转量化交易”系列](https://medium.com/@jonas-schroeder/data-scientist-turning-quant-i-why-im-becoming-an-algo-trader-28e852f9cfc4)的反馈，我将**将笔记本和文件上传到GitHub**以便更好地跟随。它们可以在这里找到（[GitHub链接](https://github.com/JonasSchroeder/project_handwriting_recognition)），并将定期更新。

我希望你阅读这些内容时能像我创作时那样享受。随时欢迎[联系我](https://www.linkedin.com/in/jonas-schröder-914a338a/)获取更多想法或问题，或者对这篇文章进行评论。

最好，

*乔纳斯*

## 我的动机：一堆个人笔记本

这十年来，我一直在做一种叫做“日记记录”的事情。与传统的“亲爱的日记”式写作不同，这种记录的目的是为了整理对各种事情的思考，而不是每天总结你的一天细节，这些细节通常在下周就变得无关紧要。比如：你现在的状况，你可能去哪里，以及最近你面临的挑战。或者是一般值得注意的经历。对我来说，它有双重目的：**今天能够反思**以及**将思维过程归档以备未来参考**。

无论如何，我喜欢这样做，多年来我完成了大约15本笔记本。对我来说，它们非常宝贵，因为它们记录了我的生活，涵盖了担忧和挑战，以及亮点和改变人生的时刻。我想象着在一两十年后翻阅这些笔记本，充满了怀旧之情。因此，我想保留它们！

目前它们散落在德国的两个不同地方，这增加了在意外火灾中丢失一半的可能性。当然，更可能的威胁是**时间，我们的老敌人**。光盘在25年后会停止工作，而只有上帝知道我的纸质笔记能存活多久。我曾经找到过一些我在学校时写的旧文字。它们已经相当模糊了。

我考虑过将这些内容数字化一段时间了。肯定有服务提供商！然而，由于内容极其个人化，我不想与第三方分享。

作为一名专业的数据科学家，我知道可以建立和训练**我自己的图像识别和OCR模型**的可能性。我理论上知道该怎么做。但我从未做过。

此外，我知道有很多模型已经在手写文字上预训练过，并且我可以针对自己的数据集进行调整。当然，在这种情况下，局部运行它们不会被视为第三方。然而，再次根据我自己的笔迹判断，我很确定目前没有任何系统“足够智能”到能理解我写的内容。

长话短说，这就是我的动力。我的目标很简单：**通过使用AI数字化我多年的工作，同时获取构建OCR系统的实际经验**。

我不想阅读太多关于其他人如何处理这个问题或“你应该做什么”的内容，因为这会妨碍我的学习体验。我预期会在某个时候失败，面临另一个需要解决的挑战。重复。

# 处理流程概述和使用的技术

现在我的动机已经明确，是时候考虑我们实际需要做什么了。简单来说，我期望有一个由三部分组成的流程：预处理、主要处理（CNN）和后处理。

![](../Images/833c6cb4549ce4fc788cd6c9c5b4e85e.png)

作者提供的图像

## 预处理

我需要我的手写图像数据，并以一种提高系统速度和性能指标的方式进行处理。我可以测试和实验不同的方式，例如不同的图像大小或通道数。我将主要使用**OpenCV和Numpy**来预处理数据。第二部分将介绍**LabelImg**，这是我用来创建标注输入数据的开源工具。

## 主要处理

这是魔法发生的地方，在这里，输入图像以浮点数矩阵的形式被转换为一个预测属于某一类别的概率向量。简而言之，输出结果可能类似于“image_1是‘Test’，概率为90%，‘Toast’，概率为10%”。

我将使用各种**卷积神经网络（CNNs）**，这是进行图像识别的首选架构。如果你对CNNs不太熟悉，我将在本文后面简要描述它们的主要属性。我不会使用任何预训练网络，依据我之前的动机，并假设世界上没有人有像我一样难看的手写字。

不过，我不会完全从头开始。我将定义并使用**TensorFlow**和**Keras**来处理神经网络，以及它们所有可用的类和辅助函数。

## 后处理

此时我们将有一个训练好的CNN，能够或多或少地识别我的手写字。然而，这一输出可能需要进一步清理和处理，使用**各种NLP方法**。

例子：系统可能预测一个词为“Tost”，但这个词在德语中并不存在。流程中的另一个模型可能基于相似性将其纠正为“Test”。整个后处理部分在本文及下篇文章中不会涉及，因为我仍然离知道如何实现这一点很远。

关于我期望构建的三部分系统已经讲了很多。由于卷积神经网络（CNNs）在第一部分和第二部分中占据核心地位，我将以一种非常非科学、务实的方式简要介绍卷积神经网络（CNNs）。这个总结主要取自于[Aurélien Géron的《动手机器学习：使用Scikit-Learn、Keras和TensorFlow（第2版）》](https://www.oreilly.com/library/view/hands-on-machine-learning/9781491962282/)，这是我最喜欢的实用机器学习入门书籍。

# 卷积神经网络（CNNs）简短介绍

如果你大致了解什么是人工神经网络（ANNs）及其在分类任务中的工作原理，你将能够很容易地理解接下来的内容。你会在本节末尾找到关于CNN的简短资源列表。

CNN建立在1950年代末期关于我们大脑如何处理视觉输入的研究基础上。这些研究导致了[1981年诺贝尔奖](https://www.nobelprize.org/prizes/medicine/1981/summary/)。研究人员的主要发现是：**许多神经元只对视觉场中小区域的视觉刺激做出反应**。这些领域相互重叠，拼凑成我们所见的整体。此外，两个神经元可能共享相同的感受野，但一个只对水平线做出反应，另一个则对垂直线做出反应。

根据这些发现，计算机科学家开始创建专门为图像识别任务设计的神经网络。1998年，Yann LeCun（现为Meta的首席AI科学家）创建了用于识别手写字符的[LeNet-5](https://en.wikipedia.org/wiki/LeNet)架构。

那么，CNN与其他（深度）神经网络有什么不同？本质上，CNN与标准ANN类似，其中高级别的神经元从低级别的神经元输出中获取输入，以检测数据中的各种模式，随着数据在网络中传播，从简单到复杂。然而，**CNN有两个特殊的构建块，称为卷积层和池化层**。

这些构建块的动机很容易理解。以一个相对较小的图像100px x 100px为例。这意味着有10,000个输入（如果是彩色图像则为30,000）。对于一个具有1,000个神经元的全连接标准ANN，这将转化为10,000,000个连接需要适配。卷积层和池化层只允许部分连接这些层。此外，CNN能够识别图像中出现的各种模式，而标准ANN则在处理偏移图像时会遇到困难。使用这些构建块有很多优点。现在了解更多关于它们的内容。

## 卷积层

根据上述研究人员的想法，卷积层中的神经元仅与其感受野中的像素相连（如果这是第一层），而不是与整个图像相连。在后续层中，神经元仅与小矩形中的输出相连。这是一个简单的想法，但仅用语言很难描述。下面的图像可能会有所帮助。

![](../Images/fff293357945e7f1d58d1fca7db08cbd.png)

由Aphex34 — 自作，CC BY-SA 4.0，[https://commons.wikimedia.org/w/index.php?curid=45679374](https://commons.wikimedia.org/w/index.php?curid=45679374)

这个感受野矩形现在滑动（称为步幅）在图像上，每次输出一个值，从而在下一层减少图像的大小。结果是过滤器，也称为卷积。

![](../Images/205e2cfecf6812685e73ece2e2ec73dd.png)

作者提供的图像

在训练过程中，**CNN将学习最有用的滤波器**，如水平线与垂直线，这些可以被可视化。这些滤波器可能一开始非常简单，但随着数据在网络中进展，它们会被组合成越来越复杂的滤波器。应用于实际图像的滤波器被称为特征图（Feature Maps）（即滤波器和叠加图像的点积），突出显示激活滤波器的像素。

![](../Images/47441d58aa2831032117e46838158199.png)

作者提供的图像

## 池化层

为了进一步减少计算负担，所谓的池化层用于将输入的信息聚合到一个减少的输出中，作为下一个（卷积）层的输入。这个过程也被称为子采样。像卷积层一样，池化层具有有限的感受野，并在输入图像上滑动。然而，步幅通常设置为使得感受野不重叠。

例如，如今常用的最大池化层（Max Pooling Layers）输出其视野内所有神经元的最大值，从而只保留最相关的像素信息。下图可视化了这一点。

![](../Images/3e0fcac1c038243911d252d6ea56f715.png)

由Aphex34创作，CC BY-SA 4.0，[https://commons.wikimedia.org/w/index.php?curid=45673581](https://commons.wikimedia.org/w/index.php?curid=45673581)

池化层可能非常具有破坏性，因为它们丢弃了80-90%的信息。然而，它们也为数据添加了一些不变性，从而减少了对特定但不可泛化的细节的过拟合风险。

## 输出层

池化层通常跟随卷积层，这种模式重复几次，直到输出被展平（从矩阵到向量），以便得到与预期类别一样多的最终输出。例如，如果我们想要分类0到9的手写数字，我们会在最后使用一个具有10个输出的全连接层，以及一个softmax激活函数，如果我们想要预测图像属于十种可能性中的每一种的概率。

在输入“8”的图像之后的最终输出可能是向量[0.2,0,0,0,0,0,0.1,0,0.7,0]，这意味着模型预测“8”的可能性最大，但也可能是“0”有20%以及“6”有10%的概率。根据训练图像，这些手写数字可能非常接近。

就这样，你所需要了解的全部内容就绪。CNNs是一种用于图像识别的特殊人工神经网络。它们使用卷积层学习图像的简单和复杂模式，并使用池化层减少计算负担和过拟合的风险。

当然，CNNs（卷积神经网络）还有更多的内容，它们的输入数据的视觉性质使得它们在视觉上更容易理解。这里有一些进一步的基础资源，帮助你理解CNNs的工作原理。

维基百科：[https://en.wikipedia.org/wiki/Convolutional_neural_network](https://en.wikipedia.org/wiki/Convolutional_neural_network)

Josh Starmer 的（幽默但 nonetheless 高度信息性的）QuestStats: [https://www.youtube.com/watch?v=HGwBXDKFk9I](https://www.youtube.com/watch?v=HGwBXDKFk9I)

如果你仍然觉得不够，3Blue1Brown 的视频深入探讨了卷积是什么以及它们如何在各种应用中使用，例如图像处理（从 8:22 开始）。

# 开始使用我自己的手写文字

在概述了我们需要的技术及其理论工作方式后，现在是时候变得更实际，即开始编码了。你可以在 [我的代码和文件这里](https://github.com/JonasSchroeder/project_handwriting_recognition) 查看。

我开始时在纸上写了一封小信，拍了一张照片，并使用 OpenCV 在我的电脑上读取它。别在意它是德语的。电脑也不会在意（目前还不）。

![](../Images/feecac08d776ea67c3b1c59ec7e9171e.png)

图片由作者提供

先暂时忽略我的实际任务，**我在寻找一种自动检测纸张和墨水的方法**，即检测文本。我的目标是找到一种**以自动化的方式裁剪出单词**的方法，而暂时忽略每个单词的实际含义。

我使用了所谓的行文本分割，通过调整我在这个 [GitHub 笔记本](https://github.com/computervisionpro/yt/blob/main/line-text-segmentation/tutorial20.ipynb) 中找到的代码。简单来说，这个过程旨在**首先识别文本行，然后遍历这些行以识别单词**。

它开始于**对图像进行二值化**，使每个像素可以是 0（黑色）或 1（白色）。类似于池化层的作用，**下一步是膨胀**，在这个步骤中，一个核（即接收域）在图像上滑动，将图像像素替换为该领域中的最大值，然后继续滑动。结果是图像的“生长”部分，因此命名为膨胀。

同样，与通过阅读理解相比，直接看到实际发生的情况更容易。左侧图像显示了我的信件在二值化后的样子，右侧则是经过膨胀处理后的样子。膨胀的效果类似于我们使用文本标记器时的效果。

![](../Images/62777a11af356059d75d1420803a59b6.png)

图片由作者提供

从这一步到线检测只是一个小步骤。我将使用 OpenCV 的 findContours 函数。下方的蓝色框应该标识出我文本所写的行。正如你所见，这在某些部分效果更好。通过循环处理这些行以标记单个单词会生成带有黄色框的图像。

![](../Images/82b0ea62e4440c2b1241c3d3dd83c0a7.png)

这看起来还不错，对吧？然而，它给了我 346 个识别出的单词（而实际上只有 58 个）。**这种方法导致了重复**，在我的图像中出现了相同的识别区域。即使在去除这些明显的重复之后，我仍然剩下 94 个单词。这些是单词的重叠部分，如下例所示。

![](../Images/baccd189fd5afa84ffb886e782472668.png)

图片由作者提供

现在我有了表示单词的信件片段，但大多数时候，我需要大量手动浏览样本以删除无意义的部分。此外，我还需要**创建某种查找表**，说明image_00001.jpg代表“ich”，而image_00002.jpg代表“Dokumente”。

总体而言，在效率方面并没有取得太大进展。我们可能更聪明了，但在实际应用方面尚未取得更大进展。

# 第一部分的总结与结论

我知道，我在这个系列的第一篇文章中以一个难题作为结尾。很抱歉！但通过将这个失败重新解读为挑战，我们将为更加乐观的第二部分奠定基础，我保证！

这段时间并没有浪费。我介绍了我们将用于此任务的核心技术——卷积神经网络（CNNs），它是如何工作的，以及这种网络架构与您之前可能了解的标准架构有何不同。了解你为何进入某个领域，而不仅仅是如何进入，是很重要的。因此，我概述了我的情况和动机。

**目前的主要教训是：** 如果我们想训练一个CNN，我们需要正确标记的输入数据，不能依赖于自动生成这些数据的方法，例如使用稀释技术的行词分割方法在二值化输入图像上。

在第二部分中，我将开始训练CNN以识别上述信件中的单词。我会介绍LabelImg，这是一款我用来标注的开源工具，以创建正确标记的我的手写训练数据集。

我们将看看这种非传统的CNN与LeNet-5和VGGNet等更著名的架构相比效果如何，以及通过调整数据预处理的参数，我们是否能提高准确性。

希望你读得愉快，并会继续关注。我已经可以说，第二部分也将以一个难题，即另一个挑战告终。好的一面是，将会有第三部分来（希望）解决它。

祝一切顺利，

乔纳斯
