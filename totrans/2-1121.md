# 如何在数据工程团队中建立值班文化

> 原文：[https://towardsdatascience.com/how-to-build-an-on-call-culture-in-a-data-engineering-team-7856fac0c99](https://towardsdatascience.com/how-to-build-an-on-call-culture-in-a-data-engineering-team-7856fac0c99)

## 系统性地解决生产中的数据问题

[](https://medium.com/@xiaoxugao?source=post_page-----7856fac0c99--------------------------------)[![Xiaoxu Gao](../Images/8712a7e5f3bad0d2abd7e04792fad66f.png)](https://medium.com/@xiaoxugao?source=post_page-----7856fac0c99--------------------------------)[](https://towardsdatascience.com/?source=post_page-----7856fac0c99--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----7856fac0c99--------------------------------) [Xiaoxu Gao](https://medium.com/@xiaoxugao?source=post_page-----7856fac0c99--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----7856fac0c99--------------------------------) ·阅读时间 9 分钟·2023年3月15日

--

![](../Images/a16b492e8b21d711105088072c9758a6.png)

图片来源 [Pavan Trikutam](https://unsplash.com/@ptrikutam) 于 [Unsplash](https://unsplash.com/)

在任何公司中，赢得并留住客户的最佳方式之一是提供卓越的服务，这意味着服务应该在客户访问时始终保持健康和功能正常。为了实现这一点，科技行业引入了值班制度，这在过去常常与医生相关联。

值班的定义在公司之间有所不同。一般来说，值班意味着在特定时间段内保持可用，并准备以适当的紧迫性响应生产事故。值班通常与软件工程师和站点可靠性工程师（SRE）相关联，以支持诸如 API、网站、移动应用、物联网服务等软件。

数据工程师似乎没有像他们的同事那样参与值班。我将在下一段中解释原因。但这将会改变。

作为一个对多学科感兴趣的人，我想分享我们如何在数据工程团队中建立值班文化。大部分经验来自于我当前的团队，但我希望了解你们团队的做法以及任何有趣的想法。

## 为什么数据工程师不参与值班？

值班可能会很有压力。当生产问题发生时，工程师会立即在工作时间内或外收到呼叫，尽力做好事件管理的第一步。他们意识到焦急的客户在迫切等待服务恢复。他们明白，问题修复的延迟会导致公司客户和收入的损失。

然而，许多数据工程师认为**管道问题对客户满意度和收入的影响有限**，这导致他们没有动力时刻待命。这种看法可能源于数据大多由数据分析师和科学家使用来创建仪表板和报告，这些报告并不直接面对客户，可能不需要立即关注。

另一个原因是**许多数据问题被转化为功能请求**。在数据领域，“bug 还是功能”的讨论很常见。这对没有与用户定义任何SLA或SLO的数据团队特别具有挑战性，因为由于需求缺失造成的问题被归类为新功能，从而导致优先级降低。原则上，待命旨在解决紧急问题，而不是处理功能请求。

此外，数据流的复杂性，加上用户对指标的误解，以及源数据中的不可预见变量，都可能导致挫败感。

数据工程师面临的生产问题与软件工程师不同。因此，我们脑中的声音可能会是“嘿，看起来数据工程师不需要待命流程。他们真幸运。”

## 数据工程师在待命期间做什么？

在我看来，待命不仅仅是迅速解决最紧急的生产问题，还包括**规范处理意外生产请求的过程**。对数据工程师来说，这一点尤其重要，因为他们面临的多样化问题比软件工程师要多得多。

如果你考虑创建一个待命文化，列出团队收到的所有生产问题和请求，这些问题和请求超出了他们的日常范围，并为每个问题和请求提供描述和优先级，是一个很好的练习。以下是一个例子：

![](../Images/d12648ebe3c7ec56f703f7855239fff9.png)

数据问题和请求示例（作者创建）

最终，团队中的某个人应按照指导方针处理请求。指导方针越详细，待命过程就会越高效。建立一个公平的环境，让每个人都能参与待命过程，这一点至关重要。从这个角度看，它与软件工程师并没有太大区别，对吧？

接下来，我将分享一些建立待命文化的工具和框架。请记住，没有一种万能的方法，你不需要使用所有工具。选择对你的团队更有意义的工具。

## 待命工作流程

建立健康待命文化的关键是充分准备。更多的准备意味着我们需要现场做出的决策更少，从而减少错误。待命工作流程告诉工程师如何以一致的方式处理各种生产请求。

![](../Images/17f998bf41f789be1ee573073d7bfec1.png)

待命工作流程（作者创建）

上述工作流程是一个模板，你应该根据需要进行调整，但以下是主要步骤：

1.  **定义警报来源。** 将所有生产问题重定向到一两个渠道。例如，使用Slack集成将管道问题、基础设施故障和测试故障重定向到一个集中式Slack频道，以便于跟踪。

1.  **识别警报的类别、影响的规模及其紧急性。** 每个值班人员都应该能够根据警报的类别、影响和SLA要求来评估问题的紧急性。通过创建具有明确要求的“数据产品”，团队可以从这个过程受益，从而有效识别影响和紧急性。我推荐这篇文章——[使用Airflow编写数据产品管道](https://medium.com/miro-engineering/writing-data-product-pipelines-with-airflow-1ace222f8f5a)，这是一个将数据要求作为代码编写在Airflow dags中的好方法。

1.  **识别根本原因并解决问题。** 当出现紧急问题时，值班人员应尽最大努力找到根本原因并解决问题。然而，并非每位数据工程师都了解数据分析师维护的数据模型的所有细节。在这种情况下，遵循升级模式可能会有所帮助。它允许工程师在问题解决之前向具有必要专业知识的其他工程师或分析师寻求帮助。

1.  **执行事件后行动并更新值班日志。** 不要忘记执行事件后行动，如回填以纠正增量模型的历史数据。还建议保持值班日志以便于知识共享。

1.  **用户沟通。** 在一个并行线程中，保持用户知情是很重要的。在“数据停机”期间有效的沟通可以建立数据团队与用户之间的信任。我的一篇文章——[数据产品的状态页面——我们都需要一个](https://medium.com/towards-data-science/status-page-for-data-products-we-all-need-one-5a493092059a)介绍了状态页面作为改进数据停机期间有效沟通的方法。

## **值班责任**

正如在[dbt的2023年分析工程状态报告](https://www.getdbt.com/state-of-analytics-engineering-2023/)中所报告的，所有数据从业人员面临的主要挑战是*模糊的数据所有权*。这个挑战也引出了在值班期间的问题：“谁应该解决这个问题？”

我认为答案是“视情况而定”。

值班责任在很大程度上取决于数据工程师的日常工作。显然，工程师负责技术故障，但当涉及到数据模型故障时，责任变得有争议。无论是集中式还是分散式数据团队，数据工程师总是需要分析师的智慧来诊断和解决模型相关问题。最终，这会形成共享责任。依我拙见，两种方法可能有助于协作：

1.  **尽可能为每个数据模型分配一个负责人。** 仅仅[为模型分配一个负责人](https://docs.getdbt.com/reference/resource-configs/meta#designate-a-model-owner) 就能显著提高值班期间的效率。

1.  **将数据模型所有者视为“外部方”。** 软件通常依赖于工程师控制之外的外部方，例如依赖网络提供商的物联网服务。类似地，数据工程师可能需要与其直接团队之外的模型所有者合作以解决模型故障。当需要外部知识时，工程师应感到舒适地主动联系并与他们合作，同时通知用户进展。不要通过期望值班工程师独自解决问题来给他们带来压力。

## 工具 1 — 值班轮换

为了帮助你入门，这里有一些工具可以简化流程，帮助工程师专注于真正重要的事物。

***日程安排***

值班轮换是一个轮换值班工程师的计划，确保每周都有一个值班人员。这为工程师设定了时间、同事和范围的期望。

一种免费的设置是使用电子表格来管理轮换日程，并使用定时任务将日程近实时地传播到日历中。例如 Google Sheets + Apps Script + Google Calendar。一些团队更喜欢使用付费软件，如 Opsgenie 和 PagerDuty。它们节省时间并减少手动开销，但需要付费。

***权限***

值班工程师有时需要额外的权限来解决生产问题。一种方法是进行权限提升，暂时授予工程师额外的权限。另一种选择是创建一个高权限用户组并轮换组成员。必须确保组成员的轮换与值班日历的轮换同步。

## **工具 2 — 交流渠道**

在数据停机期间，有效的沟通至关重要。值班过程涉及多个沟通层面，找到在被告知和不被警报压倒之间的正确平衡至关重要。

![](../Images/ccf964d204bedce4a7d3c69a3f34a635.png)

由作者创建

***集中数据警报频道（警报 -> 团队）***

通过拥有一个专门的频道来接收所有警报，可以更容易地监控和管理警报，减少关键信息被遗漏或忽视的风险。Slack 是一个受欢迎的选择，因为它可以轻松地与各种数据源如 Opsgenie、GCP Cloud logging、Sentry、服务台等集成。它允许值班人员快速响应问题，并增强与其他工程师的协作。

***升级政策（团队 -> 团队）***

升级政策是一组程序，概述了组织如何响应需要超出初步响应的额外资源的问题。当第一层防御在一定时间内无法解决问题时，应及时通知第二层。

大多数事件管理工具允许团队定义升级政策，工具会在合适的时间将通知自动路由到正确的专家。如果模型所有权被适当地定义，工具可以通过读取模型元数据自动提醒所有者。

***用户沟通（团队 -> 用户）***

最后一层是用户沟通，需在问题确定后尽快开始。通过设置类似[状态页面](https://medium.com/towards-data-science/status-page-for-data-products-we-all-need-one-5a493092059a)的工具来保持渠道集中。

## 工具 3 — 值班运行手册

值班运行手册是一组在响应问题时值班人员可以遵循的指令。数据管道运行手册通常包括：

+   数据产品的元数据：所有者、模型增量性、优先级、计划、SLA 和 SLO。

+   升级程序（如果没有自动处理）。

+   故障排除指南：如何解决常见问题。例如，执行完全刷新、检查源数据、日志、数据可观测性工具等。

+   事件后验证：如何验证问题是否得到妥善解决。对于定时任务，问题只能在下一次运行时进行验证，这可能是几个小时或几天后。

值班运行手册是一个需要定期更新的动态文档，以反映变化。我非常喜欢文章[用 Airflow 编写数据产品管道](https://medium.com/miro-engineering/writing-data-product-pipelines-with-airflow-1ace222f8f5a)中的想法，其中作者在 Airflow dags 中将需求写成代码。这是将文档与代码关联的一个好例子，确保文档始终保持最新且相关。

## 工具 4—值班日志

值班日志是一个记录生产问题的工具。它帮助寻找经过测试的解决方案的工程师和寻找趋势的管理者。一个模板化的日志确保工程师在处理每个问题时都保持相同的科学严谨性。每条记录都包含关于问题的详细元数据、深入调查以及他们解决问题的方式。以“关注问题，而非人”的心态，工程师们更愿意分享更多细节。

![](../Images/1ef1747261dadb38262b794bf71673f4.png)

值班日志 — Notion 模板（由作者创建）

值班可以作为反映团队成熟度的镜子。年轻团队在值班初期经历一些混乱是正常的。然而，这些挑战可以推动团队改善监控、自动化、文档和需求收集流程。最终，值班可以成为团队中每个人宝贵的学习经验。

## 结论

对于刚接触值班的人来说，这篇文章提供了宝贵的见解和对预期的说明。对于那些希望建立值班文化的数据领导者，你们有很多工具可以使用。首先，从创建工作流程开始，并逐步用正确的工具填充每个步骤。最终，值班更多的是一种文化挑战，而非技术挑战。只要有正确的心态和工具，值班不仅可以成为个人成长的宝贵机会，也可以促进公司的成长。干杯！
