# 用 Python 动画化空间移动

> 原文：[https://towardsdatascience.com/animating-spatial-movement-in-python-ccf4e9462a0f](https://towardsdatascience.com/animating-spatial-movement-in-python-ccf4e9462a0f)

## 如何将起点-终点矩阵转化为迷人的动画

[](https://medium.com/@haavardwallinaagesen?source=post_page-----ccf4e9462a0f--------------------------------)[![Håvard Wallin Aagesen](../Images/45b79e090806b39359781b56710cbe77.png)](https://medium.com/@haavardwallinaagesen?source=post_page-----ccf4e9462a0f--------------------------------)[](https://towardsdatascience.com/?source=post_page-----ccf4e9462a0f--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----ccf4e9462a0f--------------------------------) [Håvard Wallin Aagesen](https://medium.com/@haavardwallinaagesen?source=post_page-----ccf4e9462a0f--------------------------------)

·发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----ccf4e9462a0f--------------------------------) ·阅读时间6分钟·2023年11月23日

--

![](../Images/61608028da72395e20f21dca85cb6f13.png)

自行车共享数据的移动静态地图。图片由作者提供。

空间数据本质上是可视化的，Python 在可视化（地理）空间数据方面的进步使得快速绘制各种形状和形式的地图变得非常简单。甚至创建图表和简单地图的动画也是相对容易的。特别是 Choropleth 地图，具有静态多边形和变化的颜色，已经有现成的函数来完成这项工作。

但当涉及到移动数据和动画化线路时，这项任务就显得有些繁琐。在这里，我将尝试给出一个示例，展示我如何在 Python 中解决空间移动数据动画化的问题。

# 初始数据

首先，我们需要一些带有时间戳的（线型）数据；在这个例子中，我将使用来自挪威奥斯陆的自行车共享系统的数据。这些数据在[挪威开放政府数据许可证 (NLOD) 2.0](https://data.norge.no/nlod/no/2.0#_lisensavtalens_innledning)/开放政府许可证下公开提供，可以从[Oslo Bysykkel](https://oslobysykkel.no/en/open-data)的主页获取。

[PRE0]

![](../Images/354963fa584d5a2b6b724da8d3e451e4.png)

初始数据集的前五行。图片由作者提供。

由于数据包括旅行的起点和终点，我们需要在这些点之间创建一条线，为此我们可以使用 NetworkX 中 Dijkstra 算法的实现。

# 创建移动线路

在我们可以创建移动线路之前，我们需要一个街道网络，以便进行最短路径计算。通过 `osmnx`，我们可以从 OpenStreetMap 获取我们感兴趣区域的自行车网络。我们将使用自行车旅行数据的范围作为我们的研究区域。

[PRE1]

要使用 Dijkstra 算法计算最短路径，我们可以创建一个函数，并将其应用于我们的数据框：

[PRE2]

我们现在可以将函数应用于数据框。为此，我们创建Shapely点作为起点和终点，然后在函数中使用这些点来计算它们之间的路径：

[PRE3]

![](../Images/628ce3f468ef6e39878eb79efadd9dda.png)

数据集现在具有最短路径。作者图片。

在开始将行拆分为路径上的点之前，我们可以准备时间数据，以便在最终动画中美观地显示：

[PRE4]

![](../Images/b9fcef2d05b905ca87e58a624d7b9c63.png)

计算出的最短路径中的一行。作者图片。

# 拆分行

现在我们有了移动线路，目的是在这条线路上以固定的间隔创建一个点，以便根据时间顺序绘制这些点。

以下`line_to_points()`函数遍历数据框中的每一行，并根据自行车旅行的持续时间将行拆分为段。在这个例子中，每行在15秒后被拆分，并在该位置创建一个点。

[PRE5]

使用`line_to_points()`函数，我们创建一个新的数据框，只包含我们希望用时间戳动画化的点，我们可以在绘图时迭代这些点。

[PRE6]

![](../Images/e750c61c1ce08d551aa47f1deb9fa32d.png)

行转换为带时间戳的点。作者图片。

# 动画化移动

为了能够绘制新的点数据，我们创建一个地理数据框，其中包含时间戳、点的大小和每个点的坐标。

[PRE7]

这里的核心目标是为新地理数据框中的每个时间戳创建一个图，然后将所有这些图合并为一个GIF动画。为此，我们创建一个函数，该函数将绘制地理数据框中的单行，同时用小点大小绘制所有先前的行。这样，我们就能看到当前时间的大点，同时还能够看到先前的点，给人一种直观的路径感。

[PRE8]

我们现在可以使用之前创建的时间戳列表`times`，并遍历每个时间戳，运行`plot_minute()`函数为我们拥有的每个时间戳数据制作地图。

[PRE9]

![](../Images/1286f6e36dd46e7bfadee393deec629f.png)

单分钟绘制的地图之一。作者图片。

# 转换为GIF

对所有时间戳运行`plot_minute()`的结果是，我们现在有一个充满.png地图的文件夹。动画化一系列png有几种方法，在基于UNIX的系统上，你可以在bash中运行`convert`程序。根据绘图设置的参数，png和动画本身的结果文件大小可能会非常大，因此可能需要调整大小以减少文件大小。

[PRE10]

现在我们可以查看最终结果：

# 结论

在这篇文章中，我向你展示了一种将移动点数据集转化为基于最短路径算法的动画地图的方法，使用了几个常见的Python库。

这个解决方案适用于任何具有配套网络的起始-目的地矩阵，并且许多城市的自行车共享数据是可以获取的。希望它能激励你去探索其他城市的自行车共享模式和城市结构！
