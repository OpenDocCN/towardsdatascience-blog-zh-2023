# 优化 Azure 虚拟机性能并降低成本：提升效率的可靠策略

> 原文：[https://towardsdatascience.com/streamlining-azure-vm-performance-while-slashing-costs-proven-strategies-for-optimal-efficiency-23a9bfc7fe62](https://towardsdatascience.com/streamlining-azure-vm-performance-while-slashing-costs-proven-strategies-for-optimal-efficiency-23a9bfc7fe62)

## 在不妨碍效率的前提下降低成本的技术

[](https://mg-subha.medium.com/?source=post_page-----23a9bfc7fe62--------------------------------)[![Subha Ganapathi](../Images/d346759d5990b79aae7ef2c3a5ab7cf3.png)](https://mg-subha.medium.com/?source=post_page-----23a9bfc7fe62--------------------------------)[](https://towardsdatascience.com/?source=post_page-----23a9bfc7fe62--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----23a9bfc7fe62--------------------------------) [Subha Ganapathi](https://mg-subha.medium.com/?source=post_page-----23a9bfc7fe62--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----23a9bfc7fe62--------------------------------) ·8 分钟阅读·2023年7月13日

--

![](../Images/83c0f9729173d8812e7e8d12c6a7868f.png)

**照片来源** [**Growtika**](https://unsplash.com/@growtika?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) **于** [**Unsplash**](https://unsplash.com/photos/Am6pBe2FpJw?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

# 概述

在设置 Azure 虚拟机时，重要的是要在环境配置之前了解定价模型和服务内容。如果不这样做，我们可能会面临高额账单，而这些费用本可以通过遵循成本优化策略来避免。本文将讨论实用的策略和见解，帮助你避免这种情况并更好地控制成本。我们还将讨论多少成本过高以及 Azure 定价中高级功能的作用。

请注意，本文中的图像包含 Azure 的尺寸和配置。这些图像来源于写作时某个地区的 Azure 门户。它们仅用于演示目的，不应视为你所在地区当前可用或配置的指示。建议参考官方 Azure 文档（或你的 Azure 门户）以获取最新和准确的成本及定价信息。

让我们开始吧。

# 实施调度机制来启动和停止你的 Azure 虚拟机

Azure 虚拟机的计费基于资源使用情况，包括 CPU、内存和存储消耗。需要注意的是，即使虚拟机处于空闲状态或未被主动使用，你仍然会为这些资源付费。换句话说，即使虚拟机内部没有正在运行的进程/作业，你也会因为虚拟机‘开着’而被收费。因此，需要优化工作负载以防止不必要的费用。

为了有效处理这一点，请执行以下操作：

1.  确定你打算在虚拟机中设置的进程和作业。这可以是与你的应用服务器相关的进程，甚至是虚拟机上托管的数据库中运行的作业。

1.  确定作业之间的依赖关系，即，识别需要并行运行的作业和需要同时运行的作业。还要记录那些与其他作业无关的作业。

1.  尝试在一致的时间范围内安排作业运行。例如，如果你有多个并发作业从数据库中处理数据，将作业运行对齐在相同时间范围内是有意义的。

4. 一旦你缩小了时间范围，你可以安排你的虚拟机在所需的时间框架内启动和停止。例如，如果作业需要在某个时区的每晚 9 PM 到 12 AM 之间运行，你可以安排你的虚拟机在 8:45 PM 启动。

使用 Powershell、CLI 或控制台可以安排虚拟机的启动和停止。Azure 控制台为用户提供了使用 Azure 门户管理虚拟机的功能和便利。

你可以通过访问 Azure 门户中的虚拟机来找到启动、停止和释放虚拟机的选项。以下是 Azure 提供的自动化模板。

![](../Images/4396f4a1a8958588b6ecab97f99b63d1.png)

**Azure 控制台中的任务（图片来源：作者）**

以下是访问自动化模板的步骤 -

选择你的虚拟机并访问任务（预览）。

![](../Images/10d9a3c2249d660c38471101ed1a0269.png)

**Azure 虚拟机 — 自动化 - 任务（图片来源：作者）**

点击‘添加任务’

![](../Images/0b9334885ff6323eac05ab32bf8a0bcb.png)

**Azure 虚拟机 — 任务 — 添加任务（图片来源：作者）**

选择模板‘启动虚拟机’

![](../Images/748fea3870899707064ca99683422a4b.png)

**Azure 虚拟机 - 自动化模板（图片来源：作者）**

在进行身份验证后，你可以配置启动虚拟机的时间。

![](../Images/54e51ae746907558c4406ea3a31ef63c.png)

**Azure 虚拟机 — 配置启动虚拟机自动化任务（图片来源：作者）**

相同的步骤也可以用于关闭和释放虚拟机。

**减少成本的最重要一步是解除分配虚拟机。** 停止虚拟机和解除分配虚拟机之间存在很大差异。当你停止虚拟机时，Azure资源管理会暂时暂停虚拟机，但保留分配的资源并保存虚拟机的状态。然而，当你解除分配虚拟机时，Azure资源管理会将分配的资源释放回Azure资源池。这些释放的资源可以供其他资源或服务使用，也可以根据需求分配给其他应用程序或虚拟机。这样，你可以节省计算成本。请记住，你仍然需要支付存储费用。下面是一个显示Azure环境及其与虚拟机交互的组件的示意图。

![](../Images/9550a4420c02fd8696f4cb8e31965ede.png)

**Azure资源管理（作者提供的图片）**

一个值得考虑的好策略是在非活动期间将虚拟机解除分配。解除分配非生产环境也是一个不错的选择，可以帮助实现显著的成本节省。确保解除分配与你的操作需求一致，并且不会影响关键流程或服务。

# **将磁盘从高级改为标准**

希望拥有高级磁盘存储、管理磁盘和自动扩展等高级功能是很自然的。但是，通常需要问自己这些功能是否真的适合你的用例。

Azure支持多种高级和标准磁盘。正如你可能猜到的，高级磁盘比标准磁盘更贵。如果你有像数据库和大数据处理这样的I/O密集型操作，你将需要继续使用高级磁盘。但是，如果你的工作负载没有时间限制且不太密集，那么标准磁盘是一个不错的选择。我们用一个例子来看看这个问题。

假设你有一个脚本每天（每天一次）从外部文件系统中提取数据，并填充到基于云的报告工具中。这是一项不那么密集的操作，可以轻松地使用标准磁盘处理。

假设你在虚拟机上托管了一个SQL数据库，该数据库直接连接到一个用户可以进行临时查询的自助报告。如果是这种情况，最好使用高级磁盘。不过，你可以考虑将高级磁盘降级到较低层级，以获得一些成本节省。

以下是通过控制台更改磁盘的过程。点击Azure虚拟机并访问侧边栏中的‘磁盘’选项。

![](../Images/e036f3945f800772f073779b1d1b93e1.png)

**Azure虚拟机 — 磁盘（作者提供的图片）**

点击磁盘名称中的超链接。

![](../Images/e54966d327eccb41c8ed98d4f54b52b1.png)

**Azure虚拟机- 当前操作系统（作者提供的图片）**

点击侧边栏中的‘大小 + 性能’。

![](../Images/0bccf7338989c5d11aab679843810a33.png)

**Azure虚拟机- 大小 + 性能（作者提供的图片）**

当前使用的配置会以灰色高亮显示。这是用户可以将磁盘从高级磁盘更改为标准磁盘类型的地方。您可以通过点击选择不同的配置。请注意，任何不适用于您的环境的配置将无法点击。

# **更改虚拟机配置**

Azure 提供不同尺寸、内存、存储和计算能力的虚拟机。每一系列和代的 Azure 虚拟机都旨在提供特定的性能特征，让用户根据其工作负载选择最合适的类型。下图展示了 Azure 虚拟机提供的不同代数。

![](../Images/38564ba0f729e5625690b369c98d4ef5.png)

**Azure 虚拟机世代（作者提供的图片）**

确定您的工作负载，并降级到最符合工作负载要求且能够节省成本的虚拟机。以下是进行相应操作的步骤 -

1.  点击虚拟机

1.  点击侧边栏中的“尺寸”

![](../Images/b665c32f3ab2fd9b59f213eafac60017.png)

**Azure 虚拟机 - 尺寸（作者提供的图片）**

结果面板显示了不同的虚拟机世代及其所有相关详细信息，如每小时费用、内存和支持的工作负载。

请注意，这只是一个示例图片，并不旨在展示所有可用的配置选项。

![](../Images/b155f95c1d7842095223d21500c9b2a4.png)

**Azure 虚拟机 - 磁盘世代与尺寸（作者提供的图片）**

向右滚动以访问每小时费用。

请注意，这些成本是撰写文章时的情况。当前正在使用的虚拟机的尺寸和代数会在顶部显示。要更改虚拟机配置，请点击“调整大小”。

![](../Images/5ca4fbf77672c8a22700b2ab36134885.png)

**Azure 虚拟机 - 调整虚拟机配置（作者提供的图片）**

# **考虑更改为定价较低的地区**

Azure 的定价在不同地区可能有所不同。需求较低的地区可能会有稍低的定价，而需求较高和资源有限的地区可能价格稍高。规划部署时，可以使用 Azure 定价计算器比较不同地区的定价。不过，尽量选择离您较近的地区，以避免不必要的网络延迟。

例如，你可能会发现，位于东欧的某些区域比美国东海岸和西海岸的区域便宜。假设你有一些位于欧洲的用户需要访问你设置的虚拟机。为了提高性能，设置在离他们位置较近的区域的虚拟机可能更有意义，而不是在美国区域设置虚拟机。然而，需要注意的是，在确定虚拟机设置的最佳区域时，可能需要考虑数据传输规定和限制。此外，还需要考虑的是，随着区域距离当前位置的远离，网络延迟可能增加，从而导致响应时间变慢。

# 总结

在这篇文章中，我们讨论了4种策略，以减少 Azure 账单上的成本，同时不影响现有/新工作负载的效率。所有这些策略都可以通过 Azure 门户无缝实现，无需使用编程方法。理解你的工作负载需求和处理需求是管理成本效益环境的关键。同时，平衡成本节省与性能和数据传输规定等因素同样至关重要。通过应用这些技巧，你可以优化 Azure VM 性能，同时有效管理成本，确保资源的高效利用，实现你期望的结果。
