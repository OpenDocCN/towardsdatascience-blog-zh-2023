# 预测星巴克奖励计划的成功

> 原文：[https://towardsdatascience.com/predicting-success-of-a-reward-program-at-starbucks-b32b77dcf9b8](https://towardsdatascience.com/predicting-success-of-a-reward-program-at-starbucks-b32b77dcf9b8)

## 初学者友好 — 从头到尾逐步解释完整项目

[](https://erdemisbilen.medium.com/?source=post_page-----b32b77dcf9b8--------------------------------)[![Erdem Isbilen](../Images/6b6ca6806024725245132894b2958e49.png)](https://erdemisbilen.medium.com/?source=post_page-----b32b77dcf9b8--------------------------------)[](https://towardsdatascience.com/?source=post_page-----b32b77dcf9b8--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----b32b77dcf9b8--------------------------------) [Erdem Isbilen](https://erdemisbilen.medium.com/?source=post_page-----b32b77dcf9b8--------------------------------)

·发布在 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----b32b77dcf9b8--------------------------------) ·9 分钟阅读·2023 年 6 月 20 日

--

![](../Images/257d86a537c79400e22c628914ba71c3.png)

照片由 [Robert Linder](https://unsplash.com/@rwlinder?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral) 拍摄

# 项目概述

该项目专注于识别能够有效吸引星巴克现有客户并吸引新客户的奖励计划优惠。

星巴克是一家数据驱动的公司，通过利用包含客户信息、特别优惠和交易数据的数据集，致力于全面了解其客户。

为了开发一个能够确定奖励计划成功的模型，我将项目分为**三个阶段**：

1.  **检查和清理** Udacity 提供的数据。

1.  创建一个**结合所有相关信息**的数据集。

1.  构建和评估**三个分类模型**的性能**以预测特定人员的奖励计划的成功或失败**。

# 问题陈述

对市场营销活动进行重大投资是一个复杂的决策，需要获得各种利益相关者的批准、财务资源和时间。因此，拥有一个能够对特定目标群体发起特定优惠是否值得的预测模型，对于任何公司来说都是一个战略资产。

为了创建这个模型，我们将使用监督学习技术进行二分类。

**模型的结果将指示该优惠是否预计会有效。**

# **数据集探索与整理**

Udacity 提供了三个 JSON 格式的数据集：**portfolio**、**profile** 和 **transcript**。每个数据集都有不同的用途，并为我们的分析提供了宝贵的信息。

## Portfolio 数据集

该数据集提供了有关星巴克当前有效优惠的信息。

+   **id（字符串）**——优惠id

+   **offer_type（字符串）**——优惠类型，即BOGO、折扣、信息性

+   **difficulty（整数）**——完成优惠所需的最低花费

+   **reward（整数）**——完成优惠后给予的奖励

+   **duration（整数）**——优惠开放的时间，以天为单位

+   **channels（字符串列表）**

![](../Images/4c2469dc8124089fe3f9463cb5375ddb.png)

组合数据集（原始）——图像作者：Erdem Isbilen

**portfolio**数据集中有十行和六列。这是一个简单的数据集，没有缺失、空值或重复值。

**‘channels’，‘id’，‘offer_type’**列是分类变量，而**‘difficulty’，‘duration’，‘reward’**是整数。

请参见我对数据集所做的修改：

+   对**‘channels’**和**‘offer_type’**进行独热编码

+   将***‘id’***更改为***‘offer_id’***

![](../Images/84d6aa5e1e183234fb6e63caf0310839.png)

组合数据集（经过数据清理）——图像作者：Erdem Isbilen

## **个人资料数据集**

个人资料数据集包含有关星巴克客户的人口统计信息。

+   **age（整数）**——客户的年龄

+   **became_member_on（整数）**——客户创建应用账户的日期

+   **gender（字符串）**——客户的性别（注意有些条目包含‘O’代表其他，而不是M或F）

+   **id（字符串）**——客户id

+   **income（浮点数）**——客户的收入

![](../Images/3f847bffc9623af05c3382c319526485.png)

个人资料数据集（原始）——图像作者：Erdem Isbilen

这个数据集中有17000行（数据集中唯一的人员数量）和5列，有2175个空值（出现在***gender***和***income***列中）。由于这些行的年龄值也为118，我从数据集中删除了所有2175行。

请参见我对数据集所做的修改：

+   删除2175行缺失值（也包括年龄值为118的行）

+   将***‘id’***更改为***‘customer_id’***

+   ***‘become_member_on’***字符串转日期

+   创建***‘year_joined’***和***‘membership_days’***列

+   对***‘gender’***进行独热编码

+   创建***‘age_group’***以将客户分类为**青少年、年轻成人、成年人、老年人**

+   创建***‘income_range’***以将客户分类为**普通、高于平均水平、高收入**

+   创建***‘member_type’***以将客户分类为**新会员、常规会员、忠实会员**

![](../Images/3b7e4951f1ee40dec6d84b33a5695d47.png)

个人资料数据集（经过数据清理）——图像作者：Erdem Isbilen

可以看到，加入该计划的人数在2013年至2017年之间呈上升趋势，2017年是最佳年份。50%的会员年龄在42至66岁之间。

![](../Images/4ddff56138a6890a60cd6acd53931ddd.png)

年龄、收入、加入年份列的直方图——图像作者：Erdem Isbilen

如下所示，在低收入和中等收入区男性人口超过女性人口，而在高收入区女性人口超过男性人口。

![](../Images/887e69b2078406bf5c5fc6c9664d3294.png)

不同性别群体收入的直方图图表— 图片来源（作者）Erdem Isbilen

在考虑性别时，数据集存在一些偏差，因为男性人口数量超过女性人口，而且其他类别的人数较少。具体来说，数据集中有8484名男性、6129名女性和仅212名其他类别的人。

![](../Images/f58c61918c1df0a8383aa1ea36a2234c.png)

性别的直方图图表— 图片来源（作者）Erdem Isbilen

## **记录集数据**

记录集数据捕捉了客户与优惠活动的互动。

+   **event (str)** — 记录描述（即交易、优惠接收、优惠查看等）

+   **person (str)** — 客户ID

+   **time (int)** — 从测试开始的时间，以小时为单位。数据从时间 t=0 开始

+   **value — (字符串字典)** — 根据记录是优惠ID还是交易金额

![](../Images/7b2ca4ebba565a8a928cffa2ecf54130.png)

记录集数据（原始）— 图片来源（作者）Erdem Isbilen

如果记录集中的事件对应于三种可能的优惠状态之一（查看、接收或完成），则值列包含优惠的***id***。除了优惠ID之外，如果事件状态为***‘offer completed’***，还会有***reward*** 值。

但是，如果事件是**交易**，则值列将仅显示**交易金额**。

请查看我对数据集所做的修改：

+   将***‘value’***展开为***‘offer_id’***、***‘amount’***、***‘rewards’*** 新列。

+   通过将时间（小时）转换为天数来创建***‘time_in_days’***。

+   将***‘person’***更改为***‘customer_id’***

+   将**记录集**数据拆分为两个子数据集：**offer_tr**（优惠数据）和**transaction_tr**（交易数据）

![](../Images/f040fe4b285e5eb4c263ea442e4a3db7.png)

offer_tr 数据集（数据处理后）— 图片来源（作者）Erdem Isbilen

# 构建模型

一旦数据集被清理并完成必要的修改，我们需要将它们合并为一个单一的数据集。然后我们将创建一个名为`offer_successful`的新列。该列将指示某个优惠是否对特定客户成功。**这将使我们能够建立可以预测特定类型客户对某个优惠是否成功的模型。**

客户必须**查看**和**完成**优惠活动**在允许的时间范围内**，才能将该优惠视为**成功**。

**在开发模型时遇到的困难**是数据集中没有特定的列指明某个客户的报价是否成功。因此，我开发了一个辅助函数，通过考虑已完成和查看的报价数据以及这些事件之间的时间范围来计算目标值。

成功和失败的报价数量分别为35136和31365。这意味着我们在考虑目标时有一个平衡的数据集。因此，我们在选择模型时没有任何限制（这些限制通常与不平衡的数据集有关）。

为了创建一个可以预测报价是否成功的模型，我们需要在最终数据集上训练一个模型。

由于这是一个二分类问题，我们将使用三种不同的监督学习算法。

+   逻辑回归

+   随机森林

+   梯度提升

我将使用sklearn的默认设置开始构建模型，以了解不同模型的准确性水平。

然后，我将使用**RandomizedSearchCV**进行12次迭代，以优化模型的超参数，因为它比**GridSearchCV**计算开销更小。**RandomizedSearchCV**通过从指定分布中随机抽样超参数值来工作。

这些模型中的每一个都在训练数据集上进行训练，并在测试数据集上进行评估，以避免过拟合，并查看模型在未见数据上的表现。

# 指标和结果

我将使用**混淆矩阵**和下面的指标来评估模型的性能。

我将特别关注**精确度**，因为研究的主要目的是尽可能准确地定义正类。

+   **准确率：** 准确率是评估分类模型准确性最常用的指标。它通过将正确预测的数量除以预测总数来计算。

+   **精确度：** 精确度是衡量模型在预测正类时准确性的指标。它通过将真正例的数量除以真正例的数量加上假正例的数量来计算。

+   **召回率：** 召回率是衡量模型在预测正类时完整性的指标。它通过将真正例的数量除以真正例的数量加上假负例的数量来计算。

+   **F1分数：** F1分数是精确度和召回率的加权平均值。它通过将2 * (精确度 * 召回率)除以（精确度 + 召回率）来计算。

## **超参数微调前的初始准确率指标：**

![](../Images/23dd6b832ed3e134c95b1701ac05d1e5.png)

表格形式的模型表现 — 图片作者（Erdem Isbilen）

## **超参数微调后的结果：**

![](../Images/4474b05f8ff9b40d19b88fe8e86f8451.png)

表格形式的模型表现 - 图片作者（Erdem Isbilen）

尽管所有模型提供了类似的性能指标，但**随机森林**的**准确性**略微更高。我们发现超参数的微调对模型性能的影响很小。这可能是因为我们为调优选择的自定义参数比默认参数更差。因此，我们可能需要考虑选择不同的参数集来微调模型。

## 论证

由于**随机森林**和**梯度提升**可以更好地处理异常值和高维数据，因此它们在我们的案例中表现优于逻辑回归。

# **结论**

在这个项目中，我分析了星巴克提供的数据集，并开发了一个可以预测顾客是否会完成优惠的模型。

我对每个数据集进行了探索性分析，并可视化数据以获得全面的理解。这包括检查数据集的各个方面。随后，我进行了预处理部分，这是最耗时和具有挑战性的任务。数据集复杂，包含的数据需要应用数据整理、工程和预处理技术，以获得最终的清洁版本。

最后一步是开发几个二元分类模型以进行预测。模型构建完成后，使用测试数据评估模型的性能。结论是这三种模型提供了类似的性能结果。

# **改进**

尽管这些模型提供了一个良好的起点，但精度为66%的结果仍有改进的空间。

对于这个项目的一个有趣改进是创建多个监督学习模型，并将它们组合成一个自定义集成模型。通过组合多个监督学习模型来创建集成模型可以带来错误补偿的优势。通过利用不同模型的优势并弥补它们的弱点，集成模型实现了更好的泛化性能，从而提高了准确性和鲁棒性。

为了提高我们奖励计划预测的准确性，我们可以考虑将不同类型的奖励分开，并为每个计划开发单独的模型。通过这种方法，我们可以根据每个奖励计划的具体特征和目标量身定制我们的建模技术，从而实现更精确的预测和更好的结果。这种方法还可以帮助我们识别每个奖励计划中的任何独特趋势或模式，从而使计划设计和实施更加有效。

另一种优化奖励计划效果的方法是识别并排除那些无论奖励计划如何都购买的个人。通过这样做，我们可以将资源集中在那些更有可能积极影响计划结果的人身上，从而最大化我们从计划中获得的利益。

# **反思**

我发现这个顶点项目是一个非常愉快的经历，让我能够提升数据预处理和建模的技能。数据预处理步骤是最耗时且令人畏惧的任务。然而，数据集本身很有启发性，这激励我继续努力工作。
