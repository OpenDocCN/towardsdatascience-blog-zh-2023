# 处理转化指标？考虑使用 Beta-二项式模型

> 原文：[https://towardsdatascience.com/dealing-with-conversion-metrics-consider-beta-binomial-model-29733906ff38](https://towardsdatascience.com/dealing-with-conversion-metrics-consider-beta-binomial-model-29733906ff38)

![](../Images/52c7b004ff37e2cbacac7625eaf7ab8d.png)

图片由 [Karim MANJRA](https://unsplash.com/@karim_manjra?utm_source=medium&utm_medium=referral) 提供，来源于 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

## 学习一种特征工程技术，使基于转化的指标如 CTR/CVR 更具代表性和稳定性

[](https://medium.com/@pararawendy19?source=post_page-----29733906ff38--------------------------------)[![Pararawendy Indarjo](../Images/afba0cb7f3af9554a187bbc7a3c00e60.png)](https://medium.com/@pararawendy19?source=post_page-----29733906ff38--------------------------------)[](https://towardsdatascience.com/?source=post_page-----29733906ff38--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----29733906ff38--------------------------------) [Pararawendy Indarjo](https://medium.com/@pararawendy19?source=post_page-----29733906ff38--------------------------------)

·发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----29733906ff38--------------------------------) ·10 分钟阅读·2023年7月26日

--

行业内有大量的转化指标。而且我们经常希望将它们用作我们机器学习模型中的一个特征。例如，产品在搜索页面上展示的印象到点击的产品详情点击率（CTR）可能是一个相关特征，用于建模产品是否会在电子商务平台上被购买。

在这篇博客中，我们将学习一种针对这些转化指标的特征工程技术。为了实现这一目标，博客的其余部分将按以下结构进行。

1.  解释为什么我们需要谨慎处理转化特征（即，我们不应使用这些特征的原始形式）。

1.  解决方案：使用 Beta-二项式模型将原始转化值转换为更稳定/更具代表性的版本

1.  Beta-二项式模型的理论基础

1.  调整模型 Beta-prior 分布参数的指南

1.  用于进行 Beta-二项式转换的 Python 代码（提示：非常简单！）

让我们开始吧！

# 使用原始转化值的缺点

假设我们正在构建一个分类模型，以预测产品是否会在电子商务平台上被购买。作为数据预处理的一部分，我们提取与每个产品相关的两列数据：获得的印象数和点击数。因为我们是具有强大领域知识的优秀数据科学家，所以我们衍生出一个名为“印象到点击转化”的新特征。

这一特征工程的原理是我们相信更高的印象到点击转换率表示更好的产品质量。逻辑是，如果一个产品在展示次数（印象）中获得了更高的点击百分比，这表明用户觉得这个产品有吸引力，从而增加了购买的可能性。

现在考虑以下三个产品场景。

![](../Images/8ffe947c758c7a3392886be504e8ce3d.png)

原始转换值（图片来源于作者）

在表格中，产品 A 和产品 B 的印象到点击转换率都是 70%。这是否意味着产品 A 和 B 的质量相同？注意产品 A 在经过大量展示（1000 次印象）后达到了 70% 的转换率，表明测试和稳定性较高。另一方面，产品 B 从更少的展示次数（仅 10 次印象）中获得了相同的转换率，使其不那么可靠，更容易受到波动的影响。

鉴于这种测试和稳定性的差异，我认为将较高的转换评分分配给产品 A 比产品 B 更合适。

当我们考虑产品 C 时，使用原始转换值的问题变得更加明显。产品 C 在仅被展示 1 次后就达到了 100% 的印象到点击转换率。使用原始转换值暗示产品 C 比其他产品显著更好——但这不一定是真的。因为产品 C 可能只是“初学者运气”而已。产品 C 的真实/稳定转换率很可能低于 100%，随着用户的印象增加而变化。

# Beta-Binomial 模型来救援！

有没有比使用原始转换值更好的方法？

确实有更好的方法！我们可以使用 Beta-Binomial 模型来获得更稳定的转换值，这可能更好地代表特征。我们可以通过以下转换，使用 Beta-Binomial 模型计算产品的点击倾向（我们用来指代印象到点击转换的更好/更稳定版本）。

![](../Images/db663f5da3e3dcf8966dc8216b469fca.png)

Beta-binomial 转换公式（图片来源于作者）

α 和 β 是一些指定的值。

例如，使用 α = β = 10，我们可以得到之前考虑过的产品 A、B 和 C 的以下结果。

![](../Images/220d4d6d080968076f26d64e2e2e5d10.png)

Beta-Binomial 转换（图片来源于作者）

比使用原始转换值更好，对吧？现在产品 A 在三者中得分最高，这似乎更公平，因为它已经经过了最多的用户测试（大量印象）。此外，产品 C 现在得分最低，因为我们对它看似完美的转换结果不确定（即需要更多的测试来证明其价值）。

# Beta-Binomial 模型的理论基础

尽管其简单，但上述变换有着坚实的理论基础，这将在本节中讨论。

实用的读者可以直接跳过这个更技术性的部分，继续阅读“如何选择 α 和 β”部分。

## 二项分布

第一个相关概念是二项分布。回忆一下，它是一种概率分布，用于建模从一组独立的二项试验（n）中获得的成功次数（y），每次试验的成功概率为 pi（π）。

在我们的案例中，我们可以使用二项分布来建模产品获得的点击次数（y），这些点击是产品展示给用户的次数（n），假设产品的点击倾向是 pi（π）。

二项分布的概率质量函数如下所示。

![](../Images/40663a72b44520389666709dcd279882.png)

二项分布 PMF（作者图像）

使用上述公式，我们可以计算（给定 n 和 π）成功次数等于 y 的概率。结果，我们可以确定哪个 y 值的发生概率高于其他值。

然而，在我们的案例中，我们*不*感兴趣于学习 y 的最佳值（即，获得最高概率的点击次数）。这是因为我们有点击和展示数据作为输入（也就是说，我们可以查询产品 A 从我们的跟踪数据库中获得了多少展示次数（n）和点击次数（y））。

相反，我们想要推断产品的点击倾向。也就是说，给定 n 和 y，π 应该是什么值？

回答这个问题需要将概率质量函数翻转过来，如下所示。

![](../Images/51f9c859f355e5bf6dd0d9f5f1063283.png)

二项分布的似然函数（作者图像）

上述函数被称为**似然函数**。值得注意的是，在这个函数中，π 现在被视为关注的变量。而 n 和 y 被认为是常数（它们的值是预先给定的）。

## Beta 分布

Beta 分布是一种概率分布，用于建模一个取值范围在 0 和 1 之间的随机变量。因此，我们可以用它来建模我们之前感兴趣的点击倾向 π。

Beta 分布的概率密度函数如下所示。

![](../Images/3b6aec702742428ca3a5bcb04d63a969.png)

Beta 分布 PDF（作者图像）

其中**Γ**是伽玛函数，α 和 β 是分布参数。更多细节，请参见 Beta 分布的[维基页面](https://en.wikipedia.org/wiki/Beta_distribution)。

随机变量 Beta(α, β) 的期望值（均值）是。

![](../Images/baa9cedc9630dfd449fd840f5ff667d4.png)

Beta 分布均值（作者图像）

这个量对于我们的建模工作至关重要，因为我们将用它来定义我们所寻找的最佳 π 值。

## 贝叶斯统计

贝叶斯统计是一种统计思维方式，我们不仅检查观察到的数据，还考虑我们的先验知识，以便从数据中得出结论。我们通过在看到数据之前权衡观察到的数据（证据）与我们的初始假设来做到这一点。

在贝叶斯统计中，我们从一个初始信念开始，这个信念由一个先验概率分布表示，并将其与观察到的数据的可能性结合，以获得一个后验概率分布。这个后验分布反映了我们对研究现象的更新理解，结合了可用的数据和我们最初的假设。

![](../Images/8e03ffe5ca77012de9493b3dd47721f8.png)

后验公式（图片作者提供）

在我们的背景下，我们对找到最佳值以代表给定产品的点击倾向 π 感兴趣。为此，我们可以在未看到任何数据的情况下，使用 Beta 分布作为我们点击倾向 π 的先验分布。然后将该先验与给定观察数据（印象数 *n* 和点击数 *y*）的二项分布的可能性结合。

![](../Images/c12c5e540c354390a084825586e239f1.png)

Beta-Binomial 后验推导（图片作者提供）

通过进行一些代数运算（这里略过，感兴趣的读者可以查看完整推导 [这里](https://www.bayesrulesbook.com/chapter-3.html)），结果表明 π 的后验分布将等于 Beta(α+y, β+n-y)。请记住，n 和 y 分别是印象数和点击数。

因此，这个 π 的后验分布的均值如下。

![](../Images/a7649b66e499aa9a49ad52bf9de21112.png)

转换公式推导（图片作者提供）

这正是我们之前示例中使用的转换公式。

# 如何选择 α 和 β？

让我们总结一下我们所做的工作。我们使用 Beta(α=10, β=10) 作为我们点击倾向 π 的先验分布。这导致了 Beta(α+点击数, β+印象数-点击数) 的后验分布。该后验分布的均值为 (点击数+α/印象数+α+β)，我们用来转换原始的转化值。

这些 α 和 β 的值来自哪里？

为了明确，后验分布（因此 Beta 后验均值公式）仅仅是所选先验分布的一个结果。因此，选择 α 和 β 实际上是选择先验分布的问题。具体来说，我们希望在未观察任何数据的情况下（即尚无印象的产品）得到什么样的点击倾向 π 分布？

这里的关键思想是理解 α 和 β 对 Beta 分布 PDF（概率密度函数）形状的影响。为了对这个主题有一些直观认识，下面展示了几个具有不同 α 和 β 值的 Beta PDFs。

![](../Images/3249228419cc74db1a77bd818e6b83ae.png)

α 和 β 对 Beta 分布形状的影响（图片作者提供）

从图表中可以看到，使用Beta(α=10, β=10)作为我们的先验（橙色曲线）意味着在没有数据的情况下，我们倾向于认为点击倾向π集中在0.5左右，且对称变化范围在0.2和0.8之间。

如果我们认为默认的点击倾向可能在0.7左右，我们可以使用Beta(α=7, β=3)作为我们的先验（棕色曲线）。另一个例子是：如果我们对默认点击倾向没有偏好（即任何比例值都是一样可能的），我们可以使用Beta(α=1, β=1)作为我们的先验（蓝色线），因为它类似于均匀分布。

现在，敏锐的读者可能会说：“我知道Beta(α=10, β=10)和Beta(α=2, β=2)都导致一个以0.5为中心的对称分布。那么，我们为什么选择前者而不是后者呢？”

回答这个问题需要理解α和β对Beta分布方差的影响。下面的图片清晰地展示了这个问题。

![](../Images/dc8831ea3a5f02ba00bce9c75ccb615b.png)

α和β对变异性的影响（图片来源：作者）

从图表中可以看到，更高的α和β值导致分布的变异性降低。Beta(α=10, β=10)的PDF比Beta(α=2, β=2)更陡峭。而Beta(α=50, β=50)的变异性低于Beta(α=10, β=10)，依此类推。

实际上，如果我们使用更大的α和β值，这意味着我们在先验上施加更大的权重以影响后验（回顾：后验是从先验和观察数据之间的平衡作用中得出的）。

为了更好地理解，让我们看看我们的产品A、B和C如何响应不同的α和β值（假设Beta先验均值/默认转换在0.5处相同）。

![](../Images/e4de21f39eac9744de45098adf83ccd2.png)

α和β大小的不同效果（图片来源：作者）

让我们关注产品B。当α=2，β=2时，Beta后验均值为64%（比先验均值偏移了近15%）。当我们增加α=10，β=10时，偏移缩小到不到7%。而当我们使用α和β都大于100时，Beta后验均值实际上没有从默认转换的50%移动。

粗略地说，使用更大的α和β意味着我们对模型设置了更高的“固执程度”。也就是说，我们要求更多的数据（证据）才能使后验从我们的默认信念中有意义地移动。

# Python 代码

最后，你可以在下面找到导出beta-binomial转换的代码。

# 总结

呼。那是一篇冗长的阅读。所以，恭喜你读到这里！🎉

在这篇博客中，我们学习了一种简单的特征工程技术，可以用来提高转换度量的代表性和稳定性。尽管它很简单，但该技术基于贝叶斯统计中的Beta-Binomial模型，具有优雅的基础。

在文章后面，我们学习了如何调整α和β以选择适当的先验分布。简而言之，更高的α和β实际上意味着我们需要更多的数据来使结果转化分数远离我们初始/默认的转化分数。

希望这篇文章对你遇到类似情况时有所帮助！总之，感谢阅读，欢迎在[LinkedIn](https://www.linkedin.com/in/pararawendy-indarjo/)上与我联系！👋

# **参考文献**

*约翰逊, 艾丽西亚·A., 奥特, 迈尔斯·Q., 多古楚, 米娜. (2021). 贝叶斯规则！应用贝叶斯建模简介. CRC Press.*
