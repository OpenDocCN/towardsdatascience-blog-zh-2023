- en: Two-way ANOVA in R
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/two-way-anova-in-r-c53d7353efe5](https://towardsdatascience.com/two-way-anova-in-r-c53d7353efe5)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Learn how to do a two-way ANOVA in R. You will also learn its aim, hypotheses,
    assumptions, and how to interpret the results.
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://antoinesoetewey.medium.com/?source=post_page-----c53d7353efe5--------------------------------)[![Antoine
    Soetewey](../Images/51d7837d18ff15a62cac2343a485e35d.png)](https://antoinesoetewey.medium.com/?source=post_page-----c53d7353efe5--------------------------------)[](https://towardsdatascience.com/?source=post_page-----c53d7353efe5--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----c53d7353efe5--------------------------------)
    [Antoine Soetewey](https://antoinesoetewey.medium.com/?source=post_page-----c53d7353efe5--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----c53d7353efe5--------------------------------)
    ·23 min read·Jun 19, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/5186e1c2999fc5da63a55327a6f00454.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Nathan Dumlao](https://unsplash.com/@nate_dumlao?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The two-way ANOVA (analysis of variance) is a statistical method that allows
    to **evaluate the simultaneous effect of two** [**categorical**](https://statsandr.com/blog/variable-types-and-examples/#qualitative)
    **variables on a** [**quantitative continuous**](https://statsandr.com/blog/variable-types-and-examples/#continuous)
    **variable**.
  prefs: []
  type: TYPE_NORMAL
- en: The two-way ANOVA is an extension of the one-way ANOVA since it allows to evaluate
    the effects on a numerical response of **two** categorical variables instead of
    one. The advantage of a two-way ANOVA over a one-way ANOVA is that we test the
    relationship between two variables, while taking into account the effect of a
    third variable. Moreover, it also allows to include the possible *interaction*
    of the two categorical variables on the response.
  prefs: []
  type: TYPE_NORMAL
- en: 'The advantage of a two-way over a one-way ANOVA is quite similar to the advantage
    of a [multiple linear regression](https://statsandr.com/blog/multiple-linear-regression-made-simple/)
    over a [correlation](https://statsandr.com/blog/correlation-coefficient-and-correlation-test-in-r/):'
  prefs: []
  type: TYPE_NORMAL
- en: The correlation measures the relationship between two quantitative variables.
    The multiple linear regression also measures the relationship between two variables,
    but this time taking into account the potential effect of other covariates.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The one-way ANOVA tests whether a quantitative variable is different between
    groups. The two-way ANOVA also tests whether a quantitative variable is different
    between groups, but this time taking into account the effect of another qualitative
    variable.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Previously, we have discussed about [one-way ANOVA in R](https://statsandr.com/blog/anova-in-r/).
    Now, we show when, why, and how to perform a **two-way** ANOVA in R.
  prefs: []
  type: TYPE_NORMAL
- en: 'Before going further, I would like to mention and briefly describe some related
    statistical methods and tests in order to avoid any confusion:'
  prefs: []
  type: TYPE_NORMAL
- en: 'A [Student’s t-test](https://statsandr.com/blog/student-s-t-test-in-r-and-by-hand-how-to-compare-two-groups-under-different-scenarios/)
    is used to evaluate the effect of one categorical variable on a quantitative continuous
    variable, **when the categorical variable has exactly 2 levels**:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Student’s t-test *for independent samples* if the observations are **independent**
    (for example: if we compare the age between women and men)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Student’s t-test *for paired samples* if the observations are **dependent**,
    that is, when they come in pairs (it is the case when the same subjects are measured
    twice, at two different points in time, before and after a treatment for example)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To evaluate the effect of one categorical variable on a quantitative variable,
    **when the categorical variable has 3 or more levels**:[1](https://statsandr.com/blog/two-way-anova-in-r/#fn1)
  prefs: []
  type: TYPE_NORMAL
- en: '[*one-way ANOVA*](https://statsandr.com/blog/anova-in-r/) (often simply referred
    as ANOVA) if the groups are **independent** (for example a group of patients who
    received treatment A, another group of patients who received treatment B, and
    the last group of patients who received no treatment or a placebo)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*repeated measures ANOVA* if the groups are **dependent** (when the same subjects
    are measured three times, at three different points in time, before, during and
    after a treatment for example)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A two-way ANOVA is used to evaluate the effects of 2 categorical variables (and
    their potential interaction) on a quantitative continuous variable. This is the
    topic of the post.
  prefs: []
  type: TYPE_NORMAL
- en: '[Linear regression](https://statsandr.com/blog/multiple-linear-regression-made-simple/)
    is used to evaluate the relationship between a quantitative continuous dependent
    variable and one or several independent variables:'
  prefs: []
  type: TYPE_NORMAL
- en: simple linear regression if there is only one independent variable (which can
    be quantitative or qualitative)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: multiple linear regression if there is at least two independent variables (which
    can be quantitative, qualitative, or a mix of both)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An ANCOVA (analysis of covariance) is used to evaluate the effect of a categorical
    variable on a quantitative variable, while controlling for the effect of another
    quantitative variable (known as covariate). ANCOVA is actually a special case
    of multiple linear regression with a mix of one qualitative and one quantitative
    independent variable.
  prefs: []
  type: TYPE_NORMAL
- en: In this post, we start by explaining when and why a two-way ANOVA is useful,
    we then do some preliminary descriptive analyses and present how to conduct a
    two-way ANOVA in R. Finally, we show how to interpret and visualize the results.
    We also briefly mention and illustrate how to verify the underlying assumptions.
  prefs: []
  type: TYPE_NORMAL
- en: Data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To illustrate how to perform a two-way ANOVA in R, we use the `penguins` dataset,
    available from the `{palmerpenguins}` package.
  prefs: []
  type: TYPE_NORMAL
- en: 'We do not need to [import the dataset](https://statsandr.com/blog/how-to-import-an-excel-file-in-rstudio/),
    but we need to [load the package](https://statsandr.com/blog/an-efficient-way-to-install-and-load-r-packages/)
    first and then call the dataset:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'The dataset contains 8 variables for 344 penguins, summarized below:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'In this post, we will focus on the following three variables:'
  prefs: []
  type: TYPE_NORMAL
- en: '`species`: the species of the penguin (Adelie, Chinstrap or Gentoo)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`sex`: sex of the penguin (female and male)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`body_mass_g`: body mass of the penguin (in grams)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If needed, more information about this dataset can be found by running `?penguins`
    in R.
  prefs: []
  type: TYPE_NORMAL
- en: '`body_mass_g` is the quantitative continuous variable and will be the dependent
    variable, whereas `species` and `sex` are both qualitative variables.'
  prefs: []
  type: TYPE_NORMAL
- en: Those two last variables will be our independent variables, also referred as
    factors. Make sure that they are read as [factors](https://statsandr.com/blog/data-types-in-r/#factor)
    by R. If it is not the case, they will need to be [transformed to factors](https://statsandr.com/blog/data-manipulation-in-r/#factors).
  prefs: []
  type: TYPE_NORMAL
- en: Aim and hypotheses of a two-way ANOVA
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As mentioned above, a two-way ANOVA is used to **evaluate simultaneously the
    effect of two categorical variables on one quantitative continuous variable**.
  prefs: []
  type: TYPE_NORMAL
- en: It is referred as **two**-way ANOVA because we are comparing groups which are
    formed by **two** independent categorical variables.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here, we would like to know if body mass depends on species and/or sex. In
    particular, we are interested in:'
  prefs: []
  type: TYPE_NORMAL
- en: measuring and testing the relationship between species and body mass,
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: measuring and testing the relationship between sex and body mass, and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: potentially check whether the relationship between species and body mass is
    different for females and males (which is equivalent than checking whether the
    relationship between sex and body mass depends on the species)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The first two relationships are referred as **main effects**, while the third
    point is known as the **interaction effect**.
  prefs: []
  type: TYPE_NORMAL
- en: The main effects test whether at least one group is different from another one
    (while controlling for the other independent variable). On the other hand, the
    interaction effect aims at testing whether the relationship between two variables
    differs *depending on the level of a third variable*.
  prefs: []
  type: TYPE_NORMAL
- en: When performing a two-way ANOVA, testing the interaction effect is not mandatory.
    However, omitting an interaction effect may lead to erroneous conclusions if the
    interaction effect is present.
  prefs: []
  type: TYPE_NORMAL
- en: 'If we go back to our example, we have the following [hypothesis tests](https://statsandr.com/blog/hypothesis-test-by-hand/):'
  prefs: []
  type: TYPE_NORMAL
- en: 'Main effect of sex on body mass:'
  prefs: []
  type: TYPE_NORMAL
- en: 'H0: mean body mass is equal between females and males'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'H1: mean body mass is different between females and males'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Main effect of species on body mass:'
  prefs: []
  type: TYPE_NORMAL
- en: 'H0: mean body mass is equal between all 3 species'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'H1: mean body mass is different for at least one species'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Interaction between sex and species:'
  prefs: []
  type: TYPE_NORMAL
- en: 'H0: there is no interaction between sex and species, meaning that the relationship
    between species and body mass is the same for females and males (similarly, the
    relationship between sex and body mass is the same for all 3 species)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'H1: there is an interaction between sex and species, meaning that the relationship
    between species and body mass is different for females than for males (similarly,
    the relationship between sex and body mass depends on the species)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Assumptions of a two-way ANOVA
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Most statistical tests require some assumptions for the results to be valid,
    and a two-way ANOVA is not an exception.
  prefs: []
  type: TYPE_NORMAL
- en: 'Assumptions of a two-way ANOVA are similar than for a one-way ANOVA. To summarize:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Variable type**: the dependent variable must be quantitative continuous,
    while the two independent variables must be categorical (with at least two levels).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Independence**: the observations should be independent between groups and
    within each group.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Normality**:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For small samples, data should follow approximately a [normal distribution](https://statsandr.com/blog/do-my-data-follow-a-normal-distribution-a-note-on-the-most-widely-used-distribution-and-how-to-test-for-normality-in-r/)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For large samples (usually n ≥ 30 in each group/sample), normality is not required
    (thanks to the central limit theorem)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Equality of variances**: variances should be equal across groups.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Outliers**: There should be no significant [outliers](https://statsandr.com/blog/outliers-detection-in-r/)
    in any group.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: More details about these assumptions can be found in the [assumptions of a one-way
    ANOVA](https://statsandr.com/blog/anova-in-r/#underlying-assumptions-of-anova).
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have seen the underlying assumptions of the two-way ANOVA, we review
    them specifically for our dataset before applying the test and interpreting the
    results.
  prefs: []
  type: TYPE_NORMAL
- en: Variable type
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The dependent variable body mass is [quantitative continuous](https://statsandr.com/blog/variable-types-and-examples/#continuous),
    while both independent variables sex and species are [qualitative variables](https://statsandr.com/blog/variable-types-and-examples/#qualitative)
    (with at least 2 levels).
  prefs: []
  type: TYPE_NORMAL
- en: Therefore, this assumption is met.
  prefs: []
  type: TYPE_NORMAL
- en: Independence
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Independence is usually checked based on the design of the experiment and how
    data have been collected.
  prefs: []
  type: TYPE_NORMAL
- en: 'To keep it simple, observations are usually:'
  prefs: []
  type: TYPE_NORMAL
- en: '**independent** if each experimental unit (here a penguin) has been measured
    only once and the observations are collected from a representative and randomly
    selected portion of the population, or'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**dependent** if each experimental unit has been measured at least twice (as
    it is often the case in the medical field for example, with two measurements on
    the same subjects; one before and one after the treatment).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In our case, body mass has been measured only once on each penguin, and on a
    representative and random sample of the population, so the independence assumption
    is met.
  prefs: []
  type: TYPE_NORMAL
- en: Normality
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We have a large sample in all subgroups (each combination of the levels of
    the two factors, called cell):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: so normality does not need to be checked.
  prefs: []
  type: TYPE_NORMAL
- en: For completeness, we still show how to verify normality, as if we had a small
    samples.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are several methods to test the normality assumption. The most common
    methods being:'
  prefs: []
  type: TYPE_NORMAL
- en: a [QQ-plot](https://statsandr.com/blog/descriptive-statistics-in-r/#qq-plot)
    by group or on the residuals, and/or
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: a [histogram](https://statsandr.com/blog/descriptive-statistics-in-r/#histogram)
    by group or on the residuals, and/or
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: a [normality test](https://statsandr.com/blog/do-my-data-follow-a-normal-distribution-a-note-on-the-most-widely-used-distribution-and-how-to-test-for-normality-in-r/#normality-test)
    (Shapiro-Wilk test for instance) by group or on the residuals.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The easiest/shortest way is to verify the normality with a QQ-plot on the residuals.
    To draw this plot, we first need to save the model:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: This piece of code will be explained further.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now we can draw the QQ-plot on the residuals. We show two ways to do so, first
    with the `plot()` function and second with the `qqPlot()` function from the `{car}`
    package:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/b4b619c159fecb34124a97fc3a67bc63.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/712c0808ee4a81a830869e4dc744d616.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: Code for method 1 is slightly shorter, but it misses the confidence interval
    around the reference line.
  prefs: []
  type: TYPE_NORMAL
- en: If points follow the straight line (called Henry’s line) and fall within the
    confidence band, we can assume normality. This is the case here.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you prefer to verify the normality based on a histogram of the residuals,
    here is the code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/864cf95ccceef226c5b3f57912831254.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: The histogram of the residuals show a gaussian distribution, which is in line
    with the conclusion from the QQ-plot.
  prefs: []
  type: TYPE_NORMAL
- en: 'Although the QQ-plot and histogram is largely enough to verify the normality,
    if you want to test it more formally with a statistical test, the Shapiro-Wilk
    test can be applied on the residuals as well:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: ⇒ We do not reject the null hypothesis that the residuals follow a normal distribution
    (p-value = 0.937).
  prefs: []
  type: TYPE_NORMAL
- en: From the QQ-plot, histogram and Shapiro-Wilk test, we conclude that we do not
    reject the null hypothesis of normality of the residuals.
  prefs: []
  type: TYPE_NORMAL
- en: The normality assumption is thus verified, we can now check the equality of
    the variances.[2](https://statsandr.com/blog/two-way-anova-in-r/#fn2)
  prefs: []
  type: TYPE_NORMAL
- en: Homogeneity of variances
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Equality of variances, also referred as homogeneity of variances or homoscedasticity,
    can be verified visually with the `plot()` function:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/507ae2c823fcdc60986559c5a115501a.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: Since the spread of the residuals is constant, the red smooth line is horizontal
    and flat, so it looks like the constant variance assumption is satisfied here.
  prefs: []
  type: TYPE_NORMAL
- en: The diagnostic plot above is sufficient, but if you prefer it can also be tested
    more formally with the Levene’s test (also from the `{car}` package):[3](https://statsandr.com/blog/two-way-anova-in-r/#fn3)
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: ⇒ We do not reject the null hypothesis that the variances are equal (p-value
    = 0.227).
  prefs: []
  type: TYPE_NORMAL
- en: Both the visual and formal approaches give the same conclusion; we do not reject
    the hypothesis of homogeneity of the variances.
  prefs: []
  type: TYPE_NORMAL
- en: Outliers
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The easiest and most common way to [detect outliers](https://statsandr.com/blog/descriptive-statistics-in-r/)
    is visually thanks to boxplots by groups.
  prefs: []
  type: TYPE_NORMAL
- en: 'For females and males:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/c50041e09cc44b1d4b3e5bc9a4b9a339.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: 'For the three species:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/2f8c7ecce381ed282db2032833f1d9ea.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: There are, as defined by the [interquartile range criterion](https://statsandr.com/blog/descriptive-statistics-in-r/#interquartile-range),
    two outliers for the species Chinstrap. These points are, nonetheless, not extreme
    enough to bias results.
  prefs: []
  type: TYPE_NORMAL
- en: Therefore, we consider that the assumption of no significant outliers is met.
  prefs: []
  type: TYPE_NORMAL
- en: Two-way ANOVA
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We have shown that all assumptions are met, so we can now proceed to the implementation
    of the two-way ANOVA in R.
  prefs: []
  type: TYPE_NORMAL
- en: 'This will allow us to answer the following research questions:'
  prefs: []
  type: TYPE_NORMAL
- en: Controlling for the species, is body mass significantly different between the
    two sexes?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Controlling for the sex, is body mass significantly different for at least one
    species?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Is the relationship between species and body mass different between female and
    male penguins?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Preliminary analyses
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Before performing any statistical test, it is a good practice to make some [descriptive
    statistics](https://statsandr.com/blog/descriptive-statistics-in-r/) in order
    to have a first overview of the data, and perhaps, have a glimpse of the results
    to be expected.
  prefs: []
  type: TYPE_NORMAL
- en: This can be done via descriptive statistics or plots.
  prefs: []
  type: TYPE_NORMAL
- en: Descriptive statistics
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'If we want to keep it simple, we can compute only the mean for each subgroup:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 'Or eventually, the mean and [standard deviation](https://statsandr.com/blog/descriptive-statistics-by-hand/#standard-deviation)
    for each subgroup using the `{dplyr}` package:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: Plots
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you are a frequent reader of the blog, you know that I like to draw plots
    to visualize the data at hand before interpreting results of a test.
  prefs: []
  type: TYPE_NORMAL
- en: 'The most appropriate plot when we have one quantitative and two qualitative
    variables is a [boxplot](https://statsandr.com/blog/descriptive-statistics-in-r/#boxplot)
    by group. This can easily be made with the `[{ggplot2}](https://statsandr.com/blog/graphics-in-r-with-ggplot2/)`
    [package](https://statsandr.com/blog/graphics-in-r-with-ggplot2/):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/9f1d0107fe31a38ded9639af9e8d31c4.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: 'Some observations are missing for the sex, we can remove them to have a more
    concise plot:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/b0817a0baf070892d0d1203012d168fe.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: 'Note that we could also have made the following plot:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/c52590eb50a39ffde9eab4bd2c6d85ee.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: But for a more readable plot, I tend to prefer putting the variable with the
    smallest number of levels as color (which is in fact the argument `fill` in the
    `aes()` layer) and the variable with the largest number of categories on the x-axis
    (i.e., the argument `x` in the `aes()` layer).
  prefs: []
  type: TYPE_NORMAL
- en: 'From the means and the boxplots by subgroup, we can already see that, *in our
    sample*:'
  prefs: []
  type: TYPE_NORMAL
- en: female penguins tend to have a lower body mass than males, and that is the case
    for all the considered species, and
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: body mass is higher for Gentoo penguins than for the other two species.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Bear in mind that these conclusions are only valid within our [sample](https://statsandr.com/blog/what-is-the-difference-between-population-and-sample/)!
    To generalize these conclusions to the [population](https://statsandr.com/blog/what-is-the-difference-between-population-and-sample/),
    we need to perform the two-way ANOVA and check the significance of the explanatory
    variables. This is the aim of the next section.
  prefs: []
  type: TYPE_NORMAL
- en: Two-way ANOVA in R
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As mentioned earlier, including an interaction effect in a two-way ANOVA is
    not compulsory. However, in order to avoid flawed conclusions, it is recommended
    to first check whether the interaction is significant or not, and depending on
    the results, include it or not.
  prefs: []
  type: TYPE_NORMAL
- en: If the interaction is not significant, it is safe to remove it from the final
    model. On the contrary, if the interaction is significant, it should be included
    in the final model which will be used to interpret results.
  prefs: []
  type: TYPE_NORMAL
- en: 'We thus start with a model which includes the two main effects (i.e., sex and
    species) and the interaction:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: The sum of squares (column `Sum Sq`) shows that the species explain a large
    part of the variability of body mass. It is the most important factor in explaining
    this variability.
  prefs: []
  type: TYPE_NORMAL
- en: 'The p-values are displayed in the last column of the output above (`Pr(>F)`).
    From these p-values, we conclude that, at the 5% significance level:'
  prefs: []
  type: TYPE_NORMAL
- en: controlling for the species, body mass is significantly different between the
    two sexes,
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: controlling for the sex, body mass is significantly different for at least one
    species, and
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: the interaction between sex and species (displayed at the line `sex:species`
    in the output above) is significant.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: So from the significant interaction effect, we have just seen that the relationship
    between body mass and species is different between males and females. Since it
    is significant, we have to keep it in the model and we should interpret results
    from that model.
  prefs: []
  type: TYPE_NORMAL
- en: 'If, on the contrary, the interaction was not significant (that is, if the p-value
    ≥ 0.05) we would have removed this interaction effect from the model. For illustrative
    purposes, below the code for a two-way ANOVA without interaction, referred as
    an additive model:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: 'For the readers who are used to perform [linear regressions in R](https://statsandr.com/blog/multiple-linear-regression-made-simple/),
    you will notice that the structure of the code for a two-way ANOVA is in fact
    similar:'
  prefs: []
  type: TYPE_NORMAL
- en: the formula is `dependent variable ~ independent variables`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: the `+` sign is used to include independent variables *without* an interaction[4](https://statsandr.com/blog/two-way-anova-in-r/#fn4)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: the `*` sign is used to include independent variables *with* an interaction
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The resemblance with a linear regression is not a surprise because a two-way
    ANOVA, like all ANOVA, is actually a linear model.
  prefs: []
  type: TYPE_NORMAL
- en: 'Note that the following code works as well, and give the same results:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE34]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE35]'
  prefs: []
  type: TYPE_PRE
- en: Note that the `aov()` function assumes a **balanced design**, meaning that we
    have equal sample sizes within levels of our independent grouping variables. Moreover,
    `aov()` uses the type I sums of squares, so we can obtain different p-values when
    we write `y ~ A * B` and `y ~ B * A`.
  prefs: []
  type: TYPE_NORMAL
- en: 'For **unbalanced design**, that is, unequal numbers of subjects in each subgroup,
    the recommended methods are:'
  prefs: []
  type: TYPE_NORMAL
- en: the type II ANOVA when there is **no** significant interaction, which can be
    done in R with `Anova(mod, type = "II")`,[5](https://statsandr.com/blog/two-way-anova-in-r/#fn5)
    and
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: the type III ANOVA when there is a significant interaction, which can be done
    in R with `Anova(mod, type = "III")`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This is beyond the scope of the post and we assume a balanced design here. For
    the interested reader, see this [detailed discussion](https://mcfromnz.wordpress.com/2011/03/02/anova-type-iiiiii-ss-explained/)
    about type I, type II and type III ANOVA.
  prefs: []
  type: TYPE_NORMAL
- en: Pairwise comparisons
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Through the two main effects being significant, we concluded that:'
  prefs: []
  type: TYPE_NORMAL
- en: controlling for the species, body mass is different between females and males,
    and
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: controlling for the sex, body mass is different for at least one species.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If body mass is different between the two sexes, given that there are exactly
    two sexes, it must be because body mass is significantly different between females
    and males.
  prefs: []
  type: TYPE_NORMAL
- en: If one wants to know which sex has the highest body mass, it can be deduced
    from the means and/or boxplots by subgroup. Here, it is clear that males have
    a significantly higher body mass than females.
  prefs: []
  type: TYPE_NORMAL
- en: However, it is not so straightforward for the species. Let me explain why it
    is not as easy as for the sexes.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are three species (Adelie, Chinstrap and Gentoo), so there are 3 pairs
    of species:'
  prefs: []
  type: TYPE_NORMAL
- en: Adelie and Chinstrap
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Adelie and Gentoo
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Chinstrap and Gentoo
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'If body mass is significantly different for at least one species, it could
    be that:'
  prefs: []
  type: TYPE_NORMAL
- en: body mass is significantly different between Adelie and Chinstrap but not significantly
    different between Adelie and Gentoo, and not significantly different between Chinstrap
    and Gentoo, or
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: body mass is significantly different between Adelie and Gentoo but not significantly
    different between Adelie and Chinstrap, and not significantly different between
    Chinstrap and Gentoo, or
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: body mass is significantly different between Chinstrap and Gentoo but not significantly
    different between Adelie and Chinstrap, and not significantly different between
    Adelie and Gentoo.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Or, it could also be that:'
  prefs: []
  type: TYPE_NORMAL
- en: body mass is significantly different between Adelie and Chinstrap, and between
    Adelie and Gentoo, but not significantly different between Chinstrap and Gentoo,
    or
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: body mass is significantly different between Adelie and Chinstrap, and between
    Chinstrap and Gentoo, but not significantly different between Adelie and Gentoo,
    or
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: body mass is significantly different between Chinstrap and Gentoo, and between
    Adelie and Gentoo, but not significantly different between Adelie and Chinstrap.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Last, it could also be that body mass is significantly different between **all**
    species.
  prefs: []
  type: TYPE_NORMAL
- en: As for a [one-way ANOVA](https://statsandr.com/blog/anova-in-r/), we cannot,
    at this stage, know precisely which species is different from which one in terms
    of body mass. To know this, we need to compare each species two by two thanks
    to post-hoc tests (also known as pairwise comparisons).
  prefs: []
  type: TYPE_NORMAL
- en: There are several post-hoc tests, the most common one being the Tukey HSD, which
    tests all possible pairs of groups. As mentioned earlier, this test only needs
    to be done on the species variable because there are only two levels for the sex.
  prefs: []
  type: TYPE_NORMAL
- en: 'As for the one-way ANOVA, the Tukey HSD can be done in R as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE36]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE37]'
  prefs: []
  type: TYPE_PRE
- en: 'or using the `{multcomp}` package:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE39]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE40]'
  prefs: []
  type: TYPE_PRE
- en: or using the `pairwise.t.test()` function using the p-value adjustment method
    of your choice:[6](https://statsandr.com/blog/two-way-anova-in-r/#fn6)
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE42]'
  prefs: []
  type: TYPE_PRE
- en: Note that when using the second method, it is the model without the interaction
    that needs to be specified into the `glht()` function, even if the interaction
    is significant. Moreover, do not forget to replace `mod` and `species` in my code
    with the name of your model and the name of your independent variable.
  prefs: []
  type: TYPE_NORMAL
- en: 'Both methods give the same results, that is:'
  prefs: []
  type: TYPE_NORMAL
- en: body mass is *not* significantly different between Chinstrap and Adelie (adjusted
    p-value = 0.83),
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: body mass is significantly different between Gentoo and Adelie (adjusted p-value
    < 0.001), and
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: body mass is significantly different between Gentoo and Chinstrap (adjusted
    p-value < 0.001).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Remember that it is the **adjusted** p-values that are reported, to prevent
    the [issue of multiple testing](https://statsandr.com/blog/anova-in-r/#issue-of-multiple-testing)
    which occurs when comparing several pairs of groups.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you would like to compare all combinations of groups, it can be done with
    the `TukeyHSD()` function and specifying the interaction in the `which` argument:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE43]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE44]'
  prefs: []
  type: TYPE_PRE
- en: 'Or with the `HSD.test()` function from the `{agricolae}` package, which denotes
    subgroups that are not significantly different from each other with the same letter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE45]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE46]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE47]'
  prefs: []
  type: TYPE_PRE
- en: 'If you have many groups to compare, plotting them might be easier to interpret:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE48]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE49]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/00df3d37a8dd5b5fa56a247b1a376dd7.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: From the outputs and plot above, we conclude that all combinations of sex and
    species are significantly different, except between female Chinstrap and female
    Adelie (p-value = 0.138) and male Chinstrap and male Adelie (p-value = 0.581).
  prefs: []
  type: TYPE_NORMAL
- en: These results, which are by the way in line with the boxplots shown above and
    which will be confirmed with the visualizations below, concludes the two-way ANOVA
    in R.
  prefs: []
  type: TYPE_NORMAL
- en: Visualizations
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you would like to visualize results in a different way to what has already
    been presented in the preliminary analyses, below are some ideas of useful plots.
  prefs: []
  type: TYPE_NORMAL
- en: 'First, with the mean and standard error of the mean by subgroup using the `allEffects()`
    function from the `{effects}` package:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE50]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE51]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/7cc474320810b00de7c76f86d8e3505b.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: 'Or using the `{ggpubr}` package:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE52]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE53]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/7ce0d965287b2ff3e9045b1747a0565d.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: 'Alternatively, using `{Rmisc}` and `{ggplot2}`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE54]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE55]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/2b9715a46ac806fc7b4d2524d86c55d4.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: 'Second, if you prefer to draw only the mean by subgroup:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE56]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/52e323eee886597e786bee242152bc3d.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot by author
  prefs: []
  type: TYPE_NORMAL
- en: 'Last but not least, for those of you who are familiar with GraphPad, you are
    most likely familiar with plotting means and error bars as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE57]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/a4c790aca40f652162e60b1f69636409.png)'
  prefs: []
  type: TYPE_IMG
- en: Conclusion
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this post, we started with a few reminders of the different tests that exist
    to compare a quantitative variable across groups. We then focused on the two-way
    ANOVA, starting from its goal and hypotheses to its implementation in R, together
    with the interpretations and some visualizations. We also briefly mentioned its
    underlying assumptions and one post-hoc test to compare all subgroups.
  prefs: []
  type: TYPE_NORMAL
- en: All this was illustrated with the `penguins` dataset available from the `{palmerpenguins}`
    package.
  prefs: []
  type: TYPE_NORMAL
- en: Thanks for reading.
  prefs: []
  type: TYPE_NORMAL
- en: I hope this article will help you in conducting a two-way ANOVA with your data.
  prefs: []
  type: TYPE_NORMAL
- en: As always, if you have a question or a suggestion related to the topic covered
    in this article, please add it as a comment so other readers can benefit from
    the discussion.
  prefs: []
  type: TYPE_NORMAL
- en: In theory, a one-way ANOVA can also be used to compare 2 groups, and not only
    3 or more. Nonetheless, in practice, it is often the case that a Student’s t-test
    is performed to compare 2 groups, and a one-way ANOVA to compare 3 or more groups.
    Conclusions obtained via a Student’s t-test for independent samples and a one-way
    ANOVA with 2 groups will be similar.[↩︎](https://statsandr.com/blog/two-way-anova-in-r/#fnref1)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note that if the normality assumption is not met, many transformations can be
    applied to improve it, the most common one being the logarithmic transformation
    (`log()` function in R).[↩︎](https://statsandr.com/blog/two-way-anova-in-r/#fnref2)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note that the Bartlett’s test is also appropriate to test the assumption of
    equal variances.[↩︎](https://statsandr.com/blog/two-way-anova-in-r/#fnref3)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: An additive model makes the assumption that the 2 explanatory variables are
    independent; they do not interact with each other.[↩︎](https://statsandr.com/blog/two-way-anova-in-r/#fnref4)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Where `mod` is the name of your saved model.[↩︎](https://statsandr.com/blog/two-way-anova-in-r/#fnref5)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Here, we use the Benjamini & Hochberg (1995) correction, but you can choose
    between several methods. See `?p.adjust` for more details.[↩︎](https://statsandr.com/blog/two-way-anova-in-r/#fnref6)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Related articles
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[ANOVA in R](https://statsandr.com/blog/anova-in-r/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Student’s t-test in R and by hand: how to compare two groups under different
    scenarios?](https://statsandr.com/blog/student-s-t-test-in-r-and-by-hand-how-to-compare-two-groups-under-different-scenarios/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[One-sample Wilcoxon test in R](https://statsandr.com/blog/one-sample-wilcoxon-test-in-r/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Kruskal-Wallis test, or the nonparametric version of the ANOVA](https://statsandr.com/blog/kruskal-wallis-test-nonparametric-version-anova/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Hypothesis test by hand](https://statsandr.com/blog/hypothesis-test-by-hand/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Originally published at* [*https://statsandr.com*](https://statsandr.com/blog/two-way-anova-in-r/)
    *on June 19, 2023.*'
  prefs: []
  type: TYPE_NORMAL
