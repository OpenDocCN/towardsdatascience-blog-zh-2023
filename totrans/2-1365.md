# F1分数真的比准确率更好吗？

> 原文：[https://towardsdatascience.com/is-f1-score-really-better-than-accuracy-5f87be75ae01](https://towardsdatascience.com/is-f1-score-really-better-than-accuracy-5f87be75ae01)

## 根据不同指标，错误（和正确）的成本是多少？

[](https://medium.com/@mazzanti.sam?source=post_page-----5f87be75ae01--------------------------------)[![Samuele Mazzanti](../Images/432477d6418a3f79bf25dec42755d364.png)](https://medium.com/@mazzanti.sam?source=post_page-----5f87be75ae01--------------------------------)[](https://towardsdatascience.com/?source=post_page-----5f87be75ae01--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----5f87be75ae01--------------------------------) [Samuele Mazzanti](https://medium.com/@mazzanti.sam?source=post_page-----5f87be75ae01--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----5f87be75ae01--------------------------------) ·10分钟阅读·2023年4月18日

--

![](../Images/a09fe8380a1e7a9f6979a654ee98ace5.png)

[图片来源：作者]

如果你搜索“哪个指标更好，准确率还是F1分数？”，你可能会找到类似的答案：

> “如果你的数据集不平衡，忘记准确率，选择F1分数。”

如果你寻找解释，可能会发现对“假阴性和假阳性相关的‘不同成本’”的模糊提及。但这些来源并没有明确说明不同指标中这些成本是什么。

这就是我觉得需要写这篇文章的原因：尝试回答以下问题。误报和漏报的成本在准确率中是什么？在F1分数中又是什么？是否有某种指标可以让我们为这些成本分配自定义的值？

# 从混淆矩阵开始

准确率和F1分数都可以从所谓的**混淆矩阵**中计算得出。混淆矩阵是一个方阵，用于比较我们模型预测的标签与真实标签。

这是一个包含两个标签：0（即负类）和1（即正类）的混淆矩阵示例。请注意，在本文中，我们将专注于二分类，但我们所说的内容可以推广到多分类情况。

![](../Images/624a6f85dbff501b72b18ed7511fe32a.png)

二分类器的混淆矩阵。矩阵的元素包括真阴性（TN）、假阳性（FP）、假阴性（FN）和真阳性（TP）。 [图片来源：作者]

由于比较，我们的观察结果可能会落入以下4种情况：

+   真阴性（TN）：我们的模型正确预测了0。

+   假阳性（FP）：我们的模型预测为1，但真实标签是0。

+   假阴性（FN）：我们的模型预测为0，但真实标签是1。

+   真阳性（TP）：我们的模型正确预测了1。

在 Python 中，获取分类器的混淆矩阵最简单的方法是通过 Scikit-learn 的 `confusion_matrix`。这个函数有两个必需的参数：`y_true`（真实值数组）和 `y_pred`（预测值数组）。在这种情况下，我还将设置可选参数 `normalize="all"` 以获取观察值的相对计数，而不是绝对计数。

我使用了一个包含 20% 正类的数据集，并在其上训练了一个模型。这是测试集上的混淆矩阵：

![](../Images/f50f34698c75e0b0e2b077a7be237294.png)

使用 Scikit-learn 计算混淆矩阵。[图片由作者提供]

这是一个更友好的结果可视化：

![](../Images/82b65d83efd6013a52fb8f2983c21364.png)

混淆矩阵。[图片由作者提供]

我们一起来阅读一下：

+   真负类（TN）：78% 的测试集被正确标记为 0。

+   假正类（FP）：2% 的测试集被错误标记为 1。

+   假负类（FN）：9% 的测试集被错误标记为 0。

+   真正类（TP）：11% 的测试集被正确标记为 1。

混淆矩阵为我们提供了关于分类器的所有信息。然而，我们通常需要一个能够总结模型性能的单一指标。

两个最受欢迎的指标是准确率和 F1-score。我们来看看如何从混淆矩阵中计算这两个指标：

+   **准确率: 正确分类的项目百分比**。它可以通过正确分类的观察值百分比来计算。拥有混淆矩阵后，这就是主对角线上的元素之和，在本例中为：78% + 11% = 89%。

+   **F1-score: 精确度和召回率（正类）的调和均值**。这个指标相比准确率稍显不直观。由于 F1 是基于精确度和召回率的，我们先来看一下如何计算这两个指标。精确度是指被正确分类的预测正类的百分比，所以 `precision = TP/(FP+TP) = 11%/(2%+11%) = 85%`。召回率是指被正确分类的实际正类的百分比，所以 `recall = TP/(FN+TP) = 11%/(9%+11%) = 55%`。得到精确度和召回率后，F1 是这两个数量的调和均值，所以：`f1_score = (2*precision*recall)/(precision+recall) = (2*85%*55%)/(85%+55%) = 67%`。

现在我们了解了准确率和 F1-score，我们继续前进。

# 从一个矩阵到多个矩阵

你可能没有注意到，但我们上面看到的混淆矩阵来源于一个任意选择。

确实，二分类器的输出——最原始的形式——不是标签数组，而是概率数组。对于每个观察值，分类器输出它属于正类的概率。要从概率转到标签，我们需要设置一个概率阈值。

通常，默认的阈值设置为 50%：任何高于 50% 的观察值将被分类为 1，而低于该水平的观察值将被分类为 0。

然而，取决于具体应用，可能更适合使用不同的阈值。让我们看看根据我们设置的阈值混淆矩阵会如何变化。

![](../Images/be51f125e6bbd480a9fe06e4a7bb4899.png)

二分类器的混淆矩阵，取决于概率阈值。[图片来源：作者]

当然，随着阈值的增加，我们标记为正例的观察结果越来越少：这就是为什么“1”列下的值越来越小。

在这里，我们看到了6个不同的阈值作为示例。然而，可能的阈值通常有成千上万。在这些情况下，绘制图表更为方便。然而，由于概率阈值不太直观，我觉得在*X*轴上显示被预测为正例的观察百分比，而不是阈值本身，更为方便。

![](../Images/c057e50e95ad606c3f8e35bc4e16cc0f.png)

根据概率阈值（即预测正例的百分比），混淆矩阵的四个元素。[图片来源：作者]

此外，就我们的目的而言，直接查看准确率和F1分数可能比查看混淆矩阵的原始值更有趣。

![](../Images/a263f09e2805ade404632ca38df05b9e.png)

准确率和F1分数，取决于概率阈值（即预测正例的百分比）。[图片来源：作者]

由于准确率和F1分数都是越大越好的指标，我们会**选择使得相应指标达到最高值的阈值**。因此，在上述图表中，我画了一条虚线，标示出相应指标的最大值。

如你所见，不同的指标会导致我们选择不同的阈值。特别是：

+   准确率会使我们选择一个较高的概率阈值，以使14%的观察结果被分类为正例。

+   F1分数会使我们选择一个较小的概率阈值，使更多的观察结果（19%）被分类为正例。

那么，我们应该选择哪个指标呢？

# 错误预测的成本

实践者的普遍智慧是，在不平衡问题中，F1分数必须优于准确率。

然而，如果你去寻找为什么F1分数被认为优于准确率的原因，你会发现解释模糊。许多解释围绕“不同成本”展开，这些成本与假阴性和假阳性有关。但它们从未明确量化这些成本。

此外，仅仅关注错误会使我们对问题的理解变得有限。事实上，**如果错误预测确实会带来成本，那么正确预测必然会带来收益**。

因此，我们应该考虑不仅是假阳性和假阴性的成本，还要考虑真正阳性和真正阴性的价值。从这个想法出发，我们可以得出一个新的矩阵——我称之为“价值矩阵”——它为混淆矩阵的每个元素分配一个（可能是经济的）价值。

这个矩阵有什么意义？

好吧，由于它为混淆矩阵中的每个量分配了一个值，因此将这两个矩阵（逐元素）相乘以获得任何组（TN、FP、FN、TP）的预期值是很自然的。

这是一个预期值，因为混淆矩阵包含属于任何组的观察百分比。作为百分比，这可以被解释为概率。因此，**将这个概率乘以（可能是经济的）值给我们一个预期值**。

将真阴性、假阳性、假阴性和真正性预期值相加，给出整个模型的预期值。

![](../Images/b5dfbd3165f161ebb5d175bb71cb2c13.png)

二分类器的预期值。混淆矩阵包含每个元素的频率。值矩阵包含每个元素的值（利润或损失）。两个矩阵的元素乘积得出每个组件的预期值。最后，我们将它们相加，得到模型的整体预期值。[图像来源：作者]

对混淆矩阵和值矩阵的分解对非技术利益相关者也非常直观。毕竟，每个人都能理解百分比和美元！

到此，我们准备回答最初的问题：**准确率和F1-score的值矩阵是什么？**

# 查找准确率的值矩阵

我们已经看到，准确率只是将混淆矩阵主对角线上的值相加。因此，直接证明**准确率的值矩阵是单位矩阵**是很简单的。

![](../Images/1b1e6fccbbfbe2409247e5ed5e730749.png)

准确率作为分类器的预期值。[图像来源：作者]

准确率的缺陷应该是显而易见的：它等同于假设在正确预测（真正性或假阴性）情况下我们获得1，而在错误预测情况下我们不损失任何东西。**这种假设对于大多数用例至少是不太可能的**。

# 查找F1-score的值矩阵

那么，在F1-score中，与正确/错误答案相关的值是什么？

在实践中，我们希望找出值矩阵的哪些元素会给我们得到的F1-score。这对应于填补以下图中的问号：

![](../Images/ebfaefa4e1d661f6c7b52b7b7cf2bcfa.png)

F1-score作为分类器的预期值。[图像来源：作者]

不幸的是，对于我们来说，答案不像准确率那样简单。事实上，在这种情况下，没有闭式解。然而，我们可以利用从不同阈值中提取的信息：

![](../Images/85c2d844b3d426f568e926077a154127.png)

不同混淆矩阵的F1-score（基于不同的概率阈值）。[图像来源：作者]

我们可以使用真负样本、假阳性、假负样本和真阳性作为自变量，将结果F1分数作为因变量。只需进行线性回归即可获得结果系数的估计值（即填充值矩阵的数字）。

在这种情况下，我们得到的值如下：

![](../Images/51092ab9668d4bebced1cd2c9dbecbbe.png)

F1分数的值矩阵（通过线性回归估计）。[作者图片]

从这里可以看出，**F1分数更注重正样本（无论它们被分类为0还是1）**。

注意这是一个近似解！与准确率不同，这里不存在值矩阵的精确解。如果你感兴趣，这是我们的结果（虚线）与F1分数实际曲线的比较。

![](../Images/f5f6c77f8e3fc50a67a59575c53fa154.png)

实际F1分数与我们估计的曲线。[作者图片]

# 超越准确率和F1分数

我们已经看过准确率和F1分数的值矩阵。前者是任意的，而后者甚至不能直接计算（无论如何都会是近似解）。

> 那么，为什么不直接设置我们的自定义值矩阵呢？

实际上，根据你的使用案例，应该相对容易计算错误（正确）预测对你来说的成本（价值）。

举个例子。你想预测哪些客户更可能流失。你知道一个客户平均每月价值$10。为了防止客户离开公司，你想给他们提供一个折扣，每个客户减少$2的利润（这里假设折扣会被所有人接受）。

所以你的值矩阵将是如下：

![](../Images/22fb800de9dc5b447c70644d4f8eecfc.png)

流失示例的值矩阵。[作者图片]

为什么会这样？

+   真负样本：$0。你的预测任务不会影响它们，所以值为0。

+   假阳性：-$2。你给了他们折扣，但他们本来也不会流失，因此你无故减少了$2的利润。

+   假负样本：$0。你的预测任务不会影响它们，所以值为0。

+   真阳性：+$8。你正确预测了他们会流失，因此你节省了$8（$10减去由于你的行为产生的$2）。

问题在于，值矩阵的特性完全取决于你的具体使用案例。

例如，让我们设置一些示例值矩阵，并观察相应的期望值如何变化。

![](../Images/bc78e8b0bb75c64d6bfcaf93c0d61f55.png)

一些示例说明了分类器的期望值如何根据值矩阵变化。[作者图片]

我们可以对所有可能的阈值重复这个过程：

![](../Images/5d4e729e327fa8aa4ace7679c6f7f6b9.png)

分类器的期望值，取决于正确/错误预测相关的值。[作者图片]

与准确率和F1分数不同，这些自定义KPI可能会取负值。这是很有意义的！事实上，在现实世界中，有些情况可能导致你的分类器让你损失金钱。你肯定希望提前知道这种可能性，而这个自定义指标可以让你做到这一点。

观察三条曲线的行为很有趣。其他条件相同时，假阴性的高成本和假阳性的低成本（即从黑线移动到绿线）会激励我们将更多观察值预测为正例（即从16%增加到39%）。这很直观：假阴性的高成本会激励我们将更少的观察值分类为负例，反之亦然。

一般来说，使用自定义价值矩阵可以让你在精准率/召回率的权衡中找到最佳位置。

# 结论

在本文中，我们比较了准确率和F1分数，基于它们对错误的不同成本分配。

准确率有点过于简单，因为它给正确预测赋值1，而对错误赋值为零。另一方面，F1分数更像是一个黑箱：你总是需要反向工程来获得其价值矩阵（无论如何，这将是一个近似解）。

我的建议是使用自定义价值矩阵，这取决于你的具体应用。一旦你设置了价值矩阵，你可以将其与混淆矩阵相乘，得到分类器的期望值。这是唯一能让你了解在现实世界中使用你的分类器的实际经济影响的方法。

*感谢阅读！*

*如果你觉得我的工作有用，你可以订阅* [***每次我发布新文章时获得电子邮件通知***](https://medium.com/@mazzanti.sam/subscribe) *(通常每月一次)。*

*如果你想支持我的工作，你可以* [***请我喝咖啡***](https://ko-fi.com/samuelemazzanti)*。*

*如果你愿意，* [***加我LinkedIn***](https://www.linkedin.com/in/samuelemazzanti/)*！*
