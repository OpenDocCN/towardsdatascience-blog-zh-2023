# 6个你应该了解的与索引相关的Pandas操作

> 原文：[https://towardsdatascience.com/6-common-index-related-operations-you-should-know-about-pandas-783fdba59768](https://towardsdatascience.com/6-common-index-related-operations-you-should-know-about-pandas-783fdba59768)

## 在数据框中有效地处理索引

[](https://yongcui01.medium.com/?source=post_page-----783fdba59768--------------------------------)[![Yong Cui](../Images/475918ba9ca0ecd923abe2e7843582a9.png)](https://yongcui01.medium.com/?source=post_page-----783fdba59768--------------------------------)[](https://towardsdatascience.com/?source=post_page-----783fdba59768--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----783fdba59768--------------------------------) [Yong Cui](https://yongcui01.medium.com/?source=post_page-----783fdba59768--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----783fdba59768--------------------------------) ·阅读时间9分钟·2023年10月17日

--

![](../Images/6020659939470dfe03adf748de117f0e.png)

图片由 [Alejandro Luengo](https://unsplash.com/@aluengo91?utm_source=medium&utm_medium=referral) 提供，来源于 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

想象一下，你有一个装满成千上万本书的图书馆，每本书都包含大量信息。为了找到你需要的确切书籍，你会查看图书馆的索引（如果有的话），对吧？在处理实际数据时，拥有一个类似图书馆的索引对于你筛选大量数据、准确找到所需信息而无需翻遍每一部分是至关重要的。

在这篇文章中，我将分享一些常见但重要的与索引相关的操作，通过简单的适用场景来拆解这些操作。无论你是数据新手还是经验丰富的专业人士，你将很快看到这些操作如何成为你数据的最佳伙伴。

不再赘述，开始吧。

> 简单说明一下，在数据框中，行和列都被视为索引，但在大多数数据操作中，我们通常只将行视为感兴趣的索引，因为许多数据集以宽格式呈现——每一行代表一个数据记录，每一列代表数据记录的不同方面。
> 
> 在这篇文章中，我们将重点处理沿行操作索引。也就是说，每个索引项对应一行。

## 1. 设置索引

常见的数据操作从导入数据开始，比如CSV文件。下面的截图展示了来自GitHub的在线数据源。

![](../Images/73329ce32683c32ab7cf035499162acc.png)

本博客文章使用的源数据（由作者提供的截图）

当你导入这个文件时，你会看到一个“额外”的没有名称的列出现在我们在源文件中看到的三个列之前。

[PRE0]

![](../Images/9f022c6ce62e91264a1b7f7d3cd0a4f6.png)

从源读取的数据框显示索引

自动生成的索引从0开始，并为每个附加行递增1。你可以通过调用以下方法访问索引：

[PRE1]

如果你在之前知道数据结构，在本例中，数据集具有年和月作为数据的唯一标识符。你可以在读取数据时将这两列设置为索引，如下所示：

[PRE2]

请注意，由于我们将两个列设置为索引，我们正在创建一个使用多重索引的数据框：

[PRE3]

由于多重索引不是本文的重点，我不会在这里过多讨论。然而，如果你对多重索引感兴趣，请参考[我之前的文章](https://medium.com/p/e6aec29ee6d8)。

## 2\. 重置索引

让我们继续讨论具有多重索引的数据框。因为我们中的许多人不太习惯多重索引，我们仍然希望使用单一标量索引。为此，我们可以重置索引，如下所示：

[PRE4]

从输出中，你可以看出我们现在使用的是基于0的索引。对于`reset_index`函数，它有一个参数`drop`，默认设置为`False`，以通过将原始索引转换为列来保留原始索引。然而，有时你可能希望丢弃原始索引，例如在合并/组合数据框时。

[PRE5]

如上所示的简单示例，合并的数据框具有由两个数据框的索引组成的索引（顺便提一下，Pandas允许索引中有重复值）。在大多数情况下，我们不希望索引中有重复项，因此我们希望重置索引，如下所示。

[PRE6]

在上述代码片段中，我展示了当`drop`设置为`False`（默认值）和`True`时的对比。正如你所见，在这种情况下，理想的操作是后者——丢弃原始索引。

## 3\. 使用索引选择数据

我们已经学习了如何设置和重置索引，但我们可以用索引做些什么呢？正如你可能已经注意到的，索引标记了数据的位置，作为每行的标识符，因此第一个用途是使用索引进行数据选择。

在使用索引进行数据选择时，最常用的方法是使用`iloc`方法。以下代码演示了如何选择单行数据。

[PRE7]

如上所示，你可以使用一个数字——在本例中，0选择了第一行，或者你可以使用一个数字和： （选择所有列）。如果你想选择一个或一个子集的列，你需要指定列的索引：

[PRE8]

在上述示例中，`iloc[2, 0]`选择了第3行第1列的数据。请注意，行和列都使用基于0的索引。代码`iloc[2, :2]`选择第3行和前两个列（第0列和第1列）—就像其他Python切片操作一样，结束索引（在本例中为2）是不包括在内的。

另一个需要了解的事情是，当你有许多列时，通过计数来找出感兴趣列的索引可能会很繁琐。幸运的是，我们可以使用以下解决方案：

[PRE9]

## 4\. 使用索引合并数据

当你处理多个数据框时，你通常需要合并数据以进行后续处理。虽然你可以使用各种方法进行合并操作，如`merge`、`join`、`combine`和`concat`，但最通用的方法是`merge`。

在我的日常数据处理工作中，我大多使用命名列来进行`merge`。以下是一个代码示例。我们通过将现有年份加11来创建了一些模拟数据，并使用了`“year”`和`“month”`进行合并。

[PRE10]

但是，`merge`方法也支持基于索引的合并。以下是一个示例。

[PRE11]

如上所示，我们通过将`True`设置为`left_index`和`right_index`来指定使用索引。这种方式，我们得到一个合并后的数据框，其索引与单个数据框相同。

## 5\. 导出数据时包括/排除索引

当我们与合作伙伴一起工作时，我们需要共享数据集。数据的一种常见格式是CSV格式。因此，我们需要将数据框导出为CSV文件，如下所示：

[PRE12]

如上面的代码片段所示，我们使用`to_csv`方法创建一个CSV文件。你可能会注意到，当我们读取CSV文件时，我们发现CSV文件中有一个额外的列，除了我们开始时的3列。很容易看出，额外的列就是索引。也就是说，当你将数据框导出到CSV文件时，默认情况下会导出索引。然而，如果包含这个索引列可能会让其他人感到困惑，因此你可以通过以下方法覆盖默认行为：

[PRE13]

从打印输出中，你可以看出索引已经从导出的CSV文件中移除。这是因为我们在`to_csv`方法调用中将索引参数设置为False。此设置指示不要在导出的文件中包含索引。

## 6\. 在Groupby操作中将索引转换为列

当你汇总数据时，一种常见的方法是使用`groupby`方法。例如，在数据框中，我们想要找出每年的乘客总数，如下所示：

[PRE14]

如上所示，我们通过按年份分组数据来计算乘客总数。你可能没有注意到的一点是，输出的`total_passengers`是`Series`格式。

[PRE15]

如你所知，`Series`与其他数据框一起使用时并不是最佳选择。因此，如果我们能在Groupby操作中获得数据框作为输出，通常会更为理想。以下展示了如何操作：

[PRE16]

在`groupby`方法调用中，我们只是简单地将`as_index`设置为`False`，这意味着我们不希望使用分组变量作为结果数据框。使用这种数据框输出，操作会更简单。

## 结论

在本文中，我们回顾了与数据框中的索引相关的最常见的6个操作。希望你觉得这篇文章有用。

想了解更多关于 Python 和 Pandas 的内容吗？请考虑订阅我的电子邮件通讯。如果你想系统地提升你的 Python 技能，请查看 Manning 出版的我的新书 [Python How-To](https://www.manning.com/books/python-how-to)。
