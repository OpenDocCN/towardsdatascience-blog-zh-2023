- en: Sentiment Analysis and Structural Breaks in Time-Series Text Data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/sentiment-analysis-and-structural-breaks-in-time-series-text-data-8109c712ca2](https://towardsdatascience.com/sentiment-analysis-and-structural-breaks-in-time-series-text-data-8109c712ca2)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Arabica now offers a structural break and sentiment analysis module to enrich
    time-series text mining
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://petrkorab.medium.com/?source=post_page-----8109c712ca2--------------------------------)[![Petr
    Korab](../Images/9f3afb4b8985584981220e30f18e3b69.png)](https://petrkorab.medium.com/?source=post_page-----8109c712ca2--------------------------------)[](https://towardsdatascience.com/?source=post_page-----8109c712ca2--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----8109c712ca2--------------------------------)
    [Petr Korab](https://petrkorab.medium.com/?source=post_page-----8109c712ca2--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----8109c712ca2--------------------------------)
    ·7 min read·Mar 6, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8f5897e7bff2d0dad77264730ceec6d2.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Adam Śmigielski](https://unsplash.com/@smigielski?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Text data contains lots of qualitative information, which can be quantified
    with various methods, including sentiment analysis techniques. These models are
    used to identify, extract and quantify emotions from text data and have wide use
    in business and academic research. Since the text is often recorded on a time-series
    basis, text datasets might display structural breaks as the quantitative information
    change due to many possible factors.
  prefs: []
  type: TYPE_NORMAL
- en: 'As a business analyst, measuring the changes in customer perceptions of a particular
    brand might be one of the key tasks. In the research role, one can be interested
    in the shifts in Vladimir Putin’s public statements over time. [**Arabica**](https://pypi.org/project/arabica/)is
    a python library specifically designed to deal with similar questions. It contains
    these methods for exploratory analysis of time-series text datasets:'
  prefs: []
  type: TYPE_NORMAL
- en: '**arabica_freq** for descriptive n-gram-based exploratory analysis (EDA)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**cappuccino** is avisualization module including ***heatmap***, ***word cloud***,
    and ***line plot*** for unigram, bigram, and trigram frequencies'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**coffee_break** enables sentiment and structural break analysis.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'This article will introduce you to **Coffee-break,** the sentiment and structural
    breaks analysis module. Read the [documentation](https://arabica.readthedocs.io/en/latest/index.html)
    and these tutorials for the first two methods: [arabica_freq](/text-as-time-series-arabica-1-0-brings-new-features-for-exploratory-text-data-analysis-88eaabb84deb),
    [cappuccino](https://medium.com/towards-data-science/visualization-module-in-arabica-speeds-up-text-data-exploration-47114ad646ce).'
  prefs: []
  type: TYPE_NORMAL
- en: '***EDIT Jul 2023****: Arabica has been updated. Check the* [***documentation***](https://arabica.readthedocs.io/en/latest/index.html)
    *for the full list of parameters.*'
  prefs: []
  type: TYPE_NORMAL
- en: '2\. Coffee_break: algorithm and structure'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The *coffee_break* module has a simple backend architecture. Here is schematically
    how it works:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6f1e29308bf86b5fabe4d7c398e1d9cd.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 1\. Coffe_break architecture. Source: draw.io'
  prefs: []
  type: TYPE_NORMAL
- en: Raw text is cleaned with [cleantext](https://pypi.org/project/cleantext/#description)
    providing punctuation and numbers cleaning. Stop words (the most common words
    in a language with no significant meaning) are not removed in the **pre-processing
    step** because they don’t negatively affect sentiment analysis. However, with
    `skip` parameter, we can remove a list of additional stop words or unwanted strings
    (words or word sequences) that will not impact sentiment analysis.
  prefs: []
  type: TYPE_NORMAL
- en: '**Sentiment analysis** implements **VADER (**[*Valence Aware Dictionary and
    Sentiment Reasoner*](https://ojs.aaai.org/index.php/ICWSM/article/view/14550)*)*,a
    universal pre-trained sentiment classifier [1]. It was trained on social media
    data from Twitter, but it also works very well on other types of datasets. [My
    previous article](/the-most-favorable-pre-trained-sentiment-classifiers-in-python-9107c06442c6)
    offers a more detailed introduction to the model and coding in Python.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Coffee_break uses VADER’s compound indicator for sentiment evaluation. The
    aggregate sentiment is calculated as:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d1efcf582584eaa0225e084590f13adb.png)'
  prefs: []
  type: TYPE_IMG
- en: 'where *t* is the aggregation period. The aggregate indicator ranges [-1: 1]
    having a positive sentiment closer to 1 and a negative approaching -1.'
  prefs: []
  type: TYPE_NORMAL
- en: The aggregated sentiment creates a time series displaying some degree of variability
    over time. **Structural breaks** in the time series are identified with the *Fisher-Jenks
    algorithm,* or *Jenks Optimisation Method* originally proposed by George F. Jenks
    [2].
  prefs: []
  type: TYPE_NORMAL
- en: It is a clustering-based method designed to find the best arrangement of values
    into different classes (clusters). The `jenks_breaks` function implemented with
    `jenkspy` library returns a list of values that correspond to the limits of the
    classes. These structural breaks are in the plot marked as vertical lines and
    visually indicate the breakpoints in the time series of text data.
  prefs: []
  type: TYPE_NORMAL
- en: The **implemented libraries** are [Matplotlib](https://pypi.org/project/matplotlib/)
    (visualization), [vaderSentiment](https://pypi.org/project/vaderSentiment/) (sentiment
    analysis), and [jenkspy](https://pypi.org/project/jenkspy/) (structural breaks).
    [Pandas](https://pypi.org/project/pandas/) and [Numpy](https://pypi.org/project/numpy/)
    make the processing operations.
  prefs: []
  type: TYPE_NORMAL
- en: '3\. Use case: Twitter sentiment analysis'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Let’s illustrate the coding on [Pfizer Vaccine Tweets dataset](https://www.kaggle.com/datasets/gpreda/pfizer-vaccine-tweets)
    collected using Twitter API. The data contains 11 000 tweets about Pfizer & BioNTech
    vaccine posted between 2006 and 2021\. The dataset is released under the [CC0:
    Public Domain](https://creativecommons.org/publicdomain/zero/1.0/) license according
    to [Twitter developer policy](https://developer.twitter.com/en/developer-terms/commercial-terms).'
  prefs: []
  type: TYPE_NORMAL
- en: 'The data contains a lot of punctuation and numbers and needs cleaning before
    any further steps:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/dbd33e55754e4a7bdec73750779b7ce5.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 2\. Pfizer Vaccine Tweets dataset
  prefs: []
  type: TYPE_NORMAL
- en: 'The *coffee_break* method’s parameters are:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 3\. 1\. Sentiment analysis over time
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Our data has a 15-year time span covering the Covid-19 crisis. Changes in the
    public mood about vaccination, fake news about vaccines, and many other factors
    are expected to lead to significant variations in sentiment over time.
  prefs: []
  type: TYPE_NORMAL
- en: Coding
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'First, import *coffee_break*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Arabica reads dates in **US-style (***MM/DD/YYYY)* and **European-style** (*DD/MM/YYYY)*
    date and datetime formats. The data is pretty raw and covers 15 years. Displaying
    sentiment by month is, therefore, not very helpful.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s clean the data and aggregate sentiment by year with this code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Results
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Arabica returns a picture that can be manually saved in PNG or JPEG.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f7f7c2e2fa2529f5c9077a8a1a4c7a5d.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 3\. Sentiment analysis — yearly
  prefs: []
  type: TYPE_NORMAL
- en: 'At the same time, Arabica returns a dataframe with the corresponding data.
    The table can be saved simply by assigning the function to an object :'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '**Results interpretation:** we can see that sentiment significantly dropped
    after Pfizer vaccines started to be used to tackle Covid in 2021 (Figure 2). The
    reason is likely the global pandemic the world faced and the generally negative
    mood in these years.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 3.2\. Structural break analysis
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Next, let’s formalize the structural breaks in sentiment statistically. *Coffe_break*
    enables the identification of min. 2 breakpoints. The following code returns a
    figure with 3 breakpoints marked by vertical lines and the table with the corresponding
    time series:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'The figure:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/39cffa6c36eacd239c02829039e265cd.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 4\. Structural break analysis — yearly
  prefs: []
  type: TYPE_NORMAL
- en: 'Subsetting the data to the two Covid years (2020–2021), we might observe monthly
    changes in public sentiment, keeping `n_breaks = 3` and setting `time_freq = ''M''`
    :'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/874a438709a4a4c152a03520a61abaff.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 5\. Structural break analysis - monthly
  prefs: []
  type: TYPE_NORMAL
- en: The graph is not very informative. There are 1577 rows for 24 time observations
    in this subset, and after cleaning the raw data, the time series is very volatile.
    Making conclusions using a clustering-based algorithm on such a limited volume
    of data is not a good idea.
  prefs: []
  type: TYPE_NORMAL
- en: '**Results interpretation:** the structural break analysis in yearly frequency
    statstically confirmed what we could see from the time series of sentiment in
    Figure 3\. Fisher-Jenks algorithm identified three structural breaks — in 2009,
    2017, and 2021\. We can only guess what caused the decline in 2009 and between
    2016 and 2018\. The 2021’s drop is likely reasoned by the Covid-19 crisis.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 4\. Best practices for structural break analysis
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Let’s summarize the recommendations for the most effective use of *coffee_break*:'
  prefs: []
  type: TYPE_NORMAL
- en: don’t use structural break analysis if there are NAN values in the corresponding
    time series.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: identification of more than 3 break points makes sense in longer time series
    (at least 12 observations).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: breakpoint identification might not work well in highly volatile datasets. The
    reason for dramatic changes might not be the shifts in sentiment but rather the
    quality of data.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: the analysis is only as correct as the underlying sentiment data. Before the
    actual use, make a short exploration of the raw text dataset to check if (1) it
    is not too imbalanced in the number of rows for each period and (2) it contains
    enough information for sentiment evaluation (texts are not too short and don’t
    contain mostly digits and special characters).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](../Images/0ad9b19919b40cdcbdc5384c299d7e46.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A drawback of *coffee_break* is that currently, it only works with **English
    texts.** Due to the fact that Arabica is mainly a Pandas-based package (including
    Numpy vectorization in some parts), *coffee_break* is rather slow in evaluating
    large datasets. It is time-efficient in processing datasets of up to approx. 40
    000 rows.
  prefs: []
  type: TYPE_NORMAL
- en: 'Read these tutorials to find out more about n-gram and sentiment analysis and
    visualization of time-series text data:'
  prefs: []
  type: TYPE_NORMAL
- en: '[***Visualization Module in Arabica Speeds Up Text Data Exploration***](https://medium.com/towards-data-science/visualization-module-in-arabica-speeds-up-text-data-exploration-47114ad646ce)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[***Customer Satisfaction Measurement with N-gram and Sentiment Analysis***](/customer-satisfaction-measurement-with-n-gram-and-sentiment-analysis-547e291c13a6)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[***Research Article Meta-data Description Made Quick and Easy***](https://pub.towardsai.net/research-article-meta-data-description-made-quick-and-easy-57754e54b550)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[***The Most Favorable Pre-trained Sentiment Classifiers in Python***](https://medium.com/towards-data-science/the-most-favorable-pre-trained-sentiment-classifiers-in-python-9107c06442c6)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Coffee_break* has been developed in cooperation with Prof. Jitka Poměnková
    (Brno University of Technology). The complete code in this tutorial is on my [GitHub](https://github.com/PetrKorab/Arabica/blob/main/docs/examples/coffee_break_examples.ipynb).'
  prefs: []
  type: TYPE_NORMAL
- en: '*Did you like the article? You can invite me* [*for coffee*](https://www.buymeacoffee.com/petrkorab)
    *and support my writing. You can also subscribe to my* [*email list*](https://medium.com/subscribe/@petrkorab)
    *to get notified about my new articles. Thanks!*'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/2866c3201bcb16ccb9e0bfbbbbf61bf3.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Content Pixie](https://unsplash.com/@contentpixie?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[1] Hutto, C., Gilbert, E. (2014). [VADER: A Parsimonious Rule-Based Model
    for Sentiment Analysis of Social Media Text](https://ojs.aaai.org/index.php/ICWSM/article/view/14550).
    *Proceedings of the International AAAI Conference on Web and Social Media*, *8*(1),
    216–225.'
  prefs: []
  type: TYPE_NORMAL
- en: '[2] Jenks, G.F. (1977). *Optimal data classification for choropleth maps.*
    Kansas. University. Dept. of Geography-Meteorology. Occasional paper no. 2.'
  prefs: []
  type: TYPE_NORMAL
