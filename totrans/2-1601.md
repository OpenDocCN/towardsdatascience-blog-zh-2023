# 优化：Python中的容量限制设施选址问题

> 原文：[https://towardsdatascience.com/optimization-capacitated-facility-location-problem-in-python-57c08f259fe0](https://towardsdatascience.com/optimization-capacitated-facility-location-problem-in-python-57c08f259fe0)

## 查找最佳的仓库数量和位置以降低成本并满足需求

[](https://nicolo-albanese.medium.com/?source=post_page-----57c08f259fe0--------------------------------)[![Nicolo Cosimo Albanese](../Images/9a2c26207146741b58c3742927d09450.png)](https://nicolo-albanese.medium.com/?source=post_page-----57c08f259fe0--------------------------------)[](https://towardsdatascience.com/?source=post_page-----57c08f259fe0--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----57c08f259fe0--------------------------------) [Nicolo Cosimo Albanese](https://nicolo-albanese.medium.com/?source=post_page-----57c08f259fe0--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----57c08f259fe0--------------------------------) ·阅读时间12分钟·2023年2月28日

--

![](../Images/cfab4658e033226dcba6aac3728625d1.png)

图片由作者提供。

# 目录

1.  [简介](#f74a)

1.  [问题陈述](#bd29)

1.  [实现](#7bcf)

    3.1\. [数据集](#5775)

    3.2\. [客户、仓库和需求](#11c3)

    3.3\. [供应和固定成本](#6211)

    3.4\. [运输成本](#9569)

    3.5\. [优化](#35b1)

1.  [探索结果](#1790)

1.  [结论](#280b)

# 1\. 引言

*设施选址问题（FLPs）* 是经典的优化任务。它们的目标是确定仓库或工厂的最佳潜在位置。

仓库可能有或没有容量限制。这将 *有容量（CFLP）* 与 *无容量（UFLP）* 问题变体区分开来。

业务目标是找到一组能够最小化成本的仓库位置。原始问题定义由 [Balinski (1965)](https://doi.org/10.1287/mnsc.12.3.253) 提出了两个（年度）成本因素之和的最小化：

+   运输成本

+   仓库固定成本

运输成本指的是从仓库位置到客户的费用。仓库固定成本是特定于位置的。它可能包括如租金、税费、电费和维护等费用。

*设施选址* 是一个众所周知的主题，具有相当丰富的文献。因此，存在许多问题变体以及方法。这篇文章介绍了经典的 CFLP 公式，并分享了一个使用 [PuLP](https://coin-or.github.io/pulp/) 的实际 Python 示例。

# 2\. 问题陈述

CFLP 的目标是确定能够满足客户需求的仓库数量和位置，同时降低固定和运输成本。因此，我们可以将问题表述为以下目标函数的最小化：

![](../Images/9c0a8efc2f9887c0a307944ff6ec2b5a.png)

在前一个表达式中：

+   `N`是客户地点的集合。

+   `M`是候选仓库地点的集合。

+   `fⱼ`表示仓库`j`的年固定成本。

+   `tᵢⱼ`表示从仓库`j`到客户`i`的运输成本。

+   `xᵢⱼ`是从仓库`j`到客户`i`的单位数。

+   `yⱼ`是一个二进制变量`yⱼ ∈ {0,1}`，表示是否在位置`j`建立仓库（`yⱼ = 1`）或不建立（`yⱼ = 0`）。

现在让我们考虑将**约束**添加到目标函数中。

由于我们正在建模一个*有容量限制*的问题，每个设施`j`可以供应的年最大容量为`Cⱼ`。因此，交付给客户的单位数`xᵢⱼ`不能超过此值：

![](../Images/619f8e66ba943a0d54d18229d931f6fe.png)

从仓库`j`到客户`i`的年交付单位数必须在零到`dᵢ`之间，其中`dᵢ`是客户`i`的年需求：

![](../Images/dc1f43e3b37f06046374445cb0c74eb6.png)

最后但同样重要的是，我们必须满足客户的需求。在这个示例中，我们规定每个服务客户地点的仓库必须完全满足其需求：

![](../Images/7524e38712e10b74bad3aa3bf49ca791.png)

总之，我们可以如下定义问题：

![](../Images/4c21c3e7bec3aefa4722b4abc564bfba.png)

图片由作者提供。

# 3\. 实施

让我们导入所需的库：

+   `NumPy`、`Pandas`用于数据处理。

+   `math`用于特定的数学函数。

+   `GeoPandas`用于地理空间表示。

+   `Matplotlib`用于数据可视化。

+   `PuLP`用于优化。

[PRE0]

## 3.1\. 数据集

我们在意大利设定优化问题。

起始数据集可以在 [simplemaps.com](https://simplemaps.com/) 上获得。我们可以从[这里](https://simplemaps.com/data/it-cities)下载输入csv文件，并在[MIT许可证](https://opensource.org/license/mit/)下[个人和商业用途均可自由使用](https://simplemaps.com/data/it-cities)。

[PRE1]

我们感兴趣的是以下列：

+   `city`: 城镇名称；

+   `lat`: 纬度；

+   `lng`: 经度；

+   `population`: 居民数量；

+   `capital`: 表示城市是否是主要城市或行政中心；

+   `admin_name`: [最高级别行政区域](https://en.wikipedia.org/wiki/Regions_of_Italy)的名称。

## 3.2\. 客户、仓库和需求

在创建客户、设施和需求时，我们假设：

+   客户是输入城市的一部分（30%）。

+   设施只能在行政中心建立。作为起始条件，我们假设我们可以在意大利80%的主要城市建立仓库。

+   需求是恒定且全年已知的。它等于客户城镇人口的一个部分（2%）加上一个误差项。

[PRE2]

***注意***：在在线数据集中，区域名称`Valle d'Aosta`包含的是排版（弯曲）撇号（U+2019），而不是打字机（直线）撇号（U+0027）。如果复制此代码，请考虑到这一点。

尽管这对于优化任务不是必需的，但我们可能希望在地图上观察我们的地点。`geopandas`简化了这一任务。可以使用`points_from_xy`方法轻松创建一个充满地理空间信息的`GeoDataFrame`：

[PRE3]

我们可以通过`geopandas`访问意大利的地图，并绘制客户和潜在的仓库位置：

[PRE4]

![](../Images/cf2ebf7f62c1bfa7c68e5327a8ec47f3.png)

图片由作者提供。

同样，我们可以观察到20个意大利地区的平均需求：

[PRE5]

![](../Images/afbb1c9fba6984e3305d22ecd4e14fc3.png)

图片由作者提供。

为了方便以后使用`PuLP`，让我们将需求数据存储在`customer-demand`对的字典中：

[PRE6]

## 3.3\. 供应和固定成本

为了建模供应和固定成本，我们假设：

+   每个仓库可以满足的最大年度供应量等于平均区域需求的3倍。

+   每个仓库都有一个固定的年成本为100.000,00 €，与其位置无关。

与需求相同，我们将供应和固定成本存储在字典中：

[PRE7]

## 3.4\. 运输成本

运输成本的估算需要：

+   不同位置之间的距离，以及

+   每单位距离的成本函数。

我们可以使用[哈弗森公式](https://en.wikipedia.org/wiki/Haversine_formula)来近似两个位置之间的距离：

[PRE8]

让我们在两个城市上尝试一下：

+   米兰（纬度：45.4654219，经度：9.18854）

+   贝尔加莫（纬度：45.695000，经度：9.670000）

[PRE9]

[PRE10]

我们得到的距离为45.5公里。不幸的是，这个度量与我们在汽车导航系统上看到的距离不一致，因为我们没有考虑路线：

![](../Images/3cb6b800cae6c01dcbf774419874b0f8.png)

米兰和贝尔加莫之间的哈弗森距离和路线距离。图片由作者提供。

尽管如此，我们可以使用我们的估算作为任务的合理近似。

最后，我们需要将距离转换为成本度量。目前在写作时，意大利的平均汽油价格为1.87 €/L（[来源](https://www.cargopedia.net/europe-fuel-prices)）。一辆EURO VI卡车的平均耗油量约为0.38 L/Km（[来源](https://www.transportenvironment.org/wp-content/uploads/2021/07/2015_06_Comparing_US_EU_truck_fuel_economy_explantory_note_Final.pdf)）。通过一个简单但合理的近似，我们可以估算在意大利土地上每公里的平均成本为0.71 €：

[PRE11]

现在我们可以计算每个仓库-客户对的旅行成本，并将其存储在字典中：

[PRE12]

## 3.5\. 优化

让我们回顾一下优化问题：

![](../Images/4c21c3e7bec3aefa4722b4abc564bfba.png)

图片由作者提供。

我们可以定义两个决策变量`xᵢⱼ`和`yⱼ`，目标函数和约束条件如下：

[PRE13]

我们可以解决优化问题：

[PRE14]

我们可以如下检查结果：

[PRE15]

[PRE16]

我们现在对探索决策变量感兴趣：我们需要多少个仓库？它们的位置在哪里？

# 4\. 探索结果

首先，让我们考虑商业目标：最小化成本。我们可以检查目标函数的值：

[PRE17]

[PRE18]

这是在给定约束条件下我们可以实现的最低成本。任何其他仓库数量或位置的选择都会导致目标函数值更高。

我们可以通过`varValue`属性访问决策变量。例如，我们可以查看`yⱼ`在`j = 仓库 1`时的值：

[PRE19]

[PRE20]

由于`yⱼ = 1`，我们应在该位置建立一个仓库。我们可以轻松地操作变量并计算所需设施的数量：

[PRE21]

[PRE22]

**只需建造最初预算的91个地点中的32个**即可。35.1%（32 / 91）的潜在仓库足以满足在给定约束条件下的需求。

我们可以将决策变量保存到初始数据框中，并观察所选择的位置：

[PRE23]

[PRE24]

[PRE25]

![](../Images/1990033c061c90853e9dd02e58b62179.png)

图片来源于作者。

[PRE26]

![](../Images/6f255dd097ebbb9b78b353b1b627aa65.png)

图片来源于作者。

同样，我们可以遍历决策变量`xᵢⱼ`，找到优化解中每个仓库服务的客户：

[PRE27]

![](../Images/c757c5e2dc9984a46a3e10576bc8ec0c.png)

图片来源于作者。

# 5. 结论

在这篇文章中，我们介绍了一个经典的优化挑战：**容量受限设施选址问题**（CFLP）。我们描述了它的推导过程，并分享了一个实用的Python示例。特别地，由于我们从一个原始的地理位置数据集开始，我们覆盖了所有框架问题和求解问题所需的必要步骤和假设。
