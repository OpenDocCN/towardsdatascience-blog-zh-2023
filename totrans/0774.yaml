- en: Easily build an Event Reminder with Cloud Workflows and Cloud Scheduler
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: ÂéüÊñáÔºö[https://towardsdatascience.com/easily-build-an-event-reminder-with-cloud-workflows-and-cloud-scheduler-efba59b3df9a](https://towardsdatascience.com/easily-build-an-event-reminder-with-cloud-workflows-and-cloud-scheduler-efba59b3df9a)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Use Case: Identify Birthdays and Send Notification Emails'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://marcgeremie.medium.com/?source=post_page-----efba59b3df9a--------------------------------)[![Marc
    Djohossou](../Images/096f7877d14b7671e48500175931dbea.png)](https://marcgeremie.medium.com/?source=post_page-----efba59b3df9a--------------------------------)[](https://towardsdatascience.com/?source=post_page-----efba59b3df9a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----efba59b3df9a--------------------------------)
    [Marc Djohossou](https://marcgeremie.medium.com/?source=post_page-----efba59b3df9a--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ¬∑Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----efba59b3df9a--------------------------------)
    ¬∑7 min read¬∑Apr 26, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4defb51e3279ab731da36613dcca9606.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Imants Kaziƒºuns](https://unsplash.com/@imants72?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: 'Building an event reminder, like Facebook anniversary reminder can seem more
    laborious than it really is. In this article, I elaborate on an easy, yet efficient
    way to build a birthday reminder application. Please, read through to unlock your
    access to the repository containing the full working code. Following are the main
    topics covered:'
  prefs: []
  type: TYPE_NORMAL
- en: Introduction to Cloud Workflows and Cloud Run
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Build the Birthday Identification Service
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Build the Email Notification Service
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Build the Birthday Reminder Service
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Summing Up
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Introduction to Cloud Workflows and Cloud Run
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: C[loud Workflows](https://cloud.google.com/workflows?hl=en) is a Google Cloud
    service that lets you orchestrate a series of HTTP-Based services. Those services
    can be internal (when they belong to a Google Cloud domain) or external. In additional
    to its attractive cost, Cloud Workflows has some unique and interesting features
    to offer like [Wait and Callback](https://cloud.google.com/workflows/docs/creating-callback-endpoints)
    that lets you wait for up to 1 year for an event to happen.
  prefs: []
  type: TYPE_NORMAL
- en: '[Cloud Run](https://cloud.google.com/run?hl=en) is used to run containerized
    applications at scale. As a serverless offer it does not require creating a cluster
    or a Virtual Machine, which accelerate building and deploying applications. Although
    Cloud Run tends to be used often for websites and Rest APIs, it can be used for
    a broad range of tasks including lightweight data processing or task automation.
    On that note, this article uses a data processing Cloud Run service to identify
    people that will be soon celebrating their birthday and a task automation Cloud
    Run service that sends reminder emails.'
  prefs: []
  type: TYPE_NORMAL
- en: Build the Birthday Identification Service
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Let‚Äôs imagine that we have been given the details of a group of people whose
    anniversary should be reminded in advance to a few people, maybe their closest
    friends.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4ad3d40953b65ce73139287baa4abaec.png)'
  prefs: []
  type: TYPE_IMG
- en: Image By Author, birthdays table ‚Äî List of people whom birthday to identify
  prefs: []
  type: TYPE_NORMAL
- en: Looking at the first line of the table above, we see that Mr Smith was born
    a 25th of December. Then, the goal might be to automatically notify Mr Smith‚Äôs
    friends via email one week ahead (so that they have enough time to arrange the
    surprise party üòÄ).
  prefs: []
  type: TYPE_NORMAL
- en: Now there are many places where the birthdays table might be stored. As a Google
    Cloud user, it makes sense to store the birthdays details in a [BigQuery](https://cloud.google.com/bigquery?hl=en)
    table. Another really good candidate is [Google Sheets](https://www.google.fr/intl/en/sheets/about/),
    especially if the number of people in the birthdays table is not too high.
  prefs: []
  type: TYPE_NORMAL
- en: 'With Google Sheets as the storage solution, the birthday identification service
    will then look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/15b3c5d662a598e1c0b12ab81f39a1d9.png)'
  prefs: []
  type: TYPE_IMG
- en: Image By Author, Birthday Identification Service Architecture ‚Äî Sheets Logo
    from flaticon¬π
  prefs: []
  type: TYPE_NORMAL
- en: This can then be easily translated in Python Code
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Note how the birthday identification service takes 2 input parameters:'
  prefs: []
  type: TYPE_NORMAL
- en: The Google Sheet containing the birthdays table ID
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The list of emails to notify about the upcoming birthdays (for instance notify_1@gmail.com
    and notify_2@gmail.com)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It reads the birthdays table, filters the table to keep only the next week lucky-ones
    and returns a python dictionary containing the details of the detected birthdays
    and the list of people to notify.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Now we can give the service a name and deploy it to have a Cloud Run service
    ready to identify next birthdays from the birthdays table:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/30d552cf31ead13b32380dd64486ad48.png)'
  prefs: []
  type: TYPE_IMG
- en: Image By Author, Birthday Identification Service Deployed to Cloud Run
  prefs: []
  type: TYPE_NORMAL
- en: '**Note**: This article does not go into the specifics of how to identify the
    upcoming birthdays or how to deploy the birthday identification service.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Build the Email Notification Service
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Once the nearing birthdays are identified, it‚Äôs time to communicate the good
    news. In a social network context for example, only the direct connections of
    the ‚Äúbirthday boy / girl‚Äù will get to be notified.
  prefs: []
  type: TYPE_NORMAL
- en: 'The email notification Cloud Run service takes as input a json payload containing:'
  prefs: []
  type: TYPE_NORMAL
- en: The list of birthday boy / girl and their details (identified previously)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The list of the people to notify
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: The actual email sending can be achieved in multiple ways. Personally, I‚Äôve
    had success using [Sendgrid](https://sendgrid.com/) or Gmail SMPT server via the
    Python Package *smtplib*.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7d22d8bdc8444c90769444cdacbdbe7f.png)'
  prefs: []
  type: TYPE_IMG
- en: Image By Author, Email Notification Service Deployed to Cloud Run
  prefs: []
  type: TYPE_NORMAL
- en: 'At this point, we have built a service that is able to identify birthdays and
    another service which is able to send email notifications. Yet, there are 2 missing
    ingredients for a working birthday reminder application:'
  prefs: []
  type: TYPE_NORMAL
- en: A solution that is able to run the two services sequentially on a schedule
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A solution that is able to skip running the email notification service if no
    birthday has been identified.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: And this is where Cloud Workflows comes into play
  prefs: []
  type: TYPE_NORMAL
- en: '**Note**: This article does not dive into the details of how to send the emails
    or how to deploy the email notification service.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Build the Birthday Reminder Service
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As the birthday identification service and the email notification service are
    up and running, all that is left is how to connect them and recurrently start
    the birthday reminder application on a schedule.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let‚Äôs say we want the birthday reminder application to execute every Saturday.
    Then we need to do the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Activate the Cloud Workflows API**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In Cloud Console search bar, type *Workflows* and click on the *Worflows* API
    link. Then click on the *ENABLE* button to activate the API and wait for a few
    seconds.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/afba4e996cb5c7f26cce0e347536928c.png)'
  prefs: []
  type: TYPE_IMG
- en: Image By Author, Looking for Cloud Workflows API
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f7f85cca99eceb6a39e051f4c9f62393.png)'
  prefs: []
  type: TYPE_IMG
- en: Image By Author, Activate the Cloud Workflows API
  prefs: []
  type: TYPE_NORMAL
- en: '**Create the Birthday Reminder Workflow**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Once the Workflows API is enabled, click on the *CREATE* button and start filling
    the details for the birthday workflow creation. Please, note that the workflow
    service account should have the *Cloud Run Invoker IAM Role* (or a broader role)
    to be able to trigger the birthday identification and the email notification services
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7204fe6a46c617530a8318dfa1d8c236.png)'
  prefs: []
  type: TYPE_IMG
- en: Image By Author, Birthday Reminder Workflow Creation, Part 1
  prefs: []
  type: TYPE_NORMAL
- en: Click on the *ADD NEW TRIGGER* button and configure a Cloud Scheduler. Please,
    make sure to define a json document in the *Workflow‚Äôs argument* containing the
    birthdays table Google Sheets ID and the emails to notify. In addition, you‚Äôll
    want to pick a service account with the *Workflows Invoker IAM Role* (or broader)
    to run the scheduler job.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/54b5e5570f705e759870bff73480aa21.png)'
  prefs: []
  type: TYPE_IMG
- en: Image By Author, Birthday Reminder Workflow Creation, Part 2
  prefs: []
  type: TYPE_NORMAL
- en: Click the *CONTINUE* button and add the workflow definition yaml file. Then
    click on *DEPLOY* and wait a few seconds for the workflow to be created
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/cd752b2ceda1fcceeda0cdfa86fca570.png)'
  prefs: []
  type: TYPE_IMG
- en: Image By Author, Birthday Reminder Workflow Creation, Part 3
  prefs: []
  type: TYPE_NORMAL
- en: 'Do you remember the 2 reasons why Cloud Workflows is actually needed for putting
    together the birthday reminder application ? It provides:'
  prefs: []
  type: TYPE_NORMAL
- en: A way to recurrently run the birthday identification and the email notification
    services, one after the other
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The capacity to skip the execution of the notification if there were no birthdays
    to celebrate.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This skipping capacity is implemented by using a **switch step** in which the
    number of upcoming birthdays is checked. If there is no birthdays, the notification
    email service is not executed.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '**Summing Up**'
  prefs: []
  type: TYPE_NORMAL
- en: This writing describes a simple way of building any event reminder application
    using Cloud Scheduler and Cloud Workflows. The former is responsible of triggering
    the reminding while the latter orchestrates HTTP services that hold the logic
    of what needs to be reminded. Typically, we created a workflow that orchestrates
    2 Cloud Run services and used a Cloud Workflows switch step to early stop the
    workflow when needed.
  prefs: []
  type: TYPE_NORMAL
- en: If this sparked your interest, you‚Äôll find the full working code in this [gitlab
    repository](https://gitlab.com/marcdjoh/event-reminder-with-cloud-workflows).
    Please, request an access by sending an email at marcgeremie@gmail.com and I‚Äôll
    be happy to add you to the repository.
  prefs: []
  type: TYPE_NORMAL
- en: Thank you for your time and see you soon with another interesting article.
  prefs: []
  type: TYPE_NORMAL
- en: '[1] [https://www.flaticon.com/free-icon/sheets_281761?term=google+sheets&page=1&position=1&origin=tag&related_id=281761](https://www.flaticon.com/free-icon/sheets_281761?term=google+sheets&page=1&position=1&origin=tag&related_id=281761)'
  prefs: []
  type: TYPE_NORMAL
