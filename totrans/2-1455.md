# 使用不平衡数据进行回归的机器学习

> 原文：[https://towardsdatascience.com/machine-learning-for-regression-with-imbalanced-data-62629d7ad330](https://towardsdatascience.com/machine-learning-for-regression-with-imbalanced-data-62629d7ad330)

## 为什么在数据集中预测异常值如此困难，以及你可以采取什么措施来应对

[](https://medium.com/@caroline.arnold_63207?source=post_page-----62629d7ad330--------------------------------)[![Caroline Arnold](../Images/2560e106ba9deda7889c7d253792d814.png)](https://medium.com/@caroline.arnold_63207?source=post_page-----62629d7ad330--------------------------------)[](https://towardsdatascience.com/?source=post_page-----62629d7ad330--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----62629d7ad330--------------------------------) [Caroline Arnold](https://medium.com/@caroline.arnold_63207?source=post_page-----62629d7ad330--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----62629d7ad330--------------------------------) ·阅读时间6分钟·2023年8月10日

--

## 什么是不平衡数据？

许多现实世界的数据集存在不平衡的问题，其中某些类型的样本在数据集中被过度代表，而其他类型则出现较少。一些例子包括：

+   在将信用卡交易分类为欺诈性或合法交易时，大多数交易将属于后者类别

+   强降雨发生的频率低于中等降雨，但可能对人类和基础设施造成更大的损害

+   在尝试识别土地用途时，代表森林和农业的像素比城市定居点的像素更多

在这篇文章中，我们旨在提供对机器学习算法为何在不平衡数据上表现不佳的**直观解释**，展示如何使用**分位数评估**来量化算法的性能，并展示**三种不同的策略**来提高算法的性能。

![](../Images/9d2254efcdffa0b4fe4ec4c5e2a0b963.png)

由 [Elena Mozhvilo](https://unsplash.com/@miracleday?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral) 上的照片

## 回归示例数据集：加州住房

数据集不平衡通常在分类问题中表现为一个多数类掩盖了一个少数类。在这里，我们关注的是回归问题，其中目标是一个连续的数值。我们将使用[scikit-learn 提供的加利福尼亚住房数据集](https://inria.github.io/scikit-learn-mooc/python_scripts/datasets_california_housing.html)。该数据集包含超过 20,000 个房屋样本，特征包括位置、房间和卧室数量、房龄、面积和邻里中位收入。目标变量是中位房价，以百万美元计。为了查看数据集是否不平衡，我们绘制了目标变量的直方图。

![](../Images/ccc961d4624f87c271a695ad5f09304b.png)

加利福尼亚房价数据集中目标变量的直方图。红线表示均值为 1.9 M$。

显然，并不是所有的中位房价都被同等地表示。目标变量的均值为 1.9 M$，标准差为 0.98 M$，但这些值并不遵循正态分布——分布偏向于中位值超过 4.0 M$ 的昂贵房屋。

## 均方误差损失函数

我们在 Keras 中实现了一个小型神经网络，并使用它来预测中位房价。由于这是一个回归问题，均方误差函数是一个合适的损失函数。对于给定的一批样本，均方误差（MSE）计算如下：

在这个公式中，预测值和实际值的*距离*是损失的决定性因素。

模型训练很快，损失曲线看起来合理。训练集的最终损失为 0.2562，验证集为 0.2584，因此我们似乎达到了[偏差-方差权衡](https://machinelearningmastery.com/gentle-introduction-to-the-bias-variance-trade-off-in-machine-learning/)的最佳点。

## 使用目标变量的分位数进行评估。

总体而言，我们的机器学习算法在保留的测试集上产生了 0.27 的均方误差。但这与不同房价相比如何呢？我们将目标变量分成每个 1 M$ 价格区间的分箱，并分别计算每个分箱中样本的均方误差。

![](../Images/fc64c360349e79022a6e5f07c7298f39.png)

加利福尼亚房价数据集中目标变量的均方误差。

正如我们所见，我们的机器学习算法在接近目标变量均值的样本上表现最佳。在最高的分箱中，房价超过 4 M$，误差几乎高出 10 倍！

分位数评估是探索机器学习算法在数据集不同区域表现的好方法。这种快速分析可以直接指出实验设置中的问题，你应始终在仅报告整个数据集的平均性能指标之前考虑它。

# 为什么模型难以预测高房价？

## 简单规则学习

我们甚至不能责怪机器学习算法，因为它正好做了我们要求的事情：对于大多数样本，它具有良好的预测能力。只是价格超过400万美元的房屋在数据集中不足代表——只有4%的训练数据落在这个范围内——因此算法没有足够的激励来优先考虑这些样本。

我们应该始终记住，机器学习算法在*学习*我们提出的任务。它们容易**简单规则学习**，这由 [Geirhos 等](https://arxiv.org/pdf/2004.07780.pdf&quot;Bayesian)（2021）定义：

> 简单规则是在标准基准测试中表现良好，但在更具挑战性的测试条件下（如真实世界场景）失败的决策规则。相关问题在比较心理学、教育学和语言学中已知，表明简单规则学习可能是学习系统（无论是生物的还是人工的）共同的特征。

## 提出正确的问题

比如说，我们正在为一个主要关注估算高端房屋中位数价值的房地产经纪人开发算法。对于这个客户，目前的算法无法提供期望的预测能力，因为它在他们感兴趣的房屋类型上的表现不佳。

![](../Images/1d976cae41d9860568ef124bb8c0789b.png)

专注于最昂贵的房屋，而不是在平均样本上表现出色。照片由 [Daniel Barnes](https://unsplash.com/@dannybarness?utm_source=medium&utm_medium=referral) 提供，来源于 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

# 处理不平衡数据

## 策略 1：增加批量大小

增加批量大小时，每个训练批次包含来自不足代表组的样本的可能性更高。我们将批量大小设置为512，并重复模型训练。

## 策略 2：在损失函数中引入权重

在这里，我们要求机器学习算法关注在训练中不足代表的样本。这些样本具有更高的权重。权重可以直接计算并传递给 Keras 中的函数 `model.fit(..., sample_weights=...)`。

用语言解释权重的计算：

+   计算每个区间的样本出现次数

+   除以样本总数——你将获得给定区间的样本频率

+   逆数是相关的权重

以及代码：

## 策略 3：将目标值转换为正态分布

在这种情况下，我们将目标变量转换为符合正态分布。正态分布最适合用于均方误差损失，并减少异常值的特征。重要——评估之前不要忘记重新缩放预测值！

# 评估

## 哪种策略表现最好？

现在是时候比较三种不同的策略了。我们跟踪了每种策略下每个目标变量区间的均方误差，如下图所示。仅关注最高区间时，带权重的损失表现最佳。虽然它在平均房价的算法表现有所降低，但在我们最感兴趣的区域，它增加了预测能力。其他两种策略，即增加批量大小和缩放目标变量，甚至增加了最高区间的均方误差。因此，它们没有被证明对解决我们的问题有帮助。

![](../Images/5bcbe3d073854ce52b0977281dd54778.png)

各策略下目标变量每个区间的均方误差。

因此，我们建议我们的客户——高端房地产经纪人——使用一种机器学习算法，该算法使用权重来强调数据集中表现不足的样本。然而，请注意，机器学习是一门经验科学，对于其他数据集，您可能会找到解决数据集不平衡问题的不同方案。
