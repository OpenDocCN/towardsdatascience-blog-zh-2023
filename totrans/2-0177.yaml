- en: A Comprehensive Guide on Interaction Terms in Time Series Forecasting
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/a-comprehensive-guide-on-interaction-terms-in-time-series-forecasting-16bfa468ae](https://towardsdatascience.com/a-comprehensive-guide-on-interaction-terms-in-time-series-forecasting-16bfa468ae)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](../Images/1fadc2980072fe9153e186992a828785.png)'
  prefs: []
  type: TYPE_IMG
- en: Image created with Midjourney
  prefs: []
  type: TYPE_NORMAL
- en: Learn how to improve the fit of your linear models by making them more flexible
    to trend changes
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://eryk-lewinson.medium.com/?source=post_page-----16bfa468ae--------------------------------)[![Eryk
    Lewinson](../Images/56e09e19c0bbfecc582da58761d15078.png)](https://eryk-lewinson.medium.com/?source=post_page-----16bfa468ae--------------------------------)[](https://towardsdatascience.com/?source=post_page-----16bfa468ae--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----16bfa468ae--------------------------------)
    [Eryk Lewinson](https://eryk-lewinson.medium.com/?source=post_page-----16bfa468ae--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----16bfa468ae--------------------------------)
    ·7 min read·Aug 1, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: Modeling time series data can be challenging (and fascinating) due to its inherent
    complexity and unpredictability. For example, long-term trends in time series
    can change drastically due to certain events. Recall the beginning of the global
    pandemic, when businesses such as airlines or brick-and-mortar shops saw a quick
    decline in the number of customers and sales. In contrast, e-commerce businesses
    continued to operate with less disruption.
  prefs: []
  type: TYPE_NORMAL
- en: Interaction terms can help with modeling of such patterns. They capture complex
    relationships between variables and, as a result, lead to more accurate predictions.
  prefs: []
  type: TYPE_NORMAL
- en: 'This post explores:'
  prefs: []
  type: TYPE_NORMAL
- en: Interaction terms in the context of time series forecasting
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Benefits of interaction terms when modeling complex relationships
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to effectively implement interaction terms in your models
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Overview of interaction terms
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Interaction terms enable you to investigate whether the relationship between
    the target and a feature changes depending on the value of another feature. For
    more details, please refer to [my previous article](https://medium.com/towards-data-science/unlocking-the-power-of-interaction-terms-in-linear-regression-ba30c2cf158f).
  prefs: []
  type: TYPE_NORMAL
- en: Figure 1 shows a scatterplot that represents the relationship between miles
    per gallon (target) and the weight of a vehicle (feature). The relationship is
    quite different depending on the transmission type (another feature).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/16143246520d734ff75f00d43b9d7d33.png)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 1\. Best fit lines for vehicle transmission type, including interaction
    terms*'
  prefs: []
  type: TYPE_NORMAL
- en: Without using interaction terms, a linear model would not be able to capture
    such a complex relationship. Effectively, it would assign the same coefficient
    for the weight feature, regardless of the type of transmission. Figure 1 shows
    the coefficients (slope of the line) by weight feature, which are drastically
    different for different transmission types.
  prefs: []
  type: TYPE_NORMAL
- en: To overcome this fallacy and make the linear model more flexible, we can interaction
    terms. In general, they are a multiplication of the original features. By adding
    these new variables to the regression model, we can measure the effects of the
    interaction between them and the target.
  prefs: []
  type: TYPE_NORMAL
- en: Interaction terms in time series forecasting
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Interaction terms make linear models more flexible. The following example shows
    how they work in the context of time series forecasting.
  prefs: []
  type: TYPE_NORMAL
- en: Prerequisites
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'First, we load the required libraries:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Dataset generation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Then, we generate some artificial time series data with the following characteristics:'
  prefs: []
  type: TYPE_NORMAL
- en: 10 years of daily data
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Repeating patterns (seasonality) present in the time series
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A decreasing trend over the first 7 years
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: No trend in the last 3 years
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Random noise, added as the last step
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Figure 2 shows the generated time series, which includes all the desired characteristics.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/00f9b407262c4317ed00b1e1ca76a356.png)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 2\. The generated time series*'
  prefs: []
  type: TYPE_NORMAL
- en: Training the benchmark model
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now, we will train a linear model and inspect the best-fit line. In this article,
    we will only create simple models with a few features. This will enable us to
    visually inspect the impact of the interaction term on the model’s fit.
  prefs: []
  type: TYPE_NORMAL
- en: The simplest model possible contains one feature — an indicator of the passage
    of time. The `linear_trend` column created for the time series is effectively
    the row number of the DataFrame (ordered by date).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: It is worth mentioning that the point is not to properly evaluate the forecasts
    using separate train and test sets, but rather to explain the impact of the interaction
    terms on the model’s fit. It is easier to observe the interaction term’s impact
    by inspecting the fitted values (prediction on the training set) and comparing
    those fitted values to the original time series.
  prefs: []
  type: TYPE_NORMAL
- en: Figure 3 shows that the linear model identified a decreasing trend for the entire
    time series. At the same time, the fit seems off for the last 3 years of data,
    as there is no trend there.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1bdd0166b87417732805b9261259461f.png)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3\. Best fit line obtained from a linear model using linear trend as
    a feature*'
  prefs: []
  type: TYPE_NORMAL
- en: Adding a breakpoint
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Next, we try to make the model learn the new pattern (trend change) using feature
    engineering. To do so, we create a breakpoint, which is a placeholder variable
    indicating whether a given observation is after January 1, 2017\. In this case,
    we know the exact point in time when the trend change happened.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, we train another linear model, this time with two features:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/9385e5ed9eea229a0421c7b241f7ffc0.png)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 4\. Best fit line obtained from a linear model using linear trend and
    a breakpoint as features*'
  prefs: []
  type: TYPE_NORMAL
- en: 'Figure 4 shows a few important changes, as listed below:'
  prefs: []
  type: TYPE_NORMAL
- en: The fitted line displays a vertical jump, which corresponds to the coefficient
    by the new Boolean feature.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The vertical jump occurs exactly on the first date when the feature becomes
    active (a value of 1 instead of 0).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The slope of the line is the same before and after the introduced breakpoint.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The model is trying to compensate for the incorrect slope by adding a fixed
    amount to the predictions after the breakpoint.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There is no trend in the last 3 years of data, so ideally the line should be
    close to flat after January 1, 2017.
  prefs: []
  type: TYPE_NORMAL
- en: Adding an interaction term
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To change the slope after the breakpoint, we add a more complex dependency on
    the timestamp (represented by a linear trend). That is exactly what an interaction
    term does — it is a multiplication of the linear trend and the placeholder variable.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/a278f80e10015ae7d012a32ef098c382.png)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 5\. Best fit line obtained from a linear model using a linear trend,
    a breakpoint, and an interaction term as features*'
  prefs: []
  type: TYPE_NORMAL
- en: Figure 5 shows the impact of having the interaction term in the model. Compared
    to Figure 4, the slope of the best fit line is different after the breakpoint.
  prefs: []
  type: TYPE_NORMAL
- en: To be more precise, the difference is actually the value of the coefficient
    by the interaction term. While the new line did not flatten out entirely, it is
    still less steep than it used to be in the earlier parts of the time series.
  prefs: []
  type: TYPE_NORMAL
- en: Introducing the breakpoint together with an interaction term increased the model’s
    ability to capture the trend of the time series. In turn, that should increase
    the predictive performance of the model.
  prefs: []
  type: TYPE_NORMAL
- en: Wrapping up
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Using interaction terms can make the specification of a linear model more flexible
    (different slopes for different lines), which can result in a better fit to the
    data and better predictive performance.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We can add interaction terms as a multiplication of the original features.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the context of time series, we can use interaction terms to better capture
    any changes to the trend.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can find the code used in this article on my [GitHub](https://github.com/erykml/medium_articles/blob/master/Time%20Series/interaction_terms_time_series.ipynb).
    Additionally, the code in the notebook shows how to leverage cuDF and cuML to
    train your models using GPU acceleration. As always, feedback is welcome. You
    can reach out to me on [Twitter](https://twitter.com/erykml1) or in the comments.
  prefs: []
  type: TYPE_NORMAL
- en: '*Liked the article? Become a Medium member to continue learning by reading
    without limits. If you use* [*this link*](https://eryk-lewinson.medium.com/membership)
    *to become a member, you will support me at no extra cost to you. Thanks in advance
    and see you around!*'
  prefs: []
  type: TYPE_NORMAL
- en: 'You might also be interested in one of the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](/unlocking-the-power-of-interaction-terms-in-linear-regression-ba30c2cf158f?source=post_page-----16bfa468ae--------------------------------)
    [## Unlocking the Power of Interaction Terms in Linear Regression'
  prefs: []
  type: TYPE_NORMAL
- en: Learn how to make your linear models more flexible by including interaction
    terms
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/unlocking-the-power-of-interaction-terms-in-linear-regression-ba30c2cf158f?source=post_page-----16bfa468ae--------------------------------)
    [](/turn-vs-code-into-a-one-stop-shop-for-ml-experiments-49c97c47db27?source=post_page-----16bfa468ae--------------------------------)
    [## Turn VS Code into a One-Stop Shop for ML Experiments
  prefs: []
  type: TYPE_NORMAL
- en: How to run and evaluate experiments without leaving your IDE
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/turn-vs-code-into-a-one-stop-shop-for-ml-experiments-49c97c47db27?source=post_page-----16bfa468ae--------------------------------)
    [](/5-types-of-plots-that-will-help-you-with-time-series-analysis-b63747818705?source=post_page-----16bfa468ae--------------------------------)
    [## 5 types of plots that will help you with time series analysis
  prefs: []
  type: TYPE_NORMAL
- en: And how to quickly create them using Python!
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/5-types-of-plots-that-will-help-you-with-time-series-analysis-b63747818705?source=post_page-----16bfa468ae--------------------------------)
    [](/three-approaches-to-feature-engineering-for-time-series-2123069567be?source=post_page-----16bfa468ae--------------------------------)
    [## Three Approaches to Feature Engineering for Time Series
  prefs: []
  type: TYPE_NORMAL
- en: Using dummy variables, cyclical encoding and radial basis functions
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/three-approaches-to-feature-engineering-for-time-series-2123069567be?source=post_page-----16bfa468ae--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[https://quantifyinghealth.com/why-and-when-to-include-interactions-in-a-regression-model/](https://quantifyinghealth.com/why-and-when-to-include-interactions-in-a-regression-model/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://en.wikipedia.org/wiki/Interaction_(statistics)](https://en.wikipedia.org/wiki/Interaction_(statistics))'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://www.youtube.com/watch?v=UVny7a8AoA4](https://www.youtube.com/watch?v=UVny7a8AoA4)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: All images, unless noted otherwise, are by the author.
  prefs: []
  type: TYPE_NORMAL
- en: '*Originally published at* [*NVIDIA’s developer blog*](https://developer.nvidia.com/blog/a-comprehensive-guide-on-interaction-terms-in-time-series-forecasting/)
    *on July 20th, 2023*'
  prefs: []
  type: TYPE_NORMAL
