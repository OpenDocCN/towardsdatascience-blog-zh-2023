["```py\n# LOADING LIBRARIES\n\nlibrary(data.table)\nlibrary(magrittr)\nlibrary(sf)\nlibrary(tmap)\nlibrary(sp)\nlibrary(ggpubr)\nlibrary(ggplot2)\nlibrary(lattice)\n\n# PALETTE & FUNCTION \n\nmyColors <- c('#d9ef8b','#91cf60','#fee08b','#fc8d59','#d73027','#1a9850')\n\ndecade <- function(date){\n  year <- data.table::year(date)\n  y <-year - year %% 10\n  return(y)\n}\n\n# LOAD DATA AND SHAPES\n\ndataSSN <- fread(\"SSNMX_catalogo_19000101_20221126.csv\", header = T, skip = 4, sep=\",\", fill=T)\n\nmxMap <- st_read(\"dest20gw/dest20gw.shp\")\n\nstatesNames <- fread(\"nombres_estados.csv\", encoding = \"UTF-8\",header = T)\n\nskipLast <- grep(pattern = \"Fecha y hora local\",as.character(unlist(dataSSN[,1])))\n\ndataSSN <- dataSSN[-skipLast:-dim(dataSSN)[1],]\n\nnames(dataSSN)<- tolower(names(dataSSN))\n\nnames(dataSSN)<- gsub(\"[[:space:]]\", \".\", names(dataSSN))\n```", "```py\n# ADJUSTMENTS TO DATA\n\ndataSSN <- dataSSN %>% \n  .[, state := gsub(\".*,\\\\s*\", \"\\\\1\", referencia.de.localizacion)] %>%  \n  .[, state := gsub(\"[[:space:]]\",\"\", state)] %>% \n  .[, state := fifelse(state==\"N\", \"NL\", state)] %>% \n  .[, date  := as.Date(fecha)] %>% \n  .[, intensity := suppressWarnings( as.numeric(magnitud))] %>% \n  .[, intensityRanges := fcase(\n    intensity>=0 & intensity<= 2 , \"0-2\", intensity>=2 & intensity<= 4 , \"2-4\",\n    intensity>=4 & intensity<= 6 , \"4-6\", intensity>=6 & intensity<= 8 , \"6-8\",\n    intensity>=8 & intensity<= 10 , \"8-10\", intensity>10, \"10 +\",\n    is.na(intensity), \"Unmeasured magnitude\")] %>% \n  .[, intensityRanges := factor(intensityRanges, levels = c(\"0-2\", \"2-4\", \"4-6\", \n                                                            \"6-8\", \"8-10\",\"10+\", \n                                                            \"Unmeasured magnitude\"))] %>% \n  .[, theDecade := decade(date)] %>% \n  .[, monthDate := as.Date(cut(date, \"month\"))] %>% \n  .[, weekDate := as.Date(cut(date, \"week\"))] %>% \n  .[, month := data.table::month(date)] %>% \n  .[, monthName := format(date, \"%B\")] %>% \n  .[, dayName := format(date, \"%A\")] %>%\n  .[, monthDay := format(as.Date(date), \"%m-%d\")] %>% \n  .[, year := data.table::year(date)] %>% \n  .[, day := data.table::mday(date)] %>% \n  .[date >= \"1900-01-01\"]\n\ndataSSN <- merge(dataSSN, statesNames, by.x=\"state\", by.y=\"id.estado\")\n```", "```py\n# SEISMIC ACTIVITY SINCE 1900\n\ndataSSN %>% \n  .[, .(seismicCount = .N), by=date] %>% \n  ggplot(aes(x= date, y= seismicCount)) +\n  geom_line(color=\"darkcyan\") +\n  xlab(\"Year\") +\n  ylab(\"Earthquakes count\") +\n  ggtitle(\"Earthquakes per day reported by the SSN\", \"Since 1900 to 2022\") \n```", "```py\n# SEISMIC ACTIVITY SINCE 1900 BY INTENSITY\n\ntimeSeries1 <- dataSSN %>% \n  .[, .(seismicCount = .N), by=list(date, intensityRanges)] %>% \n  na.omit %>% \n  ggplot(aes(x= date, y= seismicCount, color=intensityRanges)) +\n  geom_line(size=1)+\n  scale_color_manual(values= myColors, name=\"Richter Scale\") +\n  theme(legend.position=\"top\")+\n  ggtitle(\"Earthquakes per day reported by the SSN\", \"Magnitude ranges since 1900 to 2022\")+\n  xlab(\"Year\") +\n  ylab(\"Earthquakes count\") \n\ntimeSeries2 <- dataSSN %>% \n  .[, .(seismicCount = .N), by=list(date, intensityRanges)] %>% \n  na.omit %>% \n  ggplot(aes(x= date, y= seismicCount, color=intensityRanges)) +\n  geom_line(size=1)+\n  scale_color_manual(values= myColors) +\n  scale_x_date(breaks = \"4 year\")+\n  theme(legend.position=\"top\", axis.text.x = element_text(angle=90))+\n  xlab(\"Year\") +\n  ylab(\"Earthquakes count\") +\n  facet_wrap(~intensityRanges, scales = \"free_y\") \n\nggarrange(timeSeries1, timeSeries2,\n          nrow = 2)\n```", "```py\n# SEISMIC ACTIVITY SINCE 1900 BY INTENSITY (>6)\n\ndataSSN %>% \n  .[intensity>6] %>% \n  .[, .(seismicCount = .N), by=list(date, intensityRanges)] %>%\n  ggplot(aes(x= (date), y= seismicCount)) +\n  geom_segment( aes(x=(date), xend=date, y=0, yend=seismicCount, color=intensityRanges)) +\n  geom_point(size=3, alpha=0.6, aes(color= intensityRanges))+\n  scale_color_manual(values= c(\"darkcyan\", \"darkred\"), name=\"Range Magnitude Richter Scale\") +\n  scale_x_date(breaks = \"5 years\")+\n  scale_y_continuous(breaks = seq(0,2,1))+\n  theme(legend.position=\"top\", axis.text.x = element_text(angle=45))+\n  ggtitle(\"Earthquakes reported by the SSN\", \"Intensity > 6 (Since 1900 to 2022)\")+\n  xlab(\"Year\") +\n  ylab(\"Earthquakes count\")\n```", "```py\n# SEISMIC ACTIVITY REPORTED SINCE 1900 (PER MONTH)\n\ndataSSN %>% \n  .[, .(seismicCount = .N), by=list(month, monthName)] %>% \n  .[order(month)] %>% \n  ggplot(aes(x= reorder(monthName, month), y= seismicCount)) +\n  geom_bar(stat = \"identity\") +\n  geom_col(aes(fill = seismicCount)) +\n  theme(axis.text.x = element_text(angle=45)) +\n  geom_label(aes(reorder(monthName, month), y= seismicCount,\n                 label=seismicCount) ) +\n  xlab(\"Month\") +\n  ylab(\"Earthquakes count\")+\n  ggtitle(\"Earthquakes reported by the SSN\", \"Earthquakes per month (Since 1900 to 2022)\")\n```", "```py\n# SEISMIC ACTIVITY REPORTED SINCE 1900 (PER MONTH AND INTENSITY)\n\nrangesMonth <- dataSSN %>% \n  .[, .(seismicCount = .N), by=list(monthName, month, intensityRanges)] %>% \n  ggplot(aes(x= reorder(monthName, month), y= seismicCount, fill= intensityRanges)) +\n  geom_bar(stat = \"identity\") +\n  scale_fill_manual(name = \"Response\", values = myColors) +\n  theme(axis.text.x = element_text(angle=45), legend.position=\"top\") +\n  xlab(\"Month\") +\n  ylab(\"Earthquakes count\")+\n  ggtitle(\"Earthquakes reported by the SSN\", \"Earthquakes per month (Grouped by intensity since 1900 to 2022)\")\n\nrangesMonth\n```", "```py\n# SEISMIC ACTIVITY REPORTED SINCE 1900 (GROUPED BY INTENSITY >6)\n\ndataSSN %>% \n  .[intensity>6] %>% \n  .[, .(seismicCount = .N), by=list(monthName, month, intensityRanges)] %>% \n  ggplot(aes(x= reorder(monthName, month), y= seismicCount, fill= intensityRanges)) +\n  geom_bar(stat = \"identity\")+\n  scale_y_continuous(breaks = seq(0,100,1))+\n  theme(axis.text.x = element_text(angle=45), legend.position=\"top\")+\n  scale_fill_manual(values= c(\"darkcyan\", \"darkred\"), name=\"Range Magnitude Richter Scale\")+  \n  xlab(\"Month\") +\n  ylab(\"Earthquakes count\")+\n  geom_label(aes(reorder(monthName, month), y= seismicCount, label=seismicCount) )+\n  ggtitle(\"Earthquakes reported by the SSN\", \"Earthquakes per month (Intensity > 6 since 1900 to 2022)\")\n```", "```py\n# DAYS THAT AN EARTHQUAKE OF INTENSITY >6 HAS BEEN REPEATED AT LEAST 3 OR MORE TIMES\n\ndataSSN %>% \n  .[intensity>=6] %>%\n  .[, .(seismicCount = .N), by=list(month, monthDay)] %>% \n  .[order(month)] %>% \n  .[seismicCount>=3] %>%\n  ggplot(aes(x= reorder(monthDay, month), y= seismicCount)) +\n  geom_bar(stat = \"identity\", fill=\"darkcyan\")+\n  geom_col(aes(fill = seismicCount)) +\n  theme(axis.text.x = element_text(angle=45)) +\n  geom_label(aes(reorder(monthDay, month), y= seismicCount, label=seismicCount) ) +\n  xlab(\"Date (month-day)\") +\n  ylab(\"Earthquakes count\")+\n  ggtitle(\"Earthquakes reported by the SSN\", \"Dates that have occurred three or more earthquakes on the same day \nand month but different year (Intensity >= 6 since 1900 to 2022)\")\n```", "```py\n# WEEKDAYS THAT AN EARTHQUAKE OF INTENSITY >7 HAS BEEN REPEATED MORE TIMES\n\ndataSSN %>% \n  .[intensity>=7] %>%\n  .[order(dayName)] %>% \n  .[, .(seismicCount = .N), by=list(dayName)] %>% \n  ggplot(aes(x= dayName, y= seismicCount)) +\n  geom_bar(stat = \"identity\", fill=\"darkcyan\")+\n  geom_col(aes(fill = seismicCount)) +\n  theme(axis.text.x = element_text(angle=45)) +\n    xlab(\"Mes\") +\n  ylab(\"Conteo Sismos\")+\n  ggtitle(\"Earthquakes reported by the SSN\", \"Weekdays with greater occurrences of earthquakes (Intensity >= 7 since 1900 to 2022)\")\n```", "```py\n# MAP SEISMIC ACTIVITY BY STATE 1 \n\ndataSSN %>% \n  .[, .(seismicCount = .N), by=list(nombreEstado)] %>% \n  merge(., mxMap, by.x=\"nombreEstado\", by.y=\"NOM_ENT\") %>% \n  st_as_sf() %>% \n  ggplot()+\n  geom_sf(aes(fill = seismicCount)) + \n  ggtitle(\"Earthquakes reported by the SSN\", \"Map of seismic activity in Mexico (Since 1900 to 2022)\")\n```", "```py\n# MAP SEISMIC ACTIVITY BY STATE 2\n\ntmap_style(\"classic\")\n\nstatesMap <- dataSSN %>% \n  .[, .(seismicCount = .N), by=list(nombreEstado)] %>% \n  merge(., mxMap, by.x=\"nombreEstado\", by.y=\"NOM_ENT\") %>% \n  st_as_sf() %>% \n  tm_shape() +\n  tm_polygons(\"seismicCount\", \n              title = \"Number of earthquakes range\")+\n  tm_layout(\"Number of earthquakes \n              by State (Since 1900 to 2022)\", title.position = c('right', 'top'))\n\nstatesMap\n```", "```py\n# SEISMIC ACTIVITY GROUPED BY STATE \n\nparetoData <- dataSSN %>% \n  .[, .(seismicCount = .N), by=list(nombreEstado)]  %>% \n  .[, total := sum(seismicCount)] %>% \n  .[order(seismicCount, decreasing = T)] %>% \n  .[, accumulatedSum := cumsum(seismicCount)] %>% \n  .[, percentage := seismicCount/total] %>% \n  .[, accumulatedPercentage := accumulatedSum/total]\n\nlistPercentage <- 0:100\n\nstatesBars <- ggplot(data= data.frame(paretoData), aes(x=nombreEstado)) +\n  geom_bar(aes(x=reorder(nombreEstado, -seismicCount), y=seismicCount), fill='darkcyan', stat=\"identity\") + \n  scale_y_continuous(limits = c(0, (max(paretoData$seismicCount))+15000 ))+\n  theme(axis.text.x = element_blank(), axis.title.x = element_blank())+\n  ylab(\"Earthquakes count\")+\n  geom_text(aes(reorder(nombreEstado, -seismicCount), y= seismicCount, label=seismicCount), vjust=-1, angle=45, hjust=0)+\n  ggtitle(\"Earthquakes reported by the SSN\", \"Earthquakes grouped by State (Since 1900 to 2022)\")\n\nstatesPercentage <- ggplot(data= data.frame(paretoData)) +\n  geom_bar(aes(x=reorder(nombreEstado, -seismicCount), y=percentage), fill='darkcyan', stat=\"identity\") + \n  theme(axis.text.x = element_text(angle=45, hjust=1))+\n  scale_y_continuous(labels = scales::percent, breaks = seq(0,1,0.1), limits=c(0,0.7))+\n  xlab(\"State\") +\n  ylab(\"Earthquakes count\")+\n  geom_text(aes(x= reorder(nombreEstado, -seismicCount), y = percentage,\n                label=paste0(round(percentage*100, 3),\"%\"), vjust=0, angle=45, hjust=0))+\n  ggtitle(\" \", \"Percentage of earthquakes by State (Since 1900 to 2022)\")\n\nggarrange(statesBars, statesPercentage, nrow = 2)\n```", "```py\n# MAP TOP EARTHQUAKES >= 7.5\n\ntopEarthquakes <- dataSSN %>%  \n  .[intensity>=7.5]\n\nggplot(data = mxMap) +\n  geom_sf()+\n  geom_point(data= topEarthquakes, aes(x= longitud, y= latitud, size= intensity), color=\"darkcyan\")+\n  scale_color_manual( name=\"Magnitud escala de Richter\")+\n  theme(axis.text = element_blank(), axis.title = element_blank(), legend.position=\"top\")+\n  ggrepel::geom_text_repel(data= topEarthquakes, aes(x= longitud, y= latitud, label= intensity), color=\"darkred\")+\n  ggtitle(\"Earthquakes reported by the SSN\", \"Map of strongest earthquakes locations (Intensity >= 7.5 since 1900 to 2022)\")\n```"]