# 使用 Node.js 构建语音转文本网页应用

> 原文：[https://towardsdatascience.com/build-a-speech-to-text-web-app-using-node-js-210f8c054d79](https://towardsdatascience.com/build-a-speech-to-text-web-app-using-node-js-210f8c054d79)

## 我们来构建一个使用 OpenAI 的 Whisper 模型来转录和翻译音频的网页应用

[](https://shubhamstudent5.medium.com/?source=post_page-----210f8c054d79--------------------------------)[![Kumar Shubham](../Images/64eed4588cc63804a612f01d5c6ec1ea.png)](https://shubhamstudent5.medium.com/?source=post_page-----210f8c054d79--------------------------------)[](https://towardsdatascience.com/?source=post_page-----210f8c054d79--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----210f8c054d79--------------------------------) [Kumar Shubham](https://shubhamstudent5.medium.com/?source=post_page-----210f8c054d79--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----210f8c054d79--------------------------------) ·阅读时间 11 分钟·2023年3月27日

--

![](../Images/25b5d8abf919e8d8c304f803d5948166.png)

图片由 [AltumCode](https://unsplash.com/@altumcode?utm_source=medium&utm_medium=referral) 提供，来源于 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

大家好！希望你们一切都好。今天，我们将使用 Node.js 和 OpenAI 的 API 构建一个语音转文本网页应用。我们将使用 OpenAI 的 API 来使用其 Whisper 模型，该模型允许我们上传 mp3 格式的音频文件，并提供其文字稿。它甚至可以将其他语言的音频翻译成英文文本，实在令人惊叹。

首先，我们将设置一个新的 Node.js 项目，以便我们可以开始构建我们的应用。因此，我们将创建一个文件夹，在其中构建我们的项目，并使用命令行进入该文件夹，然后我们可以使用以下命令来设置一个新的 Node.js 项目：

[PRE0]

运行此命令后，它将询问一些问题，例如应用程序的名称、入口点等。我们现在可以将其保留为默认设置。之后，你会看到它创建了一个`package.json`文件。该文件包含有关我们应用程序的信息以及我们为该应用程序安装了哪些包。

接下来的一步是将必要的 Node 模块，即包，安装到我们的应用中，以便我们可以开始构建应用。我们可以通过运行以下命令来完成：

[PRE1]

我们安装这四个包，并使用`--save`将这些包添加到`package.json`文件中。这使得克隆仓库的人只需运行一次`npm install`命令即可轻松安装所有所需的包。

我们还希望在应用程序中使用nodemon包，以帮助我们在检测到代码更改时自动刷新和重新加载服务器，这样我们就不需要在每次更改后手动重新启动服务器。因此，我们将其添加为开发依赖项，因为它只用于开发中的帮助，我们不会直接在代码中使用它。我们可以使用以下命令安装它：

[PRE2]

现在我们拥有了开始开发所需的所有包。正如我们在`package.json`文件中看到的，里面列出了我们安装的所有模块和包，以及一些关于应用程序的细节。`package.json`文件应如下所示：

[PRE3]

所以，如我们所见，`index.js`是写在`main`中，表示`index.js`文件是我们应用程序的入口点。如果你还记得，这在我们运行`npm init`命令时的设置过程中有所要求。如果你将其留作默认设置，你将拥有相同的入口点；否则，你将拥有当时定义的入口点。

现在，我们将创建一个名为`index.js`的新文件。你可以根据自己定义的入口点命名文件。我们考虑使用`index.js`。

## index.js

所以，我们现在将开始构建`index.js`文件。我们将从将所需模块导入到我们的应用程序开始。对于索引文件，我们需要`express`和`cors`。因此，我们首先需要这两个模块：

[PRE4]

接下来，我们将创建一个新的`express`应用程序实例。同时，我们将设置应用程序以使用cors，处理json数据，并使`public`文件夹包含静态文件，这些文件可以由客户端或前端访问。

[PRE5]

接下来，我们希望有一个单独的文件来定义API。我们将创建一个名为`routes`的文件夹，并在其中创建一个名为`api.js`的文件，在该文件中定义应用程序所需的GET和POST API。为了让应用程序知道这一点，我们将添加这一行代码，以定义基本URL和所有API定义文件的位置。这是一个中间件，帮助我们设置应用程序的路由。

[PRE6]

接下来，我们使用一个错误处理的中间件函数，该函数将用于处理应用程序中发生的任何错误。

[PRE7]

最后，我们设置应用程序以监听指定端口号的传入请求，我们可以通过使用环境变量来设置，或者直接定义。

[PRE8]

我们为我们的应用程序使用了4000端口。我们还在其中添加了一个简单的`console.log`，当应用程序准备好接收请求时，它会在控制台上打印一条消息。

完整的`index.js`文件：

[PRE9]

接下来，我们将转到`api.js`文件，该文件位于`routes`文件夹内。

## api.js

所以，我们现在将开始构建`api.js`文件。我们将通过将所需模块导入文件来开始。我们将导入`express`、`multer`和`openai`库。

[PRE10]

[Multer](https://www.npmjs.com/package/multer) 是一个中间件，我们使用它来处理 `multipart/form-data`，因为我们将处理音频文件的上传。

从 `openai` 中，我们需要 `Configuration` 和 `OpenAIApi` 模块，用于向 Whisper 模型发送 API 请求。

然后，我们将设置 express 路由器，并创建一个 multer 中间件的实例。

[PRE11]

接下来，我们将配置 OpenAI 并创建一个新的配置实例。我们需要一个 OpenAI 密钥，我们必须在这里将其作为 API 密钥。你可以从 [这里](https://platform.openai.com/account/api-keys) 获取密钥。

[PRE12]

现在，我们创建一个异步函数，该函数接受一个包含歌曲数据的缓冲区，并返回当我们调用 OpenAI 的 Whisper 模型 API 时收到的响应。

[PRE13]

如上所示，我们首先通过使用在代码中之前定义的配置创建 OpenAI 类的新实例。然后我们调用 OpenAI 的 `createTranscription` 函数，并在其中使用 `await` 关键字，以便我们在继续之前等待响应。

我们在函数中传递所需的参数，其中包括包含歌曲数据的缓冲区，以及用于转录的模型，在我们的情况下是 `whisper-1`。然后我们将 prompt 留空。如果愿意，你也可以提供一个 prompt，这将帮助模型通过提供与 prompt 类似的风格来更好地转录音频。我们将接收的数据类型定义为 `json`，将温度设置为 1，并定义我们希望输出的语言。

接下来，我们将定义 GET 请求。我们使用 `sendFile` 发送一个包含我们表单的 HTML 文件，用户可以在其中上传音频文件。我们稍后将构建这些 HTML 文件。我们将它提供在基本 URL 上。

[PRE14]

接下来，我们定义 POST 请求，它将处理音频文件的上传。我们使用 multer 中间件来管理文件上传部分。然后我们从音频文件创建一个缓冲区，该缓冲区将包含可以发送到 OpenAI API 的音频文件数据。我们使用上传音频文件的原始名称为缓冲区设置一个名称。

然后我们调用 `transcribe` 函数，一旦获得响应，我们将 JSON 数据发送回客户端。我们将转录文本和音频文件名返回到前端。我们还有一个 catch 方法来处理任何错误。

[PRE15]

最后，我们导出 `router` 模块，这样其他文件就可以导入它们。

[PRE16]

所以，`api.js` 文件的完整代码是：

[PRE17]

现在，我们已经完成了所有的后端部分。接下来我们将编写 HTML 文件和一些前端 JavaScript 代码，以处理表单提交和数据保存在 [本地存储](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) 以及从本地存储中检索数据。

我们创建一个 `public` 文件夹，在其中我们将创建两个 HTML 文件——`index.html` 和 `transcribe.html`。

我们将从 `index.html` 文件开始：

## index.html

在这个文件中，我们将构建一个页面，展示上传音频文件的表单。我们将使用Bootstrap CSS，通过CDN引入它。我们还在HTML文件的末尾通过CDN引入Bootstrap JS。

然后，我们创建了一个简单的卡片，要求用户上传音频文件。我确保提交的文件格式为`.mp3`，因为这是OpenAI的API唯一接受的格式。我们显示一个按钮，点击后提交表单。

然后，我们有了处理表单提交的JavaScript代码。所以，首先，我们通过阻止表单提交事件的默认行为来停止页面刷新。然后，我们获取表单数据，即音频文件，并将其作为POST请求发送到后台。接着，我们等待响应并将其存储在数据变量中。

如果数据中有可用的转录文本，我们将转录文本和音频文件名存储在本地存储中，以便在需要显示转录文本的下一页访问它们。虽然有多种方法可以传递信息，比如通过URI传递信息，但在这里我们使用本地存储来实现。

保存数据到本地存储后，我们更改窗口位置以加载`transcribe.html`文件。

[PRE18]

所以上述代码构建了`index.html`文件，该文件将向用户显示一个表单，用户可以通过这个表单上传音频文件。

这是其中一个截图的效果：

![](../Images/fe9588bef9851c77d208fb289b8ef707.png)

音频上传页面 — index.html

接下来，我们将构建`transcribe.html`文件。

## transcribe.html

在这个文件中，我们将显示用户上传的音频文件的转录文本。因此，我们将再次使用Bootstrap CSS和JS，通过CDN引入这些资源。

然后，我们定义了一些自定义CSS来美化元素，使其看起来更好。我们在一个容器中显示音频文件名和该音频文件的转录文本。

在此页面底部的JavaScript代码中，我们从本地存储中获取音频文件名和转录文本，并使用id将这些数据推送到相应的HTML元素中。

[PRE19]

我尝试了两个不同的小音频文件，一个是英语录制的，另一个是印地语录制的。虽然第二个音频文件是用印地语录制的，但我希望看到英语的输出，从而测试其翻译能力。它在转录两个音频文件时都非常准确。不过，在多次运行中，有时会产生不正确的模糊转录，但许多时候，转录结果大多是正确的。

我在下面附上了转录的屏幕截图。这些截图并不完全正确，但我认为它们的转录准确率大约为85%–90%。

![](../Images/1fc8ef9508130d82958cf9365446c051.png)

英语音频文件的转录

![](../Images/f25f5333a3939b203c03e921e5998e40.png)

印地语音频文件的英语转录

因此，我们已经成功使用 OpenAI 的 API 和 Node.js 构建了一个语音转文本的 Web 应用程序。希望你喜欢构建这个应用，并从这篇文章中学到了一些新东西。你还可以调整参数进行实验，并比较结果，以更好地了解在不同场景下什么效果更好。

感谢阅读本文。接下来你必须阅读的一些文章包括：

[](https://javascript.plainenglish.io/build-a-simple-todo-app-using-next-js-f88b68761e27?source=post_page-----210f8c054d79--------------------------------) [## 使用 Next.js 构建一个简单的 Todo 应用

### 让我们使用 Next.js 构建一个简单的 Todo 应用，这将教会你 CRUD（创建、读取、更新和...

[如何使用 Next.js 构建一个简单的 Todo 应用](https://javascript.plainenglish.io/build-a-simple-todo-app-using-next-js-f88b68761e27?source=post_page-----210f8c054d79--------------------------------) [](https://medium.com/geekculture/how-to-implement-multiple-user-types-in-django-b72df7a98dc3?source=post_page-----210f8c054d79--------------------------------) [## 如何在 Django 中实现多用户类型

### 学习如何在 Django 中实现多用户类型，处理认证，并根据用户类型进行重定向。

[如何在 Django 中实现多用户类型](https://medium.com/geekculture/how-to-implement-multiple-user-types-in-django-b72df7a98dc3?source=post_page-----210f8c054d79--------------------------------) [](/build-a-simple-todo-app-using-react-a492adc9c8a4?source=post_page-----210f8c054d79--------------------------------) [## 使用 React 构建一个简单的 Todo 应用

### 让我们使用 React 构建一个简单的 Todo 应用，这将教会你 CRUD（创建、读取、更新和...

[使用 React 构建一个简单的 Todo 应用](https://towardsdatascience.com/build-a-simple-todo-app-using-react-a492adc9c8a4?source=post_page-----210f8c054d79--------------------------------) [](/build-a-social-media-website-using-django-setup-the-project-part-1-6e1932c9f221?source=post_page-----210f8c054d79--------------------------------) [## 使用 Django 构建一个社交媒体网站 — 项目设置（第 1 部分）

### 在第一部分中，我们专注于设置项目和安装所需组件，通过设置密码...

[构建一个社交媒体网站使用 Django — 项目设置（第 1 部分）](https://towardsdatascience.com/build-a-social-media-website-using-django-setup-the-project-part-1-6e1932c9f221?source=post_page-----210f8c054d79--------------------------------)
