- en: Can ChatGPT Write Better SQL than a Data Analyst?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/can-chatgpt-write-better-sql-than-a-data-analyst-f079518efab2](https://towardsdatascience.com/can-chatgpt-write-better-sql-than-a-data-analyst-f079518efab2)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[](https://medium.com/@marietruong?source=post_page-----f079518efab2--------------------------------)[![Marie
    Truong](../Images/2816e49beef958724dc0f38cfa49c4be.png)](https://medium.com/@marietruong?source=post_page-----f079518efab2--------------------------------)[](https://towardsdatascience.com/?source=post_page-----f079518efab2--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----f079518efab2--------------------------------)
    [Marie Truong](https://medium.com/@marietruong?source=post_page-----f079518efab2--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----f079518efab2--------------------------------)
    ·6 min read·Jan 5, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f2655bf17162524ed1547496c3c4b170.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [DeepMind](https://unsplash.com/@deepmind?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: 'I tried [ChatGPT](https://chat.openai.com/), a variant of the GPT-3 language
    model that is specifically designed for generating human-like text in a conversational
    context. And of course, like most of us, I wondered: can an AI do my job? And
    can it do it better than me?'
  prefs: []
  type: TYPE_NORMAL
- en: I have 2 years of experience working as a Data Analyst and an Analytics Engineer.
    According to [BBC Science Focus](https://www.sciencefocus.com/future-technology/gpt-3/),
    ChatGPT has ingested 570 GB of data. So who writes better SQL?
  prefs: []
  type: TYPE_NORMAL
- en: Let’s play!
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This game will be based on 3 LeetCode SQL challenges (one easy, two medium).
    I will write every solution first, and then send the exercise to ChatGPT and see
    which solution works best.
  prefs: []
  type: TYPE_NORMAL
- en: I will provide links to every challenge so you can try as well to beat ChatGPT.
  prefs: []
  type: TYPE_NORMAL
- en: Challenge 1 (Easy)
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This challenge is called [Customer placing the largest number of orders](https://leetcode.com/problems/customer-placing-the-largest-number-of-orders/).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0ec1b96ddbf576a2d6c76fb843c70491.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the query I wrote:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'It passed with a correct runtime:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/75b5c9b6e291d0dea7aa3695f4a59d5a.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: Now let’s see how ChatGPT performs on this one.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is what ChatGPT answered:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ac75a691af623b0303e4b053eb75d730.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: ChatGPT even explains what it did. I don’t find the query very readable — one
    of the reasons why I love common table expressions is readability — but let’s
    see how it performs.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/41c06d21e8cae27c840c9f1cc7f5fb93.png)'
  prefs: []
  type: TYPE_IMG
- en: Impressively, it works, but it is slower than my result. Although I am glad
    to do better than ChatGPT, I would have loved to know how I can improve this query.
  prefs: []
  type: TYPE_NORMAL
- en: Challenge 2 (Medium)
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The next challenge is called [Tree Node](https://leetcode.com/problems/tree-node/).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7a4f164d806385bfe3e058a5ee756a0d.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'The first query I wrote was this one:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: I ran it before submitting it, and it got the wrong result…
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/dfc0882e59ed813ed3fbacfd3885808a.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Turns out I hadn’t paid enough attention to the examples, especially the second
    one:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0f80c2ce4f7be72ebc34935c069bd992.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'When a node is both a leaf and a root, it should be output as a root. I changed
    the order of my CASE WHEN to this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: And this time, it passed!
  prefs: []
  type: TYPE_NORMAL
- en: 'My query got an average result:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4f27f92a48e4a3f25777333bd8b4c7db.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: Time for ChatGPT to play the game!
  prefs: []
  type: TYPE_NORMAL
- en: 'ChatGPT read all the examples and did not make my mistake on nodes that are
    both a root and a leaf:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/fbf217774e0e7c72081c3e00851f7e6d.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'But it still gave me a wrong answer:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/cfd932af855fe4fdb0096174a7632fd2.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: ChatGPT didn’t return one row per id.
  prefs: []
  type: TYPE_NORMAL
- en: 'So I decided to give ChatGPT a hint:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/13d29a10b7d68e364fd0d7e59166fbc4.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: And it was able to correct it!
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c07374a6cc891bd1c1b16cf176e5643a.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: We both made a mistake in this challenge and both were able to fix it (although
    I had to give a hint to ChatGPT). I had a slightly better result in terms of runtime,
    so point goes to me but it was close!
  prefs: []
  type: TYPE_NORMAL
- en: Challenge 3 (Medium)
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The last challenge is called [Capital Gain/Loss](https://leetcode.com/problems/capital-gainloss/).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/5751d0eb2a65226a2eef11f9356ea05d.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the query I wrote:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/19932aa1c08426f372e794b9a7a92345.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: It passed but the runtime is pretty bad, more than 90% of players did better
    than me on this one.
  prefs: []
  type: TYPE_NORMAL
- en: Let’s see if ChatGPT is one of them.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/332d69a37cb812ef6b02498c0d1bfad4.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s try this solution:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/5584cb1710d6e08c45369031e8d938a4.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: Again, it gets the wrong result. ChatGPT joins one buy with every future sell
    and not only the corresponding one, hence its solution only works if there is
    just one pair of Buy/Sell operations.
  prefs: []
  type: TYPE_NORMAL
- en: 'I tried to tell ChatGPT to fix its mistake, without giving it a hint:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ae6fcb9e1d109919d54a63a454f95d5c.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Unfortunately, it gives me exactly the same query. So I complained:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6fa457ec958761e22d4c1b3e004ebaf7.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/46ad31bb200fc87515ef303973e01a98.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: This time, ChatGPT and I used a similar structure and the query passed. However,
    I am not sure that ChatGPT really understood what it did wrong in the first place.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7aaa930367d61792b2536aa4970efe23.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by Author
  prefs: []
  type: TYPE_NORMAL
- en: The runtime of ChatGPT is slightly worse than mine.
  prefs: []
  type: TYPE_NORMAL
- en: '**Results**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: I think it’s fair to say that I “won” this SQL challenge against ChatGPT. I
    was still impressed by its abilities, and amazed that it is able to correct its
    mistake! ChatGPT definitely beats me on speed; it writes valid SQL syntax in a
    few seconds, whereas I need a few minutes.
  prefs: []
  type: TYPE_NORMAL
- en: But it still got 50% of it wrong. And even if it had completed successfully
    every challenge, I wouldn’t worry about my job. Stakeholders never come to analysts
    with such a well-defined request and output examples. They come with a business
    question, and we have to think about the best way to answer it with available
    data. Can ChatGPT do that?
  prefs: []
  type: TYPE_NORMAL
- en: 'I asked ChatGPT its opinion on the matter:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e0edd8c7fd6bf821297d055a713e4510.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot Author
  prefs: []
  type: TYPE_NORMAL
- en: That sums it all up!
  prefs: []
  type: TYPE_NORMAL
- en: I hope you enjoyed this article! If you did, please follow me for more content
    on SQL and Data Analysis.
  prefs: []
  type: TYPE_NORMAL
