# Dijkstra ç®—æ³•åœ¨ OSM ç½‘ç»œä¸­æŒ‰æ—…è¡Œæ—¶é—´åŠ æƒ

> åŽŸæ–‡ï¼š[https://towardsdatascience.com/dijkstras-algorithm-weighted-by-travel-time-in-osm-networks-792aa92e03af](https://towardsdatascience.com/dijkstras-algorithm-weighted-by-travel-time-in-osm-networks-792aa92e03af)

## ä½¿ç”¨ OSMNX 1.6 å¯»æ‰¾æœ€å¿«å’Œæœ€çŸ­è·¯å¾„

[](https://bryanvallejo16.medium.com/?source=post_page-----792aa92e03af--------------------------------)[![Bryan R. Vallejo](../Images/fd92974f57c72875cc133a2c959d64ca.png)](https://bryanvallejo16.medium.com/?source=post_page-----792aa92e03af--------------------------------)[](https://towardsdatascience.com/?source=post_page-----792aa92e03af--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----792aa92e03af--------------------------------) [Bryan R. Vallejo](https://bryanvallejo16.medium.com/?source=post_page-----792aa92e03af--------------------------------)

Â·å‘è¡¨äºŽ [Towards Data Science](https://towardsdatascience.com/?source=post_page-----792aa92e03af--------------------------------) Â·7 min é˜…è¯»Â·2023å¹´10æœˆ10æ—¥

--

![](../Images/692de08c2ac0d0d9fef8304a5bad06dc.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚æ‘©æ´›å“¥ç¤ºä¾‹ä¸­çš„æœ€å¿«è·¯çº¿ï¼ˆçº¢è‰²ï¼‰å’Œæœ€çŸ­è·¯çº¿ï¼ˆæ©™è‰²ï¼‰

æœ€çŸ­è·¯å¾„ï¼ˆDijkstraï¼‰ç®—æ³•å¯ä»¥åº”ç”¨äºŽ OSM ç½‘ç»œä¸­ï¼Œå¦‚é©¾é©¶ã€éª‘è¡Œå’Œæ­¥è¡Œï¼Œä»¥æ‰¾åˆ°èµ·ç‚¹å’Œç»ˆç‚¹ä¹‹é—´çš„æœ€ä¼˜è·¯çº¿ã€‚ä½†è¯¥ç®—æ³•åœ¨ç½‘ç»œä¸­è®¡ç®—åŸºäºŽè·ç¦»çš„æœ€çŸ­è·¯çº¿ï¼Œè¿™å¹¶ä¸æ„å‘³ç€æœ€ä¼˜è·¯çº¿ã€‚åœ¨é“è·¯ç½‘ç»œä¸­ï¼Œè·ç¦»å¯ä»¥æ˜¯ç›¸å¯¹çš„ï¼Œå½“æˆ‘ä»¬è€ƒè™‘é“è·¯çš„é€Ÿåº¦æ—¶ã€‚æ˜¾ç„¶ï¼Œåœ¨æ‰€æœ‰é“è·¯é€Ÿåº¦ç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œä¸¤ç‚¹ä¹‹é—´çš„æœ€ä¼˜è·¯çº¿å¯èƒ½æ˜¯æœ€çŸ­çš„ã€‚å¦‚æžœæˆ‘ä»¬æ¯”è¾ƒé«˜é€Ÿå…¬è·¯ä¸ŽåŸŽå¸‚è¡—é“çš„é€Ÿåº¦ï¼Œæˆ‘ä»¬ä¼šé‡æ–°è°ƒæ•´è¿™ä¸ªæƒ³æ³•ï¼Œç†è§£æœ€ä¼˜è·¯çº¿æ˜¯æœ€å¿«çš„ã€‚

> â€œåœ¨é“è·¯ç½‘ç»œä¸­ï¼Œè·ç¦»å¯èƒ½æ˜¯ç›¸å¯¹çš„ï¼Œå½“æˆ‘ä»¬è€ƒè™‘é“è·¯çš„é€Ÿåº¦æ—¶â€

å€ŸåŠ© Python åº“ OSMNXï¼Œå¯ä»¥åœ¨å…¨çƒèŒƒå›´å†…ä¸ºä¸åŒç±»åž‹çš„é“è·¯æ·»åŠ é€Ÿåº¦ï¼Œå¹¶è®¡ç®— OSM ç½‘ç»œä¸­èŠ‚ç‚¹ä¹‹é—´çš„*æ—…è¡Œæ—¶é—´*ã€‚è¿™ä½¿å¾— Python åº“å¯ä»¥å¤„ç†ä»¥*æ—…è¡Œæ—¶é—´*åŠ æƒçš„æœ€çŸ­è·¯å¾„ç®—æ³•ã€‚

è¿™ä¸€å®žè·µæ˜¯ä¹‹å‰ä¸€ä¸ªæ•™ç¨‹çš„å»¶ç»­ï¼Œé‚£ä¸ªæ•™ç¨‹ä½¿ç”¨äº†æœ€çŸ­è·¯å¾„ç®—æ³•æ¥è®¡ç®—æ‘©æ´›å“¥ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„æœ€çŸ­è·¯çº¿ã€‚

## æ‘©æ´›å“¥ OSM ç½‘ç»œä¸­çš„æœ€çŸ­è·¯çº¿

[](/shortest-path-dijkstras-algorithm-step-by-step-python-guide-896769522752?source=post_page-----792aa92e03af--------------------------------) [## æœ€çŸ­è·¯å¾„ï¼ˆDijkstraï¼‰ç®—æ³•é€æ­¥ Python æŒ‡å—

### ä½¿ç”¨ OSMNX 1.6 çš„æ›´æ–°åŠé•¿è·ç¦»è·¯å¾„

towardsdatascience.com](/shortest-path-dijkstras-algorithm-step-by-step-python-guide-896769522752?source=post_page-----792aa92e03af--------------------------------)

# è®¿é—®ç¼–ç æ•™ç¨‹

å¦‚æžœä½ è¿˜ä¸æ˜¯[Medium](https://medium.com/u/504c7870fdb6?source=post_page-----792aa92e03af--------------------------------)çš„ä¼šå‘˜ï¼Œä½ éœ€è¦è®¢é˜…æ‰èƒ½è®¿é—®è¿™äº›æ•…äº‹ã€‚ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨æˆ‘çš„ä¸ªäººé“¾æŽ¥æ¥è·Ÿéšæ›´å¤šç¼–ç æ•™ç¨‹å¹¶æ”¯æŒæˆ‘çš„å·¥ä½œã€‚æˆä¸ºè¿™æ®µç¼–ç ä¹‹æ—…çš„ä¸€éƒ¨åˆ†ã€‚

> è¿™é‡ŒåŠ å…¥ ðŸ‘‰ [https://bit.ly/3yjLsSL](https://bit.ly/3yjLsSL)

# OSM æ•°æ®è®¸å¯è¯

+   **Open Street Map æ•°æ®ã€‚** è®¸å¯äºŽ [Open Data Commons Open Database License (ODbl)](https://opendatacommons.org/licenses/odbl/) æˆ–ç½²åè®¸å¯ã€‚ç”¨æˆ·å¯ä»¥è‡ªç”±å¤åˆ¶ã€åˆ†å‘ã€ä¼ è¾“å’Œè°ƒæ•´æ•°æ®ï¼Œåªè¦æ³¨æ˜Žä½œè€…ï¼Œå¦‚Â© [OpenStreetMap](https://www.openstreetmap.org/copyright) è´¡çŒ®è€…ã€‚

# ä»‹ç»

æŽ¥ä¸‹æ¥çš„æ­¥éª¤å°†æŒ‡å¯¼å¦‚ä½•ä½¿ç”¨æ—…è¡Œæ—¶é—´åº”ç”¨æœ€çŸ­è·¯å¾„ã€‚æˆ‘ä»¬å°†æ¯”è¾ƒæœ€å¿«è·¯çº¿å’Œæœ€çŸ­è·¯çº¿ï¼Œä»¥äº†è§£æ—…è¡Œæ—¶é—´å’Œé•¿åº¦çš„å˜åŒ–ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å°†ä½¿ç”¨OSMNXä¸­çš„æ›´å¤šå‡½æ•°æ¥æ”¹è¿›ç»“æžœï¼Œå¦‚`utils_graph.route_to_gdf()`ï¼Œä»¥åŠè®¡ç®—*æ—…è¡Œæ—¶é—´*çš„`add_edge_speeds()`å’Œ`add_edge_travel_times()`ã€‚

è¿™æ˜¯ç”±[Hanae](https://medium.com/u/3b913af53dd0?source=post_page-----792aa92e03af--------------------------------)å»ºè®®çš„èµ·ç‚¹å’Œç»ˆç‚¹çš„å¿«é€Ÿè§†å›¾ã€‚

![](../Images/dd1ded2472ba3b204998b6b2c29a83e0.png)

ä½œè€…æä¾›çš„å›¾åƒã€‚èµ·ç‚¹å’Œç»ˆç‚¹ä½ç½®ã€‚

# ç¼–ç å®žè·µ

å¼€å§‹èŽ·å–æˆ‘ä»¬éœ€è¦çš„åº“ã€‚

[PRE0]

## 1\. å®šä¹‰èµ·ç‚¹å’Œç»ˆç‚¹ä¸ºGeoDataFrames

å¼€å§‹æ·»åŠ åæ ‡å¹¶ä½¿ç”¨Geopandasåˆ›å»ºæ–°çš„GDFã€‚

[PRE1]

## 2\. èŽ·å–å›¾ç½‘ç»œ

å½“æˆ‘ä»¬æœ‰é•¿é€”è·¯çº¿æ—¶ï¼Œå»ºè®®ä½¿ç”¨*envelope*å‡½æ•°æ¥èŽ·å–å›¾ã€‚

ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„å‡½æ•°

[PRE2]

åº”ç”¨å¹¶å¯è§†åŒ–

[PRE3]

[PRE4]

![](../Images/86ce92fc96ba9311953cbbad921a39d9.png)

ä½œè€…æä¾›çš„å›¾åƒã€‚åŒ…å«èµ·ç‚¹å’Œç»ˆç‚¹çš„é“è·¯ç½‘ç»œå›¾

## 3\. å‘é“è·¯ç½‘ç»œæ·»åŠ æ—…è¡Œæ—¶é—´

æˆ‘ä»¬å°†ä½¿ç”¨å‡½æ•°`add_edge_speeds()`æ·»åŠ æ—…è¡Œæ—¶é—´ï¼Œè¯¥å‡½æ•°è¾“å…¥é€Ÿåº¦ï¼ˆä»¥km/hä¸ºå•ä½ï¼‰ã€‚æ’è¡¥å°†æŒ‰é«˜é€Ÿå…¬è·¯ç±»åž‹æ·»åŠ é“è·¯çš„å¹³å‡æœ€å¤§é€Ÿåº¦å€¼ã€‚ç„¶åŽï¼Œæˆ‘ä»¬ä½¿ç”¨å‡½æ•°`add_edge_travel_time()`è®¡ç®—*æ—…è¡Œæ—¶é—´*

æˆ‘ä»¬å°†ä¿ç•™ç›¸åŒçš„å˜é‡*graph*

[PRE5]

å¦‚æžœä½ æƒ³ä¿®æ”¹é«˜é€Ÿå…¬è·¯ç±»åˆ«ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªåŸºäºŽæœ¬åœ°é€Ÿåº¦å€¼çš„å­—å…¸

[PRE6]

çŽ°åœ¨ï¼Œé€šè¿‡èŽ·å–è¾¹ç¼˜ç±»åˆ«æ¥å¿«é€ŸæŸ¥çœ‹æŒ‰é«˜é€Ÿå…¬è·¯ç±»åž‹çš„æ—…è¡Œæ—¶é—´ã€‚

[PRE7]

![](../Images/e6d02f38607c6f55db56f06ffa1277c3.png)

ä½œè€…æä¾›çš„å›¾åƒã€‚é“è·¯ç½‘ç»œä¸­çš„é€Ÿåº¦å’Œæ—…è¡Œæ—¶é—´

## 4\. æŸ¥æ‰¾èµ·ç‚¹å’Œç»ˆç‚¹çš„æœ€è¿‘èŠ‚ç‚¹

ä½¿ç”¨èµ·ç‚¹å’Œç»ˆç‚¹åæ ‡èŽ·å–ç½‘ç»œä¸­æœ€æŽ¥è¿‘çš„èŠ‚ç‚¹ã€‚è¯¥å‡½æ•°åœ¨æ–°ç‰ˆæœ¬1.6ä¸­ä¸º`nearest_nodes()`

[PRE8]

ç„¶åŽï¼Œæˆ‘ä»¬åœ¨èŠ‚ç‚¹ä¹‹é—´åº”ç”¨æœ€çŸ­è·¯å¾„ç®—æ³•ã€‚

## 5\. è®¡ç®—ä½¿ç”¨æ—…è¡Œæ—¶é—´çš„æœ€çŸ­è·¯å¾„

æˆ‘ä»¬å°†ä½¿ç”¨ `shortest_path()` å‡½æ•°æ¥è®¡ç®—æˆ‘ä»¬çš„è·¯çº¿ã€‚æˆ‘ä»¬å°†åŒæ—¶ä½¿ç”¨è·ç¦»å’Œæ—¶é—´æ¥æ¯”è¾ƒè·¯çº¿åœ¨ `weight` å‚æ•°ä¸‹çš„ä¸åŒä¹‹å¤„ã€‚

[PRE9]

è¿™å°†è¿”å›žä¸€ç»„å±žäºŽè¯¥è·¯çº¿çš„èŠ‚ç‚¹ä»£ç ã€‚

![](../Images/93c60e89b3cfd82895cb495dd0e3f234.png)

ä½œè€…æä¾›çš„å›¾åƒã€‚è·¯çº¿çš„èŠ‚ç‚¹

## 6\. ä»ŽèŠ‚ç‚¹åˆ›å»ºè·¯çº¿ï¼ˆå•è¡Œä»£ç ï¼‰

osmnx å®žçŽ°äº†ä¸€ä¸ªå‡½æ•° `utils_graph.route_to_gdf()`ï¼Œå¯ä»¥åœ¨ä¸€è¡Œä¸­å°†èŠ‚ç‚¹è½¬æ¢ä¸º GeoDataFrameã€‚å¾ˆæ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€èŽ·å–æ„Ÿå…´è¶£çš„åˆ—ã€‚

[PRE10]

## 7\. å¿«é€Ÿæ¯”è¾ƒï¼ˆæ—¶é—´å’Œè·ç¦»ï¼‰

æˆ‘ä»¬å°†æ¯”è¾ƒä¸¤æ¡è·¯çº¿çš„æ—…è¡Œæ—¶é—´å’Œé•¿åº¦ã€‚

[PRE11]

æ‰“å°å€¼

[PRE12]

> *æœ€å¿«è·¯çº¿ï¼šæ—¶é—´ 5.42 å°æ—¶ï¼Œè·ç¦» 378.93 å…¬é‡Œ
> 
> æœ€çŸ­è·¯çº¿ï¼šæ—¶é—´ 5.6 å°æ—¶ï¼Œè·ç¦» 362.84 å…¬é‡Œ*

ç»“æžœæ˜¾ç¤ºæœ€å¿«çš„è·¯çº¿æ›´é•¿ã€‚å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œæ¶‰åŠé€Ÿåº¦æ—¶ï¼Œè·ç¦»å˜å¾—ç›¸å¯¹ã€‚

## 8\. ä¿å­˜æ–‡ä»¶å¹¶å¯è§†åŒ–

ä¿å­˜ç½‘ç»œå’Œè·¯çº¿

[PRE13]

åœ¨ QGIS ä¸­

![](../Images/1fe4f787061be2e19a0907d58ce2108d.png)

ä½œè€…æä¾›çš„å›¾åƒã€‚æœ€å¿«çš„è·¯çº¿ï¼ˆæ©™è‰²ï¼‰å’Œæœ€çŸ­çš„è·¯çº¿ï¼ˆé»„è‰²ï¼‰

åœ¨ Matplotlib ä¸­

[PRE14]

![](../Images/4c910cbf3a0c59ef031d78ac5e8bf926.png)

ä½œè€…æä¾›çš„å›¾åƒã€‚è¾ƒå¿«çš„è·¯çº¿ï¼ˆçº¢è‰²ï¼‰å’Œæœ€çŸ­çš„è·¯çº¿ï¼ˆé»„è‰²ï¼‰

# å·²çŸ¥æ”¹è¿›

ä»Ž osmnx ä½¿ç”¨çš„æ–°åŠŸèƒ½ `utils_graph.route_gdf()` åˆ›å»ºäº†ä¸€ä¸ªå¹²å‡€çš„è·¯çº¿ã€‚å®ƒä½¿ç”¨äº†é“è·¯æ®µï¼Œè€Œä¸ä»…ä»…æ˜¯èŠ‚ç‚¹ä¹‹é—´çš„è”æŽ¥ï¼Œæ–°è·¯å¾„è¦†ç›–äº† OSM é“è·¯ç½‘ç»œã€‚

![](../Images/fcbca57f332951bddbf520786144db7d.png)

ä½œè€…æä¾›çš„å›¾åƒã€‚è·¯çº¿è¦†ç›–äº†é“è·¯ç½‘ç»œã€‚

# **ç»“è®º**

æœ€çŸ­è·¯å¾„ç®—æ³•å¯ä»¥ä½¿ç”¨ OSMNX å‡½æ•° `add_edge_speeds()` å’Œ `add_edge_travel_times()` è®¡ç®—é“è·¯é€Ÿåº¦ã€‚è¿™ç§ä¸åŒçš„æ–¹æ³•è¡¨æ˜Žï¼Œå¦‚æžœåœ¨è·¯çº¿è®¡ç®—ä¸­å®žæ–½é€Ÿåº¦ï¼ˆæ—…è¡Œæ—¶é—´ï¼‰ï¼Œæœ€çŸ­è·¯å¾„æ˜¯ç›¸å¯¹çš„ã€‚æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œæœ€å¿«çš„è·¯çº¿æœ€ç»ˆæ¯”æœ€çŸ­è·¯çº¿æ›´é•¿ï¼Œä½†å®ƒä»¥æœ€çŸ­çš„æ—…è¡Œæ—¶é—´åˆ°è¾¾äº†ç›®çš„åœ°ã€‚

ç”Ÿæˆè¦†ç›–é“è·¯ç½‘ç»œçš„è·¯çº¿çš„æ”¹è¿›ä½¿å¾—åœ¨åŸŽå¸‚åŒºåŸŸçº§åˆ«çš„å¯è¾¾æ€§å’Œé‚»è¿‘æ€§ç ”ç©¶ä¸­ï¼Œè·ç¦»å’Œæ—…è¡Œæ—¶é—´çš„è®¡ç®—æ›´åŠ å‡†ç¡®ã€‚

# è‡´è°¢

å¤šäºäº†[Geoff Boeing](https://medium.com/u/c490d872f7a?source=post_page-----792aa92e03af--------------------------------)æä¾›çš„èµ„æ–™ï¼Œæˆ‘å¾—ä»¥æŽ¢ç´¢è¿™äº›åŠŸèƒ½å¹¶ç†è§£ OSMNX çš„åŠŸèƒ½ã€‚

å¦‚æžœä½ æƒ³å°±é—®é¢˜æˆ–å®šåˆ¶åˆ†æžè”ç³»æˆ‘ï¼š

> [*Bryan R. LinkedIn*](https://www.linkedin.com/in/bryanrvallejo/)
