- en: 7 Easy Steps To Switch From Pandas to Lightning Fast Polars And Never Return
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä»Pandasåˆ‡æ¢åˆ°é›·ç”µèˆ¬å¿«é€Ÿçš„Polarså¹¶æ°¸ä¸å›å¤´çš„7ä¸ªç®€å•æ­¥éª¤
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/7-easy-steps-to-switch-from-pandas-to-lightning-fast-polars-and-never-return-b14c66fc85b9](https://towardsdatascience.com/7-easy-steps-to-switch-from-pandas-to-lightning-fast-polars-and-never-return-b14c66fc85b9)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/7-easy-steps-to-switch-from-pandas-to-lightning-fast-polars-and-never-return-b14c66fc85b9](https://towardsdatascience.com/7-easy-steps-to-switch-from-pandas-to-lightning-fast-polars-and-never-return-b14c66fc85b9)
- en: A cheat sheet of the most common Pandas operations translated into Polars
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æœ€å¸¸è§çš„Pandasæ“ä½œçš„é€ŸæŸ¥è¡¨ç¿»è¯‘ä¸ºPolars
- en: '[](https://ibexorigin.medium.com/?source=post_page-----b14c66fc85b9--------------------------------)[![Bex
    T.](../Images/516496f32596e8ad56bf07f178a643c6.png)](https://ibexorigin.medium.com/?source=post_page-----b14c66fc85b9--------------------------------)[](https://towardsdatascience.com/?source=post_page-----b14c66fc85b9--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----b14c66fc85b9--------------------------------)
    [Bex T.](https://ibexorigin.medium.com/?source=post_page-----b14c66fc85b9--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://ibexorigin.medium.com/?source=post_page-----b14c66fc85b9--------------------------------)[![Bex
    T.](../Images/516496f32596e8ad56bf07f178a643c6.png)](https://ibexorigin.medium.com/?source=post_page-----b14c66fc85b9--------------------------------)[](https://towardsdatascience.com/?source=post_page-----b14c66fc85b9--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----b14c66fc85b9--------------------------------)
    [Bex T.](https://ibexorigin.medium.com/?source=post_page-----b14c66fc85b9--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----b14c66fc85b9--------------------------------)
    Â·9 min readÂ·Apr 3, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘å¸ƒäº[æ•°æ®ç§‘å­¦å‰æ²¿](https://towardsdatascience.com/?source=post_page-----b14c66fc85b9--------------------------------)
    Â·é˜…è¯»æ—¶é—´9åˆ†é’ŸÂ·2023å¹´4æœˆ3æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/c3c3d6087a84b3a47f4c643d748b0d43.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c3c3d6087a84b3a47f4c643d748b0d43.png)'
- en: Image by author via Midjourney
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…é€šè¿‡Midjourneyæä¾›
- en: Time for goodbyes!
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ˜¯æ—¶å€™è¯´å†è§äº†ï¼
- en: Pandas can do anything. Virtually anything. But (and this is an I-wish-a-million-times-it-was-any-other-way
    *but*) it lacks speed. Pandas just can't keep up with the pace at which the size
    and complexity of today's datasets are growing.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: Pandaså¯ä»¥åšä»»ä½•äº‹ã€‚å‡ ä¹ä»»ä½•äº‹ã€‚ä½†ï¼ˆè¿™çœŸçš„æ˜¯æˆ‘æ— æ•°æ¬¡å¸Œæœ›å®ƒå¯ä»¥æœ‰æ‰€ä¸åŒçš„*ä½†*ï¼‰å®ƒç¼ºä¹é€Ÿåº¦ã€‚Pandasæ ¹æœ¬æ— æ³•è·Ÿä¸Šä»Šå¤©æ•°æ®é›†è§„æ¨¡å’Œå¤æ‚åº¦å¢é•¿çš„é€Ÿåº¦ã€‚
- en: 'Pandas author, Wes McKinney, states that when he wrote Pandas, he had this
    rule of thumb in mind for his library:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: Pandasçš„ä½œè€…Wes McKinneyè¡¨ç¤ºï¼Œå½“ä»–ç¼–å†™Pandasæ—¶ï¼Œä»–æœ‰ä¸€ä¸ªé’ˆå¯¹å…¶åº“çš„ç»éªŒæ³•åˆ™ï¼š
- en: Have 5 to 10 times as much RAM as the size of your dataset.
  id: totrans-11
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æ‹¥æœ‰æ¯”æ•°æ®é›†å¤§å°å¤š5åˆ°10å€çš„RAMã€‚
- en: Maybe you could've snoozed past this rule when the Iris dataset was first introduced,
    but it is different today. You simply can't load a 100GB dataset (already common
    in modern times) when your RAM is *resolutely* stuck at 64 GBs.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: ä¹Ÿè®¸ä½ æ›¾ç»å¯¹å¼•å…¥Irisæ•°æ®é›†æ—¶çš„è¿™ä¸€è§„åˆ™è§†è€Œä¸è§ï¼Œä½†ä»Šå¤©æƒ…å†µæœ‰æ‰€ä¸åŒã€‚ä½ æ ¹æœ¬æ— æ³•åœ¨RAM*åšå†³*åœç•™åœ¨64GBçš„æƒ…å†µä¸‹åŠ è½½100GBçš„æ•°æ®é›†ï¼ˆè¿™åœ¨ç°ä»£ç¤¾ä¼šä¸­å·²ç»å¾ˆå¸¸è§ï¼‰ã€‚
- en: Sure, there are great alternatives like Dask. But Dask doesnâ€™t implement new
    functionality. It stretches existing Pandas syntax over multiple processes (threads)
    and ignores the underlying performance and memory issues.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œä¹Ÿæœ‰åƒDaskè¿™æ ·çš„ä¼˜ç§€æ›¿ä»£æ–¹æ¡ˆã€‚ä½†Daskå¹¶æ²¡æœ‰å®ç°æ–°çš„åŠŸèƒ½ã€‚å®ƒåªæ˜¯å°†ç°æœ‰çš„Pandasè¯­æ³•æ‰©å±•åˆ°å¤šä¸ªè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ä¸Šï¼Œå¿½ç•¥äº†åº•å±‚çš„æ€§èƒ½å’Œå†…å­˜é—®é¢˜ã€‚
- en: It treats Pandas as a **black box**. Forgive me for saying this, but it is almost
    like putting lipstick on a pig.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒå°†Pandasè§†ä¸º**é»‘ç®±**ã€‚è¯·åŸè°…æˆ‘è¿™æ ·è¯´ï¼Œä½†è¿™å‡ ä¹å°±åƒæ˜¯åœ¨çŒªèº«ä¸Šæ¶‚å£çº¢ä¸€æ ·ã€‚
- en: Polars, the focus of our article, was written in Rust from the ground up to
    fix all the shortcomings of Pandas. In my last article, we've seen how it is already
    faster than the upcoming Pandas 2.0 with PyArrow backend.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: Polarsï¼Œæœ¬æ–‡çš„é‡ç‚¹ï¼Œæ˜¯ä»å¤´å¼€å§‹ç”¨Rustç¼–å†™çš„ï¼Œæ—¨åœ¨ä¿®å¤Pandasçš„æ‰€æœ‰ä¸è¶³ã€‚åœ¨æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°å®ƒæ¯”å³å°†æ¨å‡ºçš„Pandas 2.0ï¼ˆé…å¤‡PyArrowåç«¯ï¼‰æ›´å¿«ã€‚
- en: While that article focused on speed advantages, this one focuses more on the
    syntax and functionality and shows you how to switch from Pandas to Polars in
    seven easy steps and, maybe, never switch back.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶é‚£ç¯‡æ–‡ç« é‡ç‚¹å…³æ³¨é€Ÿåº¦ä¼˜åŠ¿ï¼Œè¿™ç¯‡æ–‡ç« åˆ™æ›´å¤šåœ°å…³æ³¨è¯­æ³•å’ŒåŠŸèƒ½ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•åœ¨ä¸ƒä¸ªç®€å•æ­¥éª¤ä¸­ä»Pandasåˆ‡æ¢åˆ°Polarsï¼Œä¹Ÿè®¸æ°¸è¿œä¸ä¼šå†åˆ‡æ¢å›æ¥ã€‚
- en: 0\. Reading/writing data
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 0. è¯»å†™æ•°æ®
- en: Even though it is painfully slow, CSV is still one of the most popular file
    formats to store data. So, let's start with the `read_csv` function of Polars.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡é€Ÿåº¦æå…¶ç¼“æ…¢ï¼ŒCSVä»ç„¶æ˜¯å­˜å‚¨æ•°æ®çš„æœ€æµè¡Œæ–‡ä»¶æ ¼å¼ä¹‹ä¸€ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬ä»Polarsçš„`read_csv`å‡½æ•°å¼€å§‹å§ã€‚
- en: Apart from the apparent speed benefits, it only differs from its Pandas namesake
    in terms of the number of parameters (Pandas `read_csv` has 49\. Yep, I counted)
    and syntax.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: é™¤äº†æ˜æ˜¾çš„é€Ÿåº¦ä¼˜åŠ¿å¤–ï¼Œå®ƒåªåœ¨å‚æ•°æ•°é‡ï¼ˆPandas çš„ `read_csv` æœ‰ 49 ä¸ªã€‚æ˜¯çš„ï¼Œæˆ‘æ•°è¿‡ï¼‰å’Œè¯­æ³•ä¸Šä¸ Pandas æœ‰æ‰€ä¸åŒã€‚
- en: '![](../Images/44c230f7575349cfdbb31f100a9d7f71.png)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/44c230f7575349cfdbb31f100a9d7f71.png)'
- en: Image by author
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: The confusing parameter names shouldn't be a problem as most modern IDEs have
    tab-completion or pop-up documentation features (**Shift + Tab** on JupyterLab,
    thank you ğŸ™).
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: æ··æ·†çš„å‚æ•°åç§°ä¸åº”è¯¥æ˜¯é—®é¢˜ï¼Œå› ä¸ºå¤§å¤šæ•°ç°ä»£ IDE éƒ½å…·æœ‰è‡ªåŠ¨è¡¥å…¨æˆ–å¼¹å‡ºæ–‡æ¡£åŠŸèƒ½ï¼ˆJupyterLab ä¸Šçš„**Shift + Tab**ï¼Œè°¢è°¢ ğŸ™ï¼‰ã€‚
- en: If you were unaware, the `dtype` parameter prevents Pandas from setting automatic
    datatypes and allows the user to set custom ones like `string` type for `cut`
    or `datetime` for date-type columns.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ ä¸çŸ¥é“çš„è¯ï¼Œ`dtype` å‚æ•°é˜²æ­¢ Pandas è®¾ç½®è‡ªåŠ¨æ•°æ®ç±»å‹ï¼Œå¹¶å…è®¸ç”¨æˆ·è®¾ç½®è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œå¦‚ `cut` çš„ `string` ç±»å‹æˆ–æ—¥æœŸç±»å‹åˆ—çš„
    `datetime`ã€‚
- en: You can use the same behavior in Polars with `dtypes` (mind the â€˜sâ€™) though
    it doesnâ€™t allow the types to be set via strings. You have to provide either Python
    built-in types or through Polarsâ€™, like `pl.Boolean`, `pl.Categorical`, `pl.DateTime`,
    `pl.Int64 or pl.Null` for missing values. You can see the complete list by calling
    `dir(pl)`.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥åœ¨ Polars ä¸­ä½¿ç”¨ç›¸åŒçš„è¡Œä¸ºï¼Œä½¿ç”¨ `dtypes`ï¼ˆæ³¨æ„æ˜¯â€˜sâ€™ï¼‰ï¼Œè™½ç„¶å®ƒä¸å…è®¸é€šè¿‡å­—ç¬¦ä¸²è®¾ç½®ç±»å‹ã€‚ä½ å¿…é¡»æä¾› Python å†…å»ºç±»å‹æˆ–
    Polars çš„ç±»å‹ï¼Œä¾‹å¦‚ `pl.Boolean`ã€`pl.Categorical`ã€`pl.DateTime`ã€`pl.Int64` æˆ– `pl.Null`ï¼ˆè¡¨ç¤ºç¼ºå¤±å€¼ï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡è°ƒç”¨
    `dir(pl)` æŸ¥çœ‹å®Œæ•´åˆ—è¡¨ã€‚
- en: Reading and writing Parquet files, which are much faster and more memory-efficient
    than CSVs, are also supported in Polars through `read_parquet` and `write_parquet`
    functions.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: è¯»å–å’Œå†™å…¥ Parquet æ–‡ä»¶ï¼Œè¿™æ¯” CSV æ–‡ä»¶æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜ï¼ŒPolars é€šè¿‡ `read_parquet` å’Œ `write_parquet`
    å‡½æ•°ä¹Ÿæ”¯æŒè¿™äº›æ“ä½œã€‚
- en: '![](../Images/0b4af4f7dd3227f8a748cb952903ee03.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/0b4af4f7dd3227f8a748cb952903ee03.png)'
- en: Image by author
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: 1\. Creating Series and DataFrames
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1\. åˆ›å»º Series å’Œ DataFrames
- en: 'You don''t always read data from files. Like in Pandas, you can create DataFrames
    and Series from scratch, and the syntaxes are almost identical:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¹¶ä¸æ€»æ˜¯ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚åƒåœ¨ Pandas ä¸­ä¸€æ ·ï¼Œä½ å¯ä»¥ä»å¤´åˆ›å»º DataFrames å’Œ Seriesï¼Œè¯­æ³•å‡ ä¹ç›¸åŒï¼š
- en: '![](../Images/de99210af7adb4c1045ec58c3f988b82.png)![](../Images/ba3f26652bda07fab8aa5303850303a5.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/de99210af7adb4c1045ec58c3f988b82.png)![](../Images/ba3f26652bda07fab8aa5303850303a5.png)'
- en: Images by author
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾ç‰‡
- en: 'There are also many name and behavior-(almost)-identical methods of Polars
    DataFrames to Pandas. Say hello to:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: Polars DataFrames ä¹Ÿæœ‰è®¸å¤šä¸ Pandas å‡ ä¹ç›¸åŒåç§°å’Œè¡Œä¸ºçš„æ–¹æ³•ã€‚æ‰“ä¸ªæ‹›å‘¼å§ï¼š
- en: '`[apply](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.apply.html#polars.DataFrame.apply)`
    - Apply custom user-defined functions on each row of the DataFrame'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[apply](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.apply.html#polars.DataFrame.apply)`
    - å¯¹ DataFrame çš„æ¯ä¸€è¡Œåº”ç”¨è‡ªå®šä¹‰ç”¨æˆ·å®šä¹‰çš„å‡½æ•°'
- en: '`[corr](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.corr.html#polars.DataFrame.corr)`
    - correlation matrix'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[corr](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.corr.html#polars.DataFrame.corr)`
    - ç›¸å…³æ€§çŸ©é˜µ'
- en: '`[describe](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.describe.html#polars.DataFrame.describe)`
    - Summary statistics, 5-number summary'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[describe](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.describe.html#polars.DataFrame.describe)`
    - æ±‡æ€»ç»Ÿè®¡ï¼Œäº”æ•°æ¦‚æ‹¬'
- en: '`[drop](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.drop.html#polars.DataFrame.drop)`
    - Remove columns from a DataFrame'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[drop](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.drop.html#polars.DataFrame.drop)`
    - ä» DataFrame ä¸­åˆ é™¤åˆ—'
- en: '`[explode](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.explode.html#polars.DataFrame.explode)`
    - Unpacking the given column to long format (when cells contain multiple values
    like `[1, 2, 3]`)'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[explode](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.explode.html#polars.DataFrame.explode)`
    - å°†ç»™å®šåˆ—è§£åŒ…ä¸ºé•¿æ ¼å¼ï¼ˆå½“å•å…ƒæ ¼åŒ…å«å¤šä¸ªå€¼å¦‚ `[1, 2, 3]` æ—¶ï¼‰'
- en: '`[head](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.head.html#polars.DataFrame.head)`,
    `[tail](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.tail.html#polars.DataFrame.tail)`
    and `[sample(n)](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.sample.html#polars.DataFrame.sample)`
    - get different views of the DataFrame (top, bottom, random)'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[head](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.head.html#polars.DataFrame.head)`ã€`[tail](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.tail.html#polars.DataFrame.tail)`
    å’Œ `[sample(n)](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.sample.html#polars.DataFrame.sample)`
    - è·å– DataFrame çš„ä¸åŒè§†å›¾ï¼ˆé¡¶éƒ¨ã€åº•éƒ¨ã€éšæœºï¼‰'
- en: '`[iter_rows](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.iter_rows.html#polars.DataFrame.iter_rows)`
    - returns an iterator of DataFrame rows of Python-native values'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[iter_rows](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.iter_rows.html#polars.DataFrame.iter_rows)`
    - è¿”å›ä¸€ä¸ª DataFrame è¡Œçš„è¿­ä»£å™¨ï¼ŒåŒ…å« Python åŸç”Ÿå€¼'
- en: '`max`, `mean`, `median`, `sum`, `std` and the usual gang of common math and
    statistical functions.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`max`ã€`mean`ã€`median`ã€`sum`ã€`std` å’Œå¸¸è§çš„æ•°å­¦å’Œç»Ÿè®¡å‡½æ•°ã€‚'
- en: and so on. Check out [this page](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/index.html)
    of the docs for the full list of DataFrame methods in Polars.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: ç­‰ç­‰ã€‚æŸ¥çœ‹ [è¿™ä¸ªé¡µé¢](https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/index.html)
    ä»¥è·å– Polars ä¸­ DataFrame æ–¹æ³•çš„å®Œæ•´åˆ—è¡¨ã€‚
- en: 2\. Understanding expressions in Polars
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2\. ç†è§£ Polars ä¸­çš„è¡¨è¾¾å¼
- en: '![](../Images/bf7e75e893d0599c0f5ea425a523bec5.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/bf7e75e893d0599c0f5ea425a523bec5.png)'
- en: This is a query engine, human. â€” Midjourney
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢å¼•æ“ï¼Œäººç±»ã€‚ â€” Midjourney
- en: At the core of Polars is its **query engine**, which runs user-defined **expressions**.
    The query engine and expressions are two critical components for Polars' blazing
    fast and, as the Polars user guide puts it, "embarrassingly parallel" performance.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: Polars çš„æ ¸å¿ƒæ˜¯å…¶ **æŸ¥è¯¢å¼•æ“**ï¼Œå®ƒè¿è¡Œç”¨æˆ·å®šä¹‰çš„ **è¡¨è¾¾å¼**ã€‚æŸ¥è¯¢å¼•æ“å’Œè¡¨è¾¾å¼æ˜¯ Polars æå¿«æ€§èƒ½çš„ä¸¤ä¸ªå…³é”®ç»„ä»¶ï¼Œæ­£å¦‚ Polars
    ç”¨æˆ·æŒ‡å—æ‰€è¯´çš„ï¼Œâ€œä»¤äººå°´å°¬çš„å¹¶è¡Œâ€ã€‚
- en: You may be shocked at how closely Polars expressions resemble SQL while keeping
    firm ties to the familiar Pandas syntax.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯èƒ½ä¼šæƒŠè®¶äº Polars è¡¨è¾¾å¼ä¸ SQL çš„ç›¸ä¼¼ç¨‹åº¦ï¼ŒåŒæ—¶ä¿æŒä¸ç†Ÿæ‚‰çš„ Pandas è¯­æ³•çš„ç´§å¯†è”ç³»ã€‚
- en: 'Like SQL queries, you can write expressions for:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: åƒ SQL æŸ¥è¯¢ä¸€æ ·ï¼Œä½ å¯ä»¥ä¸ºä»¥ä¸‹å†…å®¹ç¼–å†™è¡¨è¾¾å¼ï¼š
- en: Creating new columns from existing ones
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä»ç°æœ‰åˆ—åˆ›å»ºæ–°åˆ—
- en: Getting views of the data after some transformation
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åœ¨æŸäº›è½¬æ¢åè·å–æ•°æ®è§†å›¾
- en: Summary statistics
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ±‡æ€»ç»Ÿè®¡
- en: Processing and cleaning data
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¤„ç†å’Œæ¸…ç†æ•°æ®
- en: Groupby statements
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Groupby è¯­å¥
- en: and so on.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: ç­‰ç­‰ã€‚
- en: '[PRE0]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: In the query above, the expression is `pl.col('column)' == 'some_value'`, which,
    as you guess, *filters* the DataFrame for rows where `column` is equal to `some_value`.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸Šé¢çš„æŸ¥è¯¢ä¸­ï¼Œè¡¨è¾¾å¼æ˜¯ `pl.col('column)' == 'some_value'`ï¼Œè¿™æ­£å¦‚ä½ æ‰€çŒœæµ‹çš„ï¼Œ*è¿‡æ»¤* DataFrame ä»¥è·å¾—
    `column` ç­‰äº `some_value` çš„è¡Œã€‚
- en: 'When you run the expression on its own, you won''t get a boolean Series as
    you would in Pandas:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ä½ å•ç‹¬è¿è¡Œè¿™ä¸ªè¡¨è¾¾å¼æ—¶ï¼Œä½ ä¸ä¼šå¾—åˆ°åƒåœ¨ Pandas ä¸­é‚£æ ·çš„å¸ƒå°” Seriesï¼š
- en: '[PRE1]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '[PRE2]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'That''s because expressions are only evaluated under *contexts*. There are
    three broad contexts in Polars:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯å› ä¸ºè¡¨è¾¾å¼åªåœ¨ *ä¸Šä¸‹æ–‡* ä¸­è¿›è¡Œè¯„ä¼°ã€‚Polars ä¸­æœ‰ä¸‰ç§å¹¿æ³›çš„ä¸Šä¸‹æ–‡ï¼š
- en: Selecting data â€” in the `select` context, expressions are applied over columns
    and must produce columns of the same length in the result. This behavior must
    be familiar from your SQL days. The `filter` function is also tied into this context.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é€‰æ‹©æ•°æ® â€” åœ¨ `select` ä¸Šä¸‹æ–‡ä¸­ï¼Œè¡¨è¾¾å¼åº”ç”¨äºåˆ—ï¼Œå¹¶ä¸”å¿…é¡»åœ¨ç»“æœä¸­äº§ç”Ÿç›¸åŒé•¿åº¦çš„åˆ—ã€‚è¿™ç§è¡Œä¸ºåº”å½“å¯¹ä½ æ¥è¯´å¾ˆç†Ÿæ‚‰ã€‚`filter` å‡½æ•°ä¹Ÿä¸è¿™ä¸ªä¸Šä¸‹æ–‡ç›¸å…³è”ã€‚
- en: Grouping data â€” in the `groupby` context, expressions work on groups, and the
    results may have any length as a group can have many members.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åˆ†ç»„æ•°æ® â€” åœ¨ `groupby` ä¸Šä¸‹æ–‡ä¸­ï¼Œè¡¨è¾¾å¼åœ¨ç»„ä¸Šå·¥ä½œï¼Œç»“æœå¯èƒ½å…·æœ‰ä»»ä½•é•¿åº¦ï¼Œå› ä¸ºä¸€ä¸ªç»„å¯ä»¥æœ‰å¤šä¸ªæˆå‘˜ã€‚
- en: Adding new columns â€” in this context, expressions are used to create new columns
    from scratch or existing ones.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ·»åŠ æ–°åˆ— â€” åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¡¨è¾¾å¼ç”¨äºä»å¤´å¼€å§‹æˆ–ä»ç°æœ‰åˆ—åˆ›å»ºæ–°åˆ—ã€‚
- en: Let's see each context in detail.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬è¯¦ç»†çœ‹çœ‹æ¯ä¸ªä¸Šä¸‹æ–‡ã€‚
- en: 3\. Selecting data
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 3\. é€‰æ‹©æ•°æ®
- en: The Pandas' brackets notation gives way to expressions in Polars for selecting
    columns.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: Pandas çš„æ‹¬å·è¡¨ç¤ºæ³•è®©ä½äº Polars ä¸­ç”¨äºé€‰æ‹©åˆ—çš„è¡¨è¾¾å¼ã€‚
- en: To select a single column, you can use their literal names inside `select` or
    use the recommended `pl.col` function to reference columns.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: è¦é€‰æ‹©å•ä¸ªåˆ—ï¼Œä½ å¯ä»¥åœ¨ `select` ä¸­ä½¿ç”¨å®ƒä»¬çš„å­—é¢åç§°ï¼Œæˆ–ä½¿ç”¨æ¨èçš„ `pl.col` å‡½æ•°æ¥å¼•ç”¨åˆ—ã€‚
- en: To select multiple, you can list the column names with commas inside `pl.col`
    or as a list of `pl.col` references inside `select`. We will see the differences
    between these syntaxes in a bit.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: è¦é€‰æ‹©å¤šä¸ªåˆ—ï¼Œä½ å¯ä»¥åœ¨ `pl.col` ä¸­åˆ—å‡ºåˆ—åï¼Œç”¨é€—å·åˆ†éš”ï¼Œæˆ–åœ¨ `select` ä¸­åˆ—å‡º `pl.col` å¼•ç”¨çš„åˆ—è¡¨ã€‚æˆ‘ä»¬ç¨åä¼šçœ‹åˆ°è¿™äº›è¯­æ³•ä¹‹é—´çš„åŒºåˆ«ã€‚
- en: '![](../Images/7cefcd08edf6e03e42c1404b1462778b.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7cefcd08edf6e03e42c1404b1462778b.png)'
- en: Image by author
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: 'Polars includes certain functionality not fully available in Pandas for selecting
    data. For example, you can exclude columns in your selection with `exclude`:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: Polars åŒ…å«ä¸€äº› Pandas ä¸­æœªå®Œå…¨æä¾›çš„é€‰æ‹©æ•°æ®åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ `exclude` æ’é™¤é€‰æ‹©ä¸­çš„åˆ—ï¼š
- en: '[PRE3]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![](../Images/a346371b15220539a09ec951f8343e33.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a346371b15220539a09ec951f8343e33.png)'
- en: Image by author
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: 'Or use regular expressions between `^` and `$` characters. Below, we are choosing
    all columns that start with the letter *c*:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ–è€…ä½¿ç”¨ `^` å’Œ `$` å­—ç¬¦ä¹‹é—´çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬é€‰æ‹©æ‰€æœ‰ä»¥å­—æ¯ *c* å¼€å¤´çš„åˆ—ï¼š
- en: '[PRE4]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](../Images/b0d429fbda06c39284086ac7415a465b.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b0d429fbda06c39284086ac7415a465b.png)'
- en: Image by author
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: 'You can also subset the DataFrame based on data type, which might remind you
    of `select_dtypes` of Pandas (on the left):'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ è¿˜å¯ä»¥æ ¹æ®æ•°æ®ç±»å‹å¯¹å­é›† DataFrameï¼Œè¿™å¯èƒ½è®©ä½ æƒ³èµ· Pandas ä¸­çš„ `select_dtypes`ï¼ˆå·¦ä¾§ï¼‰ï¼š
- en: '![](../Images/645c4fc4bd91ba1c12d477ccc2d67c7a.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/645c4fc4bd91ba1c12d477ccc2d67c7a.png)'
- en: Image by author
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: To select all numeric columns, we are using both `Int64` and `Float64` types
    inside `pl.col`.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: è¦é€‰æ‹©æ‰€æœ‰æ•°å€¼åˆ—ï¼Œæˆ‘ä»¬åœ¨ `pl.col` ä¸­ä½¿ç”¨äº† `Int64` å’Œ `Float64` ç±»å‹ã€‚
- en: 4\. Filtering data
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4\. æ•°æ®è¿‡æ»¤
- en: You can use the `filter` function to subset DataFrames with boolean indexing.
    For example, using `is_between` function on a column creates an expression to
    filter numeric columns within a range.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥ä½¿ç”¨ `filter` å‡½æ•°é€šè¿‡å¸ƒå°”ç´¢å¼•å¯¹ DataFrames è¿›è¡Œå­é›†åŒ–ã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ—ä¸Šä½¿ç”¨ `is_between` å‡½æ•°å¯ä»¥åˆ›å»ºä¸€ä¸ªè¡¨è¾¾å¼æ¥ç­›é€‰èŒƒå›´å†…çš„æ•°å€¼åˆ—ã€‚
- en: '![](../Images/d240bddd0cd570e39959051d86bb9221.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d240bddd0cd570e39959051d86bb9221.png)'
- en: Image by author
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: 'You can combine multiple *conditional expressions* with the familiar boolean
    operators `&` (AND), `|` (OR). In the example below, we are choosing rows where
    the `color` column is either ''E'' or ''J'' AND the `price` of diamonds are below
    500:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„å¸ƒå°”è¿ç®—ç¬¦ `&` (AND) å’Œ `|` (OR) ç»“åˆå¤šä¸ª *æ¡ä»¶è¡¨è¾¾å¼*ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹© `color` åˆ—ä¸º 'E'
    æˆ– 'J' å¹¶ä¸”é’»çŸ³çš„ `price` ä½äº 500 çš„è¡Œï¼š
- en: '![](../Images/934b5e017bea5f566317496ae9aab707.png)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/934b5e017bea5f566317496ae9aab707.png)'
- en: Image by author
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: Also, notice how we are using `is_in` in Polars on the right.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: å¦å¤–ï¼Œæ³¨æ„æˆ‘ä»¬åœ¨å³ä¾§å¦‚ä½•ä½¿ç”¨ Polars ä¸­çš„ `is_in`ã€‚
- en: 5\. Creating new columns
  id: totrans-90
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 5\. åˆ›å»ºæ–°åˆ—
- en: You can create new columns under the `with_columns` context. In the example
    below, `new_col` is defined using `pl.col('price') ** 2` and aliased to give the
    new column a name, just like `as` keyword in SQL.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å¯ä»¥åœ¨ `with_columns` ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºæ–°åˆ—ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ`new_col` ä½¿ç”¨ `pl.col('price') ** 2` å®šä¹‰ï¼Œå¹¶é€šè¿‡åˆ«åç»™æ–°åˆ—å‘½åï¼Œå°±åƒ
    SQL ä¸­çš„ `as` å…³é”®å­—ä¸€æ ·ã€‚
- en: '![](../Images/65624baaae02358a66024e15b3d2c7e2.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/65624baaae02358a66024e15b3d2c7e2.png)'
- en: Image by author
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: In the second example, we combine two columns (even though it doesn't make sense),
    demonstrating how integer and string columns can be combined with Polars. You
    can use any native Python or third-party function and operator on columns referenced
    with `pl.col`.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ç»“åˆäº†ä¸¤ä¸ªåˆ—ï¼ˆå°½ç®¡è¿™æ²¡æœ‰æ„ä¹‰ï¼‰ï¼Œæ¼”ç¤ºäº†å¦‚ä½•å°†æ•´æ•°å’Œå­—ç¬¦ä¸²åˆ—ä¸ Polars ç»“åˆä½¿ç”¨ã€‚ä½ å¯ä»¥åœ¨ä½¿ç”¨ `pl.col` å¼•ç”¨çš„åˆ—ä¸Šä½¿ç”¨ä»»ä½•æœ¬åœ°
    Python æˆ–ç¬¬ä¸‰æ–¹å‡½æ•°å’Œè¿ç®—ç¬¦ã€‚
- en: If you want the new column to be inserted into the DataFrame, you have to override
    the original `df` variable.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æƒ³å°†æ–°åˆ—æ’å…¥åˆ° DataFrame ä¸­ï¼Œä½ å¿…é¡»è¦†ç›–åŸå§‹çš„ `df` å˜é‡ã€‚
- en: While we are at it, string columns in Polars have the familiar `.str` interface
    for special text manipulation functions like `contains` or `lengths`. See the
    full list [here](https://pola-rs.github.io/polars/py-polars/html/reference/series/string.html).
    There are also `[.cat](https://pola-rs.github.io/polars/py-polars/html/reference/series/categories.html)`,
    `[.dt](https://pola-rs.github.io/polars/py-polars/html/reference/series/temporal.html)`
    and `[.arr](https://pola-rs.github.io/polars/py-polars/html/reference/series/list.html)`
    interfaces for specialized categorical, temporal and array functions.
  id: totrans-96
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: é¡ºä¾¿æä¸€ä¸‹ï¼ŒPolars ä¸­çš„å­—ç¬¦ä¸²åˆ—å…·æœ‰ç†Ÿæ‚‰çš„ `.str` æ¥å£ï¼Œç”¨äºç‰¹æ®Šçš„æ–‡æœ¬æ“ä½œå‡½æ•°ï¼Œå¦‚ `contains` æˆ– `lengths`ã€‚å®Œæ•´åˆ—è¡¨è¯·å‚è§
    [è¿™é‡Œ](https://pola-rs.github.io/polars/py-polars/html/reference/series/string.html)ã€‚è¿˜æœ‰ç”¨äºä¸“ä¸šåˆ†ç±»ã€æ—¶é—´å’Œæ•°ç»„å‡½æ•°çš„
    `[.cat](https://pola-rs.github.io/polars/py-polars/html/reference/series/categories.html)`ã€`[.dt](https://pola-rs.github.io/polars/py-polars/html/reference/series/temporal.html)`
    å’Œ `[.arr](https://pola-rs.github.io/polars/py-polars/html/reference/series/list.html)`
    æ¥å£ã€‚
- en: 6\. Groupby
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 6\. åˆ†ç»„æ“ä½œ
- en: 'I don''t think we can leave without mentioning `Groupby` operations:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä¸è®¤ä¸ºæˆ‘ä»¬å¯ä»¥ä¸æåŠ `Groupby` æ“ä½œï¼š
- en: '![](../Images/80a82e43f3e9b70d746b962f35409a1c.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/80a82e43f3e9b70d746b962f35409a1c.png)'
- en: Image by author
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: 'When using the `groupby` function in Polars, be sure to include `maintain_order=True`
    so that groups are not displayed randomly. Also, unlike Pandas, `groupby(col_name)`
    expression only works on the given column. To group all columns based on `col_name`,
    you have to use an aggregation context. Here is its syntax:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ Polars çš„ `groupby` å‡½æ•°æ—¶ï¼ŒåŠ¡å¿…åŒ…å« `maintain_order=True` ä»¥ç¡®ä¿ç»„ä¸ä¼šéšæœºæ˜¾ç¤ºã€‚æ­¤å¤–ï¼Œä¸ Pandas
    ä¸åŒï¼Œ`groupby(col_name)` è¡¨è¾¾å¼ä»…ä½œç”¨äºç»™å®šåˆ—ã€‚è¦æ ¹æ® `col_name` å¯¹æ‰€æœ‰åˆ—è¿›è¡Œåˆ†ç»„ï¼Œä½ å¿…é¡»ä½¿ç”¨èšåˆä¸Šä¸‹æ–‡ã€‚å…¶è¯­æ³•å¦‚ä¸‹ï¼š
- en: '[PRE5]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: After the `groupby` context, you chain the aggregation context and specify which
    columns the context affects. And chain any function on the result like `count`.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ `groupby` ä¸Šä¸‹æ–‡ä¹‹åï¼Œä½ å°†é“¾å¼èšåˆä¸Šä¸‹æ–‡ï¼Œå¹¶æŒ‡å®šä¸Šä¸‹æ–‡å½±å“å“ªäº›åˆ—ã€‚ç„¶ååœ¨ç»“æœä¸Šé“¾å¼è°ƒç”¨ä»»ä½•å‡½æ•°ï¼Œä¾‹å¦‚ `count`ã€‚
- en: 'Here is another example that groups by the diamond cut quality and returns
    the average numeric value for each group:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯å¦ä¸€ä¸ªç¤ºä¾‹ï¼ŒæŒ‰é’»çŸ³åˆ‡å‰²è´¨é‡åˆ†ç»„ï¼Œå¹¶è¿”å›æ¯ç»„çš„å¹³å‡æ•°å€¼ï¼š
- en: '![](../Images/8beaae709bd9675c7defc2f7a358d5ce.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/8beaae709bd9675c7defc2f7a358d5ce.png)'
- en: To learn more advanced groupby expressions in Polars, read [here](https://pola-rs.github.io/polars-book/user-guide/dsl/groupby.html).
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: è¦äº†è§£æ›´å¤šå…³äº Polars ä¸­é«˜çº§ `groupby` è¡¨è¾¾å¼çš„ä¿¡æ¯ï¼Œè¯·é˜…è¯»[è¿™é‡Œ](https://pola-rs.github.io/polars-book/user-guide/dsl/groupby.html)ã€‚
- en: 7\. The lazy API in Polars
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7\. Polarsä¸­çš„æ‡’æƒ° API
- en: One of the best features of Polars is its lazy API. In it, queries aren't run
    line-by-line but processed end-to-end by the query engine.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: Polars æœ€æ£’çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯å…¶æ‡’æƒ° APIã€‚åœ¨è¯¥ API ä¸­ï¼ŒæŸ¥è¯¢ä¸æ˜¯é€è¡Œæ‰§è¡Œçš„ï¼Œè€Œæ˜¯ç”±æŸ¥è¯¢å¼•æ“ç«¯åˆ°ç«¯å¤„ç†çš„ã€‚
- en: 'This is where query optimization and the *embarrassingly parallel* magic happen.
    You can turn any expression written in **eager mode** into the lazy mode with
    only two keywords:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯æŸ¥è¯¢ä¼˜åŒ–å’Œ*ä»¤äººå°´å°¬çš„å¹¶è¡Œ*é­”æ³•å‘ç”Ÿçš„åœ°æ–¹ã€‚ä½ å¯ä»¥ä»…ç”¨ä¸¤ä¸ªå…³é”®å­—å°†ä»»ä½•åœ¨**æ€¥åˆ‡æ¨¡å¼**ä¸‹ç¼–å†™çš„è¡¨è¾¾å¼è½¬æ¢ä¸ºæ‡’æƒ°æ¨¡å¼ï¼š
- en: '[PRE6]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'When you add the `lazy()` function before an expression is chained, the DataFrame
    becomes a `LazyFrame`. At this point, the query isn''t executed, and you can chain
    more expressions. Once ready, you call `collect()` to get the result:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ä½ åœ¨é“¾å¼è¡¨è¾¾å¼ä¹‹å‰æ·»åŠ  `lazy()` å‡½æ•°æ—¶ï¼ŒDataFrame ä¼šå˜æˆ `LazyFrame`ã€‚æ­¤æ—¶ï¼ŒæŸ¥è¯¢å°šæœªæ‰§è¡Œï¼Œä½ å¯ä»¥é“¾å¼æ·»åŠ æ›´å¤šè¡¨è¾¾å¼ã€‚ä¸€æ—¦å‡†å¤‡å¥½ï¼Œä½ å¯ä»¥è°ƒç”¨
    `collect()` æ¥è·å–ç»“æœï¼š
- en: '[PRE8]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](../Images/d9993faba6603676332e7d66b21a03ea.png)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d9993faba6603676332e7d66b21a03ea.png)'
- en: Image by author
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: While it is already fast in eager mode, the lazy mode adds exxxtra (yes, triple
    x) fuel to the query engine.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶å®ƒåœ¨æ€¥åˆ‡æ¨¡å¼ä¸‹å·²ç»å¾ˆå¿«ï¼Œä½†æ‡’æƒ°æ¨¡å¼ä¸ºæŸ¥è¯¢å¼•æ“æä¾›äº†é¢å¤–çš„ï¼ˆæ˜¯çš„ï¼Œä¸‰å€çš„ xï¼‰åŠ¨åŠ›ã€‚
- en: 'If you want to make the lazy API your default, you can use `scan_*` functions
    when reading data instead of `read_*`:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ å¸Œæœ›å°†æ‡’æƒ° API è®¾ä¸ºé»˜è®¤ï¼Œå¯ä»¥åœ¨è¯»å–æ•°æ®æ—¶ä½¿ç”¨ `scan_*` å‡½æ•°ï¼Œè€Œä¸æ˜¯ `read_*`ï¼š
- en: '[PRE9]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: This way, you avoid writing the `lazy()` function every time.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ ·ï¼Œä½ å°±èƒ½é¿å…æ¯æ¬¡éƒ½ç¼–å†™ `lazy()` å‡½æ•°ã€‚
- en: If you are dealing with datasets that are intimidating to your RAM, you can
    use streaming so that Polars processes your data in batches. This feature is enabled
    in the lazy API by setting `streaming=True` inside `collect`. Find out more about
    this excellent feature from [this page](https://pola-rs.github.io/polars-book/user-guide/lazy-api/streaming.html).
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ å¤„ç†çš„æ•°æ®é›†å¯¹ä½ çš„å†…å­˜æ„æˆå¨èƒï¼Œä½ å¯ä»¥ä½¿ç”¨æµå¼å¤„ç†ï¼Œä½¿ Polars åˆ†æ‰¹å¤„ç†æ•°æ®ã€‚è¿™ä¸ªåŠŸèƒ½å¯ä»¥é€šè¿‡åœ¨`collect`ä¸­è®¾ç½®`streaming=True`æ¥å¯ç”¨ã€‚æ›´å¤šå…³äºè¿™ä¸€ä¼˜ç§€åŠŸèƒ½çš„ä¿¡æ¯ï¼Œè¯·å‚è§[æ­¤é¡µé¢](https://pola-rs.github.io/polars-book/user-guide/lazy-api/streaming.html)ã€‚
- en: Conclusion
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: 'Polars might be new (I mean, it is fresh out of its crib), but it is already
    very popular. In the open-source standards, it is a rock star. Just look at its
    competitors:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: Polars å¯èƒ½å¾ˆæ–°ï¼ˆæˆ‘æ˜¯è¯´ï¼Œå®ƒåˆšåˆšå‡ºç”Ÿä¸ä¹…ï¼‰ï¼Œä½†å·²ç»éå¸¸å—æ¬¢è¿ã€‚åœ¨å¼€æºæ ‡å‡†ä¸­ï¼Œå®ƒæ˜¯æ˜æ˜Ÿã€‚åªéœ€çœ‹çœ‹å®ƒçš„ç«äº‰å¯¹æ‰‹ï¼š
- en: Pandas, released in 2011, has 37.5k GitHub stars.
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Pandasï¼Œå‘å¸ƒäº2011å¹´ï¼Œæ‹¥æœ‰37.5kä¸ªGitHubæ˜Ÿæ ‡ã€‚
- en: Apache Spark, released in 2014, has 26.8k stars.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Apache Sparkï¼Œå‘å¸ƒäº2014å¹´ï¼Œæ‹¥æœ‰26.8kä¸ªæ˜Ÿæ ‡ã€‚
- en: Vaex, released in 2017, has 7.9k GitHub stars.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Vaexï¼Œå‘å¸ƒäº2017å¹´ï¼Œæ‹¥æœ‰7.9kä¸ªGitHubæ˜Ÿæ ‡ã€‚
- en: Dask, released in 2015, has 10.9k stars.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Daskï¼Œå‘å¸ƒäº2015å¹´ï¼Œæ‹¥æœ‰10.9kä¸ªæ˜Ÿæ ‡ã€‚
- en: Apache Arrow, released in 2016, has 11.4k stars.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Apache Arrowï¼Œå‘å¸ƒäº2016å¹´ï¼Œæ‹¥æœ‰11.4kä¸ªæ˜Ÿæ ‡ã€‚
- en: In comparison, Polars was released in 2020 and already amassed 15.9k stars,
    halfway to its long-standing top competitors.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: ç›¸æ¯”ä¹‹ä¸‹ï¼ŒPolars äº2020å¹´å‘å¸ƒï¼Œå·²ç»ç§¯ç´¯äº†15.9kä¸ªæ˜Ÿæ ‡ï¼Œæ¥è¿‘å…¶é•¿æœŸé¡¶çº§ç«äº‰å¯¹æ‰‹çš„ä¸€åŠã€‚
- en: This should give you a rough picture of where the wind is blowing. Things might
    change when Pandas 2.0 is released, but I think Polars is already giving Pandas
    a run for its money.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™åº”è¯¥èƒ½ç»™ä½ ä¸€ä¸ªå¤§æ¦‚çš„äº†è§£é£å‘å¦‚ä½•å˜åŒ–ã€‚è™½ç„¶ Pandas 2.0 å‘å¸ƒåæƒ…å†µå¯èƒ½ä¼šæœ‰æ‰€å˜åŒ–ï¼Œä½†æˆ‘è®¤ä¸º Polars å·²ç»åœ¨ç»™ Pandas å¸¦æ¥ä¸å°çš„ç«äº‰ã€‚
- en: Loved this article and, letâ€™s face it, its bizarre writing style? Imagine having
    access to dozens more just like it, all written by a brilliant, charming, witty
    author (thatâ€™s me, by the way :).
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: å–œæ¬¢è¿™ç¯‡æ–‡ç« å—ï¼Ÿè¯´å®è¯ï¼Œå®ƒé‚£å¥‡ç‰¹çš„å†™ä½œé£æ ¼å‘¢ï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ èƒ½è®¿é—®åˆ°æ›´å¤šç±»ä¼¼çš„æ–‡ç« ï¼Œå…¨éƒ¨ç”±ä¸€ä½æ‰åæ¨ªæº¢ã€è¿·äººè€Œé£è¶£çš„ä½œè€…ï¼ˆé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå°±æ˜¯æˆ‘ :ï¼‰ã€‚
- en: For only 4.99$ membership, you will get access to not just my stories, but a
    treasure trove of knowledge from the best and brightest minds on Medium. And if
    you use [my referral link](https://ibexorigin.medium.com/membership), you will
    earn my supernova of gratitude and a virtual high-five for supporting my work.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: åªéœ€4.99$çš„ä¼šå‘˜è´¹ç”¨ï¼Œä½ å°†ä¸ä»…èƒ½è®¿é—®æˆ‘çš„æ•…äº‹ï¼Œè¿˜èƒ½è·å–Mediumä¸Šæœ€ä¼˜ç§€çš„æ€æƒ³è€…ä»¬çš„å®è´µçŸ¥è¯†ã€‚å¦‚æœä½ ä½¿ç”¨[æˆ‘çš„æ¨èé“¾æ¥](https://ibexorigin.medium.com/membership)ï¼Œä½ å°†è·å¾—æˆ‘è¶…çº§novaçš„æ„Ÿæ¿€ä¹‹æƒ…å’Œä¸€è®°è™šæ‹Ÿçš„å‡»æŒï¼Œä»¥æ”¯æŒæˆ‘çš„å·¥ä½œã€‚
- en: '[](https://ibexorigin.medium.com/membership?source=post_page-----b14c66fc85b9--------------------------------)
    [## Join Medium with my referral link â€” Bex T.'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://ibexorigin.medium.com/membership?source=post_page-----b14c66fc85b9--------------------------------)
    [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥Medium â€” Bex T.'
- en: Get exclusive access to all my âš¡premiumâš¡ content and all over Medium without
    limits. Support my work by buying me aâ€¦
  id: totrans-133
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: è·å¾—å¯¹æˆ‘æ‰€æœ‰âš¡ä¼˜è´¨âš¡å†…å®¹çš„ç‹¬å®¶è®¿é—®æƒé™ï¼Œæ— é™åˆ¶åœ°æµè§ˆMediumã€‚é€šè¿‡è´­ä¹°æˆ‘æä¾›çš„æœåŠ¡æ¥æ”¯æŒæˆ‘çš„å·¥ä½œâ€¦â€¦
- en: ibexorigin.medium.com](https://ibexorigin.medium.com/membership?source=post_page-----b14c66fc85b9--------------------------------)
    ![](../Images/a01b5e4fb641db5f35b8172a4388e821.png)
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: ibexorigin.medium.com](https://ibexorigin.medium.com/membership?source=post_page-----b14c66fc85b9--------------------------------)
    ![](../Images/a01b5e4fb641db5f35b8172a4388e821.png)
