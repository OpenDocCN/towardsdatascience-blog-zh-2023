- en: The World of SQL Query Optimization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SQL æŸ¥è¯¢ä¼˜åŒ–çš„ä¸–ç•Œ
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/the-world-of-sql-query-optimization-e1d5b5fef20d](https://towardsdatascience.com/the-world-of-sql-query-optimization-e1d5b5fef20d)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/the-world-of-sql-query-optimization-e1d5b5fef20d](https://towardsdatascience.com/the-world-of-sql-query-optimization-e1d5b5fef20d)
- en: '![](../Images/83a4adc3c26c7145297a344045db80f7.png)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/83a4adc3c26c7145297a344045db80f7.png)'
- en: Photo by [Jake Blucker](https://unsplash.com/@jakeblucker?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: ç…§ç‰‡ç”±[Jake Blucker](https://unsplash.com/@jakeblucker?utm_source=medium&utm_medium=referral)æ‹æ‘„ï¼Œå‘å¸ƒåœ¨[Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)ä¸Šã€‚
- en: DATA ENGINEERING
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ•°æ®å·¥ç¨‹
- en: A peek into the different query optimizers and how they work
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä¸€çª¥ä¸åŒçš„æŸ¥è¯¢ä¼˜åŒ–å™¨åŠå…¶å·¥ä½œåŸç†
- en: '[](https://kovidrathee.medium.com/?source=post_page-----e1d5b5fef20d--------------------------------)[![Kovid
    Rathee](../Images/2bad5143febe95d28d0cf19698c5c976.png)](https://kovidrathee.medium.com/?source=post_page-----e1d5b5fef20d--------------------------------)[](https://towardsdatascience.com/?source=post_page-----e1d5b5fef20d--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----e1d5b5fef20d--------------------------------)
    [Kovid Rathee](https://kovidrathee.medium.com/?source=post_page-----e1d5b5fef20d--------------------------------)'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://kovidrathee.medium.com/?source=post_page-----e1d5b5fef20d--------------------------------)[![Kovid
    Rathee](../Images/2bad5143febe95d28d0cf19698c5c976.png)](https://kovidrathee.medium.com/?source=post_page-----e1d5b5fef20d--------------------------------)[](https://towardsdatascience.com/?source=post_page-----e1d5b5fef20d--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----e1d5b5fef20d--------------------------------)
    [Kovid Rathee](https://kovidrathee.medium.com/?source=post_page-----e1d5b5fef20d--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----e1d5b5fef20d--------------------------------)
    Â·6 min readÂ·Mar 27, 2023
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘å¸ƒäº[Towards Data Science](https://towardsdatascience.com/?source=post_page-----e1d5b5fef20d--------------------------------)
    Â·6åˆ†é’Ÿé˜…è¯»Â·2023å¹´3æœˆ27æ—¥
- en: --
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: SQL is a simple language with very few rules, which is what makes it so popular.
    It is also enriched with a great number of keywords and features that allow you
    to interact with your data in all kinds of ways. With this flexibility comes a
    lot of variance in query writing styles and choices.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: SQL æ˜¯ä¸€ç§ç®€å•çš„è¯­è¨€ï¼Œè§„åˆ™éå¸¸å°‘ï¼Œè¿™ä½¿å¾—å®ƒå¦‚æ­¤å—æ¬¢è¿ã€‚å®ƒè¿˜å…·æœ‰å¤§é‡çš„å…³é”®å­—å’ŒåŠŸèƒ½ï¼Œè®©ä½ ä»¥å„ç§æ–¹å¼ä¸æ•°æ®è¿›è¡Œäº¤äº’ã€‚éšç€è¿™ç§çµæ´»æ€§ï¼ŒæŸ¥è¯¢ç¼–å†™é£æ ¼å’Œé€‰æ‹©ä¹Ÿä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚
- en: Once you issue a query to your database, it has to parse your query to understand
    its flow, but thatâ€™s not where the work of the database ends. The database engine
    also has a component to look at your query and, in a sense, rewrite it without
    changing what it does at all to allow for better performance and response times.
    This mighty component, unsurprisingly, is called the **query optimizer**.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦ä½ å‘æ•°æ®åº“å‘å‡ºæŸ¥è¯¢ï¼Œå®ƒå¿…é¡»è§£æä½ çš„æŸ¥è¯¢ä»¥ç†è§£å…¶æµç¨‹ï¼Œä½†è¿™å¹¶ä¸æ˜¯æ•°æ®åº“å·¥ä½œçš„ç»“æŸã€‚æ•°æ®åº“å¼•æ“è¿˜æœ‰ä¸€ä¸ªç»„ä»¶ç”¨äºæŸ¥çœ‹ä½ çš„æŸ¥è¯¢ï¼Œå¹¶åœ¨ä¸æ”¹å˜å…¶åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œé‡å†™ï¼Œä»¥å®ç°æ›´å¥½çš„æ€§èƒ½å’Œå“åº”æ—¶é—´ã€‚è¿™ä¸ªå¼ºå¤§çš„ç»„ä»¶ï¼Œæ¯«ä¸æ„å¤–ï¼Œè¢«ç§°ä¸º**æŸ¥è¯¢ä¼˜åŒ–å™¨**ã€‚
- en: 'But how would the optimizer rewrite the query? What source of extra information
    does it have to act on the query? These are the questions that when answered,
    classify different types of query optimizers. Broadly speaking, there are **four
    kinds of query optimization techniques**, as mentioned below:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†æ˜¯ä¼˜åŒ–å™¨å¦‚ä½•é‡å†™æŸ¥è¯¢å‘¢ï¼Ÿå®ƒæœ‰å“ªäº›é¢å¤–çš„ä¿¡æ¯æ¥æºæ¥å¤„ç†æŸ¥è¯¢ï¼Ÿè¿™äº›é—®é¢˜çš„ç­”æ¡ˆå¯ä»¥å°†ä¸åŒç±»å‹çš„æŸ¥è¯¢ä¼˜åŒ–å™¨è¿›è¡Œåˆ†ç±»ã€‚å¹¿ä¹‰ä¸Šè¯´ï¼Œä»¥ä¸‹æåˆ°çš„æœ‰**å››ç§æŸ¥è¯¢ä¼˜åŒ–æŠ€æœ¯**ï¼š
- en: '**Heuristics-based optimization** acts based on pre-defined rules in the database,
    for instance, giving priority to a clustered index.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**åŸºäºå¯å‘å¼çš„ä¼˜åŒ–**æ ¹æ®æ•°æ®åº“ä¸­é¢„å®šä¹‰çš„è§„åˆ™è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚ï¼Œä¼˜å…ˆä½¿ç”¨èšé›†ç´¢å¼•ã€‚'
- en: '**Cost-based optimization** works based on query cost estimation, including
    estimating the cost of resources the query might use.'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**åŸºäºæˆæœ¬çš„ä¼˜åŒ–**æ ¹æ®æŸ¥è¯¢æˆæœ¬ä¼°ç®—æ¥å·¥ä½œï¼ŒåŒ…æ‹¬ä¼°ç®—æŸ¥è¯¢å¯èƒ½ä½¿ç”¨çš„èµ„æºæˆæœ¬ã€‚'
- en: '**Hybrid optimization** uses both heuristics-based and cost-based optimization
    techniques. *Most relational databases use this technique.*'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**æ··åˆä¼˜åŒ–**ç»“åˆäº†åŸºäºå¯å‘å¼çš„æ–¹æ³•å’ŒåŸºäºæˆæœ¬çš„æ–¹æ³•ã€‚*å¤§å¤šæ•°å…³ç³»æ•°æ®åº“ä½¿ç”¨è¿™ç§æŠ€æœ¯*ã€‚'
- en: '**Adaptive optimization** is distinct from all the above techniques in that
    it changes the query execution plan while the query is executing. This is quite
    useful in distributed systems.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**è‡ªé€‚åº”ä¼˜åŒ–**ä¸ä¸Šè¿°æ‰€æœ‰æŠ€æœ¯ä¸åŒï¼Œå®ƒåœ¨æŸ¥è¯¢æ‰§è¡Œè¿‡ç¨‹ä¸­æ”¹å˜æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ã€‚è¿™åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éå¸¸æœ‰ç”¨ã€‚'
- en: In the second year of my computer sciences degree, back in 2008, when I was
    studying database management systems, although I did have an affinity towards
    databases, I didnâ€™t actually realize till much later how much query optimization
    and database performance tuning techniques will come in handy during my work.
    I can attest to the fact that understanding database-specific query optimizers
    has been the most fun and most useful skill for [writing good, efficient SQL queries](/how-to-avoid-writing-sloppy-sql-43647a160025).
    It makes a world of difference.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨2008å¹´è®¡ç®—æœºç§‘å­¦å­¦ä½çš„ç¬¬äºŒå¹´ï¼Œå½“æˆ‘åœ¨å­¦ä¹ æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ—¶ï¼Œå°½ç®¡æˆ‘å¯¹æ•°æ®åº“æœ‰ä¸€å®šçš„å…´è¶£ï¼Œä½†ç›´åˆ°åæ¥æˆ‘æ‰çœŸæ­£æ„è¯†åˆ°æŸ¥è¯¢ä¼˜åŒ–å’Œæ•°æ®åº“æ€§èƒ½è°ƒä¼˜æŠ€æœ¯åœ¨æˆ‘çš„å·¥ä½œä¸­å°†ä¼šæœ‰å¤šä¹ˆé‡è¦ã€‚æˆ‘å¯ä»¥è¯æ˜ï¼Œç†è§£ç‰¹å®šæ•°æ®åº“çš„æŸ¥è¯¢ä¼˜åŒ–å™¨æ˜¯[ç¼–å†™é«˜æ•ˆSQLæŸ¥è¯¢](/how-to-avoid-writing-sloppy-sql-43647a160025)çš„æœ€æœ‰è¶£å’Œæœ€æœ‰ç”¨çš„æŠ€èƒ½ã€‚è¿™ä¼šå¸¦æ¥å·¨å¤§çš„å·®åˆ«ã€‚
- en: Letâ€™s look at the different types of query optimizers in a bit more detail.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°äº†è§£ä¸€ä¸‹ä¸åŒç±»å‹çš„æŸ¥è¯¢ä¼˜åŒ–å™¨ã€‚
- en: Heuristics-based optimization
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åŸºäºå¯å‘å¼çš„ä¼˜åŒ–
- en: Heuristics-based query optimization, also called rule-based query optimization,
    uses a set of *rules of thumb* and *core principles* to determine the most efficient
    way to execute a query by rearranging the relational algebra operations that make
    a query tree (an internal representation of the query).
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: åŸºäºå¯å‘å¼çš„æŸ¥è¯¢ä¼˜åŒ–ï¼Œä¹Ÿç§°ä¸ºåŸºäºè§„åˆ™çš„æŸ¥è¯¢ä¼˜åŒ–ï¼Œä½¿ç”¨ä¸€ç»„*ç»éªŒæ³•åˆ™*å’Œ*æ ¸å¿ƒåŸåˆ™*æ¥ç¡®å®šæ‰§è¡ŒæŸ¥è¯¢çš„æœ€æœ‰æ•ˆæ–¹å¼ï¼Œé€šè¿‡é‡æ–°æ’åˆ—æ„æˆæŸ¥è¯¢æ ‘çš„å…³ç³»ä»£æ•°æ“ä½œï¼ˆæŸ¥è¯¢çš„å†…éƒ¨è¡¨ç¤ºï¼‰ã€‚
- en: 'Iâ€™m sure youâ€™ve heard of the popular discussion among bugging SQL engineers:
    *does the order in which I join tables matter?* Well, the short answer to this
    question is both yes and no. Yes, because the order matters, but no, because the
    optimizer fixes the query after parsing it.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ç›¸ä¿¡ä½ ä¸€å®šå¬è¯´è¿‡åœ¨SQLå·¥ç¨‹å¸ˆä¸­æµè¡Œçš„è®¨è®ºï¼š*æˆ‘è¿æ¥è¡¨çš„é¡ºåºæ˜¯å¦é‡è¦ï¼Ÿ* è¿™ä¸ªé—®é¢˜çš„ç®€çŸ­å›ç­”æ˜¯æ—¢é‡è¦åˆä¸é‡è¦ã€‚é‡è¦ï¼Œå› ä¸ºé¡ºåºç¡®å®å¾ˆé‡è¦ï¼Œä½†ä¸é‡è¦ï¼Œå› ä¸ºä¼˜åŒ–å™¨åœ¨è§£æåä¼šä¿®æ­£æŸ¥è¯¢ã€‚
- en: Letâ€™s take the most popular example of optimizing queries â€” using the `WHERE`
    clause. Now, itâ€™s a *rule of thumb* that you should make the *selection* as early
    as possible. This is because if you filter out the data that you donâ€™t need early
    in the process, youâ€™ll also limit the data that you need to join, order, and group.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ä»¥ä¼˜åŒ–æŸ¥è¯¢çš„æœ€å¸¸è§ç¤ºä¾‹ä¸ºä¾‹â€”â€”ä½¿ç”¨`WHERE`å­å¥ã€‚ç°åœ¨ï¼Œ*ç»éªŒæ³•åˆ™*æ˜¯ä½ åº”è¯¥å°½æ—©è¿›è¡Œ*é€‰æ‹©*ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœä½ åœ¨å¤„ç†è¿‡ç¨‹ä¸­å°½æ—©è¿‡æ»¤æ‰ä¸éœ€è¦çš„æ•°æ®ï¼Œä½ ä¹Ÿä¼šé™åˆ¶éœ€è¦è¿æ¥ã€æ’åºå’Œåˆ†ç»„çš„æ•°æ®é‡ã€‚
- en: Several other rules around certain types of joins, CTEs, sorting, etc., can
    be called heuristics, hence the name heuristics-based optimization. Optimizing
    a SQL query is not just about relational algebra and heuristics. It matters which
    database you are using and what flavor of SQL you are using, among other things.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€äº›å…³äºç‰¹å®šç±»å‹çš„è¿æ¥ã€CTEã€æ’åºç­‰çš„è§„åˆ™å¯ä»¥è¢«ç§°ä¸ºå¯å‘å¼ï¼Œå› æ­¤å¾—åå¯å‘å¼ä¼˜åŒ–ã€‚ä¼˜åŒ–SQLæŸ¥è¯¢ä¸ä»…ä»…æ¶‰åŠå…³ç³»ä»£æ•°å’Œå¯å‘å¼ï¼Œè¿˜è¦è€ƒè™‘ä½ ä½¿ç”¨çš„æ˜¯å“ªä¸ªæ•°æ®åº“ä»¥åŠä½ ä½¿ç”¨çš„æ˜¯å“ªç§SQLæ–¹è¨€ç­‰å› ç´ ã€‚
- en: Note that this method of query optimization is purely theoretical and doesnâ€™t
    consider a lot of the real-world information from database statistics, which is
    why you wonâ€™t see databases using this type of optimization alone to optimize
    your SQL queries. Theyâ€™ll also look into cost-based query optimization, which
    weâ€™ll discuss in the next section.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œè¿™ç§æŸ¥è¯¢ä¼˜åŒ–æ–¹æ³•çº¯ç²¹æ˜¯ç†è®ºä¸Šçš„ï¼Œå¹¶æœªè€ƒè™‘æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯ä¸­çš„å¤§é‡å®é™…ä¸–ç•Œä¿¡æ¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½ ä¸ä¼šçœ‹åˆ°æ•°æ®åº“ä»…ä½¿ç”¨è¿™ç§ä¼˜åŒ–æ–¹æ³•æ¥ä¼˜åŒ–ä½ çš„SQLæŸ¥è¯¢ã€‚å®ƒä»¬è¿˜ä¼šè€ƒè™‘åŸºäºæˆæœ¬çš„æŸ¥è¯¢ä¼˜åŒ–ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è®¨è®ºè¿™ä¸€ç‚¹ã€‚
- en: Cost-based optimization
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åŸºäºæˆæœ¬çš„ä¼˜åŒ–
- en: This method takes a more practical approach to optimization. It takes into consideration
    the constraints of memory, CPU, network, etc., along with the data statistics
    that the database maintains, such as row count, average row size, table size,
    and so on.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç§æ–¹æ³•é‡‡å–äº†æ›´å®é™…çš„ä¼˜åŒ–æ–¹æ³•ã€‚å®ƒè€ƒè™‘äº†å†…å­˜ã€CPUã€ç½‘ç»œç­‰çš„çº¦æŸæ¡ä»¶ï¼Œä»¥åŠæ•°æ®åº“ç»´æŠ¤çš„æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œå¦‚è¡Œæ•°ã€å¹³å‡è¡Œå¤§å°ã€è¡¨å¤§å°ç­‰ã€‚
- en: While heuristics-based optimization reorders the query tree based on rules of
    thumb, cost-based optimization involves evaluating several query execution plans
    and choosing the best out of them based on the estimated cost of running the query.
    This cost includes everything from the estimated time, the number of rows scanned,
    the number of indexes used, and more.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶åŸºäºå¯å‘å¼çš„ä¼˜åŒ–ä¼šæ ¹æ®ç»éªŒæ³•åˆ™é‡æ–°æ’åºæŸ¥è¯¢æ ‘ï¼Œä½†åŸºäºæˆæœ¬çš„ä¼˜åŒ–åˆ™æ¶‰åŠè¯„ä¼°å‡ ä¸ªæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œå¹¶æ ¹æ®æ‰§è¡ŒæŸ¥è¯¢çš„ä¼°ç®—æˆæœ¬é€‰æ‹©å…¶ä¸­æœ€ä¼˜çš„ä¸€ä¸ªã€‚è¿™ä¸ªæˆæœ¬åŒ…æ‹¬ä¼°ç®—çš„æ—¶é—´ã€æ‰«æçš„è¡Œæ•°ã€ä½¿ç”¨çš„ç´¢å¼•æ•°é‡ç­‰ã€‚
- en: As cost-based optimization evaluates many query execution plans, it might take
    more time to come up with the right execution plan. The optimizer might also be
    slowed down because of the overhead of collecting and analyzing statistics from
    the database. Still, it usually turns out to be more efficient than heuristics-based
    optimization.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºåŸºäºæˆæœ¬çš„ä¼˜åŒ–éœ€è¦è¯„ä¼°å¤šä¸ªæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œå› æ­¤å¯èƒ½éœ€è¦æ›´å¤šæ—¶é—´æ¥åˆ¶å®šæ­£ç¡®çš„æ‰§è¡Œè®¡åˆ’ã€‚ä¼˜åŒ–å™¨ä¹Ÿå¯èƒ½å› ä¸ºæ”¶é›†å’Œåˆ†ææ•°æ®åº“ç»Ÿè®¡æ•°æ®çš„å¼€é”€è€Œå˜å¾—ç¼“æ…¢ã€‚ç„¶è€Œï¼Œå®ƒé€šå¸¸æ¯”åŸºäºå¯å‘å¼çš„ä¼˜åŒ–æ›´æœ‰æ•ˆã€‚
- en: Most databases donâ€™t use a cost-based optimizer alone. They usually go for a
    hybrid approach, with most of the optimization based on cost, while the rest is
    based on heuristics, user hints, etc. Jiaqi Yan of Snowflake talks about this
    in [one of the CMU DB Quarantine Tech Talks sessions](https://youtu.be/CPWn1SZUZqE?t=1051).
    In the next section, with the help of a few examples, letâ€™s see how hybrid query
    optimization works.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: å¤§å¤šæ•°æ•°æ®åº“ä¸ä»…ä»…ä½¿ç”¨åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨ã€‚å®ƒä»¬é€šå¸¸é‡‡ç”¨æ··åˆæ–¹æ³•ï¼Œå¤§éƒ¨åˆ†ä¼˜åŒ–åŸºäºæˆæœ¬ï¼Œå…¶ä½™éƒ¨åˆ†åŸºäºå¯å‘å¼æ–¹æ³•ã€ç”¨æˆ·æç¤ºç­‰ã€‚Snowflakeçš„Jiaqi Yanåœ¨[CMU
    DBéš”ç¦»æŠ€æœ¯è®²åº§çš„ä¸€åœºä¼šè®®ä¸­](https://youtu.be/CPWn1SZUZqE?t=1051)è°ˆåˆ°äº†è¿™ä¸€ç‚¹ã€‚åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€äº›ç¤ºä¾‹ï¼Œçœ‹çœ‹æ··åˆæŸ¥è¯¢ä¼˜åŒ–æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚
- en: '*A hybrid query optimization approach just takes both heuristics-based optimization
    and cost-based optimization into consideration and comes up with a balanced query
    optimization plan. We wonâ€™t go into the details of how hybrid query optimization
    works because it wildly differs from one database to another.*'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '*æ··åˆæŸ¥è¯¢ä¼˜åŒ–æ–¹æ³•è€ƒè™‘äº†åŸºäºå¯å‘å¼çš„ä¼˜åŒ–å’ŒåŸºäºæˆæœ¬çš„ä¼˜åŒ–ï¼Œå¹¶åˆ¶å®šäº†ä¸€ä¸ªå¹³è¡¡çš„æŸ¥è¯¢ä¼˜åŒ–è®¡åˆ’ã€‚æˆ‘ä»¬ä¸ä¼šæ·±å…¥æ¢è®¨æ··åˆæŸ¥è¯¢ä¼˜åŒ–çš„å…·ä½“ç»†èŠ‚ï¼Œå› ä¸ºä¸åŒæ•°æ®åº“ä¹‹é—´çš„å®ç°å·®å¼‚å¾ˆå¤§ã€‚*'
- en: Adaptive query optimization
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è‡ªé€‚åº”æŸ¥è¯¢ä¼˜åŒ–
- en: Till now, we discussed query optimization techniques that only looked at and
    improved the query execution plan before the start of query execution. Adaptive
    query optimization is the type of query optimization that tries to improve the
    plan as the query executes. The use case for this might be obvious to you â€” distributed
    data processing systems and query engines that deal with large amounts of data
    and a high level of parallelism.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®¨è®ºäº†æŸ¥è¯¢ä¼˜åŒ–æŠ€æœ¯ï¼Œè¿™äº›æŠ€æœ¯ä»…åœ¨æŸ¥è¯¢æ‰§è¡Œå¼€å§‹ä¹‹å‰æŸ¥çœ‹å¹¶æ”¹è¿›æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ã€‚è‡ªé€‚åº”æŸ¥è¯¢ä¼˜åŒ–æ˜¯ä¸€ç§åœ¨æŸ¥è¯¢æ‰§è¡Œè¿‡ç¨‹ä¸­å°è¯•æ”¹è¿›è®¡åˆ’çš„æŸ¥è¯¢ä¼˜åŒ–ç±»å‹ã€‚è¿™ç§ç”¨ä¾‹å¯èƒ½å¯¹ä½ æ¥è¯´å¾ˆæ˜æ˜¾â€”â€”åˆ†å¸ƒå¼æ•°æ®å¤„ç†ç³»ç»Ÿå’Œå¤„ç†å¤§é‡æ•°æ®ä»¥åŠé«˜å¹¶å‘çš„æŸ¥è¯¢å¼•æ“ã€‚
- en: Adaptive query optimization pays off really well when you are dealing with long-running
    queries, the processing tasks for which have been divided into multiple jobs allocated
    to different compute nodes in your cluster (whatever the tech might be â€” Redshift,
    Snowflake, Databricks, and so on). A significant skew in the data, bad partitioning,
    and file formats, among other things, can slow down your queries.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ä½ å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢æ—¶ï¼Œè‡ªé€‚åº”æŸ¥è¯¢ä¼˜åŒ–çš„æ•ˆæœå°¤å…¶æ˜¾è‘—ï¼Œè¿™äº›æŸ¥è¯¢çš„å¤„ç†ä»»åŠ¡è¢«åˆ’åˆ†ä¸ºå¤šä¸ªä½œä¸šåˆ†é…ç»™é›†ç¾¤ä¸­çš„ä¸åŒè®¡ç®—èŠ‚ç‚¹ï¼ˆæ— è®ºæŠ€æœ¯æ˜¯ä»€ä¹ˆâ€”â€”Redshiftã€Snowflakeã€Databricksç­‰ï¼‰ã€‚æ•°æ®çš„æ˜¾è‘—åæ–œã€ä¸è‰¯çš„åˆ†åŒºä»¥åŠæ–‡ä»¶æ ¼å¼ç­‰é—®é¢˜ï¼Œå¯èƒ½ä¼šä½¿æŸ¥è¯¢å˜æ…¢ã€‚
- en: Adaptive query optimization looks at some of these problems and more while your
    query is executing. It also looks at how it was supposed to be performing and
    how it is actually performing with the help of a number of metrics. With such
    a system in place, the query engine can individual query plan workflows or the
    whole query plan while the query is executing.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: è‡ªé€‚åº”æŸ¥è¯¢ä¼˜åŒ–åœ¨æŸ¥è¯¢æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šå…³æ³¨è¿™äº›é—®é¢˜ä»¥åŠæ›´å¤šé—®é¢˜ã€‚å®ƒè¿˜ä¼šæŸ¥çœ‹æŸ¥è¯¢çš„é¢„æœŸè¡¨ç°ä»¥åŠå®é™…è¡¨ç°ï¼Œå€ŸåŠ©å¤šç§æŒ‡æ ‡æ¥è¿›è¡Œè¯„ä¼°ã€‚é€šè¿‡è¿™æ ·çš„ç³»ç»Ÿï¼ŒæŸ¥è¯¢å¼•æ“å¯ä»¥åœ¨æŸ¥è¯¢æ‰§è¡Œæ—¶è°ƒæ•´å•ä¸ªæŸ¥è¯¢è®¡åˆ’å·¥ä½œæµæˆ–æ•´ä¸ªæŸ¥è¯¢è®¡åˆ’ã€‚
- en: More and more databases, especially the ones that have distributed data processing
    capabilities, will end up using some version of adaptive query optimization because
    it solves some of the most time-consuming performance optimization problems like
    ensuring even data distribution, ensuring the optimal partition size based on
    your memory and compute availability, and so on. Iâ€™d highly recommend going through
    the session from Databricks Data+AI 2020 Iâ€™ve shared in the references. It has
    some practical insights into how adaptive query optimization is implemented internally.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: è¶Šæ¥è¶Šå¤šçš„æ•°æ®åº“ï¼Œç‰¹åˆ«æ˜¯é‚£äº›å…·å¤‡åˆ†å¸ƒå¼æ•°æ®å¤„ç†èƒ½åŠ›çš„æ•°æ®åº“ï¼Œå°†æœ€ç»ˆä½¿ç”¨æŸç§ç‰ˆæœ¬çš„è‡ªé€‚åº”æŸ¥è¯¢ä¼˜åŒ–ï¼Œå› ä¸ºå®ƒè§£å†³äº†è®¸å¤šè€—æ—¶çš„æ€§èƒ½ä¼˜åŒ–é—®é¢˜ï¼Œä¾‹å¦‚ç¡®ä¿æ•°æ®å‡åŒ€åˆ†å¸ƒã€æ ¹æ®å†…å­˜å’Œè®¡ç®—èµ„æºçš„å¯ç”¨æ€§ç¡®ä¿æœ€ä½³åˆ†åŒºå¤§å°ç­‰ã€‚æˆ‘å¼ºçƒˆæ¨èæŸ¥çœ‹æˆ‘åœ¨å‚è€ƒèµ„æ–™ä¸­åˆ†äº«çš„Databricks
    Data+AI 2020ä¼šè®®çš„ç›¸å…³å†…å®¹ã€‚å®ƒå¯¹è‡ªé€‚åº”æŸ¥è¯¢ä¼˜åŒ–çš„å†…éƒ¨å®ç°æä¾›äº†ä¸€äº›å®é™…çš„è§è§£ã€‚
- en: Conclusion
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: This article explored the different types of query optimizers used in various
    databases, data warehouses, and data processing engines. The point of being aware
    of the kind of optimizer is that it is central to the query optimization and performance
    tuning aspect of data engineering. The more you scale, the harder it becomes to
    tune. With an in-depth knowledge of the optimizer, you will be able to understand
    how it works and how to manipulate its output to suit your needs and requirements.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç¯‡æ–‡ç« æ¢è®¨äº†åœ¨å„ç§æ•°æ®åº“ã€æ•°æ®ä»“åº“å’Œæ•°æ®å¤„ç†å¼•æ“ä¸­ä½¿ç”¨çš„ä¸åŒç±»å‹çš„æŸ¥è¯¢ä¼˜åŒ–å™¨ã€‚äº†è§£ä¼˜åŒ–å™¨çš„ç±»å‹å¯¹äºæ•°æ®å·¥ç¨‹ä¸­çš„æŸ¥è¯¢ä¼˜åŒ–å’Œæ€§èƒ½è°ƒä¼˜è‡³å…³é‡è¦ã€‚éšç€è§„æ¨¡çš„æ‰©å¤§ï¼Œè°ƒä¼˜å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚é€šè¿‡æ·±å…¥äº†è§£ä¼˜åŒ–å™¨ï¼Œä½ å°†èƒ½å¤Ÿç†è§£å®ƒçš„å·¥ä½œåŸç†ï¼Œä»¥åŠå¦‚ä½•è°ƒæ•´å…¶è¾“å‡ºä»¥æ»¡è¶³ä½ çš„éœ€æ±‚å’Œè¦æ±‚ã€‚
- en: Think of the ideas around any other type of space and time optimization in applications,
    such as garbage collection, caching, etc. Understanding query optimizers bring
    the same benefit to data engineers that understanding the aforementioned concepts
    brings to software developers.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: æƒ³æƒ³å…¶ä»–ç±»å‹çš„ç©ºé—´å’Œæ—¶é—´ä¼˜åŒ–åœ¨åº”ç”¨ä¸­çš„æƒ³æ³•ï¼Œä¾‹å¦‚åƒåœ¾å›æ”¶ã€ç¼“å­˜ç­‰ã€‚ç†è§£æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸ºæ•°æ®å·¥ç¨‹å¸ˆå¸¦æ¥çš„å¥½å¤„ï¼Œä¸ç†è§£ä¸Šè¿°æ¦‚å¿µç»™è½¯ä»¶å¼€å‘è€…å¸¦æ¥çš„å¥½å¤„ç±»ä¼¼ã€‚
- en: References
  id: totrans-38
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å‚è€ƒæ–‡çŒ®
- en: '[Optimization Techniques, Database Design 424, University of Maryland](http://www.cbcb.umd.edu/confcour/Spring2014/CMSC424/query_optimization.pdf)'
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[ä¼˜åŒ–æŠ€æœ¯ï¼Œæ•°æ®åº“è®¾è®¡ 424ï¼Œé©¬é‡Œå…°å¤§å­¦](http://www.cbcb.umd.edu/confcour/Spring2014/CMSC424/query_optimization.pdf)'
- en: '[Query Optimization, Database II, CP 465, Wilfrid Laurier University](https://web.wlu.ca/science/physcomp/ikotsireas/CP465/W2-QueryOptimization/Query_Optimization.pdf)'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[æŸ¥è¯¢ä¼˜åŒ–ï¼Œæ•°æ®åº“ IIï¼ŒCP 465ï¼Œå¨å°”å¼—é‡Œå¾·Â·åŠ³é‡ŒåŸƒå¤§å­¦](https://web.wlu.ca/science/physcomp/ikotsireas/CP465/W2-QueryOptimization/Query_Optimization.pdf)'
- en: '[Relational Query Optimization, CS 3200, Northeastern University](https://www.ccs.neu.edu/home/kathleen/classes/cs3200/19-QOptimize.pdf)'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[å…³ç³»æŸ¥è¯¢ä¼˜åŒ–ï¼ŒCS 3200ï¼Œä¸œåŒ—å¤§å­¦](https://www.ccs.neu.edu/home/kathleen/classes/cs3200/19-QOptimize.pdf)'
- en: '[MySQL 8.0 Reference Manual â€” Optimization Overview](https://dev.mysql.com/doc/refman/8.0/en/optimize-overview.html)'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[MySQL 8.0 å‚è€ƒæ‰‹å†Œ â€” ä¼˜åŒ–æ¦‚è¿°](https://dev.mysql.com/doc/refman/8.0/en/optimize-overview.html)'
- en: '[Overview of PostgreSQL Internals â€” Planner/Optimizer](https://www.postgresql.org/docs/current/planner-optimizer.html)'
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[PostgreSQL å†…éƒ¨æ¦‚è¿° â€” è§„åˆ’å™¨/ä¼˜åŒ–å™¨](https://www.postgresql.org/docs/current/planner-optimizer.html)'
- en: '[Databricks Adaptive Query Execution â€” Data+AI Summit 2020](https://www.youtube.com/watch?v=jzrEc4r90N8)'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[Databricks è‡ªé€‚åº”æŸ¥è¯¢æ‰§è¡Œ â€” Data+AI å³°ä¼š 2020](https://www.youtube.com/watch?v=jzrEc4r90N8)'
- en: If you found this article useful, please subscribe and check out all my writings
    on ğŸŒ² [**Linktree**](https://linktr.ee/kovid). You can also consider supporting
    me by [**buying a Medium Membership**](https://kovidrathee.medium.com/membership)
    using my referral link. Cheers!
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ç”¨ï¼Œè¯·è®¢é˜…å¹¶æŸ¥çœ‹æˆ‘åœ¨ ğŸŒ² [**Linktree**](https://linktr.ee/kovid) ä¸Šçš„æ‰€æœ‰ä½œå“ã€‚ä½ è¿˜å¯ä»¥è€ƒè™‘é€šè¿‡ä½¿ç”¨æˆ‘çš„æ¨èé“¾æ¥
    [**è´­ä¹° Medium ä¼šå‘˜**](https://kovidrathee.medium.com/membership) æ¥æ”¯æŒæˆ‘ã€‚è°¢è°¢ï¼
