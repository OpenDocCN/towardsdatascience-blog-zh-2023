# 使用因果机器学习识别Spotify歌曲流行的驱动因素

> 原文：[https://towardsdatascience.com/identifying-drivers-of-spotify-song-popularity-with-causal-ml-934e8347d2aa](https://towardsdatascience.com/identifying-drivers-of-spotify-song-popularity-with-causal-ml-934e8347d2aa)

## 什么使一首歌“受欢迎”？

[](https://medium.com/@aashishnair?source=post_page-----934e8347d2aa--------------------------------)[![Aashish Nair](../Images/23f4b3839e464419332b690a4098d824.png)](https://medium.com/@aashishnair?source=post_page-----934e8347d2aa--------------------------------)[](https://towardsdatascience.com/?source=post_page-----934e8347d2aa--------------------------------)[![数据科学前沿](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----934e8347d2aa--------------------------------) [Aashish Nair](https://medium.com/@aashishnair?source=post_page-----934e8347d2aa--------------------------------)

·发布于 [数据科学前沿](https://towardsdatascience.com/?source=post_page-----934e8347d2aa--------------------------------) ·10分钟阅读·2023年2月1日

--

![](../Images/3e158bbe5c7a9493fddc127a1acad384.png)

图片由 [C D-X](https://unsplash.com/de/@cdx2?utm_source=medium&utm_medium=referral) 提供，来源于 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

## 目录

∘ [介绍](#0a12)

∘ [问题陈述](#0d78)

∘ [为什么选择因果机器学习？](#b34e)

∘ [数据收集](#fa56)

∘ [探索性数据分析 (EDA)](#ad8f)

∘ [数据建模](#1a29)

∘ [模型解释](#26c0)

∘ [构建网页应用程序](#a2ee)

∘ [局限性](#8f75)

∘ [结论](#6379)

## 介绍

什么使一首歌受欢迎？当艺术家唱到高音或朗读引人深思的歌词时，很容易为你对一首歌的喜爱找到理由。仅仅因为这首歌是你喜欢的艺术家演唱的也很容易。但这不足以解释当前的音乐格局。在这个饱和的市场中，尽管许多曲目有着相似的声音、流派和风格，有些曲目却能够超越其他曲目。

这就引出了一个问题：是否还有更多隐藏/潜在的音频因素影响我们对某些曲目的倾向？该项目试图通过利用因果机器学习来回答这个问题，建立一个工具来帮助识别Spotify歌曲流行的潜在驱动因素。

> 注意：所有源代码和网页应用程序本身可以在本文末尾提供的代码库中访问。

## 问题陈述

该项目的目标是建立一个机器学习模型，根据用户定义的特征预测Spotify曲目的流行度。该模型将被部署在一个网页应用程序中，其他用户可以访问。

幸运的是，Spotify 将许多原本是定性的音频数据量化，这使得该项目得以实施。例如，Spotify API 提供了 `danceability` 特征，该特征提供了一个数值，表示一首歌曲的舞蹈适宜性。有关所有提供的音频特征及其描述，请随时访问 Spotify API [文档](https://developer.spotify.com/documentation/web-api/reference/#/operations/get-several-audio-features)。

Spotify 轨迹还包含 `popularity` 变量，这是本机器学习项目的目标标签。根据文档：

> *一首轨迹的受欢迎程度是 0 到 100 之间的一个值，其中 100 表示最受欢迎。受欢迎程度是通过算法计算的，并且主要基于轨迹的总播放次数和这些播放的最近时间。*

## 为什么选择因果机器学习？

通常，通过进行实验（例如 A/B 测试）来证明因果关系，这些实验追踪预测变量及其对目标变量的影响。不幸的是，进行仅在一个变量上有所不同的歌曲对比实验是不可行的。毕竟，歌曲包含许多元素，这些元素很难精确控制。

另一方面，因果机器学习允许用户创建无尽的歌曲模拟，并得出预测的受欢迎程度评分。虽然模型不会直接指示哪些变量导致高受欢迎程度（相关性不等于因果关系），但它将为任何后续的研究和分析提供动力和方向。

## 数据收集

项目使用的数据通过 Spotify API 获取。具体而言，它使用了[Spotipy](https://spotipy.readthedocs.io/en/2.22.1/)，这是一个用于 Spotify Web API 的 Python 库，用于获取有关轨迹和艺术家的数据。数据收集涉及从平台上最成功的艺术家那里提取 2022 年发布的轨迹，以便接触到高人气的轨迹。

获取信息需要多个步骤，因为感兴趣的特征需要从不同的 API 端点提取。

获取训练数据的过程如下：

1.  **收集所有顶级艺术家的数据**

由于歌曲的受欢迎程度取决于艺术家本身，因此收集如其粉丝数量和音乐流派等基本信息非常重要。以下函数用于收集 1000 位艺术家的数据。

![](../Images/ce4656d3f2dc194b58fab84081fbee9b.png)

艺术家数据预览（作者创建）

**2\. 收集顶级艺术家发布的所有轨迹**

在收集所有艺术家的数据后，使用 Spotipy 收集每位艺术家的所有 Spotify 轨迹。以下函数用于收集某个艺术家发布的所有轨迹的数据。请注意，特定查询的最大记录数为 1000。

![](../Images/7e63b23028f352f5071ce40315272761.png)

轨迹数据预览（作者创建）

**3\. 收集所有顶级艺术家的所有音频特征数据**

接下来，使用Spotipy收集前一步骤中收集的曲目的所有音频数据。以下函数用于收集给定曲目的音频数据（每个曲目通过曲目ID进行识别）。

![](../Images/1ddd9589b2d9a7e4af0232744997ed99.png)

曲目音频特征数据预览

**4\. 合并所有数据集**

通过合并数据集并将每个特征存储在单独的列中，生成的数据集包含艺术家数据和曲目数据，这些数据可以用于训练机器学习模型，以预测歌曲的受欢迎程度。

![](../Images/74d55494abb8f595fe20425c3b5750c2.png)

合并数据集预览（由作者创建）

总体而言，原始数据集包含101,700首曲目和22列。

![](../Images/f57703473b8201f12c8055b3bccd9108.png)

> 提醒：音频特征的定义（第7到18列）可以在[Spotify API 文档](https://developer.spotify.com/documentation/web-api/reference/#/operations/get-several-audio-features)中找到。

## 探索性数据分析（EDA）

在数据集可以用于训练机器学习模型之前，应进行彻底分析，以确定需要添加、丢弃和更改哪些元素。

执行探索性数据分析（EDA）将揭示更多的数据细节，从而提供对在训练任何机器学习模型之前应执行哪些过程和变换的更多洞察。

1.  **处理缺失数据**

删除数据集中缺少音频特征的歌曲。

**2\. 处理重复数据**

删除所有具有重复曲目ID的记录。

**3\. 检查受欢迎程度变量**

接下来，可视化目标变量`popularity`特征的值分布。

![](../Images/c0706b7cf6087010f46f55ab43bfd770.png)

受欢迎程度评分的直方图（由作者创建）

高受欢迎度曲目不足，这带来了挑战，因为模型需要能够正确识别具有高受欢迎度评分的曲目。解决这个问题的一种方法是使用严重惩罚大错误的评估指标，如均方误差（MSE）或均方根误差（RMSE）。

**4\. 检查预测变量**

同样，预测变量的分布也被可视化。

![](../Images/8afe4314fe1d92aec229b4812e44864a.png)

预测特征的分布（由作者创建）

由于预测特征具有不同的数值范围，因此需要对其进行缩放，以减轻模型的偏差。此外，缩放方法还需要处理某些特征中出现的异常值（例如，生动度、声学度）。

**5\. 删除特征**

如曲目ID和艺术家ID等对歌曲受欢迎程度没有影响的特征被从数据集中删除。

**6\. 计算预测变量之间的相关性**

多重共线性是指独立变量之间高度相关的概念，这会影响训练模型的性能。为避免这种情况，计算了每个变量的方差膨胀因子（VIF），使用了以下函数。

![](../Images/e1f9db96fffb1dbf6eeabc3496026a43.png)

特征的 VIF 值（作者创建）

由于预测特征的 VIF 值小于 5，因此数据集中没有多重共线性的证据。

**6\. 处理分类特征**

数据集中有两个分类特征需要在训练模型之前处理：`key` 和 `genre`。

`key` 特征表示曲目的调性。目前，调性由数字表示，但这意味着某些调性大于其他调性，这是错误的。因此，该特征将进行一热编码。

不幸的是，`genre` 特征的一热编码不是一个可行的方法，因为该特征有 609 个独特的值！对这样多唯一值的列进行一热编码只会产生高维数据集。相反，子类别将被合并成一个名为 `is_pop_or_rap` 的二进制变量，如果歌曲是流行或说唱，则为 1，否则为 0。

## 数据建模

EDA 透露了建模阶段应该如何进行。它表明，如果基于 MSE 或 RMSE 指标进行调优，模型会有更好的表现。

它还显示数据在用于训练模型之前需要进行一热编码和标准化。

**1\. 准备训练和测试数据**

数据首先被拆分为训练集和测试集。

**2\. 创建基准**

基准将有助于对实际模型的性能进行上下文分析。在本研究中，基准模型是一个具有默认参数的线性回归模型。

**3\. 创建特征工程管道**

在被机器学习算法训练之前，预测变量需要经过特征工程。首先，分类特征 `key` 将进行一热编码。之后，所有特征将通过标准化进行缩放。

使用以下代码片段将转换和模型存储在管道对象中。

**4\. 训练模型**

在特征工程后，使用数据训练了多种机器学习回归算法。使用的回归模型如下：

+   线性回归（基准）

+   Lasso 回归

+   随机森林回归器

+   LightGBM 回归器

+   XGBoost 回归器

对于每个回归模型，基于均方误差指标进行了超参数调优，以确定最佳超参数组合。使用以下函数选择每个模型的最佳超参数。

在确定了模型的超参数后，模型根据 RMSE 和 MAE 指标在测试集上进行了评估。下表总结了所有模型的性能。

![](../Images/b06e920a89ad52400c2e2bb4ddc26fa9.png)

测试集上模型表现总结（作者创建）

基准模型在测试集上的RMSE和MAE分别为17.65和13.03。尽管所有其他模型都优于基准，但随机森林回归器表现突出，其RMSE和MAE分别为13.10和8.04。

鉴于随机森林模型在测试集上的表现最佳，它将被部署到网页应用程序中。

## 模型解释

Shapley Addictive Explanations（SHAP）通过展示每个特征对预测的贡献，帮助解释随机森林回归器的表现。这将为了解预测是如何做出的（即哪些特征影响目标）提供一些线索，甚至可以揭示模型或训练数据的不足之处。

![](../Images/a1fbca38ee614940cb4d3e53f4d7ecf5.png)

SHAP总结图（作者创建）

根据图表，回归模型的预测最受`followers`、`duration_s`和`speechiness`特征的影响。模型认为，具有高粉丝量、中等时长和高词汇量（即冗长）的艺术家的歌曲会产生高人气。直观上，这些因素影响人气是合理的，但令人惊讶的是，模型没有将`energy`或`is_pop_or_rap`等特征排在前面。

总体而言，模型的评估指标得分表明仍有改进空间。总结图清楚地表明，尽管一些特征与人气的关系得到领域知识支持，但模型并不青睐这些特征。它还表明数据中有限的特征阻碍了模型准确评估人气。

## 构建网页应用程序

通过网页应用程序部署模型是有效生成多个歌曲预测的方式。

随机森林回归器被部署在Streamlit应用程序中，预测具有用户选择特征的曲目的受欢迎程度。

可以通过在终端中输入以下命令运行Streamlit应用：

[PRE0]

![](../Images/df4d3df73a6ee6e337f2861386055460.png)

Streamlit应用预览（作者创建）

用户可以在侧边栏中选择他们的曲目特征，并点击“预测”按钮查看模型的预测结果。通过这个网页应用程序，用户可以利用机器学习模型预测无尽的歌曲参数组合的人气。

## 限制

尽管使用因果机器学习可以帮助提供一些关于音频特征如何影响歌曲受欢迎程度的见解，但这种方法存在一些需要解决的限制。具体来说，有些问题是研究未能充分深入探讨的。

1.  **音频特征的数值表示**

虽然 Spotify 确实为用户提供了量化歌曲某些特征（例如能量）的手段，但分配的数值可能不足以表示其他定性特征。

**2\. 艺术家/专辑/歌曲营销**

毫无疑问，歌曲的受欢迎程度与艺术家如何营销他们的歌曲以及他们自己有很大关系。不幸的是，收集的数据中对这一因素的代表性很少。未来值得考虑的是像唱片公司和艺术家在热门社交媒体平台（例如 Twitter、Instagram）上的参与对流行度的影响。

**3\. 歌词**

虽然你不能通过说某个词、短语或句子来神奇地让某人喜欢一首歌，但歌词无疑在人们享受曲目时起着作用。也许像潜在狄利克雷分配（LDA）这样的主题建模方法可以提供一些关于不同流派歌词类型的洞察。

**4\. 客户人口统计**

不同人口统计学群体的听众可能对曲目有不同的标准。与其将整个受众归为一组，不如按年龄/性别/种族对受众进行细分，并研究这些群体喜欢哪些类型的歌曲。

**5\. 用户偏好的渐进变化**

最后，模型的一个显著缺陷是它只考虑了2022年发布的歌曲。即使它充分捕捉到高人气曲目的要素，音乐标准也会随着时间的推移而不可避免地发生变化。因此，这个模型必须持续用新数据进行训练，以保持可用性。

## 结论

![](../Images/5893f740b7665ca7ae368374618b20e3.png)

由 John Tekeridis 拍摄的照片：[https://www.pexels.com/photo/person-using-smartphone-340103/](https://www.pexels.com/photo/person-using-smartphone-340103/)

总体而言，我尝试回答了大多数艺术家和唱片公司心中的一个问题。通过利用机器学习，我们能够进行高级模拟，推测具有某些特征的歌曲将如何被听众接受。

如果你有兴趣在你的设备上运行 streamlit 应用程序，或者只是希望查看源代码，你可以通过以下链接访问项目的 Github 仓库：

[](https://github.com/anair123/Identifying_Drivers_Of_Song_Popularity_With_Causal_ML?source=post_page-----934e8347d2aa--------------------------------) [## GitHub - anair123/Identifying_Drivers_Of_Song_Popularity_With_Causal_ML]

### 一首歌的吸引力是什么？如果你浏览过 Spotify 上任何艺术家的专辑，你可能会注意到一些...

github.com](https://github.com/anair123/Identifying_Drivers_Of_Song_Popularity_With_Causal_ML?source=post_page-----934e8347d2aa--------------------------------)

希望你在了解这个项目时和我制作它时一样有趣。

感谢阅读！
