# 约束编程解释

> 原文：[https://towardsdatascience.com/constraint-programming-explained-2882dc3ad9df](https://towardsdatascience.com/constraint-programming-explained-2882dc3ad9df)

![](../Images/6cf518b9ff47ceb0982a963d081b8582.png)

图着色问题解释，由 Dall-E 2 画出。

## 约束编程求解器的核心及其与混合整数编程的关系

[![Hennie de Harder](../Images/3e4f2cccd6cb976ca3f8bf15597daea8.png)](https://hennie-de-harder.medium.com/?source=post_page-----2882dc3ad9df--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----2882dc3ad9df--------------------------------) [Hennie de Harder](https://hennie-de-harder.medium.com/?source=post_page-----2882dc3ad9df--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----2882dc3ad9df--------------------------------) ·9 分钟阅读·2023年1月12日

--

**定义和解决优化问题的方法有很多种。你可以使用贪心算法、约束编程、混合整数编程、遗传算法或局部搜索等。在这篇文章中，我们将深入探讨约束编程。作为例子，图着色问题被用来说明约束编程的工作原理。**

如果你需要优化问题和搜索启发式的介绍，可以阅读下面的帖子。

[## 每个数据科学家都应该知道的数学优化启发式](https://towardsdatascience.com/?source=post_page-----2882dc3ad9df--------------------------------)

### 本地搜索、遗传算法等。

[towardsdatascience.com](https://towardsdatascience.com/?source=post_page-----2882dc3ad9df--------------------------------)

# 图着色

让我们从图着色问题开始。这个问题在帖子中用于说明约束编程的概念。

对于给定的地图，你想给每个国家上色。你有无限多的颜色。相邻的国家不允许使用相同的颜色。你需要多少种颜色才能填满地图？

*变量* 是你给国家的颜色。*约束* 是不允许给相邻的国家相同的颜色。*目标* 是最小化使用的颜色数量。

听起来很简单？实际上可能很难！这是非洲部分解决方案：

![](../Images/976149c266d558818ff234d949fdc50b.png)

图片来自作者。

另一种可视化这个问题的方法是使用顶点和边。相邻的国家通过边连接。顶点对应于国家。这是之前用这种方式说明的示例：

![](../Images/969454a088b6c1e54cd87910ea887356.png)

从地图到顶点和边。这使得检测错误和查看相邻国家变得更容易。图片由作者提供。

# 什么是约束编程？

约束编程（CP）的关键思想是，它使用约束来减少每个变量可以取的值的集合。在CP中，程序（或求解器）跟踪可以出现的值。在每次移动后，搜索空间会被剪枝。这意味着不能再发生的值会被移除。可能会出现求解器尚未找到可行解决方案时没有更多可能的移动。在这种情况下，求解器会从做出决策的早期点开始，并重新考虑。

## 基础知识

CP的重点是可行性，而不是最优性。在做出决策后，求解器检查可行性并剪枝搜索空间。在下面的图片中，你可以看到一个基本的CP求解器。大部分是搜索和约束存储，稍后我会详细解释。简而言之：搜索是做出决策的地方，约束存储包含域存储中所有可能的变量值并保持约束。做出一个移动（例如，你把一个国家涂成红色），在约束存储中根据这个移动剪枝域存储。还有可行性检查，这意味着当移动不可行因为它违反了一个或多个约束时，需要回滚（失败）。

![](../Images/7b006cc84ac04ff74bcb5f08fa011a85.png)

约束编程。图片由作者提供。

在下面的示例中，你可以看到，当你把一个国家涂成红色时，所有与这个红色国家相连的国家的红色必须从域存储中移除，因为这些操作不再可能进行。

![](../Images/4ddb82cf694a19cff5080a10eb4e423f.png)

剪枝：这两个相邻的国家不能再被涂成红色。图片由作者提供。

你可能会想：约束编程如何找到一个最优解？尤其是在图着色问题中，找到一个可行解是很容易的。最简单的方式是给每个国家不同的颜色。这是一个可行解，但远非最优。有不同的方法来解决这个问题。例如，可以不断解决问题，并添加一个约束，要求新的解决方案使用的颜色比之前的少。

## 搜索

在搜索中，有一些有效的规则可以遵循，这些规则可以显著改善搜索。第一个是*首次失败原则*。这意味着你首先尝试最可能失败的地方。这使得最后的事情更容易，并最大程度地减少搜索树。在图着色中，从一个与许多其他国家相连的国家开始，比从一个没有很多连接的国家开始要好：

![](../Images/581ef9a9fd9489d9337bfb07902a807a.png)

首次失败原则：从连接数最多的国家开始。图像作者提供。

这有助于，因为如果你已经为周围的国家上色，为这个国家上色会更困难。如果你不从这个国家开始，可能需要为它选择一个新的颜色，这是你想要避免的。

你可以实现不同类型的搜索。根据问题的不同，你可以选择最佳的一种（或尝试所有）：

+   **变量/值标记** 使用这种搜索方法，你从变量开始。在图着色中，国家是变量，颜色是值。你以聪明的方式选择下一个要分配的变量（国家）。例如，你可以选择可能值最少的那个。然后，你选择这个变量将获得的值（颜色）。通常，选择的值是给其他变量留出尽可能多的选项。下面是一个简单的例子。

![](../Images/83260385626fd0c4054ec92b2b670886.png)

变量/值标记的示例。图像作者提供。

+   **值/变量标记**

    处理搜索的另一种方法是从值开始。你有一个颜色，然后选择一个国家来赋予这个颜色。这与变量/值标记正好相反。在图着色问题中，你可以将所有可以拥有相同颜色的国家组成一个集合。

+   **域划分**

    使用域划分，你不会直接为变量分配一个值。相反，你将变量的域（可能值）划分为两个或更多集合。这比直接指定：这个国家应该具有这个值的承诺要弱，因为你仍然有对国家的选择，即集合中的一个值。

+   **搜索中的对称性破除** 对称性破除可以显著改善搜索效果。你需要防止对称解被探索，因为这是一种时间浪费。从理论上讲，对称解是完全相同的。开始破除图着色中的对称性的一种方法是为某些国家固定颜色。更好的破除对称性的方法是通过对变量（国家）进行排序，或者只考虑当前值（颜色）和一个新值（颜色）。

![](../Images/27c1646477ab03ff41f73e5fa68d3e8b.png)

对称解。不同的颜色，但解决方案完全相同。图像作者提供。

+   **随机化和重启** 也可以尝试以随机顺序寻找不同的解决方案。你可以随机选择变量的值，然后检查解决方案是否可行。如果经过一段时间或若干尝试后没有找到解决方案，你就重新开始搜索。

上述方法是处理约束编程中的搜索部分的不同方式。可以将它们中的一些结合使用。

## 约束存储

在约束存储中可以实现不同类型的约束。约束用于可行性检查和域存储的修剪。在图着色的情况下，‘正常’约束是一个国家与另一个国家相连时不能有相同的颜色。但根据问题，你可以创建其他有趣的约束。添加约束的目标是收紧问题。如果你做出更紧密的定义，最终解决方案可以更快地找到。

这里是你可以添加到约束存储中的不同类型的约束：

+   **全局约束** 你可以添加的最重要的约束是全局约束。全局约束有助于修剪搜索空间，并且可以更早地检测到不可行性。全局约束有助于直接向求解器传达问题结构。一个全局约束的例子是 *alldifferent* 约束。这个约束意味着所有变量应该具有不同的值。在图着色问题中，当四个国家全部相连时，它们应该都有不同的颜色。如果我们仅剩下三种颜色用于这些国家，解决方案是不可行的：我们可以回滚并报告失败。

![](../Images/ff5908f31e376d809d4a4147b5ca3ba5.png)

这些国家都相连，因此它们应该都有不同的颜色。图片作者提供。

+   **冗余约束** 冗余约束是不会增加排除解决方案价值的约束。但冗余约束在计算上是重要的，因为它们减少了搜索空间。冗余约束捕捉到某些不可能但未被其他约束捕获的内容。图着色中的一个例子是：颜色的数量不能超过国家的数量。

+   **替代约束** 通过结合现有约束，你会得到替代约束。替代约束很有帮助，因为它们提供了更全面的视角。一个例子是合并现有约束或对它们进行线性组合。

+   **隐含约束** 你可以添加的另一种约束是隐含约束。通过从多个现有约束中推导出一个属性，可以得到隐含约束。

在创建约束时，你可以发挥创造力！对于某个问题，尝试完全理解它，以便向约束存储中添加有用的约束。这可以大幅提高求解器的速度。

# CP 和 MIP 之间的关系是什么？

你可能听说过混合整数规划。这是另一种建模离散优化问题的技术。MIP 使用不同的方法来寻找问题的最佳解决方案。下面，你可以阅读 CP 和 MIP 之间的相似性和差异。

## 什么是混合整数规划？

混合整数规划（MIP）是一种数学优化技术，通过求解包含整数和连续变量的线性方程和不等式系统来找到问题的最优解。MIP关注于最优性。要正确理解MIP及其背后的数学，了解线性规划和单纯形算法的工作原理很重要。如果你想复习这些内容，可以阅读下面的文章：

[## 初学者线性规划和单纯形算法指南](https://example.org/a-beginners-guide-to-linear-programming-and-the-simplex-algorithm-87db017e92b4?source=post_page-----2882dc3ad9df--------------------------------)

### 处理广泛的优化问题。

[towardsdatascience.com](https://example.org/a-beginners-guide-to-linear-programming-and-the-simplex-algorithm-87db017e92b4?source=post_page-----2882dc3ad9df--------------------------------)

MIP求解器通过允许整数变量的连续值来放松约束。这使得使用单纯形算法成为可能。之后，使用其他技术找到有效的解决方案（整数变量的整数值）。这些技术超出了本帖的范围，但如果你感兴趣，可以搜索诸如分支限界、分支剪切和切割平面（例如，戈莫里剪切和平面剪切）等术语。

## CP和MIP的关系

从数学上讲，可以将任何MIP问题表述为CP问题（或将CP问题表述为MIP问题）。从这个角度看，它们是相同的。但由于它们达到最优解的方法不同，你可能需要考虑哪一种方法最适合你的特定问题。MIP使用线性松弛，而CP使用逻辑推理。对于具有许多‘或’约束的问题，CP通常更快，而MIP可以更快地处理‘和’约束。如果你使用的是商业MIP求解器，它们可能已经在其中实现了CP技术，如创建高层次约束和逻辑推理。MIP通常更灵活、更可靠。如果你有时间，测试不同的技术来查看哪种对你的问题最有效总是好的。

# 结论

希望你喜欢这次关于约束编程的介绍。它是一种关注可行性的技术。约束存储和寻找解决方案的方式是CP的关键组成部分。如果你将不同类型的约束添加到约束存储中，可以极大地改善模型的表述。CP求解器的核心通过约束进行传播，检查解决方案是否仍然可行以及是否可以进行剪枝。剪枝意味着从变量域中删除值。CP求解器可以找到最优解，只要你给它们足够的时间。

混合整数规划是另一种表述离散优化问题的方法。它使用代数技术来找到最优解。根据问题的不同，你可以选择CP或MIP哪个更合适。

以下是更多关于数学优化的帖子。

## 相关

[## 如何处理优化问题？](https://towardsdatascience.com/how-to-handle-optimization-problems-daf97b3c248c?source=post_page-----2882dc3ad9df--------------------------------)

### 简单的示例和解决方案及代码。

[## 五种将数学优化与机器学习相结合的方法](https://towardsdatascience.com/four-ways-to-combine-mathematical-optimization-and-machine-learning-8cb874276254?source=post_page-----2882dc3ad9df--------------------------------)

### 实际示例展示了如何结合两种力量。

[## 为什么每个数据科学家都应该学习数学优化](https://towardsdatascience.com/why-every-data-scientist-should-learn-mathematical-optimization-3ac102663456?source=post_page-----2882dc3ad9df--------------------------------)

### 数据科学课程专注于数据可视化、特征工程、数据处理、（非）监督学习……

[如何处理优化问题？](/how-to-handle-optimization-problems-daf97b3c248c?source=post_page-----2882dc3ad9df--------------------------------)
