- en: 'Hacking Causal Inference: Synthetic Control with ML approaches'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/hacking-causal-inference-synthetic-control-with-ml-approaches-7f3c19c7abfa](https://towardsdatascience.com/hacking-causal-inference-synthetic-control-with-ml-approaches-7f3c19c7abfa)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Test Effectiveness of any Treatment over Time with PCA
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@cerlymarco?source=post_page-----7f3c19c7abfa--------------------------------)[![Marco
    Cerliani](../Images/48a07a024349bac3c8e397bf5a0372e2.png)](https://medium.com/@cerlymarco?source=post_page-----7f3c19c7abfa--------------------------------)[](https://towardsdatascience.com/?source=post_page-----7f3c19c7abfa--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----7f3c19c7abfa--------------------------------)
    [Marco Cerliani](https://medium.com/@cerlymarco?source=post_page-----7f3c19c7abfa--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----7f3c19c7abfa--------------------------------)
    ·5 min read·Mar 14, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3094292f2d245e5eb9a1ccffa073efdb.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Raul Petri](https://unsplash.com/@raulpetri?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: 'The standard, presented in the literature and adopted at large scale by companies,
    to study the causal impacts of business actions (like design change, discount
    offers, and clinical trials) is for sure AB testing. **When carrying out an AB
    test, we are doing a randomized experiment**. In other words, we randomly split
    a population under our control (patients, users, customers) into two sets: a treatment
    and a control group. The treatment action is given to the treatment group, leaving
    the control group as is. After some time, we come back to registering the metrics
    of interest and analyzing the impact of treatment on population behaviors.'
  prefs: []
  type: TYPE_NORMAL
- en: 'All that glitters is not gold! **It’s proved that AB testing suffers different
    drawbacks**. The main assumptions behind randomized trials are:'
  prefs: []
  type: TYPE_NORMAL
- en: No interactions between the treatment and control groups (i.e. network effect).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The increasing cost of large-scale experiments.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the real world, **the network effect is common since we may expect to register
    “contamination” among people**. That’s the case of opinion sharing across social
    media (in the case of a marketing trial) which influences each other choices.
    To override this inconvenience a solution consists in increasing the scale of
    the experiment by selecting people with different tastes across various geographical
    regions. **Despite increasing the sample size may be a valid solution, it’s infeasible
    since it increases costs exponentially**. In this scenario, a technique called
    synthetic control was introduced.
  prefs: []
  type: TYPE_NORMAL
- en: In this post, we present the synthetic control methodologies for randomized
    experiment trials. The technique is introduced in this paper [1]. Our aim is not
    to show a mere implementation of the approach on a real-world dataset. **We leverage
    the temporal dynamics present in the data to propose a variation of synthetic
    control using tools from the data scientist's arsenal**.
  prefs: []
  type: TYPE_NORMAL
- en: WHAT’S SYNTHETIC CONTROL
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Synthetic control aims to evaluate the effect of interventions in case studies.
    It’s similar to any randomized experiment. In the preliminary phases, treatment
    and control groups are selected. **Differently from standard causal analysis,
    the treatment population can assume any size!**
  prefs: []
  type: TYPE_NORMAL
- en: Imagine being interested to verify the effectiveness of a treatment on a group
    composed exactly of a single unit. Adopting the classic synthetic control methodology,
    we end up building a weighted average of multiple control units to mimic the behavior
    of the treatment case (artificial control case).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0a863561a1b28946c32bedc742eefc4b.png)'
  prefs: []
  type: TYPE_IMG
- en: Synthetic control mathematical formulation [image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: Mathematically speaking, the problem consists in finding the optimal values
    of *W* (unit weights) that minimize the equation above. These values represent
    the contributions of each control unit in building the artificial control case.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7671d347ee6cacd1e751419cadf5d51f.png)'
  prefs: []
  type: TYPE_IMG
- en: Synthetic control simulation [image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: '**We want to verify how the relationship between units changes before and after
    the treatment introduction date (intervention)**. If we notice a significative
    divergence between the artificial control case and the real treatment one in the
    testing period, we may affirm the treatment is successful.'
  prefs: []
  type: TYPE_NORMAL
- en: SYNTHETIC CONTROL WITH PCA
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Synthetic control is a revolutionary technique that provides researchers with
    rules for control case generation. By making the synthetic case looks like the
    treated case, it’s possible to study the impact of any treatment actions over
    time.
  prefs: []
  type: TYPE_NORMAL
- en: '**What synthetic control does under the hood is to study the temporal dynamics
    of control and treatment units**. Firstly, when building the artificial control
    case, the interactions between control units are studied. Secondly, the same interactions
    are extrapolated and verified after the treatment introduction. In other words,
    **we are checking for relationship changes between units before and after the
    intervention**.'
  prefs: []
  type: TYPE_NORMAL
- en: In machine learning, we are used to checking for distributions and relations
    change over time. What if we apply a technique, usually used to detect relationship
    changes, in a causal context to verify the effectiveness of treatment experiments?
  prefs: []
  type: TYPE_NORMAL
- en: A good candidate for this task may be Principal Component Analysis (PCA). It’s
    a well know technique adopted at scale in machine learning to solve various tasks.
    We decide to use it to learn the relationships of units before treatment introduction.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Then we apply it to reconstruct the unit paths after treatment.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: In the end, we measure the reconstruction errors to quantify a possible change
    in each singular unit dynamic which may be due to treatment adoption.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: We apply the proposed methodology to study the restriction introduced by the
    state of California in 1988 ([Proposition 99](https://www.cdph.ca.gov/Programs/CCDPHP/DCDIC/CTCB/Pages/LegislativeMandateforTobaccoControlProposition99-.aspx?TSPD_101_R0=087ed344cfab2000cc093680036ad502c344f7e34a20b9e37c3529436f306dbf7153a0f980fdfda80829022d61143000411db686cf2ff3459a8ed4ea50a7b250e3ff689fec9fd2596fd6fac3e3b95a363a4efd31fd30c42d97ea2898b9f5ce33))
    on tobacco consumption. The amendment aimed to increase taxes on tobacco products
    to prevent the consumption of cigarettes.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8df8ef14e50ac7bc3ccd5ab5f311e44c.png)'
  prefs: []
  type: TYPE_IMG
- en: Cigarettes consumptions over years for each state [image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: The study is the same one proposed by Abadie in this work [2]. The data of the
    experiment are downloadable by everyone [here](https://chronicdata.cdc.gov/Policy/The-Tax-Burden-on-Tobacco-Glossary-and-Methodology/fip8-rcng)
    and are released under a [public license](https://catalog.data.gov/dataset/the-tax-burden-on-tobacco-1970-2018).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f1c8baebe3f2027e69b024b8a14bb890.png)'
  prefs: []
  type: TYPE_IMG
- en: PCA fitted components over years [image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: Analyzing the reconstruction error for each state independently, California
    registers the biggest negative reduction. For California state, we notice a significant
    deviation from the expected consumption (reconstructed by PCA) to the observed.
    This behavior may be due to an increase in tobacco taxes which leads to a reduction
    in cigarette consumption.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8bf4bc1f08dca06e0d0245ce3b7eb883.png)'
  prefs: []
  type: TYPE_IMG
- en: Reconstruction errors for each state after intervention [image by the author]
  prefs: []
  type: TYPE_NORMAL
- en: With a simple modeling strategy, we can learn the paths of various units under
    study. We can observe their expected behavior and analyze possible divergences
    from what we expect in normal conditions or with the introduction of treatment
    activities.
  prefs: []
  type: TYPE_NORMAL
- en: SUMMARY
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this post, we introduced synthetic control as a methodology to extract causal
    insights from the introduction of any treatment action. Classical synthetic control
    works by studying the relationships of units in the control group building an
    artificial control case. We discovered that it’s possible to do the same in a
    straight forwarding way, simply studying the relationships between units and observing
    how they vary with time. We did it by analyzing the reconstruction errors of PCA
    after treatment introduction.
  prefs: []
  type: TYPE_NORMAL
- en: '[**CHECK MY GITHUB REPO**](https://github.com/cerlymarco/MEDIUM_NoteBook)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Keep in touch: [Linkedin](https://www.linkedin.com/in/marco-cerliani-b0bba714b/)'
  prefs: []
  type: TYPE_NORMAL
- en: REFERENCES
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[1] A. Abadie, J. Gardeazabal, [The Economic Costs of Conflict: A Case Study
    of the Basque Country](https://www.jstor.org/stable/3132164) (2003), *The American
    Economic Review*.'
  prefs: []
  type: TYPE_NORMAL
- en: '[2] A. Abadie, A. Diamond, J. Hainmueller, [Synthetic Control Methods for Comparative
    Case Studies: Estimating the Effect of California’s Tobacco Control Program](https://www.tandfonline.com/doi/abs/10.1198/jasa.2009.ap08746)
    (2010), *Journal of the American Statistical Association*.'
  prefs: []
  type: TYPE_NORMAL
