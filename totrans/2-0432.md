# ä½¿ç”¨ Athena å’Œ MySQL æ„å»ºæ‰¹é‡æ•°æ®ç®¡é“

> åŸæ–‡ï¼š[https://towardsdatascience.com/building-a-batch-data-pipeline-with-athena-and-mysql-7e60575ff39c](https://towardsdatascience.com/building-a-batch-data-pipeline-with-athena-and-mysql-7e60575ff39c)

## åˆå­¦è€…çš„ç«¯åˆ°ç«¯æ•™ç¨‹

[](https://mshakhomirov.medium.com/?source=post_page-----7e60575ff39c--------------------------------)[![ğŸ’¡Mike Shakhomirov](../Images/bc6895c7face3244d488feb97ba0f68e.png)](https://mshakhomirov.medium.com/?source=post_page-----7e60575ff39c--------------------------------)[](https://towardsdatascience.com/?source=post_page-----7e60575ff39c--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----7e60575ff39c--------------------------------) [ğŸ’¡Mike Shakhomirov](https://mshakhomirov.medium.com/?source=post_page-----7e60575ff39c--------------------------------)

Â·å‘å¸ƒäº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----7e60575ff39c--------------------------------) Â·16 min é˜…è¯»Â·2023 å¹´ 10 æœˆ 20 æ—¥

--

![](../Images/368293b91e4bc0283007a555789b6479.png)

å›¾ç‰‡ç”± [Redd F](https://unsplash.com/@raddfilms?utm_source=medium&utm_medium=referral) æä¾›ï¼Œæ¥è‡ª [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

åœ¨è¿™ä¸ªæ•…äº‹ä¸­ï¼Œæˆ‘å°†è®²è¿°ä¸€ç§éå¸¸æµè¡Œçš„æ•°æ®è½¬æ¢ä»»åŠ¡æ‰§è¡Œæ–¹å¼â€”â€”æ‰¹é‡æ•°æ®å¤„ç†ã€‚å½“æˆ‘ä»¬éœ€è¦ä»¥å—çŠ¶æ–¹å¼å¤„ç†æ•°æ®æ—¶ï¼Œè¿™ç§æ•°æ®ç®¡é“è®¾è®¡æ¨¡å¼å˜å¾—æå…¶æœ‰ç”¨ï¼Œéå¸¸é€‚åˆéœ€è¦è°ƒåº¦çš„ ETL ä½œä¸šã€‚æˆ‘å°†é€šè¿‡ä½¿ç”¨ MySQL å’Œ Athena æ„å»ºæ•°æ®è½¬æ¢ç®¡é“æ¥å±•ç¤ºå¦‚ä½•å®ç°è¿™ä¸€ç›®æ ‡ã€‚æˆ‘ä»¬å°†ä½¿ç”¨åŸºç¡€è®¾æ–½å³ä»£ç åœ¨äº‘ä¸­éƒ¨ç½²å®ƒã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åˆšåˆšä½œä¸ºæ•°æ®å·¥ç¨‹å¸ˆåŠ å…¥äº†ä¸€å®¶å…¬å¸ã€‚ä»–ä»¬çš„æ•°æ®å †æ ˆç°ä»£ã€äº‹ä»¶é©±åŠ¨ã€æˆæœ¬æ•ˆç›Šé«˜ã€çµæ´»ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾æ‰©å±•ä»¥æ»¡è¶³ä¸æ–­å¢é•¿çš„æ•°æ®èµ„æºã€‚ä½ æ•°æ®å¹³å°ä¸­çš„å¤–éƒ¨æ•°æ®æºå’Œæ•°æ®ç®¡é“ç”±æ•°æ®å·¥ç¨‹å›¢é˜Ÿç®¡ç†ï¼Œä½¿ç”¨å…·æœ‰ CI/CD GitHub é›†æˆçš„çµæ´»ç¯å¢ƒè®¾ç½®ã€‚

ä½œä¸ºæ•°æ®å·¥ç¨‹å¸ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªä¸šåŠ¡æ™ºèƒ½ä»ªè¡¨æ¿ï¼Œå±•ç¤ºå…¬å¸æ”¶å…¥æ¥æºçš„åœ°ç†åˆ†å¸ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚åŸå§‹æ”¯ä»˜æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨æ•°æ®åº“ï¼ˆMySQLï¼‰ä¸­ã€‚ä½ æƒ³æ„å»ºä¸€ä¸ªæ‰¹é‡ç®¡é“ï¼Œä»è¯¥æ•°æ®åº“ä¸­æ¯æ—¥æå–æ•°æ®ï¼Œç„¶åä½¿ç”¨ AWS S3 å­˜å‚¨æ•°æ®æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ Athena è¿›è¡Œå¤„ç†ã€‚

![](../Images/7dc86278ad5d6755486da64418c7b7bf.png)

æ”¶å…¥ä»ªè¡¨æ¿ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

## æ‰¹é‡æ•°æ®ç®¡é“

æ•°æ®ç®¡é“å¯ä»¥è¢«è§†ä¸ºä¸€ç³»åˆ—æ•°æ®å¤„ç†æ­¥éª¤ã€‚ç”±äºè¿™äº›é˜¶æ®µä¹‹é—´çš„***é€»è¾‘æ•°æ®æµè¿æ¥***ï¼Œæ¯ä¸ªé˜¶æ®µç”Ÿæˆçš„**è¾“å‡º**ä½œä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„**è¾“å…¥**ã€‚

> åªè¦åœ¨ç‚¹ A å’Œç‚¹ B ä¹‹é—´è¿›è¡Œæ•°æ®å¤„ç†ï¼Œå°±å­˜åœ¨æ•°æ®ç®¡é“ã€‚

æ•°æ®ç®¡é“å¯èƒ½å› å…¶æ¦‚å¿µå’Œé€»è¾‘æ€§è´¨è€Œæœ‰æ‰€ä¸åŒã€‚æˆ‘ä¹‹å‰åœ¨è¿™é‡Œå†™è¿‡ [1]ï¼š

[æ•°æ®ç®¡é“è®¾è®¡æ¨¡å¼](https://towardsdatascience.com/data-pipeline-design-patterns-100afa4b93e3?source=post_page-----7e60575ff39c--------------------------------)

### é€‰æ‹©åˆé€‚çš„æ¶æ„åŠå…¶ç¤ºä¾‹

[æ•°æ®ç®¡é“è®¾è®¡æ¨¡å¼](https://towardsdatascience.com/data-pipeline-design-patterns-100afa4b93e3?source=post_page-----7e60575ff39c--------------------------------)

æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ªæ•°æ®ç®¡é“ï¼Œåœ¨ä»¥ä¸‹ **æ­¥éª¤** ä¸­è½¬æ¢æ•°æ®ï¼š

1\. ä½¿ç”¨ Lambda å‡½æ•°å°†æ•°æ®ä» MySQL æ•°æ®åº“è¡¨ `myschema.users` å’Œ `myschema.transactions` æå–åˆ° S3 æ•°æ®æ¹–æ¡¶ä¸­ã€‚

2\. æ·»åŠ ä¸€ä¸ªå…·æœ‰ Athena èµ„æºçš„çŠ¶æ€æœºèŠ‚ç‚¹ä»¥å¯åŠ¨æ‰§è¡Œ (`arn:aws:states:::athena:startQueryExecution.sync`) å¹¶åˆ›å»ºä¸€ä¸ªåä¸º `mydatabase` çš„æ•°æ®åº“

3\. åˆ›å»ºå¦ä¸€ä¸ªæ•°æ®ç®¡é“èŠ‚ç‚¹ä»¥æ˜¾ç¤º Athena æ•°æ®åº“ä¸­çš„ç°æœ‰è¡¨ã€‚ä½¿ç”¨è¯¥èŠ‚ç‚¹çš„è¾“å‡ºæ‰§è¡Œæ‰€éœ€çš„æ•°æ®è½¬æ¢ã€‚

å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„ç®¡é“åœ¨ Athena ä¸­æ ¹æ®æ¥è‡ªæ•°æ®æ¹– S3 æ¡¶çš„æ•°æ®åˆ›å»ºå®ƒä»¬ã€‚æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸¤ä¸ª **å¤–éƒ¨è¡¨**ï¼Œæ•°æ®æ¥è‡ª MySQLï¼š

+   mydatabase.users (LOCATION â€˜s3://<YOUR_DATALAKE_BUCKET>/data/myschema/users/â€™)

+   mydatabase.transactions (LOCATION â€˜s3://<YOUR_DATALAKE_BUCKET>/data/myschema/transactions/â€™)

ç„¶åæˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ª **ä¼˜åŒ–çš„ ICEBERG** è¡¨ï¼š

+   mydatabase.user_transactions (â€˜table_typeâ€™=â€™ICEBERGâ€™, â€˜formatâ€™=â€™parquetâ€™) ä½¿ç”¨ä»¥ä¸‹ SQLï¼š

[PRE0]

+   æˆ‘ä»¬è¿˜å°†ä½¿ç”¨ MERGE æ¥æ›´æ–°æ­¤è¡¨ã€‚

MERGE æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„ SQL æŠ€å·§ï¼Œç”¨äºè¡¨ä¸­çš„å¢é‡æ›´æ–°ã€‚æŸ¥çœ‹æˆ‘ä¹‹å‰çš„æ•…äº‹ [3] ä»¥è·å–æ›´é«˜çº§çš„ç¤ºä¾‹ï¼š

[é«˜çº§ SQL æŠ€å·§](https://towardsdatascience.com/advanced-sql-techniques-for-beginners-211851a28488?source=post_page-----7e60575ff39c--------------------------------)

### ä» 1 åˆ° 10ï¼Œä½ çš„æ•°æ®ä»“åº“æŠ€èƒ½æœ‰å¤šå¥½ï¼Ÿ

[é«˜çº§ SQL æŠ€å·§](https://towardsdatascience.com/advanced-sql-techniques-for-beginners-211851a28488?source=post_page-----7e60575ff39c--------------------------------)

Athena å¯ä»¥é€šè¿‡è¿è¡Œæœ‰å¸å¼•åŠ›çš„å³å¸­ SQL æŸ¥è¯¢æ¥åˆ†æå­˜å‚¨åœ¨ Amazon S3 ä¸­çš„ç»“æ„åŒ–ã€éç»“æ„åŒ–å’ŒåŠç»“æ„åŒ–æ•°æ®ï¼Œæ— éœ€ç®¡ç†åŸºç¡€è®¾æ–½ã€‚

> æˆ‘ä»¬ä¸éœ€è¦åŠ è½½æ•°æ®ï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºæˆ‘ä»¬ä»»åŠ¡çš„å®Œç¾é€‰æ‹©ã€‚

å®ƒå¯ä»¥è½»æ¾åœ°ä¸ Business Intelligence (BI) è§£å†³æ–¹æ¡ˆå¦‚ QuickSight é›†æˆä»¥ç”ŸæˆæŠ¥å‘Šã€‚

ICEBERG æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨ä¸”é«˜æ•ˆçš„è¡¨æ ¼æ ¼å¼ï¼Œå¤šä¸ªç‹¬ç«‹ç¨‹åºå¯ä»¥åŒæ—¶ä¸”ä¸€è‡´åœ°å¤„ç†ç›¸åŒçš„æ•°æ®é›† [2]ã€‚æˆ‘ä¹‹å‰åœ¨è¿™é‡Œå†™è¿‡ï¼š

[ä»‹ç» Apache Iceberg è¡¨](https://towardsdatascience.com/introduction-to-apache-iceberg-tables-a791f1758009?source=post_page-----7e60575ff39c--------------------------------)

### é€‰æ‹© Apache Iceberg ä½œä¸ºæ•°æ®æ¹–çš„å‡ ä¸ªæœ‰åŠ›ç†ç”±

[ä»‹ç» Apache Iceberg è¡¨](https://towardsdatascience.com/introduction-to-apache-iceberg-tables-a791f1758009?source=post_page-----7e60575ff39c--------------------------------)

## MySQL æ•°æ®è¿æ¥å™¨

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª AWS Lambda å‡½æ•°ï¼Œå®ƒèƒ½å¤Ÿåœ¨ MySQL æ•°æ®åº“ä¸­æ‰§è¡Œ SQL æŸ¥è¯¢ã€‚

> ä»£ç éå¸¸ç®€å•ä¸”é€šç”¨ã€‚å®ƒå¯ä»¥åœ¨ä»»ä½•æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºä¸­ä¸ä»»ä½•äº‘æœåŠ¡æä¾›å•†ä¸€èµ·ä½¿ç”¨ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨å®ƒå°†æ”¶å…¥æ•°æ®æå–åˆ°æ•°æ®æ¹–ä¸­ã€‚å»ºè®®çš„ Lambda æ–‡ä»¶å¤¹ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š

[PRE1]

æˆ‘ä»¬å°†é€šè¿‡ AWS Step Functions å°†è¿™ä¸ªå°æœåŠ¡é›†æˆåˆ°ç®¡é“ä¸­ï¼Œä»¥ä¾¿äº **ç¼–æ’å’Œå¯è§†åŒ–**ã€‚

ä¸ºäº†åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿä» MySQL æ•°æ®åº“ä¸­æå–æ•°æ®çš„ Lambda å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å…ˆä¸ºæˆ‘ä»¬çš„ Lambda åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªåä¸º stack` çš„æ–°æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸º `mysql_connector` çš„æ–‡ä»¶å¤¹ï¼š

[PRE2]

ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼ˆå°†æ•°æ®åº“è¿æ¥è®¾ç½®æ›¿æ¢ä¸ºä½ çš„è®¾ç½®ï¼‰æ¥åˆ›å»º `app.py`ï¼š

[PRE3]

è¦ä½¿ç”¨ AWS CLI éƒ¨ç½²æˆ‘ä»¬çš„å¾®æœåŠ¡ï¼Œè¯·åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆå‡è®¾ä½ åœ¨ ./stack æ–‡ä»¶å¤¹ä¸­ï¼‰ï¼š

[PRE4]

ç¡®ä¿åœ¨è¿è¡Œä¸‹ä¸€éƒ¨åˆ†ä¹‹å‰ AWS Lambda è§’è‰²å·²ç»å­˜åœ¨ ` â€” role arn:aws:iam::<your-aws-account-id>:role/my-lambda-role`ã€‚

[PRE5]

æˆ‘ä»¬çš„ MySQL å®ä¾‹å¿…é¡»å…·å¤‡ **S3 é›†æˆ**ï¼Œä»¥ä¾¿ **å°†æ•°æ®å¯¼å‡ºåˆ° S3** æ¡¶ã€‚è¿™å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹ SQL æŸ¥è¯¢å®ç°ï¼š

[PRE6]

## å¦‚ä½•åˆ›å»º MySQL å®ä¾‹

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CloudFormation æ¨¡æ¿å’ŒåŸºç¡€è®¾æ–½å³ä»£ç æ¥åˆ›å»º MySQL æ•°æ®åº“ã€‚è€ƒè™‘è¿™ä¸ª AWS å‘½ä»¤ï¼š

[PRE7]

å®ƒå°†ä½¿ç”¨ `cfn_mysql.yaml` æ¨¡æ¿æ–‡ä»¶æ¥åˆ›å»ºåä¸º MySQLDB çš„ CloudFormation å †æ ˆã€‚æˆ‘ä¹‹å‰åœ¨è¿™é‡Œå†™è¿‡æœ‰å…³å®ƒçš„å†…å®¹ [4]ï¼š

[](/create-mysql-and-postgres-instances-using-aws-cloudformation-d3af3c46c22a?source=post_page-----7e60575ff39c--------------------------------) [## ä½¿ç”¨ AWS CloudFormation åˆ›å»º MySQL å’Œ Postgres å®ä¾‹

### æ•°æ®åº“ä»ä¸šäººå‘˜çš„åŸºç¡€è®¾æ–½å³ä»£ç 

towardsdatascience.com](/create-mysql-and-postgres-instances-using-aws-cloudformation-d3af3c46c22a?source=post_page-----7e60575ff39c--------------------------------)

æˆ‘ä»¬çš„ `cfn_mysql.yaml` åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š

[PRE8]

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæˆ‘ä»¬å°†çœ‹åˆ° Amazon è´¦æˆ·ä¸­å‡ºç°ä¸€ä¸ªæ–°çš„å †æ ˆï¼š

![](../Images/d6ff5754b68a1d8279412c0bb82d917b.png)

å¸¦æœ‰ MySQL å®ä¾‹çš„ CloudFormation å †æ ˆã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„æ•°æ®ç®¡é“ä¸­ä½¿ç”¨è¿™ä¸ª MySQL å®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½• SQL å·¥å…·ä¸­å°è¯•æˆ‘ä»¬çš„ SQL æŸ¥è¯¢ï¼Œä¾‹å¦‚ SQL Workbenchï¼Œä»¥å¡«å……è¡¨æ•°æ®ã€‚è¿™äº›è¡¨å°†ç”¨äºç¨åä½¿ç”¨ Athena åˆ›å»ºå¤–éƒ¨è¡¨ï¼Œå¯ä»¥é€šè¿‡ SQL åˆ›å»ºï¼š

[PRE9]

## ä½¿ç”¨ Athena å¤„ç†æ•°æ®

ç°åœ¨æˆ‘ä»¬å¸Œæœ›æ·»åŠ ä¸€ä¸ªæ•°æ®ç®¡é“å·¥ä½œæµï¼Œè¯¥å·¥ä½œæµè§¦å‘æˆ‘ä»¬çš„ Lambda å‡½æ•°ä»¥ä» MySQL æå–æ•°æ®ï¼Œå°†å…¶ä¿å­˜åˆ°æ•°æ®æ¹–ä¸­ï¼Œç„¶ååœ¨ Athena ä¸­å¼€å§‹æ•°æ®è½¬æ¢ã€‚

æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ MySQL ä¸­çš„æ•°æ®åˆ›å»ºä¸¤ä¸ªå¤–éƒ¨ Athena è¡¨ï¼š

+   myschema.users

+   myschema.transactions

ç„¶åæˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ªä¼˜åŒ–çš„ ICEBERG è¡¨ **myschema.user_transactions**ï¼Œå°†å…¶è¿æ¥åˆ°æˆ‘ä»¬çš„ BI è§£å†³æ–¹æ¡ˆã€‚

æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ MERGE è¯­å¥å°†æ–°æ•°æ®æ’å…¥åˆ°è¯¥è¡¨ä¸­ã€‚

[PRE10]

å½“æ–°è¡¨å‡†å¤‡å¥½åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œ `SELECT *` æ¥æ£€æŸ¥å®ƒï¼š

![](../Images/0067053393a777846c94f0d3acd48e90.png)

mydatabase.user_transactionsã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

## ä½¿ç”¨Step Functionsï¼ˆçŠ¶æ€æœºï¼‰ç¼–æ’æ•°æ®ç®¡é“

åœ¨ä¹‹å‰çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•åˆ†åˆ«éƒ¨ç½²æ•°æ®ç®¡é“çš„æ¯ä¸€æ­¥å¹¶è¿›è¡Œæµ‹è¯•ã€‚åœ¨è¿™ä¸€æ®µä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨åŸºç¡€è®¾æ–½ä»£ç å’Œç®¡é“ç¼–æ’å·¥å…·å¦‚AWS Step Functionsï¼ˆçŠ¶æ€æœºï¼‰åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„æ•°æ®ç®¡é“ã€‚å½“æˆ‘ä»¬å®Œæˆæ—¶ï¼Œç®¡é“å›¾å°†å¦‚ä¸‹æ‰€ç¤ºï¼š

![](../Images/3d6fa66e126398bfe0bd267f57bf7059.png)

ä½¿ç”¨Step Functionsè¿›è¡Œæ•°æ®ç®¡é“ç¼–æ’ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

æ•°æ®ç®¡é“ç¼–æ’æ˜¯ä¸€ç§å¾ˆå¥½çš„æ•°æ®å·¥ç¨‹æŠ€æœ¯ï¼Œå®ƒä¸ºæˆ‘ä»¬çš„æ•°æ®ç®¡é“å¢åŠ äº†äº’åŠ¨æ€§ã€‚è¿™ä¸ªæƒ³æ³•åœ¨æˆ‘ä¹‹å‰çš„ä¸€ç¯‡æ•…äº‹ä¸­å·²ç»è§£é‡Šè¿‡[5]ï¼š

[](/data-pipeline-orchestration-9887e1b5eb7a?source=post_page-----7e60575ff39c--------------------------------) [## æ•°æ®ç®¡é“ç¼–æ’

### æ•°æ®ç®¡é“ç®¡ç†å¾—å½“å¯ä»¥ç®€åŒ–éƒ¨ç½²å¹¶æé«˜æ•°æ®çš„å¯ç”¨æ€§å’Œå¯è®¿é—®æ€§â€¦â€¦

[towardsdatascience.com](/data-pipeline-orchestration-9887e1b5eb7a?source=post_page-----7e60575ff39c--------------------------------)

è¦éƒ¨ç½²å®Œæ•´çš„**ç¼–æ’å™¨è§£å†³æ–¹æ¡ˆ**ï¼ŒåŒ…æ‹¬æ‰€æœ‰å¿…è¦çš„èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨CloudFormationï¼ˆåŸºç¡€è®¾æ–½å³ä»£ç ï¼‰ã€‚è€ƒè™‘ä¸‹é¢è¿™ä¸ªå¯ä»¥åœ¨`/stack`æ–‡ä»¶å¤¹ä¸­ä»å‘½ä»¤è¡Œè¿è¡Œçš„è„šæœ¬ã€‚ç¡®ä¿<YOUR_S3_BUCKET>å­˜åœ¨ï¼Œå¹¶å°†å…¶æ›¿æ¢ä¸ºæ‚¨çš„å®é™…S3æ¡¶ï¼š

[PRE11]

å®ƒå°†ä½¿ç”¨stack.yamlåˆ›å»ºä¸€ä¸ªåä¸ºBatchETLpipelineçš„CloudFormationå †æ ˆã€‚å®ƒå°†æ‰“åŒ…æˆ‘ä»¬çš„Lambdaå‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å¹¶å°†å…¶ä¸Šä¼ åˆ°S3æ¡¶ä¸­ã€‚å¦‚æœè¯¥æ¡¶ä¸å­˜åœ¨ï¼Œå®ƒå°†åˆ›å»ºå®ƒã€‚ç„¶åå°†éƒ¨ç½²ç®¡é“ã€‚

[PRE12]

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæˆ‘ä»¬çš„æ–°æ•°æ®ç®¡é“çš„å †æ ˆå°†è¢«éƒ¨ç½²ï¼š

![](../Images/2b97e39b295eadfc8d179a499197fad0.png)

BatchETLpipelineå †æ ˆå’Œèµ„æºã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

å¦‚æœæˆ‘ä»¬ç‚¹å‡»çŠ¶æ€æœºèµ„æºï¼Œç„¶åç‚¹å‡»â€˜ç¼–è¾‘â€™ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æˆ‘ä»¬çš„ETLç®¡é“ä½œä¸ºå›¾å½¢å±•ç¤ºï¼š

![](../Images/cb9292383481ab8b5951980275a644a9.png)

æ‰¹é‡æ•°æ®ç®¡é“çš„å·¥ä½œæµå·¥ä½œå®¤ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥æ‰§è¡Œç®¡é“ä»¥è¿è¡Œæ‰€æœ‰å¿…è¦çš„æ•°æ®è½¬æ¢æ­¥éª¤ã€‚ç‚¹å‡»â€˜å¼€å§‹æ‰§è¡Œâ€™ã€‚

![](../Images/3d6fa66e126398bfe0bd267f57bf7059.png)

æˆåŠŸæ‰§è¡Œã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬çš„Athenaè¡¨è¿æ¥åˆ°æˆ‘ä»¬çš„**BIè§£å†³æ–¹æ¡ˆ**ã€‚è¿æ¥æˆ‘ä»¬æœ€ç»ˆçš„Athenaæ•°æ®é›†`mydataset.user_transactions`ä»¥åˆ›å»ºä»ªè¡¨ç›˜ã€‚

![](../Images/3427a98727ee0bbf52ef9d94f868f567.png)

è¿æ¥Quicksightä¸­çš„æ•°æ®é›†ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

æˆ‘ä»¬åªéœ€è°ƒæ•´å‡ ä¸ªè®¾ç½®ï¼Œä½¿æˆ‘ä»¬çš„ä»ªè¡¨ç›˜çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

![](../Images/2fc0d03bb10de92d3b88a7f4a7a3b3ed.png)

Quicksightä»ªè¡¨ç›˜ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚

æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨`dt`ä½œä¸ºç»´åº¦ï¼Œ`total_cost_usd`ä½œä¸ºæŒ‡æ ‡ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºæ¯ä¸ª`user_id`è®¾ç½®ä¸€ä¸ªæ‹†åˆ†ç»´åº¦ã€‚

## ç»“è®º

æ‰¹å¤„ç†æ•°æ®ç®¡é“å¾ˆå—æ¬¢è¿ï¼Œå› ä¸ºå†å²ä¸Šå·¥ä½œè´Ÿè½½ä¸»è¦æ˜¯æ‰¹å¤„ç†å‹çš„æ•°æ®ç¯å¢ƒã€‚æˆ‘ä»¬åˆšåˆšå»ºç«‹äº†ä¸€ä¸ª ETL æ•°æ®ç®¡é“ï¼Œä» MySQL ä¸­æå–æ•°æ®å¹¶åœ¨æ•°æ®æ¹–ä¸­è½¬æ¢ã€‚è¯¥æ¨¡å¼æœ€é€‚ç”¨äºæ•°æ®é›†ä¸å¤§ä¸”éœ€è¦æŒç»­å¤„ç†çš„æƒ…å†µï¼Œå› ä¸º Athena æ ¹æ®æ‰«æçš„æ•°æ®é‡æ”¶è´¹ã€‚è¿™ç§æ–¹æ³•åœ¨å°†æ•°æ®è½¬æ¢ä¸ºåˆ—å¼æ ¼å¼å¦‚ Parquet æˆ– ORC æ—¶è¡¨ç°è‰¯å¥½ï¼Œç»“åˆå‡ ä¸ªå°æ–‡ä»¶æˆè¾ƒå¤§çš„æ–‡ä»¶ï¼Œæˆ–è¿›è¡Œåˆ†æ¡¶å’Œæ·»åŠ åˆ†åŒºã€‚æˆ‘ä»¥å‰åœ¨æˆ‘çš„ä¸€ä¸ªæ•…äº‹ä¸­å†™è¿‡è¿™äº›å¤§æ•°æ®æ–‡ä»¶æ ¼å¼[6]ã€‚

[](/big-data-file-formats-explained-275876dc1fc9?source=post_page-----7e60575ff39c--------------------------------) [## å¤§æ•°æ®æ–‡ä»¶æ ¼å¼è§£æ

### Parquet ä¸ ORC ä¸ AVRO ä¸ JSONã€‚è¯¥é€‰æ‹©å“ªä¸€ä¸ªï¼Œå¦‚ä½•ä½¿ç”¨å®ƒä»¬ï¼Ÿ

towardsdatascience.com](/big-data-file-formats-explained-275876dc1fc9?source=post_page-----7e60575ff39c--------------------------------)

æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ Step Functions æ¥ç¼–æ’æ•°æ®ç®¡é“ï¼Œè§†è§‰åŒ–æ•°æ®æµä»æºå¤´åˆ°æœ€ç»ˆç”¨æˆ·ï¼Œå¹¶ä½¿ç”¨åŸºç¡€è®¾æ–½å³ä»£ç è¿›è¡Œéƒ¨ç½²ã€‚è¿™ä¸ªè®¾ç½®ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¯¹æ•°æ®ç®¡é“åº”ç”¨ CI/CD æŠ€æœ¯[7]ã€‚

å¸Œæœ›è¿™ä¸ªæ•™ç¨‹å¯¹ä½ æœ‰å¸®åŠ©ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚

## æ¨èé˜…è¯»

[1] [https://towardsdatascience.com/data-pipeline-design-patterns-100afa4b93e3](/data-pipeline-design-patterns-100afa4b93e3)

[2] [https://medium.com/towards-data-science/introduction-to-apache-iceberg-tables-a791f1758009](https://medium.com/towards-data-science/introduction-to-apache-iceberg-tables-a791f1758009)

[3] [https://medium.com/towards-data-science/advanced-sql-techniques-for-beginners-211851a28488](https://medium.com/towards-data-science/advanced-sql-techniques-for-beginners-211851a28488)

[4] [https://medium.com/towards-data-science/create-mysql-and-postgres-instances-using-aws-cloudformation-d3af3c46c22a](https://medium.com/towards-data-science/create-mysql-and-postgres-instances-using-aws-cloudformation-d3af3c46c22a)

[5] [https://medium.com/towards-data-science/data-pipeline-orchestration-9887e1b5eb7a](https://medium.com/towards-data-science/data-pipeline-orchestration-9887e1b5eb7a)

[6] [https://medium.com/towards-data-science/big-data-file-formats-explained-275876dc1fc9](https://medium.com/towards-data-science/big-data-file-formats-explained-275876dc1fc9)

[7] [https://medium.com/towards-data-science/continuous-integration-and-deployment-for-data-platforms-817bf1b6bed1](https://medium.com/towards-data-science/continuous-integration-and-deployment-for-data-platforms-817bf1b6bed1)
