- en: Mastering Customer Segmentation using Credit Card Transaction Data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/mastering-customer-segmentation-using-credit-card-transaction-data-dc39a8465766](https://towardsdatascience.com/mastering-customer-segmentation-using-credit-card-transaction-data-dc39a8465766)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Using RFM Scores to Build Customer Segments
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://spierre91.medium.com/?source=post_page-----dc39a8465766--------------------------------)[![Sadrach
    Pierre, Ph.D.](../Images/0e4aab43c2b981546d552beccf2259ab.png)](https://spierre91.medium.com/?source=post_page-----dc39a8465766--------------------------------)[](https://towardsdatascience.com/?source=post_page-----dc39a8465766--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----dc39a8465766--------------------------------)
    [Sadrach Pierre, Ph.D.](https://spierre91.medium.com/?source=post_page-----dc39a8465766--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----dc39a8465766--------------------------------)
    ·7 min read·Jul 6, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/34a0d2a0111e285112b79a5f8f727038.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by [Andrea Piacquadio](https://www.pexels.com/@olly/) on [Pexels](https://www.pexels.com/photo/happy-woman-shopping-online-at-home-3769747/)
  prefs: []
  type: TYPE_NORMAL
- en: Customer segmentation is the process of identifying customer segments based
    on historical purchasing patterns. For example, it can involve identifying repeat/loyal
    customers, high spending customers, customers that make one time or infrequent
    purchases and much more. Segments can be created using information like frequency
    of purchases, transaction amounts, purchase dates and more. All of these characteristics
    can be used to generate well defined clusters with easy to interpret characteristics.
  prefs: []
  type: TYPE_NORMAL
- en: The characteristics of these segments can provide a great deal of information
    and business value for companies. For example, companies can use these segments
    to increase revenue through targeted promotional messaging, customer retention
    campaigns, loyalty programs, product cross selling and more. Companies can target
    customer segments with tailored messaging that is relevant to each segment. Further,
    these segments can provide information about which channels customers are most
    responsive to, whether it’s email, social media or external applications. Companies
    can also perform upselling or cross-selling using consumer segments. For example,
    they can offer high priced options for frequently purchased items or complementary
    products to previously purchased items. All of these tactics can be used to increase
    revenue and customer retention.
  prefs: []
  type: TYPE_NORMAL
- en: There are a wide variety of techniques used for customer segmentation. One popular
    technique for generating customer segments is recency frequency and monetary value
    (RFM) scores.
  prefs: []
  type: TYPE_NORMAL
- en: Recency, Frequency and Monetary
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Recency** is the number of days between the last purchase made by a customer
    and a reference date, usually the current or max date available in the data.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Frequency** is the number of purchases between the date of their last purchase
    and the current or max date available in the data.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Monetary** is the total amount of money spent between the date of their first
    and last purchases.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can use these values to construct RFM Scores which can be used to segment
    and identify high and low value customers. These scores can be used for a wide
    variety of of business use cases included custom marketing, churn analysis, price
    optimization and more.
  prefs: []
  type: TYPE_NORMAL
- en: Here we will see how to calculate RFM scores using a credit card transaction
    dataset. For our purposes we will be working with the [Synthetic Credit Card Transaction](https://datafabrica.info/products/customer-segmentation-credit-card-transaction-data-dining-small)
    data available on [DataFabrica](http://datafabrica.info/). The data contains synthetic
    credit card transaction amounts, credit card information, transaction IDs and
    more. The [free tier](https://datafabrica.info/products/synthetic-e-commerce-data)
    is free to download, modify, and share under the [Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0).
  prefs: []
  type: TYPE_NORMAL
- en: For this work, I will be writing code in [Deepnote](https://deepnote.com/),
    which is a collaborative data science notebook that makes running reproducible
    experiments very easy.
  prefs: []
  type: TYPE_NORMAL
- en: Exploring the Data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To start, let’s navigate to Deepnote and create a new project (you can sign-up
    for free if you don’t already have an account).
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s install necessary packages:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'And import the packages we will be using:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, let’s read our data into a pandas dataframe and display the first five
    rows of data:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Next let’s filter our dataframe to only include customers that purchased Chick-fil-A:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Next we can look at the number for customers by state. To do this we need to
    map the merchant_state to state abbreviations, which will allow us to plot the
    customer counts for each state in Plotly:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Next let’s map the state abbreviations and define our state_count table. We
    do this by performing a groupby `nunique()`operation for each cardholder for each
    state:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Next we can use the Plotly Express `chloropleth` method to generate a geoplot
    of customer counts for each state:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'The full logic is:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: Generating RFM Scores
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Now let’s define the logic for creating our RFM scores. Let’s start by converting
    our `transaction_date` to a pandas datetime object and a `NOW` variable that is
    the maximum `transaction_date`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Next let’s perform a groupby aggregation operation that allows us to calculate
    recency, frequency and monetary value.
  prefs: []
  type: TYPE_NORMAL
- en: 'Recency — max overall date minus max customer date: `df.groupby(''cardholder_name'').agg({''transaction_date'':
    lambda x: (NOW — x.max()).days})`'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Frequency — number of transaction IDs for each customer: `df.groupby(''cardholder_name'').agg({transaction_id'':
    lambda x: len(x)})`'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Monetary value — sum of transaction amount for each customer: `df.groupby(''cardholder_name'').agg({transaction_amount'':
    lambda x: x.sum()})`'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'We’ll also convert `transaction_date` , which is transformed to recency, to
    an integer:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Next, let’s rename our columns appropriately.
  prefs: []
  type: TYPE_NORMAL
- en: '`transaction_date` becomes `recency`'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`transaction_id` becomes `frequency`'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`transaction_amount` become `monetary_value`'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'The full logic is:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'We can look at the distribution in recency:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Frequency:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'And monetary value:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Next we can calculate quartiles using the Pandas `qcut` method for recency,
    frequency and monetary value:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'Next we can visualize recency/frequency heatmap, where each cell displays the
    percentage of customers with the corresponding recency and frequency values. First
    let’s calculate the percentages:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'Next let’s generate our heatmap matrix:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'Generate the map and label/title our heatmap using Seaborn and Matplotlib:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'The full logic is:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'We can see the following insights from our heatmap:'
  prefs: []
  type: TYPE_NORMAL
- en: 16.21% of customers purchased recently but infrequently.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 3.45% of customers are frequent and recent customers.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 10% of customers purchased frequently but not for a long time.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 5.86% of our customer haven’t purchased recently and don’t purchase frequently.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We are only considering the single merchant Chick-fil-A, but I encourage you
    to repeat this analysis for some of the other casual and fine dining merchants.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next we can generate our RFM Scores by concatenating the quartiles in recency,
    frequency and monetary value:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'And we can visualize the distribution in our RFM scores:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: Here we see that the most common RFM score is ‘411’ which corresponds to a recent
    customer who spends infrequently and very little.
  prefs: []
  type: TYPE_NORMAL
- en: Generating and Visualizing Customer Segments using RFM scores
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Next we can generate our customer segments. This step is a bit subjective,
    but we define out segments as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Premium Customer: r, f, and m all ≥ 3'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Repeat Customer: f >= 3 and r or m >=3'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Top Spender: m >= 3 and f or r >=3'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'At-Risk Customer: two or more of r,f and m <=2'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Inactive Customer: two or more = 1'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Other: anything else'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'Next we can see the distribution in segments:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: Here we see that the largest customer segment is inactive customers, followed
    by at-risk, top spenders, repeat customers and premium customers.
  prefs: []
  type: TYPE_NORMAL
- en: 'And visualize the distribution as well:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: 'We can also look at the average monetary value for each customer segment:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: We see that the average monetary value is highest for premium customers repeat
    customers, and top spenders. Further, inactive and at-risk customer have low monetary
    values.
  prefs: []
  type: TYPE_NORMAL
- en: 'The average frequency value for each customer segment:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: We see that premium customers, repeat customers, and top spenders are the most
    frequency while at-risk and inactive customers have low frequency.
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally average recency value for each customer segment:'
  prefs: []
  type: TYPE_NORMAL
- en: Embedding Created by Author
  prefs: []
  type: TYPE_NORMAL
- en: We see that the ‘other’ category have the most recent purchases. This This may
    be a good segment for “new” customers whose purchasing patterns are inconclusive.
  prefs: []
  type: TYPE_NORMAL
- en: Using Customer Segments for Custom Marketing
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You can use these customer segments to generate customized/personalized marketing
    messages relevant to each segment. For example, you can reward premium customers
    with special promotions and loyalty deals. You can also promote other products
    that they may be interested in purchasing based on their purchase history. For
    repeat/loyal customers you can develop automated email campaigns to keep their
    loyalty. At-risk customers are typically disengaged. We can develop campaigns
    based on these customer to reengage them and get them to start purchasing again.
    A similar campaign can be developed for inactive customers. Finally, for top spenders
    we can offer special promotions and deals on highly price products that they are
    likely to purchase again.
  prefs: []
  type: TYPE_NORMAL
- en: Using this data, we can take our analysis a step further and use `items` and
    `prices` fields to craft these customized marketing campaigns for these segments.
  prefs: []
  type: TYPE_NORMAL
- en: I encourage you to download the code from [GitHub](https://github.com/spierre91/medium_code/blob/master/datafabrica/rfm_scoring.ipynb)
    and repeat this analysis on your own for some other restaurant merchants.
  prefs: []
  type: TYPE_NORMAL
- en: Conclusions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Here we discussed how to perform customer segmentation on synthetic credit card
    transaction data. We started by performing some simple data exploration where
    we looked at the count of customers in each state for the merchant Chick-fil-A.
    Next we calculated the columns needed for generating RFM scores, recency, frequency
    and monetary value. We then showed how to generate quartiles in recency, frequency
    and monetary value for each customer, which we then used to construct RFM scores.
    We then used the RFM score to generate customer segments “Premium Customer”, “Repeat
    Customer”, “Top Spender”, “At-risk Customer” and “Inactive Customer”. Next we
    generated some visualizations that allowed us to analyze the distribution in customer
    segments across the data.
  prefs: []
  type: TYPE_NORMAL
- en: Using RFM scores to generate insightful customer segments is an invaluable skill
    for any data scientist that wants to deliver business values. Constructing interpretable
    segments and pulling insights from these segments can help businesses design marketing
    campaign strategies that can increase revenue and customer retention. Understanding
    the purchasing behavior of customers allows businesses to tailor promotional offers
    to appropriate customer bases. This article provides the fundamentals needed to
    get started!
  prefs: []
  type: TYPE_NORMAL
- en: The free version of the synthetic credit card data is [here](https://datafabrica.info/products/synthetic-e-commerce-data).
    The full data set can be found [here](https://datafabrica.info/products/customer-segmentation-credit-card-transaction-data-dining-small).
  prefs: []
  type: TYPE_NORMAL
