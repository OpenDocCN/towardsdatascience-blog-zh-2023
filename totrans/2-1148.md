# 如何使用Python和Matplotlib创建美国数据地图

> 原文：[https://towardsdatascience.com/how-to-create-data-maps-of-the-united-states-with-python-and-matplotlib-5dfb425bd87d](https://towardsdatascience.com/how-to-create-data-maps-of-the-united-states-with-python-and-matplotlib-5dfb425bd87d)

## Matplotlib教程

## 创建引人注目的地图

[](https://medium.com/@oscarleo?source=post_page-----5dfb425bd87d--------------------------------)[![Oscar Leo](../Images/7733c9147bad2875a35155fca3903aa8.png)](https://medium.com/@oscarleo?source=post_page-----5dfb425bd87d--------------------------------)[](https://towardsdatascience.com/?source=post_page-----5dfb425bd87d--------------------------------)[![数据科学前沿](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----5dfb425bd87d--------------------------------) [Oscar Leo](https://medium.com/@oscarleo?source=post_page-----5dfb425bd87d--------------------------------)

·发布于[数据科学前沿](https://towardsdatascience.com/?source=post_page-----5dfb425bd87d--------------------------------) ·7分钟阅读·2023年9月7日

--

![](../Images/1c56f212ab80ea66082213e3c6beb392.png)

地图由作者创建

你好，欢迎来到这个教程。

今天，我将教你如何使用地理数据和Facebook连通性指数（这两个数据源都是公共领域且免费使用）来创建上面看到的数据可视化。

像这样的地图非常适合可视化地理信息，如果选择合适的颜色，它们会立即吸引任何人的注意。

典型的使用场景是通过经济规模、人口或其他指标如全球地图上的寿命来比较国家（或美国各州）。

这些地图通常会揭示出基于地理位置的模式，这是其他可视化中看不到的。

如果这听起来很有趣，你来对地方了。

让我们开始教程吧。

## 步骤1：下载数据

在开始之前，我们需要下载一个足够精彩的数据集和地理数据，以绘制准确的美国地图。

对于地图，我使用了来自[Cencus.gov](https://www.census.gov/)的形状文件。你可以使用以下链接下载[州](https://www2.census.gov/geo/tiger/GENZ2018/shp/cb_2018_us_state_500k.zip)和[县](https://www2.census.gov/geo/tiger/GENZ2018/shp/cb_2018_us_county_500k.zip)。

为了获得补充数据集，我选择了Facebook连通性指数，该指数测量了不同县之间的两个人在Facebook上的连接可能性。

你可以通过[这个链接](https://data.humdata.org/dataset/e9988552-74e4-4ff4-943f-c782ac8bca87/resource/c59fd5ac-0458-4e83-b6be-5334f0ea9a69/download/us-counties-us-counties-fb-social-connectedness-index-october-2021.zip)下载连通性数据。

下载完成后，解压文件并放在一个合适的位置。我在教程中使用的是`./data`，但你可以根据自己的需要进行设置。

它应该是这样的。

![](../Images/6486f1c60e1955e7406d0c1ef2f94260.png)

作者截屏

让我们写一些代码。

## 第二步：导入库并准备 Seaborn

唯一的新库（如果你做过我的其他[Matplotlib教程](https://medium.com/@oscarleo/list/matplotlib-tutorials-262e5d7f0847)）是 `geopandas`，我们将用它来绘制地图。

[PRE0]

接下来，让我们使用 `seaborn` 定义一些样式特征。

[PRE1]

现在是学习如何绘制地图的时候了。

## 第三步：加载和准备地理数据

我使用 `geopandas` 加载数据并删除“未合并领土”，例如关岛、波多黎各和美属萨摩亚。

[PRE2]

`geopandas` 数据框有一个 `geometry` 列，用于定义每一行的形状。它允许我们通过调用 `counties.plot()` 或 `states.plot()` 来绘制地图。

[PRE3]

在这里，我开始绘制具有透明边框的县，然后在调用 `states.plot()` 时重用 `ax`，以避免绘制多个地图。

这是我得到的结果。

![](../Images/64a41d918eed9ca9b992c7e6ddd092cb.png)

地图由作者创建

地图看起来不太好，但我会做一些快速调整，让我们走上正确的轨道。

第一个调整是将地图投影更改为以美国为中心的投影。你可以通过调用 `to_crs()` 来实现。

[PRE4]

这是不同之处。

![](../Images/dc357875cc33f965eb0aed35e91a69b4.png)

地图由作者创建

在绘制美国的数据地图时，通常会将阿拉斯加和夏威夷放在大陆下方，我们也会这样做。

使用 `geopandas`，你可以通过内置函数进行几何形状的平移、缩放和旋转。这里有一个有用的函数来完成这项任务。

[PRE5]

我计算整个数据框的中心点，定义旋转和缩放的原点。如果不这样做，`geopandas` 会自动为每一行处理，这会使地图看起来完全混乱。

下一个函数处理我们当前的数据框，分离夏威夷和阿拉斯加，调用 `translate_geometries()` 来调整它们的几何形状，并将其放回新的数据框中。

[PRE6]

我们将 `adjust_maps()` 添加到我们的代码中。

[PRE7]

现在我们的地图看起来是这样的。

![](../Images/1e701cffb432e56cbc90bfb9867e68ac.png)

地图由作者创建

进入下一步。

## 第四步：添加数据

要添加数据，我们首先加载 Facebook 连接数据。我将 `user_loc` 和 `fr_loc` 列转换为字符串，并添加前导零，以使其与地理数据一致。

[PRE8]

`user_loc` 和 `fr_loc` 列定义了一个县对，第三列 `scaled_sci` 是我们要显示的值。

数据集中有3,227个县，这意味着总共有10,413,529对，但我们将逐个显示每个县的连接指数。

[PRE9]

接下来，我定义一个 `selected_color` 和 `data_breaks`，其中包含百分位数、颜色和后续使用的图例文本。

[PRE10]

以下函数使用 `county_df` 和我们刚刚定义的 `data_breaks` 来定义每一行的颜色。

[PRE11]

我们计算出正确的值并像这样添加`create_color()`。

[PRE12]

这是我们得到的结果。

![](../Images/51091bf62add6210d4f9ab6752b4d09e.png)

地图由作者创建

这看起来很棒，但我们需要添加一些信息。

## 第5步：添加信息

我们需要的第一条信息是一个标题，用来解释数据可视化的内容。

这是一个执行此任务的函数。

[PRE13]

接下来，我们需要一个图例和解释数据的辅助信息，因为它有点复杂。

用于添加图例的函数使用`data_breaks`和`selected_color`来创建`Patch(es)`，然后我们通过`plt.legend()`添加这些补丁。

[PRE14]

我还有一个简单的函数可以在图例下方添加一些额外的信息。

[PRE15]

最后，我有一个`add_circle()`函数，通过在县周围画一个圆圈来指示我们正在查看哪个县。

[PRE16]

我们将所有这些内容添加到`# Create data map`注释下方的其余代码中。

[PRE17]

这是完成的数据显示。

![](../Images/1c56f212ab80ea66082213e3c6beb392.png)

地图由作者创建

恭喜，你现在知道如何在Matplotlib中创建美国的精彩数据地图！ :)

## 结论

数据地图在你想以引人注目的方式可视化地理信息时非常棒。

这一次，我们使用了来自Facebook的社会联系指数，但你可以将其更改为任何其他带有地理信息的数据。

我在我的新免费通讯中，写了更多关于可视化和数据集的内容，[数据奇迹](https://datawonder.substack.com/p/investigating-the-facebook-connectivity)。

如果你喜欢这个教程，确保也查看一下我的其他教程。

![奥斯卡·莱奥](../Images/a3badd168c6bfbbdc3d060f9191ca1d2.png)

[奥斯卡·莱奥](https://medium.com/@oscarleo?source=post_page-----5dfb425bd87d--------------------------------)

## Matplotlib教程

[查看列表](https://medium.com/@oscarleo/list/matplotlib-tutorials-262e5d7f0847?source=post_page-----5dfb425bd87d--------------------------------)8个故事![](../Images/51b77b8f6d7ea69abdcd113427d4a52a.png)![](../Images/56c078b5447338a07b7bce2b23cf7133.png)![](../Images/c3088ee7cd4994f027ddddbc6ae423cd.png)

下次见。
