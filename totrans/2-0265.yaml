- en: Advanced Time-Series Anomaly Detection with Deep Learning in PowerBI
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/advanced-time-series-anomaly-detection-with-deep-learning-in-powerbi-4a69c0273357](https://towardsdatascience.com/advanced-time-series-anomaly-detection-with-deep-learning-in-powerbi-4a69c0273357)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: How a complex and cutting-edge approach, creatively borrowed from computer vision,
    can be implemented in just a few clicks.
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://thomasdorfer.medium.com/?source=post_page-----4a69c0273357--------------------------------)[![Thomas
    A Dorfer](../Images/9258a1735cee805f1d9b02e2adf01096.png)](https://thomasdorfer.medium.com/?source=post_page-----4a69c0273357--------------------------------)[](https://towardsdatascience.com/?source=post_page-----4a69c0273357--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----4a69c0273357--------------------------------)
    [Thomas A Dorfer](https://thomasdorfer.medium.com/?source=post_page-----4a69c0273357--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----4a69c0273357--------------------------------)
    ·6 min read·Apr 6, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d0d781202fa190fba231248030d12944.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by the Author.
  prefs: []
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: With an ever-increasing number of applications and services deployed worldwide,
    time-series anomaly detection has become a ubiquitous and indispensable tool for
    capturing metric regressions.
  prefs: []
  type: TYPE_NORMAL
- en: However, setting up an anomaly detection system is certainly not straightforward
    and often requires a fair amount of domain expertise. In PowerBI, the set-up can
    be done in just a few clicks, enabling the implementation of a state-of-the-art
    anomaly detection system in no time.
  prefs: []
  type: TYPE_NORMAL
- en: This article will describe the innovative algorithm behind PowerBI’s anomaly
    detection functionality and provide a step-by-step approach on how it can be implemented
    and configured.
  prefs: []
  type: TYPE_NORMAL
- en: 'The algorithm: SR-CNN'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Under the hood of PowerBI’s anomaly detection functionality lies a mechanism
    that combines the spectral residual (SR) algorithm with a convolutional neural
    network (CNN) — hence its name, SR-CNN. A lot of big words here, I know. So let’s
    unpack.
  prefs: []
  type: TYPE_NORMAL
- en: Inspired by computer vision, the authors of this [methodology](https://arxiv.org/abs/1906.03821)
    borrowed the SR algorithm from the [visual saliency detection](https://paperswithcode.com/task/saliency-detection#:~:text=Saliency%20Detection%20is%20a%20preprocessing,Theoretic%20Approach%20to%20Saliency%20Detection)
    domain. The motivation behind this was a shared belief that visual saliency detection
    and time-series anomaly detection are quite similar, as anomalies are generally
    salient in the visual perspective.
  prefs: []
  type: TYPE_NORMAL
- en: But what exactly is visual saliency? It can be described as the degree to which
    certain features in an image, such as contrast or edges, stand out and attract
    the attention of the human visual system. Below is an image that illustrates this
    concept.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/69fa65fac01f28fc74b229784f5649cf.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Left: Photo by [Musa Haef](https://unsplash.com/@musahaef) on [Unsplash](https://unsplash.com/photos/toaX1dyZjcA).
    Right: Spectral residual, computed by the Author.'
  prefs: []
  type: TYPE_NORMAL
- en: As expected, the most salient areas of the image on the left are the cars’ brake
    lights — they immediately stand out to us and are quickly registered by our visual
    system. This is also reflected in the SR saliency map on the right.
  prefs: []
  type: TYPE_NORMAL
- en: 'Briefly, the SR algorithm works as follows: (1) the Fourier Transform is used
    to obtain the log amplitude spectrum, (2) the SR is then calculated by subtracting
    the log amplitude spectrum from the averaged log amplitude spectrum, and (3) the
    Inverse Fourier Transform is applied to transform the sequence back to its spatial
    domain. The mathematical details are beyond the scope of this article, but can
    be found in the original [paper](https://arxiv.org/abs/1906.03821).'
  prefs: []
  type: TYPE_NORMAL
- en: What we have just applied in the visual domain can also be applied in the time-series
    domain. Using [sample data](https://github.com/microsoft/powerbi-desktop-samples/blob/main/Monthly%20Desktop%20Blog%20Samples/2020/2020SU09%20Blog%20Demo%20-%20September.pbix)
    made available by Microsoft, we can implement the SR algorithm and transform the
    original time-series data into its corresponding saliency map.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/9977583beea58a69dfe0978af673c258.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Image by the Author. License information for data usage: [MIT License](https://github.com/microsoft/powerbi-desktop-samples/blob/main/LICENSE).'
  prefs: []
  type: TYPE_NORMAL
- en: The bottom graph, showing the SR-based saliency map, highlights the anomalous
    spike more clearly and makes it easier for us and — more importantly — for the
    anomaly detection algorithm to capture it.
  prefs: []
  type: TYPE_NORMAL
- en: Now on to the deep learning part of SR-CNN. A CNN is applied directly on the
    results of the SR model. More specifically, the authors trained a discriminative
    model on synthetic data, which was generated by introducing anomalous data points
    to a collection of saliency maps. The use of saliency maps here alleviates the
    problem of the lack of labeled data, which would otherwise be required if the
    CNN were to be trained on raw inputs.
  prefs: []
  type: TYPE_NORMAL
- en: The composition of the CNN includes two 1-D convolutional layers and two fully
    connected layers, which are stacked before the sigmoid output. The authors used
    cross entropy loss and the [SGD](https://en.wikipedia.org/wiki/Stochastic_gradient_descent)
    optimizer during the training process.
  prefs: []
  type: TYPE_NORMAL
- en: Using F1-score, precision, and recall, experimental results have shown that
    this approach mostly outperforms other unsupervised, state-of-the-art baselines
    such as [FFT](https://www.springerprofessional.de/en/fourier-transform-based-spatial-outlier-mining/3201890),
    [Twitter-AD](https://www.usenix.org/system/files/conference/hotcloud14/hotcloud14-vallis.pdf),
    [Luminol](https://github.com/linkedin/luminol), [DONUT](https://arxiv.org/abs/1802.03903),
    [SPOT, and DSPOT](https://www.kdd.org/kdd2017/papers/view/anomaly-detection-in-streams-with-extreme-value-theory).
  prefs: []
  type: TYPE_NORMAL
- en: Implementation in PowerBI
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Here comes the simplest part. While the algorithm behind this anomaly detection
    method is rather sophisticated, its implementation really isn’t. Let’s take a
    look at the individual steps you need to take in order to apply this method in
    PowerBI, illustrated with examples:'
  prefs: []
  type: TYPE_NORMAL
- en: '***Step 1:*** Load your time-series data into PowerBI.'
  prefs: []
  type: TYPE_NORMAL
- en: '***Step 2:*** Create a *Line Chart* containing your time-series and make sure
    the X-axis type is set to *continuous*.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/9230815010680b46ac367d5cf79721fa.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by the Author.
  prefs: []
  type: TYPE_NORMAL
- en: '***Step 3:*** In the *Visualizations* pane, navigate to *Add further analyses
    to your visual* and switch on *Find anomalies*.'
  prefs: []
  type: TYPE_NORMAL
- en: '***Step 4:*** Under *Options*, fine-tune the main parameter: *Sensitivity*.
    The higher this parameter, the narrower the range of minimum and maximum expected
    values and thus the higher the number of data points that will be outside of this
    range and, as a result, flagged as anomalies.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Example with *sensitivity* set to 80%:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/dff6635537396862467030eeb0a402a2.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by the Author.
  prefs: []
  type: TYPE_NORMAL
- en: 'Example with *sensitivity* set to 98%:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6ef28588958c0dc01c99a83c3e1c9527.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by the Author.
  prefs: []
  type: TYPE_NORMAL
- en: PowerBI also gives you the option to customize the color, marker, and size of
    the anomalous points as well as the color, style, and transparency of the expected
    range.
  prefs: []
  type: TYPE_NORMAL
- en: On top of just anomaly detection, PowerBI also provides possible explanations
    on why these regressions may have occurred. These are accompanied by a *strength*
    measure, which shows the degree to which a value is correlated with the anomaly.
    This information can be retrieved by simply clicking on the anomaly in the line
    chart.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d4f8eb9ef30c0d41bdaeb773b6c28251.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by the Author.
  prefs: []
  type: TYPE_NORMAL
- en: If we click on the first and strongest explanation, *‘Purchase Size’ is $30
    — $40*, we can see a strong correlation with revenue on the date when the anomaly
    occurred, which may have contributed to this sudden spike.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/477eaaaba3a8509c7fc5150f48285c3b.png)'
  prefs: []
  type: TYPE_IMG
- en: Screenshot by the Author.
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'This article demonstrates how a rather sophisticated time-series anomaly detection
    algorithm, inspired by computer vision, can easily and quickly be implemented
    and customized in PowerBI in just a few clicks. Through a number of layers of
    abstraction, this method requires the fine-tuning of only one single, intuitive
    parameter: *sensitivity*. Lastly, the user can extract explanatory information
    on the anomalies detected by simply clicking on the anomalous data points in the
    line chart, which provides guidance on the potential root-cause of these unexpected
    spikes.'
  prefs: []
  type: TYPE_NORMAL
- en: 'More Resources:'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*Blog:* [Anomaly detection tutorial — Power BI | Microsoft Learn](https://learn.microsoft.com/en-us/power-bi/visuals/power-bi-visualization-anomaly-detection)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Algorithm:* [Overview of SR-CNN algorithm in Azure Anomaly Detector — Microsoft
    Community Hub](https://techcommunity.microsoft.com/t5/ai-customer-engineering-team/overview-of-sr-cnn-algorithm-in-azure-anomaly-detector/ba-p/982798)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Paper:* [Time-Series Anomaly Detection Service at Microsoft (arxiv.org)](https://arxiv.org/pdf/1906.03821.pdf)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Liked this article?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Let’s connect! You can find me on [Twitter](https://twitter.com/ThomasADorfer),
    [LinkedIn](https://www.linkedin.com/in/thomasdorfer/) and [Substack](https://thomasdorfer.substack.com/).
  prefs: []
  type: TYPE_NORMAL
- en: If you like to support my writing, you can do so through a [Medium Membership](https://thomasdorfer.medium.com/membership),
    which provides you access to all my stories as well as those of thousands of other
    writers on Medium.
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/@thomasdorfer/membership?source=post_page-----4a69c0273357--------------------------------)
    [## Join Medium with my referral link - Thomas A Dorfer'
  prefs: []
  type: TYPE_NORMAL
- en: Read every story from Thomas A Dorfer (and thousands of other writers on Medium).
    Your membership fee directly supports…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: medium.com](https://medium.com/@thomasdorfer/membership?source=post_page-----4a69c0273357--------------------------------)
  prefs: []
  type: TYPE_NORMAL
