- en: How To Analyse Your Time Series Model Using Residuals
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/how-to-analyse-your-time-series-model-using-residuals-f980f597332e](https://towardsdatascience.com/how-to-analyse-your-time-series-model-using-residuals-f980f597332e)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Learn how you can use the residuals of a forecasting model to improve its performance
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@egorhowell?source=post_page-----f980f597332e--------------------------------)[![Egor
    Howell](../Images/1f796e828f1625440467d01dcc3e40cd.png)](https://medium.com/@egorhowell?source=post_page-----f980f597332e--------------------------------)[](https://towardsdatascience.com/?source=post_page-----f980f597332e--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----f980f597332e--------------------------------)
    [Egor Howell](https://medium.com/@egorhowell?source=post_page-----f980f597332e--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----f980f597332e--------------------------------)
    ·5 min read·Jan 3, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1b43c40b3df3d4128f518ab3b0f3669f.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [regularguy.eth](https://unsplash.com/@moneyphotos?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: Background
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Being able to analyse your time series model is essential to diagnose its performance.
    One such way to do this is through the residuals of the fitted model. In this
    post, we will go over what residuals are and how they can be used to improve your
    model along with an example in Python.
  prefs: []
  type: TYPE_NORMAL
- en: Supplemental Video.
  prefs: []
  type: TYPE_NORMAL
- en: What Are Residuals?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In time series analysis, residuals, ***r***, are the difference between the
    *fitted values*, ***ŷ***,and the *actual values*, ***y***:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/327097209e99f18cfa4b70641abb412c.png)'
  prefs: []
  type: TYPE_IMG
- en: Equation generated by author in LaTeX.
  prefs: []
  type: TYPE_NORMAL
- en: It is important to state the difference between [residuals](https://en.wikipedia.org/wiki/Residual_(numerical_analysis))
    and [errors](https://en.wikipedia.org/wiki/Forecast_error). The error is the difference
    between the *actual* and *forecasted* values. However, the residuals, as shown
    above, are the difference from the *actual* the *fitted values.* These *fitted
    values* are the predictions the model made to the training data whilst fitting
    to it. As the model knows the values of all observations, it is no longer technically
    a forecast but rather a *fitted value*.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you want to learn more about forecast errors and their metrics, checkout
    my previous post on the topic here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](/an-overview-of-forecasting-performance-metrics-ef548dad0134?source=post_page-----f980f597332e--------------------------------)
    [## An Overview Of Forecasting Performance Metrics'
  prefs: []
  type: TYPE_NORMAL
- en: An overview of some of the fundamental performance metrics for time series forecasting
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/an-overview-of-forecasting-performance-metrics-ef548dad0134?source=post_page-----f980f597332e--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Residual Analysis
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We can use the residuals to analyse how well our model has captured the characteristics
    of the data. In general, the residuals should:'
  prefs: []
  type: TYPE_NORMAL
- en: Show very little or **no** [*autocorrelation*](https://www.youtube.com/watch?v=4VmfTaoomWk&t=23s)or
    [*partial autocorrelation*](https://medium.com/towards-data-science/partial-autocorrelation-for-time-series-481a9cfa7526)*.*
    If they have any form of correlation, then the model has **missed some information**
    that’s in the data. We can use the [*Ljung–Box*](https://en.wikipedia.org/wiki/Ljung%E2%80%93Box_test)statistical
    test and a [*correlogram*](https://en.wikipedia.org/wiki/Correlogram) to determine
    if the residuals are indeed correlated.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The mean of the residuals should be **zero**, otherwise the forecast will be
    **biased**. In reality, this is quite easy to adjust for by simply adding or subtracting
    the bias from the forecasts.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For some context, the [null hypothesis](https://en.wikipedia.org/wiki/P-value)
    of the Ljung–Box test assumes that the residuals are not correlated. Therefore,
    we want to fail to reject the null hypothesis and the [p-values](https://en.wikipedia.org/wiki/P-value)
    to be greater than 5%.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Let’s now do some residual analysis in Python!
  prefs: []
  type: TYPE_NORMAL
- en: Residual Analysis In Python
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Fitting a Holt Winters’ Model
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'For this short walkthrough, we will fit the *exponential smoothing Holt Winters’*
    model to the famous US airline passenger dataset. If you want to learn more about
    how the Holt Winters’ model works, make sure to read my previous blog about it
    here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](/time-series-forecasting-with-holt-winters-b78ffc322f24?source=post_page-----f980f597332e--------------------------------)
    [## Time Series Forecasting with Holt Winters’'
  prefs: []
  type: TYPE_NORMAL
- en: A discussion and implementation of the most powerful and useful exponential
    smoothing model
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/time-series-forecasting-with-holt-winters-b78ffc322f24?source=post_page-----f980f597332e--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Data [from Kaggle](https://www.kaggle.com/datasets/ashfakyeafi/air-passenger-data-for-time-series-analysis)
    with a CC0 licence.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: GitHub Gist by author.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/eae71268a248260ba3c44bb2a0cdd9c9.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot generated by author in Python.
  prefs: []
  type: TYPE_NORMAL
- en: 'The forecast from this model looks pretty good. Let’s analyse the residuals
    by first inserting the *actuals*, *fitted values* and *residuals* into the training
    dataset:'
  prefs: []
  type: TYPE_NORMAL
- en: GitHub Gist by author.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ffa01c3dd43e7433917ae7c23289e258.png)'
  prefs: []
  type: TYPE_IMG
- en: Image generated by author in Python.
  prefs: []
  type: TYPE_NORMAL
- en: As we can see, the residuals are indeed the difference between the *actual values*
    (*#Passengers*) and *fitted values* as declared earlier.
  prefs: []
  type: TYPE_NORMAL
- en: Residual Correlation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The correlation of the residuals can be computed by plotting their [autocorrelation](https://www.youtube.com/watch?v=GcJ__g_cimA)
    and [partialautocorrelation](https://www.youtube.com/watch?v=4VmfTaoomWk&t=23s)functions:'
  prefs: []
  type: TYPE_NORMAL
- en: GitHub Gist by author.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b265087d12ea5f0e855e1bc55b0c8438.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot generated by author in LaTeX.
  prefs: []
  type: TYPE_NORMAL
- en: Majority of the correlations are within the **non-statistically significant**
    blue region, which would signify that the residuals are **not correlated**. However,
    you may notice that there is some recurring pattern in the correlations. This
    would convey that there is some seasonal component that the model may have not
    fully accounted for.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you want to learn more about autocorrelation and partial autocorrelation,
    refer to my previous posts on them here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](/autocorrelation-for-time-series-analysis-86e68e631f77?source=post_page-----f980f597332e--------------------------------)
    [## Autocorrelation For Time Series Analysis'
  prefs: []
  type: TYPE_NORMAL
- en: Describing what autocorrelation is and why it is useful in time series analysis.
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/autocorrelation-for-time-series-analysis-86e68e631f77?source=post_page-----f980f597332e--------------------------------)
    [](/partial-autocorrelation-for-time-series-481a9cfa7526?source=post_page-----f980f597332e--------------------------------)
    [## Partial Autocorrelation for Time Series Analysis
  prefs: []
  type: TYPE_NORMAL
- en: Describing what partial autocorrelation is and its importance in time series
    analysis
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/partial-autocorrelation-for-time-series-481a9cfa7526?source=post_page-----f980f597332e--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Ljung-Box Test
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'A more quantitive way to determine if the residuals are correlated is to carry
    out the [*Ljung–Box*](https://en.wikipedia.org/wiki/Ljung%E2%80%93Box_test)statistical
    test:'
  prefs: []
  type: TYPE_NORMAL
- en: GitHub Gist by author.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e64f4f176b43b0edc758f3b68e4b8bca.png)'
  prefs: []
  type: TYPE_IMG
- en: Image generated in Python by author.
  prefs: []
  type: TYPE_NORMAL
- en: This shows the p-values of the first **10** lags. They are all below the [*significance
    level*](https://statisticsbyjim.com/glossary/significance-level/) of **0.05**,
    therefore we **reject the null hypothesis of no autocorrelation**. Thus, **there
    is correlation present** in our residuals that we need to revisit when re-fitting
    the model.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you want to learn more about statistical tests and p-values, I recommend
    reading my previous article on them:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](/z-test-simply-explained-80b346e0e239?source=post_page-----f980f597332e--------------------------------)
    [## Z-Test Simply Explained'
  prefs: []
  type: TYPE_NORMAL
- en: An intuitive explanation of the Z- Test for statistical hypothesis testing
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/z-test-simply-explained-80b346e0e239?source=post_page-----f980f597332e--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Histogram of Residuals
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'A [histogram](https://en.wikipedia.org/wiki/Histogram) of the residuals will
    determine if they have a **mean of zero** and are **symmetric** (no bias):'
  prefs: []
  type: TYPE_NORMAL
- en: GitHub Gist by author.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7ccdc8978274989043c398524913c680.png)'
  prefs: []
  type: TYPE_IMG
- en: Plot generated by author in Python.
  prefs: []
  type: TYPE_NORMAL
- en: In this case the residuals are **mostly distributed around zero** with a mean
    of `-0.023`and maybe even slightly negatively biased. This suggests that we probably
    don’t need to provide an offset for the computed forecasts.
  prefs: []
  type: TYPE_NORMAL
- en: Summary and Further Thoughts
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this post we have demonstrated how to diagnose your time series forecasting
    model using its residuals. The two key indicators that tell you that the model
    is a good fit is that the residuals have no or very little correlation and their
    mean is around zero.
  prefs: []
  type: TYPE_NORMAL
- en: 'Full code used in this blog is available at my GitHub here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://github.com/egorhowell/Medium-Articles/blob/main/Time%20Series/Time%20Series%20Tools/residual_analysis.py?source=post_page-----f980f597332e--------------------------------)
    [## Medium-Articles/residual_analysis.py at main · egorhowell/Medium-Articles'
  prefs: []
  type: TYPE_NORMAL
- en: Code I use in my medium blog/articles. Contribute to egorhowell/Medium-Articles
    development by creating an account on…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: github.com](https://github.com/egorhowell/Medium-Articles/blob/main/Time%20Series/Time%20Series%20Tools/residual_analysis.py?source=post_page-----f980f597332e--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Another Thing!
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: I have a free newsletter, [**Dishing the Data**](https://dishingthedata.substack.com/),
    where I share weekly tips for becoming a better Data Scientist. There is no “fluff”
    or “clickbait,” just pure actionable insights from a practicing Data Scientist.
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://newsletter.egorhowell.com/?source=post_page-----f980f597332e--------------------------------)
    [## Dishing The Data | Egor Howell | Substack'
  prefs: []
  type: TYPE_NORMAL
- en: How To Become A Better Data Scientist. Click to read Dishing The Data, by Egor
    Howell, a Substack publication with…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: newsletter.egorhowell.com](https://newsletter.egorhowell.com/?source=post_page-----f980f597332e--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Connect With Me!
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[**YouTube**](https://www.youtube.com/@egorhowell?sub_confirmation=1)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[**LinkedIn**](https://www.linkedin.com/in/egor-howell-092a721b3/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[**Twitter**](https://twitter.com/EgorHowell)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[**GitHub**](https://github.com/egorhowell)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: References and Further Reading
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '*Forecasting: Principles and Practice:* [https://otexts.com/fpp2/](https://otexts.com/fpp3/accuracy.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://www.statology.org/ljung-box-test-python/](https://www.statology.org/ljung-box-test-python/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
