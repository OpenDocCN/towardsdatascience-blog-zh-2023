- en: How to Make an AI Image Editing Chatbot
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/how-to-make-an-ai-image-editing-chatbot-1ddd0209884](https://towardsdatascience.com/how-to-make-an-ai-image-editing-chatbot-1ddd0209884)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Stable Diffusion InstructPix2Pix in a Panel app
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://sophiamyang.medium.com/?source=post_page-----1ddd0209884--------------------------------)[![Sophia
    Yang, Ph.D.](../Images/c133f918245ea4857dc46df3a07fc2b1.png)](https://sophiamyang.medium.com/?source=post_page-----1ddd0209884--------------------------------)[](https://towardsdatascience.com/?source=post_page-----1ddd0209884--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----1ddd0209884--------------------------------)
    [Sophia Yang, Ph.D.](https://sophiamyang.medium.com/?source=post_page-----1ddd0209884--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----1ddd0209884--------------------------------)
    ·5 min read·Feb 1, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: By [Sophia Yang](https://www.linkedin.com/in/sophiamyang/) and [Philipp Rudiger](https://www.linkedin.com/in/philippjfr/)
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/db30c85206b60e6a4cd227dfd3a9bd32.png)'
  prefs: []
  type: TYPE_IMG
- en: Example of image edits using InstructPix2Pix. (Original picture by [Pietro De
    Grandi](https://unsplash.com/@peter_mc_greats?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/images/nature/mountain?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText))
  prefs: []
  type: TYPE_NORMAL
- en: InstructPix2Pix, a conditional diffusion model, combines a language model GPT-3
    and a text-to-image model Stable Diffusion to perform image edits based on user
    prompts. Inspired by the [InstructPix2Pix project](https://github.com/timothybrooks/instruct-pix2pix)
    and [several](https://huggingface.co/spaces/ysharma/InstructPix2Pix_Chatbot) [apps](https://huggingface.co/timbrooks/instruct-pix2pix)
    hosted on HuggingFace, we are interested in making an AI image editing chatbot
    in Panel. Panel is a Python dashboarding tool that allows us to build this chatbot
    with just a few lines of code.
  prefs: []
  type: TYPE_NORMAL
- en: 'Check out the live app on Hugging Face space: [https://huggingface.co/spaces/sophiamyang/Panel_InstructPix2Pix](https://huggingface.co/spaces/sophiamyang/Panel_InstructPix2Pix)
    (we will only keep it live for a few days. GPUs are expensive!!!).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'In this article, we will show you step-by-step how to make this chatbot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/cec2d3b15a9f00e555cfa6980791b089.png)'
  prefs: []
  type: TYPE_IMG
- en: Stable Diffusion InstructPix2Pix chatbot in a Panel app
  prefs: []
  type: TYPE_NORMAL
- en: '**Set up Python via Anaconda**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Since we are making a Python app, we will first need to install Python. Downloading
    [Anaconda](http://anaconda.com) is the easiest and recommended way to get your
    Python and the Conda environment management set up.
  prefs: []
  type: TYPE_NORMAL
- en: Then you will need to create a new environment (optional but recommended) and
    install the needed packages for this project.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '**Start Jupyter Notebook**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Next, we can start a Jupyter notebook (type `jupyter notebook` in your command
    line) and import the needed packages in our notebook:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '**Use the InstructPix2Pix model API**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[This Hugging Face page](https://huggingface.co/docs/diffusers/main/en/api/pipelines/stable_diffusion/pix2pix)
    details how to use the InstructPix2Pix model API. We need to define the model
    ID of the InstructPix2Pix model and get the pre-trained model from the StableDiffusionInstructPix2PixPipeline.
    Note that it’s recommended to run this model on a GPU.'
  prefs: []
  type: TYPE_NORMAL
- en: In our Panel app, we use this pre-trained model directly. We create a helper
    function `normaize_image` to normalize our input image size and channels, and
    then we created a function `new_image` to create a new image based on the prompt,
    the original image, and some advanced feature settings.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '**Create a Panel app**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '***Step1: Define panel widgets***'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To make this app, we will need the following widgets:'
  prefs: []
  type: TYPE_NORMAL
- en: A file input widget to load the image `file_input`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A text input widget to allow users to type in the prompt `prompt`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Three slider widgets to control the feature settings: `img_guidance`, `guidance`,
    `steps`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A button widget to show the run button for running the app `run_button`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We then organize all widgets into a `Panel` object: `widgets`.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/19e845da1dd2c0e0a67d8dcc818ae7e9.png)'
  prefs: []
  type: TYPE_IMG
- en: widgets
  prefs: []
  type: TYPE_NORMAL
- en: '***Step 2: Define all the conversations in a function***'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'This is probably the most important step. In this step, we defined a function
    called `get_conversations` with the following features:'
  prefs: []
  type: TYPE_NORMAL
- en: Every time we load a new file, we save the new image and get it ready for editing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We normalize the images to RGB channels and to make sure they are the same size.
    This is especially helpful when the image size is too large. You will likely get
    an out-of-memory error if you feed in a large image to the model.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If there is a prompt, we generate new images.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: All the prompts and images are appended in the `convos` list and shown in a
    Panel object.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '***Step 3: bind widgets to functions***'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You may wonder: when does the `get_conversations`get run? It’s when we click
    the run button or change any of the widgets. To achieve this, we “bind” the function
    with the widgets to make the function reactive to the changes of the widgets:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '***Step4: define the layout***'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Finally, we organized the widgets and the conversation in a reasonable-looking
    layout that we use `pn.Column` to arrange multiple panel objects in a vertical
    container. Feel free to try different layouts :)
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '**Step 5: serve the app**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Now you have all the code ready for your app, we can start serving your app.
    To serve it locally, run `panel serve app.py` (assuming your file is called app.py).
    We have also served our app on Hugging Face: [https://huggingface.co/spaces/sophiamyang/Panel_InstructPix2Pix](https://huggingface.co/spaces/sophiamyang/Panel_InstructPix2Pix).
    Note that we will only keep it live for a few days. GPUs are expensive!!!'
  prefs: []
  type: TYPE_NORMAL
- en: '**Complete Code**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can find the complete code here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://huggingface.co/spaces/sophiamyang/Panel_InstructPix2Pix/blob/main/app.py](https://huggingface.co/spaces/sophiamyang/Panel_InstructPix2Pix/blob/main/app.py)'
  prefs: []
  type: TYPE_NORMAL
- en: '**Where can you learn more about Panel?**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Check out our previous blog post on [3 ways to build a Panel visualization dashboard](/3-ways-to-build-a-panel-visualization-dashboard-6e14148f529d?sk=2cd93ae39586305bae8cfaead2bf7bb4).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Check out the official documentation: holoviz.org, panel.holoviz.org, and hvplot.holoviz.org.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Check out [https://awesome-panel.org/](https://awesome-panel.org/) for inspiration.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you have questions or want to connect to other Panel users, check out [https://discourse.holoviz.org/.](https://discourse.holoviz.org/.)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Conclusion**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this article, we demonstrated how to build an AI image editing chatbot in
    Panel. Using the pre-trained InstructPix2Pix model, our chatbot is empowered with
    amazing image editing capabilities based on user prompt. Give it a try and let
    us know what you think!
  prefs: []
  type: TYPE_NORMAL
- en: 'Acknowledgment:'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Thank you [Jim Bednar](https://www.linkedin.com/in/james-bednar-7602911b/) for
    your guidance and support!
  prefs: []
  type: TYPE_NORMAL
- en: 'References:'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[https://www.timothybrooks.com/instruct-pix2pix/](https://www.timothybrooks.com/instruct-pix2pix/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://huggingface.co/spaces/ysharma/InstructPix2Pix_Chatbot](https://huggingface.co/spaces/ysharma/InstructPix2Pix_Chatbot)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://huggingface.co/timbrooks/instruct-pix2pix](https://huggingface.co/timbrooks/instruct-pix2pix)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://github.com/timothybrooks/instruct-pix2pix](https://github.com/timothybrooks/instruct-pix2pix)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://twitter.com/yvrjsharma/status/1617265318619148288](https://twitter.com/yvrjsharma/status/1617265318619148288)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: . . .
  prefs: []
  type: TYPE_NORMAL
- en: By [Sophia Yang](https://www.linkedin.com/in/sophiamyang/) and [Philipp Rudiger](https://www.linkedin.com/in/philippjfr/)
    on January 31, 2023
  prefs: []
  type: TYPE_NORMAL
- en: Sophia Yang is a Senior Data Scientist at Anaconda. Connect with me on [LinkedIn](https://www.linkedin.com/in/sophiamyang/),
    [Twitter](https://twitter.com/sophiamyang), and [YouTube](https://www.youtube.com/SophiaYangDS)
    and join the DS/ML [Book Club](https://dsbookclub.github.io/) ❤️
  prefs: []
  type: TYPE_NORMAL
