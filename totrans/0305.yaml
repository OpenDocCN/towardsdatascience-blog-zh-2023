- en: Analyzing FC Barcelona’s Defense From a Data Science Perspective
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/analyzing-fc-barcelonas-defense-from-a-data-science-perspective-76797018b0b3](https://towardsdatascience.com/analyzing-fc-barcelonas-defense-from-a-data-science-perspective-76797018b0b3)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Sports Analytics
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A visual data comparison to illustrate Barça’s defense flaws
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://polmarin.medium.com/?source=post_page-----76797018b0b3--------------------------------)[![Pol
    Marin](../Images/a4f69a96717d453db9791f27b8f85e86.png)](https://polmarin.medium.com/?source=post_page-----76797018b0b3--------------------------------)[](https://towardsdatascience.com/?source=post_page-----76797018b0b3--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----76797018b0b3--------------------------------)
    [Pol Marin](https://polmarin.medium.com/?source=post_page-----76797018b0b3--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----76797018b0b3--------------------------------)
    ·13 min read·Aug 10, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/41dccd6550cdb8ac77bbb2c55df7110e.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Alessio Patron](https://unsplash.com/@alessiop?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: Intro
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A few days ago I posted my first sports analytics post. Feeling totally attracted
    to the topic still, here I am again writing about football.
  prefs: []
  type: TYPE_NORMAL
- en: In that post — linked below — I used frequentist stats to demonstrate the randomness
    of goal events. But I took it further. The random model explained there — influenced
    by the Poisson distribution — is applicable in many other fields unrelated to
    football.
  prefs: []
  type: TYPE_NORMAL
- en: '[](/how-random-are-goals-in-soccer-8a822c1f3bc?source=post_page-----76797018b0b3--------------------------------)
    [## How Random Are Goals in Soccer?'
  prefs: []
  type: TYPE_NORMAL
- en: Understand goal events through frequentist statistics
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/how-random-are-goals-in-soccer-8a822c1f3bc?source=post_page-----76797018b0b3--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Today we’ll move one step forward and, even though it will be football-centered,
    the process and knowledge we’ll be going through will be relevant for any data
    scientist.
  prefs: []
  type: TYPE_NORMAL
- en: Football-wise, we’ll focus on defense and try to analyze Barça’s to see where
    it could have gone better, both on a team and individual level.
  prefs: []
  type: TYPE_NORMAL
- en: As defense is a broad term — it includes tackles, saves, blocks, and many other
    advanced stats — I’ll be more concrete and focus solely on shots and goals conceded.
  prefs: []
  type: TYPE_NORMAL
- en: In the 2015–16 La Liga, Barça was the second team to concede fewer goals (29),
    right after Atlético (18). Even though that’s not bad at all, there’s still room
    for improvement.
  prefs: []
  type: TYPE_NORMAL
- en: The goal is not to provide solutions, that’s the coaching staff’s work. Our
    goal today as data scientists or sports analysts is to find the problems and hypothesize
    so that the staff can take this info and solve the problems on the pitch.
  prefs: []
  type: TYPE_NORMAL
- en: 'So here’s a brief summary of what we’re going to go through today:'
  prefs: []
  type: TYPE_NORMAL
- en: Background and Context.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Get the data, transform, and prepare it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Analyze shots against and goals conceded by FCB.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go even deeper by checking shoots and goals conceded on a player level.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: As **all the code will be available on my GitHub repo** [1], linked in the resources
    section, I will be skipping some of it here to avoid having big code snippets
    distracting readers from the content itself.
  prefs: []
  type: TYPE_NORMAL
- en: Context
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: No data science problem can be solved if we don’t have the context. We need
    to deeply understand the data we’re working with. If not, we cannot draw useful
    conclusions.
  prefs: []
  type: TYPE_NORMAL
- en: '**The data needs a context to become information**.'
  prefs: []
  type: TYPE_NORMAL
- en: So let us go back in time. The 2015–16 La Liga campaign was an interesting one.
    F.C. Barcelona won with 91 points followed by Real Madrid just one point behind
    (90) and Atlético de Madrid with 88.
  prefs: []
  type: TYPE_NORMAL
- en: The last match day was going to determine it all. But all three won their respective
    games so the standings didn’t change. Barça won the title.
  prefs: []
  type: TYPE_NORMAL
- en: In that season, Barça went on to win La Copa del Rey and the UEFA Super Cup
    too but failed miserably in the Champions League and Supercopa de España. In the
    first one, they got eliminated by Atlético de Madrid in the quarter-finals, and
    in the second one, they lost by an aggregate 5–1 against Athletic Club.
  prefs: []
  type: TYPE_NORMAL
- en: Clearly, Barça’s defense had issues. In that La Liga campaign, they got scored
    11 times more than Atlético de Madrid (that’s a 61% increase). It looks like the
    MSN offensive (Messi-Suarez-Neymar) compensated, in most games, the team’s defense.
  prefs: []
  type: TYPE_NORMAL
- en: But miracles don’t exist.
  prefs: []
  type: TYPE_NORMAL
- en: The 4 usual defensive starters were Alves, Piqué, Mascherano, and Alba. These
    were world-class defenders, but they obviously didn’t play all minutes. Substitutes
    were Mathieu, Roberto, Adriano, Bartra, Vermaelen… The level dropped quite a bit
    if we looked at the bench.
  prefs: []
  type: TYPE_NORMAL
- en: Can we blame the substitutes? Maybe not. Let me point out that both Alves and
    Alba were pretty offensive full-backs… Did that make their team concede more shots
    or goals?
  prefs: []
  type: TYPE_NORMAL
- en: Our task today is to analyze the defense and see if we can find any potential
    flaws.
  prefs: []
  type: TYPE_NORMAL
- en: Get the Data, Transform and Prepare It
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: No real-world raw data will ever be cleaned and prepared to be used by a data
    scientist. Most of the time — or code — will be used to treat the dataset and
    transform it to obtain the exact data we need for our project.
  prefs: []
  type: TYPE_NORMAL
- en: For today’s purposes, we’ll be using StatsBomb’s free open data [2] for this
    post. And we’ll also be using the `statsbombpy`[3] module to tinker with it.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can just install it by running:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'And we’re going to be using a few more modules that you might need to also
    install if you haven’t already. Then, import them:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'We’re now ready to retrieve the data. As we need to inspect shots and goals
    against FCB in 2015–16, we first need to get all the matches from that competition
    and season:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, for each match, we can easily retrieve its events by using:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'So we extracted all events from all Barça’s matches and created a data frame
    containing all the events: `all_events`. We also created two additional columns
    because they would be useful for the latter part of the analysis:'
  prefs: []
  type: TYPE_NORMAL
- en: 'One called `minutes`, which had the same value for all rows within the same
    match: its duration.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The other one is called `time`, which wasn’t more than the concatenation of
    the values in the columns `minute` and `second`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Finally, the `all_events` data frame got filtered to keep only shots made by
    the opponent team. The result:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/0e17b88695b306d01130a3685a78208a.png)'
  prefs: []
  type: TYPE_IMG
- en: Top-5 rows in shots_against_team DF — image by the author
  prefs: []
  type: TYPE_NORMAL
- en: StatsBomb’s data is amazing. Complete and accurate. What’s useful for us today
    is the location where the shot happened, outlined by the columns `x` and `y`.
    So we can use that to visualize them.
  prefs: []
  type: TYPE_NORMAL
- en: Analyze shots and goals conceded by FCB
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Once we have all the data we need, we can start our analysis. As usual, plotting
    is the first thing I do because it’s the best way to understand the data we’re
    working with.
  prefs: []
  type: TYPE_NORMAL
- en: 'We’ll be using the `VerticalPitch` class from the `mplsoccer`[4] module to
    show where shots and goals come from:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: This simple code allows us to plot half of a football pitch and place the shots
    in red, with varying transparency depending on whether it was a goal or not. Additionally,
    I added two extra dots for the average shot and goal positions (green and blue,
    respectively).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/146828c9999edceb09707f6c77e6affc.png)'
  prefs: []
  type: TYPE_IMG
- en: Shots and goals conceded by FCB throughout 2015–16 La Liga — image by the author
  prefs: []
  type: TYPE_NORMAL
- en: Both averages are quite centered (a little bit deviated towards the left) and
    goal positions are closer to the goal than the shots average. It will come as
    no surprise that, the closer the shot, the easier it is to score.
  prefs: []
  type: TYPE_NORMAL
- en: 'Moving on to the shots, there’s just one thing we cannot avoid looking at:
    when outside the penalty area, shots seem to come more from the right side (though
    it’s pretty even). But inside the area, shots are clearly skewed to the left.'
  prefs: []
  type: TYPE_NORMAL
- en: That’s Alves and Piqué’s side.
  prefs: []
  type: TYPE_NORMAL
- en: If we focus on goals, the ones from the left side are more spread while the
    ones on the right half of the plot look more centered or clustered.
  prefs: []
  type: TYPE_NORMAL
- en: The code snippet below is used to create a shot heatmap. If we apply the same
    to goals, we get the heatmap used to better illustrate the shots and goals distribution
    across different areas of the pitch.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'And if we plot both heatmaps, we get:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8c2f103ea88f042e3f240902e9e4f176.png)'
  prefs: []
  type: TYPE_IMG
- en: Shots and goals against FCB in 2015–16 La Liga — image by the author
  prefs: []
  type: TYPE_NORMAL
- en: Now, obviously, most shots and goals come from the center and the closest part
    of the goal. Once the ball is there, only shooting makes sense.
  prefs: []
  type: TYPE_NORMAL
- en: The shot heatmap is almost perfectly symmetric, that’s because we split it into
    5 bins or columns. If we had chosen more, we’d probably see the left skewness
    better.
  prefs: []
  type: TYPE_NORMAL
- en: But we can appreciate it in the goal heatmap. Barça conceded more goals from
    the Alves-Piqué’s side than from Mascherano-Alba’s.
  prefs: []
  type: TYPE_NORMAL
- en: When analyzing a team’s defense, several things matter. The ultimate goal is
    to see where they failed and how we can reduce the number of goals conceded. A
    team can do it in many ways, but reducing the number of shots conceded is clearly
    a way to mitigate the number of goals you receive.
  prefs: []
  type: TYPE_NORMAL
- en: However, we haven’t linked shots to goals yet today. And we’re going to do so
    by building a new **KPI**, today's first one.
  prefs: []
  type: TYPE_NORMAL
- en: '**Key Performance Indicators**, or KPIs, are extremely important in any data
    science or analysis project. Selecting the proper KPIs will let us assess and
    properly evaluate the strategies we’re using, while doing the opposite — selecting
    inaccurate ones — will result in useless and misleading analyses.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Our first KPI today will be the **goal-per-shot ratio**, as a way to inspect
    where rivals have more chances of scoring when shooting:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'Below is this new statistic plotted in a heatmap:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/825a2eb385c37d50712a2654cb5442ef.png)'
  prefs: []
  type: TYPE_IMG
- en: Goals per shot ratio against FCB — image by the author
  prefs: []
  type: TYPE_NORMAL
- en: We can clearly see the left skewness we previously mentioned. When the other
    team shot from Alves and Piqué’s side, within the penalty area, the chance of
    conceding a goal was almost twice the probability of conceding from Mascherano
    and Alba’s side.
  prefs: []
  type: TYPE_NORMAL
- en: That doesn’t mean Piqué was worse than Mascherano, I certainly don’t think so.
    We’re just saying that shooting from the left side led to more goals than shooting
    from the right side.
  prefs: []
  type: TYPE_NORMAL
- en: Going deeper — Analyzing players
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: I feel like we’ve been blaming Piqué and Alves and we haven’t even compared
    their individual numbers yet. For that reason, we’re going to go deeper here and
    analyze the players’ individual performances, again, in terms of shots and goals
    conceded.
  prefs: []
  type: TYPE_NORMAL
- en: What if the cause of that lack of symmetry was caused by bench players substituting
    these world-class starters when tired or injured? What if, on an individual level,
    their performance in terms of shots and goals was the same?
  prefs: []
  type: TYPE_NORMAL
- en: That’s what we’re going to analyze now, but we first need to prepare the data.
    We need to know how many minutes a player played in each game, how many goals
    the team conceded when they were on the pitch…
  prefs: []
  type: TYPE_NORMAL
- en: 'We’ll use `statsbombpy`‘s lineups to get that, combined with the previous events
    data frame we already built:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: We’re just adding some new useful columns and using a custom function — `parse_position()`
    — to parse the number of minutes that player was on the pitch during that match
    (accounting for extra added time as well).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/29d97f59dd2089ceb62afe1f111feac4.png)'
  prefs: []
  type: TYPE_IMG
- en: Top 5 rows of the all_lineups data frame — image by the author
  prefs: []
  type: TYPE_NORMAL
- en: Now we can move on and count the number of shots and goals the team received
    when each player was on the pitch.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'This is how the new columns look on the `all_lineups` data frame:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/834ebf063905f3da311e725d1c740bd3.png)'
  prefs: []
  type: TYPE_IMG
- en: Shots and goals conceded by player in each match — Image by the author
  prefs: []
  type: TYPE_NORMAL
- en: This is useful because it allows us to see how the team performed in each game
    when certain players were on the pitch. Let’s take it further.
  prefs: []
  type: TYPE_NORMAL
- en: 'Apart from the KPI we created in the previous section, we’re now going to generate
    two new KPIs:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Shots per minute**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Goals per minute**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'If we remove those players whose average played minutes per game is below 10
    minutes and sort the data frame by the `shots_per_minute` variable, here’s what
    we get:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8df9c3d77817e464a3809e831a87753f.png)'
  prefs: []
  type: TYPE_IMG
- en: Dataframe showing player stats related to goals and shots conceded — Image by
    the author
  prefs: []
  type: TYPE_NORMAL
- en: 'This couldn’t be more clear. 5 of the top 6 rows were bench defensive players:
    Bartra, Adriano, Mathieu, Roberto, and Vermaelen. This is crazy.'
  prefs: []
  type: TYPE_NORMAL
- en: No wonder why Luis Enrique preferred Piqué, Mascherano, Alves, and Alba.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d8522015cd88444edee18cb33a18767c.png)'
  prefs: []
  type: TYPE_IMG
- en: Shots and goals per 90 minutes played — image by the author
  prefs: []
  type: TYPE_NORMAL
- en: Translated to shots per 90 minutes, when Bartra played the team would receive
    an average of 11.31 shots per match. Compare that to the 8.51 shots per 90 minutes
    when Mascherano played.
  prefs: []
  type: TYPE_NORMAL
- en: When it comes to goals per 90 minutes, we still have Mathieu, Adriano, and Roberto
    within the top least-performing 6\. Clearly not efficient.
  prefs: []
  type: TYPE_NORMAL
- en: We also see Piqué there, and this explains the left skewness we saw on the heatmaps.
  prefs: []
  type: TYPE_NORMAL
- en: 'But let’s put that into a team context. Let’s see the team ratios:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'This is relevant:'
  prefs: []
  type: TYPE_NORMAL
- en: All players from the left plot except Vermaelen conceded more shots per match
    than the team’s average. In other words, these 5 players really **underperformed
    defensively**. Being most of them defensive, that means that the team’s defense
    struggled when they were on the pitch. Luckily, that increase in shots didn’t
    directly translate into goals.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If we look at the right plot, all 6 are above the team’s average. The team conceded
    more goals when they were on the pitch. This time, half of them are bench defensive
    players.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Conclusions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: All data science projects need their takeaways. It’s probably the most important
    part — drawing insights and sharing them with the stakeholders is the reason why
    the previous analysis and research are done.
  prefs: []
  type: TYPE_NORMAL
- en: 'In our football case, here’s how we could end this analysis and share them
    with Luis Enrique, that season’s coach:'
  prefs: []
  type: TYPE_NORMAL
- en: As a team, we ended up with the second-best defense that season. Not bad, but
    pretty far from the best one (by an 11-goal difference). We conceded more goals
    than we’d desired, and the best way to reduce that number is by reducing the number
    of shots Barça let their rivals shoot.
  prefs: []
  type: TYPE_NORMAL
- en: If we focus on those shots and goals, the dangerous ones (within the penalty
    area) seemed to be skewed toward Piqué’s side. We’re not blaming him, we’d need
    to see why this happens.
  prefs: []
  type: TYPE_NORMAL
- en: A more in-depth analysis proved that, if we should blame someone, it wouldn’t
    be the starter defensive players. When on the pitch, the rivals shot less. Whether
    that translates to fewer goals or not depends on several factors, but the correlation
    exists.
  prefs: []
  type: TYPE_NORMAL
- en: It’s in fact when players like Vermaelen, Mathieu, Bartra, Adriano, and/or Roberto
    played that the team received the biggest amount of shots and goals per minute
    played. So the focus should be, in my opinion, to find better defensive options
    to support the defensive core built by Alves, Piqué, Mascherano, and Alba, or
    make the existing ones improve their performances.
  prefs: []
  type: TYPE_NORMAL
- en: Piqué and Mascherano led the defense most of the time and that helped Barça
    win the trophies they won. But, even if Piqué was the best defender in terms of
    shots conceded, when rivals shoot they had higher chances of scoring compared
    to Mascherano. Causality or casualty, we’ll never know (I’d choose the second
    one).
  prefs: []
  type: TYPE_NORMAL
- en: 'If you’re curious about what happened during 2016’s transfer window: Adriano,
    Bartra, and Vermaelen left the club. Mathieu stayed for one more season but his
    participation dropped quite a bit, playing only in 16 games throughout all the
    competitions: he was basically the last option.'
  prefs: []
  type: TYPE_NORMAL
- en: Roberto was the only one that remained and kept on having a good amount of minutes.
  prefs: []
  type: TYPE_NORMAL
- en: That summer, Barça also tried to reinforce their squad by signing Umititi and
    Digne — if they only knew how that would end...
  prefs: []
  type: TYPE_NORMAL
- en: 'So, in a way, today’s analysis isn’t new to FCB: they already performed it
    at the end of the 2015–16 season and saw the same problems we saw in their defense.
    Somehow, they weren’t able to sign enough quality players to improve their situation
    and didn’t win next season’s La Liga.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: Resources
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[1] [FCB Defense Analysis Repo — GitHub](https://github.com/polmarin/fcb_defense_analysis)'
  prefs: []
  type: TYPE_NORMAL
- en: '[2] [StatsBomb’s License — GitHub](https://github.com/statsbomb/statsbombpy/blob/master/doc/LICENSE.pdf)'
  prefs: []
  type: TYPE_NORMAL
- en: '[3] [statsbombpy — GitHub](https://github.com/statsbomb/statsbombpy)'
  prefs: []
  type: TYPE_NORMAL
- en: '[4] [mplsoccer — Readthedocs.io](https://mplsoccer.readthedocs.io/en/latest/index.html)'
  prefs: []
  type: TYPE_NORMAL
