# 使用 dtreeviz 创建令人惊叹的决策树可视化

> 原文：[https://towardsdatascience.com/creating-incredible-decision-tree-visualizations-with-dtreeviz-820c6547b6a9](https://towardsdatascience.com/creating-incredible-decision-tree-visualizations-with-dtreeviz-820c6547b6a9)

## 如何使用这个有用的库可视化决策树模型

[](https://amolmavuduru.medium.com/?source=post_page-----820c6547b6a9--------------------------------)[![Amol Mavuduru](../Images/56b4ae74cac10dd7c70d41d9192ce181.png)](https://amolmavuduru.medium.com/?source=post_page-----820c6547b6a9--------------------------------)[](https://towardsdatascience.com/?source=post_page-----820c6547b6a9--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----820c6547b6a9--------------------------------) [Amol Mavuduru](https://amolmavuduru.medium.com/?source=post_page-----820c6547b6a9--------------------------------)

·发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----820c6547b6a9--------------------------------) ·阅读时长 6 分钟·2023年6月21日

--

![](../Images/18a9ad0cc89c82cf3b9dbf37c38220eb.png)

图片由作者提供，使用 dtreeviz 创建。

在模型可解释性方面，决策树是一些最直观和可解释的模型。每个决策树模型都可以解释为一组人类可解释的规则。能够可视化决策树模型对于模型的可解释性非常重要，并且可以帮助利益相关者和业务经理对这些模型建立信任。

幸运的是，我们可以使用 dtreeviz 库轻松地可视化和解释决策树。**在本文中，我将演示如何使用 dtreeviz 可视化用于回归和分类的基于树的模型。**

# 安装 dtreeviz

你可以使用以下命令通过 pip 轻松安装 dtreeviz：

[PRE0]

有关依赖项和可能需要安装的额外库的详细列表，请参阅 [这个 GitHub 仓库](https://github.com/parrt/dtreeviz)。

# 可视化回归树

在本节中，我们将对 [糖尿病数据集](https://archive.ics.uci.edu/dataset/34/diabetes) 训练一个决策树回归器。请注意，你可以在这个 GitHub 仓库中找到本教程的所有代码。请记住，我使用 Jupyter 作为运行 Python 代码的环境。你可以在 [这个 GitHub 仓库](https://github.com/AmolMavuduru/DtreevizTutorial) 中找到我为本教程编写的所有代码。

## 导入库

在下面的代码块中，我简单地导入了包括 scikit-learn 决策树模块和 dtreeviz 在内的几个常用库。

[PRE1]

## 读取数据

糖尿病数据集可在 scikit-learn 中获取，因此我们可以使用以下代码导入数据集，并将特征和目标值存储在名为 X 和 y 的 numpy 数组中。

[PRE2]

## 训练决策树模型

为了使树更容易可视化，我们可以限制决策树的最大深度，并按如下方式对数据进行训练。

[PRE3]

## 可视化树

dtreeviz的一个关键特点是能够可视化决策树模型。使用下面的代码，我们可以创建一个有趣的决策树可视化，并在每个节点处视觉上描绘决策边界。

[PRE4]

![](../Images/18a9ad0cc89c82cf3b9dbf37c38220eb.png)

糖尿病回归树可视化。图像由作者使用dtreeviz创建。

注意上面的可视化还给出了每个节点的决策边界和特征空间，以及每个叶节点的回归输出和样本大小。

## 可视化叶节点分布

dtreeviz提供的另一个有用功能是可视化叶节点分布。决策树的叶节点包含根据每组条件预测的实际值。使用**rtree_leaf_distributions**函数，我们可以为回归树创建这种可视化。

[PRE5]

![](../Images/daebc012eb2585e5d913c79b55553331.png)

根据上面的可视化，我们可以看到决策树可以预测268.9、208.6、176.9、137.7、154.7、274.0、83.4或108.8作为糖尿病这一目标变量的值。水平分散的点表示糖尿病目标变量值的分布，小黑线表示用于预测该叶节点的平均值。理想情况下，叶节点的分布应具有低方差，以便我们对用于预测的平均值有更高的信心。

## 可视化叶节点大小

我们还可以可视化叶节点的大小，即每个叶节点的样本数量，如下面的函数所示。

[PRE6]

![](../Images/f32fe2672f34390c9e1df196a810e50a.png)

根据上面的图，我们可以看到每个叶节点的样本数量。这种可视化是评估我们对回归树预测的信心的良好工具。

# 可视化分类树

我们还可以使用dtreeviz可视化分类树，且这些可视化与回归树创建的效果略有不同。在本节中，我们将使用[乳腺癌威斯康星数据集](https://www.kaggle.com/datasets/uciml/breast-cancer-wisconsin-data)来训练和可视化决策模型。

## 读取数据

乳腺癌威斯康星数据集在scikit-learn中可用，因此我们可以使用下面的代码加载它。

[PRE7]

## 训练决策树模型

如往常一样，使用scikit-learn训练决策树模型是简单明了的。我们还可以对最大树深度施加约束，以便更容易可视化决策树。

[PRE8]

## 可视化决策树

我们可以使用回归树部分的完全相同的函数来可视化分类树。不过，可视化效果会略有不同。

[PRE9]

![](../Images/a299a34aa24357fefcc2b7ca5359227f.png)

癌症分类决策树。

注意，以上的分类树可视化与上一节的回归树可视化不同。我们看到的不是每个节点处选定特征和目标的散点图，而是显示每个节点处类别分布的彩色直方图。

## 可视化叶子分布

我们还可以使用相同的函数可视化回归树的叶子分布的类别分布。

[PRE10]

![](../Images/512e690dc395fc3a347a655f2ffecc8e.png)

分类树的叶子分布图。图像由作者使用 dtreeviz 创建。

每个叶子都有一个堆叠条形图，展示了该叶子中样本的类别标签分布。大多数叶子中的样本明显属于一个类别，这很好，有助于我们对模型的预测建立信心。

## 可视化特征空间

我们还可以使用以下函数可视化分类器的特征空间。

[PRE11]

![](../Images/6da07c58667b04d62bcf16c1707b9adb.png)

上面的特征空间图展示了分类树的训练准确率，以及两个特征的散点图和可以用来区分两个类别的线性决策边界。

# 摘要

当涉及到可视化基于树的模型时，dtreeviz 是一个强大的库，提供了几个有用的可视化函数。我只介绍了这个库中提供的部分函数，还有许多其他功能，你可以在 [dtreeviz GitHub 仓库](https://github.com/parrt/dtreeviz) 中阅读。像往常一样，你可以在 [我的 GitHub](https://github.com/AmolMavuduru/DtreevizTutorial) 上找到这篇文章的所有代码。

# 加入我的邮件列表

加入我的 [邮件列表](https://mailchi.mp/e8dd82679724/amols-data-science-blog) 来获取关于数据科学内容的更新。当你 [注册](https://mailchi.mp/e8dd82679724/amols-data-science-blog) 时，你还会获得我的免费**逐步解决机器学习问题指南**！你也可以在 [Twitter](https://twitter.com/amolmavuduru1) 上关注我，获取内容更新。

在此过程中，考虑 [加入 Medium 社区](https://amolmavuduru.medium.com/membership)，阅读成千上万其他作者的文章。

# 来源

1.  Terence Parr, [dtreeviz: 决策树可视化](https://github.com/parrt/dtreeviz), (2023), GitHub。
