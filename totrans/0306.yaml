- en: Analyzing Geospatial Data with Python
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/analyzing-geospatial-data-with-python-7244c1b9e302](https://towardsdatascience.com/analyzing-geospatial-data-with-python-7244c1b9e302)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: A practical data analysis post with Python code.
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://gustavorsantos.medium.com/?source=post_page-----7244c1b9e302--------------------------------)[![Gustavo
    Santos](../Images/a19a9f4525cdeb6e7a76cd05246aa622.png)](https://gustavorsantos.medium.com/?source=post_page-----7244c1b9e302--------------------------------)[](https://towardsdatascience.com/?source=post_page-----7244c1b9e302--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----7244c1b9e302--------------------------------)
    [Gustavo Santos](https://gustavorsantos.medium.com/?source=post_page-----7244c1b9e302--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----7244c1b9e302--------------------------------)
    ·8 min read·Aug 19, 2023
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Geospatial Data Science is one of my areas of interest. I find it fascinating
    how we can visualize data on a map and how — many times — the relationships between
    the data points present great insights real quickly.
  prefs: []
  type: TYPE_NORMAL
- en: I believe the applicability of this sub area of data science is pretty useful
    for any business, namely grocery stores, car rentals, logistics, real estate *etc.*
    In this post, we will go over a dataset from *AirBnb* for the city of Asheville,
    NC, in USA.
  prefs: []
  type: TYPE_NORMAL
- en: 'Side note: In that city lies one of the most amazing real estates in America,
    — *and I would dare to say in the world*. The property pertains to the Vanderbilt
    family and, during a long time, it was the largest private property in the country.
    Well, it is so worth a [visit](/www.biltmore.com), but that’s not the core subject
    here.'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/bd00be96cce8bdcd4578ea74975fb8ad.png)'
  prefs: []
  type: TYPE_IMG
- en: Biltmore estate building in Ashville, NC. Photo by [Stephanie Klepacki](https://unsplash.com/@sklepacki?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/60IeQ4lmDGs?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText).
  prefs: []
  type: TYPE_NORMAL
- en: The datasets to be used in this exercise are the AirBnb rentals for the city
    of Asheville. They can be downloaded directly from this web site in [http://insideairbnb.com/get-the-data](http://insideairbnb.com/get-the-data),
    under the [Creative Commons Attribution 4.0 International License](http://creativecommons.org/licenses/by/4.0/).
  prefs: []
  type: TYPE_NORMAL
- en: Let’s get to work.
  prefs: []
  type: TYPE_NORMAL
- en: Geospatial Data Science
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The knowledge from this post is mostly from the book referred below (Applied
    Geospatial Data Science with Python, by David S. JORDAN). So let’s begin importing
    some modules to our session.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Now notice that some of them might be new for you, as they are for me as well.
    If needed, use `pip install module_name` to install any package needed. In my
    case, `pysal` and `geoplot` are new to me, so they had to be installed.
  prefs: []
  type: TYPE_NORMAL
- en: Next, we will read the data from AirBnb.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/30da60e4caf9a9a65a89dd66d58eaed7.png)'
  prefs: []
  type: TYPE_IMG
- en: Listings from AirBnb for Asheville, NC. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: if we code `listings.info()` , we will see that the `price` variable is as object.
    That is because of the dollar sign `$` mark before the numbers. Something easily
    corrected in Python.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Exploratory Analysis
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now we can check the stats for that variable.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Interesting. Average of almost $180 dollars, but median on $135\. It indicates
    that we might have some high values distorting the distribution, skewing it to
    the right. To make sure, we can check the price range.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/d81e6bb10d643ab098122644ba002317.png)'
  prefs: []
  type: TYPE_IMG
- en: Prices for the Asheville, NC listings. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: As expected, we have the bulk of our data up until $500 or so. The rest is mostly
    outliers, with little counts. We can confirm that by running the code `np.quantile(listings[‘price’],
    0.97)` and checking that the 97th percentile is $538 dollars.
  prefs: []
  type: TYPE_NORMAL
- en: Very well.
  prefs: []
  type: TYPE_NORMAL
- en: Now the next step is to start putting the data on maps. Let’s visualize the
    data points and start drawing some insights. For that, first we need to convert
    the Pandas data frame to Geopandas.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Looking at the dataset created, observe that it now brings a `geometry` variable.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7a1bcad732d941d73fadf485973439c4.png)'
  prefs: []
  type: TYPE_IMG
- en: ‘geometry’ variable created by geopandas. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: With that done, plotting the points is easy enough with geoplot. We are using
    only values under $538, so our colors look better distributed, otherwise the skew
    of the data would make a big purple blend of points.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/9d289ad81cada770004c0db11c9668ec.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Data points: listings from Asheville, NC — AirBnb. Image by the author.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Ok. From here we can start to see some nice things already:'
  prefs: []
  type: TYPE_NORMAL
- en: Most of the listings are (as expected) floating around the average
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There is a concentration of rental properties over the I-40 hwy.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There is a good mixture of dark blue and light blue dots, so it shows that the
    prices are around 100 to 200 dollars.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The appearances of red dots is very sparse, so it should no be very common to
    find too expensive rentals in Asheville.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Heatmap
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Next, I believe we can go for creating heatmaps.
  prefs: []
  type: TYPE_NORMAL
- en: One option, as shown in JORDAN’s book is using the geoplot. We can download
    the geojson file from the *insideairbnb.com* and use it to create a heatmap.
  prefs: []
  type: TYPE_NORMAL
- en: Here, we will read the file with geopandas and transform it into the coordinate
    system 4326, which is the standard for GPS.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: Then, creating a heatmap is easy with these few lines of code. First we create
    a density plot (kde) to be projected over the map and we use polyplot to display
    both layers.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Here is the beautiful result. The listings are very concentrated in the central
    zone of the city.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/64c2401869ec8d25204f8dffe827dd07.png)'
  prefs: []
  type: TYPE_IMG
- en: Heatmap of the Asheville listings. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: Moving on, we will now use `Folium` module to create a heatmap of the prices
    per region and a choropleth map.
  prefs: []
  type: TYPE_NORMAL
- en: First, the heatmap. Considering that we want to see the data points in different
    colors, separated by price range bins, here is a code to create those groups.
    First we use `pandas.cut` to create bins for each 100 dollars and then we use
    `map()` to transform the labels into colors. This will be used in our next step.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Let’s create a base map, with starting point at downtonw Asheville, NC.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: Then we can add the points.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: Now we will create the heatmap. We must transform the data to a list of values.
    Only lat, long and price. The heatmap will be by price. Then we import `HeatMap
    from folium.plugins` and add it to the base map.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: Here is the result. A beautiful heat map that shows good insights.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b5e417a0d95a75f59db68bff44a5c57b.png)'
  prefs: []
  type: TYPE_IMG
- en: Heatmap of Asheville AirBnb listings. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: Look how the prices are higher next to the city downtown. And closer to the
    Biltmore attraction, it’s not that crowded with listings. There are a few of them,
    some with lower range prices, probably due to the distance to downtonwn.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/990fb2951787da3dc81426fee9b85c9b.png)'
  prefs: []
  type: TYPE_IMG
- en: Downtown vs Biltmore surroundings. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: Choropleth
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Finally, if we want to create a quick Choropleth from this data, here’s the
    code snippet. We can use the `asheville` file created previously as our geo data,
    the `listings` file is where the prices come from and the `neighbourhood` variable
    is the link between the geojson and the data frame.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/e119b49728226f8ab4556e6eb02c27f3.png)'
  prefs: []
  type: TYPE_IMG
- en: Choropleth map of Asheville AirBnb listings. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: Looking at the map, we see that the highest prices are on the right side. If
    you don’t know the area, Asheville is a city by the Blue Ridge Mountains, a famous
    and beautiful place in North Carolina, especially during the fall season. The
    *Blue Ridge Parkway* is one of the most famous driveways in the country, being
    constantly mentioned as one of the most beautiful drives in USA. So let’s plot
    another choropleth, but now with the terrain mode on, then we can see where the
    mountains are.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: The red line is where the Blue Ridge Parkway is located.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d95a5ce09860c9ecbad03976e7df2311.png)'
  prefs: []
  type: TYPE_IMG
- en: Choropleth over terrain map. Image by the author.
  prefs: []
  type: TYPE_NORMAL
- en: This is one of the views of the Blue Ridge Parkway. I think you can have an
    idea why those rental properties are more expensive, right? So beautiful view!
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/40aace42ecc045526260dd4c2145d9a0.png)'
  prefs: []
  type: TYPE_IMG
- en: View of the Blue Ridge Parkway. Picture from the author’s personal collection.
  prefs: []
  type: TYPE_NORMAL
- en: Before You Go
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: I how you had fun with this little project. Geospatial data is super powerful
    and can bring a lot of insights. To work with it, packages like Geopandas, Geoplot
    and Folium are a must.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the full code for this exercise:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://github.com/gurezende/Studying/tree/master/Python/Geospatial?source=post_page-----7244c1b9e302--------------------------------)
    [## Studying/Python/Geospatial at master · gurezende/Studying'
  prefs: []
  type: TYPE_NORMAL
- en: This is a repository with my tests and studies of new packages - Studying/Python/Geospatial
    at master ·…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: github.com](https://github.com/gurezende/Studying/tree/master/Python/Geospatial?source=post_page-----7244c1b9e302--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: If you liked this content, follow my blog for more. Also, find me on [LikedIn](https://www.linkedin.com/in/gurezende/)
    too.
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://gustavorsantos.medium.com/?source=post_page-----7244c1b9e302--------------------------------)
    [## Gustavo Santos - Medium'
  prefs: []
  type: TYPE_NORMAL
- en: Read writing from Gustavo Santos on Medium. Data Scientist. I extract insights
    from data to help people and companies…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: gustavorsantos.medium.com](https://gustavorsantos.medium.com/?source=post_page-----7244c1b9e302--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Reference
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[JORDAN, David S. 2023.*Applied Geospatial Data Science with Python*. 1 ed.
    Pactk Publishing.](https://www.amazon.com/Applied-Geospatial-Data-Science-Python/dp/1803238127/ref=asc_df_1803238127/?tag=hyprod-20&linkCode=df0&hvadid=598352683676&hvpos=&hvnetw=g&hvrand=1787360199645971497&hvpone=&hvptwo=&hvqmt=&hvdev=c&hvdvcmdl=&hvlocint=&hvlocphy=1020988&hvtargid=pla-1875036424962&psc=1)'
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/data-hackers/criando-mapas-interativos-e-choropleth-maps-com-folium-em-python-abffae63bbd6?source=post_page-----7244c1b9e302--------------------------------)
    [## Criando Mapas Interativos e Choropleth Maps com Folium em Python'
  prefs: []
  type: TYPE_NORMAL
- en: Aprenda a criar mapas simples e a adicionar codificação de valores baseada em
    cores (choropleth) com o pacote Folium…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: medium.com](https://medium.com/data-hackers/criando-mapas-interativos-e-choropleth-maps-com-folium-em-python-abffae63bbd6?source=post_page-----7244c1b9e302--------------------------------)  [##
    Quickstart - Folium 0.14.0 documentation
  prefs: []
  type: TYPE_NORMAL
- en: 'To create a base map, simply pass your starting coordinates to Folium: To display
    it in a Jupyter notebook, simply ask…'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: python-visualization.github.io](https://python-visualization.github.io/folium/quickstart.html?source=post_page-----7244c1b9e302--------------------------------)
  prefs: []
  type: TYPE_NORMAL
