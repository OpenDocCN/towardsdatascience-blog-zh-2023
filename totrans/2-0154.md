# 使用R和brms对学校毕业生结果进行贝叶斯比较

> 原文：[https://towardsdatascience.com/a-bayesian-comparison-of-school-leaver-outcomes-with-r-and-brms-4da9ae5f9895](https://towardsdatascience.com/a-bayesian-comparison-of-school-leaver-outcomes-with-r-and-brms-4da9ae5f9895)

## ANOVA — 贝叶斯风格

[](https://mmgillin.medium.com/?source=post_page-----4da9ae5f9895--------------------------------)[![Murray Gillin](../Images/40619967eb8911fa1d651503143b940c.png)](https://mmgillin.medium.com/?source=post_page-----4da9ae5f9895--------------------------------)[](https://towardsdatascience.com/?source=post_page-----4da9ae5f9895--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----4da9ae5f9895--------------------------------) [Murray Gillin](https://mmgillin.medium.com/?source=post_page-----4da9ae5f9895--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----4da9ae5f9895--------------------------------) ·9 分钟阅读·2023年9月2日

--

我们在离开学校时常常会思考我们想做什么。作为小孩子时，我们被问及长大后想做什么，然后在13年的前高等教育中度过。在公共政策中，政府、天主教和独立学校系统之间的差异被广泛讨论，特别是在非政府学校的公共资助方面，以及如何分配资源。

给定学校部门，学生结果之间是否存在实际差异？

在澳大利亚维多利亚州，州政府每年进行一次调查，以评估高中毕业后的结果 ([On Track Survey](https://www.vic.gov.au/on-track-survey))。该 [数据集](https://www.education.vic.gov.au/Documents/about/research/OnTrack2022/DestinationData2022.xlsx) （在 [CC BY 4.0](https://discover.data.vic.gov.au/dataset/2021-on-track-survey-year-12-or-equivalent-completers-post-school-destinations) 下提供）覆盖了多个年份，我们将只查看本文编写时最新的2021年数据。

本文将应用贝叶斯分析方法，使用R包brms来回答这些问题。

![](../Images/6fc796bd31faf209865d27bb584ba25e.png)

图片由 [Good Free Photos](https://unsplash.com/@goodfreephoto_com?utm_source=medium&utm_medium=referral) 提供，来源于 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

## 加载库和数据集

以下是我们加载所需包的数据集，该数据集以宽格式报告呈现，包含许多合并单元格。R不喜欢这种格式，因此我们需要做一些硬编码来重新标记向量，并创建一个整洁的数据框。

[PRE0]

下面是我们数据集的一个示例。

![](../Images/1ccd7662031c28dd6e88a6f2d57f646a.png)

初始数据框的示例（作者提供的图片）

数据集有14个字段。

+   VCAA代码 — 每个代码的行政ID

+   学校名称

+   部门 — G = 政府，C = 天主教，I = 独立

+   地域或郊区

+   完成年级12的总学生数

+   跟踪同意者

+   受访者

+   其他列表示每个结果的受访者百分比

对于我们的横截面研究，我们对按部门划分的结果比例感兴趣，因此我们需要将这个宽格式数据框转换为长格式。

[PRE1]

![](../Images/34a43ed27ee0827c6e86eff03616b07b.png)

具有兴趣特征的长格式数据框（作者提供的图片）

## 探索性数据分析

让我们简要地可视化并总结一下我们的数据集。政府部门有157所，独立学校有57所，天主教学校有50所。

[PRE2]

![](../Images/20762b69934621cc85f2422c8ca4d97b.png)

按部门分类的学校数量（作者提供的图片）

[PRE3]

![](../Images/f5bf8f3f68291ad4b44eb969e0e34a63.png)

按部门和结果分布的比例（作者提供的图片）

分布情况讲述了一个有趣的故事。学士结果在所有部门中变异性最大，独立学校的学生选择攻读本科教育的中位比例最高。值得注意的是，政府学校在高中毕业后就业的学生比例中位数最高。所有其他结果的变化不大 — 我们会很快重新审视这一点。

## 统计建模 — Beta 似然回归

我们关注的是按学校划分的学生比例及其高中毕业后的结果。在这些情况下，beta 似然是我们最好的选择。brms 是由[Buerkner](https://github.com/paul-buerkner/brms)开发的一个出色的包，用于构建贝叶斯模型。我们的目标是对按结果和部门划分的比例进行建模。

Beta 回归模型有两个参数，μ 和 φ。μ 代表平均比例，φ 是精度（或方差）的度量。

我们的第一个模型如下所示，请注意我们已经开始考虑部门和结果之间的交互，因为这是我们希望模型回答的问题，因此这是一个 ANOVA 模型。

我们要求模型为每个部门和结果的组合创建单独的 Beta 项，并使用一个汇总的 φ 项，或使用相同方差的不同比例均值。我们期望这些比例中的 50% 位于 logit 规模上的（-3, 1）之间或比例上的（0.01, 0.73）之间。这是足够宽泛但有信息的先验。全球 Phi 估计值是一个正数，因此我们使用一个足够宽泛的 gamma 分布。

![](../Images/605ad780bfee25e35dc12016ea0901e1.png)

模型 m3a 的数学形式 — 作者提供的图片

[PRE4]

![](../Images/2aa048487686b66516cd8319ac344acd.png)

模型 m3a 的输出摘要 — 作者提供的图片

注意在模型设置中，我们对所有比例增加了 1% — 这是因为 Beta 回归无法处理零值。我们尝试使用零膨胀 Beta 来建模，但收敛所需时间更长。

同样地，我们可以在没有合并 phi 的情况下建模，这在考虑到我们在上述分布中观察到的情况时直观上是有意义的，因为每个部门和结果组合中存在变异。模型定义如下。

[PRE5]

![](../Images/4c3ae4b71c27ca103dea911705457625.png)

m3b 的输出总结 — 作者提供的图片

## 模型诊断与比较

手中有两个模型后，我们将比较它们在样本外的预测准确性，使用贝叶斯 LOO 估计的期望对数逐点预测密度 (`elpd_loo`)。

[PRE6]

![](../Images/293a97d27e01605fbce03850aef25b20.png)

模型 m3a 和 m3b 的 LOO 比较 — 作者提供的图片

简而言之，预期的对数逐点留一值越高，对未见数据的预测准确性越大。这为我们提供了模型之间的*相对*准确性度量。我们可以进一步通过完成后验预测检查来验证这一点，即观察值和模拟值的比较。在我们的案例中，模型 m3b 更好地模拟了观察数据。

[PRE7]

![](../Images/243b0d7ed1a73032126516a309e5593a.png)

模型 m3a 的后验预测检查 — 作者提供的图片

![](../Images/2df487150626b39439d35cf33846e553.png)

模型 m3b 的后验预测检查 — 作者提供的图片

模型 m3b 的非合并方差或 phi 项能够更好地捕捉按部门和结果分布的变异。

## ANOVA — 贝叶斯风格

记住，我们的研究问题是关于了解部门间的结果差异及其程度。在频率统计学中，我们可能使用 ANOVA，即组间均值差异的方法。这种方法的弱点在于结果提供了一个估计值和置信区间，但没有关于这些估计的不确定性，并且提供了一个反直觉的 p 值来说明均值差异是否具有统计显著性。不，谢谢。

以下，我们生成每个部门和结果组合交互的期望值集合，然后使用优秀的 `tidybayes::compare_levels()` 函数进行繁重的计算。它计算了每个结果的部门间后验均值差异。为了简洁起见，我们排除了“其他”结果。

[PRE8]

![](../Images/2b475e080761cff5c4b94118e79e144f.png)

贝叶斯 ANOVA — 作者提供的图片

或者，我们可以用一个整洁的表格总结所有这些分布，以便更容易解释和一个 89% 的可信区间。

[PRE9]

![](../Images/02d71896f3b75822fd1ef70d259568e5.png)

按部门和结果的后验均值差异总结表及 89% 可信区间 — 作者提供的图片

例如，如果我们要在正式报告中总结比较，我们可能会写以下内容。

> 政府学校的学生在完成 VCE 后开始本科学位的可能性低于天主教和独立学校的同学。
> 
> 平均而言，42.5%（介于39.5%和45.6%之间）的政府学校学生，53.2%（介于47.7%和58.4%之间）的天主教学校学生和65%（介于60.1%和69.7%之间）的独立学校学生在完成12年级后开始接受本科教育。
> 
> 在89%的后验概率下，天主教学校与政府学校学生本科入学的差异在5.6%到15.7%之间，平均值为10.7%。此外，独立学校与政府学校学生本科入学的差异在17.8%到27%之间，平均值为22.5%。
> 
> 这些差异是显著的，差异不为零的概率为100%。

## 总结与结论

在本文中，我们展示了如何使用贝塔似然函数和贝叶斯建模来建模比例数据，然后执行贝叶斯方差分析（ANOVA）以探索不同部门之间比例结果的差异。

我们没有试图创建这些差异的因果理解。可以想象，有几个因素影响个体学生的表现，包括社会经济背景、父母的教育水平，以及学校层面的影响、资源等。这是一个极其复杂的公共政策领域，常常被零和博弈的 rhetoric 所困扰。

就个人而言，我是我大家庭中第一个接受并完成高等教育的人。我上了一所中等水平的公立高中，并取得了相当不错的成绩，顺利进入了我首选的学校。我的父母鼓励我继续接受教育，他们在16岁时选择了辍学。虽然本文提供了政府学校和非政府学校之间差异的证据，但它本质上只是描述性的。
