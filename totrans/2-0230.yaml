- en: A Simple Guide to Understand the apply() Functions in R
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解 R 中 apply() 函数的简单指南
- en: 原文：[https://towardsdatascience.com/a-simple-guide-to-understand-the-apply-functions-in-r-69277fc7e522](https://towardsdatascience.com/a-simple-guide-to-understand-the-apply-functions-in-r-69277fc7e522)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/a-simple-guide-to-understand-the-apply-functions-in-r-69277fc7e522](https://towardsdatascience.com/a-simple-guide-to-understand-the-apply-functions-in-r-69277fc7e522)
- en: Learn how to use these helpful functions once and for all
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 一劳永逸地学会如何使用这些有用的函数
- en: '[](https://gustavorsantos.medium.com/?source=post_page-----69277fc7e522--------------------------------)[![Gustavo
    Santos](../Images/a19a9f4525cdeb6e7a76cd05246aa622.png)](https://gustavorsantos.medium.com/?source=post_page-----69277fc7e522--------------------------------)[](https://towardsdatascience.com/?source=post_page-----69277fc7e522--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----69277fc7e522--------------------------------)
    [Gustavo Santos](https://gustavorsantos.medium.com/?source=post_page-----69277fc7e522--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://gustavorsantos.medium.com/?source=post_page-----69277fc7e522--------------------------------)[![Gustavo
    Santos](../Images/a19a9f4525cdeb6e7a76cd05246aa622.png)](https://gustavorsantos.medium.com/?source=post_page-----69277fc7e522--------------------------------)[](https://towardsdatascience.com/?source=post_page-----69277fc7e522--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----69277fc7e522--------------------------------)
    [Gustavo Santos](https://gustavorsantos.medium.com/?source=post_page-----69277fc7e522--------------------------------)'
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----69277fc7e522--------------------------------)
    ·8 min read·Oct 6, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: ·发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----69277fc7e522--------------------------------)
    ·阅读时长 8 分钟·2023年10月6日
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/d38e794bd5b719ca31a8e398cfe549a7.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d38e794bd5b719ca31a8e398cfe549a7.png)'
- en: Photo by [Kelly Sikkema](https://unsplash.com/@kellysikkema?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/0iKjge_aOVo?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 照片由 [Kelly Sikkema](https://unsplash.com/@kellysikkema?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    提供，来源于 [Unsplash](https://unsplash.com/photos/0iKjge_aOVo?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
- en: Introduction
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: I will start this post by saying that I work daily with **R** and **Python**
    languages. Honestly, I find it easier and more intuitive the way the `apply` functions
    are used in Python.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我在开始这篇文章时要说的是，我每天都使用**R**和**Python**语言。老实说，我觉得 Python 中 `apply` 函数的使用方式更简单、更直观。
- en: Thinking about the reason behind that, I believe it is because there aren’t
    many options in Python. The R Language presents many different options, the *family
    of apply functions* as I like to refer to them.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 反思原因，我认为是因为 Python 中的选项不多。R 语言提供了许多不同的选项，即我喜欢称之为的*apply 函数家族*。
- en: I remember that once I read somewhere somebody saying they always go directly
    to loops to solve a problem because they can never remember what each of the apply
    functions do and which one would be the most suited version to use for that case.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我记得曾经有人说他们总是直接使用循环来解决问题，因为他们总是记不住每个 apply 函数的作用，也不知道哪个函数最适合使用。
- en: Well, I hope that those kind of problems will end after this post. It is my
    intention that those who read this article end it with a good understanding of
    the family of functions, and of how and when to use them.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 我希望这些问题在这篇文章后能得到解决。我的目的是希望读者在阅读本文后，对这些函数家族有一个清晰的理解，以及如何和何时使用它们。
- en: To perform the exercises, let’s quickly create a sample data frame, without
    too much criteria. An ID, the product name, qty sold and dollar amount for two
    different periods.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 要进行这些练习，我们快速创建一个示例数据框，没有过多的标准。包括一个 ID、产品名称、销售数量和两个不同时间段的金额。
- en: '[PRE0]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: No more small talk, let’s dive in.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 不再多说，让我们深入探讨。
- en: Functions
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 函数
- en: 'The *apply family* in R has 4 main functions: `apply()`, `lapply()`, `sapply()`,
    and `tapply()`.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: R 中的*apply 家族*有 4 个主要函数：`apply()`、`lapply()`、`sapply()` 和 `tapply()`。
- en: apply( )
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: apply( )
- en: The `apply()` function names the *family*. It is probably the most straightforward
    one to be used. This function *applies* the same function to all the elements
    of a row or a column. Here is the syntax.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '`apply()` 函数被称为*家族*。它可能是最直接的函数。这个函数*应用*相同的操作到行或列的所有元素。这里是语法。'
- en: '`apply(X, MARGIN, FUN)`'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '`apply(X, MARGIN, FUN)`'
- en: Apply to the matrix X, on the rows (1) or columns (2), the function specified.
  id: totrans-21
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 对矩阵 X 应用指定的函数，按行（1）或列（2）。
- en: The easiest example is the application of the **mean** value. We have a dataset
    with a bunch of products sales. But what’s the mean quantity sold and the mean
    dollar amount sold?
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
- en: To quickly see that, we can use `apply` and choose the function `mean` to be
    applied to every numeric column in the dataset.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: So, our `X` a matrix with the numeric columns 3 (`qty`) and 4 (`amt`) of our
    dataset — since we can’t take the mean of *product A* and *product B.* The `MARGIN`
    can be `1` for apply to rows or `2` when applying the function to columns. `FUN`
    is the function to be applied to every element. The code will be as follows.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Common Errors
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We must use the slice notation for `X` when using `apply()` because R would
    throw an error if we try to use the whole dataset `dtf`, given that there are
    string columns. We can’t have the mean point of strings.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Even if we try to use a whole column, such as `dtf$qty` to get the mean of the
    quantities (which is numeric) it is not going to work as well, because there is
    just one variable, so it is easier to simply use `mean(dtf$qty)`, right?
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When running `apply()`, R will first read the dimensions of the object `X` prior
    to running the function. If you try `dim(dtf$qty)`, you will see that the output
    is `NULL`. That is why you get that error below. The dimension needs to be over
    1.
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Great. Nice and easy.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: Apply function by row
  id: totrans-33
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now let’s take another look at the data again. If we want to calculate the mean
    by row, to know the average between amount1 and amount2 we can use the same code,
    but just changing to `MARGIN=1` now, and the function will calculate the simple
    average of the row:`[amt + amt2] / 2`.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: And yet, we can add that to the dataset.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: If we want to add a column that will calculate the `amt/qty` , we can calculate
    that by row (`MARGIN=1`) using a custom function within apply. The custom functions
    takes a matrix **mtrx** and divides the value in the second column of **mtrx**
    by the value from the first column.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: lapply( )
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In R language, a **list** is a concept different than it is for Python. In R,
    it is a collection of objects, not necessarily of the same type. And there will
    be occasions when we need to apply a function to each element in a list. That’s
    what `lapply()` is used for.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: Important to note that `lapply` **returns a list object** with the same length
    as X.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: '`lapply(X, FUN)`'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: The simplest example I can think of is if you have a list and you want to check
    the type of each object in that list. Let’s see the code for this simple example.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: As expected, the same length (4 objects) and the function `class` was applied
    to every element in the list. Basically, you should use that method if you’re
    dealing with a list object or if you need to have a list returned.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: You should use that method if you’re dealing with a list object or if you need
    to have a list returned.
  id: totrans-47
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: sapply( )
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As per the documentation, `sapply()` is an user-friendly version of `lapply()`,
    **returning a vector or matrix of same length** instead of returning a list. If
    the argument `simplify=TRUE`, which is on by default, it will return an array
    (simplified object).
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: sapply( ) is an user-friendly version of lapply( ), that will return a simpler
    object, like an array.
  id: totrans-50
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '`sapply(X, FUN, simplify = TRUE)`'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Going back to our created dataset `dtf`, the column `product` brings the names
    preceded by the word ‘*product*’. If we want to remove that, `sapply` can be a
    good helper. Instead of going with a loop or even before loading Tidyverse to
    do that, remember that the apply functions from Base R can help.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: Observe that we’re using a custom function here to split the string in two pieces,
    once it finds the space character, and taking the second element of that list.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: tapply( )
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Finally, `tapply()` is a function to be used when you’re dealing with factors
    (or groups).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: '`tapply(X, INDEX, FUN, simplify = TRUE)`'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: Use tapply to apply a function to every group of values.
  id: totrans-59
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The obvious example for this function is if we want to check the mean of `amt`
    by product without a *group by* function, `tapply` can be handy.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: '`X` is the matrix or vector.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`INDEX` is the column with the groups.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`FUN` is the function to be applied.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: That’s about it for the most used functions from the apply family in R.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: Before You Go
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Well, the apply functions are great mapping functions. In your daily job as
    a data scientist, there will be several occasions where a mapping function is
    much better than a loop, being that for performance purposes or just for a better
    code readability.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: With this quick intro, I am sure you can now *apply* the family of apply functions
    to your data.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: '`apply`: Use to apply the same function to every element of a row or column
    in a dataset.'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`lapply`: Use to apply a function to each element of a list. Returns a list
    of same length as result.'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`sapply`: friendly version of lapply that returns an array as result.'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`tapply`: use to apply a function to each group of values. Almost like a group
    by.'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Code in GitHub:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://github.com/gurezende/Studying/tree/master/R/apply?source=post_page-----69277fc7e522--------------------------------)
    [## Studying/R/apply at master · gurezende/Studying'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: This is a repository with my tests and studies of new packages - Studying/R/apply
    at master · gurezende/Studying
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: github.com](https://github.com/gurezende/Studying/tree/master/R/apply?source=post_page-----69277fc7e522--------------------------------)
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: Reference
  id: totrans-77
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[](https://www.guru99.com/r-apply-sapply-tapply.html?source=post_page-----69277fc7e522--------------------------------#5)
    [## apply(), lapply(), sapply(), tapply() Function in R with Examples'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: This tutorial aims at introducing the apply() function collection. The apply()
    function is the most basic of all…
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: www.guru99.com](https://www.guru99.com/r-apply-sapply-tapply.html?source=post_page-----69277fc7e522--------------------------------#5)
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: '[https://www.datacamp.com/tutorial/r-tutorial-apply-family](https://www.datacamp.com/tutorial/r-tutorial-apply-family)'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: '[SANTOS, Gustavo R. 2023\. *Data Wrangling with R.* 1 ed. Packt Publishing.](https://a.co/d/1gij8AW)'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
