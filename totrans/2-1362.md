# 流处理框架介绍

> 原文：[https://towardsdatascience.com/introduction-to-streaming-frameworks-d612583a3246](https://towardsdatascience.com/introduction-to-streaming-frameworks-d612583a3246)

## 理解在评估和比较流处理技术时需要考虑的一些关键特性。

[](https://pierpaoloippolito28.medium.com/?source=post_page-----d612583a3246--------------------------------)[![Pier Paolo Ippolito](../Images/981abb84149adab275473b76bdbde66f.png)](https://pierpaoloippolito28.medium.com/?source=post_page-----d612583a3246--------------------------------)[](https://towardsdatascience.com/?source=post_page-----d612583a3246--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----d612583a3246--------------------------------) [Pier Paolo Ippolito](https://pierpaoloippolito28.medium.com/?source=post_page-----d612583a3246--------------------------------)

·发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----d612583a3246--------------------------------) ·阅读时长6分钟·2023年11月8日

--

![](../Images/dbb92cc79b1e109a4c0ceeb2602b29ef.png)

[Joao Branco](https://unsplash.com/@jfobranco?utm_source=medium&utm_medium=referral) 提供的照片，[Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

# 介绍

随着数据架构变得越来越成熟，流处理不再被视为奢侈品，而是一项在不同行业中广泛应用的技术。由于技术和资源限制，批处理实际上一直是处理和交付应用程序的首选方式，但随着基于Apache的分布式系统中微批处理和原生流处理框架的发展，高规模流处理现在变得更加可及（见图1）。

使用流处理系统的一些示例应用包括：处理交易数据以发现异常、天气数据、来自远程位置的物联网数据、地理位置跟踪等。

![](../Images/bf3c7883342ec4cb1055f4bf4e27ce82.png)

图1：批处理与流处理（作者提供的图片）。

# 实时处理与微批处理

流处理系统主要有两种类型：微批处理和实时处理：

+   在实时流处理过程中，每条记录都会在其可用时立即被处理。因此，这可能导致系统具有非常低的延迟，能够立即利用传入的数据（例如，在金融系统中检测欺诈交易）。

+   在微批处理系统中，数据点不是一个一个处理，而是以小块的形式处理，然后在特定时间间隔后或达到最大存储大小时返回。这种方法因此更倾向于高吞吐量而非低延迟。最后，如果有兴趣执行复杂的操作，例如在存储系统中输出结果之前进行聚合（如最小值、最大值、均值）、连接等操作，微批处理系统可以特别有用。因此，微批处理可以被认为是在执行例如每小时报告任务（如平均天气温度等）时的一个非常好的折衷方案。

![](../Images/56028732bd9dcc650e87a06e344a4861.png)

图2：实时与微批处理（图片由作者提供）。

# 选择流处理框架

现在我们已经澄清了微批处理和实时流处理的区别，我们可以开始审查一些需要考虑的关键点：

+   延迟

+   吞吐量

+   内存使用

+   可扩展性

+   故障恢复

+   消息传递保证

## 延迟

延迟可以定义为处理一个或多个输入并返回输出所需的时间（流记录进入系统后处理的时间）。如果低延迟是主要限制，则流处理框架将是我们的最佳选择。在微批处理中，输入实际上是在被消费之前缓存的（因此增加了延迟时间）。

## 吞吐量

吞吐量表示系统返回的输出数据的汇总速率。例如，这可以通过每秒处理的输入数据量来表示。例如，Apache Spark可以使用微批处理，通过缓存输入数据能够实现高吞吐量速率。另一方面，原生流处理框架为了尽可能优化延迟评分，则会注册较低的吞吐量速率。

## 内存使用

由于流处理框架每天处理大量数据，优化内存使用可以是一个非常重要的因素，以确保系统在重负载下不会被压垮。根据系统架构，这些系统实际上可以设计成保留不同时间段的数据，如果数据保留时间过长或同时接收大量数据，则内存可能成为一个大限制。因此，评估不同框架的内存使用优化可能是一个相当复杂的任务，并且高度依赖于你所从事项目的具体情况。在这种情况下，使用不同示例的来流量创建使用基准可以提供有价值的见解，以便做出决策。

## 可扩展性

在并行处理流处理框架中，可扩展性可以通过系统处理不断增加的工作量并均匀分配任务到不同工作节点的能力来表示。例如，这可以通过实现主从架构来完成，其中主节点负责最优地规划任务在工作节点之间的分配，以尽可能避免工作节点在等待依赖项时闲置。此外，在高度可扩展的架构中，系统应该能够自动理解何时需要或不需要在集群中添加/删除资源（例如工作节点），以响应不断上升/下降的工作负载。

## 故障恢复

另一个需要考虑的重要因素是故障恢复。实际上，这可以定义为系统在其组件之一失败后能够保持弹性并继续操作的能力。例如，如果一个工作节点内存耗尽且不再功能正常，应该自动启动一个新的节点以减少停机时间，并且它应该能够从类似的阶段继续操作，以避免完全从头开始重启整个过程。在处理非常大的负载的分布式系统中，故障恢复是一个非常重要的特性，因为故障可能比预期的更频繁。

## 消息交付保证

最终，每个流处理框架可以提供不同的输入交付保证。三个最重要的交付保证是：

+   准确一次交付

+   至多一次交付

+   至少一次交付

使用“准确一次”交付，系统保证每个传入的输入将被处理一次。相反，使用“至多一次”交付，大多数输入预计将被处理，但如果过程中的某些事情出现问题，则无法保证输入会被处理。最终，使用“至少一次”交付，保证每个输入都会被处理，并且某些消息可能也会被处理两次或更多次。

选择消息交付方法时需要记住的两个关键标准是：延迟和计算成本。例如，从准确性的角度来看，“一次交付”在大多数使用案例中可能是最佳选择，尽管这种方法很容易带来大量额外的开销（例如，需要一个记录历史系统来确定输入是否已经处理过，以及在发生故障时进行恢复）。因此，根据应用程序的可能约束，其他消息交付系统可能会为你提供更多价值。

# Apache Spark、Flink 和 Kafka

提供流处理功能的三个最显著的 Apache 项目是：Spark、Flink 和 Kafka。Spark 仅提供微批处理，Flink 提供原生流处理和批处理，而 Kafka 仅提供流处理。

现在，Apache Spark 是最流行的批处理工作负载系统之一，通过其改进的结构化流处理 API 也越来越多地用于流处理任务（具有亚秒级延迟）。结构化流处理提供了更易于使用的 API、精确一次处理、内置容错和接近实时的处理能力。如果你对了解更多关于 Apache Spark 的信息感兴趣，可以在我的[介绍文章](/getting-started-with-apache-spark-cb703e1b3ee9)和[优化文章](/apache-spark-optimization-techniques-fa7f20a9a2cf)中找到更多资料。

Apache Flink 可以支持无限（流式）和有限（批处理）流。不过，与 Spark 相反的是，默认情况下，运行时是流式的而非批处理的。此外，Flink 还能够执行有状态的计算（利用时间上的数据依赖进行聚合、连接等）。

最后，Apache Kafka 是一个专门设计用于执行流处理操作的平台。它始于2011年的一个消息队列系统，现在已经成为一个完整的流处理框架，内置了对计算和存储的支持。Apache Kafka 由4个关键 API 组成：Kafka Streams、Producer、Consumer 和 Connector。使用 Kafka Streams API 可以提供许多优势，如开箱即用的出色扩展性、集群管理、自动故障转移等。

此外，如果需要，可以在同一系统中结合使用不同的框架，以充分发挥它们的最佳功能（例如，使用Kafka进行流处理存储，使用Flink进行计算）。

# 联系方式

如果你想随时了解我的最新文章和项目，请[在 Medium 上关注我](https://pierpaoloippolito28.medium.com/subscribe)并订阅我的[邮件列表](http://eepurl.com/gwO-Dr)。以下是我的一些联系方式：

+   [Linkedin](https://uk.linkedin.com/in/pier-paolo-ippolito-202917146)

+   [个人网站](https://pierpaolo28.github.io/)

+   [Medium 个人资料](https://towardsdatascience.com/@pierpaoloippolito28)

+   [GitHub](https://github.com/pierpaolo28)

+   [Kaggle](https://www.kaggle.com/pierpaolo28)
