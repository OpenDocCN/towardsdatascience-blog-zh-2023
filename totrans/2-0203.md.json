["```py\nbigquery-public-data.chicago_taxi_trips.taxi_trips\n```", "```py\nspreadsheep-case-studies-2023.chicago_taxies_2023.trip_data\n```", "```py\nSELECT\n  date(trip_start_timestamp) as trip_start_date,\n  round(sum(trip_total),2) as trip_total_revenue\nFROM\n  `spreadsheep-case-studies-2023.chicago_taxies_2023.trip_data`\nWHERE\n  date(trip_start_timestamp) between \"2023-05-01\" and \"2023-06-30\"\nGROUP BY\n  trip_start_date\nORDER BY\n  trip_start_date DESC\n```", "```py\nWITH daily_data as(\nSELECT\n  date(trip_start_timestamp) as trip_start_date,\n  round(sum(trip_total),2) as trip_total_revenue\nFROM\n  `spreadsheep-case-studies-2023.chicago_taxies_2023.trip_data`\nWHERE\n  date(trip_start_timestamp) between \"2023-05-01\" and \"2023-06-30\"\nGROUP BY\n  trip_start_date\nORDER BY\n  trip_start_date DESC\n)\n\nSELECT\n  trip_start_date,\n  trip_total_revenue,\n  avg(trip_total_revenue) over (order by trip_start_date asc) as moving_average\nFROM\n  daily_data\n```", "```py\nrows between 7 preceding and one preceding\n```", "```py\nselect\n  numbers,\n  sum(numbers) over \n  (\n    order by numbers asc \n    rows between 7 preceding and one preceding\n  ) \n  as moving_sum_seven\nfrom\n  test_data\n```", "```py\nwith daily_data as (\nSELECT\n  date(trip_start_timestamp) as trip_start_date,\n  round(sum(trip_total),2) as trip_total_revenue\nFROM\n  `spreadsheep-case-studies-2023.chicago_taxies_2023.trip_data`\nWHERE\n  date(trip_start_timestamp) between \"2023-05-01\" and \"2023-06-30\"\nGROUP BY\n  trip_start_date\nORDER BY\n  trip_start_date DESC\n)\n\nSELECT\n  trip_start_date,\n  trip_total_revenue,\n  avg(trip_total_revenue) over (order by trip_start_date asc rows between 7 preceding and one preceding) as moving_average\nFROM\n  daily_data\nORDER BY\n  trip_start_date DESC\n```", "```py\nCOUNT(*) OVER \n(\nORDER BY trip_start_date ASC ROWS BETWEEN 7 PRECEDING AND 1 PRECEDING\n) = 7\n```", "```py\n if\n  (\n    COUNT(*) OVER (ORDER BY trip_start_date ASC ROWS BETWEEN 7 PRECEDING AND 1 PRECEDING) = 7,\n    AVG(trip_total_revenue) OVER (ORDER BY trip_start_date ASC ROWS BETWEEN 7 PRECEDING AND 1 PRECEDING),\n    NULL \n  ) AS moving_average\n```", "```py\nwith sales_data as (\nSELECT\n'2023-01-01' AS DATE, 100 AS SALES\nUNION ALL\nSELECT\n'2023-01-02' AS DATE, 50 AS SALES\nUNION ALL\nSELECT\n'2023-01-03' AS DATE, 250 AS SALES\nUNION ALL\nSELECT\n'2023-01-03' AS DATE, 200 AS SALES\nUNION ALL\nSELECT\n'2023-01-04' AS DATE, 300 AS SALES\nUNION ALL\nSELECT\n'2023-01-05' AS DATE, 150 AS SALES\n)\n\nSELECT\n  *,\n  SUM(SALES) OVER (ORDER BY DATE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS running_total_rows,\n  SUM(SALES) OVER (ORDER BY DATE RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS running_total_range\nFROM sales_data\n```", "```py\nwith daily_data as (\nSELECT\n  date(timestamp_trunc(trip_start_timestamp,month)) as trip_month,\n  round(sum(trip_total),2) as trip_total_revenue\nFROM\n  `spreadsheep-case-studies-2023.chicago_taxies_2023.trip_data`\nWHERE\n  date(trip_start_timestamp) between \"2023-01-01\" and \"2023-06-30\"\nGROUP BY\n  trip_month\nORDER BY\n  trip_month DESC\n)\n\nSELECT\n  trip_month,\n  trip_total_revenue,\n  round(sum(trip_total_revenue) over (order by trip_month asc),2) AS running_total_revenue,\nFROM\n  daily_data\nORDER BY\n  trip_month DESC\n```", "```py\nwith daily_data as (\nSELECT\n  date(timestamp_trunc(trip_start_timestamp,week(monday))) as trip_week,\n  round(sum(trip_total),2) as trip_total_revenue\nFROM\n  `spreadsheep-case-studies-2023.chicago_taxies_2023.trip_data`\nWHERE\n  date(trip_start_timestamp) between \"2023-01-01\" and \"2023-06-30\"\nGROUP BY\n  trip_week\nORDER BY\n  trip_week DESC\n)\n\nSELECT\n  trip_week,\n  trip_total_revenue,\n  if\n  (\n    COUNT(*) OVER (ORDER BY trip_week ASC ROWS BETWEEN 12 PRECEDING AND 1 PRECEDING) = 12,\n    AVG(trip_total_revenue) OVER (ORDER BY trip_week ASC ROWS BETWEEN 12 PRECEDING AND 1 PRECEDING),\n    NULL \n  ) AS moving_average\nFROM\n  daily_data\nORDER BY\n  trip_week DESC\n```", "```py\n if\n  (\n    COUNT(*) OVER (ORDER BY trip_start_date ASC ROWS BETWEEN 30 PRECEDING AND 1 PRECEDING) = 30,\n    round\n    (\n      (\n        trip_total_revenue - \n        AVG(trip_total_revenue) OVER (ORDER BY trip_start_date ASC ROWS BETWEEN 30 PRECEDING AND 1 PRECEDING)\n      ) / stddev(trip_total_revenue) OVER (ORDER BY trip_start_date ASC ROWS BETWEEN 30 PRECEDING AND 1 PRECEDING)\n    ,1),\n    NULL \n  ) AS z_score_30_day\n```", "```py\nwith daily_data as (\nSELECT\n  (trip_start_timestamp) as trip_start_date,\n  round(sum(trip_total),2) as trip_total_revenue\nFROM\n  `spreadsheep-case-studies-2023.chicago_taxies_2023.trip_data`\nWHERE\n  date(trip_start_timestamp) between \"2023-01-01\" and \"2023-06-30\"\nGROUP BY\n  trip_start_date\nORDER BY\n  trip_start_date DESC\n)\n\nSELECT\n  trip_start_date,\n  trip_total_revenue,\n  if\n  (\n    COUNT(*) OVER (ORDER BY trip_start_date ASC ROWS BETWEEN 30 PRECEDING AND 1 PRECEDING) = 30,\n    round\n    (\n      (\n        trip_total_revenue - \n        AVG(trip_total_revenue) OVER (ORDER BY trip_start_date ASC ROWS BETWEEN 30 PRECEDING AND 1 PRECEDING)\n      ) / stddev(trip_total_revenue) OVER (ORDER BY trip_start_date ASC ROWS BETWEEN 30 PRECEDING AND 1 PRECEDING)\n    ,1),\n    NULL \n  ) AS z_score_30_day\nFROM\n  daily_data\nORDER BY\n  trip_start_date DESC\n```", "```py\n rank() over (partition by trip_month order by trip_total_revenue desc) AS ranking\n```", "```py\nwith daily_data as (\nSELECT\n  date(timestamp_trunc(trip_start_timestamp,month)) as trip_month,\n  company,\n  round(sum(trip_total),2) as trip_total_revenue\nFROM\n  `spreadsheep-case-studies-2023.chicago_taxies_2023.trip_data`\nWHERE\n  date(trip_start_timestamp) between \"2023-01-01\" and \"2023-06-30\"\nGROUP BY\n  trip_month,\n  company\nORDER BY\n  trip_month DESC\n)\n\nSELECT\n  trip_month,\n  company,\n  trip_total_revenue,\n  rank() over (partition by trip_month order by trip_total_revenue desc) AS ranking\nFROM\n  daily_data\nQUALIFY\n  ranking <= 3\nORDER BY\n  trip_month DESC\n```", "```py\nwith daily_data as (\nSELECT\n  date(timestamp_trunc(trip_start_timestamp,month)) as trip_month,\n  round(sum(trip_total),2) as trip_total_revenue\nFROM\n  `spreadsheep-case-studies-2023.chicago_taxies_2023.trip_data`\nWHERE\n  date(trip_start_timestamp) between \"2023-01-01\" and \"2023-06-30\"\nGROUP BY\n  trip_month\nORDER BY\n  trip_month DESC\n)\n\nSELECT\n  trip_month,\n  trip_total_revenue,\n  lead(trip_total_revenue) over (order by trip_total_revenue asc) AS previous_month_revenue,\n  round\n  (\n    (\n      (\n        trip_total_revenue - lag(trip_total_revenue) over (order by trip_total_revenue asc)\n      ) / lag(trip_total_revenue) over (order by trip_total_revenue asc)\n    ) * 100\n  , 1) || \"%\" AS perc_change\nFROM\n  daily_data\nORDER BY\n  trip_month DESC\n```"]