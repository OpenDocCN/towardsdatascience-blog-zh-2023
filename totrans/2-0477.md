# 因果图：面对观察数据中的致命弱点

> 原文：[https://towardsdatascience.com/causal-diagram-confronting-the-achilles-heel-in-observational-data-a69cdb1c4818](https://towardsdatascience.com/causal-diagram-confronting-the-achilles-heel-in-observational-data-a69cdb1c4818)

![](../Images/78fda415395cbc77039ad581796f620e.png)

照片由 [Андрей Сизов](https://unsplash.com/@alpridephoto?utm_source=medium&utm_medium=referral) 提供于 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

## “为何之书”第3&4章，阅读与我系列

[](https://zzhu17.medium.com/?source=post_page-----a69cdb1c4818--------------------------------)[![Zijing Zhu, PhD](../Images/436b22e28798b87261c4814a7e2b20e3.png)](https://zzhu17.medium.com/?source=post_page-----a69cdb1c4818--------------------------------)[](https://towardsdatascience.com/?source=post_page-----a69cdb1c4818--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----a69cdb1c4818--------------------------------) [Zijing Zhu, PhD](https://zzhu17.medium.com/?source=post_page-----a69cdb1c4818--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----a69cdb1c4818--------------------------------) ·阅读时长13分钟·2023年11月23日

--

在我之前的两篇文章中，我 [开启了](https://medium.com/towards-data-science/read-with-me-a-causality-book-club-edd7085d6ae6) “阅读与我”系列，并完成了 [前两章](/data-tells-us-what-and-we-always-seek-for-why-66da7dc3f24d) 的阅读，书名是由朱迪亚·珀尔（Judea Pearl）所著的 “[为何之书](https://www.amazon.com/Book-Why-Science-Cause-Effect/dp/046509760X)”。这些文章讨论了引入因果关系以实现类人决策的必要性，并强调了设定未来讨论基础的因果阶梯。在这篇文章中，我们将探讨从因果关系的第一阶梯到第二阶梯的钥匙孔，带我们从概率思维进入因果思维。我们将从贝叶斯规则到贝叶斯网络，最终到因果图进行深入探讨。

# 从贝叶斯规则到逆概率

作为侦探小说的粉丝，我最喜欢的系列是《福尔摩斯探案集》。我仍然记得那些我在不知不觉中度过的日日夜夜。多年后，很多案件细节已经从我的记忆中消失，但我仍然记得那些著名的名言，如同其他人一样：

> **当你排除掉不可能的情况时，任何剩下的，无论多么不可能，必须是真相。**

将这句话翻译到统计学领域，有两种概率——前向概率和逆向概率。根据福尔摩斯的演绎推理，侦探工作就是找到逆向概率最高的凶手。

![](../Images/2e09cf5270e74fe8472500b80556712e.png)

图片来源于[Markus Winkler](https://unsplash.com/@markuswinkler?utm_source=medium&utm_medium=referral)在[Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

从正向概率到逆向概率的转变不仅仅是按顺序翻转变量，还强制建立了因果关系。正如前一篇文章简要讨论的那样，贝叶斯规则提供了一座桥梁，将客观数据（证据）与主观意见（先验信念）连接起来。基于贝叶斯规则，我们可以从任意两个变量中计算条件概率。对于任意变量A和B，给定B已发生，A发生的概率是：

[PRE0]

认为事件A发生的信念会根据事件B发生的概率来更新。事件B发生的可能性越小，P(B)越小，我对事件A发生的信念就越强。由于P(B)小于或等于1，P(A|B)总是大于或等于P(A&B)。这就是说，一个人在发现B之后对A的信念永远不会低于在发现B之前对A和B的信念。请注意，这里的条件概率适用于所有变量关系，甚至是非因果关系。然而，逆概率仅适用于因果关系。

假设这两个事件是***原因***和***证据***。正向概率表示在已知***原因***的情况下，发生***证据***的概率。另一方面，逆向概率则从结果出发，显示在已知***证据***的情况下，发生***原因***的概率。如果我们能够识别***原因***和***证据***之间的因果关系，那么我们可以根据观察到的情况推断原因的概率，这在解决实际问题时更具适用性。

![](../Images/ab77ee07e8ccc5a21b6355b16574507d.png)

图片来源于[Markus Winkler](https://unsplash.com/@markuswinkler?utm_source=medium&utm_medium=referral)在[Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

在书中，Pearl提供了一个应用实例，估计在乳腺X光检查结果为阳性的情况下，患乳腺癌的概率是多少，即**P(疾病|测试)**？首先，有一个明确的因果关系，其中乳腺癌是原因，乳腺X光检查结果是证据。当我们看到阳性测试结果时，并不意味着该患者一定患有癌症，因为没有测试是100%准确的。然而，我们可以根据测试质量来推断该患者患乳腺癌的概率，这被定义为测试的敏感性**P(测试|疾病)**。测试的敏感性实际上是正向概率，适用于一般人群。

此外，个体特定的信息也可以改善我们对每个患者的逆概率估计。例如，如果这位患者来自一个有多个家庭成员被诊断为乳腺癌的家庭，那么阳性测试结果将比没有家族癌症史的患者更可信。这些患者特定的信息作为先验被添加到最终公式中，该公式指示如何根据证据（观察到的阳性测试结果）更新先验（患乳腺癌的概率）：

[PRE1]

在数学术语中，它是：

![](../Images/d4112d3febadef0bee18db6526f7f6ae.png)

通过使用条件概率和似然比，我们可以在两个方向上更新信念。如果我们从原因处获得新的信息，我们可以通过条件概率来更新对证据的信念：

[PRE2]

P(T| D)的变化是由于P(D)的变化。如果我们从证据中获得新的信息，条件概率是不正确的，因为测试结果为阳性并不意味着你有乳腺癌。因果关系被逆转。然而，我们可以使用**似然比**来更新我们的信念。

到目前为止，我们只讨论了两个因果相关的变量，但这个规则可以应用于整个因果网络，其中父节点表示原因，子节点表示证据。子节点通过应用条件概率来更新其信念，而父节点通过乘以似然比来更新其信念。在整个网络中应用这两个规则称为***信念传播***。通过这些规则，我们超越了贝叶斯规则，理解了原因如何影响证据的生成，以及观察证据如何帮助我们推断原因。

# 混淆因素，非实验研究中的阿喀琉斯之踵

信念传播帮助我们理解变量之间的相互作用，前提是我们能够正确识别因果关系。在现实世界中，超越两个变量，我们需要将因果关系扩展到因果图，以系统地推导因果影响。但在我们进入因果图（本书的核心内容）之前，让我们简要讨论一下是什么阻碍了我们从观察数据中推导因果关系，这些被称为混淆因素。

“Confounding”在英语中意为“混淆”。它是与X和Y都有相关性的变量。请注意，这种相关性可能是因果的，也可能是非因果的。此外，在下图中，我没有指定X&Z和Y&Z之间的箭头，因为在因果情况下，X、Y和Z都可以是原因或结果，从而建立不同的因果图，这将在下一节中讨论。左侧面板显示了引入混淆变量Z如何在X和Y之间产生虚假的相关性。

![](../Images/c7f05f86f9428c92722b1f771a9331a0.png)

作者提供的图像

在右侧面板中，如果X和Y之间存在因果关系，那么一个同时影响原因X和结果Y的混杂因素Z如果没有得到妥善处理，会引入混杂偏倚。如果我们不排除混杂因素引起的影响，我们将无法揭示X对Y的真实因果效应。

在实验研究中，将受试者随机分配到处理组和对照组中的随机性可以解决混杂因素的来源偏倚（最后一节将详细讨论）。然而，进行实验来研究因果效应并不总是实际和道德的，在这种情况下，我们将不得不尝试从观察性数据中推导真实的因果影响。与实验数据不同，观察性数据中存在混杂因素，因为总有影响原因和结果的因素存在。

例如，为了研究吸烟是否导致肺癌，其中一个混杂因素是年龄。不同年龄组的吸烟率差异很大，而且年龄越大，患肺癌的概率越高。我们必须控制年龄和其他混杂因素，才能获得真实的因果影响。统计学家和社会科学家用来对抗混杂因素偏倚的常用方法是“控制”模型中的尽可能多的混杂因素。这种方法存在几个问题：

+   **并非所有的混杂因素都是可测量的：** 从直观上看，我们可以推测出可能影响我们感兴趣的因果关系的混杂因素。然而，通常无法量化这些变量或找到合适的代理变量将其纳入模型。例如，在研究高等教育是否导致更高收入时，可能的混杂因素之一是“雄心”。有雄心的人更可能被激励去获得更高的教育和更高薪的工作，但在观察性研究中，我们如何量化这个主观变量呢？

+   **遗漏变量：** 无论我们试图在研究中包含多少变量，仍然很可能没有将所有必要的和正确的混杂因素或其代理变量纳入模型，从而使因果影响出现偏倚。

+   **控制混杂因素引发偏倚：** 另一方面，在实践中，统计学家为了确保没有混杂因素被遗漏，会在模型中包括尽可能多的变量以确保去偏估计。然而，这种***过度控制***实际上可能会引发偏倚。正如政治博客作者[Ezra Klein](https://www.vox.com/2014/12/1/7311417/race-law-controls)所写：

> “你在研究中总是会看到这样的情况。‘我们控制了……’ 然后列表开始。越长越好，收入、年龄、种族、宗教、身高、发色、性取向、Crossfit 参与情况、父母的爱、可乐还是百事。你可以控制的因素越多，你的研究就越强——或者，至少，看起来你的研究更强。控制变量带来的是特异性和精确性的感觉……但有时，你可能控制得太多。有时你最终控制了你试图测量的东西。”

最终，在解决混杂偏差时，我们面临很多问题，因为这是一个 Rung 2 问题，需要我们研究变量之间的因果关系。因此，一个不涉及因果结构的 Rung 1 解决方案，如绘制因果图，将是不够的。在下一部分，我们将看到如何利用因果图以系统和可靠的方式定义和控制混杂因素。

# 建立因果图，因果关系的钥匙

## 三种基本结构

要理解什么是因果图，我们可以从所有网络的基本构建块开始。网络中有三种基本的连接点，能够表征任何箭头模式：

![](../Images/f8ae1e7ad86bb9784767d85efda9adee.png)

作者提供的表格

贝叶斯网络和因果图中都存在三种基本类型。应用贝叶斯规则在变量之间构建**贝叶斯网络**，这不过是一个庞大概率表的简洁表示。如果我们在贝叶斯网络中看到链式结构 A -> B -> C，那么 A 和 C 之间缺失的箭头意味着一旦知道了 B 的值，A 和 C 就是独立的。如果在因果图中观察到相同的链式结构，除了在控制 B 时 A 和 C 之间的相同独立性，我们还会看到通过箭头的因果流。这一结构表明 C 是由 B 引起的，B 是由 A 引起的，而 A 是外部的。如果我们将结构改变为 C -> B -> A，或变为分叉结构 A <- B -> C，我们将看到在控制 B 的情况下 A 和 C 之间的独立性完全相同，但因果结构却发生了巨大的变化。换句话说，数据无法告诉我们一切。无论数据多么庞大，没有添加主观的因果假设，我们不能区分**A -> B -> C**、**C -> B -> A**和**A <- B -> C**。

此外，从贝叶斯网络转向因果图时，我们也在将 Rung 1 的概率思维转变为 Rung 2 和 Rung 3 的因果思维。我们可以不再使用“知道 B 的值之后”这种概率表达，而改为“保持 B 不变”，这相当于从“看到 B”转变为“干预 B”。在后续部分，我们将看到这种差异源于**P(Y|X)**和**P(Y| *do*(X))**。贝叶斯网络只能告诉我们在观察到另一事件的情况下某一事件发生的可能性。然而，因果图能够回答干预和反事实问题。

## 反门准则

因果图不仅使我们转变为因果思维，还为我们提供了一个可靠的工具来发现和验证观察数据中的因果效应。正如前一章所提到的，识别正确的混杂因素是主要挑战。为了解决这个问题，Pearl 引入了 ***do-operator*** 和 ***back-door criterion***。

![](../Images/a869ae073c902440dfc71bf3fef7de66.png)

[Dima Pechurin](https://unsplash.com/@pechka?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral) 上的照片

关键是弄清楚因果图，do-operator 消除了所有进入 X 的箭头，从而防止任何有关 X 的信息流向非因果方向。而 P(Y| X) 显示了带有混杂偏差的因果效应，概率 P(Y| *do*(X)) 显示了真正的因果影响。这意味着通过阻塞其他混杂因素的信息流，如果我改变 X，Y 会如何变化？根据不同的因果结构，我们需要控制或不控制不同的变量来阻塞信息流。

![](../Images/5e6b1fee4f804e3635ede20077ee2495.png)

作者提供的表格

为了获得 P(Y| *do*(X))，我们需要确保信息流从 X 到 Y 仅直接来自 X 到 Y。为了实现这一目标，我们需要阻塞 X 和 Y 之间的所有非因果路径，而不干扰任何因果路径。这些非因果路径被称为 X 的反门路径，即任何从 X 到 Y 的路径，该路径以指向 X 的箭头开始。通过以下五个示例，可以更容易理解这一概念：

![](../Images/ad795670aa9534a799f3b76ae9cec5e8.png)

作者提供的表格，Game2 中有误，如果你控制 D，那么我们可以控制 A **或 D** 来阻塞路径。

通过指定因果图，我们已经将控制尽可能多的混杂因素的过程转变为识别反门路径并找出如何有效地阻塞它们。如笔记中所述，并不总是需要控制尽可能多的变量以确保真正的因果效应。实际上，控制错误的变量可能会：

+   减少或阻塞 X 和 Y 之间的因果路径。例如，在游戏 1 中，如果我们控制 A，就会阻塞 X 和 Y 之间的因果路径；如果我们控制 B，A 的后代，则部分阻塞它。

+   引入 X 和 Y 的碰撞偏差。例如，在游戏 4 中，控制 B 会使 X 和 Y 在没有因果关系的情况下依赖。游戏 4 也被称为“ M 偏差”，因为它的形状。

+   控制正确的混杂因素，而不是尽可能多的因素。例如，在游戏 5 中，我们可以选择同时控制 B 和 A，或者仅控制 C 以达到相同的结果。

每一个图示都可以在现实世界的例子中找到。例如，在游戏1中表示一个医学应用，估计吸烟（X）对流产（Y）的影响。A 是由吸烟引起的潜在异常，因为我们不知道具体是什么异常被吸烟引起，所以它是不可观察的。B 是之前流产的历史。将流产历史包含到模型中是非常诱人的，但从因果图中可以看出，如果这样做，会部分失效吸烟对流产的机制，从而低估真正的因果影响。Pearl 的书中的这两章还有更多现实世界的应用。即使因果图可能变得过于复杂，使人脑无法找到后门路径，不要忘记我们总是可以依靠计算机算法来破解这些类型的问题。

## 为什么随机对照试验（RCT）有效？

我们已经使用因果图讨论了足够的非实验性研究。我们如何使用因果图和后门准则来解释为什么 RCT 能够得出无偏的因果影响？让我们看看一个例子，尝试找出不同肥料如何影响土壤产量。在现实世界中，农民根据许多因素决定使用哪种肥料，比如土壤肥力、土壤纹理，这些因素也会影响产量。我们可以在因果图中展示：

![](../Images/e1063ff03440b02ff41214a31383fe96.png)

图片由作者提供

所有的橙色线条展示了偏倚肥料对产量因果影响的混杂关系。为了解决这个问题，我们需要在模型中控制所有这些混杂因素。请注意，这可能不太可能，因为这里的“其他”因素可能很难命名和量化。然而，如果现在我们设计一个实验，仅通过抽取随机卡片来决定每块土地使用哪种肥料。现在因果图变成了这样的：

![](../Images/cb03de7bfaf18459d7fc0c3545609359.png)

图片由作者提供

通过在图示中添加随机卡片，我们可以去除之前图示中的所有混杂橙色线条，因为我们使用哪种肥料不再依赖于这些变量。它纯粹是一个仅受随机卡片抽取影响的随机决策。后门准则已经满足了用来估计肥料和产量的因果影响。

这就是我想分享的关于 Judea Pearl 的《为什么书》第三章和第四章的内容，这也完成了本系列“与我一起阅读”的第三篇文章。希望这篇文章对你有帮助。如果你还没阅读前两篇文章，可以在这里查看：

[](/read-with-me-a-causality-book-club-edd7085d6ae6?source=post_page-----a69cdb1c4818--------------------------------) [## 与我一起阅读：因果关系书籍俱乐部

### 从一个猫的故事开始……

towardsdatascience.com](/read-with-me-a-causality-book-club-edd7085d6ae6?source=post_page-----a69cdb1c4818--------------------------------) [](/data-tells-us-what-and-we-always-seek-for-why-66da7dc3f24d?source=post_page-----a69cdb1c4818--------------------------------) [## 数据告诉我们“什么”，而我们总是寻求“为什么”

### “为什么的书” 第1章与第2章，阅读系列

towardsdatascience.com](/data-tells-us-what-and-we-always-seek-for-why-66da7dc3f24d?source=post_page-----a69cdb1c4818--------------------------------)

如果你感兴趣，[订阅我的邮件列表](https://zzhu17.medium.com/subscribe) 参加每两周一次的讨论，这些讨论将变得越来越技术性：

+   [**第五章与第六章：为何理解数据生成过程比数据本身更重要**](https://medium.com/towards-data-science/why-understanding-the-data-generation-process-is-more-important-than-the-data-itself-f1b3b847e662)

+   [**第七章与第八章：你不能两次踏入同一条河流**](https://medium.com/towards-data-science/you-cant-step-in-the-same-river-twice-cfacf7cee305)

+   [**第九章与第十章：什么造就了强大的 AI**](https://medium.com/towards-data-science/what-makes-a-strong-ai-012315722793)

+   [**附赠：因果推断在学术界和工业界有何不同？**](/how-is-causal-inference-different-in-academia-and-industry-fb5afd12e2e7)

书中展示了更多细节和例子。正如往常一样，我强烈建议你阅读、思考，并在这里或你的 [***个人博客***](https://youtu.be/oFDl0-SKAL8?si=r1QiRIizhDBdvX-A) 上分享你的主要收获。

感谢阅读。如果你喜欢这篇文章，别忘了：

+   ***查看我最近的文章，关于*** [***数据讲故事中的4Ds：将科学变成艺术***](https://medium.com/towards-data-science/the-4ds-in-data-storytelling-making-art-out-of-science-c4998ed7875e)***；*** [***数据科学中的持续学习***](/continuous-learning-a-data-scientists-odyssey-8d3006c2ce01)***；*** [***我如何成为数据科学家***](/how-i-became-a-data-scientist-7f5b10606612)***；***

+   ***查看我的*** [***其他文章***](https://zzhu17.medium.com/my-blog-posts-gallery-ac6e01fe5cc3) ***，涉及不同主题，如*** [***数据科学面试准备***](https://zzhu17.medium.com/list/data-science-interview-preparation-bfb0986a61a3)***；*** [***因果推断***](/causal-inference-what-why-and-how-d7336b0081ec)***；***

+   [***订阅***](https://zzhu17.medium.com/subscribe) ***我的邮件列表；***

+   [***注册 Medium 会员***](https://zzhu17.medium.com/membership)***；***

+   ***或者在*** [***YouTube***](https://youtube.com/channel/UCMs6go1pvY5OOy1DXVtMo5A) ***上关注我，观看我最近的 YouTube 视频，关于我读的其他书籍：***

# 参考

[***为什么的书***](https://www.amazon.com/Book-Why-Science-Cause-Effect/dp/046509760X) ***作者为 Judea Pearl***
