# 使用 AWS SageMaker AutoML 实现机器学习的民主化

> 原文：[https://towardsdatascience.com/democratizing-machine-learning-with-aws-sagemaker-automl-150299c70396](https://towardsdatascience.com/democratizing-machine-learning-with-aws-sagemaker-automl-150299c70396)

## 概述

[](https://brus-patrick63.medium.com/?source=post_page-----150299c70396--------------------------------)[![Patrick Brus](../Images/a252fe1c4f7a9ed2225d415571137e45.png)](https://brus-patrick63.medium.com/?source=post_page-----150299c70396--------------------------------)[](https://towardsdatascience.com/?source=post_page-----150299c70396--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----150299c70396--------------------------------) [Patrick Brus](https://brus-patrick63.medium.com/?source=post_page-----150299c70396--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----150299c70396--------------------------------) ·16 分钟阅读·2023年4月25日

--

![](../Images/9d6177546bde28b57814053a64914628.png)

图片由 [Joshua Sortino](https://unsplash.com/@sortino?utm_source=medium&utm_medium=referral) 提供，来源于 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

# 介绍

AI 目前仍然是最热门的话题之一，尤其是随着 ChatGPT 的崛起。许多公司现在正尝试利用 AI 从数据中提取有用的见解，以优化他们的流程或开发更好的产品。

然而，构建有效的 AI 模型需要在不同领域具备大量专业知识，如数据预处理、模型选择、超参数调优等。所有这些领域都可能耗时且需要专业知识。

这就是 AutoML 发挥作用的地方。AutoML 自动化了构建 AI 模型所需的许多领域。

AutoML 正迅速成为企业和数据科学家们喜爱的解决方案。它使组织能够利用 ML 和 AI 做出明智的决策，而无需成为数据科学专家。随着企业对 ML 需求的增加，AutoML 提供了一种简单高效的方式来创建准确的模型，无论个人的专业知识水平如何。

在本文中，我们将考察市场上一个非常流行的 AutoML 工具——AWS SageMaker AutoML，并展示如何利用它解决复杂的 ML 使用案例。

我将用传统的手动方法训练一个模型，并将其结果与 AWS SageMaker AutoML 产生的结果进行比较。

我将使用 Kaggle 上的信用卡欺诈检测数据集进行对比 [1]。你可以在[这里](https://www.kaggle.com/datasets/mlg-ulb/creditcardfraud)找到数据集。

在本文结束时，你将清楚了解 AutoML 如何帮助利用 ML 驱动有意义的见解并做出明智的决策。

# AWS SageMaker AutoML

![](../Images/f89b70e37f4074e49b6a1784eb5d35ef.png)

图 1：AWS SageMaker AutoML 概述（作者提供的图像，基于 [2]）。

图 1 展示了 AWS SageMaker AutoML 解决的不同步骤概述。

其包含以下步骤：

1.  **数据准备：** 你可以轻松地将数据上传到 Amazon S3。一旦数据上传完毕，SageMaker AutoML 会自动分析数据，以检测任何缺失值、异常值或需要转换的数据类型。

1.  **自动模型创建：** AWS SageMaker AutoML 自动训练多个机器学习模型，使用不同的超参数和算法，以确定最适合你数据的模型。它还提供了自动模型调优，调整所选模型的超参数以进一步优化其性能。它还为你创建运行模型选择的笔记本，以便你可以全面了解在此过程中执行了什么。

1.  **模型部署：** 一旦选择了最佳模型，AWS SageMaker 提供将模型部署到 SageMaker 端点或批处理转换作业的选项，在那里它可以用于对新数据进行预测。此外，AWS SageMaker Model Monitor 可以用于在出现问题（如数据漂移、概念漂移等）时发出警报。它还提供了重新训练模型的新数据、更新模型的超参数或算法以提升性能的工具。

AWS SageMaker AutoML 提供了一个 [Python SDK](https://sagemaker.readthedocs.io/en/stable/api/training/automl.html)，可以用于启动 AutoML 作业，并且有一个 [GitHub 仓库](https://github.com/aws/amazon-sagemaker-examples/tree/main/autopilot)，其中包含了各种不同的笔记本示例，展示了如何利用 AutoML SDK 处理具体的机器学习用例。

市场上还提供了其他强大且知名的 AutoML 工具，如 Google Cloud AutoML 和 H2O.ai，它们也有各自独特的优势和劣势。

Google Cloud AutoML 以其易用性和直观的界面而闻名，这使其非常适合机器学习新手，并且对编码要求不高。Google Cloud AutoML 支持图像数据、视频数据、文本数据和表格数据。你可以在 [这里](https://cloud.google.com/vertex-ai/docs/training-overview?hl=en#automl) 了解更多信息。

H2O.ai 以其速度和可扩展性而闻名，使其成为处理大数据集和复杂模型的良好选择。H2O.ai 提供 R、Python 或网页 GUI 的接口。你可以在 [这里](https://h2o.ai/platform/h2o-automl/) 了解更多关于其功能的信息。

# 手动训练方法

在使用 AWS SageMaker AutoML 来生成信用卡数据集的分类器之前，我首先以传统方式训练一个模型：从头开始做所有事情。

这将有助于我建立一个基准，并将我的方法与AWS的AutoML方法进行比较，期望AWS SageMaker AutoML能超越我的手动半优化方法。

对于手动方法，我使用了Scikit-learn，并将通过下一章中强调的步骤进行操作。

你也可以在我的GitHub仓库中找到完整的笔记本 [这里](https://github.com/patrickbrus/aws-auto-ml-credit-fraud/blob/master/manual-approach/credit-fraud-ml.ipynb)。

## **数据准备**

我从CSV文件中加载数据集，首先检查数据集的分布。这显示数据集高度不平衡，只有**0.17%**的样本是正例。

数据集本身不包含任何缺失值。

然后我将数据集按80/20的比例拆分为训练集和测试集，并将数据缩放到0–1的范围内，同时标准化器仅在训练集上进行训练，以避免一些过于乐观的结果。

下面可以找到这些步骤的代码。

[PRE0]

通常，广泛的探索性数据分析（EDA）也会是数据准备步骤的一部分。但是为了这个实验，我没有进行广泛的EDA，因为数据集已经为ML做好了充分的准备。

但请记住，这部分对于你的ML训练的成功也是至关重要的，并且通常需要一些时间。

## 模型选择

下一步是找出哪种ML算法最适合数据。为此，我首先使用逻辑回归训练一个非常简单的基准模型。这是为了有一个简单的模型，我可以将其与更复杂的算法进行比较。

目标应始终是：保持简单！不要从神经网络开始，如果一个简单的算法，比如逻辑回归，能够完成任务，神经网络可能更难以解释。

逻辑回归模型的F1-Score为**70.6%**。我使用F1-Score来评估这个数据集，因为它高度不平衡，准确率不会提供有意义的模型评估，因为仅预测所有类别为负例就已经会导致超过**99%**的准确率！

下面可以找到训练基准模型的代码。

[PRE1]

好的，我们现在有了基准。接下来尝试不同的分类算法及其默认超参数，看看哪个算法在数据上表现最好。

我使用了5折交叉验证来训练以下每个模型：

+   决策树

+   支持向量机

+   k-近邻

+   随机森林

+   自适应提升

[PRE2]

随机森林算法以**86.9%**的F1-Score取得了最佳结果，其次是最近邻算法，F1-Score为**84.8%**。不错！

下一步是对获胜者（随机森林）进行微调。

为此，我选择了一些要尝试的超参数值，并使用随机化交叉验证搜索来找到最佳超参数组合，从而获得最佳模型。

这次评估的代码：

[PRE3]

最佳模型的得分多多少少与我在没有调整超参数的情况下获得的模型相同。真是浪费时间 ;)

## 模型评估

最后但同样重要的是，我在留出的测试集上评估我的最终模型，以查看它在真实世界数据上的表现。

[PRE4]

这给了我一个**82%**的F1分数，接近我们的验证结果，但略低一些。

我知道通过更多地调整模型可以获得更多收益。但本文的目标只是做一些基本的机器学习，并将结果与AutoML进行比较，以查看AutoML的表现有多好，以及与仅自己做基础训练相比，运行AutoML作业的工作量有多大。

# 使用AWS SageMaker AutoML进行训练

好了，现在我有了基准，可以尝试使用AWS SageMaker AutoML以更少的努力获得更好的模型。

我将再次指导你完成不同的步骤，并提供所有这些步骤的代码片段。你还可以在我的GitHub仓库[这里](https://github.com/patrickbrus/aws-auto-ml-credit-fraud/blob/master/sagemaker-auto-ml/fraud-detection-auto-ml-sagemaker.ipynb)找到完整的笔记本。

## 数据上传

为了使SageMaker AutoML正常工作，数据需要存储在s3中。因此，我首先创建一个桶，然后将CSV文件上传到这个桶中（Gif 1）。

![](../Images/e923a4bc225c20097934150620449b6e.png)

Gif 1：创建s3桶并将CSV文件上传到此桶中（Gif由作者提供）。

## 设置SageMaker笔记本

下一步是设置我可以在其中运行AutoML作业的环境。

为了实现这一点，我首先在SageMaker中创建一个笔记本，然后在其中创建和运行代码。

在AWS中，其他服务对服务的访问由IAM角色处理。SageMaker笔记本附带了一个带有默认访问权限的IAM角色。但为了访问我之前创建的s3桶，我首先必须明确调整附加到该角色的策略。

Gif 2展示了创建笔记本的完整过程以及我如何调整笔记本角色的策略。质量不太好，但我仍然认为看到所采取的操作顺序是有价值的。此外，我还添加了一些创建笔记本时的具体设置截图（图2），并在我的GitHub仓库[这里](https://github.com/patrickbrus/aws-auto-ml-credit-fraud/blob/master/sagemaker-auto-ml/notebook-role-policy.json)添加了我附加到笔记本角色的完整策略。

![](../Images/e107018d2acca85d14be0000890bfe55.png)

Gif 2：创建笔记本的过程以及如何调整附加IAM角色的策略（Gif由作者提供）。

![](../Images/8e346589e66bbb7879cbd5d54085127e.png)

图2：AWS SageMaker笔记本创建设置（图片由作者提供）。

## 运行AWS SageMaker AutoML作业

现在我终于可以开始运行一些代码了。

我运行的代码大多是从[这个](https://gitlab.com/juliensimon/aim307/-/blob/master/aim307.ipynb)AWS教程笔记本中复制并调整过来的。

首先，我将数据从 s3 加载到 Pandas 数据框中，并设置一些 SageMaker AutoML 之后所需的一般变量。

[PRE5]

然后，我将数据集分成训练集和保留测试集。我将使用后者来比较 AutoML 模型和我自己训练的模型。然后，我将数据上传到 SageMaker 创建的 s3 桶中，以便 AutoML 任务可以直接从 s3 访问它。

[PRE6]

现在我可以设置 AutoML 任务并启动它。你可以在 SageMaker SDK 文档[这里](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker/client/create_auto_ml_job.html#)找到有关所需输入参数和设置的更多信息。

[PRE7]

任务现在在后台运行，为你创建所需的 AWS 资源。

然后，你可以运行以下代码来跟踪 AutoML 任务的进度：

[PRE8]

任务正在通过以下阶段：

1.  数据分析

1.  特征工程

1.  模型调优

1.  合并 AutoML 任务报告

AWS SageMaker 为你生成了两个笔记本。一个用于探索数据，另一个用于定义在数据集上进行评估的不同候选模型。如果你对 AWS SageMaker 在这些阶段运行的代码感兴趣，可以查看这些笔记本。

可以列出 AWS SageMaker 执行的所有实验，并且你也可以列出所有探讨过的候选模型。我在这篇文章中没有添加代码，但如果你对其工作原理感兴趣，可以在我的[笔记本](https://github.com/patrickbrus/aws-auto-ml-credit-fraud/blob/master/sagemaker-auto-ml/fraud-detection-auto-ml-sagemaker.ipynb)中找到代码。

## 在测试集上评估最佳候选模型

现在是时候在保留测试集上测试最佳候选模型了。对我来说，这是最有趣的部分，因为它显示了 AutoML 是否能比我的手动方法得分更高。

首先，我从 AWS SageMaker AutoML 任务中检索最佳候选模型。

[PRE9]

接下来，我将在 AWS 中将此模型作为端点进行托管，以便我可以将数据发送给它进行推断。

[PRE10]

最后但同样重要的是，读取包含测试数据的 CSV 文件，并将数据发送到最终模型进行推断。然后，我将预测结果与真实值进行比较，并使用相当手动的方法来计算真正例、假负例、假正例和真正例。

老实说，我只是懒得自己实现一些东西，而是再次从 AWS SageMaker 教程笔记本中适配了代码，你可以在[这里](https://gitlab.com/juliensimon/aim307/-/blob/master/aim307.ipynb)找到。

[PRE11]

最终模型在保留测试集上达到了**96%**的 F1-Score！

这太棒了！相比之下，我用 Scikit-Learn 训练的模型仅达到了**82%**的 F1-Score。

# AutoML 的不足之处

AutoML 确实强大，可以帮助加快 ML 开发周期。但也存在一些使用 AutoML 的不足之处，需要认识到。

AutoML的主要限制之一是它可能是一种黑箱方法，因为它自动化了构建机器学习模型的大部分过程。这可能使数据科学家很难完全理解模型的工作原理，并可能限制他们微调模型或调试出现的问题的能力。

AWS通过提供Jupyter笔记本来应对这一问题，展示了数据探索或探索不同ML候选模型等阶段的代码。这已经有助于获取一些见解，但如果代码或AutoML任务的结果出现任何问题，数据科学家无法对背后的代码进行更改，因为一切都是自动生成的。

使用AutoML的另一个潜在缺点是，它可能比传统的机器学习模型构建方法灵活性差。AutoML优化了效率和易用性，但这可能以定制选项或处理专用数据集或模型的能力为代价。

在这篇文章中，我使用了一个非常简单的数据集，AWS SageMaker AutoML能够训练出一个不错的候选模型。但如果遇到更具挑战性的数据集，AutoML在这些数据集上的表现如何还不清楚。

# 个人发现

在这一章中，我想强调我在使用AWS SageMaker AutoML时的个人发现。

我首先意识到使用和设置AWS SageMaker AutoML相当复杂。我个人在使用AWS和编码方面有一定经验，但对于没有太多先前知识的人来说，使用AWS SageMaker AutoML的学习曲线可能过于陡峭。

我还认为文档质量不够好。我一开始在文档中很难找到关于端到端用例的内容。后来我找到了视频培训和GitHub上的示例笔记本，但我个人更喜欢书面的文档而非视频。

另外，请注意成本。我最初在SageMaker AutoML中进行了一些尝试，频繁运行AutoML任务，因为我想在其中尝试不同的东西。但这并没有像我预期的那样便宜，结果我在这个实验上的花费比计划的要多。

# 结论

在这篇文章中，我将AWS SageMaker AutoML与使用Scikit-Learn手动训练模型进行了比较。

作为数据集，我决定使用欺诈检测数据集，因为它由于高度不平衡而存在一些困难。

然后我手动尝试找出一个好的分类器，并在AWS SageMaker AutoML中做了同样的尝试。

我最终将两种方法的结果在一个保留测试集上进行了比较，其中AWS SageMaker AutoML的得分高于我的手动方法，达到了**96%**的F1分数，而我的手动方法为**82%**。

这表明，使用AWS SageMaker AutoML在你的数据集上训练ML模型以快速生成一个可用的分类器是完全合理的。

甚至不需要在机器学习领域有专门的知识就可以使用AWS SageMaker AutoML。

当然，我的手动方法也需要谨慎对待。

我没有花很多时间来优化我的最终分类器，我相当确定，如果再多投入一些时间，我会在保留测试集上获得更好的结果。

至少我希望如此 ;)

但这篇文章的目的就是展示如何轻松地利用AutoML库为你的机器学习数据集创建一个分类器。

最终，这不一定是你投入到产品中的最终版本，但你可以至少做一个快速的初步概念验证，以查看你是否能从数据中获得有用的信息。

# 展望

迄今为止，我只深入了解了AWS SageMaker AutoML，但肯定也很有兴趣查看其他服务，例如Google Cloud AutoML。

我计划在不久的将来对Google Cloud的Vertex AI进行全面评估，然后会在Medium上写出我的发现。

然后我还可以具体讨论Sagemaker与Google Cloud的表现相比如何。

所以如果你不想错过这些内容，请关注我！

感谢你读到我的文章的最后！我希望你喜欢这篇文章。如果你想将来阅读更多类似的文章，关注我以保持更新。

[**如果你想了解更多关于机器学习和云计算的信息，请加入我的邮件列表。**](https://medium.com/subscribe/@brus-patrick63)

# 联系方式

[**LinkedIn**](https://www.linkedin.com/in/patrick-brus/) | [**GitHub**](https://github.com/patrickbrus)

# 参考文献

[1]: 机器学习组 — ULB，[“信用卡欺诈检测”](https://www.kaggle.com/datasets/mlg-ulb/creditcardfraud)，Kaggle，2018年，[数据库内容许可证](https://opendatacommons.org/licenses/dbcl/1-0/) (DbCL) v1.0

[2]: AWS，[Amazon SageMaker Autopilot](https://aws.amazon.com/sagemaker/autopilot/?sagemaker-data-wrangler-whats-new.sort-by=item.additionalFields.postDateTime&sagemaker-data-wrangler-whats-new.sort-order=desc)（访问于2023年4月1日）
