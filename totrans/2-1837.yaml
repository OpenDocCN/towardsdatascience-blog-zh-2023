- en: 'Setting up Python Projects: Part VI'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 'è®¾ç½® Python é¡¹ç›®: ç¬¬å…­éƒ¨åˆ†'
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/setting-up-python-projects-part-vi-cbdbf28eff53](https://towardsdatascience.com/setting-up-python-projects-part-vi-cbdbf28eff53)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/setting-up-python-projects-part-vi-cbdbf28eff53](https://towardsdatascience.com/setting-up-python-projects-part-vi-cbdbf28eff53)
- en: 'Mastering the Art of Python Project Setup: A Step-by-Step Guide'
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 'æŒæ¡ Python é¡¹ç›®è®¾ç½®çš„è‰ºæœ¯: ä¸€æ­¥ä¸€æ­¥çš„æŒ‡å—'
- en: '[](https://johschmidt42.medium.com/?source=post_page-----cbdbf28eff53--------------------------------)[![Johannes
    Schmidt](../Images/e0cacf7ff37f339a9bf8bd33c7c83a4d.png)](https://johschmidt42.medium.com/?source=post_page-----cbdbf28eff53--------------------------------)[](https://towardsdatascience.com/?source=post_page-----cbdbf28eff53--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----cbdbf28eff53--------------------------------)
    [Johannes Schmidt](https://johschmidt42.medium.com/?source=post_page-----cbdbf28eff53--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://johschmidt42.medium.com/?source=post_page-----cbdbf28eff53--------------------------------)[![Johannes
    Schmidt](../Images/e0cacf7ff37f339a9bf8bd33c7c83a4d.png)](https://johschmidt42.medium.com/?source=post_page-----cbdbf28eff53--------------------------------)[](https://towardsdatascience.com/?source=post_page-----cbdbf28eff53--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----cbdbf28eff53--------------------------------)
    [Johannes Schmidt](https://johschmidt42.medium.com/?source=post_page-----cbdbf28eff53--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----cbdbf28eff53--------------------------------)
    Â·26 min readÂ·Apr 10, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘å¸ƒäº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----cbdbf28eff53--------------------------------)
    Â·é˜…è¯»æ—¶é—´ 26 åˆ†é’ŸÂ·2023å¹´4æœˆ10æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/1093eac93ddb53f3ce2570a3fa7c32bf.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/1093eac93ddb53f3ce2570a3fa7c32bf.png)'
- en: Photo by [Amira El Fohail](https://unsplash.com/@amirasartistry?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”± [Amira El Fohail](https://unsplash.com/@amirasartistry?utm_source=medium&utm_medium=referral)
    æä¾›ï¼Œæ¥æºäº [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
- en: Whether youâ€™re a seasoned developer or just getting started with ğŸ **Python**,
    itâ€™s important to know how to build robust and maintainable projects. This tutorial
    will guide you through the process of setting up a Python project using some of
    the most popular and effective tools in the industry. You will learn how to use
    [GitHub](https://github.com/) and [GitHub Actions](https://github.com/features/actions)
    for version control and continuous integration, as well as other tools for testing,
    documentation, packaging and distribution. The tutorial is inspired by resources
    such as [Hypermodern Python](https://medium.com/@cjolowicz/hypermodern-python-d44485d9d769)
    and [Best Practices for a new Python project](https://mitelman.engineering/blog/python-best-practice/automating-python-best-practices-for-a-new-project/).
    However, this is not the only way to do things and you might have different preferences
    or opinions. The tutorial is intended to be beginner-friendly but also cover some
    advanced topics. In each section, you will automate some tasks and add badges
    to your project to show your progress and achievements.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: æ— è®ºä½ æ˜¯ç»éªŒä¸°å¯Œçš„å¼€å‘è€…è¿˜æ˜¯åˆšåˆšå¼€å§‹æ¥è§¦ğŸ **Python**ï¼Œäº†è§£å¦‚ä½•æ„å»ºç¨³å¥ä¸”å¯ç»´æŠ¤çš„é¡¹ç›®éƒ½æ˜¯å¾ˆé‡è¦çš„ã€‚æœ¬æ–‡æ•™ç¨‹å°†å¼•å¯¼ä½ å®Œæˆä½¿ç”¨ä¸€äº›è¡Œä¸šå†…æœ€å—æ¬¢è¿å’Œæœ‰æ•ˆçš„å·¥å…·æ¥è®¾ç½®
    Python é¡¹ç›®çš„è¿‡ç¨‹ã€‚ä½ å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ [GitHub](https://github.com/) å’Œ [GitHub Actions](https://github.com/features/actions)
    è¿›è¡Œç‰ˆæœ¬æ§åˆ¶å’ŒæŒç»­é›†æˆï¼Œä»¥åŠå…¶ä»–ç”¨äºæµ‹è¯•ã€æ–‡æ¡£ç¼–å†™ã€æ‰“åŒ…å’Œåˆ†å‘çš„å·¥å…·ã€‚è¯¥æ•™ç¨‹çµæ„Ÿæ¥æºäº [Hypermodern Python](https://medium.com/@cjolowicz/hypermodern-python-d44485d9d769)
    å’Œ [æ–° Python é¡¹ç›®çš„æœ€ä½³å®è·µ](https://mitelman.engineering/blog/python-best-practice/automating-python-best-practices-for-a-new-project/)ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯å”¯ä¸€çš„æ–¹æ³•ï¼Œä½ å¯èƒ½æœ‰ä¸åŒçš„åå¥½æˆ–æ„è§ã€‚æ•™ç¨‹æ—¨åœ¨å¯¹åˆå­¦è€…å‹å¥½ï¼ŒåŒæ—¶ä¹Ÿæ¶µç›–ä¸€äº›é«˜çº§ä¸»é¢˜ã€‚åœ¨æ¯ä¸ªéƒ¨åˆ†ï¼Œä½ å°†è‡ªåŠ¨åŒ–ä¸€äº›ä»»åŠ¡ï¼Œå¹¶ä¸ºä½ çš„é¡¹ç›®æ·»åŠ å¾½ç« ä»¥å±•ç¤ºä½ çš„è¿›å±•å’Œæˆå°±ã€‚
- en: The repository for this series can be found at [github.com/johschmidt42/python-project-johannes](https://github.com/johschmidt42/python-project-johannes)
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬ç³»åˆ—çš„ä»£ç åº“å¯ä»¥åœ¨ [github.com/johschmidt42/python-project-johannes](https://github.com/johschmidt42/python-project-johannes)
    æ‰¾åˆ°
- en: Requirements
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è¦æ±‚
- en: '**OS**: Linux, Unix, macOS, Windows (WSL2 with e.g. Ubuntu 20.04 LTS)'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**æ“ä½œç³»ç»Ÿ**: Linux, Unix, macOS, Windows (WSL2ï¼Œä¾‹å¦‚ Ubuntu 20.04 LTS)'
- en: '**Tools**: python3.10, bash, git, tree'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**å·¥å…·**: python3.10, bash, git, tree'
- en: '**Version Control System (VCS) Host**: [GitHub](https://github.com/)'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (VCS) ä¸»æœº**: [GitHub](https://github.com/)'
- en: '**Continuous Integration (CI) Tool**: [GitHub Actions](https://github.com/features/actions)'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**æŒç»­é›†æˆ (CI) å·¥å…·**: [GitHub Actions](https://github.com/features/actions)'
- en: 'It is expected that you are familiar with the versioning control system (VCS)
    [git](https://git-scm.com/). If not, hereâ€™s a refresher for you: [Introduction
    to Git](https://realpython.com/python-git-github-intro/)'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: é¢„è®¡ä½ å¯¹ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (VCS) [git](https://git-scm.com/) å·²ç»ç†Ÿæ‚‰ã€‚å¦‚æœä¸ç†Ÿæ‚‰ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¤ä¹ èµ„æ–™ï¼š[Git å…¥é—¨ä»‹ç»](https://realpython.com/python-git-github-intro/)
- en: Commits will be based on [best practices for git commits](https://deepsource.io/blog/git-best-practices/)
    & [Conventional commits](https://www.conventionalcommits.org/en/v1.0.0/). There
    is the [conventional commit plugin](https://plugins.jetbrains.com/plugin/13389-conventional-commit)
    for PyCharm or a [VSCode Extension](https://github.com/vivaxy/vscode-conventional-commits)
    that help you to write commits in this format.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: æäº¤å°†åŸºäº [æœ€ä½³ git æäº¤å®è·µ](https://deepsource.io/blog/git-best-practices/) å’Œ [çº¦å®šå¼æäº¤](https://www.conventionalcommits.org/en/v1.0.0/)ã€‚å¯¹äº
    PyCharmï¼Œæœ‰ [çº¦å®šå¼æäº¤æ’ä»¶](https://plugins.jetbrains.com/plugin/13389-conventional-commit)
    æˆ–è€… [VSCode æ‰©å±•](https://github.com/vivaxy/vscode-conventional-commits) å¯ä»¥å¸®åŠ©ä½ æŒ‰ç…§è¿™ç§æ ¼å¼æ’°å†™æäº¤ã€‚
- en: Overview
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ¦‚è¿°
- en: '[Part I (GitHub, IDE)](https://johschmidt42.medium.com/setting-up-python-projects-part-i-408603868c08)'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[ç¬¬ä¸€éƒ¨åˆ† (GitHub, IDE)](https://johschmidt42.medium.com/setting-up-python-projects-part-i-408603868c08)'
- en: Part II (Formatting, Linting, CI)
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç¬¬äºŒéƒ¨åˆ† (æ ¼å¼åŒ–ã€Lintingã€CI)
- en: Part III (Testing, CI)
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç¬¬ä¸‰éƒ¨åˆ† (æµ‹è¯•ã€CI)
- en: '[Part IV (Documentation, CI/CD)](https://johschmidt42.medium.com/setting-up-python-projects-part-iv-82059eba4ca4)'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[ç¬¬å››éƒ¨åˆ† (æ–‡æ¡£ã€CI/CD)](https://johschmidt42.medium.com/setting-up-python-projects-part-iv-82059eba4ca4)'
- en: '[Part V (Versioning & Releases, CI/CD)](https://medium.com/@johschmidt42/setting-up-python-projects-part-v-206df3c1e3d3)'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[ç¬¬äº”éƒ¨åˆ† (ç‰ˆæœ¬æ§åˆ¶ä¸å‘å¸ƒï¼ŒCI/CD)](https://medium.com/@johschmidt42/setting-up-python-projects-part-v-206df3c1e3d3)'
- en: '**Part VI (Containerisation, Docker, CI/CD)**'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ç¬¬å…­éƒ¨åˆ† (å®¹å™¨åŒ–ã€Dockerã€CI/CD)**'
- en: Structure
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç»“æ„
- en: Containerisation
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å®¹å™¨åŒ–
- en: Docker
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Docker
- en: Dockerfile
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Dockerfile
- en: Docker image
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Docker é•œåƒ
- en: Docker container
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Docker å®¹å™¨
- en: Docker stages (*base, builder, production*)
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Docker é˜¶æ®µ (*åŸºç¡€ã€æ„å»ºã€ç”Ÿäº§*)
- en: Container registries (*ghcr.io*)
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å®¹å™¨æ³¨å†Œä¸­å¿ƒ (*ghcr.io*)
- en: Docker push
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Docker æ¨é€
- en: CI (*build.yml & build_and_push.yml*)
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CI (*build.yml & build_and_push.yml*)
- en: Badge (*Build*)
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¾½ç«  (*æ„å»º*)
- en: Bonus (*trivy*)
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¥–åŠ± (*trivy*)
- en: In this article, we will explore the concept of **containerisation**, its benefits,
    and how it can be used with **Docker** to create and manage containerised applications.
    We will use **GitHub Actions** to continuously build Docker images & upload them
    to our repository when a new version is released.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨**å®¹å™¨åŒ–**çš„æ¦‚å¿µåŠå…¶å¥½å¤„ï¼Œä»¥åŠå¦‚ä½•ä¸**Docker**ç»“åˆä½¿ç”¨ï¼Œä»¥åˆ›å»ºå’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ã€‚æˆ‘ä»¬å°†ä½¿ç”¨**GitHub Actions**æ¥æŒç»­æ„å»º
    Docker é•œåƒå¹¶åœ¨å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶å°†å…¶ä¸Šä¼ åˆ°æˆ‘ä»¬çš„ä»“åº“ã€‚
- en: Containerisation
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å®¹å™¨åŒ–
- en: Containerisation is a modern technology that has revolutionised the way software
    applications are developed, deployed, and managed. It has gained widespread adoption
    in recent years due to its ability to solve some of the biggest challenges in
    software development and deployment.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: å®¹å™¨åŒ–æ˜¯ä¸€é¡¹ç°ä»£æŠ€æœ¯ï¼Œå®ƒå½»åº•æ”¹å˜äº†è½¯ä»¶åº”ç”¨çš„å¼€å‘ã€éƒ¨ç½²å’Œç®¡ç†æ–¹å¼ã€‚è¿‘å¹´æ¥ï¼Œç”±äºå®ƒèƒ½å¤Ÿè§£å†³è½¯ä»¶å¼€å‘å’Œéƒ¨ç½²ä¸­çš„ä¸€äº›é‡å¤§æŒ‘æˆ˜ï¼Œå·²è·å¾—å¹¿æ³›é‡‡ç”¨ã€‚
- en: In simple terms, containerisation is a process of packaging an application and
    all its dependencies into a single **container**. This container is a lightweight,
    portable, and self-sufficient unit that can be run consistently across different
    computing environments. It provides an isolated environment for the application,
    ensuring that it runs consistently, regardless of the underlying infrastructure.
    It allows developers to create applications that are scalable, portable, and easy
    to manage. Additionally, containers provide an extra layer of security by isolating
    applications from the host system. If you hear someone say the phrase â€œ*it works
    on my computer*â€, it is no longer valid because you can and should test your application
    in a Docker container. This ensures that it works consistently across different
    environments.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: ç®€å•æ¥è¯´ï¼Œå®¹å™¨åŒ–æ˜¯å°†åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰ä¾èµ–é¡¹æ‰“åŒ…æˆä¸€ä¸ªå•ä¸€çš„**å®¹å™¨**çš„è¿‡ç¨‹ã€‚è¿™ä¸ªå®¹å™¨æ˜¯ä¸€ä¸ªè½»é‡ã€å¯ç§»æ¤ã€è‡ªç»™è‡ªè¶³çš„å•å…ƒï¼Œå¯ä»¥åœ¨ä¸åŒçš„è®¡ç®—ç¯å¢ƒä¸­ä¸€è‡´åœ°è¿è¡Œã€‚å®ƒä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒï¼Œç¡®ä¿å®ƒåœ¨ä»»ä½•åº•å±‚åŸºç¡€è®¾æ–½ä¸‹éƒ½èƒ½ä¸€è‡´è¿è¡Œã€‚å®ƒä½¿å¼€å‘è€…èƒ½å¤Ÿåˆ›å»ºå¯æ‰©å±•ã€å¯ç§»æ¤ä¸”æ˜“äºç®¡ç†çš„åº”ç”¨ç¨‹åºã€‚æ­¤å¤–ï¼Œå®¹å™¨é€šè¿‡å°†åº”ç”¨ç¨‹åºä¸å®¿ä¸»ç³»ç»Ÿéš”ç¦»ï¼Œæä¾›äº†é¢å¤–çš„å®‰å…¨å±‚ã€‚å¦‚æœä½ å¬åˆ°æœ‰äººè¯´â€œ*å®ƒåœ¨æˆ‘çš„ç”µè„‘ä¸Šèƒ½å·¥ä½œ*â€ï¼Œè¿™å·²ç»ä¸å†æœ‰æ•ˆï¼Œå› ä¸ºä½ å¯ä»¥å¹¶ä¸”åº”è¯¥åœ¨
    Docker å®¹å™¨ä¸­æµ‹è¯•ä½ çš„åº”ç”¨ã€‚è¿™ç¡®ä¿äº†å®ƒåœ¨ä¸åŒç¯å¢ƒä¸­çš„ä¸€è‡´æ€§ã€‚
- en: In conclusion, containerisation is a powerful technology that allows developers
    to create containerised applications that are reliable, efficient, and easy to
    manage, allowing them to focus on developing great software.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: æ€»ä¹‹ï¼Œå®¹å™¨åŒ–æ˜¯ä¸€é¡¹å¼ºå¤§çš„æŠ€æœ¯ï¼Œå®ƒå…è®¸å¼€å‘è€…åˆ›å»ºå¯é ã€é«˜æ•ˆä¸”æ˜“äºç®¡ç†çš„å®¹å™¨åŒ–åº”ç”¨ï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿä¸“æ³¨äºå¼€å‘ä¼˜ç§€çš„è½¯ä»¶ã€‚
- en: Docker
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Docker
- en: Docker is a popular containerisation platform that allows developers to create,
    deploy, and run containerised applications. It provides a range of tools and services
    that make it easy to package and deploy applications in a containerised format.
    With Docker, developers can create, test, and deploy applications in a matter
    of minutes, instead of days or weeks.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: Dockeræ˜¯ä¸€ä¸ªæµè¡Œçš„å®¹å™¨åŒ–å¹³å°ï¼Œå…è®¸å¼€å‘äººå‘˜åˆ›å»ºã€éƒ¨ç½²å’Œè¿è¡Œå®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—å·¥å…·å’ŒæœåŠ¡ï¼Œä½¿å¾—å°†åº”ç”¨ç¨‹åºæ‰“åŒ…å’Œéƒ¨ç½²ä¸ºå®¹å™¨åŒ–æ ¼å¼å˜å¾—ç®€å•ã€‚ä½¿ç”¨Dockerï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨å‡ åˆ†é’Ÿå†…åˆ›å»ºã€æµ‹è¯•å’Œéƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯å‡ å¤©æˆ–å‡ å‘¨ã€‚
- en: To create such an containerised application with docker we need to
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: è¦ä½¿ç”¨dockeråˆ›å»ºè¿™æ ·çš„å®¹å™¨åŒ–åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦
- en: Build a **Docker image** from a **Dockerfile**
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä»**Dockerfile**æ„å»ºä¸€ä¸ª**Dockeré•œåƒ**
- en: Create a **container** from the Docker image
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä»Dockeré•œåƒåˆ›å»ºä¸€ä¸ª**å®¹å™¨**
- en: For this we will use the docker CLI.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨docker CLIã€‚
- en: Dockerfile
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Dockerfile
- en: A Dockerfile is a text file that contains all commands needed to build a given
    image. It adheres to a specific format and set of instructions which you can find
    about [here](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/).
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: Dockerfileæ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ„å»ºç»™å®šé•œåƒæ‰€éœ€å‘½ä»¤çš„æ–‡æœ¬æ–‡ä»¶ã€‚å®ƒéµå¾ªç‰¹å®šçš„æ ¼å¼å’ŒæŒ‡ä»¤é›†ï¼Œä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ã€‚
- en: 'The goal for this section here is to create a Dockerfile that **builds a wheel
    of our Python package**:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬èŠ‚çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ª**æ„å»ºæˆ‘ä»¬PythonåŒ…çš„wheelæ–‡ä»¶**çš„Dockerfileï¼š
- en: '[PRE0]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This Dockerfile is essentially a set of instructions that tells Docker how to
    build a container for a Python application. It starts with a base image `python:3.10-slim`
    which is a slim version of the Python 3.10 image that has already been pre-built
    with some basic libraries and dependencies.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªDockerfileæœ¬è´¨ä¸Šæ˜¯ä¸€ç»„æŒ‡ä»¤ï¼Œå‘Šè¯‰Dockerå¦‚ä½•ä¸ºPythonåº”ç”¨ç¨‹åºæ„å»ºä¸€ä¸ªå®¹å™¨ã€‚å®ƒä»¥`python:3.10-slim`ä½œä¸ºåŸºç¡€é•œåƒå¼€å§‹ï¼Œè¿™æ˜¯ä¸€ç§å·²ç»é¢„è£…äº†ä¸€äº›åŸºæœ¬åº“å’Œä¾èµ–é¡¹çš„Python
    3.10ç²¾ç®€ç‰ˆé•œåƒã€‚
- en: The first instruction `WORKDIR /app` sets the working directory to `/app` inside
    the container where the application will be placed.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ç¬¬ä¸€ä¸ªæŒ‡ä»¤`WORKDIR /app`å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå®¹å™¨å†…çš„`/app`ï¼Œåº”ç”¨ç¨‹åºå°†è¢«æ”¾ç½®åœ¨æ­¤ç›®å½•ä¸­ã€‚
- en: The next instruction `ENV POETRY_VERSION=1.2.0` sets an environment variable
    called `POETRY_VERSION` to `1.2.0` which will be used in the next command to install
    the Poetry package manager.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹ä¸€ä¸ªæŒ‡ä»¤`ENV POETRY_VERSION=1.2.0`è®¾ç½®ä¸€ä¸ªåä¸º`POETRY_VERSION`çš„ç¯å¢ƒå˜é‡ä¸º`1.2.0`ï¼Œæ­¤å˜é‡å°†åœ¨ä¸‹ä¸€æ¡å‘½ä»¤ä¸­ç”¨äºå®‰è£…PoetryåŒ…ç®¡ç†å™¨ã€‚
- en: The `RUN pip install "poetry==$POETRY_VERSION"` command installs the Poetry
    package manager inside the container, which is used to manage dependencies for
    Python applications.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '`RUN pip install "poetry==$POETRY_VERSION"`å‘½ä»¤åœ¨å®¹å™¨å†…å®‰è£…PoetryåŒ…ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†Pythonåº”ç”¨ç¨‹åºçš„ä¾èµ–é¡¹ã€‚'
- en: The next instruction `COPY ["pyproject.toml", "poetry.lock", "README.md", "./"]`
    copies the project files (including the `pyproject.toml`, `poetry.lock` and `README.md`)
    to the container.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹ä¸€ä¸ªæŒ‡ä»¤`COPY ["pyproject.toml", "poetry.lock", "README.md", "./"]`å°†é¡¹ç›®æ–‡ä»¶ï¼ˆåŒ…æ‹¬`pyproject.toml`ã€`poetry.lock`å’Œ`README.md`ï¼‰å¤åˆ¶åˆ°å®¹å™¨ä¸­ã€‚
- en: The `README.md` file is required as there is a reference in the pyproject.toml.
    Without it we wouldnâ€™t be able to build a wheel.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '`README.md`æ–‡ä»¶æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºåœ¨pyproject.tomlä¸­æœ‰å¼•ç”¨ã€‚æ²¡æœ‰å®ƒï¼Œæˆ‘ä»¬å°†æ— æ³•æ„å»ºwheelã€‚'
- en: The instruction `COPY ["src/", "src/"]` copies the source code of the application
    to the container.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: æŒ‡ä»¤`COPY ["src/", "src/"]`å°†åº”ç”¨ç¨‹åºçš„æºä»£ç å¤åˆ¶åˆ°å®¹å™¨ä¸­ã€‚
- en: The `RUN poetry build --format wheel` command builds a [Python wheel](https://realpython.com/python-wheels/)
    package for the Python application using the `poetry.lock` file and the source
    code of the application.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '`RUN poetry build --format wheel`å‘½ä»¤ä½¿ç”¨`poetry.lock`æ–‡ä»¶å’Œåº”ç”¨ç¨‹åºçš„æºä»£ç ä¸ºPythonåº”ç”¨ç¨‹åºæ„å»ºä¸€ä¸ª[Python
    wheel](https://realpython.com/python-wheels/)åŒ…ã€‚'
- en: Finally, the last instruction `RUN pip install dist/*.whl` installs the package
    by using `pip` and installs the generated `.whl` package file which is located
    inside the `dist` directory.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œæœ€åä¸€æ¡æŒ‡ä»¤`RUN pip install dist/*.whl`ä½¿ç”¨`pip`å®‰è£…åŒ…ï¼Œå¹¶å®‰è£…ä½äº`dist`ç›®å½•ä¸­çš„ç”Ÿæˆçš„`.whl`åŒ…æ–‡ä»¶ã€‚
- en: '**In summary**, this Dockerfile sets up a container with Python 3.10 and Poetry
    installed, copies the application source code and dependencies, builds a package
    wheel and installs it.'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '**æ€»ä¹‹**ï¼Œè¿™ä¸ªDockerfileè®¾ç½®äº†ä¸€ä¸ªåŒ…å«Python 3.10å’Œå·²å®‰è£…Poetryçš„å®¹å™¨ï¼Œå¤åˆ¶äº†åº”ç”¨ç¨‹åºæºä»£ç å’Œä¾èµ–é¡¹ï¼Œæ„å»ºäº†ä¸€ä¸ªåŒ…wheelå¹¶å®‰è£…å®ƒã€‚'
- en: '**This will not yet run the application**. But donâ€™t worry, we will update
    it in the next sections. We must first understand the flow of using Docker.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '**è¿™è¿˜ä¸ä¼šè¿è¡Œåº”ç”¨ç¨‹åº**ã€‚ä½†ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­æ›´æ–°å®ƒã€‚æˆ‘ä»¬å¿…é¡»é¦–å…ˆäº†è§£ä½¿ç”¨Dockerçš„æµç¨‹ã€‚'
- en: Docker image
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Dockeré•œåƒ
- en: We have created a **Dockerfile** that contains the instructions to build a Docker
    image. Why do we need a **Docker image** again**?** Because itallows us to build
    D**ocker containers**!
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ª **Dockerfile**ï¼Œå…¶ä¸­åŒ…å«æ„å»º Docker é•œåƒçš„æŒ‡ä»¤ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ **Docker é•œåƒ**ï¼Ÿå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬æ„å»º
    **Docker å®¹å™¨**ï¼
- en: 'Letâ€™s run the **docker build** command to create our image:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬è¿è¡Œ **docker build** å‘½ä»¤æ¥åˆ›å»ºæˆ‘ä»¬çš„é•œåƒï¼š
- en: '[PRE1]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'This command is used to build a Docker image from a Dockerfile and tag it with
    a specified name and version. Letâ€™s break down the command:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: æ­¤å‘½ä»¤ç”¨äºä» Dockerfile æ„å»º Docker é•œåƒï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„åç§°å’Œç‰ˆæœ¬æ ‡è®°å®ƒã€‚è®©æˆ‘ä»¬æ¥è§£æä¸€ä¸‹å‘½ä»¤ï¼š
- en: '`docker build`: This is the command used to build Docker images.'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`docker build`ï¼šè¿™æ˜¯ç”¨äºæ„å»º Docker é•œåƒçš„å‘½ä»¤ã€‚'
- en: '`--file Dockerfile`: This option specifies the path and name of the Dockerfile
    used for building the image. In this case, it is simply named `Dockerfile`, so
    it''s using the default name.'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--file Dockerfile`ï¼šæ­¤é€‰é¡¹æŒ‡å®šç”¨äºæ„å»ºé•œåƒçš„ Dockerfile çš„è·¯å¾„å’Œåç§°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒè¢«ç®€å•åœ°å‘½åä¸º `Dockerfile`ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨äº†é»˜è®¤åç§°ã€‚'
- en: '`--tag project:latest`: This option specifies the name and version of the image
    to be created. In this case, the image name is `project` and its version is `latest`.
    `project` is the name given to the image, and `latest` is the version number.
    You can replace `project` and `latest` with the name and version of your choice.'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--tag project:latest`ï¼šæ­¤é€‰é¡¹æŒ‡å®šè¦åˆ›å»ºçš„é•œåƒçš„åç§°å’Œç‰ˆæœ¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé•œåƒåç§°ä¸º `project`ï¼Œç‰ˆæœ¬ä¸º `latest`ã€‚`project`
    æ˜¯ç»™é•œåƒçš„åç§°ï¼Œè€Œ `latest` æ˜¯ç‰ˆæœ¬å·ã€‚ä½ å¯ä»¥ç”¨ä½ é€‰æ‹©çš„åç§°å’Œç‰ˆæœ¬æ›¿æ¢ `project` å’Œ `latest`ã€‚'
- en: '`.`: This specifies the build context, which is the location of the files used
    for building the image. In this case, `.` refers to the current directory where
    the command is executed.'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`.`ï¼šæ­¤é€‰é¡¹æŒ‡å®šäº†æ„å»ºä¸Šä¸‹æ–‡ï¼Œå³ç”¨äºæ„å»ºé•œåƒçš„æ–‡ä»¶ä½ç½®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`.` æŒ‡å½“å‰æ‰§è¡Œå‘½ä»¤çš„ç›®å½•ã€‚'
- en: 'So, when this command is executed, Docker reads the Dockerfile in the current
    directory and uses it to build a new image named `project:latest`. We can find
    additional information about the resulting image (& other images) by running:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: å› æ­¤ï¼Œå½“æ‰§è¡Œæ­¤å‘½ä»¤æ—¶ï¼ŒDocker ä¼šè¯»å–å½“å‰ç›®å½•ä¸­çš„ Dockerfileï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æ„å»ºä¸€ä¸ªåä¸º `project:latest` çš„æ–°é•œåƒã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°æœ‰å…³ç»“æœé•œåƒï¼ˆåŠå…¶ä»–é•œåƒï¼‰çš„æ›´å¤šä¿¡æ¯ï¼š
- en: '[PRE2]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Our image is **271 mb** in size. The size will be reduced later on.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çš„é•œåƒå¤§å°ä¸º **271 mb**ã€‚å¤§å°å°†åœ¨åç»­å‡å°‘ã€‚
- en: Docker container
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Docker å®¹å™¨
- en: 'We can create/run a Docker container from a Docker image using the `docker
    run` command. The command requires one parameter which is the name of the image.
    For example, if your image is named `myimage`, you can run it with the following
    [command](https://docs.docker.com/language/python/run-containers/): `docker run
    myimage`'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `docker run` å‘½ä»¤ä» Docker é•œåƒåˆ›å»º/è¿è¡Œä¸€ä¸ª Docker å®¹å™¨ã€‚è¯¥å‘½ä»¤éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œå³é•œåƒçš„åç§°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„é•œåƒåä¸º
    `myimage`ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ [å‘½ä»¤](https://docs.docker.com/language/python/run-containers/)
    è¿è¡Œå®ƒï¼š`docker run myimage`
- en: 'If we run our application like this:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬åƒè¿™æ ·è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ï¼š
- en: '[PRE3]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'it will open an Python terminal (you can close the session with **CTRL + D**
    or **CMD + D**; The `-it` option is used to run a container in interactive mode
    with a pseudo-TTY (terminal emulation). This allows you to interact with the containerâ€™s
    shell and see its output in real-time. The `-rm` option is used to remove the
    container automatically when it exits.):'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒå°†æ‰“å¼€ä¸€ä¸ª Python ç»ˆç«¯ï¼ˆä½ å¯ä»¥ä½¿ç”¨ **CTRL + D** æˆ– **CMD + D** å…³é—­ä¼šè¯ï¼›`-it` é€‰é¡¹ç”¨äºä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œå¹¶æä¾›ä¼ªç»ˆç«¯ï¼ˆç»ˆç«¯ä»¿çœŸï¼‰ã€‚è¿™å…è®¸ä½ ä¸å®¹å™¨çš„
    shell è¿›è¡Œäº¤äº’ï¼Œå¹¶å®æ—¶æŸ¥çœ‹å…¶è¾“å‡ºã€‚`-rm` é€‰é¡¹ç”¨äºåœ¨å®¹å™¨é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤å®¹å™¨ã€‚ï¼‰
- en: '[PRE4]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Why does it open a Python session? That is, because the entrypoint of the docker
    image defaults to the Python interpreter in the standard **python:3.10-slim**
    image. If we want to have a look inside the container, we must overwrite the entrypoint.
    Because **bash** is installed by default on this build, we can run the docker
    container and get inside it with:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºä»€ä¹ˆå®ƒä¼šæ‰“å¼€ä¸€ä¸ª Python ä¼šè¯ï¼Ÿè¿™æ˜¯å› ä¸º Docker é•œåƒçš„ entrypoint é»˜è®¤æŒ‡å‘æ ‡å‡† **python:3.10-slim** é•œåƒä¸­çš„
    Python è§£é‡Šå™¨ã€‚å¦‚æœæˆ‘ä»¬æƒ³æŸ¥çœ‹å®¹å™¨å†…éƒ¨ï¼Œæˆ‘ä»¬å¿…é¡»è¦†ç›– entrypointã€‚å› ä¸º **bash** é»˜è®¤å®‰è£…åœ¨æ­¤æ„å»ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œ Docker
    å®¹å™¨å¹¶è¿›å…¥å…¶ä¸­ï¼š
- en: '[PRE5]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: So we overwrite the entrypoint with **/bin/bash**.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥æˆ‘ä»¬ç”¨ **/bin/bash** è¦†ç›–äº† entrypointã€‚
- en: 'And now we can check the content that is inside our container:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®¹å™¨å†…éƒ¨çš„å†…å®¹ï¼š
- en: '[PRE6]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: We can check the installed packages with
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å·²å®‰è£…çš„åŒ…ï¼š
- en: '[PRE7]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Great, we can jump inside a container, which is really good for troubleshooting.
    But how do we make it **run our application?** And where is our app installed?
    By default, packages can be found in the **site-packages** directory of the Python
    installation. To find that information we can use the **pip show** command:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: å¤ªå¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥å®¹å™¨ï¼Œè¿™å¯¹äºæ•…éšœæ’é™¤éå¸¸æœ‰ç”¨ã€‚ä½†æˆ‘ä»¬å¦‚ä½•è®©å®ƒ**è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åº**ï¼Ÿæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå®‰è£…åœ¨å“ªé‡Œï¼Ÿé»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…å¯ä»¥åœ¨ Python
    å®‰è£…çš„**site-packages** ç›®å½•ä¸­æ‰¾åˆ°ã€‚è¦è·å–è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**pip show** å‘½ä»¤ï¼š
- en: '[PRE8]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Since **uvicorn**, our ASGI server implementation, is installed by default,
    we can **cd** into */usr/local/lib/python3.10/site-packages/example_app*
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äº**uvicorn**ï¼ˆæˆ‘ä»¬çš„ ASGI æœåŠ¡å™¨å®ç°ï¼‰é»˜è®¤å®‰è£…ï¼Œæˆ‘ä»¬å¯ä»¥**cd** è¿›å…¥ */usr/local/lib/python3.10/site-packages/example_app*
- en: 'and run the application with the **uvicorn command**:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¶ä½¿ç”¨**uvicorn å‘½ä»¤**è¿è¡Œåº”ç”¨ç¨‹åºï¼š
- en: '[PRE9]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: where `app:app` follows the pattern `<file_name>:<variable_name>` .
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: å…¶ä¸­ `app:app` éµå¾ª `<file_name>:<variable_name>` æ¨¡å¼ã€‚
- en: 'The application runs on **port 80** within the docker container with **1 worker**.
    To be accessible on the host (your machine), we need to expose the container port
    and publish it to the host. This can be done by adding adding the `--expose` and
    `--publish` flag to the docker run command. Alternatevily, we can have the container
    expose a certain port by defining this in the **Dockerfile**. We will do this
    in a second. Before that, hereâ€™s what weâ€™re gonna do:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: åº”ç”¨ç¨‹åºåœ¨ docker å®¹å™¨ä¸­è¿è¡Œåœ¨**ç«¯å£ 80**ï¼Œå¹¶ä½¿ç”¨**1 ä¸ªå·¥ä½œè¿›ç¨‹**ã€‚ä¸ºäº†åœ¨ä¸»æœºï¼ˆä½ çš„æœºå™¨ï¼‰ä¸Šè®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦æš´éœ²å®¹å™¨ç«¯å£å¹¶å°†å…¶å‘å¸ƒåˆ°ä¸»æœºã€‚è¿™å¯ä»¥é€šè¿‡åœ¨
    docker run å‘½ä»¤ä¸­æ·»åŠ  `--expose` å’Œ `--publish` æ ‡å¿—æ¥å®Œæˆã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨**Dockerfile**ä¸­å®šä¹‰æŸä¸ªç«¯å£æ¥è®©å®¹å™¨æš´éœ²è¯¥ç«¯å£ã€‚æˆ‘ä»¬ç¨åä¼šåšè¿™ä¸ªã€‚ä¹‹å‰ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯ï¼š
- en: 'Our application can be found in the site-packages directory. This requires
    us to change the directory before we can run the `uvicorn app:app` command. If
    we want to avoid changing the directory, we can instead create a file that imports
    the app for us. Hereâ€™s an example:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ site-packages ç›®å½•ä¸­æ‰¾åˆ°ã€‚è¿™è¦æ±‚æˆ‘ä»¬åœ¨è¿è¡Œ `uvicorn app:app` å‘½ä»¤ä¹‹å‰æ›´æ”¹ç›®å½•ã€‚å¦‚æœæˆ‘ä»¬æƒ³é¿å…æ›´æ”¹ç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ¥ä¸ºæˆ‘ä»¬å¯¼å…¥åº”ç”¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š
- en: 'Add a `main.py` :'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: æ·»åŠ ä¸€ä¸ª `main.py`ï¼š
- en: '[PRE10]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'where we import the application in a `main.py` so that uvicorn can use it.
    If we now copy this file to our `/app` directory:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ `main.py` ä¸­å¯¼å…¥åº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿ uvicorn å¯ä»¥ä½¿ç”¨å®ƒã€‚å¦‚æœæˆ‘ä»¬ç°åœ¨å°†è¿™ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°æˆ‘ä»¬çš„ `/app` ç›®å½•ï¼š
- en: '[PRE11]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: we can run the app with
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥è¿è¡Œåº”ç”¨ç¨‹åº
- en: '[PRE12]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Great. Now letâ€™s set this command as an **entrypoint** when starting a container.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: å¤ªå¥½äº†ã€‚ç°åœ¨è®©æˆ‘ä»¬å°†è¿™ä¸ªå‘½ä»¤è®¾ç½®ä¸ºå¯åŠ¨å®¹å™¨æ—¶çš„**å…¥å£ç‚¹**ã€‚
- en: '[PRE13]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: We now copy the `main.py` file to the `/app` directory. The `EXPOSE` instruction
    informs Docker that the container listens on the specified network ports at runtime.
    In this case, it is exposing **port 80**.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å°† `main.py` æ–‡ä»¶å¤åˆ¶åˆ° `/app` ç›®å½•ã€‚`EXPOSE` æŒ‡ä»¤é€šçŸ¥ Docker å®¹å™¨åœ¨è¿è¡Œæ—¶ç›‘å¬æŒ‡å®šçš„ç½‘ç»œç«¯å£ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæš´éœ²äº†**ç«¯å£
    80**ã€‚
- en: The `CMD` instruction specifies what command to run within the container. Here,
    it is running the command `uvicorn main:app --host 0.0.0.0 --port 80 --workers
    1`. This command starts a uvicorn server with the `main:app` application, listening
    on host `0.0.0.0` and port `80`, with `1` worker.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '`CMD` æŒ‡ä»¤æŒ‡å®šäº†åœ¨å®¹å™¨å†…è¿è¡Œçš„å‘½ä»¤ã€‚åœ¨è¿™é‡Œï¼Œå®ƒè¿è¡Œå‘½ä»¤ `uvicorn main:app --host 0.0.0.0 --port 80 --workers
    1`ã€‚è¿™ä¸ªå‘½ä»¤å¯åŠ¨äº†ä¸€ä¸ª uvicorn æœåŠ¡å™¨ï¼Œè¿è¡Œ `main:app` åº”ç”¨ç¨‹åºï¼Œç›‘å¬ä¸»æœº `0.0.0.0` å’Œç«¯å£ `80`ï¼Œä½¿ç”¨ `1` ä¸ªå·¥ä½œè¿›ç¨‹ã€‚'
- en: 'We can then run a container with the **docker run** command:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**docker run** å‘½ä»¤è¿è¡Œå®¹å™¨ï¼š
- en: '[PRE14]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The `-p` flag in the `docker run` command is used to publish a containerâ€™s port
    to the host. In this case, it is mapping port `9000` on the host to port `80`
    on the container. This means that any traffic sent to port `9000` on the host
    will be forwarded to port `80` on the container.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '`docker run` å‘½ä»¤ä¸­çš„ `-p` æ ‡å¿—ç”¨äºå°†å®¹å™¨çš„ç«¯å£å‘å¸ƒåˆ°ä¸»æœºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†ä¸»æœºä¸Šçš„ç«¯å£ `9000` æ˜ å°„åˆ°å®¹å™¨ä¸Šçš„ç«¯å£ `80`ã€‚è¿™æ„å‘³ç€ä»»ä½•å‘é€åˆ°ä¸»æœºç«¯å£
    `9000` çš„æµé‡éƒ½ä¼šè¢«è½¬å‘åˆ°å®¹å™¨ç«¯å£ `80`ã€‚'
- en: 'We see that our application that is running in the container can be reached:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å®¹å™¨ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºå¯ä»¥è¢«è®¿é—®ï¼š
- en: '![](../Images/e59351dbabffba38db50b6de0d405edf.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/e59351dbabffba38db50b6de0d405edf.png)'
- en: fastAPI application running in a Docker container â€” Image by author
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: è¿è¡Œåœ¨ Docker å®¹å™¨ä¸­çš„ fastAPI åº”ç”¨ç¨‹åº â€” ä½œè€…å›¾ç‰‡
- en: '**Important remark**: Instead of uvicorn, I recommend using [**gunicorn**](https://gunicorn.org/)
    for production builds! For completeness, this is how the Dockerfile would look
    like instead:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '**é‡è¦å¤‡æ³¨**ï¼šæˆ‘å»ºè®®åœ¨ç”Ÿäº§æ„å»ºä¸­ä½¿ç”¨ [**gunicorn**](https://gunicorn.org/) ä»£æ›¿ uvicornï¼ä¸ºäº†å®Œæ•´æ€§ï¼Œè¿™é‡Œæ˜¯
    Dockerfile çš„æ›¿ä»£ç‰ˆæœ¬ï¼š'
- en: '[PRE15]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Whatâ€™s the difference between these two?
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸¤ä¸ªæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
- en: Uvicorn is an ASGI server that supports the ASGI protocol. It is built on [uvloop](https://uvloop.readthedocs.io/)
    and [httptools](https://pypi.org/project/httptools/) and is known for its performance
    benefits. [However, its capabilities as a process manager leave much to be desired](https://stackoverflow.com/questions/66362199/what-is-the-difference-between-uvicorn-and-gunicornuvicorn).
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: Uvicorn æ˜¯ä¸€ä¸ªæ”¯æŒ ASGI åè®®çš„ ASGI æœåŠ¡å™¨ã€‚å®ƒå»ºç«‹åœ¨ [uvloop](https://uvloop.readthedocs.io/)
    å’Œ [httptools](https://pypi.org/project/httptools/) ä¹‹ä¸Šï¼Œå¹¶ä»¥å…¶æ€§èƒ½ä¼˜åŠ¿è€Œé—»åã€‚[ç„¶è€Œï¼Œå®ƒä½œä¸ºè¿›ç¨‹ç®¡ç†å™¨çš„èƒ½åŠ›è¿˜æœ‰å¾…æé«˜](https://stackoverflow.com/questions/66362199/what-is-the-difference-between-uvicorn-and-gunicornuvicorn)ã€‚
- en: Gunicorn, on the other hand, is a mature and fully-featured server and process
    manager. [It is a pre-fork worker model ported from Rubyâ€™s Unicorn project and
    is broadly compatible with various web frameworks](https://stackshare.io/stackups/gunicorn-vs-uvicorn).
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: Gunicorn å¦ä¸€æ–¹é¢æ˜¯ä¸€ä¸ªæˆç†Ÿä¸”åŠŸèƒ½å…¨é¢çš„æœåŠ¡å™¨å’Œè¿›ç¨‹ç®¡ç†å™¨ã€‚[å®ƒæ˜¯ä» Ruby çš„ Unicorn é¡¹ç›®ç§»æ¤è€Œæ¥çš„é¢„å‰å·¥äººæ¨¡å‹ï¼Œå¹¶ä¸å„ç§ web
    æ¡†æ¶å¹¿æ³›å…¼å®¹](https://stackshare.io/stackups/gunicorn-vs-uvicorn)ã€‚
- en: Docker stages
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Docker é˜¶æ®µ
- en: Docker stages are a feature that allows you to create multiple stages in your
    Dockerfile. Each stage can have its own **base image** and set of instructions.
    You can selectively copy artifacts from one stage to another, leaving behind everything
    you donâ€™t want in a target stage. [This feature is useful because it allows you
    to optimize your Docker images by reducing their size and complexity](https://docs.docker.com/build/building/multi-stage/).
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: Docker é˜¶æ®µæ˜¯ä¸€é¡¹åŠŸèƒ½ï¼Œå…è®¸ä½ åœ¨ Dockerfile ä¸­åˆ›å»ºå¤šä¸ªé˜¶æ®µã€‚æ¯ä¸ªé˜¶æ®µå¯ä»¥æœ‰è‡ªå·±çš„ **åŸºç¡€é•œåƒ** å’ŒæŒ‡ä»¤é›†ã€‚ä½ å¯ä»¥é€‰æ‹©æ€§åœ°å°†å·¥ä»¶ä»ä¸€ä¸ªé˜¶æ®µå¤åˆ¶åˆ°å¦ä¸€ä¸ªé˜¶æ®µï¼Œç•™ä¸‹ä½ ä¸æƒ³è¦çš„å†…å®¹ã€‚[æ­¤åŠŸèƒ½å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥é€šè¿‡å‡å°‘
    Docker é•œåƒçš„å¤§å°å’Œå¤æ‚æ€§æ¥ä¼˜åŒ– Docker é•œåƒ](https://docs.docker.com/build/building/multi-stage/)ã€‚
- en: 'With Docker stages we can (and should!) optimize our Docker image. So what
    we want to achieve is this:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ Docker é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥ï¼ˆå¹¶ä¸”åº”è¯¥ï¼ï¼‰ä¼˜åŒ–æˆ‘ä»¬çš„ Docker é•œåƒã€‚æ‰€ä»¥æˆ‘ä»¬æƒ³è¦å®ç°çš„æ˜¯ï¼š
- en: poetry should not be in the production build
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: poetry ä¸åº”è¯¥å‡ºç°åœ¨ç”Ÿäº§æ„å»ºä¸­
- en: the production build should only contain as little as necessary to run the app
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç”Ÿäº§æ„å»ºåº”è¯¥ä»…åŒ…å«è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„æœ€å°‘å†…å®¹
- en: 'And this is how weâ€™re going to do it: We create a clean **base** stage. From
    the base stage we have a **builder** stage that installs poetry and builds the
    wheel. Another stage, **production,** can copy this artifact (.whl file) from
    the build stage and use it. This way we avoid having poetry installed in the production
    build and also limit it to have only the essentials, therby reducing the size
    of the final image.'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°±æ˜¯æˆ‘ä»¬è¦åšåˆ°çš„æ–¹æ³•ï¼šæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¹²å‡€çš„ **åŸºç¡€** é˜¶æ®µã€‚ä»åŸºç¡€é˜¶æ®µï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª **æ„å»º** é˜¶æ®µï¼Œå®‰è£… poetry å¹¶æ„å»º wheelã€‚å¦ä¸€ä¸ªé˜¶æ®µï¼Œ**ç”Ÿäº§ï¼Œ**
    å¯ä»¥ä»æ„å»ºé˜¶æ®µå¤åˆ¶è¿™ä¸ªå·¥ä»¶ï¼ˆ.whl æ–‡ä»¶ï¼‰å¹¶ä½¿ç”¨å®ƒã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥é¿å…åœ¨ç”Ÿäº§æ„å»ºä¸­å®‰è£… poetryï¼ŒåŒæ—¶ä¹Ÿå°†å…¶é™åˆ¶ä¸ºä»…åŒ…å«å¿…è¦å†…å®¹ï¼Œä»è€Œå‡å°‘æœ€ç»ˆé•œåƒçš„å¤§å°ã€‚
- en: About poetry in Docker
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å…³äº Docker ä¸­çš„ poetry
- en: There are different strategies that Iâ€™ve seen with poetry in combination with
    Docker.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘è§è¿‡ä¸åŒçš„ç­–ç•¥å°† poetry ä¸ Docker ç»“åˆä½¿ç”¨ã€‚
- en: Creating a **virtual environment** and then copying the whole **venv** from
    one stage to another.
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åˆ›å»ºä¸€ä¸ª **è™šæ‹Ÿç¯å¢ƒ**ï¼Œç„¶åå°†æ•´ä¸ª **venv** ä»ä¸€ä¸ªé˜¶æ®µå¤åˆ¶åˆ°å¦ä¸€ä¸ªé˜¶æ®µã€‚
- en: Creating **requirements.txt** files from the **poetry.lock** file and using
    these to pip install the requirements.
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä» **poetry.lock** æ–‡ä»¶åˆ›å»º **requirements.txt** æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨è¿™äº›æ–‡ä»¶é€šè¿‡ pip å®‰è£…è¦æ±‚ã€‚
- en: In the first case, Poetry is installed when building the image. In the second
    case, poetry is not installed within the docker build but Poetry needs to be used
    to create the requirements.txt files.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼ŒPoetry åœ¨æ„å»ºé•œåƒæ—¶å®‰è£…ã€‚åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼ŒPoetry ä¸åœ¨ Docker æ„å»ºä¸­å®‰è£…ï¼Œä½†éœ€è¦ä½¿ç”¨ Poetry æ¥åˆ›å»º requirements.txt
    æ–‡ä»¶ã€‚
- en: In both cases, we need Poetry to be installed in some way â€” either in the Docker
    image or on the host that runs the docker build command.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼å®‰è£… Poetryâ€”â€”æ— è®ºæ˜¯åœ¨ Docker é•œåƒä¸­è¿˜æ˜¯åœ¨è¿è¡Œ Docker æ„å»ºå‘½ä»¤çš„ä¸»æœºä¸Šã€‚
- en: Having Poetry inside Docker will slightly increase the build time while having
    it outside of Docker will require you install Poetry on the host and add additional
    steps for the build process (creating the requirements.txt files from poetry.lock).
    In the context of a Docker build **CI pipeline**, the Poetry installation on the
    host machine could be cached and the build process will be generally faster. Both
    approaches have their advantages and disadvantages, and the best approach will
    depend on your specific needs and preferences.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: å°† Poetry æ”¾å…¥ Docker ä¸­ä¼šç¨å¾®å¢åŠ æ„å»ºæ—¶é—´ï¼Œè€Œå°†å…¶æ”¾åœ¨ Docker ä¹‹å¤–åˆ™éœ€è¦ä½ åœ¨ä¸»æœºä¸Šå®‰è£… Poetryï¼Œå¹¶ä¸ºæ„å»ºè¿‡ç¨‹æ·»åŠ é¢å¤–æ­¥éª¤ï¼ˆä»
    poetry.lock åˆ›å»º requirements.txt æ–‡ä»¶ï¼‰ã€‚åœ¨ Docker æ„å»º **CI æµæ°´çº¿** çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸»æœºä¸Šçš„ Poetry å®‰è£…å¯ä»¥è¢«ç¼“å­˜ï¼Œæ„å»ºè¿‡ç¨‹é€šå¸¸ä¼šæ›´å¿«ã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ï¼Œæœ€ä½³æ–¹æ³•å°†å–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’Œåå¥½ã€‚
- en: 'For the sake of this tutorial, I will keep it simple and use the **venv strategy**
    described above**.** So hereâ€™s the new Dockfile with stages (To identiy the different
    stages seperated by the **FROM** statement, I highlited the lines in **bold**):'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†æœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘å°†ä¿æŒç®€å•ï¼Œä½¿ç”¨ä¸Šé¢æè¿°çš„ **venv ç­–ç•¥**ã€‚æ‰€ä»¥è¿™æ˜¯æ–°çš„ Dockfileï¼Œå…¶ä¸­åŒ…å«é˜¶æ®µï¼ˆä¸ºäº†è¯†åˆ«ä¸åŒçš„é˜¶æ®µï¼Œé€šè¿‡ **FROM**
    è¯­å¥åˆ†éš”ï¼Œæˆ‘å°†è¿™äº›è¡Œç”¨ **ç²—ä½“** é«˜äº®ï¼‰ï¼š
- en: '[PRE16]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'This Dockerfile defines a multi-stage build with three stages: `base`, `builder`,
    and `production`.'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ª Dockerfile å®šä¹‰äº†ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªé˜¶æ®µçš„å¤šé˜¶æ®µæ„å»ºï¼š`base`ã€`builder` å’Œ `production`ã€‚
- en: The `base` stage starts from a Python 3.10-slim image and sets the working directory
    to `/app`. It also sets an environment variable to ignore a warning about running
    pip as the root user and updates pip to the latest version.
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`base` é˜¶æ®µä» Python 3.10-slim é•œåƒå¼€å§‹ï¼Œå°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/app`ã€‚å®ƒè¿˜è®¾ç½®äº†ä¸€ä¸ªç¯å¢ƒå˜é‡ä»¥å¿½ç•¥å…³äºä»¥ root ç”¨æˆ·èº«ä»½è¿è¡Œ
    pip çš„è­¦å‘Šï¼Œå¹¶å°† pip æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚'
- en: The `builder` stage starts from the `base` stage and installs Poetry using pip.
    It then copies the application files and uses Poetry to build a wheel for the
    application.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`builder` é˜¶æ®µä» `base` é˜¶æ®µå¼€å§‹ï¼Œå¹¶ä½¿ç”¨ pip å®‰è£… Poetryã€‚ç„¶åï¼Œå®ƒå¤åˆ¶åº”ç”¨ç¨‹åºæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ Poetry ä¸ºåº”ç”¨ç¨‹åºæ„å»ºä¸€ä¸ª
    wheel æ–‡ä»¶ã€‚'
- en: The `production` stage starts from the `base` stage again and exposes port 80\.
    It copies the wheel built in the `builder` stage and installs it using pip. It
    also copies the entrypoint of the app and sets the command to run the app using
    uvicorn.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`production` é˜¶æ®µå†æ¬¡ä» `base` é˜¶æ®µå¼€å§‹ï¼Œå¹¶æš´éœ²ç«¯å£ 80ã€‚å®ƒå¤åˆ¶åœ¨ `builder` é˜¶æ®µæ„å»ºçš„ wheel æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ pip
    å®‰è£…ã€‚å®ƒè¿˜å¤åˆ¶åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼Œå¹¶å°†å‘½ä»¤è®¾ç½®ä¸ºä½¿ç”¨ uvicorn è¿è¡Œåº”ç”¨ç¨‹åºã€‚'
- en: 'We can now re-build our Docker image with:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡æ–°æ„å»ºæˆ‘ä»¬çš„ Docker é•œåƒï¼š
- en: '[PRE17]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: We can specify the stage we would like to build with the `--target` flag.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `--target` æ ‡å¿—æŒ‡å®šæˆ‘ä»¬å¸Œæœ›æ„å»ºçš„é˜¶æ®µã€‚
- en: 'The file size is now **~70 Mb** less, with a total of **197MB**:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: æ–‡ä»¶å¤§å°ç°åœ¨å‡å°‘äº† **~70 Mb**ï¼Œæ€»å…±ä¸º **197MB**ï¼š
- en: '[PRE18]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: And we can run it with
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå®ƒï¼š
- en: '[PRE19]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The API will be available under [http://localhost:9000](http://localhost:9000)
    in the browser.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: API å°†åœ¨æµè§ˆå™¨ä¸­é€šè¿‡ [http://localhost:9000](http://localhost:9000) æä¾›ã€‚
- en: '![](../Images/e59351dbabffba38db50b6de0d405edf.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/e59351dbabffba38db50b6de0d405edf.png)'
- en: fastAPI application running in a Docker container â€” Image by author
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: fastAPI åº”ç”¨ç¨‹åºåœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ â€” ä½œè€…å›¾ç‰‡
- en: Container registries
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å®¹å™¨æ³¨å†Œè¡¨
- en: A container registry is a repository or collection of repositories used to store
    and access container images. Container registries can support container-based
    application development, often as part of [DevOps](https://realpython.com/learning-paths/python-devops/)
    processes. They can connect directly to container orchestration platforms like
    [Docker and Kubernetes](https://www.redhat.com/en/topics/cloud-native-apps/what-is-a-container-registry).
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: å®¹å™¨æ³¨å†Œè¡¨æ˜¯ç”¨äºå­˜å‚¨å’Œè®¿é—®å®¹å™¨é•œåƒçš„ä»“åº“æˆ–ä»“åº“é›†åˆã€‚å®¹å™¨æ³¨å†Œè¡¨å¯ä»¥æ”¯æŒåŸºäºå®¹å™¨çš„åº”ç”¨ç¨‹åºå¼€å‘ï¼Œé€šå¸¸ä½œä¸º [DevOps](https://realpython.com/learning-paths/python-devops/)
    è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚å®ƒä»¬å¯ä»¥ç›´æ¥è¿æ¥åˆ°åƒ [Docker å’Œ Kubernetes](https://www.redhat.com/en/topics/cloud-native-apps/what-is-a-container-registry)
    è¿™æ ·çš„å®¹å™¨ç¼–æ’å¹³å°ã€‚
- en: The most popular container registry is [Docker Hub](https://hub.docker.com/).
    Every Cloud Provider has its own. ACR for Azure, ECR for AWS and many many more.
    GitHub has its own package registry solution called [GitHub Packages](https://github.com/features/packages).
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€å—æ¬¢è¿çš„å®¹å™¨æ³¨å†Œè¡¨æ˜¯ [Docker Hub](https://hub.docker.com/)ã€‚æ¯ä¸ªäº‘æœåŠ¡æä¾›å•†éƒ½æœ‰è‡ªå·±çš„æ³¨å†Œè¡¨ã€‚Azure çš„ ACRã€AWS
    çš„ ECR ä»¥åŠæ›´å¤šã€‚GitHub æœ‰ä¸€ä¸ªåä¸º [GitHub Packages](https://github.com/features/packages)
    çš„åŒ…æ³¨å†Œè§£å†³æ–¹æ¡ˆã€‚
- en: As weâ€™ve done basically everything on GitHub so far, we will use **GitHub Packages**
    in this tutorial.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºæˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢åŸºæœ¬ä¸Šéƒ½åœ¨ GitHub ä¸Šå®Œæˆäº†æ‰€æœ‰æ“ä½œï¼Œæ‰€ä»¥åœ¨æœ¬æ•™ç¨‹ä¸­æˆ‘ä»¬å°†ä½¿ç”¨ **GitHub Packages**ã€‚
- en: '![](../Images/b0a73063d4391300e8a9464b7428d8fa.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b0a73063d4391300e8a9464b7428d8fa.png)'
- en: GitHub Packages â€” Image by author
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: GitHub Packages â€” ä½œè€…å›¾ç‰‡
- en: It has a free tier for a normal user on GitHub. This allows us to use up to
    **500 MB** of storage for our containers. Thatâ€™s enough for our application.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: GitHub ä¸ºæ™®é€šç”¨æˆ·æä¾›äº†å…è´¹çš„å±‚çº§ã€‚è¿™å…è®¸æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„å®¹å™¨ä½¿ç”¨æœ€å¤š **500 MB** çš„å­˜å‚¨ç©ºé—´ã€‚è¿™å¯¹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ¥è¯´è¶³å¤Ÿäº†ã€‚
- en: '![](../Images/e7f3be91fed4338dffe25a8f439b1f19.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/e7f3be91fed4338dffe25a8f439b1f19.png)'
- en: GitHub Packages Pricing with free tier â€” Image by author
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: GitHub Packages å®šä»·å’Œå…è´¹å±‚ â€” ä½œè€…å›¾ç‰‡
- en: Docker push
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Docker push
- en: The `docker push` command is used to **upload** a Docker image to a container
    registry. This allows you to share your images with others or deploy them to different
    environments. The command takes the name of the image you want to push and the
    name of the registry you want to push it to as arguments. You need to be logged
    in to the registry before you can push an image to it.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '`docker push` å‘½ä»¤ç”¨äº **ä¸Šä¼ ** Docker é•œåƒåˆ°å®¹å™¨æ³¨å†Œè¡¨ã€‚è¿™å…è®¸ä½ ä¸å…¶ä»–äººåˆ†äº«ä½ çš„é•œåƒæˆ–å°†å…¶éƒ¨ç½²åˆ°ä¸åŒçš„ç¯å¢ƒä¸­ã€‚è¯¥å‘½ä»¤éœ€è¦ä½ æŒ‡å®šè¦æ¨é€çš„é•œåƒåç§°å’Œè¦æ¨é€åˆ°çš„æ³¨å†Œè¡¨åç§°ä½œä¸ºå‚æ•°ã€‚åœ¨æ¨é€é•œåƒä¹‹å‰ï¼Œä½ éœ€è¦ç™»å½•åˆ°æ³¨å†Œè¡¨ã€‚'
- en: 'Here are the steps to push a Docker image to a container registry:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯å°† Docker é•œåƒæ¨é€åˆ°å®¹å™¨æ³¨å†Œè¡¨çš„æ­¥éª¤ï¼š
- en: '**Tag** (rename) your image with the registry name: `docker tag project:latest
    <registry-name>/<project>:latest`'
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**æ ‡è®°**ï¼ˆé‡å‘½åï¼‰ä½ çš„é•œåƒï¼Œä½¿ç”¨æ³¨å†Œè¡¨åç§°ï¼š`docker tag project:latest <registry-name>/<project>:latest`'
- en: '**Log in** to the container registry: `docker login <registry-url>`'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**ç™»å½•**åˆ°å®¹å™¨æ³¨å†Œè¡¨ï¼š`docker login <registry-url>`'
- en: '**Push** your image to the registry: `docker push <registry-name>/<project>:latest`'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**æ¨é€**ä½ çš„é•œåƒåˆ°æ³¨å†Œè¡¨ï¼š`docker push <registry-name>/<project>:latest`'
- en: 'We will push the image to [GitHub Packages](https://github.com/features/packages):'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†æŠŠé•œåƒæ¨é€åˆ°[GitHub Packages](https://github.com/features/packages)ï¼š
- en: GitHub Packages
  id: totrans-161
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: GitHub Packages
- en: GitHub Packages only supports authentication using a personal access token (February,
    2023). But we created a personal access token (PAT) in [Part V](https://medium.com/@johschmidt42/setting-up-python-projects-part-v-206df3c1e3d3),
    so we can use it here as well.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: GitHub Packages ä»…æ”¯æŒä½¿ç”¨ä¸ªäººè®¿é—®ä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯ï¼ˆ2023å¹´2æœˆï¼‰ã€‚ä½†æˆ‘ä»¬åœ¨[ç¬¬äº”éƒ¨åˆ†](https://medium.com/@johschmidt42/setting-up-python-projects-part-v-206df3c1e3d3)åˆ›å»ºäº†ä¸€ä¸ªä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆPATï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨å®ƒã€‚
- en: We need to [login to the container registry](https://docs.github.com/en/packages/learn-github-packages/connecting-a-repository-to-a-package)
    with
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬éœ€è¦[ç™»å½•åˆ°å®¹å™¨æ³¨å†Œè¡¨](https://docs.github.com/en/packages/learn-github-packages/connecting-a-repository-to-a-package)ï¼š
- en: '[PRE20]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Itâ€™s a shell command that uses a pipe to connect two commands. A pipe is a symbol
    (`|`) that redirects the output of one command to the input of another command.
    In this case, the first command is `echo $(CR_PAT)`, which prints the value of
    the CR_PAT variable to the standard output. The second command is `docker login
    ghcr.io -u johschmidt42 --password-stdin`, which logs in to ghcr.io using johschmidt42
    as the username and reading the password from the standard input. By using a pipe,
    the output of the echo command becomes the input of the docker login command,
    which means that the value of the CR_PAT variable is used as the password for
    logging in.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯ä¸€ä¸ª shell å‘½ä»¤ï¼Œä½¿ç”¨ç®¡é“å°†ä¸¤ä¸ªå‘½ä»¤è¿æ¥èµ·æ¥ã€‚ç®¡é“æ˜¯ä¸€ä¸ªç¬¦å·ï¼ˆ`|`ï¼‰ï¼Œå®ƒå°†ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°å¦ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªå‘½ä»¤æ˜¯
    `echo $(CR_PAT)`ï¼Œå®ƒå°† CR_PAT å˜é‡çš„å€¼æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚ç¬¬äºŒä¸ªå‘½ä»¤æ˜¯ `docker login ghcr.io -u johschmidt42
    --password-stdin`ï¼Œå®ƒä½¿ç”¨ johschmidt42 ä½œä¸ºç”¨æˆ·åï¼Œå¹¶ä»æ ‡å‡†è¾“å…¥è¯»å–å¯†ç æ¥ç™»å½• ghcr.ioã€‚é€šè¿‡ä½¿ç”¨ç®¡é“ï¼Œecho å‘½ä»¤çš„è¾“å‡ºæˆä¸º
    docker login å‘½ä»¤çš„è¾“å…¥ï¼Œè¿™æ„å‘³ç€ CR_PAT å˜é‡çš„å€¼è¢«ç”¨ä½œç™»å½•å¯†ç ã€‚
- en: Letâ€™s add this to our Makefile
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬æŠŠå®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„ Makefile ä¸­
- en: '[PRE21]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: We need to write a little if-else statement in **bash** so that this target
    login requires us to set the **CR_PAT** first.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬éœ€è¦åœ¨**bash**ä¸­å†™ä¸€ä¸ªå°çš„ if-else è¯­å¥ï¼Œä»¥ä¾¿è¿™ä¸ªç›®æ ‡ç™»å½•éœ€è¦æˆ‘ä»¬é¦–å…ˆè®¾ç½®**CR_PAT**ã€‚
- en: 'This allows us to login like so now:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä½¿æˆ‘ä»¬ç°åœ¨å¯ä»¥åƒè¿™æ ·ç™»å½•ï¼š
- en: '[PRE22]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'For anyone confused by the bash command. Hereâ€™s an explanation:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºä»»ä½•å¯¹ bash å‘½ä»¤æ„Ÿåˆ°å›°æƒ‘çš„äººï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªè§£é‡Šï¼š
- en: The shell command uses an if-else statement to check a condition and execute
    different actions accordingly. The condition is `[ -z "$(CR_PAT)" ]`, which means
    â€œis the CR_PAT variable empty?â€. The `-z` flag tests for zero length. The `$(CR_PAT)`
    part expands the value of the CR_PAT variable inside the brackets. If the condition
    is true, then the action after `then` is executed, which is `echo "CR_PAT is not
    set"`. This prints a message to the standard output. If the condition is false,
    then the action after `else` is executed, which is `echo $(CR_PAT) | docker login
    ghcr.io -u johschmidt42 --password-stdin`. The `\` at the end of each line means
    that the command continues on the next line. The `fi` at the end marks the end
    of the if-else statement.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ª shell å‘½ä»¤ä½¿ç”¨ if-else è¯­å¥æ¥æ£€æŸ¥ä¸€ä¸ªæ¡ä»¶ï¼Œå¹¶æ ¹æ®ä¸åŒçš„æ¡ä»¶æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚æ¡ä»¶æ˜¯ `[ -z "$(CR_PAT)" ]`ï¼Œè¿™æ„å‘³ç€â€œCR_PAT
    å˜é‡ä¸ºç©ºå—ï¼Ÿâ€ `-z` æ ‡å¿—æµ‹è¯•é›¶é•¿åº¦ã€‚`$(CR_PAT)` éƒ¨åˆ†åœ¨æ‹¬å·å†…å±•å¼€ CR_PAT å˜é‡çš„å€¼ã€‚å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œé‚£ä¹ˆ `then` åçš„æ“ä½œä¼šè¢«æ‰§è¡Œï¼Œå³
    `echo "CR_PAT is not set"`ã€‚è¿™å°†ä¸€æ¡æ¶ˆæ¯æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚å¦‚æœæ¡ä»¶ä¸ºå‡ï¼Œåˆ™æ‰§è¡Œ `else` åçš„æ“ä½œï¼Œå³ `echo $(CR_PAT)
    | docker login ghcr.io -u johschmidt42 --password-stdin`ã€‚æ¯è¡Œæœ«å°¾çš„ `\` æ„å‘³ç€å‘½ä»¤ç»§ç»­åœ¨ä¸‹ä¸€è¡Œã€‚æœ«å°¾çš„
    `fi` æ ‡å¿—ç€ if-else è¯­å¥çš„ç»“æŸã€‚
- en: 'Now that weâ€™re logged in, we need to rename the docker file so that we can
    push it to the remote registry using the docker tag command:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å·²ç™»å½•ï¼Œæˆ‘ä»¬éœ€è¦é‡å‘½å docker æ–‡ä»¶ï¼Œä»¥ä¾¿ä½¿ç”¨ docker tag å‘½ä»¤å°†å…¶æ¨é€åˆ°è¿œç¨‹æ³¨å†Œè¡¨ï¼š
- en: '[PRE23]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '[PRE24]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'We can see information about our docker images with:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æœ‰å…³æˆ‘ä»¬çš„ docker é•œåƒçš„ä¿¡æ¯ï¼š
- en: '[PRE25]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'If we now try to push the image to the registry, it will **fail**:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬ç°åœ¨å°è¯•å°†é•œåƒæ¨é€åˆ°æ³¨å†Œè¡¨ï¼Œå®ƒä¼š**å¤±è´¥**ï¼š
- en: '[PRE26]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '[PRE27]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Thatâ€™s because our token does **not have the expected scopes**. The message
    does not tell us which scopes (permissions) it requires but we can find this information
    in the [documentation](https://docs.github.com/en/packages/learn-github-packages/about-permissions-for-github-packages).
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„ä»¤ç‰Œ**æ²¡æœ‰é¢„æœŸçš„èŒƒå›´**ã€‚æ¶ˆæ¯æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬éœ€è¦å“ªäº›èŒƒå›´ï¼ˆæƒé™ï¼‰ï¼Œä½†æˆ‘ä»¬å¯ä»¥åœ¨[æ–‡æ¡£](https://docs.github.com/en/packages/learn-github-packages/about-permissions-for-github-packages)ä¸­æ‰¾åˆ°è¿™äº›ä¿¡æ¯ã€‚
- en: 'So we need to add these scopes:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ è¿™äº›èŒƒå›´ï¼š
- en: '**read:packages**'
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**read:packages**'
- en: '**delete:packages**'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**delete:packages**'
- en: '![](../Images/9682e27fb5857d928ec8fe542b048447.png)'
  id: totrans-185
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/9682e27fb5857d928ec8fe542b048447.png)'
- en: GH_TOKEN â€” Image by author
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: GH_TOKEN â€” ä½œè€…æä¾›çš„å›¾ç‰‡
- en: 'And now weâ€™re seeing it being pushed to the container registry:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬çœ‹åˆ°å®ƒè¢«æ¨é€åˆ°å®¹å™¨æ³¨å†Œè¡¨ï¼š
- en: '[PRE28]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'In GitHub, under `profile` there is now a docker image in the `packages` tab:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨GitHubä¸­ï¼Œ`profile`ä¸‹çš„`packages`æ ‡ç­¾ä¸­ç°åœ¨æœ‰ä¸€ä¸ªdockeré•œåƒï¼š
- en: '![](../Images/25a9b41841631d08d4b4b72b2d989d7f.png)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/25a9b41841631d08d4b4b72b2d989d7f.png)'
- en: Your profile â€” Image by author
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ çš„ä¸ªäººèµ„æ–™ â€” ä½œè€…æä¾›çš„å›¾ç‰‡
- en: '![](../Images/13cdc769731c3e98adcb44db40eeebb4.png)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/13cdc769731c3e98adcb44db40eeebb4.png)'
- en: GitHub packages â€” Image by author
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: GitHub packages â€” ä½œè€…æä¾›çš„å›¾ç‰‡
- en: 'Clicking on it, allows us to [connect the package to our repository](https://docs.github.com/en/packages/learn-github-packages/connecting-a-repository-to-a-package):'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: ç‚¹å‡»å®ƒï¼Œå¯ä»¥[å°†åŒ…è¿æ¥åˆ°æˆ‘ä»¬çš„ä»“åº“](https://docs.github.com/en/packages/learn-github-packages/connecting-a-repository-to-a-package)ï¼š
- en: '![](../Images/58796861176d35ba8a3fdc5b6a770cc7.png)'
  id: totrans-195
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/58796861176d35ba8a3fdc5b6a770cc7.png)'
- en: 'GitHub packages: Connect Repository â€” Image by author'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 'GitHub packages: è¿æ¥ä»“åº“ â€” ä½œè€…æä¾›çš„å›¾ç‰‡'
- en: 'And now this docker image can be found in the landing page of the repo [github.com/johschmidt42/python-project-johannes](https://github.com/johschmidt42/python-project-johannes):'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œè¿™ä¸ªdockeré•œåƒå¯ä»¥åœ¨ä»“åº“çš„é¦–é¡µæ‰¾åˆ° [github.com/johschmidt42/python-project-johannes](https://github.com/johschmidt42/python-project-johannes)ï¼š
- en: '![](../Images/b2edcc5b423274b3b003ef82b3cf2c1d.png)'
  id: totrans-198
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b2edcc5b423274b3b003ef82b3cf2c1d.png)'
- en: GitHub Packages Front page â€” image by author
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: GitHub Packages é¦–é¡µ â€” ä½œè€…æä¾›çš„å›¾ç‰‡
- en: 'Excellent. We have created a Docker Image, pushed it to the remote repository,
    linked it to our current version and now everyone who wants to test our application
    can do so by running the docker pull command:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: å¾ˆå¥½ã€‚æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªDockeré•œåƒï¼Œå°†å…¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œé“¾æ¥åˆ°æˆ‘ä»¬å½“å‰çš„ç‰ˆæœ¬ï¼Œç°åœ¨æ¯ä¸ªäººéƒ½å¯ä»¥é€šè¿‡è¿è¡Œdocker pullå‘½ä»¤æ¥æµ‹è¯•æˆ‘ä»¬çš„åº”ç”¨ï¼š
- en: '[PRE29]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'CI/CD:'
  id: totrans-202
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: CI/CDï¼š
- en: 'CI/CD stands for Continuous Integration and Continuous Deployment. With Docker
    images, CI/CD can automate the process of building, testing, and deploying images.
    In this tutorial, weâ€™ll focus on continuously building our Docker image and pushing
    it to a remote container registry (CI) whenever thereâ€™s a new version. However,
    we wonâ€™t be deploying the image (CD) in this tutorial (stay tuned for a future
    blog post). Our Docker container will be built when:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: CI/CDä»£è¡¨æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ã€‚é€šè¿‡Dockeré•œåƒï¼ŒCI/CDå¯ä»¥è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²é•œåƒçš„è¿‡ç¨‹ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨æŒç»­æ„å»ºæˆ‘ä»¬çš„Dockeré•œåƒå¹¶åœ¨æœ‰æ–°ç‰ˆæœ¬æ—¶å°†å…¶æ¨é€åˆ°è¿œç¨‹å®¹å™¨æ³¨å†Œè¡¨ï¼ˆCIï¼‰ã€‚ç„¶è€Œï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šéƒ¨ç½²é•œåƒï¼ˆCDï¼‰ï¼ˆè¯·å…³æ³¨æœªæ¥çš„åšå®¢æ–‡ç« ï¼‰ã€‚æˆ‘ä»¬çš„Dockerå®¹å™¨å°†åœ¨ä»¥ä¸‹æƒ…å†µæ„å»ºï¼š
- en: A commit is made to a branch with an open PR
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æäº¤åˆ°ä¸€ä¸ªæœ‰æ‰“å¼€çš„PRçš„åˆ†æ”¯
- en: A commit is made to the default branch (main)
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æäº¤åˆ°é»˜è®¤åˆ†æ”¯ï¼ˆmainï¼‰
- en: A new release is created (this will push the image to the container registry)
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼ˆè¿™ä¼šå°†é•œåƒæ¨é€åˆ°å®¹å™¨æ³¨å†Œè¡¨ï¼‰
- en: 'The first action helps us catch bugs early on. The second action enables us
    to create and use a badge in our README.md file. The last action creates a new
    version of the Docker image and pushes it to the container registry. The overall
    flow of actions is summarised here:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: ç¬¬ä¸€ä¸ªåŠ¨ä½œå¸®åŠ©æˆ‘ä»¬åŠæ—©å‘ç°é”™è¯¯ã€‚ç¬¬äºŒä¸ªåŠ¨ä½œä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨README.mdæ–‡ä»¶ä¸­åˆ›å»ºå¹¶ä½¿ç”¨å¾½ç« ã€‚æœ€åä¸€ä¸ªåŠ¨ä½œåˆ›å»ºDockeré•œåƒçš„æ–°ç‰ˆæœ¬å¹¶å°†å…¶æ¨é€åˆ°å®¹å™¨æ³¨å†Œè¡¨ã€‚æ•´ä½“åŠ¨ä½œæµç¨‹æ€»ç»“å¦‚ä¸‹ï¼š
- en: '![](../Images/209a22eeb95a99285f547c1d8c4d1c1d.png)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/209a22eeb95a99285f547c1d8c4d1c1d.png)'
- en: GitHub Actions Flow â€” Image by author
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: GitHub Actions æµç¨‹ â€” ä½œè€…æä¾›çš„å›¾ç‰‡
- en: 'Letâ€™s create the `build` pipeline:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬åˆ›å»º`build`ç®¡é“ï¼š
- en: This GitHub Actions workflow builds a Docker image. It is triggered when there
    is a **push** or **pull request** to the **main** branch or when the workflow
    is called. The job is named â€œBuildâ€ and has two steps. The first step checks out
    the repository using the `actions/checkout` action. The second step builds the
    Docker image by running the `make build` command. Thatâ€™s it.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªGitHub Actionså·¥ä½œæµæ„å»ºäº†ä¸€ä¸ªDockeré•œåƒã€‚å½“æœ‰**push**æˆ–**pull request**åˆ°**main**åˆ†æ”¯æ—¶ï¼Œæˆ–è€…å½“å·¥ä½œæµè¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šè¢«è§¦å‘ã€‚è¿™ä¸ªå·¥ä½œæ˜¯å‘½åä¸ºâ€œBuildâ€ï¼ŒåŒ…å«ä¸¤ä¸ªæ­¥éª¤ã€‚ç¬¬ä¸€æ­¥ä½¿ç”¨`actions/checkout`åŠ¨ä½œæ£€å‡ºä»“åº“ã€‚ç¬¬äºŒæ­¥é€šè¿‡è¿è¡Œ`make
    build`å‘½ä»¤æ¥æ„å»ºDockeré•œåƒã€‚å°±æ˜¯è¿™æ ·ã€‚
- en: '![](../Images/fd3b515554b5a6ab99aa8bef6cf90ad3.png)'
  id: totrans-212
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/fd3b515554b5a6ab99aa8bef6cf90ad3.png)'
- en: Workflow run â€” Image by author
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: å·¥ä½œæµè¿è¡Œ â€” ä½œè€…æä¾›çš„å›¾ç‰‡
- en: 'We also need to update the `orchestrator.yml` accordingly:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è¿˜éœ€è¦ç›¸åº”åœ°æ›´æ–° `orchestrator.yml`ï¼š
- en: The orchestrator is triggered when we push to the branch `main` .
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æˆ‘ä»¬æ¨é€åˆ° `main` åˆ†æ”¯æ—¶ï¼Œä¼šè§¦å‘ orchestratorã€‚
- en: '![](../Images/d38ab40f35c7b716ece3e7f38daff267.png)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d38ab40f35c7b716ece3e7f38daff267.png)'
- en: orchestrator.yml â€” image by author
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: orchestrator.yml â€” å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: 'To build a new docker image with every **new version** released in our GitHub
    repository, we need to create a new GitHub actions workflow:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†åœ¨æˆ‘ä»¬çš„ GitHub å­˜å‚¨åº“ä¸­å‘å¸ƒæ¯ä¸ª **æ–°ç‰ˆæœ¬** æ—¶æ„å»ºæ–°çš„ Docker é•œåƒï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ GitHub Actions å·¥ä½œæµï¼š
- en: This is a GitHub Actions workflow that builds and pushes a Docker image to the
    GitHub Container Registry (ghcr.io) when a release is published. The job named
    â€œbuild_and_pushâ€ has three steps. The first step checks out the repository using
    the `actions/checkout` action. The second step logs in to the GitHub Container
    Registry using the `docker/login-action`. The third step builds and pushes the
    Docker image using the `docker/build-push-action`.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯ä¸€ä¸ª GitHub Actions å·¥ä½œæµï¼Œå½“å‘å¸ƒç‰ˆæœ¬æ—¶ï¼Œå®ƒä¼šæ„å»ºå¹¶æ¨é€ Docker é•œåƒåˆ° GitHub Container Registry
    (ghcr.io)ã€‚åä¸ºâ€œbuild_and_pushâ€çš„ä½œä¸šæœ‰ä¸‰ä¸ªæ­¥éª¤ã€‚ç¬¬ä¸€æ­¥ä½¿ç”¨ `actions/checkout` æ“ä½œæ£€å‡ºå­˜å‚¨åº“ã€‚ç¬¬äºŒæ­¥ä½¿ç”¨ `docker/login-action`
    ç™»å½•åˆ° GitHub Container Registryã€‚ç¬¬ä¸‰æ­¥ä½¿ç”¨ `docker/build-push-action` æ„å»ºå¹¶æ¨é€ Docker é•œåƒã€‚
- en: '![](../Images/ad45621c6d66fd7de9d92e98106efd2b.png)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ad45621c6d66fd7de9d92e98106efd2b.png)'
- en: build_and_push â€” image by author
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: build_and_push â€” å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: Please note that, in order to login to GitHub Container Registry using [docker/login-action@v2](https://github.com/docker/login-action),
    we need to provide the secret **GH_TOKEN**, which is the PAT, we defined in [Part
    V](https://medium.com/@johschmidt42/setting-up-python-projects-part-v-206df3c1e3d3).
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œä¸ºäº†ä½¿ç”¨ [docker/login-action@v2](https://github.com/docker/login-action) ç™»å½•åˆ°
    GitHub Container Registryï¼Œæˆ‘ä»¬éœ€è¦æä¾› **GH_TOKEN** è¿™ä¸ª PATï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ [Part V](https://medium.com/@johschmidt42/setting-up-python-projects-part-v-206df3c1e3d3)
    ä¸­å®šä¹‰çš„é‚£æ ·ã€‚
- en: 'Here is a brief explanation of the parameters used in the last step [docker/build-push-action@4](https://github.com/docker/build-push-action):'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹æ˜¯æœ€åä¸€æ­¥ä¸­ä½¿ç”¨çš„å‚æ•°çš„ç®€è¦è¯´æ˜ [docker/build-push-action@4](https://github.com/docker/build-push-action)ï¼š
- en: '`context: .` specifies the build context as the current directory.'
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`context: .` æŒ‡å®šæ„å»ºä¸Šä¸‹æ–‡ä¸ºå½“å‰ç›®å½•ã€‚'
- en: '`push: true` specifies that the image should be pushed to the registry after
    it is built.'
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`push: true` æŒ‡å®šåœ¨æ„å»ºåå°†å›¾åƒæ¨é€åˆ°æ³¨å†Œè¡¨ã€‚'
- en: '`tags: ghcr.io/${{ github.repository }}:${{ github.ref_name }}` specifies the
    tag for the image. In this case, it is tagged with the name of the repository
    and the branch or tag name that triggered the workflow.'
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`tags: ghcr.io/${{ github.repository }}:${{ github.ref_name }}` æŒ‡å®šå›¾åƒçš„æ ‡ç­¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨å­˜å‚¨åº“çš„åç§°å’Œè§¦å‘å·¥ä½œæµçš„åˆ†æ”¯æˆ–æ ‡ç­¾åç§°è¿›è¡Œæ ‡è®°ã€‚'
- en: '`labels:` specifies labels for the image. In this case, it sets labels for
    the source, title, and version of the image.'
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`labels:` æŒ‡å®šå›¾åƒçš„æ ‡ç­¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒè®¾ç½®äº†å›¾åƒçš„æºã€æ ‡é¢˜å’Œç‰ˆæœ¬æ ‡ç­¾ã€‚'
- en: '`target: production` specifies the target stage to build in a multi-stage Dockerfile.'
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`target: production` æŒ‡å®šåœ¨å¤šé˜¶æ®µ Dockerfile ä¸­æ„å»ºçš„ç›®æ ‡é˜¶æ®µã€‚'
- en: '`github-token: ${{ secrets.GH_TOKEN }}` specifies the GitHub token to use for
    authentication.'
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`github-token: ${{ secrets.GH_TOKEN }}` æŒ‡å®šç”¨äºè®¤è¯çš„ GitHub ä»¤ç‰Œã€‚'
- en: 'We can see our new docker image on GitHub:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥åœ¨ GitHub ä¸Šçœ‹åˆ°æˆ‘ä»¬çš„æ–° Docker é•œåƒï¼š
- en: '![](../Images/1e486e3903a579d596a11e18564e76b0.png)'
  id: totrans-231
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/1e486e3903a579d596a11e18564e76b0.png)'
- en: Images on GitHub â€” image by author
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: GitHub ä¸Šçš„å›¾åƒ â€” å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: 'Badge:'
  id: totrans-233
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¾½ç« ï¼š
- en: 'For this part, we will add a badge to our repo as weâ€™ve done it before in the
    other parts. This time for the **build** pipeline. We can retrieve the badge when
    we click on a *build.yml* workflow run:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºè¿™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†åƒä»¥å‰ä¸€æ ·å‘æˆ‘ä»¬çš„ repo æ·»åŠ ä¸€ä¸ªå¾½ç« ã€‚è¿™ä¸€æ¬¡æ˜¯é’ˆå¯¹ **æ„å»º** ç®¡é“çš„ã€‚å½“æˆ‘ä»¬ç‚¹å‡» *build.yml* å·¥ä½œæµè¿è¡Œæ—¶ï¼Œå¯ä»¥æ£€ç´¢å¾½ç« ï¼š
- en: '![](../Images/2254ff4eefb21d7614ed6bb5b9e8d2b0.png)'
  id: totrans-235
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2254ff4eefb21d7614ed6bb5b9e8d2b0.png)'
- en: Create a status badge â€” image by author
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ›å»ºçŠ¶æ€å¾½ç«  â€” å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: Create a status badge from the workflow file on GitHub
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: ä» GitHub ä¸Šçš„å·¥ä½œæµæ–‡ä»¶åˆ›å»ºçŠ¶æ€å¾½ç« 
- en: '![](../Images/6ccdfb3057da98e8f6219e21e1ca646c.png)'
  id: totrans-238
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/6ccdfb3057da98e8f6219e21e1ca646c.png)'
- en: Copy status badge Markdown â€” Image by author
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: å¤åˆ¶çŠ¶æ€å¾½ç«  Markdown â€” å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: and select the main branch. The badge markdown can be copied and added to the
    *README.md:*
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¶é€‰æ‹©ä¸»åˆ†æ”¯ã€‚å¾½ç« çš„ Markdown å¯ä»¥å¤åˆ¶å¹¶æ·»åŠ åˆ° *README.md* ä¸­ï¼š
- en: 'Our landing page of the GitHub now looks like this â¤:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çš„ GitHub ç™»é™†é¡µé¢ç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ â¤ï¼š
- en: '![](../Images/ad2f4bc39f781c797b22d04a748a73a7.png)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ad2f4bc39f781c797b22d04a748a73a7.png)'
- en: 'Fifth badge in README.md: Build â€” Image by author'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: README.md ä¸­çš„ç¬¬äº”ä¸ªå¾½ç« ï¼šæ„å»º â€” å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: If you want to know how this magically shows the current status of the last
    pipeline run in *main*, have a look the commit [statuses API](https://docs.github.com/en/rest/commits/statuses)
    on GitHub.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æƒ³äº†è§£å¦‚ä½•ç¥å¥‡åœ°æ˜¾ç¤º *main* ä¸­æœ€åä¸€æ¬¡ç®¡é“è¿è¡Œçš„å½“å‰çŠ¶æ€ï¼Œè¯·æŸ¥çœ‹ GitHub ä¸Šçš„æäº¤ [statuses API](https://docs.github.com/en/rest/commits/statuses)ã€‚
- en: That concludes the core portion of this tutorial! We successfully created a
    **Dockerfile** and used it to build an **Docker image** that enables us to run
    our application in a **Docker container**. Additionally, we implemented a **CI/CD**
    pipeline that automatically builds our Docker images and pushes them to the **container
    registry**. To top it off, we added a badge to our *README.md* file to proudly
    display our functional build pipeline to the world!
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°±ç»“æŸäº†æ•™ç¨‹çš„æ ¸å¿ƒéƒ¨åˆ†ï¼æˆ‘ä»¬æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ª**Dockerfile**ï¼Œå¹¶ä½¿ç”¨å®ƒæ„å»ºäº†ä¸€ä¸ª**Docker é•œåƒ**ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨**Docker å®¹å™¨**ä¸­è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å®æ–½äº†ä¸€ä¸ª**CI/CD**
    ç®¡é“ï¼Œè‡ªåŠ¨æ„å»ºæˆ‘ä»¬çš„ Docker é•œåƒå¹¶å°†å…¶æ¨é€åˆ°**å®¹å™¨æ³¨å†Œè¡¨**ã€‚æœ€åï¼Œæˆ‘ä»¬åœ¨ *README.md* æ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªå¾½ç« ï¼Œå‘ä¸–ç•Œå±•ç¤ºæˆ‘ä»¬åŠŸèƒ½é½å…¨çš„æ„å»ºç®¡é“ï¼
- en: That was the last part! Did this tutorial help you to build a Python project
    on GitHub? Any suggestions for improvement? Let me know your thoughts!
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°±æ˜¯æœ€åä¸€éƒ¨åˆ†ï¼è¿™ä¸ªæ•™ç¨‹æ˜¯å¦å¸®åŠ©ä½ åœ¨ GitHub ä¸Šæ„å»ºäº†ä¸€ä¸ª Python é¡¹ç›®ï¼Ÿæœ‰ä»»ä½•æ”¹è¿›å»ºè®®å—ï¼Ÿè®©æˆ‘çŸ¥é“ä½ çš„æƒ³æ³•ï¼
- en: '[](https://johschmidt42.medium.com/membership?source=post_page-----cbdbf28eff53--------------------------------)
    [## Join Medium with my referral link - Johannes Schmidt'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://johschmidt42.medium.com/membership?source=post_page-----cbdbf28eff53--------------------------------)
    [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Medium - Johannes Schmidt'
- en: Read every story from Johannes Schmidt (and thousands of other writers on Medium).
    Your membership fee directlyâ€¦
  id: totrans-248
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: é˜…è¯» Johannes Schmidt çš„æ¯ä¸ªæ•…äº‹ï¼ˆä»¥åŠ Medium ä¸Šçš„å…¶ä»–æˆåƒä¸Šä¸‡åä½œè€…çš„æ•…äº‹ï¼‰ã€‚ä½ çš„ä¼šå‘˜è´¹ç›´æ¥â€¦
- en: johschmidt42.medium.com](https://johschmidt42.medium.com/membership?source=post_page-----cbdbf28eff53--------------------------------)
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: johschmidt42.medium.com](https://johschmidt42.medium.com/membership?source=post_page-----cbdbf28eff53--------------------------------)
- en: Bonus
  id: totrans-250
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¥–åŠ±
- en: 'Clean up:'
  id: totrans-251
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ¸…ç†ï¼š
- en: 'Here are some useful commands, that you can use when using the Docker CLI:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹æ˜¯ä½¿ç”¨ Docker CLI æ—¶çš„ä¸€äº›æœ‰ç”¨å‘½ä»¤ï¼š
- en: 'To stop all containers & remove them:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: è¦åœæ­¢æ‰€æœ‰å®¹å™¨å¹¶åˆ é™¤å®ƒä»¬ï¼š
- en: '[PRE30]'
  id: totrans-254
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'To remove all unused docker images:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: è¦åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ Docker é•œåƒï¼š
- en: '[PRE31]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Vulnerability scanning in Docker images
  id: totrans-257
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Docker é•œåƒä¸­çš„æ¼æ´æ‰«æ
- en: Vulnerability scanning is a crucial step in ensuring the **security** of your
    docker images. It helps you identify and fix any potential weaknesses or risks
    that could compromise your application or data. One of the tools that can help
    you is [**trivy**](https://github.com/aquasecurity/trivy).
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: æ¼æ´æ‰«ææ˜¯ç¡®ä¿ Docker é•œåƒ**å®‰å…¨æ€§**çš„å…³é”®æ­¥éª¤ã€‚å®ƒå¸®åŠ©ä½ è¯†åˆ«å¹¶ä¿®å¤å¯èƒ½ä¼šå±å®³åº”ç”¨ç¨‹åºæˆ–æ•°æ®çš„æ½œåœ¨å¼±ç‚¹æˆ–é£é™©ã€‚å…¶ä¸­ä¸€ä¸ªå¯ä»¥å¸®åŠ©ä½ çš„å·¥å…·æ˜¯ [**trivy**](https://github.com/aquasecurity/trivy)ã€‚
- en: This open-source tool is a simple and fast **vulnerability scanner for docker
    images** that supports multiple formats and sources. I will demonstrate how to
    use it locally. Ideally, you should consider creating a GitHub actions workflow
    that runs whenever you build a docker image!
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªå¼€æºå·¥å…·æ˜¯ä¸€ä¸ªç®€å•å¿«é€Ÿçš„**Docker é•œåƒæ¼æ´æ‰«æå™¨**ï¼Œæ”¯æŒå¤šç§æ ¼å¼å’Œæ¥æºã€‚æˆ‘å°†æ¼”ç¤ºå¦‚ä½•åœ¨æœ¬åœ°ä½¿ç”¨å®ƒã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥è€ƒè™‘åˆ›å»ºä¸€ä¸ª GitHub
    Actions å·¥ä½œæµï¼Œæ¯å½“ä½ æ„å»º Docker é•œåƒæ—¶éƒ½è¿è¡Œï¼
- en: We first should install **trivy** according to the [documentation](https://aquasecurity.github.io/trivy/v0.43/getting-started/installation/).
    After building the production docker image with
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬é¦–å…ˆåº”æ ¹æ® [æ–‡æ¡£](https://aquasecurity.github.io/trivy/v0.43/getting-started/installation/)
    å®‰è£… **trivy**ã€‚åœ¨æ„å»ºç”Ÿäº§ Docker é•œåƒå
- en: '[PRE32]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: we can scan the built image with
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æ‰«ææ„å»ºçš„é•œåƒ
- en: '[PRE33]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'This will download the latest known vulnerabilites from a database and scan
    the image. The output will be shown in a table `--format table` with only the
    findings that have either CRITICAL or HIGH severity `--severity CRITICAL,HIGH`
    :'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°†ä»æ•°æ®åº“ä¸‹è½½å·²çŸ¥çš„æœ€æ–°æ¼æ´å¹¶æ‰«æé•œåƒã€‚è¾“å‡ºå°†ä»¥è¡¨æ ¼å½¢å¼`--format table`æ˜¾ç¤ºï¼Œä»…åŒ…å«ä¸¥é‡æ€§ä¸º CRITICAL æˆ– HIGH çš„å‘ç°`--severity
    CRITICAL,HIGH`ï¼š
- en: '[PRE34]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'There or **2 OS libraries** with the severity **HIGH**. Both donâ€™t provide
    a version we can upgrade to (see *Fixed Version* column) in order to fix the vulnerability
    in our docker image. So hereâ€™s how weâ€™re going to deal with them:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: å­˜åœ¨**2 ä¸ªæ“ä½œç³»ç»Ÿåº“**ï¼Œå…¶ä¸¥é‡æ€§ä¸º **HIGH**ã€‚è¿™ä¸¤ä¸ªåº“éƒ½æ²¡æœ‰æä¾›å¯ä»¥å‡çº§åˆ°çš„ç‰ˆæœ¬ï¼ˆå‚è§ *Fixed Version* åˆ—ï¼‰ï¼Œä»¥ä¿®å¤æˆ‘ä»¬
    Docker é•œåƒä¸­çš„æ¼æ´ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æŒ‰ä»¥ä¸‹æ–¹å¼å¤„ç†å®ƒä»¬ï¼š
- en: '**linux-libc-dev**:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: '**linux-libc-dev**ï¼š'
- en: This is a package that is not required for our application to run. So itâ€™s probably
    best to **uninstall** it!
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯ä¸€ä¸ªè¿è¡Œåº”ç”¨ç¨‹åºæ—¶ä¸éœ€è¦çš„åŒ…ã€‚å› æ­¤ï¼Œæœ€å¥½è¿˜æ˜¯**å¸è½½**å®ƒï¼
- en: '**perl-base**'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: '**perl-base**'
- en: This OS package provides the Perl interpreter and is required for other libraries
    that our application uses. That means that we cannot uninstall it and we cannot
    fix it. Hence, we must **accept the risk**. Accepting known vulnerabilites should
    be acknowledged and approved by management. We can then add the vunerability,
    e.g. CVE-2023â€“31484, to a .*trivyignore* file run the scanner again.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªæ“ä½œç³»ç»ŸåŒ…æä¾›äº† Perl è§£é‡Šå™¨ï¼Œå¹¶ä¸”æ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºä½¿ç”¨çš„å…¶ä»–åº“æ‰€å¿…éœ€çš„ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½å¸è½½å®ƒï¼Œä¹Ÿä¸èƒ½ä¿®å¤å®ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»**æ¥å—é£é™©**ã€‚æ¥å—å·²çŸ¥æ¼æ´åº”ç”±ç®¡ç†å±‚ç¡®è®¤å’Œæ‰¹å‡†ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¼æ´ï¼Œä¾‹å¦‚
    CVE-2023â€“31484ï¼Œæ·»åŠ åˆ° .*trivyignore* æ–‡ä»¶ä¸­ï¼Œå†æ¬¡è¿è¡Œæ‰«æç¨‹åºã€‚
- en: 'Here are the changes:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œæ˜¯å˜æ›´å†…å®¹ï¼š
- en: '[PRE35]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '[PRE36]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'When we run the command again (this time including the .*trivyignore* file):'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æˆ‘ä»¬å†æ¬¡è¿è¡Œå‘½ä»¤ï¼ˆè¿™æ¬¡åŒ…å« .*trivyignore* æ–‡ä»¶ï¼‰æ—¶ï¼š
- en: '[PRE37]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'No vulnerabilites of severity HIGH or CRITICAL are reported anymore:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸å†æŠ¥å‘Šä¸¥é‡æ€§ä¸º HIGH æˆ– CRITICAL çš„æ¼æ´ï¼š
- en: '[PRE38]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Cheers!
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: å¹²æ¯ï¼
