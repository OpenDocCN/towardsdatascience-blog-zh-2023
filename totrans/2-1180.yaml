- en: How to Extend Pandas DataFrames with Custom Methods to Supercharge Code Functionality
    and Readability
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¦‚ä½•é€šè¿‡è‡ªå®šä¹‰æ–¹æ³•æ‰©å±•Pandasæ•°æ®æ¡†ï¼Œä»¥å¢å¼ºä»£ç çš„åŠŸèƒ½æ€§å’Œå¯è¯»æ€§
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/how-to-extend-pandas-dataframes-with-custom-methods-to-supercharge-code-functionality-readability-f4ae983ad715](https://towardsdatascience.com/how-to-extend-pandas-dataframes-with-custom-methods-to-supercharge-code-functionality-readability-f4ae983ad715)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/how-to-extend-pandas-dataframes-with-custom-methods-to-supercharge-code-functionality-readability-f4ae983ad715](https://towardsdatascience.com/how-to-extend-pandas-dataframes-with-custom-methods-to-supercharge-code-functionality-readability-f4ae983ad715)
- en: '**A step-by-step guide to extending pandas DataFrames with custom methods including
    full examples of how to implement extensions for conditional probability and expected
    values**'
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**é€æ­¥æŒ‡å—ï¼šå¦‚ä½•é€šè¿‡è‡ªå®šä¹‰æ–¹æ³•æ‰©å±•pandasæ•°æ®æ¡†ï¼ŒåŒ…æ‹¬å®ç°æ¡ä»¶æ¦‚ç‡å’ŒæœŸæœ›å€¼æ‰©å±•çš„å®Œæ•´ç¤ºä¾‹**'
- en: '[](https://grahamharrison-86487.medium.com/?source=post_page-----f4ae983ad715--------------------------------)[![Graham
    Harrison](../Images/c6bfe00c6e0cfcdf3bd042c7fdc03554.png)](https://grahamharrison-86487.medium.com/?source=post_page-----f4ae983ad715--------------------------------)[](https://towardsdatascience.com/?source=post_page-----f4ae983ad715--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----f4ae983ad715--------------------------------)
    [Graham Harrison](https://grahamharrison-86487.medium.com/?source=post_page-----f4ae983ad715--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://grahamharrison-86487.medium.com/?source=post_page-----f4ae983ad715--------------------------------)[![Graham
    Harrison](../Images/c6bfe00c6e0cfcdf3bd042c7fdc03554.png)](https://grahamharrison-86487.medium.com/?source=post_page-----f4ae983ad715--------------------------------)[](https://towardsdatascience.com/?source=post_page-----f4ae983ad715--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----f4ae983ad715--------------------------------)
    [Graham Harrison](https://grahamharrison-86487.medium.com/?source=post_page-----f4ae983ad715--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----f4ae983ad715--------------------------------)
    Â·6 min readÂ·Oct 10, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page-----f4ae983ad715--------------------------------)
    Â·6åˆ†é’Ÿé˜…è¯»Â·2023å¹´10æœˆ10æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/a15437590c86b85c8418a6056b45fb95.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a15437590c86b85c8418a6056b45fb95.png)'
- en: Photo by [Markus Spiske](https://unsplash.com/@markusspiske?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    on [Unsplash](https://unsplash.com/photos/hvSr_CVecVI?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ç…§ç‰‡ç”± [Markus Spiske](https://unsplash.com/@markusspiske?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
    æ‹æ‘„ï¼Œæ¥è‡ª [Unsplash](https://unsplash.com/photos/hvSr_CVecVI?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)
- en: Introduction
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä»‹ç»
- en: The Problem
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: é—®é¢˜
- en: Pandas data frames come with a wide range of in-built functions, but there are
    always new ways that Python programmers will want to interrogate and transform
    their data.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: Pandasæ•°æ®æ¡†æä¾›äº†å¹¿æ³›çš„å†…ç½®å‡½æ•°ï¼Œä½†Pythonç¨‹åºå‘˜æ€»æ˜¯å¸Œæœ›ä»¥æ–°çš„æ–¹å¼æŸ¥è¯¢å’Œè½¬æ¢æ•°æ®ã€‚
- en: The Opportunity
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æœºä¼š
- en: A common approach is to write functions and pass the data frames as parameters
    but this can become unwieldly, whereas the optimum approach would be to add new
    methods and properties directly to the pandas classes.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯ç¼–å†™å‡½æ•°å¹¶å°†æ•°æ®æ¡†ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä½†è¿™å¯èƒ½ä¼šå˜å¾—éš¾ä»¥å¤„ç†ï¼Œè€Œæœ€ä½³çš„æ–¹æ³•æ˜¯ç›´æ¥å‘pandasç±»æ·»åŠ æ–°çš„æ–¹æ³•å’Œå±æ€§ã€‚
- en: The Way Forward
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å‰è¿›çš„æ–¹å‘
- en: It is very easy to extend the functionality of classes in pandas or any other
    library with custom methods and properties producing code which is easy to read,
    understand and re-use.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰©å±•pandasæˆ–ä»»ä½•å…¶ä»–åº“ä¸­çš„ç±»åŠŸèƒ½éå¸¸ç®€å•ï¼Œåªéœ€ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•å’Œå±æ€§å³å¯ç”Ÿæˆæ˜“äºé˜…è¯»ã€ç†è§£å’Œé‡ç”¨çš„ä»£ç ã€‚
- en: Background
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: èƒŒæ™¯
- en: I had been writing some code for a causal inference library that involved some
    complex data operations and the constant calls out to functions made the code
    difficult to read and understand.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘åœ¨ä¸ºä¸€ä¸ªå› æœæ¨æ–­åº“ç¼–å†™ä¸€äº›ä»£ç ï¼Œè¿™æ¶‰åŠåˆ°ä¸€äº›å¤æ‚çš„æ•°æ®æ“ä½œï¼Œè€Œé¢‘ç¹è°ƒç”¨å‡½æ•°ä½¿å¾—ä»£ç éš¾ä»¥é˜…è¯»å’Œç†è§£ã€‚
- en: I hit on the idea that if pandas data frames did the things that I was writing
    functions for natively the code would become clean, simple and easy to understand
    and it was only a small jump from there to finding out how to extend pandas myself
    â€¦
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘æƒ³åˆ°ä¸€ä¸ªä¸»æ„ï¼Œå¦‚æœpandasæ•°æ®æ¡†åŸç”Ÿå®ç°äº†æˆ‘æ‰€ç¼–å†™çš„å‡½æ•°ï¼Œé‚£ä¹ˆä»£ç å°†å˜å¾—å¹²å‡€ã€ç®€å•ä¸”æ˜“äºç†è§£ï¼Œä»è€Œå¾ˆå®¹æ˜“æ‰¾åˆ°å¦‚ä½•æ‰©å±•pandasçš„æ–¹æ³•â€¦â€¦
- en: The Solution
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è§£å†³æ–¹æ¡ˆ
- en: The first function I wanted to implement was probability and conditional probability.
    Let us consider the following dataset â€¦
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘æƒ³å®ç°çš„ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯æ¦‚ç‡å’Œæ¡ä»¶æ¦‚ç‡ã€‚è®©æˆ‘ä»¬è€ƒè™‘ä»¥ä¸‹æ•°æ®é›†â€¦â€¦
- en: '![](../Images/61346ad3797b5150c68255667910507b.png)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/61346ad3797b5150c68255667910507b.png)'
- en: Image by Author
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œè€…æä¾›çš„å›¾åƒ
- en: This is a synthetic dataset that captures the relationship between training,
    skills and income with each row representing an individual who either trained
    (or did not), acquired skills (or did not) and increased their income (or did
    not).
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯ä¸€ä¸ªåˆæˆæ•°æ®é›†ï¼Œæ•æ‰äº†è®­ç»ƒã€æŠ€èƒ½å’Œæ”¶å…¥ä¹‹é—´çš„å…³ç³»ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªä¸ªä½“ï¼Œè¯¥ä¸ªä½“è¦ä¹ˆæ¥å—äº†è®­ç»ƒï¼ˆæˆ–æ²¡æœ‰ï¼‰ï¼Œè·å¾—äº†æŠ€èƒ½ï¼ˆæˆ–æ²¡æœ‰ï¼‰ï¼Œæ”¶å…¥å¢åŠ äº†ï¼ˆæˆ–æ²¡æœ‰ï¼‰ã€‚
- en: It would be very useful to know â€” given our data what is the probability that
    training was received.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: äº†è§£æ•°æ®åï¼ŒçŸ¥é“è®­ç»ƒæ˜¯å¦æ¥å—è¿‡å°†ä¼šéå¸¸æœ‰ç”¨ã€‚
- en: 'This can be expressed as a mathematical formula as follows: **â„™(ğ‘¡ğ‘Ÿğ‘ğ‘–ğ‘›ğ‘–ğ‘›ğ‘”=1)**
    which means â€œwhat is the probability that training = 1?â€.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°å­¦å…¬å¼å¦‚ä¸‹ï¼š**â„™(ğ‘¡ğ‘Ÿğ‘ğ‘–ğ‘›ğ‘–ğ‘›ğ‘”=1)**ï¼Œæ„æ€æ˜¯â€œè®­ç»ƒ=1çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿâ€ã€‚
- en: The traditional way of working this out would be to write specific code to filter
    the `DataFrame` down to just the rows where `training==1` and count the rows in
    the filter as a proportion of the overall data ...
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: ä¼ ç»Ÿçš„åšæ³•æ˜¯ç¼–å†™ç‰¹å®šçš„ä»£ç ï¼Œå°† `DataFrame` ç­›é€‰åˆ°ä»…åŒ…å« `training==1` çš„è¡Œï¼Œå¹¶è®¡ç®—è¿‡æ»¤åçš„è¡Œæ•°å æ•´ä½“æ•°æ®çš„æ¯”ä¾‹â€¦
- en: This is fairly straightforward, but specific code has to be written every time
    a probability needs to be calculated and it is not immediately obvious that this
    code relates to probabilities. Wouldnâ€™t it be much better if we could simple write
    `df_training.probability("p(training=1)")`?
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç›¸å½“ç›´æ¥ï¼Œä½†æ¯æ¬¡éœ€è¦è®¡ç®—æ¦‚ç‡æ—¶å¿…é¡»ç¼–å†™ç‰¹å®šä»£ç ï¼Œè€Œä¸”è¿™æ®µä»£ç ä¸æ¦‚ç‡çš„å…³ç³»å¹¶ä¸ç«‹å³æ˜¾ç°ã€‚å¦‚æœæˆ‘ä»¬èƒ½ç®€å•åœ°å†™ `df_training.probability("p(training=1)")`
    ä¸æ˜¯æ›´å¥½å—ï¼Ÿ
- en: Well, it turns out that this can be done in just 7 lines of program code for
    any probability or conditional probability!
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: å¥½å§ï¼Œäº‹å®è¯æ˜ï¼Œè¿™å¯ä»¥ç”¨ 7 è¡Œç¨‹åºä»£ç å®Œæˆï¼Œæ— è®ºæ˜¯ä»»ä½•æ¦‚ç‡è¿˜æ˜¯æ¡ä»¶æ¦‚ç‡ï¼
- en: The Complete Source Code for Probabilities
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ¦‚ç‡çš„å®Œæ•´æºä»£ç 
- en: Here is the full code followed by a detailed explanationâ€¦
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹æ˜¯å®Œæ•´ä»£ç åŠè¯¦ç»†è§£é‡Šâ€¦
- en: Understanding the Regular Expressions
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç†è§£æ­£åˆ™è¡¨è¾¾å¼
- en: The code has been significantly compacted by using regular expressions to implement
    string parsing and whilst this is not an article about regular expressions it
    would be useful to take a moment to understand them â€¦
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥å®ç°å­—ç¬¦ä¸²è§£æï¼Œä»£ç å·²ç»å¤§å¤§å‹ç¼©ï¼Œå°½ç®¡è¿™ä¸æ˜¯å…³äºæ­£åˆ™è¡¨è¾¾å¼çš„æ–‡ç« ï¼Œä½†èŠ±ç‚¹æ—¶é—´ç†è§£å®ƒä»¬ä¼šå¾ˆæœ‰ç”¨â€¦
- en: It is easier to understand a regular expression by using one of the freely available
    parsers like [https://regex101.com/](https://regex101.com/). Armed with regex101
    it is easy to unpack and explain the regular expressions that have been used â€¦
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨åƒ [https://regex101.com/](https://regex101.com/) è¿™æ ·çš„å…è´¹è§£æå™¨æ¥ç†è§£æ­£åˆ™è¡¨è¾¾å¼ä¼šæ›´å®¹æ˜“ã€‚æœ‰äº† regex101ï¼Œè§£æå’Œè§£é‡Šä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼å˜å¾—ç®€å•â€¦
- en: '`VARIABLE_REGEX` - `[a-zA-Z0-9_ "\'']+` matches variable names, for example
    "SurnameField", "ABC123", X, training etc.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`VARIABLE_REGEX` - `[a-zA-Z0-9_ "\'']+` åŒ¹é…å˜é‡åï¼Œä¾‹å¦‚ "SurnameField", "ABC123",
    X, training ç­‰ç­‰ã€‚'
- en: '`OPERATOR_REGEX` - `=|<|<=|>|>=|!=` matches the common mathematical operators
    i.e. =, <, <=, >, >=, !='
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`OPERATOR_REGEX` - `=|<|<=|>|>=|!=` åŒ¹é…å¸¸è§çš„æ•°å­¦è¿ç®—ç¬¦ï¼Œå³ =, <, <=, >, >=, !='
- en: '`VALUE_REGEX` - `\''[^\'']*\''|\"[^\"]*\"|-?\d+\.?\d*` matches a value, for
    example 48.52, 5, "01/01/2023", ''Hello'' etc.'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`VALUE_REGEX` - `\''[^\'']*\''|\"[^\"]*\"|-?\d+\.?\d*` åŒ¹é…ä¸€ä¸ªå€¼ï¼Œä¾‹å¦‚ 48.52, 5, "01/01/2023",
    ''Hello'' ç­‰ç­‰ã€‚'
- en: '`ASSIGNMENT_REGEX` then concatenates those expression to identify the pattern
    VARIABLE, OPERATOR, VALUE.'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '`ASSIGNMENT_REGEX` ç„¶åå°†è¿™äº›è¡¨è¾¾å¼è¿æ¥èµ·æ¥ä»¥è¯†åˆ«æ¨¡å¼ VARIABLE, OPERATOR, VALUEã€‚'
- en: For example â€¦
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚â€¦
- en: '`re.findall(ASSIGNMENT_REGEX, "training=1, income=0")` will parse `"training=1,
    income=0"` into `[(''training'', ''='', ''1''), (''income'', ''='', ''0'')]`'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '`re.findall(ASSIGNMENT_REGEX, "training=1, income=0")` å°† `"training=1, income=0"`
    è§£æä¸º `[(''training'', ''='', ''1''), (''income'', ''='', ''0'')]`'
- en: Finally we have `PROB_REGEX` - `(?i)^p\(([^|]+)(?:\s*\|\s*)?(.*)?\)$`
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€ç»ˆæˆ‘ä»¬æœ‰ `PROB_REGEX` - `(?i)^p\(([^|]+)(?:\s*\|\s*)?(.*)?\)$`
- en: This is used to parse probability expressions and conditional probability expressions
    as follows â€¦
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç”¨äºè§£ææ¦‚ç‡è¡¨è¾¾å¼å’Œæ¡ä»¶æ¦‚ç‡è¡¨è¾¾å¼å¦‚ä¸‹â€¦
- en: '`re.findall(PROB_REGEX, "p(A=5, B=6)")` returns `[(''A=5, B=6'', '''')]` and
    `re.findall(PROB_REGEX, "p(A=5, B=6 | X=1, Y=2)")` returns `[(''A=5, B=6 '', ''X=1,
    Y=2'')]`'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '`re.findall(PROB_REGEX, "p(A=5, B=6)")` è¿”å› `[(''A=5, B=6'', '''')]` å’Œ `re.findall(PROB_REGEX,
    "p(A=5, B=6 | X=1, Y=2)")` è¿”å› `[(''A=5, B=6 '', ''X=1, Y=2'')]`'
- en: Probability and Conditional Probability
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ¦‚ç‡å’Œæ¡ä»¶æ¦‚ç‡
- en: At this point it is worth taking a small diversion to explore conditional probability
    statements.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå€¼å¾—ç¨å¾®åç¦»ä¸€ä¸‹ï¼Œæ¢ç´¢æ¡ä»¶æ¦‚ç‡è¯­å¥ã€‚
- en: We have already established that **â„™(ğ‘¡ğ‘Ÿğ‘ğ‘–ğ‘›ğ‘–ğ‘›ğ‘”=1)** can be read as â€œwhat is the
    probability that training = 1?â€
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å·²ç»ç¡®å®š **â„™(ğ‘¡ğ‘Ÿğ‘ğ‘–ğ‘›ğ‘–ğ‘›ğ‘”=1)** å¯ä»¥ç†è§£ä¸ºâ€œè®­ç»ƒ=1çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿâ€
- en: 'This next expression is a conditional probability: **â„™(ğ‘–ğ‘›ğ‘ğ‘œğ‘šğ‘’=1âˆ£ğ‘¡ğ‘Ÿğ‘ğ‘–ğ‘›ğ‘–ğ‘›ğ‘”=1).**'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯ä¸€ä¸ªæ¡ä»¶æ¦‚ç‡ï¼š**â„™(ğ‘–ğ‘›ğ‘ğ‘œğ‘šğ‘’=1âˆ£ğ‘¡ğ‘Ÿğ‘ğ‘–ğ‘›ğ‘–ğ‘›ğ‘”=1)ã€‚**
- en: It can be read as â€œwhat is the probability that income = 1 given that training
    = 1?â€ i.e. in our data example â€œwhat is the probability that income increased
    given that training has been received?â€.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒå¯ä»¥ç†è§£ä¸ºâ€œåœ¨ training = 1 çš„æƒ…å†µä¸‹ï¼Œincome = 1 çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿâ€ å³åœ¨æˆ‘ä»¬çš„æ•°æ®ç¤ºä¾‹ä¸­ï¼Œâ€œåœ¨æ¥å—åŸ¹è®­çš„æƒ…å†µä¸‹ï¼Œæ”¶å…¥å¢åŠ çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿâ€
- en: The part of the expression on the left hand side of the â€œ|â€ is termed the â€œoutcomeâ€
    and on the right hand side as the â€œeventsâ€ and the whole thing **â„™(ğ‘œğ‘¢ğ‘¡ğ‘ğ‘œğ‘šğ‘’âˆ£ğ‘’ğ‘£ğ‘’ğ‘›ğ‘¡ğ‘ )**
    can be read as â€œwhat is the probability of the outcome given that the events have
    already occurred?â€
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: è¡¨è¾¾å¼ä¸­â€œ|â€å·¦ä¾§çš„éƒ¨åˆ†è¢«ç§°ä¸ºâ€œç»“æœâ€ï¼Œå³ä¾§çš„éƒ¨åˆ†ç§°ä¸ºâ€œäº‹ä»¶â€ï¼Œæ•´ä¸ªè¡¨è¾¾å¼ **â„™(ğ‘œğ‘¢ğ‘¡ğ‘ğ‘œğ‘šğ‘’âˆ£ğ‘’ğ‘£ğ‘’ğ‘›ğ‘¡ğ‘ )** å¯ä»¥ç†è§£ä¸ºâ€œåœ¨äº‹ä»¶å·²ç»å‘ç”Ÿçš„æƒ…å†µä¸‹ï¼Œç»“æœçš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿâ€
- en: Understanding the Functions
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç†è§£å‡½æ•°
- en: So to break our code down letâ€™s start with the `probability` function ...
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥ä¸ºäº†åˆ†è§£æˆ‘ä»¬çš„ä»£ç ï¼Œè®©æˆ‘ä»¬ä» `probability` å‡½æ•°å¼€å§‹...
- en: '`parse_probability_expr = re.findall(PROB_REGEX, expression)` parses the expression
    passed in so `"p(income=1 | training=1, skills=1)"` is parsed into `[(''income=1
    '', ''training=1, skills=1'')]`.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '`parse_probability_expr = re.findall(PROB_REGEX, expression)` è§£æä¼ å…¥çš„è¡¨è¾¾å¼ï¼Œæ‰€ä»¥ `"p(income=1
    | training=1, skills=1)"` è¢«è§£æä¸º `[(''income=1 '', ''training=1, skills=1'')]`ã€‚'
- en: â€¦ so `parse_probability_expr[0][1].strip()` contains `'training=1, skills=1'`
    and `parse_probability_expr[0][0].strip()` contains `'income=1'`
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: â€¦å› æ­¤ `parse_probability_expr[0][1].strip()` åŒ…å« `'training=1, skills=1'` å’Œ `parse_probability_expr[0][0].strip()`
    åŒ…å« `'income=1'`
- en: To understand the rest of the function lets take a look at the `_filter_dataset`
    function ...
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†ç†è§£å‡½æ•°çš„å…¶ä½™éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ `_filter_dataset` å‡½æ•°...
- en: The next stage is to unpack the `_filter_dataset` function ...
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹ä¸€æ­¥æ˜¯è§£åŒ… `_filter_dataset` å‡½æ•°...
- en: '`_filter_dataset` is taking part of a probability expression like `''training=1,
    skills=1''` and converting it into a `DataFrame` filter.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '`_filter_dataset` å¤„ç†éƒ¨åˆ†æ¦‚ç‡è¡¨è¾¾å¼å¦‚ `''training=1, skills=1''` å¹¶å°†å…¶è½¬æ¢ä¸º `DataFrame`
    è¿‡æ»¤å™¨ã€‚'
- en: For example `'training=1, skills=1'` is transformed into `"(data['training']
    == 1) & (data['skills'] == 1)"` which is then applied to the `DataFrame` to filter
    it.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚ `'training=1, skills=1'` è¢«è½¬æ¢ä¸º `"(data['training'] == 1) & (data['skills']
    == 1)"`ï¼Œç„¶ååº”ç”¨åˆ° `DataFrame` ä¸­ä»¥è¿›è¡Œè¿‡æ»¤ã€‚
- en: The remaining code uses `_filter_dataset` to calculate the probability from
    the expression ...
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: å‰©ä¸‹çš„ä»£ç ä½¿ç”¨ `_filter_dataset` ä»è¡¨è¾¾å¼ä¸­è®¡ç®—æ¦‚ç‡...
- en: Also note that if there is no conditional, for example in the case where the
    expression is something like `p(training=1)` then step 1 simply returns the full
    dataset so step 2 will calculate the (non conditional) probability correctly
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰æ¡ä»¶ï¼Œä¾‹å¦‚åœ¨è¡¨è¾¾å¼ä¸º `p(training=1)` çš„æƒ…å†µä¸‹ï¼Œç¬¬1æ­¥ä»…è¿”å›å®Œæ•´æ•°æ®é›†ï¼Œå› æ­¤ç¬¬2æ­¥å°†æ­£ç¡®è®¡ç®—ï¼ˆæ— æ¡ä»¶ï¼‰æ¦‚ç‡ã€‚
- en: Extending the Pandas DataFrame Class
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ‰©å±• Pandas `DataFrame` ç±»
- en: The only thing left to do is to use Python â€œmonkey patchingâ€ notation to extend
    the `DataFrame` class with a new method ...
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: å‰©ä¸‹è¦åšçš„å°±æ˜¯ä½¿ç”¨ Python â€œmonkey patchingâ€ è¯­æ³•æ‰©å±• `DataFrame` ç±»ï¼Œæ·»åŠ ä¸€ä¸ªæ–°æ–¹æ³•...
- en: '`pd.DataFrame.probability = probability`'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '`pd.DataFrame.probability = probability`'
- en: This effectively adds a new method to the pandas `DataFrame` class and any `DataFrame`
    you create will be able to call the new method to calculate probabilities and
    conditional probabilities on the data.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å®é™…ä¸Šä¸º pandas `DataFrame` ç±»æ·»åŠ äº†ä¸€ä¸ªæ–°æ–¹æ³•ï¼Œä»»ä½•ä½ åˆ›å»ºçš„ `DataFrame` éƒ½å¯ä»¥è°ƒç”¨æ–°æ–¹æ³•æ¥è®¡ç®—æ•°æ®ä¸Šçš„æ¦‚ç‡å’Œæ¡ä»¶æ¦‚ç‡ã€‚
- en: Also, if the complete source code is stored in a separate Python module, for
    example `dataframe_extensions.py` then a simple 1 line import will include those
    extension methods and any other code module that you write ...
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: æ­¤å¤–ï¼Œå¦‚æœå®Œæ•´çš„æºä»£ç å­˜å‚¨åœ¨ä¸€ä¸ªå•ç‹¬çš„ Python æ¨¡å—ä¸­ï¼Œä¾‹å¦‚ `dataframe_extensions.py`ï¼Œé‚£ä¹ˆåªéœ€ä¸€è¡Œå¯¼å…¥å³å¯åŒ…å«è¿™äº›æ‰©å±•æ–¹æ³•å’Œä½ ç¼–å†™çš„ä»»ä½•å…¶ä»–ä»£ç ...
- en: '`import dataframe_extensions`'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '`import dataframe_extensions`'
- en: Testing the Solution
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æµ‹è¯•è§£å†³æ–¹æ¡ˆ
- en: Once the code has been written and the`DataFrame` class has been extended it
    is very easy and intuitive to invoke it ...
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦ä»£ç ç¼–å†™å®Œæˆå¹¶ä¸” `DataFrame` ç±»å·²è¢«æ‰©å±•ï¼Œè°ƒç”¨å®ƒå°±å˜å¾—éå¸¸ç®€å•å’Œç›´è§‚...
- en: '`0.5`'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '`0.5`'
- en: '`0.05`'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '`0.05`'
- en: '`0.1`'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '`0.1`'
- en: Bonus Section â€” Expected Values
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: é¢å¤–éƒ¨åˆ† â€” æœŸæœ›å€¼
- en: Expected values or expectancy represents the average or long-term value of a
    random variable.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: æœŸæœ›å€¼æˆ–æœŸæœ›è¡¨ç¤ºéšæœºå˜é‡çš„å¹³å‡å€¼æˆ–é•¿æœŸå€¼ã€‚
- en: Where we have a sample of continuous data in a `DataFrame` column this would
    simply be the mean - `df_training["training"].mean()` which does not seem worth
    an extension function.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æˆ‘ä»¬åœ¨ `DataFrame` åˆ—ä¸­æœ‰ä¸€ç»„è¿ç»­æ•°æ®æ—¶ï¼Œè¿™å°†ç®€å•åœ°æ˜¯å‡å€¼ - `df_training["training"].mean()`ï¼Œè¿™ä¼¼ä¹ä¸å€¼å¾—æ‰©å±•åŠŸèƒ½ã€‚
- en: However, expectation can be conditional e.g. **ğ”¼[ğ‘–ğ‘›ğ‘ğ‘œğ‘šğ‘’|ğ‘¡ğ‘Ÿğ‘ğ‘–ğ‘›ğ‘–ğ‘›ğ‘”=1]** can be
    read as â€œWhat is the expected value of income given that training = 1?â€
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼ŒæœŸæœ›å€¼å¯ä»¥æ˜¯æ¡ä»¶æ€§çš„ï¼Œä¾‹å¦‚ **ğ”¼[ğ‘–ğ‘›ğ‘ğ‘œğ‘šğ‘’|ğ‘¡ğ‘Ÿğ‘ğ‘–ğ‘›ğ‘–ğ‘›ğ‘”=1]** å¯ä»¥ç†è§£ä¸ºâ€œåœ¨ training = 1 çš„æƒ…å†µä¸‹ï¼Œæ”¶å…¥çš„æœŸæœ›å€¼æ˜¯å¤šå°‘ï¼Ÿâ€
- en: And by re-using the coding patterns developed above to extend a `DataFrame`
    for probabilities, expected values can be implemented as a method extension in
    just 3 lines of code ...
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡é‡ç”¨ä¸Šé¢å¼€å‘çš„ç¼–ç æ¨¡å¼æ¥æ‰©å±• `DataFrame` ä»¥è®¡ç®—æ¦‚ç‡ï¼ŒæœŸæœ›å€¼å¯ä»¥åœ¨ä»… 3 è¡Œä»£ç ä¸­å®ç°ä¸ºæ–¹æ³•æ‰©å±•â€¦
- en: The Complete Source Code for Expected Values
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æœŸæœ›å€¼çš„å®Œæ•´æºä»£ç 
- en: Here is a synthetic dataset that contains continuous data followed by some examples
    of calculating expected values using the code above â€¦
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œæ˜¯ä¸€ä¸ªåˆæˆæ•°æ®é›†ï¼ŒåŒ…å«è¿ç»­æ•°æ®ï¼Œå¹¶é™„å¸¦ä¸€äº›ä½¿ç”¨ä¸Šé¢ä»£ç è®¡ç®—æœŸæœ›å€¼çš„ç¤ºä¾‹â€¦
- en: '![](../Images/20a2e5e4f1057dd869a638477edd1179.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/20a2e5e4f1057dd869a638477edd1179.png)'
- en: Image by Author
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡ç”±ä½œè€…æä¾›
- en: â€¦ and here is some testing to show the expected values extension in action â€¦
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: â€¦ è¿™é‡Œæ˜¯ä¸€äº›æµ‹è¯•ï¼Œå±•ç¤ºäº†æœŸæœ›å€¼æ‰©å±•çš„å®é™…æ•ˆæœ â€¦
- en: '`4.412406593060421`'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '`4.412406593060421`'
- en: '`4.429821998698432`'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '`4.429821998698432`'
- en: '`3.7051574107849214`'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '`3.7051574107849214`'
- en: Conclusion
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: Extending library classes by adding new methods or properties can result in
    source code that is easy to understand, clean, concise and maintainable.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡æ·»åŠ æ–°æ–¹æ³•æˆ–å±æ€§æ¥æ‰©å±•åº“ç±»ï¼Œå¯ä»¥ç”Ÿæˆæ˜“äºç†è§£ã€ç®€æ´ã€æ¸…æ™°ä¸”å¯ç»´æŠ¤çš„æºä»£ç ã€‚
- en: The Python convention for â€œmonkey patchingâ€ can easily be used to implement
    extensions, even where the classes exist in a standard, external library like
    pandas.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: Python çš„â€œçŒ´å­è¡¥ä¸â€çº¦å®šå¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨äºå®ç°æ‰©å±•ï¼Œå³ä½¿è¿™äº›ç±»å­˜åœ¨äºåƒ pandas è¿™æ ·çš„æ ‡å‡†å¤–éƒ¨åº“ä¸­ã€‚
- en: By creating a separate module for extension classes that can be imported into
    future projects, Python developers can build up a library of extensions to help
    improve the efficiency and effectiveness of future projects.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡ä¸ºæ‰©å±•ç±»åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ï¼Œå¹¶å°†å…¶å¯¼å…¥åˆ°æœªæ¥çš„é¡¹ç›®ä¸­ï¼ŒPython å¼€å‘è€…å¯ä»¥å»ºç«‹ä¸€ä¸ªæ‰©å±•åº“ï¼Œä»¥å¸®åŠ©æé«˜æœªæ¥é¡¹ç›®çš„æ•ˆç‡å’Œæœ‰æ•ˆæ€§ã€‚
- en: Connect and Get in Touch â€¦
  id: totrans-86
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è¿æ¥å¹¶ä¿æŒè”ç³» â€¦
- en: If you enjoyed this article, you can get unlimited access to thousands more
    by becoming a Medium member for just $5 a month by [clicking on my referral link](https://grahamharrison-86487.medium.com/membership)
    (I will receive a proportion of the fees if you sign up using this link at no
    extra cost to you).
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥é€šè¿‡æ¯æœˆä»…éœ€$5æˆä¸º Medium ä¼šå‘˜ï¼Œè·å¾—å¯¹æ›´å¤šæ–‡ç« çš„æ— é™è®¿é—®æƒé™ï¼Œæ–¹æ³•æ˜¯ [ç‚¹å‡»æˆ‘çš„æ¨èé“¾æ¥](https://grahamharrison-86487.medium.com/membership)ï¼ˆå¦‚æœä½ é€šè¿‡è¿™ä¸ªé“¾æ¥æ³¨å†Œï¼Œæˆ‘å°†ä»è´¹ç”¨ä¸­è·å¾—ä¸€éƒ¨åˆ†ï¼Œä½†ä½ æ— éœ€é¢å¤–ä»˜è´¹ï¼‰ã€‚
- en: '[](https://grahamharrison-86487.medium.com/membership?source=post_page-----f4ae983ad715--------------------------------)
    [## Join Medium with my referral link - Graham Harrison'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://grahamharrison-86487.medium.com/membership?source=post_page-----f4ae983ad715--------------------------------)
    [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Medium - æ ¼é›·å„å§†Â·å“ˆé‡Œæ£®'
- en: As a Medium member, a portion of your membership fee goes to writers you read,
    and you get full access to every storyâ€¦
  id: totrans-89
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä½œä¸º Medium ä¼šå‘˜ï¼Œä½ çš„ä¼šå‘˜è´¹ç”¨çš„ä¸€éƒ¨åˆ†ä¼šåˆ†é…ç»™ä½ é˜…è¯»çš„ä½œè€…ï¼ŒåŒæ—¶ä½ å¯ä»¥å®Œå…¨è®¿é—®æ¯ä¸ªæ•…äº‹â€¦
- en: grahamharrison-86487.medium.com](https://grahamharrison-86487.medium.com/membership?source=post_page-----f4ae983ad715--------------------------------)
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: grahamharrison-86487.medium.com](https://grahamharrison-86487.medium.com/membership?source=post_page-----f4ae983ad715--------------------------------)
- en: â€¦ or connect by â€¦
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: â€¦ æˆ–é€šè¿‡ â€¦ è¿›è¡Œè¿æ¥
- en: '[Subscribing to a free e-mail whenever I publish a new story](https://grahamharrison-86487.medium.com/subscribe).'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '[è®¢é˜…å…è´¹ç”µå­é‚®ä»¶ï¼Œä»¥ä¾¿æ¯å½“æˆ‘å‘å¸ƒæ–°æ•…äº‹æ—¶è·å¾—é€šçŸ¥](https://grahamharrison-86487.medium.com/subscribe)ã€‚'
- en: '[Taking a quick look at my previous articles](https://grahamharrison-86487.medium.com/).'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '[å¿«é€ŸæŸ¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ](https://grahamharrison-86487.medium.com/)ã€‚'
- en: '[Downloading my free strategic data-driven decision making framework](https://relentless-originator-3199.ck.page/5f4857fd12).'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '[ä¸‹è½½æˆ‘çš„å…è´¹æˆ˜ç•¥æ•°æ®é©±åŠ¨å†³ç­–æ¡†æ¶](https://relentless-originator-3199.ck.page/5f4857fd12)ã€‚'
- en: Visiting my data science website â€” [The Data Blog](https://www.the-data-blog.co.uk/).
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: è®¿é—®æˆ‘çš„æ•°æ®ç§‘å­¦ç½‘ç«™ â€” [æ•°æ®åšå®¢](https://www.the-data-blog.co.uk/)ã€‚
