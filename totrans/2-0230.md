# 理解 R 中 apply() 函数的简单指南

> 原文：[https://towardsdatascience.com/a-simple-guide-to-understand-the-apply-functions-in-r-69277fc7e522](https://towardsdatascience.com/a-simple-guide-to-understand-the-apply-functions-in-r-69277fc7e522)

## 一劳永逸地学会如何使用这些有用的函数

[](https://gustavorsantos.medium.com/?source=post_page-----69277fc7e522--------------------------------)[![Gustavo Santos](../Images/a19a9f4525cdeb6e7a76cd05246aa622.png)](https://gustavorsantos.medium.com/?source=post_page-----69277fc7e522--------------------------------)[](https://towardsdatascience.com/?source=post_page-----69277fc7e522--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----69277fc7e522--------------------------------) [Gustavo Santos](https://gustavorsantos.medium.com/?source=post_page-----69277fc7e522--------------------------------)

·发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----69277fc7e522--------------------------------) ·阅读时长 8 分钟·2023年10月6日

--

![](../Images/d38e794bd5b719ca31a8e398cfe549a7.png)

照片由 [Kelly Sikkema](https://unsplash.com/@kellysikkema?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 提供，来源于 [Unsplash](https://unsplash.com/photos/0iKjge_aOVo?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

# 介绍

我在开始这篇文章时要说的是，我每天都使用**R**和**Python**语言。老实说，我觉得 Python 中 `apply` 函数的使用方式更简单、更直观。

反思原因，我认为是因为 Python 中的选项不多。R 语言提供了许多不同的选项，即我喜欢称之为的*apply 函数家族*。

我记得曾经有人说他们总是直接使用循环来解决问题，因为他们总是记不住每个 apply 函数的作用，也不知道哪个函数最适合使用。

我希望这些问题在这篇文章后能得到解决。我的目的是希望读者在阅读本文后，对这些函数家族有一个清晰的理解，以及如何和何时使用它们。

要进行这些练习，我们快速创建一个示例数据框，没有过多的标准。包括一个 ID、产品名称、销售数量和两个不同时间段的金额。

[PRE0]

不再多说，让我们深入探讨。

# 函数

R 中的*apply 家族*有 4 个主要函数：`apply()`、`lapply()`、`sapply()` 和 `tapply()`。

## apply( )

`apply()` 函数被称为*家族*。它可能是最直接的函数。这个函数*应用*相同的操作到行或列的所有元素。这里是语法。

`apply(X, MARGIN, FUN)`

> 对矩阵 X 应用指定的函数，按行（1）或列（2）。

最简单的例子是**均值**的应用。我们有一个包含一堆产品销售的数据集。但销售的平均数量和平均销售金额是多少？

要快速查看这一点，我们可以使用`apply`并选择函数`mean`来应用于数据集中每个数值列。

因此，我们的`X`是一个矩阵，包含数据集中的数值列3（`qty`）和4（`amt`）——因为我们不能对*产品A*和*产品B*取平均。`MARGIN`可以是`1`以应用于行，或`2`以应用于列。`FUN`是要应用于每个元素的函数。代码如下。

[PRE1]

## 常见错误

+   当使用`apply()`时，我们必须使用`X`的切片表示法，因为如果我们尝试使用整个数据集`dtf`（考虑到有字符串列），R会抛出错误。我们不能对字符串求平均。

[PRE2]

+   即使我们尝试使用整个列，例如`dtf$qty`来获取数量的均值（这是数值型的），也不会很好，因为只有一个变量，所以更简单的方法是直接使用`mean(dtf$qty)`，对吗？

+   当运行`apply()`时，R会在运行函数之前首先读取对象`X`的维度。如果你尝试`dim(dtf$qty)`，你会看到输出是`NULL`。这就是你下面收到错误的原因。维度需要大于1。

[PRE3]

很好，简单明了。

## 按行应用函数

现在让我们再看看数据。如果我们想按行计算均值，以了解amount1和amount2之间的平均值，我们可以使用相同的代码，只需将`MARGIN=1`更改为`1`，然后函数将计算行的简单平均值：[amt + amt2] / 2。

[PRE4]

不过，我们可以将其添加到数据集中。

[PRE5]

如果我们想添加一列来计算`amt/qty`，我们可以通过按行（`MARGIN=1`）使用`apply`中的自定义函数来计算。自定义函数接收一个矩阵**mtrx**，并将**mtrx**第二列的值除以第一列的值。

[PRE6]

## lapply( )

在R语言中，**列表**的概念与Python中的不同。在R中，它是一个对象的集合，不一定是相同类型的。当我们需要对列表中的每个元素应用函数时，这就是`lapply()`的用途。

重要的是要注意`lapply` **返回一个与X具有相同长度的列表对象**。

`lapply(X, FUN)`

我能想到的最简单的例子是，如果你有一个列表，想要检查列表中每个对象的类型。让我们看一下这个简单例子的代码。

[PRE7]

正如预期的那样，长度相同（4个对象），并且函数`class`已应用于列表中的每个元素。基本上，如果你处理的是列表对象或需要返回列表，那么你应该使用这种方法。

> 如果你处理的是列表对象或需要返回列表，你应该使用这种方法。

## sapply( )

根据文档，`sapply()`是`lapply()`的用户友好版本，**返回相同长度的向量或矩阵**，而不是返回一个列表。如果参数`simplify=TRUE`（默认开启），它将返回一个数组（简化对象）。

> sapply()是lapply()的用户友好版本，返回一个更简单的对象，如数组。

`sapply(X, FUN, simplify = TRUE)`

[PRE8]

回到我们创建的数据集`dtf`，列`product`包含了以‘*product*’开头的名称。如果我们想去除这些，`sapply`可以是一个很好的助手。在使用循环之前，甚至在加载Tidyverse之前，记住Base R中的apply函数可以提供帮助。

注意，我们在这里使用了一个自定义函数，将字符串分成两部分，一旦找到空格字符，就取该列表的第二个元素。

[PRE9]

## tapply( )

最后，`tapply()`是一个在处理因子（或组）时使用的函数。

`tapply(X, INDEX, FUN, simplify = TRUE)`

> 使用tapply对每组值应用一个函数。

这个函数的明显例子是如果我们想在没有*分组*函数的情况下检查`amt`的均值，`tapply`会很有用。

+   `X`是矩阵或向量。

+   `INDEX`是包含组的列。

+   `FUN`是要应用的函数。

[PRE10]

这就是关于R中apply家族函数的最常用部分了。

# 在你离开之前

好吧，apply函数是很好的映射函数。在你作为数据科学家的日常工作中，会有很多情况需要映射函数，这比循环要好，无论是为了性能还是为了更好的代码可读性。

通过这个简要介绍，我相信你现在可以*将* apply函数家族应用到你的数据中。

+   `apply`：用于对数据集中的每一行或列的每个元素应用相同的函数。

+   `lapply`：用于对列表中的每个元素应用一个函数。返回一个长度相同的列表作为结果。

+   `sapply`：lapply的友好版本，返回一个数组作为结果。

+   `tapply`：用于对每一组值应用一个函数。几乎类似于分组操作。

GitHub上的代码：

[](https://github.com/gurezende/Studying/tree/master/R/apply?source=post_page-----69277fc7e522--------------------------------) [## Studying/R/apply at master · gurezende/Studying

### 这是一个包含我对新包测试和学习的代码库 - Studying/R/apply at master · gurezende/Studying

github.com](https://github.com/gurezende/Studying/tree/master/R/apply?source=post_page-----69277fc7e522--------------------------------)

# 参考

[](https://www.guru99.com/r-apply-sapply-tapply.html?source=post_page-----69277fc7e522--------------------------------#5) [## apply(), lapply(), sapply(), tapply() Function in R with Examples

### 本教程旨在介绍apply()函数系列。apply()函数是所有函数中最基本的一个…

www.guru99.com](https://www.guru99.com/r-apply-sapply-tapply.html?source=post_page-----69277fc7e522--------------------------------#5)

[https://www.datacamp.com/tutorial/r-tutorial-apply-family](https://www.datacamp.com/tutorial/r-tutorial-apply-family)

[SANTOS, Gustavo R. 2023\. *使用 R 进行数据整理.* 第1版. Packt Publishing.](https://a.co/d/1gij8AW)
