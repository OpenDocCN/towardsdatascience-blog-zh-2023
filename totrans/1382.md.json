["```py\nSELECT\n s.state,\n s.store_name,\n s.total_sales,\n s.total_sales / t.state_total_sales AS sales_contribution\nFROM\n (\n SELECT\n  state,\n  store_name,\n  SUM(sales) AS total_sales\n FROM\n  store_sales\n GROUP BY\n  state,\n  store_name\n) s\nINNER JOIN (\n SELECT\n  state,\n  SUM(sales) AS state_total_sales\n FROM\n  store_sales\n GROUP BY\n  state\n) t ON\n s.state = t.state\nORDER BY\n s.state,\n sales_contribution DESC;\n```", "```py\n|state|store_name|total_sales|sales_contribution|\n|-----|----------|-----------|------------------|\n|California|MegaMart|82500.00|0.61797752808988764045|\n|California|ABC Mart|51000.00|0.38202247191011235955|\n|New York|SuperMart|57000.00|0.60638297872340425532|\n|New York|Corner Shop|37000.00|0.39361702127659574468|\n|Texas|XYZ Store|35000.00|0.67961165048543689320|\n|Texas|My Store|16500.00|0.32038834951456310680|\n```", "```py\nSELECT\n state,\n store_name,\n SUM(sales) AS total_sales,\n SUM(sales) / SUM(SUM(sales)) OVER (PARTITION BY state) AS sales_contribution\nFROM\n store_sales\nGROUP BY\n state,\n store_name\nORDER BY\n state,\n sales_contribution DESC;\n```", "```py\nCREATE TABLE store_sales (\n  store_id INT,\n  store_name VARCHAR(50),\n  state VARCHAR(50),\n  month DATE,\n  sales DECIMAL(10, 2)\n);\n\nINSERT INTO store_sales VALUES\n(1, 'ABC Mart', 'California', '2022-01-01', 10000.00),\n(2, 'XYZ Store', 'Texas', '2022-01-01', 7500.00),\n(3, 'Corner Shop', 'New York', '2022-01-01', 12000.00),\n(4, 'MegaMart', 'California', '2022-01-01', 25000.00),\n(5, 'My Store', 'Texas', '2022-01-01', 5000.00),\n(6, 'SuperMart', 'New York', '2022-01-01', 18000.00),\n(7, 'ABC Mart', 'California', '2022-02-01', 15000.00),\n(8, 'XYZ Store', 'Texas', '2022-02-01', 9000.00),\n(9, 'Corner Shop', 'New York', '2022-02-01', 10000.00),\n(10, 'MegaMart', 'California', '2022-02-01', 30000.00),\n(11, 'My Store', 'Texas', '2022-02-01', 6000.00),\n(12, 'SuperMart', 'New York', '2022-02-01', 20000.00),\n(13, 'ABC Mart', 'California', '2022-03-01', 12000.00),\n(14, 'XYZ Store', 'Texas', '2022-03-01', 10500.00),\n(15, 'Corner Shop', 'New York', '2022-03-01', 15000.00),\n(16, 'MegaMart', 'California', '2022-03-01', 27500.00),\n(17, 'My Store', 'Texas', '2022-03-01', 5500.00),\n(18, 'SuperMart', 'New York', '2022-03-01', 19000.00),\n(19, 'ABC Mart', 'California', '2022-04-01', 14000.00),\n(20, 'XYZ Store', 'Texas', '2022-04-01', 8000.00);\n```", "```py\nSELECT \n    store_name,\n    state,\n    SUM(sales) AS total_sales,\n    AVG(SUM(sales)) OVER (PARTITION BY state) AS state_average\nFROM \n    store_sales\nGROUP BY \n    store_name, state;\n```", "```py\n|store_name|state|total_sales|state_average|\n|----------|-----|-----------|-------------|\n|ABC Mart|California|51000.00|66750.000000000000|\n|MegaMart|California|82500.00|66750.000000000000|\n|Corner Shop|New York|37000.00|47000.000000000000|\n|SuperMart|New York|57000.00|47000.000000000000|\n|XYZ Store|Texas|35000.00|25750.000000000000|\n|My Store|Texas|16500.00|25750.000000000000|\n```", "```py\nSELECT\n store_name,\n state,\n sales,\n DENSE_RANK() OVER (PARTITION BY state\nORDER BY\n sales DESC) AS store_sales_rank\nFROM\n store_sales;\n```", "```py\n|store_name|state|sales|store_sales_rank|\n|----------|-----|-----|----------------|\n|MegaMart|California|30000.00|1|\n|MegaMart|California|27500.00|2|\n|MegaMart|California|25000.00|3|\n|ABC Mart|California|15000.00|4|\n|ABC Mart|California|14000.00|5|\n|ABC Mart|California|12000.00|6|\n|ABC Mart|California|10000.00|7|\n|SuperMart|New York|20000.00|1|\n|SuperMart|New York|19000.00|2|\n|SuperMart|New York|18000.00|3|\n|Corner Shop|New York|15000.00|4|\n|Corner Shop|New York|12000.00|5|\n|Corner Shop|New York|10000.00|6|\n|XYZ Store|Texas|10500.00|1|\n|XYZ Store|Texas|9000.00|2|\n|XYZ Store|Texas|8000.00|3|\n|XYZ Store|Texas|7500.00|4|\n|My Store|Texas|6000.00|5|\n|My Store|Texas|5500.00|6|\n|My Store|Texas|5000.00|7|\n```", "```py\nSELECT\n store_name,\n MONTH,\n sales,\n SUM(sales) OVER (PARTITION BY store_name\nORDER BY\n \"month\") AS running_total\nFROM\n store_sales;\n```", "```py\n|store_name|month|sales|running_total|\n|----------|-----|-----|-------------|\n|ABC Mart|2022-01-01|10000.00|10000.00|\n|ABC Mart|2022-02-01|15000.00|25000.00|\n|ABC Mart|2022-03-01|12000.00|37000.00|\n|ABC Mart|2022-04-01|14000.00|51000.00|\n|Corner Shop|2022-01-01|12000.00|12000.00|\n|Corner Shop|2022-02-01|10000.00|22000.00|\n|Corner Shop|2022-03-01|15000.00|37000.00|\n|MegaMart|2022-01-01|25000.00|25000.00|\n|MegaMart|2022-02-01|30000.00|55000.00|\n|MegaMart|2022-03-01|27500.00|82500.00|\n|My Store|2022-01-01|5000.00|5000.00|\n|My Store|2022-02-01|6000.00|11000.00|\n|My Store|2022-03-01|5500.00|16500.00|\n|SuperMart|2022-01-01|18000.00|18000.00|\n|SuperMart|2022-02-01|20000.00|38000.00|\n|SuperMart|2022-03-01|19000.00|57000.00|\n|XYZ Store|2022-01-01|7500.00|7500.00|\n|XYZ Store|2022-02-01|9000.00|16500.00|\n|XYZ Store|2022-03-01|10500.00|27000.00|\n|XYZ Store|2022-04-01|8000.00|35000.00|\n```", "```py\nSELECT\n store_name,\n state ,\n MONTH,\n sales,\n AVG(sales) OVER (PARTITION BY state, \"month\") AS running_total\nFROM\n store_sales;\n```", "```py\n|store_name|state|month|sales|running_total|\n|----------|-----|-----|-----|-------------|\n|MegaMart|California|2022-01-01|25000.00|17500.000000000000|\n|ABC Mart|California|2022-01-01|10000.00|17500.000000000000|\n|ABC Mart|California|2022-02-01|15000.00|22500.000000000000|\n|MegaMart|California|2022-02-01|30000.00|22500.000000000000|\n|ABC Mart|California|2022-03-01|12000.00|19750.000000000000|\n|MegaMart|California|2022-03-01|27500.00|19750.000000000000|\n|ABC Mart|California|2022-04-01|14000.00|14000.0000000000000000|\n|SuperMart|New York|2022-01-01|18000.00|15000.000000000000|\n|Corner Shop|New York|2022-01-01|12000.00|15000.000000000000|\n|Corner Shop|New York|2022-02-01|10000.00|15000.000000000000|\n|SuperMart|New York|2022-02-01|20000.00|15000.000000000000|\n|Corner Shop|New York|2022-03-01|15000.00|17000.000000000000|\n|SuperMart|New York|2022-03-01|19000.00|17000.000000000000|\n|XYZ Store|Texas|2022-01-01|7500.00|6250.0000000000000000|\n|My Store|Texas|2022-01-01|5000.00|6250.0000000000000000|\n|My Store|Texas|2022-02-01|6000.00|7500.0000000000000000|\n|XYZ Store|Texas|2022-02-01|9000.00|7500.0000000000000000|\n|My Store|Texas|2022-03-01|5500.00|8000.0000000000000000|\n|XYZ Store|Texas|2022-03-01|10500.00|8000.0000000000000000|\n|XYZ Store|Texas|2022-04-01|8000.00|8000.0000000000000000|\n```", "```py\nSELECT\n store_name ,\n MONTH,\n sales,\n AVG(sales) OVER (PARTITION BY store_name\nORDER BY\n MONTH ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS moving_avg_sales\nFROM\n store_sales;\n```", "```py\n|store_name|month|sales|moving_avg_sales|\n|----------|-----|-----|----------------|\n|ABC Mart|2022-01-01|10000.00|10000.0000000000000000|\n|ABC Mart|2022-02-01|15000.00|12500.0000000000000000|\n|ABC Mart|2022-03-01|12000.00|12333.3333333333333333|\n|ABC Mart|2022-04-01|14000.00|13666.666666666667|\n|Corner Shop|2022-01-01|12000.00|12000.0000000000000000|\n|Corner Shop|2022-02-01|10000.00|11000.0000000000000000|\n|Corner Shop|2022-03-01|15000.00|12333.3333333333333333|\n|MegaMart|2022-01-01|25000.00|25000.000000000000|\n|MegaMart|2022-02-01|30000.00|27500.000000000000|\n|MegaMart|2022-03-01|27500.00|27500.000000000000|\n|My Store|2022-01-01|5000.00|5000.0000000000000000|\n|My Store|2022-02-01|6000.00|5500.0000000000000000|\n|My Store|2022-03-01|5500.00|5500.0000000000000000|\n|SuperMart|2022-01-01|18000.00|18000.0000000000000000|\n|SuperMart|2022-02-01|20000.00|19000.000000000000|\n|SuperMart|2022-03-01|19000.00|19000.000000000000|\n|XYZ Store|2022-01-01|7500.00|7500.0000000000000000|\n|XYZ Store|2022-02-01|9000.00|8250.0000000000000000|\n|XYZ Store|2022-03-01|10500.00|9000.0000000000000000|\n|XYZ Store|2022-04-01|8000.00|9166.6666666666666667|\n```", "```py\nSELECT\n store_name ,\n MONTH,\n sales,\n AVG(sales) OVER (PARTITION BY store_name \nORDER BY\n MONTH ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS moving_avg_sales\nFROM\n store_sales;\n```", "```py\n|store_name|month|sales|moving_avg_sales|\n|----------|-----|-----|----------------|\n|ABC Mart|2022-01-01|10000.00|12333.3333333333333333|\n|ABC Mart|2022-02-01|15000.00|13666.666666666667|\n|ABC Mart|2022-03-01|12000.00|13000.0000000000000000|\n|ABC Mart|2022-04-01|14000.00|14000.0000000000000000|\n|Corner Shop|2022-01-01|12000.00|12333.3333333333333333|\n|Corner Shop|2022-02-01|10000.00|12500.0000000000000000|\n|Corner Shop|2022-03-01|15000.00|15000.0000000000000000|\n|MegaMart|2022-01-01|25000.00|27500.000000000000|\n|MegaMart|2022-02-01|30000.00|28750.000000000000|\n|MegaMart|2022-03-01|27500.00|27500.000000000000|\n|My Store|2022-01-01|5000.00|5500.0000000000000000|\n|My Store|2022-02-01|6000.00|5750.0000000000000000|\n|My Store|2022-03-01|5500.00|5500.0000000000000000|\n|SuperMart|2022-01-01|18000.00|19000.000000000000|\n|SuperMart|2022-02-01|20000.00|19500.000000000000|\n|SuperMart|2022-03-01|19000.00|19000.0000000000000000|\n|XYZ Store|2022-01-01|7500.00|9000.0000000000000000|\n|XYZ Store|2022-02-01|9000.00|9166.6666666666666667|\n|XYZ Store|2022-03-01|10500.00|9250.0000000000000000|\n|XYZ Store|2022-04-01|8000.00|8000.0000000000000000|\n```"]