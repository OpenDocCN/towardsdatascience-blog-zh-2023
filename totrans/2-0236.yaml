- en: A step-by-step guide to develop a map-based application (Part I)
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 开发基于地图的应用程序的逐步指南（第一部分）
- en: 原文：[https://towardsdatascience.com/a-step-by-step-guide-to-develop-a-map-based-application-part-i-757766b04f77](https://towardsdatascience.com/a-step-by-step-guide-to-develop-a-map-based-application-part-i-757766b04f77)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/a-step-by-step-guide-to-develop-a-map-based-application-part-i-757766b04f77](https://towardsdatascience.com/a-step-by-step-guide-to-develop-a-map-based-application-part-i-757766b04f77)
- en: The proof-of-concept — Build a minimalist demo
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 概念验证 — 构建一个极简的演示
- en: '[](https://medium.com/@jacky.kaub?source=post_page-----757766b04f77--------------------------------)[![Jacky
    Kaub](../Images/e66c699ee5a9d5bbd58a1a72d688234a.png)](https://medium.com/@jacky.kaub?source=post_page-----757766b04f77--------------------------------)[](https://towardsdatascience.com/?source=post_page-----757766b04f77--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----757766b04f77--------------------------------)
    [Jacky Kaub](https://medium.com/@jacky.kaub?source=post_page-----757766b04f77--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@jacky.kaub?source=post_page-----757766b04f77--------------------------------)[![Jacky
    Kaub](../Images/e66c699ee5a9d5bbd58a1a72d688234a.png)](https://medium.com/@jacky.kaub?source=post_page-----757766b04f77--------------------------------)[](https://towardsdatascience.com/?source=post_page-----757766b04f77--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page-----757766b04f77--------------------------------)
    [Jacky Kaub](https://medium.com/@jacky.kaub?source=post_page-----757766b04f77--------------------------------)'
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page-----757766b04f77--------------------------------)
    ·19 min read·Jan 24, 2023
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: ·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page-----757766b04f77--------------------------------)
    ·19分钟阅读·2023年1月24日
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/c4b4a0fc6043af44431cec2c84ae5ec0.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c4b4a0fc6043af44431cec2c84ae5ec0.png)'
- en: Photo by [GeoJango Maps](https://unsplash.com/@geojango_maps?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 图片来源于 [GeoJango Maps](https://unsplash.com/@geojango_maps?utm_source=medium&utm_medium=referral)
    在 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
- en: Maps are a powerful tool for visualizing and understanding geographic data but
    they need specific skills to be designed efficiently.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 地图是可视化和理解地理数据的强大工具，但需要特定的技能来有效设计。
- en: In this step-by-step guide, we are going to take a deep dive into building a
    map-based application to show the customers prices of gas stations around them.
    We will cover the different key steps of a product, from original proof of concept
    (POC) to the minimum viable product (MVP)
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在本步骤指南中，我们将深入探讨如何构建一个基于地图的应用程序，展示客户周围加油站的价格。我们将涵盖从原始概念验证（POC）到最小可行产品（MVP）的不同关键步骤。
- en: 'Articles of the series:'
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 系列文章：
- en: 'Part I: The proof-of-concept — Build a minimalist demo'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 第一部分：概念验证 — 构建一个极简的演示
- en: '[Part II: How to use React to build web apps (Static Layout)](/a-step-by-step-guide-to-develop-a-map-based-application-part-ii-6d3fa7dbd8b9)'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '[第二部分：如何使用 React 构建网页应用（静态布局）](/a-step-by-step-guide-to-develop-a-map-based-application-part-ii-6d3fa7dbd8b9)'
- en: '[Part III: Add Interactivity to your webapps with React](/a-step-by-step-guide-to-develop-a-map-based-application-part-iii-ad501c4aa35b)'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '[第三部分：使用 React 为你的网页应用添加互动性](/a-step-by-step-guide-to-develop-a-map-based-application-part-iii-ad501c4aa35b)'
- en: '[Part IV: Build a back-end with PostgreSQL, FastAPI, and Docker](https://medium.com/towards-data-science/build-a-back-end-with-postgresql-fastapi-and-docker-7ebfe59e4f06)'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '[第四部分：使用 PostgreSQL、FastAPI 和 Docker 构建后端](https://medium.com/towards-data-science/build-a-back-end-with-postgresql-fastapi-and-docker-7ebfe59e4f06)'
- en: What this article covers
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 本文涵盖内容
- en: In this article, the first of the series, we are preparing the proof of concept
    of our application.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在本系列的第一篇文章中，我们正在准备我们的应用程序的概念验证。
- en: We just got an idea that we would like to turn into something valuable but we
    don’t know yet if this is feasible. We need to look for data, evaluate their relevance
    and build something basic that will demonstrate if the original idea is feasible.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 我们刚刚有了一个想法，希望将其转化为有价值的东西，但我们还不知道这是否可行。我们需要寻找数据，评估其相关性，并构建一些基本内容，以展示原始想法是否可行。
- en: Also, and more than everything, we need to demonstrate to deciders (that are
    not necessarily technical people) that the project can be valuable.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，更重要的是，我们需要向决策者（可能不是技术人员）展示项目的价值。
- en: '![](../Images/3f462e024b926f4473e0fa64d13a86ec.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/3f462e024b926f4473e0fa64d13a86ec.png)'
- en: From POC to MVP, Author Illustration
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 从概念验证到最小可行产品，作者插图
- en: 'In particular, due to the specificity of that particular project, we will see
    in this article the following topics:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 特别地，由于该项目的特殊性，我们将在本文中讨论以下主题：
- en: How to parse a .xml file into tabular data
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何将 .xml 文件解析为表格数据
- en: Filter and combine DataFrames based on distances between points
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据点之间的距离筛选和组合 DataFrames
- en: Build a basic map with plotly
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Plotly 构建基础地图
- en: Add interactions to the map with ipywidgets
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 ipywidgets 为地图添加交互功能
- en: By the end of the article, we will have an interactive map that could be presented
    for POC demos before deciding to go further on product development.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在文章结束时，我们将拥有一个互动地图，可以在决定进一步产品开发之前用于POC演示。
- en: '![](../Images/2bb40a987b30833a48970e5b9573fde1.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2bb40a987b30833a48970e5b9573fde1.png)'
- en: Illustration of the product at the end of the POC phase, Author Illustration
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: POC 阶段结束时的产品示例，作者插图
- en: The complete code of this whole POC is available in [my github](https://github.com/jkaub/fuel-station-viewer-poc).
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 本次POC的完整代码可以在[我的GitHub](https://github.com/jkaub/fuel-station-viewer-poc)上找到。
- en: A bit of context around the app
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 关于应用的一些背景
- en: In the current economic situation, we observe high volatility of gas prices
    in the stations. We also see — at least where I come from in France — shortages
    driven by strikes and some malicious station owners taking the opportunity of
    this to increase their prices to overly high levels. With this in mind, prices
    at the stations can become an important criterion for many people who need to
    refill.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在当前经济形势下，我们观察到加油站的油价波动剧烈。我们还看到——至少在我来自法国的地方——因罢工和一些恶意的加油站老板趁机抬高价格而导致的短缺。考虑到这一点，加油站的价格对许多需要加油的人来说可能成为一个重要的标准。
- en: 'The good news is: in France, real-time gas station prices are accessible through
    the open data policy implemented in the country. The data, in its raw format,
    is not of interest to many as not understandable instantaneously. Instead, it
    would need to be made available and displayed via a proper user interface so the
    right information is filtered and understandable in an eye blink.'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 好消息是：在法国，通过实施的开放数据政策，可以实时访问加油站价格。原始格式的数据对许多人来说没有直接的价值，因为难以立即理解。相反，需要通过适当的用户界面将其展示，以便信息能够迅速过滤和理解。
- en: 'We are going to build this user interface: a web app allowing users to retrieve
    oil prices for stations around them. I am focusing here on the french market (because
    the data is open publicly and easy to access), but our work will be easily reproducible
    for other types of data anywhere in the world.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将构建这个用户界面：一个网页应用程序，允许用户检索周围加油站的油价。我这里专注于法国市场（因为数据公开且易于访问），但我们的工作可以轻松适用于全球其他地方的数据。
- en: A quick word about the datasets used
  id: totrans-34
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 关于使用的数据集的简要说明
- en: In its politic of open data, France maintains many datasets in free access.
    In particular, we are going to use the [Fuel prices in France — Instant flow Dataset](https://www.data.gouv.fr/fr/datasets/prix-des-carburants-en-france-flux-instantane/)
    under [*Open Licence V2*](https://www.etalab.gouv.fr/wp-content/uploads/2018/11/open-licence.pdf)
    and can be reused for commercial purposes.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在其开放数据政策中，法国维护了许多免费访问的数据集。特别地，我们将使用[法国燃油价格——即时流数据集](https://www.data.gouv.fr/fr/datasets/prix-des-carburants-en-france-flux-instantane/)，其使用遵循[*开放许可证
    V2*](https://www.etalab.gouv.fr/wp-content/uploads/2018/11/open-licence.pdf)，并可以用于商业目的。
- en: We are also going to use the [Communal Administrative division API](https://geo.api.gouv.fr/decoupage-administratif/communes)
    for information relative to cities, also under [*Open Licence V2*](https://www.etalab.gouv.fr/wp-content/uploads/2018/11/open-licence.pdf)*.*
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还将使用[市镇行政区划 API](https://geo.api.gouv.fr/decoupage-administratif/communes)来获取与城市相关的信息，该
    API 也遵循[*开放许可证 V2*](https://www.etalab.gouv.fr/wp-content/uploads/2018/11/open-licence.pdf)*。*
- en: Access the data
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 访问数据
- en: 'Our adventure starts here: navigating in the jungle of open data, we found
    this interesting dataset about gas prices. We don’t know yet what it looks like
    and what data it contains.'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的冒险从这里开始：在开放数据的丛林中，我们发现了这个有趣的燃油价格数据集。我们还不知道它的具体内容和包含的数据。
- en: 'Multiple files are available for download as illustrated below:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 如下所示，有多个文件可以下载：
- en: '![](../Images/e4cff22b555f376ee41d94203d0ab25b.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/e4cff22b555f376ee41d94203d0ab25b.png)'
- en: A translated version of the page containing the datasets, Author Illustration
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 包含数据集的页面的翻译版本，作者插图
- en: 'The first mistake to avoid here is to overflow our project with too much data:
    it is not because it is available that we need it.'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这里需要避免的第一个错误是让我们的项目充满过多的数据：并不是因为数据是可用的，我们就需要它。
- en: Here, typically, we only want to demonstrate the possibility of showing the
    “instant” prices to users, we don’t aim at making a historical prices analysis.
    Thus, exploring historical data will be, at least for now, a waste of time and
    we are going to focus only on the instantaneous flow datasets.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们通常只想展示“即时”价格的可能性给用户，并不打算进行历史价格分析。因此，探索历史数据至少在现在看来是浪费时间，我们将专注于即时数据集。
- en: '*Time is a precious resource, and many ideas will never turn into actual products.
    It is important to be efficient and make sure we focus only on the concept we
    want to showcase.*'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '*时间是宝贵的资源，许多想法永远不会变成实际的产品。重要的是要高效，并确保我们只关注我们想展示的概念。*'
- en: According to the documentation, the dataset contains information such as addresses,
    postal codes, coordinates, and prices, among with other information less useful
    for the POC (like other services proposed).
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 根据文档，数据集包含诸如地址、邮政编码、坐标和价格等信息，还有其他对 POC 不太有用的信息（如提供的其他服务）。
- en: Retrieving the data
  id: totrans-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据提取
- en: The instant data feed can be retrieved via a download link which will download
    a zip file containing a file locally in your computer.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过下载链接获取即时数据源，该链接会下载一个包含本地计算机文件的 zip 文件。
- en: '[https://donnees.roulez-eco.fr/opendata/instantane](https://donnees.roulez-eco.fr/opendata/instantane)'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://donnees.roulez-eco.fr/opendata/instantane](https://donnees.roulez-eco.fr/opendata/instantane)'
- en: This is nice, but even if we are in the POC phase we need to anticipate some
    of the constraints we will have later in the project that could be “killer”. In
    particular here, assuming we will update our data at least once a day, we don’t
    want the update to be done manually and we need to assess a way to access the
    data automatically.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 这很好，但即使我们处于 POC 阶段，我们也需要预见项目中可能出现的一些“致命”约束。特别是这里，假设我们每天至少更新一次数据，我们不希望手动更新，并且需要评估一种自动访问数据的方法。
- en: Hopefully, we can load the zip directly in python combining **urllib** and **zipfile**
    libraries to perform operations on .zip files directly from an URL.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 希望我们可以直接在 Python 中加载 zip，结合 **urllib** 和 **zipfile** 库直接从 URL 对 .zip 文件进行操作。
- en: '[PRE0]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Explore the .xml file
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 探索 .xml 文件
- en: XML is a markup language commonly used for data storage and data exchanges.
    Even if newer formats such as JSON tend to gain more and more popularity, XML
    remains used widely in many applications and industries and it is still relevant
    to have a sense of how it works.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: XML 是一种常用于数据存储和数据交换的标记语言。即使像 JSON 这样的新格式越来越受欢迎，XML 在许多应用和行业中仍然被广泛使用，了解它的工作原理仍然是有意义的。
- en: A .xml file forms tree structures, that start at the “root” and branch to child
    elements. Each element has its own attributes and its possible own children.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: .xml 文件形成树状结构，从“根”开始，分支到子元素。每个元素都有自己的属性和可能的子元素。
- en: Let’s have a look at the file by opening it in a simple text editor.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过在一个简单的文本编辑器中打开文件来查看它。
- en: 'The first line of the file gives some metadata, such as the encoding used:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 文件的第一行提供了一些元数据，例如使用的编码：
- en: '[PRE1]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Here it says that to read the file, we need to use an ISO-8859–1 encoding, which
    will be useful when we will have to parse the file.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 这里提到，要读取文件，我们需要使用 ISO-8859–1 编码，这在我们解析文件时会很有用。
- en: 'The .xml is then composed of different elements with multiple levels of depths:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: .xml 文件由多个具有不同深度的元素组成：
- en: '[PRE2]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Here the pdv element represents our oil station. Inside the tag, there is several
    parameters which are the attributes of the element (id, latitude, longitude, postal
    code…)
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的 pdv 元素代表我们的加油站。在标签内部，有多个参数，这些是元素的属性（id、纬度、经度、邮政编码……）
- en: '[PRE3]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Each pdv has also multiple children:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 每个 pdv 也有多个子元素：
- en: 'adresse: the address of the station'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'adresse: 车站的地址'
- en: 'ville: the city of the station'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'ville: 车站所在的城市'
- en: 'horaires: the hours of openings of the station'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'horaires: 车站的开放时间'
- en: 'services: representing extra services provided such as car wash, ATM, etc…'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'services: 代表提供的额外服务，如洗车、自动取款机等……'
- en: 'prix: the price of each fuel type (available as attributes)'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'prix: 每种燃料类型的价格（作为属性提供）'
- en: 'This data structure can be represented by the tree below:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 这个数据结构可以通过下面的树形图表示：
- en: '![](../Images/9f2f85ad3b626e4c92380817627b367c.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/9f2f85ad3b626e4c92380817627b367c.png)'
- en: Data structure of our .xml, Author illustration
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的 .xml 文件的数据结构，作者插图
- en: From .xml to tabular data
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 从.xml到表格数据
- en: This tree data structure is not fitted for easy manipulations and we want to
    parse it to a tabular version, which will be more convenient for later filtering
    and aggregation operations.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 这种树状数据结构不适合进行简单操作，我们希望将其解析为表格版本，这将更方便以后进行过滤和聚合操作。
- en: 'To store the data efficiently, we will create two tables:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 为了高效存储数据，我们将创建两个表：
- en: A table to represent oil stations and their metadata (address, city, etc…)
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于表示加油站及其元数据（地址、城市等）的表格。
- en: A table to represent fuels, their stations, and their prices
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于表示燃料、其站点及其价格的表格
- en: You can use a tool such as [https://dbdiagram.io/](https://dbdiagram.io/) to
    design your data structure.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用如[https://dbdiagram.io/](https://dbdiagram.io/)这样的工具来设计你的数据结构。
- en: '![](../Images/6dc962abf8fdbff8b32eb921545a3143.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/6dc962abf8fdbff8b32eb921545a3143.png)'
- en: Sample view of the data structure, Author illustration
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 数据结构的示例视图，作者插图。
- en: In this POC phase, we will not set up a SQL server and simply store the data
    in memory in pandas DataFrames to go fast. We could also store it locally in a
    .csv as a starting point, but the file is light, so no need to go there for now.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个POC阶段，我们不会设置SQL服务器，而是将数据存储在pandas DataFrame中以加快速度。我们也可以将其作为起点存储在.csv中，但文件很轻，所以目前没有必要这样做。
- en: When we will explore the MVP of the app, we will set up the database in a cleaner
    way.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们探索应用程序的MVP时，我们将以更清晰的方式设置数据库。
- en: Parsing the .xml file
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解析.xml文件
- en: At this point we know the data structure we want to reach, we just have to parse
    the file properly.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 到这一步我们知道我们想要的 数据结构，我们只需正确解析文件。
- en: Before going further, I want to raise your attention to the fact that you should
    be particularly careful when using automated parsers as they could potentially
    dismiss part of the data available in the file.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续之前，我想提醒你注意使用自动解析器时要特别小心，因为它们可能会忽略文件中可用的部分数据。
- en: For example, using the built-in pandas.read_xml() method, without any specific
    tuning, would return an incomplete DataFrame.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，使用内置的`pandas.read_xml()`方法，未进行任何特定调整，将返回一个不完整的DataFrame。
- en: '[PRE4]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The code above would result in the DataFrame below, where most of the information
    is missing:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的代码会产生下面的DataFrame，其中大部分信息丢失：
- en: '![](../Images/b3fab0dadf81889dfa9ed4b0436bdecb.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b3fab0dadf81889dfa9ed4b0436bdecb.png)'
- en: Parsing quickly with pd.read_xml and default parameters don’t produce the relevant
    result
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`pd.read_xml`和默认参数快速解析不会产生相关结果。
- en: Instead, we are going to code our own data extractor, which will give us the
    opportunity to review recursive functions and is based on the python **xml** library.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，我们将编写自己的数据提取器，这将为我们提供回顾递归函数的机会，并且基于python **xml**库。
- en: '*Note: Even if we are in the POC, it is important to make the effort of keeping
    a clean code structure. We are going to build a proper set of functions for the
    data loading module that could be re-used with very few adaptations later in the
    process. It doesn’t cost extra time, but it will save a lot of work for the MVP.*'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '*注意：即使我们处于POC阶段，保持代码结构清晰也是重要的。我们将为数据加载模块构建一组适当的函数，这些函数可以在后续过程中少量调整后重复使用。这不会额外消耗时间，但将为MVP节省大量工作。*'
- en: To parse properly the file we use the **xml** library. Let’s start by accessing
    our root element, *pdv_list*
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 为了正确解析文件，我们使用**xml**库。让我们从访问根元素开始，*pdv_list*。
- en: '[PRE5]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The root variable contains the element pdv_list
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 根变量包含元素`pdv_list`。
- en: '[PRE6]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'And the children elements can be simply accessed by iteration (in our case
    each child will be an element “pdv”:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 子元素可以通过迭代简单访问（在我们的例子中，每个子元素将是一个“pdv”元素）。
- en: '[PRE7]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: In order to handle the data whatever the order, we will create a station dictionary
    that will contain all the metadata that we want to keep for our “stations” table
    as well as an oil_type dictionary for our “oil_type” dataset.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 为了处理无论顺序如何的数据，我们将创建一个站点字典，包含我们想要保留的所有“站点”表的元数据，以及一个用于“油品类型”数据集的`oil_type`字典。
- en: To keep things clean, depending on the level of complexity of each node we will
    design custom functions. The code below illustrates how our custom parser work.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保持整洁，根据每个节点的复杂程度，我们将设计自定义函数。下面的代码展示了我们的自定义解析器如何工作。
- en: '[PRE8]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'This set of functions will return those two DataFrames and should be relatively
    easy to modify in the future if we want to use SQL tables:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 这一组函数将返回这两个DataFrame，并且如果我们想要使用SQL表，将来应该相对容易修改。
- en: '![](../Images/b13f95130db7436f8ea5db182bdd8429.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b13f95130db7436f8ea5db182bdd8429.png)'
- en: Sample DataFrame for the oil_type, Author Illustration
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 oil_type 的示例 DataFrame，作者插图
- en: '![](../Images/687a0cd1082bed5369df37166a8f5ccf.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/687a0cd1082bed5369df37166a8f5ccf.png)'
- en: Sample DataFrame for the stations, Author Illustration
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 关于车站的示例 DataFrame，作者插图
- en: Filter functions
  id: totrans-106
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 过滤函数
- en: At that point, we have latitudes, longitudes, and prices for all the stations.
    We don’t want to show everything to the users, only the stations proposing relevant
    gas types around them.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们拥有所有加油站的纬度、经度和价格。我们不希望向用户展示所有信息，只展示其周围提供相关气体类型的加油站。
- en: In the coming part, we will develop all the functions to go from the raw datasets
    to the filtered ones.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分，我们将开发所有功能，以将原始数据集转换为过滤后的数据集。
- en: Calculate the distance between two points from lat/lon coordinates
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 计算两点之间的纬度/经度坐标距离
- en: Latitudes and Longitudes are expressed in degrees, and as the distance is calculated
    on the surface of the globe, simple Euclidean geometry cannot be applied.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 纬度和经度以度为单位表示，且由于距离是计算在地球表面上的，简单的欧几里得几何不能应用。
- en: 'To calculate the distance between two points, we are going to use the [Haversine
    formula](https://en.wikipedia.org/wiki/Haversine_formula):'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 为了计算两点之间的距离，我们将使用[哈弗辛公式](https://en.wikipedia.org/wiki/Haversine_formula)：
- en: '[PRE9]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Whether the function comes from you or another developer, don’t forget to test
    it to verify that the resulting output is correct.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 无论函数来自你还是其他开发人员，都不要忘记测试它以验证结果输出是否正确。
- en: In my case, I am verifying using the Google Earth distance feature and checking
    the distance between two cities for which I know latitude and longitude, and confirming
    the function returns the expected output.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在我的情况下，我正在使用 Google Earth 距离功能来检查两个我知道纬度和经度的城市之间的距离，并确认该函数返回预期的输出。
- en: Filter the dataset based on a point identified with lat/lon
  id: totrans-115
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 根据标识为纬度/经度的点过滤数据集
- en: We can now create a function that filters the station dataset based on the haversine_distance
    from a source lat/lon.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以创建一个基于源纬度/经度的哈弗辛距离过滤加油站数据集的函数。
- en: '[PRE10]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: I tested the function around my place to check that I retrieve well the stations
    available around, which is well the case.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 我在我周围的地方测试了这个函数，以检查我是否能正确检索到周围的加油站，结果确实如此。
- en: '[PRE11]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](../Images/1084c1ff11d6fe24ab0b58297ce7d4c5.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/1084c1ff11d6fe24ab0b58297ce7d4c5.png)'
- en: Sample dataset filtered around my village, Author Illustration
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤我所在村庄周围的示例数据集，作者插图
- en: Filter by gas type
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 按气体类型过滤
- en: A user will be only interested in the stations selling the type of gas used
    in his car. We can now perform a join between station_id and our gas types to
    retrieve and filter the rows by gas type.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 用户只对销售其汽车所用气体类型的加油站感兴趣。我们现在可以在 station_id 和我们的气体类型之间进行连接，以根据气体类型检索和过滤行。
- en: '[PRE12]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![](../Images/b2fd4e0c1246c92bbc10809ce336336c.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/b2fd4e0c1246c92bbc10809ce336336c.png)'
- en: Illustration of the results after applying the filter_dataset_by_gas_type, showing
    only some relevant columns. Author Illustration
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 应用 filter_dataset_by_gas_type 后的结果示意图，仅显示一些相关列。作者插图
- en: Getting coordinates and postal codes of french cities
  id: totrans-127
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 获取法国城市的坐标和邮政编码
- en: 'What we have now is not bad but not enough: we don’t want our users to write
    themselves the latitude and longitude of their location which is not something
    accessible easily.'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 目前我们拥有的情况还不错，但还不够好：我们不希望用户自己输入其位置的纬度和经度，因为这些信息不容易获取。
- en: Instead, we want a feature to get the lat/lon as easily as possible. There is
    many ways of doing this and many API ( like Google Map API ) provide already information
    accessible at different degree of complexity (and different degree of prices…).
    For a POC we want to stay simple, so we are just going to look for a dataset with
    coordinates of city centers based on their postal codes.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，我们希望提供一个尽可能简单获取纬度/经度的功能。实现这一点的方法有很多，许多 API（如 Google Map API）已经提供了以不同复杂度（和不同价格）可访问的信息。为了进行概念验证，我们希望保持简单，所以我们将寻找一个基于邮政编码的城市中心坐标数据集。
- en: '*Note: We have a dataset of stations that includes information about coordinates
    and postal codes, but it is limited to only cities that have gas stations. We
    aim to make the dataset as comprehensive as possible.*'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '*注意：我们有一个包含坐标和邮政编码信息的车站数据集，但仅限于有加油站的城市。我们的目标是使数据集尽可能全面。*'
- en: After a bit of research, I figured out another open dataset to use, accessible
    via an API that allows us to quickly retrieve exactly what we need. As mentioned
    in the introduction, those data are also under an open license and can be used
    freely.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 经过一些研究，我找到了另一个开放的数据集，可以通过 API 快速检索所需的数据。如介绍中所提，这些数据也在开放许可证下，可以自由使用。
- en: '[PRE13]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![](../Images/93d8d26d117f73cd064449674249057c.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/93d8d26d117f73cd064449674249057c.png)'
- en: Sample DataFrame for our cities_df, Author Illustration
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的 cities_df 的示例 DataFrame，作者插图
- en: 'We can now develop our final brick: a function that will take as input 3 parameters
    (a postal code, a distance, and a type of gas) and that will return the prices
    of gas stations around (I’ll assume for now stations_df, cities_df, and gas_type_df
    as a global variable, but I’ll package everything properly in a class at the end
    of the article).'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以开发最终的模块：一个函数，它将接受 3 个参数（邮政编码、距离和气体类型），并返回周围加油站的价格（我暂时假设 `stations_df`、`cities_df`
    和 `gas_type_df` 为全局变量，但我将在文章末尾将其打包到一个类中）。
- en: '[PRE14]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Tested again on my city (note there is one more station here, probably due
    to a slight difference in the lat/lon from the postal_code -> lat/lon):'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在我的城市再次测试（注意这里有一个额外的站点，可能由于邮政编码 -> 纬度/经度的微小差异）：
- en: '[PRE15]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](../Images/fd99711201975aa4909678d4198c9336.png)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/fd99711201975aa4909678d4198c9336.png)'
- en: CP dataset sample, Author Illustration
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: CP 数据集示例，作者插图
- en: 'There is something also important to note here: while gas types will be accessible
    via a finite dropdown list, it is the user’s responsibility to write a correct
    postal code. If the postal code is not correct, the sub_cities DataFrame will
    be empty, and accessing its first element will raise an error.'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 这里还有一个重要的注意事项：虽然气体类型将通过有限的下拉列表进行选择，但用户有责任填写正确的邮政编码。如果邮政编码不正确，`sub_cities` DataFrame
    将为空，访问其第一个元素将引发错误。
- en: We prefer to handle this case by catching the error with our own custom Exception,
    which will be easier to integrate later in the MVP.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 我们更倾向于通过捕获错误来处理这种情况，使用我们自定义的异常，这将更容易在 MVP 中集成。
- en: '[PRE16]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Using a postal code with the wrong format or with a value not in our database
    will generate this error message:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 使用格式错误或不在我们数据库中的邮政编码将生成此错误消息：
- en: '![](../Images/dfa7151fd1bf0bf803c45a383d88a783.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/dfa7151fd1bf0bf803c45a383d88a783.png)'
- en: Illustration of our custom exception, Author Illustration
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 我们自定义异常的插图，作者插图
- en: Build a simple demonstrator
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建一个简单的演示器
- en: So far, so good, we demonstrated the possibility to access quickly the relevant
    information in the database by simply using a postal code, a distance, and a fuel
    type.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，一切顺利，我们展示了通过简单地使用邮政编码、距离和燃料类型快速访问数据库中的相关信息的可能性。
- en: We are still using some python functions here which might be ugly to show to
    the management or to investors. To prove to them that it is worth pushing the
    project forward in the next stage of development, we want to integrate this in
    a small demonstrator.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 我们仍然在使用一些 Python 函数，这些函数展示给管理层或投资者可能会显得不够美观。为了向他们证明推动项目进入下一个开发阶段的价值，我们希望将其集成到一个小型演示器中。
- en: We could create a small dashboard that runs locally using **plotly** and **dash**
    but the fastest way would be to simply [create a small widget in a notebook](https://medium.com/@jacky.kaub/build-custom-widgets-with-ipywidgets-and-plotly-a454cb3b2b4f).
    A more advanced dashboard will be then demonstrated during the prototyping phase.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以创建一个在本地运行的小型仪表板，使用**plotly**和**dash**，但最快的方法是简单地 [在笔记本中创建一个小组件](https://medium.com/@jacky.kaub/build-custom-widgets-with-ipywidgets-and-plotly-a454cb3b2b4f)。更高级的仪表板将在原型阶段演示。
- en: Displaying a map in a notebook
  id: totrans-151
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在笔记本中显示地图
- en: There are multiple ways to display a map in a Jupyter Notebook, like the excellent
    **folium** library (check [this post](https://medium.com/datasciencearth/map-visualization-with-folium-d1403771717)
    if you want more info about the lib).
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Jupyter Notebook 中有多种显示地图的方法，比如优秀的**folium**库（如果你想了解更多关于这个库的信息，可以查看[这篇文章](https://medium.com/datasciencearth/map-visualization-with-folium-d1403771717)）。
- en: In my case, I prefer to use plotly in anticipation ofthe next stages of development
    where we will embed the [plotly map](https://plotly.com/python/maps/) directly
    in our User Interface.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 在我的情况下，我更愿意使用 plotly，以便为下一阶段的开发做好准备，我们将在用户界面中直接嵌入 [plotly 地图](https://plotly.com/python/maps/)。
- en: 'This part is very important in our development: it has to give a “wow” feeling
    to people to who you will demonstrate if you want a chance to reach later stages
    of development. You might have the best idea in the world, but if the package
    is ugly, people won’t buy it.'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 这一部分在我们的开发中非常重要：如果你想在后续开发阶段获得机会，它必须给你展示的人留下“哇”的感觉。你可能有世界上最好的想法，但如果包装难看，人们是不会买的。
- en: 'To make something clean, this is the information we want to display in our
    map:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 为了让内容清晰，这是我们想在地图上展示的信息：
- en: The coordinate of the center of the city used
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用的城市中心坐标
- en: A transparent circle showing the perimeter of the research
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 显示研究范围的透明圆圈
- en: The coordinates of the stations providing the type of fuel requested
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供所请求燃料类型的站点坐标
- en: For more clarity, we are also going to map the color of the station to the deviation
    of the price from the average
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为了更清晰，我们还将映射站点的颜色与价格偏离平均值的情况
- en: A simple map with Scattermapbox
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Scattermapbox 的简单地图
- en: Plotly has an integration of [Mapbox GL JS](https://www.mapbox.com/), allowing
    us to build a [tiled-base map](https://en.wikipedia.org/wiki/Tiled_web_map) that
    will handle operations such as navigation in the map and zooms without using excessive
    CPU resources.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: Plotly 集成了 [Mapbox GL JS](https://www.mapbox.com/)，允许我们构建一个 [瓦片地图](https://en.wikipedia.org/wiki/Tiled_web_map)，该地图可以处理如地图导航和缩放等操作，同时不会占用过多的
    CPU 资源。
- en: 'To build a map we need two ingredients:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 构建地图需要两个要素：
- en: A trace containing the data to visualize and compatible with maps (here go.Scattermapbox)
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含要可视化数据的轨迹，并与地图兼容（此处为 go.Scattermapbox）
- en: 'A layout, including a map layer. This is done by specifying a Mapbox dictionary.
    Note: you will need a free Mapbox token to access the Mapbox tiles used for the
    map background.'
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个包含地图图层的布局。这通过指定一个 Mapbox 字典来完成。注意：你需要一个免费的 Mapbox 令牌来访问用于地图背景的 Mapbox 瓦片。
- en: The example below shows a simple map (we use FigureWidget rather than Figure
    to integrate later this map directly in our widget)
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的示例显示了一个简单的地图（我们使用 FigureWidget 而不是 Figure 来将该地图直接集成到我们的部件中）
- en: '[PRE17]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'This code, when applied to our pre-filtered dataset, will result in :'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码应用于我们预筛选的数据集后，将得到：
- en: '![](../Images/6eb00fad5431b7490d3bee2b88cac995.png)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/6eb00fad5431b7490d3bee2b88cac995.png)'
- en: Output from the plotly map, Author Illustration
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 来自 plotly 地图的输出，作者插图
- en: Not very fancy yet, but it’s a good start.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 目前还不算特别花哨，但这是一个很好的开始。
- en: Adding price indicators
  id: totrans-171
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加价格指示器
- en: We can simply add other traces to our map to add more information to our base
    map.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以简单地向地图添加其他轨迹，以在基础地图上添加更多信息。
- en: As it is not possible to change directly the color of the icons, we are going
    to add an extra ScatterMapBox with circle points for which we can modify the color.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 由于无法直接更改图标的颜色，我们将添加一个额外的 ScatterMapBox，其中包含我们可以修改颜色的圆形点。
- en: '[PRE18]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![](../Images/174ddfc59c4aa73589120b6c8506e63f.png)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/174ddfc59c4aa73589120b6c8506e63f.png)'
- en: Output from the plotly map with price mapped, Author Illustration
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 带价格映射的 plotly 地图输出，作者插图
- en: Don’t underestimate the importance of the color map you chose. There are multiple
    ways in which you can represent information and the message will not be necessarily
    the same. We are using here a [divergence colormap](https://www.kennethmoreland.com/color-maps/),
    which is good for showing the relative difference of price from the average of
    the sample. I also leverage a classic human bias that associate red tones with
    something bad (here high prices) and green with something good (low prices).
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 不要低估你选择的颜色映射的重要性。你可以用多种方式来表示信息，传达的消息可能不尽相同。我们这里使用了一个 [分歧色彩图](https://www.kennethmoreland.com/color-maps/)，它适合展示价格相对于样本平均值的相对差异。我还利用了经典的心理偏差，将红色调与负面事物（这里是高价格）相关联，而绿色与正面事物（低价格）相关联。
- en: 'As an example this is the result obtained with the default colormap:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 作为示例，这里是使用默认颜色映射获得的结果：
- en: '![](../Images/a38e7b95170f11fcba8a4ba323ff2480.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a38e7b95170f11fcba8a4ba323ff2480.png)'
- en: An example NOT to follow about mapping color to prices, , Author Illustration
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 关于将颜色映射到价格的一个不应跟随的示例，作者插图
- en: Add the position of the user and the research perimeter
  id: totrans-181
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加用户位置和研究范围
- en: Adding the position of the user is the simplest part, we can just add a red
    dot that will symbolize the center posi**t**ion of the research.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 添加用户位置是最简单的部分，我们可以简单地添加一个红点，象征研究的中心位置**t**。
- en: The research perimeter is a bit more complicated. We will represent the circle
    using another Scattermapbox with latitudes and longitudes at the edge of the circle.
    To do so, we need first a function to calculate, from a coordinate and a radius,
    the coordinates of the perimeter of the circle.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 研究范围稍微复杂一些。我们将使用另一个 Scattermapbox 通过纬度和经度在圆的边缘表示圆形。为此，我们首先需要一个函数来计算从坐标和半径得到的圆周坐标。
- en: '[PRE19]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: We can now generate a list of points, and add them as a new trace to our graph.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以生成一个要点列表，并将它们作为新的轨迹添加到我们的图表中。
- en: '[PRE20]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![](../Images/a84e4ff8fb1971685dc01cbebc232af9.png)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/a84e4ff8fb1971685dc01cbebc232af9.png)'
- en: Adding the research parameter area and the position of the user, Author Illustration
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 添加研究参数区域和用户位置，作者插图
- en: Final packaging in a widget
  id: totrans-189
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在小部件中的最终打包
- en: We are almost done with our demonstrator, we just need to add a bit of interactivity.
    To do so, I am going to package everything we did so far and include 3 components
    to control the type of fuel, the distance of research, and the postal code.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的演示几乎完成了，只需要添加一点互动性。为此，我将把我们到目前为止做的所有工作打包，并包括 3 个组件来控制燃料类型、研究距离和邮政编码。
- en: I will skip the full packaging, I am only putting everything we saw so far in
    a general class to handle the different states. If you are not familiar with interactive
    notebook using **ipywidgets**, you can check [this list of article](https://medium.com/@jacky.kaub/list/jupyter-notebook-widgets-bad265ffc7bf)s.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 我将跳过完整的打包过程，只将我们迄今为止看到的内容放入一个通用类中，以处理不同的状态。如果你不熟悉使用 **ipywidgets** 的互动笔记本，可以查看
    [这份文章列表](https://medium.com/@jacky.kaub/list/jupyter-notebook-widgets-bad265ffc7bf)。
- en: '[PRE21]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The callbacks will all do the same thing: observe a change, update the filtered
    dataset, and update the figure. For example, here is the _on_distance callback:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 回调函数将执行相同的操作：观察变化、更新过滤后的数据集，并更新图形。例如，这里是 _on_distance 回调：
- en: '[PRE22]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Finally, let’s have a look at the method to update the figure. Once the dataset
    is filtered, we are generating a new figure and update the key elements of our
    current figure with the new traces generated.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，让我们看看更新图形的方法。一旦数据集被过滤，我们将生成一个新图形，并用生成的新轨迹更新当前图形的关键元素。
- en: '[PRE23]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: And that’s it! We can just add a “public” method display that will be called
    in the notebook to display the widget, and our demo is now ready to be shown.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样！我们只需添加一个“public”方法 display，该方法将在笔记本中调用以显示小部件，我们的演示就准备好了。
- en: '[PRE24]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![](../Images/2bb40a987b30833a48970e5b9573fde1.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2bb40a987b30833a48970e5b9573fde1.png)'
- en: Our POC demo in action, Author Illustration
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的 POC 演示正在运行，作者插图
- en: Conclusion
  id: totrans-201
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结论
- en: This last chapter concludes the first part of our product development, aka the
    Proof of Concept.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 本章结束了我们产品开发的第一部分，也就是概念验证。
- en: We built step by step the first demo that we can use to demonstrate the potential
    of our idea. This demo, done in a small amount of time, is still minimalist and
    we will have to develop the concept further in the next development phase, the
    Prototyping.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 我们一步一步地构建了第一个演示，用以展示我们想法的潜力。这个演示在短时间内完成，仍然是简约的，我们将在下一个开发阶段——原型制作中进一步发展这个概念。
- en: In that next phase of development, we will modify this minimalist widget to
    make it a real web application with more features and usable locally on your computer.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个开发阶段，我们将修改这个简约的小部件，使其成为一个真正的 Web 应用程序，具有更多功能，并可以在你的计算机上本地使用。
